interaction_type,primary_metric,related_metrics,relationship_description,mathematical_formula,business_validation,validation_sql,relationship_strength,business_impact,response_id,dashboard_id,related_metrics_count,related_metrics_text
mathematical_relationship,total_spend_ty,['total_spend_ly'],Year-over-year comparison of total advertising spend.,Growth = (Total_Spend_TY - Total_Spend_LY) / Total_Spend_LY,Crucial for assessing business growth or decline in advertising spend.,"SELECT SUM(total_spend_ty) AS current_year_spend, SUM(total_spend_ly) AS last_year_spend FROM ( /* primary_analysis_sql CTEs */ ) WHERE period_type_flag IS NOT NULL",strong,high,0,601ed0d2-e944-4189-8170-d593c8e72026,1,total_spend_ly
filter_impact,total_spend_ty,"['portfolio_parent_group_name', 'time_period_quarter', 'advertiser']","Total Spend TY is filtered by specific portfolio groups, quarters, and advertiser lists.",N/A,These filters allow granular analysis of spend by specific business segments or clients.,SELECT SUM(total_spend_ty) FROM ( /* primary_analysis_sql CTEs */ ) WHERE portfolio_parent_group_name = 'KEY ACCOUNTS TRAVEL' AND calendar_quarter = 'Q2',strong,high,0,601ed0d2-e944-4189-8170-d593c8e72026,3,"portfolio_parent_group_name, time_period_quarter, advertiser"
hierarchical,total_spend_ty,"['major_category', 'category', 'sub_category']",Spend can be aggregated and drilled down by category hierarchy.,N/A,Allows analysis of spend distribution across different advertising categories.,"SELECT major_category, SUM(total_spend_ty) FROM ( /* primary_analysis_sql CTEs */ ) GROUP BY major_category",strong,medium,0,601ed0d2-e944-4189-8170-d593c8e72026,3,"major_category, category, sub_category"
dependency,spend_ty_adjusted,"['is_spend_in_thousands_flag', 'is_spend_in_dollars_flag', 'spend_in_thousands', 'spend_cleaned']","The final 'This Year' spend value depends on the raw spend, null handling, scaling, and the selected display unit.","Spend_TY_Adjusted = IF(Is_Spend_In_Thousands_Flag, Spend_in_Thousands, Spend_Cleaned)",Ensures spend is presented consistently based on user's preferred display unit.,SELECT SUM(CASE WHEN is_spend_in_thousands_flag THEN spend_in_thousands ELSE spend_cleaned END) AS calculated_spend_ty_adjusted FROM ( /* primary_analysis_sql CTEs */ ) WHERE period_type_flag = 'ty',strong,high,0,601ed0d2-e944-4189-8170-d593c8e72026,4,"is_spend_in_thousands_flag, is_spend_in_dollars_flag, spend_in_thousands, spend_cleaned"
dependency,total_actual_amount,"['actual_amount', 'fy_year', 'source_system_name']","Total Actual Amount is the sum of Actual Amount, grouped by Fiscal Year and Source System Name.","SUM(actual_amount) GROUP BY fy_year, source_system_name","This aggregation provides the total financial performance by fiscal year and source system, which is a core business reporting requirement.","SELECT fy_year, source_system_name, SUM(Actual_Amount) FROM OSandFACT GROUP BY fy_year, source_system_name LIMIT 10;",strong,high,1,d7412673-0af1-4efe-8374-ca475b001fb6,3,"actual_amount, fy_year, source_system_name"
dependency,source_system_record_count,['source_system_name'],Source System Record Count is the count of records grouped by Source System Name.,COUNT(1) GROUP BY source_system_name,"This count helps understand the data volume and distribution across different source systems, useful for data quality and completeness checks.","SELECT source_system_name, COUNT(1) FROM OSandFACT GROUP BY source_system_name LIMIT 10;",strong,medium,1,d7412673-0af1-4efe-8374-ca475b001fb6,1,source_system_name
filter_impact,total_actual_amount,"['period_name', 'fy_year_week_number']","All aggregated metrics are filtered by the 'period_name' being 'CP' (Current Period) or 'PY' (Prior Year) via the calendar join, limiting the data to specific fiscal periods.",N/A (filter),"Ensures that financial reports only include data relevant to the current and prior fiscal periods, crucial for consistent financial analysis.",SELECT DISTINCT period_name FROM OSandFACT;,strong,high,1,d7412673-0af1-4efe-8374-ca475b001fb6,2,"period_name, fy_year_week_number"
filter_impact,gross_revenue_by_transaction_status_fy2025,['gross_revenue_specific_bookings_by_transaction_status_fy2025'],"The 'Gross Revenue for Specific Bookings' metric is a subset of the 'Gross Revenue by Transaction Status' metric, as it applies an additional filter on 'booking_name' while sharing the 'financial_year' and 'revenue_transaction_status' dimensions.",Gross Revenue (Specific Bookings) <= Gross Revenue (All Bookings) for the same financial year and transaction status.,Ensures that revenue from specific projects/bookings is correctly accounted for as part of the overall revenue stream.,"SELECT SUM(CASE WHEN SAFE_CAST(booking_name AS STRING) IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024') THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS specific_booking_revenue, SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_fy2025_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND relative_fy_year_offset IN (-1, 0, 1) HAVING specific_booking_revenue <= total_fy2025_revenue;",strong,high,3,e83da1de-4227-43e6-bcc6-73051c66914b,1,gross_revenue_specific_bookings_by_transaction_status_fy2025
component_of_total,gross_revenue_adsize_category_fy_period,['gross_revenue_by_transaction_status_fy2025'],"Both metrics represent different slices of the total gross revenue for FY2025. The 'Adsize Category' metric focuses on a specific quarter (Q1 FY2025) and categorizes by ad type, while the 'Transaction Status' metric covers the full FY2025 and categorizes by revenue status.",SUM(gross_revenue_adsize_category_fy_period for Q1) is a portion of SUM(gross_revenue_by_transaction_status_fy2025 for FY2025).,"Provides different perspectives on revenue performance, allowing for both quarterly operational analysis by ad type and annual financial status analysis.","SELECT SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(fy_year_month_number AS INT64) IN (202501, 202502, 202503) THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS q1_fy2025_revenue, SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS total_fy2025_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE relative_fy_year_offset IN (-1, 0, 1) HAVING q1_fy2025_revenue <= total_fy2025_revenue;",medium,medium,3,e83da1de-4227-43e6-bcc6-73051c66914b,1,gross_revenue_by_transaction_status_fy2025
dependency,total_amount_type_03,['total_amount'],"`total_amount_type_03` is a subset of `total_amount`, representing the amount specifically for transactions where `revenue_type` starts with '03'.",total_amount_type_03 <= total_amount,"Ensures that the specific revenue category is correctly accounted for within the overall revenue, allowing for granular analysis without double-counting.","SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN SAFE_CAST(amount AS NUMERIC) ELSE 0 END) <= SUM(SAFE_CAST(amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;",strong,high,4,f7a9efeb-df3c-45c9-899d-0bcada701572,1,total_amount
dependency,total_volume_type_03,['total_volume'],"`total_volume_type_03` is a subset of `total_volume`, representing the volume specifically for transactions where `revenue_type` starts with '03'.",total_volume_type_03 <= total_volume,"Ensures that the specific volume category is correctly accounted for within the overall volume, allowing for granular operational analysis.","SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN SAFE_CAST(volume AS INT64) ELSE 0 END) <= SUM(SAFE_CAST(volume AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;",strong,high,4,f7a9efeb-df3c-45c9-899d-0bcada701572,1,total_volume
dependency,current_fy_gross_revenue_display,['current_fy_gross_revenue'],The display version of current FY gross revenue depends on the raw current FY gross revenue and a hardcoded 'thousands' toggle.,current_fy_gross_revenue_display = current_fy_gross_revenue / 1000 (conditional),"Ensures revenue is presented in the desired scale (e.g., thousands).",SELECT SUM(current_fy_gross_revenue_display * 1000) = SUM(current_fy_gross_revenue) FROM your_table WHERE '$\'000' != '$',strong,high,5,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,current_fy_gross_revenue
dependency,previous_fy_gross_revenue_display,['previous_fy_gross_revenue'],The display version of previous FY gross revenue depends on the raw previous FY gross revenue and a hardcoded 'thousands' toggle.,previous_fy_gross_revenue_display = previous_fy_gross_revenue / 1000 (conditional),"Ensures revenue is presented in the desired scale (e.g., thousands).",SELECT SUM(previous_fy_gross_revenue_display * 1000) = SUM(previous_fy_gross_revenue) FROM your_table WHERE '$\'000' != '$',strong,high,5,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,previous_fy_gross_revenue
filter_impact,advertiser_parent,['combined_period_string'],The list of 'advertiser_parent' values is filtered by a specific 'combined_period_string' ('Jul Q1 H1'). This implies a dashboard filter or control that affects the available advertisers.,,Ensures only relevant advertisers for the selected period are shown.,"SELECT COUNT(DISTINCT advertiser_parent) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE CONCAT(SAFE_CAST(financial_short_month AS STRING),' ',CONCAT('Q',SAFE_CAST(financial_quarter AS STRING)),' ',(CASE WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1' WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END)) = 'Jul Q1 H1'",strong,high,5,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,combined_period_string
filter_impact,sales_segment_l_2_name,"['current_fy_gross_revenue_display', 'previous_fy_gross_revenue_display', 'conditional_gross_revenue_display']",All revenue metrics are filtered by 'sales_segment_l_2_name' being 'Consortium QLD'. This implies a dashboard filter or chart-specific filter.,,Ensures revenue metrics are specific to the 'Consortium QLD' segment.,SELECT SUM(current_fy_gross_revenue_display) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE sales_segment_l_2_name = 'Consortium QLD',strong,high,5,9269e9c6-1ad0-4415-96c3-aca8a710ba01,3,"current_fy_gross_revenue_display, previous_fy_gross_revenue_display, conditional_gross_revenue_display"
filter_impact,all_metrics,"['budget_earned_amount_fy25_wk38', 'earned_amount_fy25_wk38', 'closing_base_fy25_wk38', 'opening_base_fy25_wk38', 'net_change_fy24_wk38', 'closing_base_fy25_wk37', 'opening_base_fy25_wk37', 'earned_amount_fy25_wk37', 'current_week_flag_fy25_wk37', 'dashboard_view_type', 'distinct_view_types_count']",All identified metrics are filtered by `masthead_group != 'Discontinued'` and `finance_recognition = 'Digital Recognition'`. This ensures only relevant digital subscription data is included.,N/A,"Ensures that the dashboard focuses on active digital subscriptions and excludes discontinued products, providing a clean view of current performance.","SELECT
  SUM(CASE WHEN masthead_group = 'Discontinued' THEN 1 ELSE 0 END) AS discontinued_records_count,
  SUM(CASE WHEN finance_recognition != 'Digital Recognition' THEN 1 ELSE 0 END) AS non_digital_recognition_records_count
FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`
WHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;",strong,high,6,bb49fa78-5abe-4e68-a9c1-8172a832e724,11,"budget_earned_amount_fy25_wk38, earned_amount_fy25_wk38, closing_base_fy25_wk38, opening_base_fy25_wk38, net_change_fy24_wk38, closing_base_fy25_wk37, opening_base_fy25_wk37, earned_amount_fy25_wk37, current_week_flag_fy25_wk37, dashboard_view_type, distinct_view_types_count"
mathematical_relationship,net_change_fy24_wk38,"['closing_base_fy24_wk38', 'opening_base_fy24_wk38']","Net Change (FY2024, Week 38) is calculated as the difference between Closing Base and Opening Base for the specified prior fiscal period.",Net Change = Closing Base - Opening Base,"This calculation provides insight into the growth or decline of the subscription base for the prior year's corresponding week, enabling year-on-year comparison.","WITH base_data AS (
  SELECT
    t0.ClosingBase,
    t0.OpeningBase,
    t0.finance_recognition,
    t0.fy_week_of_year,
    t0.fy_year,
    t0.masthead_group,
    CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP('2025-03-26 03:31:44.896010+00', 'Australia/Sydney')) - 1) <= 2
         THEN DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1
         ELSE DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)
    END AS derived_week_q1
  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0
  WHERE
    t0.masthead_group != 'Discontinued'
    AND t0.finance_recognition = 'Digital Recognition'
)
SELECT
  SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN ClosingBase ELSE 0 END) - SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN OpeningBase ELSE 0 END) AS calculated_net_change,
  SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN ClosingBase - OpeningBase ELSE 0 END) AS direct_net_change_sum
FROM base_data
LIMIT 1;",strong,high,6,bb49fa78-5abe-4e68-a9c1-8172a832e724,2,"closing_base_fy24_wk38, opening_base_fy24_wk38"
conditional_selection,all_metrics_with_fy_week_filter,"['budget_earned_amount_fy25_wk38', 'earned_amount_fy25_wk38', 'closing_base_fy25_wk38', 'opening_base_fy25_wk38', 'net_change_fy24_wk38', 'closing_base_fy25_wk37', 'opening_base_fy25_wk37', 'earned_amount_fy25_wk37', 'current_week_flag_fy25_wk37']","Metrics are conditionally summed based on specific `fy_year` and `fy_week_of_year` values, which are derived from hardcoded dates (2025-03-26 for Week 38, 2025-03-25 for Week 37).",SUM(CASE WHEN fy_year = [YEAR] AND fy_week_of_year = [WEEK] THEN [METRIC_COLUMN] ELSE 0 END),"This logic isolates data for specific reporting periods (e.g., 'current week', 'prior year same week'). The hardcoded dates make these calculations static and require manual updates or parameterization for ongoing relevance.","SELECT
  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = 38 THEN EarnedAmount ELSE 0 END) AS earned_amount_wk38,
  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = 37 THEN EarnedAmount ELSE 0 END) AS earned_amount_wk37
FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`
WHERE masthead_group != 'Discontinued' AND finance_recognition = 'Digital Recognition'
LIMIT 1;",strong,high,6,bb49fa78-5abe-4e68-a9c1-8172a832e724,9,"budget_earned_amount_fy25_wk38, earned_amount_fy25_wk38, closing_base_fy25_wk38, opening_base_fy25_wk38, net_change_fy24_wk38, closing_base_fy25_wk37, opening_base_fy25_wk37, earned_amount_fy25_wk37, current_week_flag_fy25_wk37"
mathematical_relationship,volume_vs_budget_past_weeks,"['total_volume', 'budget_volume_past_weeks']",Volume vs. Budget (Past Weeks) is calculated as the difference between Total Volume and Budget Volume (Past Weeks).,volume_vs_budget_past_weeks = total_volume - budget_volume_past_weeks,This relationship is fundamental for understanding budget adherence and performance variance.,"SELECT
  SUM(volume - (CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END)) AS calculated_variance,
  SUM(volume) - SUM(CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END) AS derived_variance_check
FROM
  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os
  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar
    ON os.fiscal_week_id = calendar.fy_year_week_number
WHERE
  upper(os.os_level_6) = 'CIRCULATION'
  AND gl_hierarchy_code = 'FY2025'
  AND os.os_level_8 != 'DTI Free Copies'
  AND NOT(CASE WHEN os.publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN os.publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN os.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN os.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN os.publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN os.publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN os.publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN os.publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN os.publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN os.publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN os.publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN os.publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN os.publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN os.publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END IS NULL)
LIMIT 1;",strong,high,7,6a26c78f-0070-4fb3-88b8-691ee4a4485a,2,"total_volume, budget_volume_past_weeks"
filter_impact,total_actual_amount,['actual_amount_all_sales_channels'],"Actual Amount (All Sales Channels) is a subset of Total Actual Amount, filtered specifically for records where `os_level_7` is 'ALL SALES CHANNELS'.",actual_amount_all_sales_channels = SUM(Total_Actual_Amount WHERE os_level_7 = 'ALL SALES CHANNELS'),"This highlights a specific segment of revenue, allowing for focused analysis on a particular sales channel group.","SELECT
  SUM(CASE WHEN ('1' = '1') THEN (CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END) WHEN ('1' = '2') THEN (CASE WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 9 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END) WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) AS total_actual_amount_unfiltered,
  SUM(CASE WHEN UPPER(os_level_7) = 'ALL SALES CHANNELS' THEN (CASE WHEN ('1' = '1') THEN (CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END) WHEN ('1' = '2') THEN (CASE WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END) WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) ELSE 0 END) AS actual_amount_all_sales_channels_filtered
FROM
  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os
  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar
    ON os.fiscal_week_id = calendar.fy_year_week_number
WHERE
  upper(os.os_level_6) = 'CIRCULATION'
  AND gl_hierarchy_code = 'FY2025'
  AND (CASE WHEN os.os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels') THEN 'Alternative Channels' WHEN os.os_level_10 IN ('Petrol and Convenience') THEN 'Convenience Stores / Service Stations' WHEN os.os_level_10 IN ('Agent & Dist') THEN 'Newsagencies' WHEN os.os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub') THEN 'Subscriptions' WHEN os.os_level_10 IN ('Supermarkets') THEN 'Supermarkets' ELSE 'Unspec Channel' END) = 'Retail'
  AND NOT(CASE WHEN os.publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN os.publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN os.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN os.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN os.publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN os.publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN os.publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN os.publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN os.publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN os.publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN os.publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN os.publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN os.publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN os.publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END IS NULL)
LIMIT 1;",strong,medium,7,6a26c78f-0070-4fb3-88b8-691ee4a4485a,1,actual_amount_all_sales_channels
hierarchical,daily_budget_volume_adjusted,['publication_group'],"The calculation of daily budget volume is conditional on the `publication_group` (e.g., 'PNG', '6 Day Pubs'), implying a hierarchical business rule for different publication types.",daily_budget_volume_adjusted = SUM(IF publication_group = 'PNG' THEN 0 ELSE IF publication_group = '6 Day Pubs' THEN final_daily_budget_volume_clmn88 / 6 ELSE final_daily_budget_volume_clmn88 / 7 END),"This reflects specific operational differences in how daily volumes are calculated for different types of publications (e.g., 6-day vs 7-day publishing schedules).","SELECT
  publication_group,
  SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_budget_volume_clmn88, 6) ELSE SAFE_DIVIDE(final_daily_budget_volume_clmn88, 7) END) AS daily_budget_volume_adjusted_check,
  SUM(final_daily_budget_volume_clmn88) AS total_budget_volume_for_daily_calc
FROM (
    -- Replicate the CTEs up to final_daily_metrics to get final_daily_budget_volume_clmn88 and publication_group
    WITH OSandFACT AS (
        SELECT
          os.source_system_name, os.sub_source_system_name, CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id, os.gl_publication_code, os.day_of_week, os.state, os.os_level_1, os.os_level_2, os.os_level_3, os.os_level_4, os.os_level_5, os.os_level_6, os.os_level_7, os.os_level_8, os.os_level_9, os.os_level_10, os.os_level_11, os.os_level_12, os.Estimate, os.True_Up_Adjustment, os.Actual_Amount, os.volume, os.Last_Year_Actual_Amount, os.Last_Year_volume, os.Budget_Draft_Amount, os.Budget_Draft_Volume, os.Budget_Amount, os.Budget_Volume, os.Forecast_Amount, os.Forecast_Volume, os.Budget_Jan_Amount, os.Budget_Jan_Volume, os.Budget_Feb_Amount, os.Budget_Feb_Volume, os.Budget_Mar_Amount, os.Budget_Mar_Volume, os.Budget_Apr_Amount, os.Budget_Apr_Volume, os.Budget_May_Amount, os.Budget_May_Volume, os.Budget_Jun_Amount, os.Budget_Jun_Volume, os.Budget_Jul_Amount, os.Budget_Jul_Volume, os.Budget_Aug_Amount, os.Budget_Aug_Volume, os.Budget_Sep_Amount, os.Budget_Sep_Volume, os.Budget_Oct_Amount, os.Budget_Oct_Volume, os.Budget_Nov_Amount, os.Budget_Nov_Volume, os.Budget_Dec_Amount, os.Budget_Dec_Volume, os.Forecast_Q1F_Amount, os.Forecast_Q1F_Volume, os.Forecast_Q2F_Amount, os.Forecast_Q2F_Volume, os.Forecast_Q3F_Amount, os.Forecast_Q3F_Volume, os.Forecast_Q4F_Amount, os.Forecast_Q4F_Volume, os.Forecast_Q5F_Amount, os.Forecast_Q5F_Volume, pub.l04_publication_code, pub.l06_publication_code, pub.gl_hierarchy_code, calendar.fy_week_of_year, calendar.fy_year_week_number, calendar.fy_first_day_of_week, calendar.fy_last_day_of_week, calendar.fy_month_of_year, calendar.fy_year_month_number, calendar.relative_fisc_year_number, calendar.relative_fisc_week_number, calendar.fy_month_of_year_short_name, calendar.month_end_flag, calendar.fy_quarter_of_year, calendar.fy_year
        FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os
        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code
        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number
        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep ON os.os_level_12 = dep.department_code
        WHERE upper(os.os_level_6) = 'CIRCULATION' AND pub.l04_publication_code <> 'Free News & Lifestyle' AND pub.l06_publication_code NOT IN ('Food', 'Prestige') AND pub.gl_hierarchy_code = 'FY2025'
    ),
    pre_calculated_data AS (
        SELECT
            *,
            CASE WHEN publication_code = 'Post Courier' THEN 'PNG' ELSE publication_name END AS derived_publication_name_clmn7,
            CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END AS budget_volume_past_weeks_clmn8_9,
            CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END AS standardized_publication_name,
            CASE WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Daily Telegraph' THEN ' NSW' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times') THEN '  VIC' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Advertiser' THEN '   SA' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast') THEN '     QLD' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Northern Territory News' THEN '      NT' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Mercury' THEN '    TAS' ELSE NULL END AS derived_state_region,
            EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1 AS derived_day_of_week_from_date,
            DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS derived_weeks_diff,
            CASE WHEN day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F' WHEN day_of_week = 'Sat' THEN 'SAT' WHEN day_of_week = 'Sun' THEN 'Sun' ELSE NULL END AS day_of_week_group,
            CASE WHEN os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels') THEN 'Alternative Channels' WHEN os_level_10 IN ('Petrol and Convenience') THEN 'Convenience Stores / Service Stations' WHEN os_level_10 IN ('Agent & Dist') THEN 'Newsagencies' WHEN os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub') THEN 'Subscriptions' WHEN os_level_10 IN ('Supermarkets') THEN 'Supermarkets' ELSE 'Unspec Channel' END AS channel_group,
            UPPER(SAFE_CAST(os_level_7 AS STRING)) AS os_level_7_upper,
            CASE WHEN relative_fisc_week_number < 0 THEN Budget_Amount ELSE 0 END AS budget_amount_past_weeks,
            CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END AS budget_amount_current_year,
            CASE WHEN publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas' WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian' WHEN publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other' WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' ELSE publication_name END AS publication_group,
            CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END AS conditional_week_num,
            (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail' AS is_courier_mail,
            (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' AS is_the_australian,
            CASE WHEN (0 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) ELSE 0 END AS week_num_for_calc,
            ((CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' OR (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail') AS is_courier_mail_or_australian,
            ((CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 26 OR (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 40) AS is_week_26_or_40,
            SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) AS hardcoded_month_num_clmn70,
            CASE WHEN (TRUE) THEN (CASE WHEN conditional_week_num <= fy_year_week_number THEN Actual_Amount ELSE 0 END) ELSE 0 END AS forecast_amount_adjusted_clmn71_72,
            CASE WHEN ('2' = '1') THEN (CASE WHEN fy_week_of_year = week_num_for_calc THEN Budget_Amount ELSE 0 END) WHEN (TRUE AND ('2' = '1')) THEN budget_amount_past_weeks WHEN ('2' = '2') THEN budget_amount_current_year WHEN ('2' = '3') THEN budget_amount_current_year ELSE 0 END AS budget_amount_adjusted_clmn73,
            CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END AS actual_amount_adjusted_clmn74,
            CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN volume ELSE Forecast_Volume END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN volume ELSE Forecast_Volume END) WHEN fy_month_of_year < 10 THEN volume ELSE Forecast_Volume END AS volume_adjusted_clmn75
    ),
    final_calculations AS (
        SELECT
            *,
            CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END AS final_actual_amount_clmn76,
            CASE WHEN ('1' = '1') THEN Budget_Volume WHEN ('1' = '2') THEN volume_adjusted_clmn75 WHEN ('1' = '3') THEN Last_Year_volume ELSE 0 END AS final_budget_volume_clmn77,
            CASE WHEN (os_level_7_upper = 'ALL SALES CHANNELS') THEN (CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) ELSE 0 END AS actual_amount_all_sales_channels_clmn78,
            SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*2))*5 AS forecast_volume_sportsman_clmn79,
            final_budget_volume_clmn77*5 AS budget_volume_weekly_times_clmn80,
            SAFE_DIVIDE(final_budget_volume_clmn77, 4)*5 AS budget_volume_mf_clmn81,
            SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc)*5 AS forecast_volume_weekly_times_clmn82,
            SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*5))*5 AS forecast_volume_mf_clmn83,
            SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc) AS forecast_volume_general_clmn84,
            SAFE_DIVIDE(final_budget_volume_clmn77, 2)*5 AS budget_volume_sportsman_clmn85
    )
    , daily_adjusted_metrics AS (
        SELECT
            *,
            CASE WHEN (day_of_week_group = 'M-F') THEN budget_volume_mf_clmn81 ELSE final_budget_volume_clmn77 END AS budget_volume_adjusted_mf_clmn86,
            CASE WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83 ELSE forecast_volume_general_clmn84 END AS forecast_volume_adjusted_mf_clmn87
    )
    SELECT
        *,
        CASE WHEN (is_week_26_or_40 AND is_courier_mail_or_australian) THEN budget_volume_adjusted_mf_clmn86 WHEN (standardized_publication_name = 'The Sportsman') THEN budget_volume_sportsman_clmn85 WHEN (standardized_publication_name = 'Weekly Times') THEN budget_volume_weekly_times_clmn80 WHEN (publication_group = 'PNG') THEN 0 ELSE final_budget_volume_clmn77 END AS final_daily_budget_volume_clmn88,
        CASE WHEN (is_the_australian OR is_courier_mail) THEN forecast_volume_adjusted_mf_clmn87 WHEN (standardized_publication_name = 'The Sportsman') THEN forecast_volume_sportsman_clmn79 WHEN (standardized_publication_name = 'Weekly Times') THEN forecast_volume_weekly_times_clmn82 WHEN (publication_group = 'PNG') THEN 0 WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83 ELSE forecast_volume_general_clmn84 END AS final_daily_forecast_volume_clmn89
    FROM daily_adjusted_metrics
    WHERE
        os_level_8 != 'DTI Free Copies'
        AND NOT(standardized_publication_name IS NULL)
        AND channel_group = 'Retail'
) AS subquery
GROUP BY
  publication_group
LIMIT 10;",strong,high,7,6a26c78f-0070-4fb3-88b8-691ee4a4485a,1,publication_group
filter_impact,digital_subscription_count,"['recognition_type', 'masthead_group']",The 'Digital Subscription Count' is directly filtered by 'recognition_type' being 'Digital Recognition' and 'masthead_group' not being 'Discontinued'.,COUNT(DISTINCT subscription_id) WHERE recognition_type = 'Digital Recognition' AND masthead_group != 'Discontinued',"Ensures that the dashboard focuses specifically on active digital subscriptions from relevant mastheads, aligning with the 'Optimizing Digital Subscriptions' goal.","SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE (CASE WHEN delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN subscriber_has_email_flag = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' AND (CASE WHEN masthead_code = 'TA' THEN 'The Australian' WHEN masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN masthead_code = 'WT' THEN 'Others' WHEN masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END) != 'Discontinued';",strong,high,8,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"recognition_type, masthead_group"
filter_impact,digital_subscription_revenue,"['recognition_type', 'masthead_group']",The 'Digital Subscription Revenue' is directly filtered by 'recognition_type' being 'Digital Recognition' and 'masthead_group' not being 'Discontinued'.,SUM(revenue_amount) WHERE recognition_type = 'Digital Recognition' AND masthead_group != 'Discontinued',"Ensures that revenue figures are attributed only to digital subscriptions from relevant mastheads, providing a clear financial picture for the digital business.","SELECT SUM(SAFE_CAST(revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE (CASE WHEN delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN subscriber_has_email_flag = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' AND (CASE WHEN masthead_code = 'TA' THEN 'The Australian' WHEN masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN masthead_code = 'WT' THEN 'Others' WHEN masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END) != 'Discontinued';",strong,high,8,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"recognition_type, masthead_group"
hierarchical,masthead_group,['masthead_name'],'Masthead Group' is a higher-level aggregation of 'Masthead Name'. Each 'Masthead Name' belongs to exactly one 'Masthead Group'.,N/A (Categorization),"Allows for analysis at different levels of granularity, from individual mastheads to broader portfolio segments.","SELECT masthead_name, COUNT(DISTINCT masthead_group) FROM (SELECT t0.masthead_code, CASE WHEN t0.masthead_code = 'TA' THEN 'The Australian' WHEN t0.masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN t0.masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN t0.masthead_code = 'WT' THEN 'Others' WHEN t0.masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END AS masthead_group, CASE WHEN (t0.gl_publication_code = '100' OR t0.gl_publication_code = '101' OR t0.masthead_code = 'TA') THEN 'The Australian' WHEN (t0.gl_publication_code = '400' OR t0.gl_publication_code = '401' OR t0.gl_publication_code = '402' OR t0.masthead_code = 'CM') THEN 'Courier Mail' ELSE 'Other' END AS masthead_name FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0) GROUP BY masthead_name HAVING COUNT(DISTINCT masthead_group) > 1 LIMIT 10; -- Should ideally return 0 rows if mapping is 1:1",strong,medium,8,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,1,masthead_name
hierarchical,fiscal_year_week_string,"['fiscal_week_relative_num', 'fiscal_month_name']",'Fiscal Year Week String' is a composite dimension built from 'Fiscal Week Number' and 'Fiscal Month Name'.,N/A (String Concatenation),Provides a user-friendly representation of the fiscal period while retaining the underlying numerical and categorical components for detailed analysis.,"SELECT fiscal_year_week_string, fiscal_week_relative_num, fiscal_month_name FROM (SELECT DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS fiscal_week_relative_num, CASE WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 4) THEN 'July' WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 9) THEN 'August' ELSE NULL END AS fiscal_month_name, CONCAT('FY ', '2025', ' Week ', SAFE_CAST(DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS STRING), ' (', SAFE_CAST(CASE WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 4) THEN 'July' WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 9) THEN 'August' ELSE NULL END AS STRING), ')') AS fiscal_year_week_string FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 10) GROUP BY fiscal_year_week_string, fiscal_week_relative_num, fiscal_month_name HAVING COUNT(*) > 0;",strong,medium,8,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"fiscal_week_relative_num, fiscal_month_name"
filter_impact,total_revenue_net,"['advertiser', 'buyer', 'source', 'transaction_type_upper', 'reporting_month', 'fiscal_year_quarter_label']",All identified dimensions are used to filter or group the 'Total Revenue Net' metric. The specific combinations of filters vary per dashboard component.,SUM(RevenueNet) WHERE Dimension_X = 'Value_A' AND Dimension_Y = 'Value_B',Ensures that revenue figures are presented in the correct business context and segmentation.,"SELECT reporting_month, SUM(SAFE_CAST(revenuenet AS NUMERIC)) FROM final_data WHERE advertiser = 'The Smith Family *' GROUP BY 1 LIMIT 10;",strong,high,9,783f341c-8660-4e90-bab8-9bc860119cf5,6,"advertiser, buyer, source, transaction_type_upper, reporting_month, fiscal_year_quarter_label"
dependency,reporting_month,"['financial_year', 'financial_month_number']",The 'Reporting Month' dimension is derived from 'financial_year' and 'financial_month_number' with a 6-month offset and then truncated to the start of the month. This implies a specific fiscal calendar definition.,"reporting_month = DATE_TRUNC(DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH), MONTH)",Critical for understanding the fiscal calendar alignment and ensuring time-series data is correctly interpreted.,"SELECT financial_year, financial_month_number, DATE(financial_year, financial_month_number, 1) as raw_date, DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH) as adjusted_date, SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH) AS DATETIME), MONTH) AS DATE) as reporting_month FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` LIMIT 10;",strong,high,9,783f341c-8660-4e90-bab8-9bc860119cf5,2,"financial_year, financial_month_number"
dependency,fiscal_year_quarter_label,"['financial_year', 'financial_quarter']","The 'Fiscal Year Quarter Label' is a string concatenation of 'FY', a shortened 'financial_year', and 'financial_quarter'.","fiscal_year_quarter_label = CONCAT('FY', SUBSTR(financial_year, 3, 2), ' ', financial_quarter)","Provides a human-readable label for fiscal periods, used for filtering and reporting.","SELECT financial_year, financial_quarter, CONCAT('FY', SUBSTR(SAFE_CAST(financial_year AS STRING), 3, 2), ' ', SAFE_CAST(financial_quarter AS STRING)) as calculated_label FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` LIMIT 10;",strong,medium,9,783f341c-8660-4e90-bab8-9bc860119cf5,2,"financial_year, financial_quarter"
mathematical_relationship,ly_gross_revenue_amount_k,['ly_gross_revenue_amount'],Last Year Gross Revenue Amount (in '000s) is derived directly from Last Year Gross Revenue Amount by dividing by 1000.,ly_gross_revenue_amount_k = ly_gross_revenue_amount / 1000,Ensures consistent scaling for presentation of large numbers.,SELECT SUM(ly_gross_revenue_amount_k * 1000) = SUM(ly_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE ly_gross_revenue_amount IS NOT NULL;,strong,low,10,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,1,ly_gross_revenue_amount
mathematical_relationship,cy_gross_revenue_amount_k,['cy_gross_revenue_amount'],Current Year Gross Revenue Amount (in '000s) is derived directly from Current Year Gross Revenue Amount by dividing by 1000.,cy_gross_revenue_amount_k = cy_gross_revenue_amount / 1000,Ensures consistent scaling for presentation of large numbers.,SELECT SUM(cy_gross_revenue_amount_k * 1000) = SUM(cy_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE cy_gross_revenue_amount IS NOT NULL;,strong,low,10,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,1,cy_gross_revenue_amount
dependency,ly_gross_revenue_amount_conditional_date,"['ly_gross_revenue_amount', 'fix_date_lod_calculated', 'booking_created_date']","This metric is a subset of Last Year Gross Revenue Amount, further filtered by a complex date condition involving `fix_date_lod` or `booking_created_date` relative to a hardcoded future date.",ly_gross_revenue_amount_conditional_date <= ly_gross_revenue_amount,The conditional date metric should always be less than or equal to the total Last Year Gross Revenue Amount.,SELECT SUM(ly_gross_revenue_amount_conditional_date) <= SUM(ly_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE ly_gross_revenue_amount IS NOT NULL;,strong,medium,10,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,3,"ly_gross_revenue_amount, fix_date_lod_calculated, booking_created_date"
filter_impact,total_gross_revenue_amount,['Sales_Group'],"All revenue metrics are filtered by `Sales_Group = 'Client'`, as observed in Query 1. This significantly narrows the scope of the dashboard's analysis.",N/A,"Confirms that the dashboard focuses specifically on 'Client' sales performance, excluding 'MRCA' or other sales groups.",SELECT COUNTIF(Sales_Group = 'Client') / COUNT(*) AS client_sales_ratio FROM (/* primary_analysis_sql here */); -- Should be 1.0 if filter is applied correctly.,strong,high,10,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,1,Sales_Group
filter_impact,total_adsales_revenue,"['financial_year', 'financial_week', 'revenue_group_subtype']","The 'Total AdSales Revenue' is directly impacted by the filters applied to 'Financial Year', 'Financial Week', and 'Revenue Group Subtype'. These dimensions act as contextual filters for the revenue metric.",SUM(Revenue) WHERE Financial_Year IN (...) AND Financial_Week NOT IN (...) AND Revenue_Group_Subtype IN (...),"Ensures that the reported revenue aligns with specific reporting periods and business segments, crucial for accurate pacing analysis.","SELECT
  SUM(SAFE_CAST(t0.revenue AS NUMERIC)) AS filtered_revenue,
  (SELECT SUM(SAFE_CAST(t1.revenue AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t1) AS total_unfiltered_revenue
FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0
WHERE
  SAFE_CAST(t0.financial_year AS STRING) IN ('2025', '2024')
  AND (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR t0.financial_week IS NULL)
  AND t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'
LIMIT 1;",strong,high,11,3ee20092-1897-49b7-8bcd-4157d5f816eb,3,"financial_year, financial_week, revenue_group_subtype"
dependency,customer_status_full,"['fix_ly_lgr', 'fix_ty_lgr']",The 'Customer Status Full' dimension is directly calculated based on the 'Last Year's Gross Revenue (fix_ly_lgr)' and 'This Year's Gross Revenue (fix_ty_lgr)' for each advertiser group.,N/A (conditional logic),Ensures customer segmentation aligns with defined revenue thresholds for retention analysis.,"SELECT customer_status_full, fix_ly_lgr, fix_ty_lgr FROM base_data LIMIT 100;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,2,"fix_ly_lgr, fix_ty_lgr"
dependency,fix_ly_lgr,['gross_revenue_amount'],fix_ly_lgr (Last Year's Gross Revenue) is a sum of gross_revenue_amount partitioned by advertiser_group for relative_fy_year_offset = -1.,SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group),Provides the baseline for year-over-year revenue comparison for customer retention.,"SELECT advertiser_group, SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS calculated_ly_lgr FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY advertiser_group LIMIT 100;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,1,gross_revenue_amount
dependency,fix_ty_lgr,['gross_revenue_amount'],fix_ty_lgr (This Year's Gross Revenue) is a sum of gross_revenue_amount partitioned by advertiser_group for relative_fy_year_offset = 0.,SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group),Provides the current year's revenue for comparison in customer retention logic.,"SELECT advertiser_group, SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS calculated_ty_lgr FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY advertiser_group LIMIT 100;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,1,gross_revenue_amount
dependency,blank_portfolio_flag,"['gross_revenue_amount', 'target_amount']","The 'Blank Portfolio Flag' is determined by the sum of gross revenue and target amounts (for current FY) within each portfolio, checking against a threshold (0.01).",N/A (conditional logic based on sums),"Ensures that only relevant portfolios (with significant revenue or targets) are included in certain analyses, preventing noise from empty or negligible portfolios.","SELECT portfolio_conformed_name_sync, SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) AS total_revenue_k, SUM(IF(relative_fy_year_offset = 0, target, null)) AS total_target FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY portfolio_conformed_name_sync LIMIT 100;",strong,medium,12,155c4518-72bf-4309-a0e9-240dd564f421,2,"gross_revenue_amount, target_amount"
dependency,current_year_q1_revenue_k,['gross_revenue_amount'],"Current Year Q1 Revenue (k) is a conditional sum of gross revenue amount, specifically for the current fiscal year and quarter, divided by 1000.",SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN gross_revenue_amount / 1000 ELSE NULL END),Directly measures current quarter revenue performance against targets and historical data.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS calculated_q1_revenue_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,1,gross_revenue_amount
dependency,last_year_q4_revenue_k,['gross_revenue_amount'],"Last Year Q4 Revenue (k) is a conditional sum of gross revenue amount, specifically for the previous fiscal year and its last quarter, divided by 1000.",SUM(CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN gross_revenue_amount / 1000 ELSE NULL END),Provides a historical benchmark for comparing current performance and identifying trends.,"SELECT SUM(CASE WHEN relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS calculated_ly_q4_revenue_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,1,gross_revenue_amount
dependency,current_quarter_target_k,['target_amount'],"Current Quarter Target (k) is a conditional sum of the target amount for the current fiscal quarter, divided by 1000.",SUM(CASE WHEN (relative_fy_quarter_offset = 0) THEN target / 1000 ELSE NULL END),"Measures the target set for the current quarter, crucial for performance tracking and gap analysis.","SELECT SUM(CASE WHEN relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(target, 1000) ELSE NULL END) AS calculated_q_target_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;",strong,high,12,155c4518-72bf-4309-a0e9-240dd564f421,1,target_amount
mathematical_relationship,current_fy_gross_revenue_000s,['previous_fy_gross_revenue_000s'],"Current year and previous year gross revenues are fundamentally linked for year-over-year performance analysis, typically to calculate growth percentage.",((current_fy_gross_revenue_000s - previous_fy_gross_revenue_000s) / previous_fy_gross_revenue_000s) * 100,"This relationship validates the growth or decline in ad sales performance between fiscal years, a critical business insight.","SELECT
  SAFE_DIVIDE(
    (SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) - 
     SUM(CASE WHEN relative_fy_year_offset = 1 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)),
    SUM(CASE WHEN relative_fy_year_offset = 1 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)
  ) * 100 AS yoy_growth_percentage
FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`
WHERE product_group IN ('The Australian & Prestige')
  AND SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);",strong,high,13,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,previous_fy_gross_revenue_000s
dependency,total_revenue_by_product_type,"['revenue_net_base', 'product_type_dimension']","Total Revenue by Product Type is an aggregation (sum) of Revenue Net, grouped by Product Type.",SUM(RevenueNet) GROUP BY ProductType,Ensures that revenue is correctly attributed to product categories.,"SELECT ProductType, SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY) GROUP BY ProductType LIMIT 10;",strong,high,14,b15d856f-e3ce-4991-bf2a-92395390524f,2,"revenue_net_base, product_type_dimension"
dependency,total_revenue_by_transaction_type_group,"['revenue_net_base', 'transaction_type_group_dimension']","Total Revenue by Transaction Type Group is an aggregation (sum) of Revenue Net, grouped by the derived Transaction Type Group.",SUM(RevenueNet) GROUP BY TransactionTypeGroup,Ensures that revenue is correctly categorized by programmatic deal type.,"SELECT CASE WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal' WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(TransactionType AS STRING) END AS TransactionTypeGroup, SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY) GROUP BY TransactionTypeGroup LIMIT 10;",strong,high,14,b15d856f-e3ce-4991-bf2a-92395390524f,2,"revenue_net_base, transaction_type_group_dimension"
filter_impact,total_revenue_by_product_type,['total_revenue_by_transaction_type_group'],"Both revenue metrics are implicitly filtered by a rolling 60-day window, meaning they represent revenue generated within the last 60 days. This common filter ensures consistency in the time period analyzed.",N/A,"Ensures that all reported revenue figures pertain to the same recent period, allowing for comparable analysis.","SELECT MIN(SAFE_CAST(EventDate AS DATE)), MAX(SAFE_CAST(EventDate AS DATE)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY);",strong,medium,14,b15d856f-e3ce-4991-bf2a-92395390524f,1,total_revenue_by_transaction_type_group
filter_impact,advertiser_name,"['portfolio_conformed_name_sync', 'total_sales_amount', 'total_impressions']",The `advertiser_name` dimension is filtered by specific `portfolio_conformed_name_sync` values. This filter directly impacts the set of advertisers and consequently the aggregated sales amounts and impressions shown.,N/A,"Ensures that sales performance is analyzed only for advertisers belonging to specific, predefined portfolios.","SELECT
  t0.advertiser_name,
  t0.portfolio_conformed_name_sync,
  SUM(SAFE_CAST(t0.total_sales_amount AS NUMERIC)) AS total_sales
FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0
WHERE t0.portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9')
GROUP BY t0.advertiser_name, t0.portfolio_conformed_name_sync
LIMIT 100;",strong,high,15,80ca81f3-0671-40ef-a0a9-825a1580ca1b,3,"portfolio_conformed_name_sync, total_sales_amount, total_impressions"
filter_impact,total_gross_revenue,"['revenue_transaction_status', 'source_publishing_division', 'revenue_group_subtype', 'calendar_year', 'advertiser_name', 'financial_year']","Total Gross Revenue is consistently filtered by transaction status ('Billed', 'Booked'), excluding 'Medium Rare Content Agency' division, and often restricted to specific revenue subtypes (Digital, Print), calendar years, or advertiser names. Financial year is also a common filter.","SUM(gross_revenue_amount) WHERE status IN ('Billed', 'Booked') AND division != 'Medium Rare Content Agency' AND ...",Ensures that revenue figures reflect only confirmed/expected transactions from relevant divisions and specific business segments/periods.,"SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Billed', 'Booked') AND source_publishing_division != 'Medium Rare Content Agency' LIMIT 1;",strong,high,16,c560ed20-040d-4c6a-9c3f-ec8bce27d132,6,"revenue_transaction_status, source_publishing_division, revenue_group_subtype, calendar_year, advertiser_name, financial_year"
hierarchical,advertiser_group,['advertiser_name'],Advertiser Name is a more granular dimension that rolls up into Advertiser Group.,N/A,Allows for analysis at both a detailed advertiser level and a summarized group level.,"SELECT advertiser_group, COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` GROUP BY advertiser_group LIMIT 10;",strong,medium,16,c560ed20-040d-4c6a-9c3f-ec8bce27d132,1,advertiser_name
hierarchical,calendar_year,"['calendar_month', 'numeric_calendar_month']","Calendar Month and Numeric Calendar Month are components of Calendar Year, providing finer granularity for date-based analysis.",N/A,Enables drilling down from annual to monthly trends.,"SELECT SAFE_CAST(calendar_year AS INT64), SAFE_CAST(calendar_month AS INT64), COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` GROUP BY 1,2 ORDER BY 1 DESC, 2 DESC LIMIT 12;",strong,high,16,c560ed20-040d-4c6a-9c3f-ec8bce27d132,2,"calendar_month, numeric_calendar_month"
mathematical_relationship,current_fy_gross_revenue,"['gross_revenue_amount', 'relative_fy_year_offset']","Current Fiscal Year Gross Revenue is a subset of Gross Revenue Amount, filtered by the relative fiscal year offset being 0.",Current FY Gross Revenue = SUM(Gross Revenue Amount WHERE relative_fy_year_offset = 0),Ensures that only revenue pertaining to the current fiscal period is aggregated.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);",strong,high,17,fed70b12-c274-4cde-9920-592ca4c4dab0,2,"gross_revenue_amount, relative_fy_year_offset"
mathematical_relationship,previous_fy_gross_revenue,"['gross_revenue_amount', 'relative_fy_year_offset']","Previous Fiscal Year Gross Revenue is a subset of Gross Revenue Amount, filtered by the relative fiscal year offset being -1.",Previous FY Gross Revenue = SUM(Gross Revenue Amount WHERE relative_fy_year_offset = -1),Enables accurate year-over-year comparisons for revenue performance.,"SELECT SUM(CASE WHEN relative_fy_year_offset = -1 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) AND SAFE_CAST(booking_line_created_date AS DATE) < DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);",strong,high,17,fed70b12-c274-4cde-9920-592ca4c4dab0,2,"gross_revenue_amount, relative_fy_year_offset"
filter_impact,current_fy_gross_revenue,['revenue_group_subtype'],All revenue metrics derived from `sbx_dcp.ia` exclude 'PROGRAMMATIC EXCHANGE' revenue group subtype.,N/A,"Ensures that programmatic exchange revenue is not included in the reported figures, aligning with specific business reporting needs.","SELECT COUNT(*) AS total_records, SUM(CASE WHEN revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END) AS programmatic_records FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);",strong,high,17,fed70b12-c274-4cde-9920-592ca4c4dab0,1,revenue_group_subtype
filter_impact,gross_amount_difference,"['movement_financial_week', 'min_week']",Gross Amount Difference excludes records where `movement_financial_week` is equal to `min_week`.,N/A,"This filter likely excludes initial or baseline week data from the movement calculation, focusing on changes after a certain point.","SELECT COUNT(*) AS total_records, SUM(CASE WHEN SAFE_CAST(movement_financial_week AS INT64) = SAFE_CAST(min_week AS INT64) THEN 1 ELSE 0 END) AS min_week_records FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);",strong,medium,17,fed70b12-c274-4cde-9920-592ca4c4dab0,2,"movement_financial_week, min_week"
filter_impact,unique_acquisitions_total,['unique_acquisitions_by_specific_filters'],"The 'Unique Acquisitions by Specific Filters' metric is a subset of 'Total Unique Acquisitions', applying additional granular filters on rate plan, subscriber ID, and source masthead prefix.",Unique Acquisitions by Specific Filters <= Total Unique Acquisitions,This relationship ensures that the specific acquisition count never exceeds the total acquisition count for the same base period and masthead/movement type.,"SELECT
  (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition') AS total_acquisitions,
  (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS') AS specific_acquisitions,
  CASE WHEN (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition') >= (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS') THEN 'PASS' ELSE 'FAIL' END AS validation_result
LIMIT 1;",strong,high,18,6e8b534b-485a-48dd-842d-13dc6bebb01a,1,unique_acquisitions_by_specific_filters
dependency,calculated_volume_q3,"['forecast_volume', 'publication_type_q3']","Calculated Volume (Q3) is derived from Forecast Volume, adjusted based on the publication's type (e.g., 6-day pubs, PNG). It also implicitly depends on a hardcoded selection of 'Forecast_Volume' over other volume types.",Calculated_Volume = SUM(CASE WHEN publication_type = 'PNG' THEN 0 WHEN publication_type = '6 Day Pubs' THEN Forecast_Volume / 6 ELSE Forecast_Volume / 7 END),"Ensures volume is normalized correctly for different publication models. The hardcoded selection of Forecast_Volume means this metric always reflects the forecast, not actuals or budget.","SELECT SUM(CASE WHEN publication_type_q3 = 'PNG' THEN 0 WHEN publication_type_q3 = '6 Day Pubs' THEN SAFE_DIVIDE(SAFE_CAST(selected_volume_for_calc AS NUMERIC), 6) ELSE SAFE_DIVIDE(SAFE_CAST(selected_volume_for_calc AS NUMERIC), 7) END) AS re_calculated_volume_q3, SUM(SAFE_CAST(calculated_volume_q3 AS NUMERIC)) AS original_calculated_volume_q3 FROM CalculatedMetrics WHERE is_current_period_q3 = TRUE AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' AND publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') GROUP BY 1,2 LIMIT 100;",strong,high,20,2104a3f5-9424-4087-a928-e67fecae789a,2,"forecast_volume, publication_type_q3"
dependency,calculated_volume_per_day_q3,"['forecast_volume', 'publication_name', 'day_of_week_category', 'publication_type_q3']","Calculated Volume Per Day (Q3) is a highly conditional metric, adjusting Forecast Volume based on specific publication names (Courier Mail, Australian, Sportsman, Weekly Times), day of week, and publication type (PNG). It involves complex division factors.",Calculated_Volume_Per_Day = SUM(CASE WHEN (is_the_australian OR is_courier_mail) THEN (IF day_of_week_category = 'M-F' THEN Forecast_Volume / (fy_month_or_48 * 5) * 5 ELSE Forecast_Volume / fy_month_or_48 END) WHEN publication_name = 'The Sportsman' THEN Forecast_Volume / (fy_month_or_48 * 2) * 5 WHEN publication_name = 'Weekly Times' THEN Forecast_Volume / fy_month_or_48 * 5 WHEN publication_type = 'PNG' THEN 0 WHEN day_of_week_category = 'M-F' THEN Forecast_Volume / (fy_month_or_48 * 5) * 5 ELSE Forecast_Volume / fy_month_or_48 END),"Provides a highly tailored daily volume metric, reflecting specific business rules for different publications and days. Critical for detailed performance analysis but prone to errors if rules change.","SELECT SUM(CASE WHEN (is_the_australian OR is_courier_mail) THEN (CASE WHEN day_of_week_category = 'M-F' THEN SAFE_CAST(mf_volume_calc AS NUMERIC) ELSE SAFE_CAST(default_volume_calc AS NUMERIC) END) WHEN publication_name = 'The Sportsman' THEN SAFE_CAST(sportsman_volume_calc AS NUMERIC) WHEN publication_name = 'Weekly Times' THEN SAFE_CAST(weekly_times_volume_calc AS NUMERIC) WHEN publication_type_q3 = 'PNG' THEN 0 WHEN day_of_week_category = 'M-F' THEN SAFE_CAST(mf_volume_calc AS NUMERIC) ELSE SAFE_CAST(default_volume_calc AS NUMERIC) END) AS re_calculated_volume_per_day_q3, SUM(SAFE_CAST(calculated_volume_per_day_q3 AS NUMERIC)) AS original_calculated_volume_per_day_q3 FROM CalculatedMetrics WHERE is_current_period_q3 = TRUE AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' AND publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') GROUP BY 1,2 LIMIT 100;",strong,high,20,2104a3f5-9424-4087-a928-e67fecae789a,4,"forecast_volume, publication_name, day_of_week_category, publication_type_q3"
filter_impact,actual_amount,"['volume', 'calculated_volume_q3', 'calculated_volume_per_day_q3', 'budget_volume', 'forecast_volume', 'last_year_volume']","All primary metrics are heavily filtered by common business rules: 'CIRCULATION' `os_level_6`, 'FY2025' `gl_hierarchy_code`, exclusion of specific publications ('Free News & Lifestyle', 'Food', 'Prestige', 'Weekly Times', 'Sunshine Coast', 'Mackay'), and 'All Sales Channels' `os_level_7`. The period control filter ('CP', 'PY') also applies to the base data.",N/A,Ensures that all reported metrics are consistent and apply to the defined 'Circulation Performance' scope. Any change in these filters will affect all metrics.,"SELECT COUNT(*) FROM OSandFACT WHERE upper(os_level_6) = 'CIRCULATION' AND l04_publication_code <> 'Free News & Lifestyle' AND l06_publication_code NOT IN ('Food', 'Prestige') AND gl_hierarchy_code = 'FY2025' AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' LIMIT 1;",strong,high,20,2104a3f5-9424-4087-a928-e67fecae789a,6,"volume, calculated_volume_q3, calculated_volume_per_day_q3, budget_volume, forecast_volume, last_year_volume"
filter_impact,total_gross_revenue_amount,"['revenue_transaction_status', 'source_publishing_division', 'invoice_number', 'source_system_code', 'financial_year']","The 'Total Gross Revenue Amount' is directly impacted by filters on transaction status, publishing division, invoice number, source system, and financial year. Only 'Booked' or 'Billed' transactions, excluding 'Medium Rare Content Agency' division, with invoice number '-1', from 'PLUTO', 'CPQ', or 'ADPT' systems, and in '2025' financial year are included.",SUM(gross_revenue_amount) WHERE [filters apply],Ensures that revenue reported aligns with specific business rules for recognition and source.,"SELECT SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) AND t0.invoice_number = '-1' AND t0.source_system_code IN ('PLUTO', 'CPQ', 'ADPT') AND t0.financial_year = '2025' THEN t0.gross_revenue_amount ELSE 0 END) AS filtered_revenue, SUM(t0.gross_revenue_amount) AS total_unfiltered_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0 WHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);",strong,high,21,77c68c35-20ce-477a-b216-0c781d43a8ca,5,"revenue_transaction_status, source_publishing_division, invoice_number, source_system_code, financial_year"
filter_impact,record_count_os_level_5,['fiscal_week_id'],"The 'Record Count by OS Level 5' is directly impacted by the filter on 'Fiscal Week ID'. Only records from specific fiscal weeks ('202548', '202549', '202550', '202551') are included in the count.",COUNT(1) WHERE [fiscal_week_id filter applies],"Ensures that the record count reflects activity within a specific, defined fiscal period.","SELECT COUNT(CASE WHEN t0.fiscal_week_id IN ('202548', '202549', '202550', '202551') THEN 1 ELSE 0 END) AS filtered_count, COUNT(1) AS total_unfiltered_count FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement` AS t0 WHERE SAFE_CAST(SUBSTR(t0.fiscal_week_id, 1, 4) AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR));",strong,medium,21,77c68c35-20ce-477a-b216-0c781d43a8ca,1,fiscal_week_id
filter_impact,data_load_datetime_truncated,['unified_publication_gl_code'],"The 'Data Load Datetime (Truncated to Second)' dimension is filtered by 'Unified Publication GL Code'. Only data load events associated with specific GL codes ('9707', '9655', '9658') are displayed.","DATETIME_TRUNC(data_load_datetime, SECOND) WHERE [unified_publication_gl_code filter applies]",Focuses data load analysis on specific publication types or business units.,"SELECT COUNT(CASE WHEN t0.unified_publication_gl_code IN ('9707', '9655', '9658') THEN 1 ELSE 0 END) AS filtered_records, COUNT(1) AS total_unfiltered_records FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0 WHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);",strong,low,21,77c68c35-20ce-477a-b216-0c781d43a8ca,1,unified_publication_gl_code
dependency,total_digital_gross_amount_diff,"['total_gross_amount_diff', 'revenue_type']","Total Digital Gross Amount Difference is a subset of Total Gross Amount Difference, filtered by 'DIGITAL' revenue type.",Total Digital Gross Amount Diff = SUM(GROSS_AMOUNT_DIFF WHERE revenue_type = 'DIGITAL'),Ensures that digital revenue is correctly isolated for specific analysis.,"SELECT SUM(CASE WHEN revenue_type = 'DIGITAL' THEN SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) ELSE 0 END) AS digital_sum, SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) AS total_sum FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);",strong,high,22,a1b901e6-c4fb-44bc-955a-3d7070c15829,2,"total_gross_amount_diff, revenue_type"
dependency,total_print_gross_amount_diff,"['total_gross_amount_diff', 'revenue_type']","Total Print Gross Amount Difference is a subset of Total Gross Amount Difference, filtered by 'PRINT' revenue type.",Total Print Gross Amount Diff = SUM(GROSS_AMOUNT_DIFF WHERE revenue_type = 'PRINT'),Ensures that print revenue is correctly isolated for specific analysis.,"SELECT SUM(CASE WHEN revenue_type = 'PRINT' THEN SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) ELSE 0 END) AS print_sum, SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) AS total_sum FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);",strong,high,22,a1b901e6-c4fb-44bc-955a-3d7070c15829,2,"total_gross_amount_diff, revenue_type"
dependency,revenue_category,"['xtend_flag', 'revenue_sub_type', 'portfolio_parent_group_name_sync']",Revenue Category is a derived dimension based on a complex set of conditional rules involving multiple source columns.,Categorical assignment based on nested CASE WHEN logic.,Ensures that revenue is classified according to predefined business rules for reporting and analysis.,"SELECT revenue_category, COUNT(*) AS record_count FROM (
  SELECT
    xtend_flag,
    portfolio_parent_group_name_sync,
    revenue_sub_type,
    CASE
      WHEN (xtend_flag = 'Y') THEN 'XTEND'
      WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO') OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'
      WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'
      WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') THEN 'SUNDRY'
      ELSE revenue_sub_type
    END AS revenue_category
  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`
  WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
) GROUP BY revenue_category ORDER BY revenue_category;",strong,high,22,a1b901e6-c4fb-44bc-955a-3d7070c15829,3,"xtend_flag, revenue_sub_type, portfolio_parent_group_name_sync"
dependency,financial_period_numeric,"['financial_year', 'financial_month_number']",Financial Period (Numeric) is calculated directly from Financial Year and Financial Month Number.,Financial Period (Numeric) = (FinancialYear * 100) + FinancialMonthNumber,Ensures a consistent numeric representation of each financial period.,"SELECT ((FinancialYear * 100) + FinancialMonthNumber) AS calculated_period, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` LIMIT 10;",strong,low,23,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"financial_year, financial_month_number"
dependency,financial_period_display_kargo,"['static_days', 'financial_period_numeric']",Financial Period (Kargo Display) is a string concatenation of Static Days and Financial Period (Numeric).,"CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(FinancialPeriodNumeric AS STRING), ' )')",Forms the user-friendly display for the Kargo filter.,"SELECT CONCAT(SAFE_CAST(StaticDays AS STRING), CONCAT(' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)), ' )') AS display_string, StaticDays, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE Source = 'Kargo' LIMIT 10;",strong,medium,23,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"static_days, financial_period_numeric"
dependency,financial_period_display_non_adx,"['num_days', 'financial_period_numeric']",Financial Period (Non-AdX Display) is a string concatenation of Num Days and Financial Period (Numeric).,"CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(FinancialPeriodNumeric AS STRING), ' )')",Forms the user-friendly display for the Non-AdX filter.,"SELECT CONCAT(SAFE_CAST(NumDays AS STRING), CONCAT(' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)), ' )') AS display_string, NumDays, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE (Source NOT IN ('AdX') OR Source IS NULL) LIMIT 10;",strong,medium,23,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"num_days, financial_period_numeric"
filter_impact,financial_period_display_kargo,"['current_month_flag', 'source_dimension']",The 'Financial Period (Kargo Display)' filter is constrained by 'CurrentMonthFlag = 1' and 'Source = 'Kargo''.,N/A,Ensures that the filter only shows relevant financial periods for the 'Kargo' source in the current month.,SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND Source = 'Kargo';,strong,high,23,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"current_month_flag, source_dimension"
filter_impact,financial_period_display_non_adx,"['current_month_flag', 'source_dimension']",The 'Financial Period (Non-AdX Display)' filter is constrained by 'CurrentMonthFlag = 1' and 'Source NOT IN ('AdX') OR Source IS NULL'.,N/A,Ensures that the filter only shows relevant financial periods for non-'AdX' sources in the current month.,SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL);,strong,high,23,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"current_month_flag, source_dimension"
mathematical_relationship,current_fy_gross_revenue_k,['current_fy_gross_revenue'],Current FY Gross Revenue (Thousands) is Current FY Gross Revenue divided by 1000.,current_fy_gross_revenue_k = current_fy_gross_revenue / 1000,Ensures consistency in reporting units (thousands vs. full amount).,"SELECT SUM(CASE WHEN SAFE_DIVIDE(current_fy_gross_revenue, 1000) = current_fy_gross_revenue_k THEN 1 ELSE 0 END) / COUNT(*) AS consistency_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE)",strong,high,24,4d8074b2-17a8-48ba-babe-c536359b1f64,1,current_fy_gross_revenue
mathematical_relationship,current_fy_gross_revenue_minus_ss_lgb_k,"['current_fy_gross_revenue_k', 'current_fy_ss_lgb_k']",Current FY Gross Revenue - SS_LGB (Thousands) is the difference between Current FY Gross Revenue (Thousands) and Current FY SS_LGB (Thousands).,current_fy_gross_revenue_minus_ss_lgb_k = current_fy_gross_revenue_k - current_fy_ss_lgb_k,"Represents a net or adjusted revenue figure, crucial for specific profitability or efficiency analyses.",SELECT SUM(CASE WHEN (current_fy_gross_revenue_k - current_fy_ss_lgb_k) = current_fy_gross_revenue_minus_ss_lgb_k THEN 1 ELSE 0 END) / COUNT(*) AS consistency_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE),strong,medium,24,4d8074b2-17a8-48ba-babe-c536359b1f64,2,"current_fy_gross_revenue_k, current_fy_ss_lgb_k"
filter_impact,previous_fy_gross_revenue_filtered_by_date,['previous_fy_gross_revenue'],"The 'filtered by date' metric is a subset of the total previous FY gross revenue, applying a complex date and categorical filter. It's designed for a specific 'like-for-like' comparison.",previous_fy_gross_revenue_filtered_by_date <= previous_fy_gross_revenue,"Ensures that the filtered metric correctly represents a specific, comparable segment of the previous year's revenue, often for digital or specific booking types.",SELECT SUM(CASE WHEN previous_fy_gross_revenue_filtered_by_date <= previous_fy_gross_revenue THEN 1 ELSE 0 END) / COUNT(*) AS subset_validation_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE),strong,high,24,4d8074b2-17a8-48ba-babe-c536359b1f64,1,previous_fy_gross_revenue
hierarchical,financial_year,"['financial_quarter_int', 'financial_short_month', 'financial_short_month_formatted']","Financial Year is the highest level in the time hierarchy, containing Financial Quarters and Financial Months.",N/A,Ensures proper drill-down and aggregation across time dimensions.,"SELECT COUNT(DISTINCT financial_quarter_int) AS distinct_quarters_in_year, COUNT(DISTINCT financial_short_month) AS distinct_months_in_year FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE) GROUP BY financial_year LIMIT 10",strong,high,24,4d8074b2-17a8-48ba-babe-c536359b1f64,3,"financial_quarter_int, financial_short_month, financial_short_month_formatted"
dependency,financial_short_month_formatted,['financial_short_month'],Financial Short Month (Formatted) is directly derived from Financial Short Month for sorting purposes.,N/A,Ensures correct chronological ordering of months in reports.,"SELECT financial_short_month, financial_short_month_formatted, COUNT(*) FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE) GROUP BY 1,2 ORDER BY 2 LIMIT 12",strong,medium,24,4d8074b2-17a8-48ba-babe-c536359b1f64,1,financial_short_month
dependency,revenue_type_adjusted_for_xtend,"['revenue_type', 'xtend_flag']","`revenue_type_adjusted_for_xtend` is derived from `revenue_type` and `xtend_flag`. If `xtend_flag` is 'Y', it becomes 'XTEND', otherwise it retains its original `revenue_type`.",IF xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type,Ensures that XTEND-related revenue is correctly identified and separated from other revenue types for specific reporting needs.,"SELECT COUNTIF(CASE WHEN xtend_flag = 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN TRUE WHEN xtend_flag != 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = revenue_type THEN TRUE ELSE FALSE END) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')",strong,high,25,61f1feb4-fc3e-4bee-b987-84c86cfe6425,2,"revenue_type, xtend_flag"
dependency,revenue_group_category,['revenue_type_adjusted_for_xtend'],"`revenue_group_category` is derived from `revenue_type_adjusted_for_xtend` by mapping specific values to broader categories like 'DIGITAL (excl.XTEND)', 'PRINT', and 'XTEND ONLY'.",IF revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ELSE IF revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' ELSE IF revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL,"Provides a high-level, business-friendly categorization of revenue streams, essential for dashboard filtering and summary views.","SELECT COUNTIF(CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'DIGITAL (excl.XTEND)' THEN TRUE WHEN revenue_type_adjusted_for_xtend = 'PRINT' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'PRINT' THEN TRUE WHEN revenue_type_adjusted_for_xtend = 'XTEND' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'XTEND ONLY' THEN TRUE ELSE FALSE END) / COUNT(*) FROM (SELECT *, CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_adjusted_for_xtend FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025'))",strong,high,25,61f1feb4-fc3e-4bee-b987-84c86cfe6425,1,revenue_type_adjusted_for_xtend
filter_impact,financial_year,"['revenue_amount', 'ad_impressions', 'unified_publication_name', 'revenue_group_subtype', 'revenue_group_category']","The dashboard queries are explicitly filtered by `financial_year` ('2024', '2025'), limiting all displayed metrics and dimensions to these specific periods.",N/A,"Ensures that the dashboard focuses on the most relevant and current financial periods for analysis, aligning with business planning cycles.","SELECT COUNTIF(financial_year IN ('2024', '2025')) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`",strong,high,25,61f1feb4-fc3e-4bee-b987-84c86cfe6425,5,"revenue_amount, ad_impressions, unified_publication_name, revenue_group_subtype, revenue_group_category"
filter_impact,revenue_group_subtype,"['revenue_amount', 'ad_impressions', 'unified_publication_name', 'revenue_group_category']","Metrics are filtered to include only specific `revenue_group_subtype` values: 'DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE'.",N/A,"Focuses the dashboard on key digital and programmatic revenue channels, excluding other types like print, which might be covered in other reports.","SELECT COUNTIF(revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')",strong,high,25,61f1feb4-fc3e-4bee-b987-84c86cfe6425,4,"revenue_amount, ad_impressions, unified_publication_name, revenue_group_category"
filter_impact,revenue_group_category,"['revenue_amount', 'ad_impressions', 'unified_publication_name', 'revenue_group_subtype']",Metrics are further filtered by `revenue_group_category` to include only 'DIGITAL (excl.XTEND)' (based on the original query's 'digital' filter).,N/A,"Narrows the scope to specific digital revenue categories, which is critical for a dashboard titled 'Digital - Publications and Products Monthly'.","SELECT COUNTIF(LOWER(CASE WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'digital (excl.xtend)') / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')",strong,high,25,61f1feb4-fc3e-4bee-b987-84c86cfe6425,4,"revenue_amount, ad_impressions, unified_publication_name, revenue_group_subtype"
mathematical_relationship,actual_amount_sum,"['budget_amount_sum', 'forecast_amount_sum']",Actual Amount is compared against Budget Amount and Forecast Amount to calculate variances and assess performance.,Variance_vs_Budget = Actual_Amount - Budget_Amount; Variance_vs_Forecast = Actual_Amount - Forecast_Amount,"These variances are critical for financial performance review, identifying deviations from plans, and informing future financial strategies.","SELECT
  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) AS total_actual,
  SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS total_budget,
  SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS total_forecast,
  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS variance_actual_budget,
  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS variance_actual_forecast
FROM
  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`
WHERE
  SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000
LIMIT 1;",strong,high,26,b1c5901f-a535-42eb-870d-05cc025f7c27,2,"budget_amount_sum, forecast_amount_sum"
filter_impact,actual_amount_sum,"['fiscal_year_hierarchy_code', 'fiscal_week_of_year', 'os_level_4', 'l03_publication_code', 'os_level_6']","All financial metrics (Actual, Budget, Forecast) are heavily filtered by specific fiscal periods and OS/publication categories, indicating a focused reporting scope.",N/A,"The dashboard is designed to provide a 'month-end reconciliation' view for specific, pre-defined financial segments and time periods. Changes to these filters would significantly alter the reported figures.","SELECT
  COUNT(*) AS total_records,
  SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' THEN 1 ELSE 0 END) AS records_fy2025,
  SUM(CASE WHEN SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END) AS records_week40,
  SUM(CASE WHEN SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) AS records_revenue_expenses
FROM
  (
    SELECT
      t0.gl_hierarchy_code,
      calendar.fy_week_of_year,
      t0.os_level_4
    FROM
      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0
    LEFT JOIN
      (
        SELECT DISTINCT
          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,
          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number
        FROM
          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c
        JOIN
          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control
          ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')
      ) AS calendar
      ON SAFE_CAST(t0.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)
    WHERE
      SAFE_CAST(t0.fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000
  )
LIMIT 1;",strong,high,26,b1c5901f-a535-42eb-870d-05cc025f7c27,5,"fiscal_year_hierarchy_code, fiscal_week_of_year, os_level_4, l03_publication_code, os_level_6"
co_occurrence,total_paid_impressions,"['total_revenue_gross', 'advertiser_dimension', 'month_start_date_dimension', 'source_dimension', 'transaction_type_dimension']","Total Paid Impressions and Total Revenue Gross are frequently analyzed together, often alongside Advertiser, Source, Transaction Type, and Month Start Date, to understand campaign effectiveness and financial performance.","N/A (no explicit formula in queries, but common business ratios like RPM (Revenue Per Mille Impressions) could be derived)","These metrics are fundamental for evaluating the success and profitability of programmatic advertising efforts. Analyzing them together helps identify high-performing advertisers, sources, and transaction types.","SELECT month_start_date_dimension, advertiser_dimension, SUM(total_paid_impressions) AS total_impressions, SUM(total_revenue_gross) AS total_revenue FROM ( /* primary_analysis_sql content */ ) GROUP BY 1,2 HAVING SUM(total_paid_impressions) > 0 AND SUM(total_revenue_gross) > 0 LIMIT 10;",strong,high,27,87651b69-c43e-471f-9c4b-98df1208a844,5,"total_revenue_gross, advertiser_dimension, month_start_date_dimension, source_dimension, transaction_type_dimension"
filter_impact,distinct_sales_segments_q1_scope,"['fin_adtype_name', 'revenue_transaction_status', 'source_publishing_division']","The count of distinct sales segments is directly impacted by specific filters on ad type, transaction status, and publishing division. Changes to these filter criteria will alter the resulting count.",N/A,"Ensures that sales segment analysis is focused on relevant, active ad sales from specific product categories and divisions.","SELECT COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') LIMIT 1;",strong,high,28,f65a9149-93b4-4aa9-aef6-d12002853222,3,"fin_adtype_name, revenue_transaction_status, source_publishing_division"
filter_impact,distinct_booking_numbers_q2_scope,"['fin_adtype_name', 'financial_year']","The count of distinct booking numbers is directly impacted by specific filters on ad type (Content Discovery, Native) and financial year (2025, 2026).",N/A,Ensures that booking volume analysis is focused on specific ad product types and relevant future financial periods.,"SELECT COUNT(DISTINCT SAFE_CAST(booking_number AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(fin_adtype_name AS STRING) IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND SAFE_CAST(financial_year AS STRING) IN ('2026', '2025') LIMIT 1;",strong,high,28,f65a9149-93b4-4aa9-aef6-d12002853222,2,"fin_adtype_name, financial_year"
filter_impact,distinct_ad_sizes_q3_scope,"['fin_adtype_name', 'revenue_transaction_status', 'source_publishing_division', 'financial_year']","The count of distinct ad sizes is directly impacted by specific filters on ad type, transaction status, publishing division, and financial year (2025).",N/A,"Ensures that ad size variety analysis is focused on relevant, active ad sales from specific product categories and divisions for a particular financial year.","SELECT COUNT(DISTINCT SAFE_CAST(adsize_name AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND SAFE_CAST(financial_year AS STRING) = '2025' LIMIT 1;",strong,high,28,f65a9149-93b4-4aa9-aef6-d12002853222,4,"fin_adtype_name, revenue_transaction_status, source_publishing_division, financial_year"
mathematical_relationship,total_records_count,['count_by_scenario'],The 'Total Records Count' is the sum of 'Count by Scenario' across all distinct scenarios.,total_records_count = SUM(count_by_scenario),Ensures data consistency by verifying that the sum of records broken down by scenario equals the overall total record count.,"WITH scenario_counts AS (
  SELECT
    SAFE_CAST(scenario AS STRING) as scenario_dimension,
    COUNT(1) AS count_by_scenario
  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`
  GROUP BY 1
),
total_count AS (
  SELECT COUNT(1) AS total_records FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`
)
SELECT
  'Metric Interaction Validation' as validation_type,
  (SELECT SUM(count_by_scenario) FROM scenario_counts) as sum_of_scenario_counts,
  (SELECT total_records FROM total_count) as overall_total_count,
  CASE WHEN (SELECT SUM(count_by_scenario) FROM scenario_counts) = (SELECT total_records FROM total_count) THEN 'PASS' ELSE 'FAIL' END as consistency_check
LIMIT 1;",strong,high,29,52dd1ac1-19b5-4695-a7e6-632ef7a9dba3,1,count_by_scenario
filter_impact,publication_date_filtered,"['total_booked_value_inferred', 'total_impressions_inferred']","The filters applied to `publication_date_filtered` (financial year, month, portfolio, employee, advertiser) will directly impact the aggregated values of `total_booked_value_inferred` and `total_impressions_inferred` when these dimensions are used for grouping or filtering.",N/A (filter relationship),Ensures that financial and volume metrics are reported within the specific business contexts defined by the filters.,N/A,strong,high,30,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"total_booked_value_inferred, total_impressions_inferred"
filter_impact,agency_group_filtered,"['total_booked_value_inferred', 'total_impressions_inferred']","The filters applied to `agency_group_filtered` (financial month, financial year exclusion, publication name) will directly impact the aggregated values of `total_booked_value_inferred` and `total_impressions_inferred` when these dimensions are used for grouping or filtering.",N/A (filter relationship),Ensures that financial and volume metrics are reported for specific agency groups and publications as defined by the filters.,N/A,strong,high,30,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"total_booked_value_inferred, total_impressions_inferred"
dependency,day_of_week_display,[],"This metric is a direct transformation of the `dow` (day of week) column from the source table, primarily for display and sorting purposes.",N/A (transformation),Ensures consistent ordering of days of the week across reports.,N/A,strong,low,30,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,0,
mathematical_relationship,gross_revenue_amount,"['gross_revenue_ex_adj_amount', 'adjustment_amount']",Gross Revenue Amount is the sum of Gross Revenue Excluding Adjustment and Adjustment Amount. This indicates how adjustments impact the total reported gross revenue.,Gross Revenue Amount = Gross Revenue Excl. Adjustment + Adjustment Amount,This relationship ensures that all revenue components are accounted for and provides a clear audit trail for how gross revenue is derived from its constituent parts. It's fundamental for financial accuracy.,"SELECT
  SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS total_gross_revenue,
  SUM(SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC)) AS total_gross_revenue_ex_adj,
  SUM(SAFE_CAST(t0.adjustment_amount AS NUMERIC)) AS total_adjustment_amount,
  CASE
    WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) = SUM(SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC)) + SUM(SAFE_CAST(t0.adjustment_amount AS NUMERIC))
    THEN 'PASS'
    ELSE 'FAIL'
  END AS relationship_check
FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0
WHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))
LIMIT 1;",strong,high,31,a17622e2-ad43-49cc-b3c5-19c95036fd14,2,"gross_revenue_ex_adj_amount, adjustment_amount"
mathematical_relationship,current_fy_gross_revenue,"['gross_revenue_amount', 'relative_fy_year_offset']","Current FY Gross Revenue is a subset of Gross Revenue Amount, specifically for records where the fiscal year offset is 0 (current year).","Current_FY_Gross_Revenue = SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))",Ensures that current year performance is accurately isolated from other fiscal periods.,"SELECT SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0)) AS current_fy_sum, SUM(gross_revenue_amount) AS total_gross_revenue FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 0;",strong,high,32,52c11c9c-052a-4e45-9cda-8fecd87d7964,2,"gross_revenue_amount, relative_fy_year_offset"
mathematical_relationship,next_fy_gross_revenue,"['gross_revenue_amount', 'relative_fy_year_offset']","Next FY Gross Revenue is a subset of Gross Revenue Amount, specifically for records where the fiscal year offset is 1 (next year).","Next_FY_Gross_Revenue = SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0))",Provides insight into future revenue bookings and pipeline.,"SELECT SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0)) AS next_fy_sum, SUM(gross_revenue_amount) AS total_gross_revenue FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 1;",strong,high,32,52c11c9c-052a-4e45-9cda-8fecd87d7964,2,"gross_revenue_amount, relative_fy_year_offset"
filter_impact,gross_revenue_amount,"['revenue_transaction_status_code', 'style_name', 'source_publishing_division_name', 'publication_name', 'advertiser_id_src', 'ad_type_name']","All revenue metrics are filtered to include only 'BILLED' or 'BOOKED' transactions, exclude 'ROP COMPOSITE' style, 'MEDIUM RARE CONTENT AGENCY' division, and apply specific rules for 'SUDDENLY%' publications.",N/A,"Ensures that reported revenue is based on valid and relevant transactions, excluding specific internal or non-revenue generating items.","SELECT COUNT(*) AS total_records, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS valid_status_records, SUM(CASE WHEN UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' THEN 1 ELSE 0 END) AS valid_style_records FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` LIMIT 1000;",strong,high,32,52c11c9c-052a-4e45-9cda-8fecd87d7964,6,"revenue_transaction_status_code, style_name, source_publishing_division_name, publication_name, advertiser_id_src, ad_type_name"
dependency,conditional_gross_revenue,"['fix_date_lod', 'booking_line_created_date', 'advertiser_parent', 'revenue_type', 'revenue_group_subtype', 'sales_segment_l_2_name_sync', 'unified_publication_name']",Conditional Gross Revenue relies on a complex set of conditions involving multiple dimensions and a derived date (`fix_date_lod`) which itself depends on `advertiser_parent` and `booking_line_created_date`.,N/A,"Highlights the specific and nuanced business rules applied to certain revenue streams, often for specialized reporting needs.","SELECT SUM(Conditional_Gross_Revenue_Amount) FROM (SELECT *, MIN(CASE WHEN advertiser_parent = ""DOUBLECLICK"" THEN SAFE_CAST(booking_line_created_date AS DATE) END) OVER (PARTITION BY financial_year) AS fix_date_lod, CASE WHEN relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') THEN gross_revenue_amount WHEN relative_fy_year_offset = 0 AND (SAFE_CAST(CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(CURRENT_DATETIME('Australia/Sydney'), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END AS Conditional_Gross_Revenue_Amount FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')) AS subquery;",strong,medium,32,52c11c9c-052a-4e45-9cda-8fecd87d7964,7,"fix_date_lod, booking_line_created_date, advertiser_parent, revenue_type, revenue_group_subtype, sales_segment_l_2_name_sync, unified_publication_name"
filter_impact,adpoint_account,"['genera_booking_account', 'medium_rare_debtor_account', 'national_debtor_account', 'account_mapping_count']","Filtering by 'Adpoint Account' (e.g., '56694') directly impacts the subset of 'Genera Booking Account', 'Medium Rare Debtor Account', and 'National Debtor Account' mappings displayed, and consequently the 'Account Mapping Count'.",N/A,"Users often need to see mappings for a specific Adpoint account, making this filter critical for targeted analysis.",SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` WHERE SAFE_CAST(Adpoint_Account AS STRING) = '56694';,strong,high,34,258a722d-9b6e-45df-ba00-1b9954ec36b2,4,"genera_booking_account, medium_rare_debtor_account, national_debtor_account, account_mapping_count"
dependency,account_mapping_count,"['adpoint_account', 'genera_booking_account', 'medium_rare_debtor_account', 'national_debtor_account']",The 'Account Mapping Count' is a direct aggregation (count) of the distinct combinations of the four account dimensions.,"COUNT(DISTINCT adpoint_account, genera_booking_account, medium_rare_debtor_account, national_debtor_account)",This count indicates the total number of unique mapping relationships present in the dataset.,"SELECT COUNT(DISTINCT Adpoint_Account, Genera_Booking_Account, Medium_Rare_Debtor_Account, National_Debtor_Account) FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`;",strong,medium,34,258a722d-9b6e-45df-ba00-1b9954ec36b2,4,"adpoint_account, genera_booking_account, medium_rare_debtor_account, national_debtor_account"
dependency,gross_revenue_amount_sum,"['advertiser_name_transformed_level2', 'sheet_account_flag', 'revenue_transaction_status_filter', 'cost_model_type_filter', 'style_name_filter', 'source_publishing_division_filter', 'publication_name_filter']",The `gross_revenue_amount_sum` is directly impacted by all listed filters and is aggregated by the transformed advertiser name and the sheet account flag.,"SUM(gross_revenue_amount) WHERE [all filters apply] GROUP BY [dimensions including transformed_advertiser_name, sheet_account_flag]",Ensures that only relevant and correctly categorized revenue is included in the Contra Report.,"SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE NOT (UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')) LIMIT 10;",strong,high,35,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,7,"advertiser_name_transformed_level2, sheet_account_flag, revenue_transaction_status_filter, cost_model_type_filter, style_name_filter, source_publishing_division_filter, publication_name_filter"
dependency,advertiser_name_transformed_level2,"['advertiser_name_transformed_level1', 'advertiser_name_original']",The final `advertiser_name_transformed_level2` is derived from `advertiser_name_transformed_level1` (which itself depends on `adpoint_account_number`) and the `advertiser_name_original`.,CASE WHEN (advertiser_name_transformed_level1 = 'ctr1') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name_original END,"This transformation consolidates specific 'contra' accounts under a single, descriptive name for reporting purposes.","SELECT adpoint_account_number, advertiser_name, CASE WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'ctr1' ELSE SAFE_CAST(adpoint_account_number AS STRING) END AS transformed_level1, CASE WHEN (CASE WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'ctr1' ELSE SAFE_CAST(adpoint_account_number AS STRING) END) = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END AS transformed_level2 FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') LIMIT 10;",strong,high,35,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,2,"advertiser_name_transformed_level1, advertiser_name_original"
dependency,sheet_account_flag,['adpoint_account_number'],The `sheet_account_flag` is determined by whether the `adpoint_account_number` exists in the `contra_sheet_data` lookup table.,CASE WHEN adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) THEN 'Y' ELSE 'N' END,This flag correctly identifies accounts that are officially designated as 'contra' based on a master list.,"SELECT t1.adpoint_account_number, CASE WHEN t1.adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) THEN 'Y' ELSE 'N' END AS calculated_flag FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t1 WHERE t1.adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) LIMIT 10;",strong,high,35,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,1,adpoint_account_number
filter_impact,total_gross_revenue,"['advertiser_name', 'financial_period_fy_q', 'fiscal_month_start_date']","The 'Total Gross Revenue' metric is filtered and aggregated based on specific combinations of 'Advertiser Name' (via PortfolioParentGroup), 'Financial Period (FY-Q)', and 'Fiscal Month Start Date' (via various filters on PortfolioParentGroup, PortfolioChildGroup, TransactionType, and a hardcoded date comparison).",SUM(RevenueGross) WHERE [specific filters from original queries],Ensures that revenue is reported for the correct segments and timeframes as defined by the business rules embedded in the dashboard queries.,"SELECT 
  SUM(CASE WHEN PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW') AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q1,
  SUM(CASE WHEN CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) = 'FY2025 - Q4' THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q2_context,
  SUM(CASE WHEN 
    DATE(FinancialYear, 
      CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) <= DATE(DATETIME(TIMESTAMP '2025-06-26 07:36:48.083696+00', 'UTC'))
    AND PortfolioParentGroup IN ('CONSORTIUM VIC')
    AND CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) IN ('FY2025 - Q4')
    AND TransactionType IN ('Deal')
    AND PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')
  THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q3_context
FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`
WHERE FinancialYear >= 2023 AND FinancialYear <= 2025;",strong,high,36,6f1c8731-02da-464f-b146-bf2947860735,3,"advertiser_name, financial_period_fy_q, fiscal_month_start_date"
dependency,fiscal_month_start_date,"['FinancialYear', 'FinancialMonthNumber']","The 'Fiscal Month Start Date' is a complex derived dimension that depends directly on the 'FinancialYear' and 'FinancialMonthNumber' columns, applying a specific fiscal month mapping logic.","DATETIME_TRUNC(DATE(FinancialYear, FiscalMonthMapping(FinancialMonthNumber), 1), MONTH)","Ensures that time-based reporting aligns with the company's internal fiscal calendar, which is critical for accurate financial analysis.","SELECT 
  FinancialYear,
  FinancialMonthNumber,
  CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END AS adjusted_month,
  SAFE_CAST(DATETIME_TRUNC(DATE(FinancialYear, CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1), MONTH) AS DATE) AS calculated_fiscal_month_start_date
FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`
WHERE FinancialYear = 2024 AND FinancialMonthNumber IS NOT NULL
LIMIT 100;",strong,high,36,6f1c8731-02da-464f-b146-bf2947860735,2,"FinancialYear, FinancialMonthNumber"
mathematical_relationship,spend_current_period,['spend_previous_year'],Year-over-year comparison of total advertising spend.,Spend_CP_YoY_Growth = (Spend_CP - Spend_PY) / Spend_PY,"Measures the growth or decline in advertising spend compared to the same period in the previous year, indicating business performance trends.","SELECT (SUM(spend_current_period) - SUM(spend_previous_year)) / NULLIF(SUM(spend_previous_year), 0) FROM your_unified_query_result",strong,high,37,e9d8a216-4950-4d30-b344-5011776edbdf,1,spend_previous_year
filter_impact,spend_current_period_newscorp,"['spend_current_period', 'media_network']","Spend for 'NEWS CORP' is a subset of total current period spend, filtered by Media_Network.",Spend_CP_NewsCorp <= Spend_CP,Highlights the contribution of 'NEWS CORP' to the overall current period advertising spend.,SELECT SUM(spend_current_period_newscorp) <= SUM(spend_current_period) FROM your_unified_query_result,strong,medium,37,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_current_period, media_network"
filter_impact,spend_previous_year_retail,"['spend_previous_year', 'major_category']","Spend for 'Retail' is a subset of total previous year spend, filtered by Major_Category.",Spend_PY_Retail <= Spend_PY,Highlights the contribution of the 'Retail' category to the overall previous year advertising spend.,SELECT SUM(spend_previous_year_retail) <= SUM(spend_previous_year) FROM your_unified_query_result,strong,medium,37,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_previous_year, major_category"
hierarchical,base_spend_amount,['media_type'],The 'Total Spend by Media Type' metric (from original query 3) is an aggregation of 'Base Spend Amount' grouped solely by 'Media Type'.,Total_Spend_by_MediaType = SUM(base_spend_amount) GROUP BY media_type,"This relationship shows how granular spend data rolls up to higher-level summaries, providing different perspectives on spend distribution.","SELECT media_type, SUM(base_spend_amount) FROM your_unified_query_result GROUP BY media_type",strong,low,37,e9d8a216-4950-4d30-b344-5011776edbdf,1,media_type
mathematical_relationship,closing_base_minus_ny_cancels,"['total_closing_base', 'total_ny_budget_cancels_qty']",Calculates the difference between the actual closing subscriber base and the next year's budgeted cancellations.,Closing_Base - NY_Budget_Cancels_Qty,This relationship helps in understanding the net impact on the subscriber base when considering future planned cancellations against the current base. It could indicate a 'net future base' or a variance.,"SELECT SUM(t0.ClosingBase - t0.NYBudgetCancelsQty) AS calculated_metric, SUM(t0.ClosingBase) - SUM(t0.NYBudgetCancelsQty) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());",strong,medium,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,2,"total_closing_base, total_ny_budget_cancels_qty"
mathematical_relationship,forecast_budget_earned_amount_k,['total_forecast_budget_earned_amount'],Scales the total forecast budget earned amount by dividing it by 1000.,Forecast_Budget_Earned_Amount / 1000,"This transformation is purely for presentation, making large monetary values more readable (e.g., in thousands).","SELECT SUM(SAFE_DIVIDE(t0.ForecastBudgetEarnedAmount, 1000)) AS calculated_metric, SAFE_DIVIDE(SUM(t0.ForecastBudgetEarnedAmount), 1000) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());",strong,low,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,1,total_forecast_budget_earned_amount
mathematical_relationship,budget_earned_amount_k,['total_budget_earned_amount'],Scales the total budget earned amount by dividing it by 1000.,Budget_Earned_Amount / 1000,"This transformation is purely for presentation, making large monetary values more readable (e.g., in thousands).","SELECT SUM(SAFE_DIVIDE(t0.BudgetEarnedAmount, 1000)) AS calculated_metric, SAFE_DIVIDE(SUM(t0.BudgetEarnedAmount), 1000) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());",strong,low,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,1,total_budget_earned_amount
filter_impact,masthead_group,"['total_budget_adds_qty', 'total_closing_base', 'total_earned_amount']",All primary metrics are filtered to exclude records where 'Masthead Group' is 'Discontinued'.,N/A (filter),"This ensures that the dashboard focuses only on active or relevant mastheads, excluding those no longer in operation or considered for analysis.","SELECT SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT CASE WHEN (gl_publication_code = 'The Australian') THEN 'The Australian' WHEN (masthead_code IN ('CM', 'DT', 'HS', 'AA') OR gl_publication_code IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros' WHEN (masthead_code IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TC', 'TB') OR gl_publication_code IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals' WHEN (gl_publication_code = 'Weekly Times') THEN 'Others' WHEN (masthead_code IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU', 'BG', 'OZ', 'NW') OR gl_publication_code IN ('Supercoach Plus', 'Code', 'Taste Online', 'Apple Podcast: Crime X', 'Racenet', 'Punters', 'Others', 'The Oz', 'news.com.au', 'Brain Games')) THEN 'Deep Niche Publications' ELSE 'Discontinued' END AS masthead_group FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));",strong,high,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,3,"total_budget_adds_qty, total_closing_base, total_earned_amount"
filter_impact,recognition_type,"['total_budget_adds_qty', 'total_closing_base', 'total_earned_amount']",All primary metrics are filtered to include only records where 'Recognition Type' is 'Digital Recognition'.,N/A (filter),"This filter ensures the dashboard focuses exclusively on digital subscription performance, aligning with the 'Digi Subsifying' theme.","SELECT SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT CASE WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition' WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition' ELSE 'Digital Recognition' END AS recognition_type FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));",strong,high,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,3,"total_budget_adds_qty, total_closing_base, total_earned_amount"
filter_impact,is_digital_platform_subscription,"['total_budget_adds_qty', 'total_closing_base', 'total_earned_amount']",All primary metrics are filtered to include only records where 'Is Digital Platform Subscription' is true.,N/A (filter),"This filter narrows the focus to subscriptions originating from key digital platforms, which is a critical segment for analysis.","SELECT SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT (dw_billing_system_code IN ('APLP', 'APLS', 'GPLA', 'SWG') OR (table_union_source = 'budgetforecast' AND rate_plan_group_name IN ('Apple Podcasts', 'Google Play', 'Subscribe with Google (SWG)', 'Apple Store'))) AS is_digital_platform_subscription FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));",strong,high,38,d05b3d29-4437-4ee5-987a-e0109eb9590e,3,"total_budget_adds_qty, total_closing_base, total_earned_amount"
mathematical_relationship,product_revenue_exclude_lod,['product_revenue_merged_one_row'],"Both metrics represent product revenue from the same source table. 'Product Revenue Merged One Row' likely represents a specific aggregation or adjustment of 'Product Revenue (Exclude LOD)'. The exact relationship (e.g., subset, transformation) is not explicitly defined in the provided SQL but implies a difference in how revenue is counted or grouped.","Not explicitly defined, but Product_Revenue_Merged_OneRow is likely a derivative of Product_Revenue.",Understanding the difference between these two revenue figures is crucial for accurate financial reporting and analysis. It should be clear when to use each metric.,"SELECT SUM(SAFE_CAST(Product_Revenue AS NUMERIC)) AS total_revenue, SUM(SAFE_CAST(Product_Revenue_Merged_OneRow AS NUMERIC)) AS total_merged_revenue FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` LIMIT 1;",medium,high,39,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,1,product_revenue_merged_one_row
filter_impact,total_gross_revenue_amount,"['financial_year_dimension', 'financial_short_month_dimension', 'revenue_transaction_status_dimension', 'source_publishing_division_dimension']","The `total_gross_revenue_amount` is directly filtered by the `financial_year`, `financial_short_month`, `revenue_transaction_status`, and `source_publishing_division` dimensions. Any change in these filter values will directly impact the calculated total revenue.","SUM(gross_revenue_amount) WHERE financial_year = '2025' AND financial_short_month = 'Oct' AND revenue_transaction_status IN ('Billed', 'Booked') AND source_publishing_division != 'Medium Rare Content Agency'",Ensures that only relevant and confirmed revenue for the specified period and divisions is included in the total.,"SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(financial_short_month AS STRING) = 'Oct' AND SAFE_CAST(revenue_transaction_status AS STRING) IN ('Billed', 'Booked') AND SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency';",strong,high,41,705edcb5-737a-4600-b1a7-11870177f97a,4,"financial_year_dimension, financial_short_month_dimension, revenue_transaction_status_dimension, source_publishing_division_dimension"
dependency,programmatic_gross_revenue_oct_foxtel_pluto,"['total_gross_revenue_amount', 'revenue_type_level2_dimension', 'revenue_group_subtype_dimension', 'advertiser_name_dimension', 'source_system_code_dimension', 'financial_short_month_dimension']","The `programmatic_gross_revenue_oct_foxtel_pluto` is a subset of the `total_gross_revenue_amount`, specifically filtered by `revenue_type_level2 = 'Programmatic'`, `revenue_group_subtype` in ('Programmatic Source', 'Digital'), `advertiser_name = 'Foxtel Management Pty Ltd'`, `source_system_code = 'PLUTO'`, and `financial_short_month = 'Oct'`, in addition to the common filters.","SUM(gross_revenue_amount) WHERE (common filters) AND revenue_type_level2 = 'Programmatic' AND revenue_group_subtype IN ('Programmatic Source', 'Digital') AND advertiser_name = 'Foxtel Management Pty Ltd' AND source_system_code = 'PLUTO' AND financial_short_month = 'Oct'","This relationship defines the specific criteria for 'Programmatic Impact' as understood by the dashboard, allowing for focused analysis on a key segment.","SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(financial_short_month AS STRING) = 'Oct' AND SAFE_CAST(revenue_transaction_status AS STRING) IN ('Billed', 'Booked') AND SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' AND SAFE_CAST(revenue_type_level2 AS STRING) = 'Programmatic' AND SAFE_CAST(revenue_group_subtype AS STRING) IN ('Programmatic Source', 'Digital') AND SAFE_CAST(advertiser_name AS STRING) = 'Foxtel Management Pty Ltd' AND SAFE_CAST(source_system_code AS STRING) = 'PLUTO';",strong,high,41,705edcb5-737a-4600-b1a7-11870177f97a,6,"total_gross_revenue_amount, revenue_type_level2_dimension, revenue_group_subtype_dimension, advertiser_name_dimension, source_system_code_dimension, financial_short_month_dimension"
mathematical_relationship,total_volume_draw_returns_adjustment,"['total_draw_volume', 'total_returns_volume', 'total_adjustment_volume']","The total volume (Draw + Returns + Adjustment) is the sum of individual draw, returns, and adjustment volumes.",Total Volume = Total Draw Volume + Total Returns Volume + Total Adjustment Volume,Ensures that the overall physical product movement is accurately accounted for by summing its constituent parts.,SELECT SUM(total_volume_draw_returns_adjustment) - (SUM(total_draw_volume) + SUM(total_returns_volume) + SUM(total_adjustment_volume)) AS difference FROM consolidated_metrics_table WHERE fiscal_year = '2025' AND difference != 0;,strong,high,42,c441950c-1e3f-432c-9838-847d1d315b9e,3,"total_draw_volume, total_returns_volume, total_adjustment_volume"
hierarchical,gross_revenue_amount,"['programmatic_source_revenue', 'base_revenue_for_fy_calc', 'py_revenue_total', 'cy_revenue_total', 'py_revenue_pmp', 'cy_revenue_pmp', 'py_revenue_tubi', 'cy_revenue_tubi', 'py_revenue_performance', 'cy_revenue_performance', 'cy_combined_programmatic_revenue_ytd', 'cy_tubi_revenue_ytd', 'cy_performance_revenue_ytd', 'cy_pmp_revenue_ytd', 'cy_guaranteed_revenue_ytd', 'cy_nonguaranteed_revenue_ytd']","All revenue metrics are derived from the base `gross_revenue_amount`, with various filters and classifications applied.",N/A,"Ensures that all specific revenue figures roll up correctly to the total gross revenue, providing a consistent view of financial performance.","SELECT SUM(gross_revenue_amount) AS total_gross_revenue, SUM(py_revenue_total) + SUM(cy_revenue_total) AS total_fy_revenue_sum FROM calculated_measures WHERE relative_fy_year_offset IN (0, -1) LIMIT 1;",strong,high,43,5491badf-5ec0-4b4f-a427-b12a3a3395dd,16,"programmatic_source_revenue, base_revenue_for_fy_calc, py_revenue_total, cy_revenue_total, py_revenue_pmp, cy_revenue_pmp, py_revenue_tubi, cy_revenue_tubi, py_revenue_performance, cy_revenue_performance, cy_combined_programmatic_revenue_ytd, cy_tubi_revenue_ytd, cy_performance_revenue_ytd, cy_pmp_revenue_ytd, cy_guaranteed_revenue_ytd, cy_nonguaranteed_revenue_ytd"
dependency,programmatic_type,"['py_revenue_pmp', 'cy_revenue_pmp', 'py_revenue_tubi', 'cy_revenue_tubi', 'py_revenue_performance', 'cy_revenue_performance', 'cy_tubi_revenue_ytd', 'cy_performance_revenue_ytd']","The `programmatic_type` dimension is a key classification used to segment and calculate specific revenue metrics (e.g., PMP, Tubi, Performance revenue).",N/A,Accurate classification of programmatic types is critical for correct reporting and analysis of revenue streams.,"SELECT programmatic_type, SUM(gross_revenue_amount) AS revenue FROM derived_attributes GROUP BY programmatic_type LIMIT 10;",strong,high,43,5491badf-5ec0-4b4f-a427-b12a3a3395dd,8,"py_revenue_pmp, cy_revenue_pmp, py_revenue_tubi, cy_revenue_tubi, py_revenue_performance, cy_revenue_performance, cy_tubi_revenue_ytd, cy_performance_revenue_ytd"
filter_impact,cy_combined_programmatic_revenue_ytd,"['cy_tubi_revenue_ytd', 'cy_performance_revenue_ytd', 'cy_pmp_revenue_ytd', 'cy_guaranteed_revenue_ytd', 'cy_nonguaranteed_revenue_ytd']",All 'YTD' metrics are filtered by the `relative_fy_year_offset = 0` (Current Year) and a hardcoded `reporting_date < '2025-06-18'` condition.,Metric_YTD = SUM(Revenue WHERE is_current_fy AND reporting_date < '2025-06-18'),"Ensures that YTD figures are consistently calculated up to a specific point in time, allowing for accurate progress tracking within the fiscal year.","SELECT SUM(cy_combined_programmatic_revenue_ytd) AS total_ytd_revenue, SUM(cy_tubi_revenue_ytd) + SUM(cy_performance_revenue_ytd) + SUM(cy_pmp_revenue_ytd) + SUM(cy_guaranteed_revenue_ytd) + SUM(cy_nonguaranteed_revenue_ytd) AS sum_of_ytd_breakdowns FROM calculated_measures WHERE is_current_fy AND is_ytd_period_as_of_hardcoded_date LIMIT 1;",strong,high,43,5491badf-5ec0-4b4f-a427-b12a3a3395dd,5,"cy_tubi_revenue_ytd, cy_performance_revenue_ytd, cy_pmp_revenue_ytd, cy_guaranteed_revenue_ytd, cy_nonguaranteed_revenue_ytd"
filter_impact,advertiser_group,['product_group'],"The selection of 'advertiser_group' is filtered by specific 'product_group' values ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige'). This implies that certain advertiser groups are only relevant or visible within these product contexts.",N/A,"Ensures that advertiser group analysis is focused on relevant product categories, potentially to avoid showing irrelevant or zero-value advertiser groups for certain product types.","SELECT COUNT(DISTINCT advertiser_group) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige');",strong,high,44,d3bcf796-2396-4a6f-b0a3-da0b7f299a58,1,product_group
filter_impact,fin_adtype_name,['product_group'],The selection of 'fin_adtype_name' excludes records where 'product_group' is 'Unknown' or NULL. This suggests that 'Unknown' product groups are considered irrelevant or problematic for ad type analysis.,N/A,"Ensures that ad type analysis is based on clearly categorized product groups, improving data quality and relevance for reporting.",SELECT COUNT(DISTINCT fin_adtype_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (product_group NOT IN ('Unknown') OR product_group IS NULL);,strong,medium,44,d3bcf796-2396-4a6f-b0a3-da0b7f299a58,1,product_group
filter_impact,financial_week,['product_group'],"The selection of 'financial_week' is filtered by specific 'product_group' values ('Free News & Lifestyle', 'State & Communities', ''). This implies that financial week trends are primarily analyzed for these specific product categories.",N/A,"Focuses time-series analysis of financial weeks on key product categories, potentially to highlight performance within core news and community segments.","SELECT COUNT(DISTINCT SAFE_CAST(financial_week AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Free News & Lifestyle', 'State & Communities', '');",strong,high,44,d3bcf796-2396-4a6f-b0a3-da0b7f299a58,1,product_group
dependency,current_fy_gross_revenue_amount,['total_gross_revenue_amount'],"Current FY Gross Revenue Amount is a conditional sum of Total Gross Revenue Amount, specifically filtered for the current financial year (relative_fy_year_offset = 0).",current_fy_gross_revenue_amount = SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END),Ensures that current period revenue is accurately isolated from other financial years for focused analysis.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_revenue_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 1;",strong,high,45,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,1,total_gross_revenue_amount
dependency,current_fy_pipeline,['total_pipeline'],"Current FY Pipeline is a conditional sum of Total Pipeline, specifically filtered for the current financial year (relative_fy_year_offset = 0).",current_fy_pipeline = SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END),Ensures that current period pipeline is accurately isolated for immediate future revenue forecasting.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS current_fy_pipeline_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 1;",strong,high,45,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,1,total_pipeline
