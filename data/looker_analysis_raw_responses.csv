raw_response,status,response_id
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""601ed0d2-e944-4189-8170-d593c8e72026"",
    ""dashboard_name"": ""Adex"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource;`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""date"",
      ""Advertiser"",
      ""Media_Network"",
      ""Major_Category"",
      ""Category"",
      ""Sub_Category"",
      ""portfolio_parent_group_name"",
      ""calendar_year"",
      ""financial_year"",
      ""time_period_type"",
      ""quarter""
    ],
    ""date_range_detected"": ""Rolling 12 months from latest_date, Calendar Year, Financial Year"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Rolling 12 months'"",
      ""'Calendar Year'"",
      ""'Financial Year'"",
      ""'ty'"",
      ""'ly'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""'$'"",
      ""'$\\'000'"",
      ""'KEY ACCOUNTS TRAVEL'"",
      ""'NEWS CORP'"",
      ""'youtube'"",
      ""'facebook'"",
      ""'Adex'"",
      ""specific Advertiser names (NT Depts)""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB`)."",
      ""Time period selections ('Rolling 12 months', 'Calendar Year', 'Financial Year') should be parameters."",
      ""Quarter definitions should be part of a governed date dimension table or a configurable business rule."",
      ""Currency display format ('$', '$\\'000') should be a dashboard parameter."",
      ""Specific portfolio names and advertiser names should be managed via lookup tables or user-defined parameters, not hardcoded in queries."",
      ""Media network names ('NEWS CORP', 'youtube', 'facebook') used in conditional sums should be configurable.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *,\n      -- Add common derived fields early for clarity\n      FORMAT_DATETIME('%b', SAFE_CAST(date AS DATETIME)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', SAFE_CAST(date AS DATETIME)) AS INT64) AS calendar_year,\n      CASE WHEN Spend IS NULL THEN 0 ELSE Spend END AS spend_cleaned,\n      SAFE_DIVIDE(CASE WHEN Spend IS NULL THEN 0 ELSE Spend END, 1000) AS spend_in_thousands,\n      ('$\\'000' = '$\\'000') AS is_spend_in_thousands_flag, -- Assuming this is the dashboard setting\n      ('$\\'000' = '$') AS is_spend_in_dollars_flag -- Assuming this is the dashboard setting\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) -- Limit data for performance\n  ),\n  latest_info AS (\n    SELECT\n      MAX(SAFE_CAST(date AS DATE)) AS latest_date,\n      MAX(financial_year) AS max_fin_year\n    FROM\n      adex_data\n  ),\n  temp_data AS (\n    SELECT\n      t1.*,\n      li.latest_date,\n      li.max_fin_year,\n      -- Replicate the @time_period logic, assuming 'Rolling 12 months' as default for this query\n      CASE 'Rolling 12 months' -- This should be a parameter in a real dashboard\n        WHEN 'Rolling 12 months' THEN\n          CASE\n            WHEN DATE_DIFF(li.latest_date, SAFE_CAST(t1.date AS DATE), MONTH) <= 11 THEN 'ty'\n            WHEN DATE_DIFF(li.latest_date, SAFE_CAST(t1.date AS DATE), MONTH) BETWEEN 12 AND 23 THEN 'ly'\n            ELSE NULL\n          END\n        WHEN 'Calendar Year' THEN\n          CASE\n            WHEN SAFE_CAST(t1.date AS DATE) <= li.latest_date AND SAFE_CAST(t1.date AS DATE) >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM li.latest_date) AS STRING),'-01-01')) THEN 'ty'\n            WHEN SAFE_CAST(t1.date AS DATE) <= DATETIME_ADD(li.latest_date, INTERVAL -1 YEAR) AND SAFE_CAST(t1.date AS DATE) >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM li.latest_date) - 1 AS STRING), '-01-01')) THEN 'ly'\n            ELSE NULL\n          END\n        WHEN 'Financial Year' THEN\n          CASE\n            WHEN SAFE_CAST(t1.date AS DATE) <= li.latest_date AND SAFE_CAST(t1.date AS DATE) >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(li.max_fin_year - 1 AS STRING),'-07-01')) THEN 'ty'\n            WHEN SAFE_CAST(t1.date AS DATE) <= DATETIME_ADD(li.latest_date, INTERVAL -1 YEAR) AND SAFE_CAST(t1.date AS DATE) >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(li.max_fin_year - 2 AS STRING), '-07-01')) THEN 'ly'\n            ELSE NULL\n          END\n        ELSE NULL\n      END AS period_type_flag,\n      -- Quarter calculation (simplified, assuming calendar year quarters for example)\n      CASE\n        WHEN EXTRACT(MONTH FROM SAFE_CAST(t1.date AS DATETIME)) BETWEEN 1 AND 3 THEN 'Q1'\n        WHEN EXTRACT(MONTH FROM SAFE_CAST(t1.date AS DATETIME)) BETWEEN 4 AND 6 THEN 'Q2'\n        WHEN EXTRACT(MONTH FROM SAFE_CAST(t1.date AS DATETIME)) BETWEEN 7 AND 9 THEN 'Q3'\n        WHEN EXTRACT(MONTH FROM SAFE_CAST(t1.date AS DATETIME)) BETWEEN 10 AND 12 THEN 'Q4'\n        ELSE NULL\n      END AS calendar_quarter\n    FROM\n      adex_data AS t1\n    CROSS JOIN\n      latest_info AS li\n  )\nSELECT\n  SAFE_CAST(t.date AS DATE) AS date_dim,\n  t.Advertiser,\n  t.Major_Category,\n  t.Media_Network,\n  t.Category,\n  t.Sub_Category,\n  t.portfolio_parent_group_name,\n  t.calendar_year,\n  t.financial_year,\n  t.period_type_flag,\n  t.calendar_quarter,\n  -- Adjusted Spend TY\n  SUM(CASE\n    WHEN t.period_type_flag = 'ty' AND t.is_spend_in_thousands_flag THEN t.spend_in_thousands\n    WHEN t.period_type_flag = 'ty' AND t.is_spend_in_dollars_flag THEN t.spend_cleaned\n    ELSE 0\n  END) AS total_spend_ty,\n  -- Adjusted Spend LY\n  SUM(CASE\n    WHEN t.period_type_flag = 'ly' AND t.is_spend_in_thousands_flag THEN t.spend_in_thousands\n    WHEN t.period_type_flag = 'ly' AND t.is_spend_in_dollars_flag THEN t.spend_cleaned\n    ELSE 0\n  END) AS total_spend_ly,\n  -- Specific Media Network Spends (TY)\n  SUM(CASE WHEN t.Media_Network = 'NEWS CORP' AND t.period_type_flag = 'ty' THEN t.spend_cleaned ELSE 0 END) AS total_spend_ty_news_corp,\n  SUM(CASE WHEN t.Media_Network = 'youtube' AND t.period_type_flag = 'ty' THEN t.spend_cleaned ELSE 0 END) AS total_spend_ty_youtube,\n  SUM(CASE WHEN t.Media_Network = 'facebook' AND t.period_type_flag = 'ty' THEN t.spend_cleaned ELSE 0 END) AS total_spend_ty_facebook,\n  -- Fixed Publisher Count (as a global constant, aggregated here)\n  MAX(fixed_publisher_count.fixed_publisher_count) AS fixed_publisher_count_global\nFROM\n  temp_data AS t\nCROSS JOIN\n  (\n    SELECT\n      COUNT(DISTINCT media_network) AS fixed_publisher_count\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n  ) AS fixed_publisher_count\nWHERE\n  t.period_type_flag IS NOT NULL -- Only include rows relevant to TY/LY periods\nGROUP BY\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11\nORDER BY\n  date_dim DESC, Advertiser\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(date AS DATE)) as unique_dates,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT Media_Network) as unique_media_networks,\n  COUNT(DISTINCT Major_Category) as unique_major_categories,\n  MIN(SAFE_CAST(date AS DATE)) as earliest_date,\n  MAX(SAFE_CAST(date AS DATE)) as latest_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(date AS STRING), Advertiser, Media_Network, Major_Category)) as approx_unique_rows_at_grain\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Spend AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_spend_positive_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(SAFE_CAST(date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(DISTINCT Media_Network) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_media_networks_test,\n  CASE WHEN COUNT(DISTINCT financial_year) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_financial_years_test\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  base_data AS (\n    SELECT\n      *,\n      MAX(SAFE_CAST(date AS DATE)) OVER() AS latest_date_global,\n      MAX(financial_year) OVER() AS max_fin_year_global\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n  )\nSELECT\n  'Business Rule Validation' as validation_type,\n  'rolling_12_months_ty_ly_logic_check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE\n    WHEN DATE_DIFF(latest_date_global, SAFE_CAST(date AS DATE), MONTH) <= 11 THEN 1 ELSE 0 END\n  ) as records_matching_rolling_12_ty_logic,\n  SUM(CASE\n    WHEN DATE_DIFF(latest_date_global, SAFE_CAST(date AS DATE), MONTH) BETWEEN 12 AND 23 THEN 1 ELSE 0 END\n  ) as records_matching_rolling_12_ly_logic,\n  SUM(CASE WHEN portfolio_parent_group_name = 'KEY ACCOUNTS TRAVEL' THEN 1 ELSE 0 END) AS key_accounts_travel_records,\n  SUM(CASE WHEN Advertiser IN ('NT Dept Of Trade Business & Innovation', 'NT Dept Of Chief Minister') THEN 1 ELSE 0 END) AS nt_dept_advertiser_records,\n  SUM(CASE WHEN EXTRACT(MONTH FROM SAFE_CAST(date AS DATETIME)) BETWEEN 4 AND 6 THEN 1 ELSE 0 END) AS q2_records_calendar_year\nFROM\n  base_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(date AS DATE) as date_column,\n  Advertiser,\n  Media_Network,\n  Major_Category,\n  Category,\n  Sub_Category,\n  portfolio_parent_group_name,\n  SAFE_CAST(Spend AS NUMERIC) as spend_metric,\n  SAFE_CAST(calendar_year AS INT64) as calendar_year,\n  SAFE_CAST(financial_year AS INT64) as financial_year\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND Spend IS NOT NULL\nORDER BY\n  SAFE_CAST(date AS DATE) DESC, SAFE_CAST(Spend AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'""],
          ""context"": ""Time period selection logic for 'ty'/'ly' calculation."",
          ""suggested_governance"": ""Parameterize time period selection in Looker Studio or use a configuration table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'ty'"", ""'ly'""],
          ""context"": ""Flags for 'this year' and 'last year' periods."",
          ""suggested_governance"": ""These are internal flags, but their derivation logic should be robust and potentially configurable."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Q1'"", ""'Q2'"", ""'Q3'"", ""'Q4'""],
          ""context"": ""Quarter definitions based on month numbers."",
          ""suggested_governance"": ""Use a date dimension table with pre-calculated quarters or a UDF for quarter logic."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""display_format"",
          ""hardcoded_values"": [""'$'"", ""'$\\'000'""],
          ""context"": ""Currency display format for spend metrics."",
          ""suggested_governance"": ""Parameterize currency display or use a standard formatting function."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [""'KEY ACCOUNTS TRAVEL'""],
          ""context"": ""Filtering on `portfolio_parent_group_name`."",
          ""suggested_governance"": ""Use a Looker Studio filter control or parameter for dynamic selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [""'NEWS CORP'"", ""'youtube'"", ""'facebook'""],
          ""context"": ""Conditional sums based on `Media_Network`."",
          ""suggested_governance"": ""If these are dynamic, use a configuration table for media networks and loop through them or use a parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [""'NT Dept Of Trade Business & Innovation'"", ""'NT Dept Of Chief Minister'"", ""'NT Dept Of Infrastructure Planning & Logistics'"", ""'NT Dept Of Industry Tourism & Trade'"", ""'NT Dept Of Education Employment & Training'"", ""'NT Dept Of Tourism & Culture'"", ""'NT Dept Of Transport'"", ""'NT Dept Of Attorney-General & Justice'"", ""'NT Dept Of Environment & Natural Resources'"", ""'NT Dept Of Lands Planning & The Environment'"", ""'NT Dept Of Health'"", ""'NT Dept Of Police Fire & Emergency Services'"", ""'NT Dept Of Business'"", ""'NT Dept Of Territory Families, Housing & Communities'"", ""'NT Dept Of Primary Industry & Resources'"", ""'NT Dept Of Environment Parks & Water Security'"", ""'NT Dept Of Corporate & Information Services'""],
          ""context"": ""Filtering on `Advertiser` names."",
          ""suggested_governance"": ""Use a Looker Studio filter control or parameter for dynamic selection, or group these into a 'NT Government' category in a dimension table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded date calculations (e.g., `DATE_ADD(CURRENT_DATE(), INTERVAL -1 YEAR)`) with dynamic parameters or relative date functions."",
      ""Introduce a dashboard parameter for `time_period_type` (e.g., 'Rolling 12 months', 'Calendar Year', 'Financial Year') to control the `ty_ly_embed` logic."",
      ""Use parameters for specific filter values like `Portfolio_Parent_Group_Name` and `Advertiser` names."",
      ""Externalize quarter definitions into a configuration table or a UDF for easier maintenance."",
      ""Parameterize the currency display format (e.g., 'Spend_Unit' parameter)."",
      ""Manage specific `Media_Network` names (e.g., 'NEWS CORP', 'youtube', 'facebook') through a lookup table or a parameter for dynamic analysis.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""raw_spend"",
      ""metric_name"": ""Raw Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw spend value as recorded in the source system."",
      ""sql_logic"": ""t0.Spend"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base value for all spend calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls""]
    },
    {
      ""metric_id"": ""spend_cleaned"",
      ""metric_name"": ""Spend (Nulls as Zero)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""raw_spend""],
      ""business_description"": ""Spend value where NULLs are replaced with 0, used as a base for further calculations."",
      ""sql_logic"": ""CASE WHEN (raw_spend IS NULL) THEN 0 ELSE raw_spend END"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Ensures spend calculations don't fail on NULLs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_in_thousands"",
      ""metric_name"": ""Spend (in '000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""spend_cleaned""],
      ""business_description"": ""Spend value divided by 1000, typically for display in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(spend_cleaned, 1000)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for displaying large spend figures in a more readable format."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_spend_in_thousands_flag"",
      ""metric_name"": ""Is Spend in Thousands Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Boolean flag indicating if the dashboard is configured to display spend in thousands."",
      ""sql_logic"": ""('$\\'000' = '$\\'000')"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Controls the scaling of spend metrics for display."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'$\\'000'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_spend_in_dollars_flag"",
      ""metric_name"": ""Is Spend in Dollars Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Boolean flag indicating if the dashboard is configured to display spend in dollars."",
      ""sql_logic"": ""('$\\'000' = '$')"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Controls the scaling of spend metrics for display."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'$'"", ""'$\\'000'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""time_period_type"",
      ""metric_name"": ""Time Period Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The selected time period type for analysis (e.g., 'Rolling 12 months', 'Calendar Year', 'Financial Year')."",
      ""sql_logic"": ""CASE WHEN ('Rolling 12 months' = 'Rolling 12 months') THEN clmn50_ WHEN ('Rolling 12 months' = 'Calendar Year') THEN clmn60_ WHEN ('Rolling 12 months' = 'Financial Year') THEN clmn59_ ELSE NULL END"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Defines the context for 'This Year' vs 'Last Year' comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""period_type_flag"",
      ""metric_name"": ""This Year/Last Year Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""date"", ""latest_date"", ""max_fin_year"", ""time_period_type""],
      ""business_description"": ""Flag indicating if a record falls into the 'This Year' ('ty') or 'Last Year' ('ly') period based on the selected time period type."",
      ""sql_logic"": ""CASE @time_period WHEN 'Rolling 12 months' THEN CASE WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty' WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly' ELSE NULL END WHEN 'Calendar Year' THEN CASE WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty' WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly' ELSE NULL END WHEN 'Financial Year' THEN CASE WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty' WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly' ELSE NULL END ELSE NULL END"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Core logic for comparing current vs. previous period performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ty'"", ""'ly'"", ""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter"", ""date_logic_should_be_parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_ty_adjusted"",
      ""metric_name"": ""Spend (This Year)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""period_type_flag"", ""is_spend_in_thousands_flag"", ""is_spend_in_dollars_flag"", ""spend_in_thousands"", ""spend_cleaned""],
      ""business_description"": ""Spend value for the 'This Year' period, adjusted for display unit (thousands or dollars)."",
      ""sql_logic"": ""CASE WHEN (period_type_flag = 'ty' AND is_spend_in_thousands_flag) THEN spend_in_thousands WHEN (period_type_flag = 'ty' AND is_spend_in_dollars_flag) THEN spend_cleaned ELSE NULL END"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to calculate total spend for the current period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ty'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_ly_adjusted"",
      ""metric_name"": ""Spend (Last Year)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""period_type_flag"", ""is_spend_in_thousands_flag"", ""is_spend_in_dollars_flag"", ""spend_in_thousands"", ""spend_cleaned""],
      ""business_description"": ""Spend value for the 'Last Year' period, adjusted for display unit (thousands or dollars)."",
      ""sql_logic"": ""CASE WHEN (period_type_flag = 'ly' AND is_spend_in_thousands_flag) THEN spend_in_thousands WHEN (period_type_flag = 'ly' AND is_spend_in_dollars_flag) THEN spend_cleaned ELSE NULL END"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to calculate total spend for the previous period for comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ly'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ty"",
      ""metric_name"": ""Total Spend (This Year)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_ty_adjusted""],
      ""business_description"": ""Aggregated total spend for the 'This Year' period, based on selected time period and display unit."",
      ""sql_logic"": ""SUM(spend_ty_adjusted)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [""time_period_type"", ""portfolio_parent_group_name"", ""quarter"", ""advertiser""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period advertising spend."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ly"",
      ""metric_name"": ""Total Spend (Last Year)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_ly_adjusted""],
      ""business_description"": ""Aggregated total spend for the 'Last Year' period, based on selected time period and display unit."",
      ""sql_logic"": ""SUM(spend_ly_adjusted)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [""time_period_type"", ""portfolio_parent_group_name"", ""quarter"", ""advertiser""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for previous period advertising spend, used for year-over-year comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ty_news_corp"",
      ""metric_name"": ""Total Spend TY (News Corp)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_ty_adjusted"", ""media_network""],
      ""business_description"": ""Total spend for 'This Year' specifically for 'NEWS CORP' media network."",
      ""sql_logic"": ""SUM(CASE WHEN Media_Network = 'NEWS CORP' THEN spend_ty_adjusted ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [""time_period_type""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific KPI for News Corp's performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ly_news_corp"",
      ""metric_name"": ""Total Spend LY (News Corp)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_ly_adjusted"", ""media_network""],
      ""business_description"": ""Total spend for 'Last Year' specifically for 'NEWS CORP' media network."",
      ""sql_logic"": ""SUM(CASE WHEN Media_Network = 'NEWS CORP' THEN spend_ly_adjusted ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [""time_period_type""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific KPI for News Corp's performance, for year-over-year comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ty_youtube"",
      ""metric_name"": ""Total Spend TY (Youtube)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""spend_ty_adjusted"", ""media_network""],
      ""business_description"": ""Total spend for 'This Year' specifically for 'youtube' media network."",
      ""sql_logic"": ""SUM(IF(Media_Network = 'youtube' AND ty_ly_embed = 'ty', spend, 0)) OVER (PARTITION BY Advertiser)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [""time_period_type""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Spend breakdown by key media networks."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'youtube'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend_ty_facebook"",
      ""metric_name"": ""Total Spend TY (Facebook)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""spend_ty_adjusted"", ""media_network""],
      ""business_description"": ""Total spend for 'This Year' specifically for 'facebook' media network."",
      ""sql_logic"": ""SUM(IF(Media_Network = 'facebook' AND ty_ly_embed = 'ty', spend, 0)) OVER (PARTITION BY Advertiser)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [""time_period_type""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Spend breakdown by key media networks."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'facebook'""],
      ""governance_issues"": [""hardcoded_value_should_be_parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_publisher_count"",
      ""metric_name"": ""Fixed Publisher Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""global"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""media_network""],
      ""business_description"": ""A global count of distinct media networks in the dataset. This value is constant across all rows."",
      ""sql_logic"": ""COUNT(DISTINCT media_network) OVER ()"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"", ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource_test""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of publishers, likely for dashboard metadata."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_spend_ty"",
      ""related_metrics"": [""total_spend_ly""],
      ""relationship_description"": ""Year-over-year comparison of total advertising spend."",
      ""mathematical_formula"": ""Growth = (Total_Spend_TY - Total_Spend_LY) / Total_Spend_LY"",
      ""business_validation"": ""Crucial for assessing business growth or decline in advertising spend."",
      ""validation_sql"": ""SELECT SUM(total_spend_ty) AS current_year_spend, SUM(total_spend_ly) AS last_year_spend FROM ( /* primary_analysis_sql CTEs */ ) WHERE period_type_flag IS NOT NULL"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_spend_ty"",
      ""related_metrics"": [""portfolio_parent_group_name"", ""time_period_quarter"", ""advertiser""],
      ""relationship_description"": ""Total Spend TY is filtered by specific portfolio groups, quarters, and advertiser lists."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""These filters allow granular analysis of spend by specific business segments or clients."",
      ""validation_sql"": ""SELECT SUM(total_spend_ty) FROM ( /* primary_analysis_sql CTEs */ ) WHERE portfolio_parent_group_name = 'KEY ACCOUNTS TRAVEL' AND calendar_quarter = 'Q2'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_spend_ty"",
      ""related_metrics"": [""major_category"", ""category"", ""sub_category""],
      ""relationship_description"": ""Spend can be aggregated and drilled down by category hierarchy."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows analysis of spend distribution across different advertising categories."",
      ""validation_sql"": ""SELECT major_category, SUM(total_spend_ty) FROM ( /* primary_analysis_sql CTEs */ ) GROUP BY major_category"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""spend_ty_adjusted"",
      ""related_metrics"": [""is_spend_in_thousands_flag"", ""is_spend_in_dollars_flag"", ""spend_in_thousands"", ""spend_cleaned""],
      ""relationship_description"": ""The final 'This Year' spend value depends on the raw spend, null handling, scaling, and the selected display unit."",
      ""mathematical_formula"": ""Spend_TY_Adjusted = IF(Is_Spend_In_Thousands_Flag, Spend_in_Thousands, Spend_Cleaned)"",
      ""business_validation"": ""Ensures spend is presented consistently based on user's preferred display unit."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN is_spend_in_thousands_flag THEN spend_in_thousands ELSE spend_cleaned END) AS calculated_spend_ty_adjusted FROM ( /* primary_analysis_sql CTEs */ ) WHERE period_type_flag = 'ty'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,0
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d7412673-0af1-4efe-8374-ca475b001fb6"",
    ""dashboard_name"": ""Finance OS datasource template report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 79,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year"",
      ""source_system_name"",
      ""fiscal_week_id"",
      ""gl_publication_code"",
      ""os_level_1"",
      ""os_level_12"",
      ""department_code""
    ],
    ""date_range_detected"": ""Relative to current date, filtered by 'CP' (Current Period) and 'PY' (Prior Year) in period control."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""The 'CP' and 'PY' period filters should be parameterized or managed via a configuration table for dynamic reporting periods."",
      ""The 'calender_table' CTE is defined but unused in the provided queries, indicating potential dead code or incomplete dashboard functionality.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH calendar_filtered AS (\n  SELECT DISTINCT\n    SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n    SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n    SAFE_CAST(c.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n    SAFE_CAST(c.fy_last_day_of_week AS DATE) AS fy_last_day_of_week,\n    SAFE_CAST(c.fy_month_of_year AS INT64) AS fy_month_of_year,\n    SAFE_CAST(c.fy_year_month_number AS INT64) AS fy_year_month_number,\n    SAFE_CAST(c.relative_fisc_year_number AS INT64) AS relative_fisc_year_number,\n    SAFE_CAST(c.relative_fisc_week_number AS INT64) AS relative_fisc_week_number,\n    c.fy_month_of_year_short_name,\n    CASE\n      WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) THEN 'Y'\n      ELSE 'N'\n    END AS month_end_flag,\n    SAFE_CAST(c.fy_quarter_of_year AS INT64) AS fy_quarter_of_year,\n    SAFE_CAST(c.fy_year AS INT64) AS fy_year,\n    control.period_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n    JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n      ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64)\n  WHERE\n    control.period_name IN ('CP', 'PY')\n),\nOSandFACT AS (\n  SELECT\n    os.source_system_name,\n    os.sub_source_system_name,\n    SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n    os.gl_publication_code,\n    os.day_of_week,\n    os.state,\n    os.os_level_1,\n    os.os_level_2,\n    os.os_level_3,\n    os.os_level_4,\n    os.os_level_5,\n    os.os_level_6,\n    os.os_level_7,\n    os.os_level_8,\n    os.os_level_9,\n    os.os_level_10,\n    os.os_level_11,\n    os.os_level_12,\n    SAFE_CAST(os.Actual_Amount AS NUMERIC) AS Actual_Amount,\n    SAFE_CAST(os.volume AS NUMERIC) AS volume,\n    SAFE_CAST(os.Estimate AS NUMERIC) AS Estimate,\n    SAFE_CAST(os.True_Up_Adjustment AS NUMERIC) AS True_Up_Adjustment,\n    SAFE_CAST(os.Last_Year_Actual_Amount AS NUMERIC) AS Last_Year_Actual_Amount,\n    SAFE_CAST(os.Last_Year_volume AS NUMERIC) AS Last_Year_volume,\n    SAFE_CAST(os.Budget_Draft_Amount AS NUMERIC) AS Budget_Draft_Amount,\n    SAFE_CAST(os.Budget_Draft_Volume AS NUMERIC) AS Budget_Draft_Volume,\n    SAFE_CAST(os.Budget_Amount AS NUMERIC) AS Budget_Amount,\n    SAFE_CAST(os.Budget_Volume AS NUMERIC) AS Budget_Volume,\n    SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS Forecast_Amount,\n    SAFE_CAST(os.Forecast_Volume AS NUMERIC) AS Forecast_Volume,\n    SAFE_CAST(os.Budget_Jan_Amount AS NUMERIC) AS Budget_Jan_Amount,\n    SAFE_CAST(os.Budget_Jan_Volume AS NUMERIC) AS Budget_Jan_Volume,\n    SAFE_CAST(os.Budget_Feb_Amount AS NUMERIC) AS Budget_Feb_Amount,\n    SAFE_CAST(os.Budget_Feb_Volume AS NUMERIC) AS Budget_Feb_Volume,\n    SAFE_CAST(os.Budget_Mar_Amount AS NUMERIC) AS Budget_Mar_Amount,\n    SAFE_CAST(os.Budget_Mar_Volume AS NUMERIC) AS Budget_Mar_Volume,\n    SAFE_CAST(os.Budget_Apr_Amount AS NUMERIC) AS Budget_Apr_Amount,\n    SAFE_CAST(os.Budget_Apr_Volume AS NUMERIC) AS Budget_Apr_Volume,\n    SAFE_CAST(os.Budget_May_Amount AS NUMERIC) AS Budget_May_Amount,\n    SAFE_CAST(os.Budget_May_Volume AS NUMERIC) AS Budget_May_Volume,\n    SAFE_CAST(os.Budget_Jun_Amount AS NUMERIC) AS Budget_Jun_Amount,\n    SAFE_CAST(os.Budget_Jun_Volume AS NUMERIC) AS Budget_Jun_Volume,\n    SAFE_CAST(os.Budget_Jul_Amount AS NUMERIC) AS Budget_Jul_Amount,\n    SAFE_CAST(os.Budget_Jul_Volume AS NUMERIC) AS Budget_Jul_Volume,\n    SAFE_CAST(os.Budget_Aug_Amount AS NUMERIC) AS Budget_Aug_Amount,\n    SAFE_CAST(os.Budget_Aug_Volume AS NUMERIC) AS Budget_Aug_Volume,\n    SAFE_CAST(os.Budget_Sep_Amount AS NUMERIC) AS Budget_Sep_Amount,\n    SAFE_CAST(os.Budget_Sep_Volume AS NUMERIC) AS Budget_Sep_Volume,\n    SAFE_CAST(os.Budget_Oct_Amount AS NUMERIC) AS Budget_Oct_Amount,\n    SAFE_CAST(os.Budget_Oct_Volume AS NUMERIC) AS Budget_Oct_Volume,\n    SAFE_CAST(os.Budget_Nov_Amount AS NUMERIC) AS Budget_Nov_Amount,\n    SAFE_CAST(os.Budget_Nov_Volume AS NUMERIC) AS Budget_Nov_Volume,\n    SAFE_CAST(os.Budget_Dec_Amount AS NUMERIC) AS Budget_Dec_Amount,\n    SAFE_CAST(os.Budget_Dec_Volume AS NUMERIC) AS Budget_Dec_Volume,\n    SAFE_CAST(os.Forecast_Q1F_Amount AS NUMERIC) AS Forecast_Q1F_Amount,\n    SAFE_CAST(os.Forecast_Q1F_Volume AS NUMERIC) AS Forecast_Q1F_Volume,\n    SAFE_CAST(os.Forecast_Q2F_Amount AS NUMERIC) AS Forecast_Q2F_Amount,\n    SAFE_CAST(os.Forecast_Q2F_Volume AS NUMERIC) AS Forecast_Q2F_Volume,\n    SAFE_CAST(os.Forecast_Q3F_Amount AS NUMERIC) AS Forecast_Q3F_Amount,\n    SAFE_CAST(os.Forecast_Q3F_Volume AS NUMERIC) AS Forecast_Q3F_Volume,\n    SAFE_CAST(os.Forecast_Q4F_Amount AS NUMERIC) AS Forecast_Q4F_Amount,\n    SAFE_CAST(os.Forecast_Q4F_Volume AS NUMERIC) AS Forecast_Q4F_Volume,\n    SAFE_CAST(os.Forecast_Q5F_Amount AS NUMERIC) AS Forecast_Q5F_Amount,\n    SAFE_CAST(os.Forecast_Q5F_Volume AS NUMERIC) AS Forecast_Q5F_Volume,\n    calendar.fy_year,\n    calendar.fy_first_day_of_week,\n    calendar.fy_last_day_of_week,\n    calendar.month_end_flag,\n    calendar.period_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN calendar_filtered AS calendar\n      ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep\n      ON os.os_level_12 = dep.department_code\n)\nSELECT\n  fy_year,\n  source_system_name,\n  fiscal_week_id,\n  fy_first_day_of_week,\n  fy_last_day_of_week,\n  month_end_flag,\n  period_name,\n  SUM(Actual_Amount) AS total_actual_amount,\n  SUM(volume) AS total_volume,\n  SUM(Estimate) AS total_estimate,\n  SUM(Budget_Amount) AS total_budget_amount,\n  SUM(Forecast_Amount) AS total_forecast_amount,\n  COUNT(DISTINCT gl_publication_code) AS distinct_publications,\n  COUNT(1) AS record_count_per_group\nFROM\n  OSandFACT\nWHERE\n  fy_first_day_of_week >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nGROUP BY\n  fy_year,\n  source_system_name,\n  fiscal_week_id,\n  fy_first_day_of_week,\n  fy_last_day_of_week,\n  month_end_flag,\n  period_name\nORDER BY\n  fy_year DESC, fiscal_week_id DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(os.fiscal_week_id AS INT64)) as unique_fiscal_week_ids_fact,\n  COUNT(DISTINCT os.source_system_name) as unique_source_systems,\n  COUNT(DISTINCT os.gl_publication_code) as unique_publication_codes,\n  MIN(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as earliest_fiscal_week_date,\n  MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) as latest_fiscal_week_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(os.fiscal_week_id AS STRING), os.gl_publication_code, os.source_system_name)) as approx_unique_fact_rows_at_grain,\n  SUM(SAFE_CAST(os.Actual_Amount AS NUMERIC)) as total_actual_amount_sample,\n  SUM(SAFE_CAST(os.volume AS NUMERIC)) as total_volume_sample\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(os.Actual_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_data_present,\n  CASE WHEN SUM(SAFE_CAST(os.Actual_Amount AS NUMERIC)) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as actual_amount_sum_calculates,\n  CASE WHEN COUNT(DISTINCT os.source_system_name) > 0 THEN 'PASS' ELSE 'FAIL' END as source_system_data_present,\n  CASE WHEN COUNT(DISTINCT control.period_name) = 2 THEN 'PASS' ELSE 'FAIL' END as cp_py_periods_found,\n  CASE WHEN MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_check\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n    ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Period Control Filter' as rule_name,\n  COUNT(DISTINCT control.period_name) as distinct_period_names_found,\n  SUM(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 ELSE 0 END) as records_matching_cp_py,\n  COUNT(1) as total_records_in_period_control_join,\n  SAFE_DIVIDE(SUM(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 ELSE 0 END), COUNT(1)) * 100 as percentage_matching_cp_py,\n  'Month End Flag Logic' as rule_name_2,\n  SUM(CASE WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) AND (CASE WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) THEN 'Y' ELSE 'N' END) = 'Y' THEN 1 ELSE 0 END) as month_end_flag_correct_y,\n  SUM(CASE WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) != SAFE_CAST(c.fy_last_day_of_month AS DATE) AND (CASE WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) THEN 'Y' ELSE 'N' END) = 'N' THEN 1 ELSE 0 END) as month_end_flag_correct_n,\n  COUNT(1) as total_calendar_records_checked\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n  JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n    ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(c.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""sample_data_sql"": ""WITH calendar_filtered AS (\n  SELECT DISTINCT\n    SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n    SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n    SAFE_CAST(c.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n    SAFE_CAST(c.fy_last_day_of_week AS DATE) AS fy_last_day_of_week,\n    SAFE_CAST(c.fy_month_of_year AS INT64) AS fy_month_of_year,\n    SAFE_CAST(c.fy_year_month_number AS INT64) AS fy_year_month_number,\n    SAFE_CAST(c.relative_fisc_year_number AS INT64) AS relative_fisc_year_number,\n    SAFE_CAST(c.relative_fisc_week_number AS INT64) AS relative_fisc_week_number,\n    c.fy_month_of_year_short_name,\n    CASE\n      WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) THEN 'Y'\n      ELSE 'N'\n    END AS month_end_flag,\n    SAFE_CAST(c.fy_quarter_of_year AS INT64) AS fy_quarter_of_year,\n    SAFE_CAST(c.fy_year AS INT64) AS fy_year,\n    control.period_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n    JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n      ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64)\n  WHERE\n    control.period_name IN ('CP', 'PY')\n),\nOSandFACT AS (\n  SELECT\n    os.source_system_name,\n    os.sub_source_system_name,\n    SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n    os.gl_publication_code,\n    os.day_of_week,\n    os.state,\n    os.os_level_1,\n    os.os_level_2,\n    os.os_level_3,\n    os.os_level_4,\n    os.os_level_5,\n    os.os_level_6,\n    os.os_level_7,\n    os.os_level_8,\n    os.os_level_9,\n    os.os_level_10,\n    os.os_level_11,\n    os.os_level_12,\n    SAFE_CAST(os.Actual_Amount AS NUMERIC) AS Actual_Amount,\n    SAFE_CAST(os.volume AS NUMERIC) AS volume,\n    SAFE_CAST(os.Estimate AS NUMERIC) AS Estimate,\n    SAFE_CAST(os.Budget_Amount AS NUMERIC) AS Budget_Amount,\n    SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS Forecast_Amount,\n    calendar.fy_year,\n    calendar.fy_first_day_of_week,\n    calendar.fy_last_day_of_week,\n    calendar.month_end_flag,\n    calendar.period_name,\n    dep.department_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN calendar_filtered AS calendar\n      ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep\n      ON os.os_level_12 = dep.department_code\n)\nSELECT\n  fy_year,\n  fiscal_week_id,\n  fy_first_day_of_week,\n  source_system_name,\n  gl_publication_code,\n  os_level_1,\n  os_level_12,\n  department_name,\n  period_name,\n  month_end_flag,\n  Actual_Amount,\n  volume,\n  Estimate,\n  Budget_Amount,\n  Forecast_Amount\nFROM\n  OSandFACT\nWHERE\n  fy_first_day_of_week >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND Actual_Amount IS NOT NULL\nORDER BY\n  fy_first_day_of_week DESC, Actual_Amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""period_name filter in the calendar join"",
          ""suggested_governance"": ""Use a parameter or a control table to define the current and prior periods dynamically."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded period names ('CP', 'PY') with dashboard parameters or a dynamic lookup from a control table."",
      ""Consider adding parameters for fiscal year or date ranges to allow users to select specific reporting periods.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fy_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Year."",
      ""sql_logic"": ""t0.fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_name"",
      ""metric_name"": ""Source System Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Source System Name."",
      ""sql_logic"": ""t0.source_system_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by Source System Name."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Week ID."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Week ID."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for GL Publication Code."",
      ""sql_logic"": ""t0.gl_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by GL Publication Code."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""day_of_week"",
      ""metric_name"": ""Day of Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Day of Week."",
      ""sql_logic"": ""t0.day_of_week"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by Day of Week."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""state"",
      ""metric_name"": ""State"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for State."",
      ""sql_logic"": ""t0.state"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by State."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year_week_number"",
      ""metric_name"": ""Fiscal Year Week Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Year Week Number."",
      ""sql_logic"": ""t0.fy_year_week_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Year Week Number."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_first_day_of_week"",
      ""metric_name"": ""Fiscal First Day of Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal First Day of Week."",
      ""sql_logic"": ""t0.fy_first_day_of_week"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal First Day of Week."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_last_day_of_week"",
      ""metric_name"": ""Fiscal Last Day of Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Last Day of Week."",
      ""sql_logic"": ""t0.fy_last_day_of_week"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Last Day of Week."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_month_of_year"",
      ""metric_name"": ""Fiscal Month of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Month of Year."",
      ""sql_logic"": ""t0.fy_month_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Month of Year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year_month_number"",
      ""metric_name"": ""Fiscal Year Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Year Month Number."",
      ""sql_logic"": ""t0.fy_year_month_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Year Month Number."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fisc_year_number"",
      ""metric_name"": ""Relative Fiscal Year Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Relative Fiscal Year Number."",
      ""sql_logic"": ""t0.relative_fisc_year_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Relative Fiscal Year Number."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fisc_week_number"",
      ""metric_name"": ""Relative Fiscal Week Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Relative Fiscal Week Number."",
      ""sql_logic"": ""t0.relative_fisc_week_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Relative Fiscal Week Number."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_month_of_year_short_name"",
      ""metric_name"": ""Fiscal Month Short Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Month Short Name."",
      ""sql_logic"": ""t0.fy_month_of_year_short_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Month Short Name."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_quarter_of_year"",
      ""metric_name"": ""Fiscal Quarter of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Fiscal Quarter of Year."",
      ""sql_logic"": ""t0.fy_quarter_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for slicing and dicing financial data by Fiscal Quarter of Year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""department_code"",
      ""metric_name"": ""Department Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Department Code."",
      ""sql_logic"": ""t0.department_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by Department Code."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""period_name"",
      ""metric_name"": ""Period Name (CP/PY)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for Period Name (CP/PY)."",
      ""sql_logic"": ""t0.period_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by Period Name (CP/PY)."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_1"",
      ""metric_name"": ""OS Level 1"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 1."",
      ""sql_logic"": ""t0.os_level_1"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 1."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_2"",
      ""metric_name"": ""OS Level 2"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 2."",
      ""sql_logic"": ""t0.os_level_2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 2."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_3"",
      ""metric_name"": ""OS Level 3"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 3."",
      ""sql_logic"": ""t0.os_level_3"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 3."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_4"",
      ""metric_name"": ""OS Level 4"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 4."",
      ""sql_logic"": ""t0.os_level_4"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 4."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5"",
      ""metric_name"": ""OS Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 5."",
      ""sql_logic"": ""t0.os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 5."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_6"",
      ""metric_name"": ""OS Level 6"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 6."",
      ""sql_logic"": ""t0.os_level_6"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 6."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_7"",
      ""metric_name"": ""OS Level 7"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 7."",
      ""sql_logic"": ""t0.os_level_7"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 7."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_8"",
      ""metric_name"": ""OS Level 8"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 8."",
      ""sql_logic"": ""t0.os_level_8"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 8."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_9"",
      ""metric_name"": ""OS Level 9"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 9."",
      ""sql_logic"": ""t0.os_level_9"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 9."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_10"",
      ""metric_name"": ""OS Level 10"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 10."",
      ""sql_logic"": ""t0.os_level_10"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 10."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_11"",
      ""metric_name"": ""OS Level 11"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 11."",
      ""sql_logic"": ""t0.os_level_11"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 11."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_12"",
      ""metric_name"": ""OS Level 12"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorical dimension for OS Level 12."",
      ""sql_logic"": ""t0.os_level_12"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for slicing and dicing financial data by OS Level 12."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Actual Amount for financial reporting."",
      ""sql_logic"": ""t0.actual_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""volume"",
      ""metric_name"": ""Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Volume for financial reporting."",
      ""sql_logic"": ""t0.volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""estimate"",
      ""metric_name"": ""Estimate"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Estimate for financial reporting."",
      ""sql_logic"": ""t0.estimate"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""true_up_adjustment"",
      ""metric_name"": ""True Up Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the True Up Adjustment for financial reporting."",
      ""sql_logic"": ""t0.true_up_adjustment"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""last_year_actual_amount"",
      ""metric_name"": ""Last Year Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Last Year Actual Amount for financial reporting."",
      ""sql_logic"": ""t0.last_year_actual_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""last_year_volume"",
      ""metric_name"": ""Last Year Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Last Year Volume for financial reporting."",
      ""sql_logic"": ""t0.last_year_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_draft_amount"",
      ""metric_name"": ""Budget Draft Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Draft Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_draft_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_draft_volume"",
      ""metric_name"": ""Budget Draft Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Draft Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_draft_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_volume"",
      ""metric_name"": ""Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_volume"",
      ""metric_name"": ""Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jan_amount"",
      ""metric_name"": ""Budget Jan Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jan Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_jan_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jan_volume"",
      ""metric_name"": ""Budget Jan Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jan Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_jan_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_feb_amount"",
      ""metric_name"": ""Budget Feb Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Feb Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_feb_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_feb_volume"",
      ""metric_name"": ""Budget Feb Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Feb Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_feb_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_mar_amount"",
      ""metric_name"": ""Budget Mar Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Mar Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_mar_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_mar_volume"",
      ""metric_name"": ""Budget Mar Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Mar Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_mar_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_apr_amount"",
      ""metric_name"": ""Budget Apr Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Apr Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_apr_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_apr_volume"",
      ""metric_name"": ""Budget Apr Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Apr Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_apr_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_may_amount"",
      ""metric_name"": ""Budget May Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget May Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_may_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_may_volume"",
      ""metric_name"": ""Budget May Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget May Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_may_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jun_amount"",
      ""metric_name"": ""Budget Jun Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jun Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_jun_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jun_volume"",
      ""metric_name"": ""Budget Jun Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jun Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_jun_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jul_amount"",
      ""metric_name"": ""Budget Jul Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jul Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_jul_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_jul_volume"",
      ""metric_name"": ""Budget Jul Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Jul Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_jul_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_aug_amount"",
      ""metric_name"": ""Budget Aug Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Aug Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_aug_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_aug_volume"",
      ""metric_name"": ""Budget Aug Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Aug Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_aug_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_sep_amount"",
      ""metric_name"": ""Budget Sep Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Sep Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_sep_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_sep_volume"",
      ""metric_name"": ""Budget Sep Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Sep Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_sep_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_oct_amount"",
      ""metric_name"": ""Budget Oct Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Oct Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_oct_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_oct_volume"",
      ""metric_name"": ""Budget Oct Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Oct Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_oct_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_nov_amount"",
      ""metric_name"": ""Budget Nov Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Nov Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_nov_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_nov_volume"",
      ""metric_name"": ""Budget Nov Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Nov Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_nov_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_dec_amount"",
      ""metric_name"": ""Budget Dec Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Dec Amount for financial reporting."",
      ""sql_logic"": ""t0.budget_dec_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""budget_dec_volume"",
      ""metric_name"": ""Budget Dec Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Budget Dec Volume for financial reporting."",
      ""sql_logic"": ""t0.budget_dec_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q1f_amount"",
      ""metric_name"": ""Forecast Q1F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q1F Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_q1f_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q1f_volume"",
      ""metric_name"": ""Forecast Q1F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q1F Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_q1f_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q2f_amount"",
      ""metric_name"": ""Forecast Q2F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q2F Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_q2f_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q2f_volume"",
      ""metric_name"": ""Forecast Q2F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q2F Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_q2f_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q3f_amount"",
      ""metric_name"": ""Forecast Q3F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q3F Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_q3f_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q3f_volume"",
      ""metric_name"": ""Forecast Q3F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q3F Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_q3f_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q4f_amount"",
      ""metric_name"": ""Forecast Q4F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q4F Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_q4f_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q4f_volume"",
      ""metric_name"": ""Forecast Q4F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q4F Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_q4f_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q5f_amount"",
      ""metric_name"": ""Forecast Q5F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q5F Amount for financial reporting."",
      ""sql_logic"": ""t0.forecast_q5f_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for revenue analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""forecast_q5f_volume"",
      ""metric_name"": ""Forecast Q5F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Forecast Q5F Volume for financial reporting."",
      ""sql_logic"": ""t0.forecast_q5f_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key financial metric for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""month_end_flag"",
      ""metric_name"": ""Month End Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""fy_last_day_of_week"",
        ""fy_last_day_of_month""
      ],
      ""business_description"": ""Indicates if the fiscal week's last day is also the fiscal month's last day."",
      ""sql_logic"": ""CASE WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y' ELSE 'N' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering or grouping data by month-end periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'N'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_amount"",
      ""metric_name"": ""Total Actual Amount"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""actual_amount""
      ],
      ""business_description"": ""The sum of Actual Amount, typically grouped by fiscal year and source system."",
      ""sql_logic"": ""SUM(clmn0_)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Primary financial metric for overall performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_record_count"",
      ""metric_name"": ""Source System Record Count"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""source_system"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""source_system_name""
      ],
      ""business_description"": ""The count of records per source system, used for distribution analysis."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to understand data volume distribution across source systems."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""actual_amount"",
        ""fy_year"",
        ""source_system_name""
      ],
      ""relationship_description"": ""Total Actual Amount is the sum of Actual Amount, grouped by Fiscal Year and Source System Name."",
      ""mathematical_formula"": ""SUM(actual_amount) GROUP BY fy_year, source_system_name"",
      ""business_validation"": ""This aggregation provides the total financial performance by fiscal year and source system, which is a core business reporting requirement."",
      ""validation_sql"": ""SELECT fy_year, source_system_name, SUM(Actual_Amount) FROM OSandFACT GROUP BY fy_year, source_system_name LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""source_system_record_count"",
      ""related_metrics"": [
        ""source_system_name""
      ],
      ""relationship_description"": ""Source System Record Count is the count of records grouped by Source System Name."",
      ""mathematical_formula"": ""COUNT(1) GROUP BY source_system_name"",
      ""business_validation"": ""This count helps understand the data volume and distribution across different source systems, useful for data quality and completeness checks."",
      ""validation_sql"": ""SELECT source_system_name, COUNT(1) FROM OSandFACT GROUP BY source_system_name LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""period_name"",
        ""fy_year_week_number""
      ],
      ""relationship_description"": ""All aggregated metrics are filtered by the 'period_name' being 'CP' (Current Period) or 'PY' (Prior Year) via the calendar join, limiting the data to specific fiscal periods."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""Ensures that financial reports only include data relevant to the current and prior fiscal periods, crucial for consistent financial analysis."",
      ""validation_sql"": ""SELECT DISTINCT period_name FROM OSandFACT;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,1
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d22b4c2-4bb3-49db-a0c1-4d46d4fba101"",
    ""dashboard_name"": ""Copy of Acquisitions - Extracts"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 9,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fy_year"",
      ""fy_week_of_year"",
      ""masthead"",
      ""sold_in_source_code"",
      ""delivery_medium_type"",
      ""classification_level_2"",
      ""offer_category_group_name"",
      ""offer_category_name"",
      ""subscriber_has_email_flag"",
      ""table_nm""
    ],
    ""date_range_detected"": ""FY2025"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""Digital Y"",
      ""Digital N"",
      ""Bundle Y"",
      ""Not Available Y"",
      ""Not Available"",
      ""TA"",
      ""CM"",
      ""DT"",
      ""HS"",
      ""AA"",
      ""CP"",
      ""GA"",
      ""GC"",
      ""NT"",
      ""TM"",
      ""TB"",
      ""TC"",
      ""WT"",
      ""SC"",
      ""CS"",
      ""TS"",
      ""AP"",
      ""RN"",
      ""PU"",
      ""op"",
      ""The Australian and Prestige"",
      ""B2C"",
      ""Consumer"",
      ""Gift Receiver"",
      ""Campus"",
      ""Corporate"",
      ""Corporate excluding IP"",
      ""Corporate IP"",
      ""IP Access"",
      ""SMB"",
      ""App Subscribers"",
      ""Bundles"",
      ""Digital"",
      ""DPE only"",
      ""Essentials"",
      ""Gift Bundles Activation"",
      ""Gift Digital Activation"",
      ""Mind Games"",
      ""Press Reader"",
      ""Print-only"",
      ""Wine Club"",
      ""Campus Activation"",
      ""Campus Sub"",
      ""Corp Volume Print"",
      ""Corporate Activation"",
      ""Corporate Enterprise Sub"",
      ""Corporate Enterprise Activation"",
      ""Corporate Enterprise Activation - Amex"",
      ""Corporate Enterprise Activation - Qantas"",
      ""Corporate Sub"",
      ""Corporate Volume Activation"",
      ""Corporate Volume Sub"",
      ""SMB Activation"",
      ""SMB Digital"",
      ""Free Staff"",
      ""Teachers Bundle"",
      ""Teachers Digital"",
      ""Teachers Print"",
      ""University Bundle"",
      ""University Digital"",
      ""_AB"",
      ""_BB"",
      ""_CF"",
      ""_CS"",
      ""_FA"",
      ""_FF"",
      ""_NA"",
      ""_PC"",
      ""_PE"",
      ""_SL"",
      ""_SS"",
      ""_TE"",
      ""_TH"",
      ""_TO"",
      ""_WS"",
      ""PRED"",
      ""AMP"",
      ""FBK"",
      ""FMB"",
      ""GGL"",
      ""GGN"",
      ""INS"",
      ""LIN"",
      ""NEW"",
      ""NWL"",
      ""POD"",
      ""POR"",
      ""RED"",
      ""SCP"",
      ""SEC"",
      ""TCA"",
      ""TMP"",
      ""TWA"",
      ""TWT"",
      ""WID"",
      """"
    ],
    ""governance_opportunities"": [
      ""Replace hardcoded fiscal year with a parameter or relative date logic."",
      ""Externalize masthead codes and their groupings into a lookup table."",
      ""Externalize sold_in_source_code patterns and their channel mappings into a lookup table."",
      ""Externalize classification_level_2 values and their groupings into a lookup table."",
      ""Externalize subscription type definitions into a configuration table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.offer_category_group_name,\n    t0.offer_category_name,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n),\nderived_dimensions AS (\n  SELECT\n    fy_year,\n    fy_week_of_year,\n    masthead,\n    offer_category_group_name,\n    offer_category_name,\n    sold_in_source_code,\n    table_nm,\n    -- Derived: delivery_medium_cleaned\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_medium_cleaned,\n    -- Derived: subscription_type\n    CASE WHEN (CONCAT(delivery_medium_type,' ',subscriber_has_email_flag) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END AS subscription_type,\n    -- Derived: masthead_grouping\n    CASE\n        WHEN (masthead = 'TA') THEN 'The Australian'\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n        WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n        WHEN (masthead = 'WT') THEN 'Other Publications'\n        WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n        WHEN (masthead IS NULL) THEN 'check'\n        ELSE 'Exclude'\n    END AS masthead_grouping,\n    -- Derived: masthead_category\n    CASE\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n        WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n        WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n        WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n        ELSE 'Exclude'\n    END AS masthead_category,\n    -- Intermediate for classification_level_grouping\n    CASE\n        WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n        WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n        WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n        WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n        WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n        WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n        ELSE NULL\n    END AS classification_level_2_raw,\n    -- Derived: classification_level_grouping\n    CASE\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n        ELSE 'Others'\n    END AS classification_level_grouping,\n    -- Derived: source_channel\n    CASE\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_AB') > 0) THEN 'Above the Fold'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_BB') > 0) THEN 'Blackbook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CF') > 0) THEN 'Community Form'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CS') > 0) THEN 'Closing Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FA') > 0) THEN 'Free Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FF') > 0) THEN 'Form Finder'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_NA') > 0) THEN 'News Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PC') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PE') > 0) THEN 'Punters Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SL') > 0) THEN 'Shortlist'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SS') > 0) THEN 'Setting Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TE') > 0) THEN 'Tippers Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TH') > 0) THEN 'Todays Headlines'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TO') > 0) THEN 'The Oz'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_WS') > 0) THEN 'Why Subscribe'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 4), 'PRED') > 0) THEN 'Predictor'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'AMP') > 0) THEN 'Google AMP'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FMB') > 0) THEN 'Facebook Messenger Bot'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGN') > 0) THEN 'Google News'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NEW') > 0) THEN 'news.com.au'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NWL') > 0) THEN 'Newsletter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POD') > 0) THEN 'Podcasts'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POR') > 0) THEN 'Newsletter Sports'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SCP') > 0) THEN 'Supercoach Plus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SEC') > 0) THEN 'Sectionals'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TCA') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TMP') > 0) THEN 'Tips Mrket Place'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWA') > 0) THEN 'The Weekend Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWT') > 0) THEN 'Twitter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'WID') > 0) THEN 'Widget'\n        WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n        ELSE NULL\n    END AS source_channel\n  FROM base_data\n)\nSELECT\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  offer_category_group_name,\n  offer_category_name,\n  subscription_type,\n  masthead_grouping,\n  masthead_category,\n  classification_level_grouping,\n  source_channel,\n  COUNT(1) AS acquisition_count\nFROM derived_dimensions\nWHERE\n  fy_year = 2025\n  AND table_nm != 'op'\n  AND masthead_grouping != 'Exclude'\n  AND masthead_category = 'The Australian and Prestige'\n  AND subscription_type = 'Digital Subscriptions'\n  AND source_channel IS NOT NULL\n  AND classification_level_grouping IN ('B2C', '')\nGROUP BY\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  offer_category_group_name,\n  offer_category_name,\n  subscription_type,\n  masthead_grouping,\n  masthead_category,\n  classification_level_grouping,\n  source_channel\nORDER BY\n  fy_year DESC, fy_week_of_year DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_year AS INT64)) as unique_fiscal_years,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_week_of_year AS INT64)) as unique_fiscal_weeks_of_year,\n  COUNT(DISTINCT t0.masthead) as unique_mastheads,\n  COUNT(DISTINCT t0.sold_in_source_code) as unique_sold_in_source_codes,\n  COUNT(DISTINCT t0.delivery_medium_type) as unique_delivery_medium_types,\n  COUNT(DISTINCT t0.classification_level_2) as unique_classification_levels_2,\n  COUNT(DISTINCT t0.offer_category_group_name) as unique_offer_category_groups,\n  COUNT(DISTINCT t0.offer_category_name) as unique_offer_category_names,\n  MIN(SAFE_CAST(t0.fy_year AS INT64)) as earliest_fy_year,\n  MAX(SAFE_CAST(t0.fy_year AS INT64)) as latest_fy_year\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= 2020\nLIMIT 1;"",
    ""validation_sql"": ""WITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.offer_category_group_name,\n    t0.offer_category_name,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n),\nderived_dimensions AS (\n  SELECT\n    fy_year,\n    fy_week_of_year,\n    masthead,\n    offer_category_group_name,\n    offer_category_name,\n    sold_in_source_code,\n    table_nm,\n    -- Derived: delivery_medium_cleaned\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_medium_cleaned,\n    -- Derived: subscription_type\n    CASE WHEN (CONCAT(delivery_medium_type,' ',subscriber_has_email_flag) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END AS subscription_type,\n    -- Derived: masthead_grouping\n    CASE\n        WHEN (masthead = 'TA') THEN 'The Australian'\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n        WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n        WHEN (masthead = 'WT') THEN 'Other Publications'\n        WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n        WHEN (masthead IS NULL) THEN 'check'\n        ELSE 'Exclude'\n    END AS masthead_grouping,\n    -- Derived: masthead_category\n    CASE\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n        WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n        WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n        WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n        ELSE 'Exclude'\n    END AS masthead_category,\n    -- Intermediate for classification_level_grouping\n    CASE\n        WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n        WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n        WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n        WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n        WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n        WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n        ELSE NULL\n    END AS classification_level_2_raw,\n    -- Derived: classification_level_grouping\n    CASE\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n        ELSE 'Others'\n    END AS classification_level_grouping,\n    -- Derived: source_channel\n    CASE\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_AB') > 0) THEN 'Above the Fold'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_BB') > 0) THEN 'Blackbook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CF') > 0) THEN 'Community Form'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CS') > 0) THEN 'Closing Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FA') > 0) THEN 'Free Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FF') > 0) THEN 'Form Finder'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_NA') > 0) THEN 'News Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PC') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PE') > 0) THEN 'Punters Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SL') > 0) THEN 'Shortlist'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SS') > 0) THEN 'Setting Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TE') > 0) THEN 'Tippers Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TH') > 0) THEN 'Todays Headlines'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TO') > 0) THEN 'The Oz'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_WS') > 0) THEN 'Why Subscribe'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 4), 'PRED') > 0) THEN 'Predictor'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'AMP') > 0) THEN 'Google AMP'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FMB') > 0) THEN 'Facebook Messenger Bot'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGN') > 0) THEN 'Google News'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NEW') > 0) THEN 'news.com.au'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NWL') > 0) THEN 'Newsletter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POD') > 0) THEN 'Podcasts'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POR') > 0) THEN 'Newsletter Sports'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SCP') > 0) THEN 'Supercoach Plus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SEC') > 0) THEN 'Sectionals'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TCA') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TMP') > 0) THEN 'Tips Mrket Place'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWA') > 0) THEN 'The Weekend Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWT') > 0) THEN 'Twitter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'WID') > 0) THEN 'Widget'\n        WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n        ELSE NULL\n    END AS source_channel\n  FROM base_data\n)\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN SUM(CASE WHEN masthead_category = 'The Australian and Prestige' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as masthead_category_filter_test,\n  CASE WHEN SUM(CASE WHEN subscription_type = 'Digital Subscriptions' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as subscription_type_filter_test,\n  CASE WHEN SUM(CASE WHEN source_channel IS NOT NULL THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as source_channel_not_null_test,\n  CASE WHEN SUM(CASE WHEN fy_year = 2025 THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as fy_2025_data_test\nFROM derived_dimensions\nWHERE fy_year = 2025\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.offer_category_group_name,\n    t0.offer_category_name,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n),\nderived_dimensions AS (\n  SELECT\n    fy_year,\n    fy_week_of_year,\n    masthead,\n    offer_category_group_name,\n    offer_category_name,\n    sold_in_source_code,\n    table_nm,\n    -- Derived: delivery_medium_cleaned\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_medium_cleaned,\n    -- Derived: subscription_type\n    CASE WHEN (CONCAT(delivery_medium_type,' ',subscriber_has_email_flag) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END AS subscription_type,\n    -- Derived: masthead_grouping\n    CASE\n        WHEN (masthead = 'TA') THEN 'The Australian'\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n        WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n        WHEN (masthead = 'WT') THEN 'Other Publications'\n        WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n        WHEN (masthead IS NULL) THEN 'check'\n        ELSE 'Exclude'\n    END AS masthead_grouping,\n    -- Derived: masthead_category\n    CASE\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n        WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n        WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n        WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n        ELSE 'Exclude'\n    END AS masthead_category,\n    -- Intermediate for classification_level_grouping\n    CASE\n        WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n        WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n        WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n        WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n        WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n        WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n        ELSE NULL\n    END AS classification_level_2_raw,\n    -- Derived: classification_level_grouping\n    CASE\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n        WHEN (\n            CASE\n                WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n                WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n                WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n                WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n                WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n                WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n                ELSE NULL\n            END IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n        ELSE 'Others'\n    END AS classification_level_grouping,\n    -- Derived: source_channel\n    CASE\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_AB') > 0) THEN 'Above the Fold'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_BB') > 0) THEN 'Blackbook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CF') > 0) THEN 'Community Form'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CS') > 0) THEN 'Closing Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FA') > 0) THEN 'Free Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FF') > 0) THEN 'Form Finder'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_NA') > 0) THEN 'News Articles'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PC') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PE') > 0) THEN 'Punters Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SL') > 0) THEN 'Shortlist'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SS') > 0) THEN 'Setting Speed'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TE') > 0) THEN 'Tippers Edge'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TH') > 0) THEN 'Todays Headlines'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TO') > 0) THEN 'The Oz'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_WS') > 0) THEN 'Why Subscribe'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 4), 'PRED') > 0) THEN 'Predictor'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'AMP') > 0) THEN 'Google AMP'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FMB') > 0) THEN 'Facebook Messenger Bot'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGN') > 0) THEN 'Google News'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NEW') > 0) THEN 'news.com.au'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NWL') > 0) THEN 'Newsletter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POD') > 0) THEN 'Podcasts'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POR') > 0) THEN 'Newsletter Sports'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SCP') > 0) THEN 'Supercoach Plus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SEC') > 0) THEN 'Sectionals'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TCA') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TMP') > 0) THEN 'Tips Mrket Place'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWA') > 0) THEN 'The Weekend Aus'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWT') > 0) THEN 'Twitter'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'WID') > 0) THEN 'Widget'\n        WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n        ELSE NULL\n    END AS source_channel\n  FROM base_data\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Masthead Category - The Australian and Prestige' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN masthead_category = 'The Australian and Prestige' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead_category = 'The Australian and Prestige' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM derived_dimensions\nWHERE fy_year = 2025\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Subscription Type - Digital Subscriptions' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN subscription_type = 'Digital Subscriptions' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN subscription_type = 'Digital Subscriptions' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM derived_dimensions\nWHERE fy_year = 2025\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Source Channel Not Null' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN source_channel IS NOT NULL THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN source_channel IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM derived_dimensions\nWHERE fy_year = 2025\nLIMIT 3;"",
    ""sample_data_sql"": ""SELECT\n  t0.fy_year,\n  t0.fy_week_of_year,\n  t0.masthead,\n  t0.offer_category_group_name,\n  t0.offer_category_name,\n  t0.sold_in_source_code,\n  t0.delivery_medium_type,\n  t0.subscriber_has_email_flag,\n  t0.table_nm,\n  t0.classification_level_2\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) = 2025\nORDER BY RAND()\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""INT64"",
          ""context"": ""Fiscal Year filter (fy_year = 2025)"",
          ""suggested_fix"": ""Replace with a parameter or a dynamic fiscal year calculation (e.g., based on CURRENT_DATE())."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Digital Y'"",
            ""'Digital N'"",
            ""'Bundle Y'"",
            ""'Not Available Y'""
          ],
          ""context"": ""Defines 'Digital Subscriptions' vs 'Print Subscriptions' based on delivery_medium_type and subscriber_has_email_flag."",
          ""suggested_governance"": ""Create a `subscription_type_mapping` reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'TA'"",
            ""'CM'"",
            ""'DT'"",
            ""'HS'"",
            ""'AA'"",
            ""'CP'"",
            ""'GA'"",
            ""'GC'"",
            ""'NT'"",
            ""'TM'"",
            ""'TB'"",
            ""'TC'"",
            ""'WT'"",
            ""'SC'"",
            ""'CS'"",
            ""'TS'"",
            ""'AP'"",
            ""'RN'"",
            ""'PU'""
          ],
          ""context"": ""Maps `masthead` codes to `Masthead Grouping` and `Masthead Category` dimensions."",
          ""suggested_governance"": ""Create a `masthead_lookup` reference table with `masthead_grouping` and `masthead_category` columns."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'op'""
          ],
          ""context"": ""Excludes records where `table_nm` is 'op'."",
          ""suggested_governance"": ""Define exclusion rules in a configuration table or parameter."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'_AB'"",
            ""'_BB'"",
            ""'_CF'"",
            ""'_CS'"",
            ""'_FA'"",
            ""'_FF'"",
            ""'_NA'"",
            ""'_PC'"",
            ""'_PE'"",
            ""'_SL'"",
            ""'_SS'"",
            ""'_TE'"",
            ""'_TH'"",
            ""'_TO'"",
            ""'_WS'"",
            ""'PRED'"",
            ""'AMP'"",
            ""'FBK'"",
            ""'FMB'"",
            ""'GGL'"",
            ""'GGN'"",
            ""'INS'"",
            ""'LIN'"",
            ""'NEW'"",
            ""'NWL'"",
            ""'POD'"",
            ""'POR'"",
            ""'RED'"",
            ""'SCP'"",
            ""'SEC'"",
            ""'TCA'"",
            ""'TMP'"",
            ""'TWA'"",
            ""'TWT'"",
            ""'WID'""
          ],
          ""context"": ""Extensive `STRPOS` logic to derive `Source/Channel` from `sold_in_source_code`."",
          ""suggested_governance"": ""Create a `source_channel_mapping` reference table with regex patterns or `STRPOS` values and their corresponding channel names."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'App Subscribers'"",
            ""'Bundles'"",
            ""'Digital'"",
            ""'DPE only'"",
            ""'Essentials'"",
            ""'Gift Bundles Activation'"",
            ""'Gift Digital Activation'"",
            ""'Mind Games'"",
            ""'Press Reader'"",
            ""'Print-only'"",
            ""'Wine Club'"",
            ""'Campus Activation'"",
            ""'Campus Sub'"",
            ""'Corp Volume Print'"",
            ""'Corporate Activation'"",
            ""'Corporate Enterprise Sub'"",
            ""'Corporate Enterprise Activation'"",
            ""'Corporate Enterprise Activation - Amex'"",
            ""'Corporate Enterprise Activation - Qantas'"",
            ""'Corporate Sub'"",
            ""'Corporate Volume Activation'"",
            ""'Corporate Volume Sub'"",
            ""'SMB Activation'"",
            ""'SMB Digital'"",
            ""'Free Staff'"",
            ""'IP Access'"",
            ""'Teachers Bundle'"",
            ""'Teachers Digital'"",
            ""'Teachers Print'"",
            ""'University Bundle'"",
            ""'University Digital'""
          ],
          ""context"": ""Maps `classification_level_2` values to `Classification Level Grouping` (B2C/B2B/Others)."",
          ""suggested_governance"": ""Create a `classification_level_lookup` reference table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year (2025) with a parameter (e.g., `{{fiscal_year}}`) or a dynamic calculation based on `CURRENT_DATE()`."",
      ""Implement lookup tables for `masthead` codes, `sold_in_source_code` patterns, `classification_level_2` values, and `delivery_medium_type` flags to centralize business logic and improve maintainability."",
      ""Consider using a configuration table for exclusion rules like `table_nm != 'op'`.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""delivery_medium_cleaned"",
      ""metric_name"": ""Delivery Medium Cleaned"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Standardized delivery medium type, mapping 'Not Available' to 'Digital'."",
      ""sql_logic"": ""CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as an intermediate step for 'Subscription Type' and potentially for direct analysis of delivery channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Not Available'"",
        ""'Digital'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscription_type"",
      ""metric_name"": ""Subscription Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""delivery_medium_type"",
        ""subscriber_has_email_flag""
      ],
      ""business_description"": ""Categorizes subscriptions as 'Digital Subscriptions' or 'Print Subscriptions' based on delivery medium and email flag."",
      ""sql_logic"": ""CASE WHEN (CONCAT(delivery_medium_type,' ',subscriber_has_email_flag) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""subscription_type = 'Digital Subscriptions'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting acquisition data by digital vs. print channels."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Y'"",
        ""'Digital N'"",
        ""'Bundle Y'"",
        ""'Not Available Y'"",
        ""'Digital Subscriptions'"",
        ""'Print Subscriptions'""
      ],
      ""governance_issues"": [
        ""Lookup values should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_grouping"",
      ""metric_name"": ""Masthead Grouping"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""masthead""
      ],
      ""business_description"": ""Groups mastheads into broader categories like 'The Australian', 'Metro', 'Regionals', etc."",
      ""sql_logic"": ""CASE WHEN (masthead = 'TA') THEN 'The Australian' WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro' WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals' WHEN (masthead = 'WT') THEN 'Other Publications' WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications' WHEN (masthead IS NULL) THEN 'check' ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""masthead_grouping != 'Exclude'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a high-level view of acquisitions across different publication types."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TA'"",
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'SC'"",
        ""'CS'"",
        ""'TS'"",
        ""'AP'"",
        ""'RN'"",
        ""'PU'"",
        ""'The Australian'"",
        ""'Metro'"",
        ""'Regionals'"",
        ""'Other Publications'"",
        ""'Deep Niche Publications'"",
        ""'check'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""Lookup values should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": [
        ""Contains 'check' and 'Exclude' categories which might indicate data quality issues or specific filtering needs.""
      ]
    },
    {
      ""metric_id"": ""masthead_category"",
      ""metric_name"": ""Masthead Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""masthead""
      ],
      ""business_description"": ""Further categorizes mastheads into strategic groups like 'States and Community', 'The Australian and Prestige', etc."",
      ""sql_logic"": ""CASE WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community' WHEN (masthead = 'TA') THEN 'The Australian and Prestige' WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content' WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle' ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""masthead_category = 'The Australian and Prestige'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to focus analysis on specific strategic masthead segments."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'CS'"",
        ""'AP'"",
        ""'SC'"",
        ""'TA'"",
        ""'PU'"",
        ""'RN'"",
        ""'TS'"",
        ""'States and Community'"",
        ""'The Australian and Prestige'"",
        ""'Commercial Content'"",
        ""'Free & Lifestyle'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""Lookup values should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": [
        ""Contains 'Exclude' category.""
      ]
    },
    {
      ""metric_id"": ""classification_level_grouping"",
      ""metric_name"": ""Classification Level Grouping"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""classification_level_2""
      ],
      ""business_description"": ""Groups subscribers into B2C, B2B, or 'Others' based on their classification level."",
      ""sql_logic"": ""CASE WHEN (classification_level_2_raw IN ('Consumer', 'Gift Receiver')) THEN 'B2C' WHEN (classification_level_2_raw IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B' ELSE 'Others' END (where classification_level_2_raw is derived from classification_level_2)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""classification_level_grouping IN ('B2C', '')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for segmenting acquisitions by business model (Business-to-Consumer vs. Business-to-Business)."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'App Subscribers'"",
        ""'Bundles'"",
        ""'Digital'"",
        ""'DPE only'"",
        ""'Essentials'"",
        ""'Gift Bundles Activation'"",
        ""'Gift Digital Activation'"",
        ""'Mind Games'"",
        ""'Press Reader'"",
        ""'Print-only'"",
        ""'Wine Club'"",
        ""'Campus Activation'"",
        ""'Campus Sub'"",
        ""'Corp Volume Print'"",
        ""'Corporate Activation'"",
        ""'Corporate Enterprise Sub'"",
        ""'Corporate Enterprise Activation'"",
        ""'Corporate Enterprise Activation - Amex'"",
        ""'Corporate Enterprise Activation - Qantas'"",
        ""'Corporate Sub'"",
        ""'Corporate Volume Activation'"",
        ""'Corporate Volume Sub'"",
        ""'SMB Activation'"",
        ""'SMB Digital'"",
        ""'Free Staff'"",
        ""'IP Access'"",
        ""'Teachers Bundle'"",
        ""'Teachers Digital'"",
        ""'Teachers Print'"",
        ""'University Bundle'"",
        ""'University Digital'"",
        ""'Consumer'"",
        ""'Gift Receiver'"",
        ""'Campus'"",
        ""'Corporate'"",
        ""'Corporate excluding IP'"",
        ""'Corporate IP'"",
        ""'IP Access'"",
        ""'SMB'"",
        ""'B2C'"",
        ""'B2B'"",
        ""'Others'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Lookup values should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_channel"",
      ""metric_name"": ""Source Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""sold_in_source_code"",
        ""delivery_medium_type"",
        ""subscriber_has_email_flag""
      ],
      ""business_description"": ""Identifies the marketing or acquisition channel (e.g., Facebook, Google, Newsletter, specific product pages) based on patterns in the sold-in source code."",
      ""sql_logic"": ""CASE WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_AB') > 0) THEN 'Above the Fold' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_BB') > 0) THEN 'Blackbook' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CF') > 0) THEN 'Community Form' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_CS') > 0) THEN 'Closing Speed' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FA') > 0) THEN 'Free Articles' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_FF') > 0) THEN 'Form Finder' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_NA') > 0) THEN 'News Articles' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PC') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_PE') > 0) THEN 'Punters Edge' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SL') > 0) THEN 'Shortlist' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_SS') > 0) THEN 'Setting Speed' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TE') > 0) THEN 'Tippers Edge' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TH') > 0) THEN 'Todays Headlines' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_TO') > 0) THEN 'The Oz' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), '_WS') > 0) THEN 'Why Subscribe' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 4), 'PRED') > 0) THEN 'Predictor' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'AMP') > 0) THEN 'Google AMP' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FBK') > 0) THEN 'Facebook' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'FMB') > 0) THEN 'Facebook Messenger Bot' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGL') > 0) THEN 'Google' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'GGN') > 0) THEN 'Google News' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'LIN') > 0) THEN 'Linked In' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NEW') > 0) THEN 'news.com.au' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'NWL') > 0) THEN 'Newsletter' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POD') > 0) THEN 'Podcasts' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'POR') > 0) THEN 'Newsletter Sports' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'RED') > 0) THEN 'Reddit' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SCP') > 0) THEN 'Supercoach Plus' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'SEC') > 0) THEN 'Sectionals' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TCA') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TMP') > 0) THEN 'Tips Mrket Place' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWA') > 0) THEN 'The Weekend Aus' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'TWT') > 0) THEN 'Twitter' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'WID') > 0) THEN 'Widget' WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook' WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google' WHEN (STRPOS(SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3), 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In' WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit' WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""source_channel IS NOT NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides granular insight into the effectiveness of various acquisition channels and campaigns."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'_AB'"",
        ""'_BB'"",
        ""'_CF'"",
        ""'_CS'"",
        ""'_FA'"",
        ""'_FF'"",
        ""'_NA'"",
        ""'_PC'"",
        ""'_PE'"",
        ""'_SL'"",
        ""'_SS'"",
        ""'_TE'"",
        ""'_TH'"",
        ""'_TO'"",
        ""'_WS'"",
        ""'PRED'"",
        ""'AMP'"",
        ""'FBK'"",
        ""'FMB'"",
        ""'GGL'"",
        ""'GGN'"",
        ""'INS'"",
        ""'LIN'"",
        ""'NEW'"",
        ""'NWL'"",
        ""'POD'"",
        ""'POR'"",
        ""'RED'"",
        ""'SCP'"",
        ""'SEC'"",
        ""'TCA'"",
        ""'TMP'"",
        ""'TWA'"",
        ""'TWT'"",
        ""'WID'""
      ],
      ""governance_issues"": [
        ""This complex logic should be externalized to a lookup table or a UDF for maintainability and consistency.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on string patterns in `sold_in_source_code` can be fragile if naming conventions change.""
      ]
    },
    {
      ""metric_id"": ""acquisition_count"",
      ""metric_name"": ""Acquisition Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of acquisitions (rows) matching the applied filters and dimensions."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""table_nm != 'op'"",
        ""masthead_grouping != 'Exclude'"",
        ""masthead_category = 'The Australian and Prestige'"",
        ""subscription_type = 'Digital Subscriptions'"",
        ""source_channel IS NOT NULL"",
        ""classification_level_grouping IN ('B2C', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""The primary metric for tracking acquisition volume, segmented by various dimensions."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'op'"",
        ""'Exclude'"",
        ""'The Australian and Prestige'"",
        ""'Digital Subscriptions'"",
        ""'B2C'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Hardcoded fiscal year and filter values should be parameterized or externalized.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": []
}
```",success,2
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e83da1de-4227-43e6-bcc6-73051c66914b"",
    ""dashboard_name"": ""Ad Events Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""fy_year_month_number"",
      ""financial_short_month"",
      ""revenue_transaction_status"",
      ""adsize_category"",
      ""booking_name""
    ],
    ""date_range_detected"": ""FY-1 to FY+1 relative to current FY, with specific filters for FY2025 and Q1 FY2025"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202501"",
      ""202502"",
      ""202503""
    ],
    ""hardcoded_values_found"": [
      ""'Sponsorship'"",
      ""'Production'"",
      ""'Media'"",
      ""'Future Bradfield 2024'"",
      ""'Sydney & Brisbane Future Series'"",
      ""'Future Bradfield FY25 B1'"",
      ""'Future Sydney Bradfield 2024'""
    ],
    ""governance_opportunities"": [
      ""Financial year and month filters should be parameterized or use relative date logic (e.g., CURRENT_FINANCIAL_YEAR())."",
      ""Adsize categories ('Sponsorship', 'Production', 'Media') should be defined in a governed lookup table."",
      ""Specific booking names should be managed via a reference table or dynamic filtering, not hardcoded.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.advertiser_name,\n    t0.booking_name,\n    t0.financial_year,\n    t0.fy_year_month_number,\n    t0.financial_short_month,\n    t0.revenue_transaction_status,\n    SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n    CASE\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(t0.adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship'\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(t0.adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production'\n      ELSE 'Media'\n    END AS adsize_category\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.relative_fy_year_offset IN (-1, 0, 1)\n),\n-- Metric 1: Gross Revenue by Adsize Category and Financial Period (Q1 FY2025)\nmetric_adsize_category_fy_period AS (\n  SELECT\n    financial_year,\n    fy_year_month_number,\n    financial_short_month,\n    adsize_category,\n    SUM(gross_revenue_amount) AS gross_revenue_adsize_category_fy_period\n  FROM base_data\n  WHERE\n    SAFE_CAST(financial_year AS STRING) = '2025'\n    AND SAFE_CAST(fy_year_month_number AS INT64) IN (202501, 202502, 202503)\n  GROUP BY\n    financial_year,\n    fy_year_month_number,\n    financial_short_month,\n    adsize_category\n),\n-- Metric 2: Gross Revenue by Revenue Transaction Status (FY2025)\nmetric_transaction_status_fy2025 AS (\n  SELECT\n    financial_year,\n    revenue_transaction_status,\n    SUM(gross_revenue_amount) AS gross_revenue_by_transaction_status_fy2025\n  FROM base_data\n  WHERE\n    SAFE_CAST(financial_year AS STRING) = '2025'\n  GROUP BY\n    financial_year,\n    revenue_transaction_status\n),\n-- Metric 3: Gross Revenue for Specific Bookings by Revenue Transaction Status (FY2025)\nmetric_specific_bookings_fy2025 AS (\n  SELECT\n    financial_year,\n    revenue_transaction_status,\n    SUM(gross_revenue_amount) AS gross_revenue_specific_bookings_by_transaction_status_fy2025\n  FROM base_data\n  WHERE\n    SAFE_CAST(financial_year AS STRING) = '2025'\n    AND SAFE_CAST(booking_name AS STRING) IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024')\n  GROUP BY\n    financial_year,\n    revenue_transaction_status\n)\n-- Combine all metrics using FULL OUTER JOIN on common dimensions\nSELECT\n  COALESCE(m1.financial_year, m2.financial_year, m3.financial_year) AS financial_year,\n  m1.fy_year_month_number,\n  m1.financial_short_month,\n  m1.adsize_category,\n  COALESCE(m2.revenue_transaction_status, m3.revenue_transaction_status) AS revenue_transaction_status,\n  m1.gross_revenue_adsize_category_fy_period,\n  m2.gross_revenue_by_transaction_status_fy2025,\n  m3.gross_revenue_specific_bookings_by_transaction_status_fy2025\nFROM metric_adsize_category_fy_period AS m1\nFULL OUTER JOIN metric_transaction_status_fy2025 AS m2\n  ON SAFE_CAST(m1.financial_year AS STRING) = SAFE_CAST(m2.financial_year AS STRING)\nFULL OUTER JOIN metric_specific_bookings_fy2025 AS m3\n  ON SAFE_CAST(m2.financial_year AS STRING) = SAFE_CAST(m3.financial_year AS STRING)\n  AND SAFE_CAST(m2.revenue_transaction_status AS STRING) = SAFE_CAST(m3.revenue_transaction_status AS STRING)\nWHERE\n  COALESCE(m1.financial_year, m2.financial_year, m3.financial_year) IS NOT NULL\nORDER BY\n  financial_year DESC,\n  fy_year_month_number DESC,\n  financial_short_month DESC,\n  adsize_category,\n  revenue_transaction_status\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(fy_year_month_number AS INT64)) as unique_fy_year_month_numbers,\n  COUNT(DISTINCT SAFE_CAST(financial_short_month AS STRING)) as unique_financial_short_months,\n  COUNT(DISTINCT SAFE_CAST(revenue_transaction_status AS STRING)) as unique_revenue_transaction_statuses,\n  COUNT(DISTINCT SAFE_CAST(adsize_name AS STRING)) as unique_adsize_names,\n  COUNT(DISTINCT SAFE_CAST(booking_name AS STRING)) as unique_booking_names,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_amount_count,\n  SUM(CASE WHEN net_revenue IS NULL THEN 1 ELSE 0 END) AS null_net_revenue_count\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) >= 3 THEN 'PASS' ELSE 'FAIL' END as financial_year_range_test, -- Checks for -1, 0, 1 offset\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(revenue_transaction_status AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_transaction_statuses_test,\n  CASE WHEN SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as fy2025_data_present_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    financial_year,\n    fy_year_month_number,\n    financial_short_month,\n    adsize_name,\n    booking_name,\n    CASE\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship'\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production'\n      ELSE 'Media'\n    END AS adsize_category_derived,\n    gross_revenue_amount\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Adsize Category Derivation' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN adsize_category_derived IN ('Sponsorship', 'Production', 'Media') THEN 1 ELSE 0 END) as records_categorized,\n  SAFE_DIVIDE(SUM(CASE WHEN adsize_category_derived IN ('Sponsorship', 'Production', 'Media') THEN 1 ELSE 0 END), COUNT(*)) * 100 as categorization_rate_percentage,\n  'FY2025 Q1 Filter Coverage' as rule_name_2,\n  SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(fy_year_month_number AS INT64) IN (202501, 202502, 202503) THEN 1 ELSE 0 END) as records_in_fy2025_q1,\n  'Specific Booking Names Filter Coverage' as rule_name_3,\n  SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(booking_name AS STRING) IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024') THEN 1 ELSE 0 END) as records_in_specific_bookings_fy2025\nFROM base_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(fy_year_month_number AS INT64) as fy_year_month_number,\n  SAFE_CAST(financial_short_month AS STRING) as financial_short_month,\n  SAFE_CAST(adsize_name AS STRING) as adsize_name,\n  SAFE_CAST(booking_name AS STRING) as booking_name,\n  SAFE_CAST(revenue_transaction_status AS STRING) as revenue_transaction_status,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(net_revenue AS NUMERIC) as net_revenue,\n  relative_fy_year_offset\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\nORDER BY\n  financial_year DESC,\n  fy_year_month_number DESC,\n  gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""STRING"",
          ""context"": ""financial_year filter in all queries"",
          ""suggested_fix"": ""replace with a parameter or a function like GET_CURRENT_FINANCIAL_YEAR()"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202501, 202502, 202503"",
          ""original_format"": ""INT64"",
          ""context"": ""fy_year_month_number filter in query 1"",
          ""suggested_fix"": ""replace with parameters or relative month logic (e.g., first quarter of current FY)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'^(.*event sponsorship.*)$'"",
            ""'^(.*production.*)$'""
          ],
          ""context"": ""adsize_name categorization into 'Sponsorship', 'Production', 'Media'"",
          ""suggested_governance"": ""define adsize categories in a lookup table and join, or use a UDF for categorization logic"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_entities"",
          ""hardcoded_values"": [
            ""'Future Bradfield 2024'"",
            ""'Sydney & Brisbane Future Series'"",
            ""'Future Bradfield FY25 B1'"",
            ""'Future Sydney Bradfield 2024'""
          ],
          ""context"": ""booking_name filter in query 3"",
          ""suggested_governance"": ""manage specific booking names in a reference table or allow dynamic selection via dashboard controls"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""relative_offset"",
          ""hardcoded_values"": [
            ""-1"",
            ""0"",
            ""1""
          ],
          ""context"": ""relative_fy_year_offset filter in all queries"",
          ""suggested_governance"": ""while common, consider making the offset range configurable if business needs change frequently"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and months with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Externalize adsize categorization rules into a configuration table or a UDF for easier maintenance and consistency."",
      ""Manage specific booking names in a reference table to avoid hardcoding and enable dynamic filtering.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adsize_category"",
      ""metric_name"": ""Adsize Category"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of adsize_name into 'Sponsorship', 'Production', or 'Media' based on keyword matching."",
      ""sql_logic"": ""CASE WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship' WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production' ELSE 'Media' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to group ad revenue by type of ad event/production."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'^(.*event sponsorship.*)$'"",
        ""'^(.*production.*)$'"",
        ""'Sponsorship'"",
        ""'Production'"",
        ""'Media'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for miscategorization if adsize_name patterns change""
      ]
    },
    {
      ""metric_id"": ""gross_revenue_adsize_category_fy_period"",
      ""metric_name"": ""Gross Revenue by Adsize Category and Financial Period (Q1 FY2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""adsize_category""
      ],
      ""business_description"": ""Total gross revenue aggregated by financial short month, financial year-month number, and the derived adsize category, specifically for Q1 of FY2025."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year = '2025'"",
        ""fy_year_month_number IN (202501, 202502, 202503)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Provides insight into revenue distribution across different ad categories within a specific financial quarter."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""'2025'"",
        ""202501"",
        ""202502"",
        ""202503""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls if no data for a category/period""
      ]
    },
    {
      ""metric_id"": ""gross_revenue_by_transaction_status_fy2025"",
      ""metric_name"": ""Gross Revenue by Revenue Transaction Status (FY2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue aggregated by revenue transaction status for the financial year 2025."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year = '2025'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Helps understand the breakdown of revenue by its current transaction status (e.g., booked, invoiced, paid)."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""'2025'""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls if no data for a status""
      ]
    },
    {
      ""metric_id"": ""gross_revenue_specific_bookings_by_transaction_status_fy2025"",
      ""metric_name"": ""Gross Revenue for Specific Bookings by Revenue Transaction Status (FY2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for a specific set of booking names, aggregated by revenue transaction status for the financial year 2025."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year = '2025'"",
        ""booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Monitors revenue performance for key strategic or project-based bookings."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""'2025'""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Future Bradfield 2024'"",
        ""'Sydney & Brisbane Future Series'"",
        ""'Future Bradfield FY25 B1'"",
        ""'Future Sydney Bradfield 2024'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls if no data for a status or booking""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_by_transaction_status_fy2025"",
      ""related_metrics"": [
        ""gross_revenue_specific_bookings_by_transaction_status_fy2025""
      ],
      ""relationship_description"": ""The 'Gross Revenue for Specific Bookings' metric is a subset of the 'Gross Revenue by Transaction Status' metric, as it applies an additional filter on 'booking_name' while sharing the 'financial_year' and 'revenue_transaction_status' dimensions."",
      ""mathematical_formula"": ""Gross Revenue (Specific Bookings) <= Gross Revenue (All Bookings) for the same financial year and transaction status."",
      ""business_validation"": ""Ensures that revenue from specific projects/bookings is correctly accounted for as part of the overall revenue stream."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE_CAST(booking_name AS STRING) IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024') THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS specific_booking_revenue, SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_fy2025_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND relative_fy_year_offset IN (-1, 0, 1) HAVING specific_booking_revenue <= total_fy2025_revenue;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""component_of_total"",
      ""primary_metric"": ""gross_revenue_adsize_category_fy_period"",
      ""related_metrics"": [
        ""gross_revenue_by_transaction_status_fy2025""
      ],
      ""relationship_description"": ""Both metrics represent different slices of the total gross revenue for FY2025. The 'Adsize Category' metric focuses on a specific quarter (Q1 FY2025) and categorizes by ad type, while the 'Transaction Status' metric covers the full FY2025 and categorizes by revenue status."",
      ""mathematical_formula"": ""SUM(gross_revenue_adsize_category_fy_period for Q1) is a portion of SUM(gross_revenue_by_transaction_status_fy2025 for FY2025)."",
      ""business_validation"": ""Provides different perspectives on revenue performance, allowing for both quarterly operational analysis by ad type and annual financial status analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(fy_year_month_number AS INT64) IN (202501, 202502, 202503) THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS q1_fy2025_revenue, SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS total_fy2025_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE relative_fy_year_offset IN (-1, 0, 1) HAVING q1_fy2025_revenue <= total_fy2025_revenue;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,3
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f7a9efeb-df3c-45c9-899d-0bcada701572"",
    ""dashboard_name"": ""Salaries & Wages Dashboard UAT Version"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement;ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""weekly|second|mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year_week_number"",
      ""revenue_type""
    ],
    ""date_range_detected"": ""Not explicitly filtered by date range for main metrics; data freshness metric indicates latest load time."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'03'"",
      ""'Australia/Sydney'"",
      ""'Circulation'"",
      ""'Estimate'"",
      ""'RCTI'"",
      ""'THINK'"",
      ""'DTI'""
    ],
    ""governance_opportunities"": [
      ""The dashboard name 'Salaries & Wages' appears to be a mismatch with the query content which focuses on 'Circulation' and 'Finance' data. This should be reviewed for clarity or correct labeling."",
      ""Hardcoded '03' for revenue_type prefix should be replaced with a join to a governed lookup table for revenue types."",
      ""Hardcoded values like 'Circulation', 'Estimate', 'RCTI', 'THINK', 'DTI' should be managed via configuration tables or parameters."",
      ""The timezone 'Australia/Sydney' could be parameterized for broader applicability or consistency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  circulation_data AS (\n    SELECT\n      t0.amount AS amount,\n      t0.fy_year_week_number AS fy_year_week_number,\n      t0.revenue_type AS revenue_type,\n      t0.volume AS volume\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\n    WHERE\n      -- Assuming fy_year_week_number is a string like 'YYYYWW' or 'YYYY-WW'\n      -- Filter for recent data, e.g., last 2 years (approx 104 weeks) based on year part\n      SAFE_CAST(SUBSTR(t0.fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\n  ),\n  calculated_metrics AS (\n    SELECT\n      fy_year_week_number,\n      SAFE_CAST(amount AS NUMERIC) AS amount_numeric,\n      SAFE_CAST(volume AS INT64) AS volume_int,\n      SAFE.LEFT(revenue_type, 2) AS revenue_type_prefix\n    FROM\n      circulation_data\n  )\nSELECT\n  fy_year_week_number,\n  SUM(amount_numeric) AS total_amount,\n  SUM(volume_int) AS total_volume,\n  SUM(CASE WHEN revenue_type_prefix = '03' THEN amount_numeric ELSE 0 END) AS total_amount_type_03,\n  SUM(CASE WHEN revenue_type_prefix = '03' THEN volume_int ELSE 0 END) AS total_volume_type_03\nFROM\n  calculated_metrics\nGROUP BY\n  fy_year_week_number\nORDER BY\n  fy_year_week_number DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(fy_year_week_number AS STRING)) AS unique_fy_year_weeks,\n  COUNT(DISTINCT SAFE_CAST(revenue_type AS STRING)) AS unique_revenue_types,\n  MIN(SAFE_CAST(fy_year_week_number AS STRING)) AS earliest_fy_year_week,\n  MAX(SAFE_CAST(fy_year_week_number AS STRING)) AS latest_fy_year_week,\n  AVG(SAFE_CAST(amount AS NUMERIC)) AS avg_amount,\n  AVG(SAFE_CAST(volume AS INT64)) AS avg_volume\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE\n  -- Assuming fy_year_week_number is a string like 'YYYYWW' or 'YYYY-WW'\n  SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1;"",
    ""validation_sql"": ""WITH\n  circulation_data AS (\n    SELECT\n      t0.amount AS amount,\n      t0.fy_year_week_number AS fy_year_week_number,\n      t0.revenue_type AS revenue_type,\n      t0.volume AS volume\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\n    WHERE\n      SAFE_CAST(SUBSTR(t0.fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  )\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_amount_test,\n  CASE WHEN SUM(SAFE_CAST(volume AS INT64)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_volume_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(fy_year_week_number AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS week_dimension_test,\n  CASE WHEN COUNT(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_type_03_test\nFROM\n  circulation_data\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  circulation_data AS (\n    SELECT\n      t0.amount AS amount,\n      t0.fy_year_week_number AS fy_year_week_number,\n      t0.revenue_type AS revenue_type,\n      t0.volume AS volume\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\n    WHERE\n      SAFE_CAST(SUBSTR(t0.fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'revenue_type_03_logic' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN 1 ELSE 0 END) AS records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS percentage_matching_rule\nFROM\n  circulation_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(amount AS NUMERIC) AS amount,\n  SAFE_CAST(fy_year_week_number AS STRING) AS fy_year_week_number,\n  SAFE_CAST(revenue_type AS STRING) AS revenue_type,\n  SAFE_CAST(volume AS INT64) AS volume\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE\n  SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nORDER BY\n  fy_year_week_number DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'03'""
          ],
          ""context"": ""Revenue type prefix used in CASE statement to filter amount and volume."",
          ""suggested_governance"": ""Join to a `revenue_type_lookup` table that maps codes to descriptions."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Circulation'"",
            ""'Estimate'"",
            ""'RCTI'"",
            ""'THINK'"",
            ""'DTI'""
          ],
          ""context"": ""Filters applied to `finance_operating_statement` and `v_circulation_snapshot_fct` for data freshness metric."",
          ""suggested_governance"": ""Use a configuration table for source system names, scenarios, and sub-source system names."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""timezone"",
          ""hardcoded_values"": [
            ""'Australia/Sydney'""
          ],
          ""context"": ""Timezone used in `datetime` function for load timestamp."",
          ""suggested_governance"": ""Parameterize timezone or use a global configuration setting."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded lookup values (e.g., '03', 'Circulation', 'Estimate', 'RCTI', 'THINK', 'DTI') with joins to governed reference tables or dashboard parameters."",
      ""Parameterize the timezone ('Australia/Sydney') if the dashboard is intended for users in multiple timezones or if the business operates globally."",
      ""Consider adding a date range parameter for the main circulation data to allow users to select specific periods.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_amount"",
      ""metric_name"": ""Total Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the total financial amount (e.g., revenue) recorded in the `v_asl_circulation_dq_check` dataset, aggregated by fiscal year week number."",
      ""sql_logic"": ""SUM(t0.amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core financial metric used to track overall circulation revenue or financial inflows."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_volume"",
      ""metric_name"": ""Total Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the total volume (e.g., units, subscriptions) recorded in the `v_asl_circulation_dq_check` dataset, aggregated by fiscal year week number."",
      ""sql_logic"": ""SUM(t0.volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A core operational metric used to track the quantity of circulation activities."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_amount_type_03"",
      ""metric_name"": ""Total Amount (Revenue Type '03')"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_amount""
      ],
      ""business_description"": ""The sum of financial amounts specifically for transactions where the `revenue_type` starts with '03'. This isolates a particular category of revenue."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [
        ""SAFE.LEFT(revenue_type, 2) = '03'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for detailed analysis of specific revenue streams or product categories identified by the '03' prefix."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'03'""
      ],
      ""governance_issues"": [
        ""The hardcoded '03' should be replaced with a join to a governed reference table for revenue type codes.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_volume_type_03"",
      ""metric_name"": ""Total Volume (Revenue Type '03')"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_volume""
      ],
      ""business_description"": ""The sum of volumes specifically for transactions where the `revenue_type` starts with '03'. This isolates a particular category of volume."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [
        ""SAFE.LEFT(revenue_type, 2) = '03'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for detailed analysis of specific volume streams or product categories identified by the '03' prefix."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'03'""
      ],
      ""governance_issues"": [
        ""The hardcoded '03' should be replaced with a join to a governed reference table for revenue type codes.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""latest_data_load_timestamp"",
      ""metric_name"": ""Latest Data Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""max|datetime_trunc"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""none"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Indicates the most recent timestamp when the underlying financial data for 'Circulation' (specifically 'Estimate' scenario from 'RCTI', 'THINK', 'DTI' sub-systems) was loaded or updated from either `finance_operating_statement` or `v_circulation_snapshot_fct`."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(datetime(max(dw_prstn_load_timestamp), 'Australia/Sydney'), SECOND)) UNION ALL MIN(DATETIME_TRUNC(datetime(max(dw_bdm_load_timestamp), 'Australia/Sydney'), SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"",
        ""ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct""
      ],
      ""filters_applied"": [
        ""source_system_name = 'Circulation'"",
        ""scenario = 'Estimate'"",
        ""sub_source_system_name IN ('RCTI', 'THINK', 'DTI')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Crucial for monitoring data freshness and ensuring that reports are based on the most up-to-date information. Often displayed as a data quality indicator on dashboards."",
      ""metric_category"": ""operations"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Australia/Sydney'"",
        ""'Circulation'"",
        ""'Estimate'"",
        ""'RCTI'"",
        ""'THINK'"",
        ""'DTI'""
      ],
      ""governance_issues"": [
        ""Hardcoded values for source systems, scenarios, and sub-systems should be managed via configuration tables or parameters."",
        ""The timezone 'Australia/Sydney' should be parameterized for flexibility.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the underlying ETL/ELT processes updating the source tables."",
        ""Potential for stale data if load processes fail or are delayed.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_amount_type_03"",
      ""related_metrics"": [
        ""total_amount""
      ],
      ""relationship_description"": ""`total_amount_type_03` is a subset of `total_amount`, representing the amount specifically for transactions where `revenue_type` starts with '03'."",
      ""mathematical_formula"": ""total_amount_type_03 <= total_amount"",
      ""business_validation"": ""Ensures that the specific revenue category is correctly accounted for within the overall revenue, allowing for granular analysis without double-counting."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN SAFE_CAST(amount AS NUMERIC) ELSE 0 END) <= SUM(SAFE_CAST(amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_volume_type_03"",
      ""related_metrics"": [
        ""total_volume""
      ],
      ""relationship_description"": ""`total_volume_type_03` is a subset of `total_volume`, representing the volume specifically for transactions where `revenue_type` starts with '03'."",
      ""mathematical_formula"": ""total_volume_type_03 <= total_volume"",
      ""business_validation"": ""Ensures that the specific volume category is correctly accounted for within the overall volume, allowing for granular operational analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN SAFE_CAST(volume AS INT64) ELSE 0 END) <= SUM(SAFE_CAST(volume AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(SUBSTR(fy_year_week_number, 1, 4) AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,4
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""9269e9c6-1ad0-4415-96c3-aca8a710ba01"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 7,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""quarterly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_parent"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""sales_segment_l_2_name"",
      ""unified_publication_name"",
      ""revenue_group_subtype"",
      ""revenue_type""
    ],
    ""date_range_detected"": ""Primarily focused on Fiscal Year 2026 (July 2025 - June 2026) based on dashboard name and query filters. Specific hardcoded date '2025-06-23' is used as a reference point."",
    ""hardcoded_dates_found"": [
      ""2025-06-23""
    ],
    ""hardcoded_values_found"": [
      ""'Jul Q1 H1'"",
      ""'$\\'000'"",
      ""'$'"",
      ""'OUTSTREAM'"",
      ""'XTEND'"",
      ""'EDMEDIA'"",
      ""'ECOMMERCE'"",
      ""'Consortium QLD'"",
      ""'DOUBLECLICK'"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""0 (for relative_fy_year_offset)"",
      ""1 (for relative_fy_year_offset)""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())."",
      ""Fiscal year logic (relative_fy_year_offset, quarter to half-year mapping) should be defined in a governed date dimension table or a configuration."",
      ""Lookup values for 'unified_publication_name' categories, 'sales_segment_l_2_name', 'advertiser_parent' exclusions should use reference tables."",
      ""The '$\\'000' vs '$' logic for thousands conversion should be a proper boolean parameter or configuration, not a string comparison.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.advertiser_parent,\n    t0.financial_quarter,\n    t0.financial_short_month,\n    t0.booking_line_created_date,\n    t0.fix_date_lod,\n    t0.gross_revenue_amount,\n    t0.relative_fy_year_offset,\n    t0.revenue_group_subtype,\n    t0.revenue_type,\n    t0.sales_segment_l_2_name,\n    t0.sales_segment_l_2_name_sync,\n    t0.unified_publication_name\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Apply a reasonable date filter for performance, assuming recent data is relevant.\n  -- Given dashboard name \""FY26 (Interim)\"", let's filter for data relevant to FY26.\n  -- Assuming AU fiscal year starts July 1.\n  WHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE('2025-07-01')\n    AND SAFE_CAST(t0.booking_line_created_date AS DATE) < DATE('2026-07-01')\n    AND t0.gross_revenue_amount IS NOT NULL -- Exclude records without revenue for metric calculations\n),\nderived_dimensions AS (\n  SELECT\n    advertiser_parent,\n    financial_quarter,\n    financial_short_month,\n    booking_line_created_date,\n    fix_date_lod,\n    gross_revenue_amount,\n    relative_fy_year_offset,\n    revenue_group_subtype,\n    revenue_type,\n    sales_segment_l_2_name,\n    sales_segment_l_2_name_sync,\n    unified_publication_name,\n\n    -- Derived dimensions from Query 1/2\n    CONCAT('Q',SAFE_CAST(financial_quarter AS STRING)) AS quarter_display,\n    CASE\n      WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1'\n      WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2'\n      ELSE SAFE_CAST(financial_quarter AS STRING)\n    END AS half_year_display,\n    CONCAT(SAFE_CAST(financial_short_month AS STRING),' ',CONCAT('Q',SAFE_CAST(financial_quarter AS STRING)),' ',(CASE WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1' WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END)) AS combined_period_string,\n\n    -- Helper flags/values from Query 3\n    DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS report_reference_date,\n    DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY) AS report_reference_date_minus_365d,\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick_advertiser,\n    PARSE_DATE('%Y-%m-%d', booking_line_created_date) AS parsed_booking_line_created_date,\n    (relative_fy_year_offset = 0) AS is_current_fy_offset,\n    (relative_fy_year_offset = 1) AS is_previous_fy_offset,\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype,\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type,\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment,\n    UPPER(SAFE_CAST(unified_publication_name AS STRING)) AS unified_publication_name_upper\n  FROM base_data\n),\ncalculated_metrics AS (\n  SELECT\n    *,\n    -- Core revenue metrics\n    CASE WHEN is_current_fy_offset THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue,\n    CASE WHEN is_previous_fy_offset THEN gross_revenue_amount ELSE 0 END AS previous_fy_gross_revenue,\n\n    -- Complex effective date for LOD\n    CASE\n      WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment AND is_not_doubleclick_advertiser)\n      THEN SAFE_CAST(fix_date_lod AS DATE)\n      ELSE parsed_booking_line_created_date\n    END AS effective_date_for_lod,\n\n    -- Publication name category check\n    (unified_publication_name_upper IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) AS is_ecommerce_outstream_media\n  FROM derived_dimensions\n)\nSELECT\n  advertiser_parent,\n  financial_quarter,\n  financial_short_month,\n  quarter_display,\n  half_year_display,\n  combined_period_string,\n  sales_segment_l_2_name,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type,\n\n  SUM(current_fy_gross_revenue) AS total_current_fy_gross_revenue,\n  SUM(previous_fy_gross_revenue) AS total_previous_fy_gross_revenue,\n\n  -- Display metrics (assuming the hardcoded string comparison '$\\'000' = '$' evaluates to FALSE,\n  -- meaning the division by 1000 is applied for 'k' display)\n  SUM(CASE WHEN ('$\\'000' = '$') THEN current_fy_gross_revenue ELSE SAFE_DIVIDE(current_fy_gross_revenue, 1000) END) AS total_current_fy_gross_revenue_display,\n  SUM(CASE WHEN ('$\\'000' = '$') THEN previous_fy_gross_revenue ELSE SAFE_DIVIDE(previous_fy_gross_revenue, 1000) END) AS total_previous_fy_gross_revenue_display,\n\n  -- Conditional Gross Revenue (Display)\n  SUM(\n    CASE WHEN ('$\\'000' = '$') THEN\n      (CASE WHEN (CASE WHEN (is_current_fy_offset AND is_ecommerce_outstream_media) THEN gross_revenue_amount WHEN (is_current_fy_offset AND SAFE_CAST(effective_date_for_lod AS DATETIME) <= report_reference_date_minus_365d) THEN gross_revenue_amount ELSE NULL END) IS NULL THEN 0 ELSE (CASE WHEN (is_current_fy_offset AND is_ecommerce_outstream_media) THEN gross_revenue_amount WHEN (is_current_fy_offset AND SAFE_CAST(effective_date_for_lod AS DATETIME) <= report_reference_date_minus_365d) THEN gross_revenue_amount ELSE NULL END) END)\n    ELSE\n      SAFE_DIVIDE(\n        (CASE WHEN (CASE WHEN (is_current_fy_offset AND is_ecommerce_outstream_media) THEN gross_revenue_amount WHEN (is_current_fy_offset AND SAFE_CAST(effective_date_for_lod AS DATETIME) <= report_reference_date_minus_365d) THEN gross_revenue_amount ELSE NULL END) IS NULL THEN 0 ELSE (CASE WHEN (is_current_fy_offset AND is_ecommerce_outstream_media) THEN gross_revenue_amount WHEN (is_current_fy_offset AND SAFE_CAST(effective_date_for_lod AS DATETIME) <= report_reference_date_minus_365d) THEN gross_revenue_amount ELSE NULL END) END), 1000)\n    END\n  ) AS total_conditional_gross_revenue_display\n\nFROM calculated_metrics\nGROUP BY\n  advertiser_parent,\n  financial_quarter,\n  financial_short_month,\n  quarter_display,\n  half_year_display,\n  combined_period_string,\n  sales_segment_l_2_name,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type\nORDER BY\n  advertiser_parent ASC, financial_quarter ASC\nLIMIT 100\n;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.booking_line_created_date AS DATE)) as unique_booking_dates,\n  COUNT(DISTINCT t0.advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_quarter AS STRING)) as unique_financial_quarters,\n  COUNT(DISTINCT t0.sales_segment_l_2_name) as unique_sales_segments,\n  MIN(SAFE_CAST(t0.booking_line_created_date AS DATE)) as earliest_booking_date,\n  MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) as latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.advertiser_parent, SAFE_CAST(t0.booking_line_created_date AS STRING), SAFE_CAST(t0.gross_revenue_amount AS STRING))) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0 \nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_parent_test,\n  CASE WHEN MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN t0.relative_fy_year_offset = 0 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_offset_test,\n  CASE WHEN COUNT(CASE WHEN t0.sales_segment_l_2_name = 'Consortium QLD' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as consortium_qld_data_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'digital_revenue_logic_check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (t0.revenue_group_subtype = 'DIGITAL' AND t0.revenue_type = 'DIGITAL' AND t0.sales_segment_l_2_name_sync = 'Digital Other' AND t0.advertiser_parent != 'DOUBLECLICK') THEN 1 ELSE 0 END) as records_matching_digital_criteria,\n  SAFE_DIVIDE(SUM(CASE WHEN (t0.revenue_group_subtype = 'DIGITAL' AND t0.revenue_type = 'DIGITAL' AND t0.sales_segment_l_2_name_sync = 'Digital Other' AND t0.advertiser_parent != 'DOUBLECLICK') THEN 1 ELSE 0 END), COUNT(*)) * 100 as digital_criteria_pass_rate_percentage,\n  'thousands_conversion_logic_check' as rule_name_2,\n  SUM(CASE WHEN ('$\\'000' = '$') THEN 1 ELSE 0 END) as records_not_divided_by_1000,\n  SUM(CASE WHEN ('$\\'000' != '$') THEN 1 ELSE 0 END) as records_divided_by_1000\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(t0.booking_line_created_date AS DATE) as booking_date,\n  t0.advertiser_parent,\n  SAFE_CAST(t0.financial_quarter AS STRING) as financial_quarter,\n  t0.financial_short_month,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  t0.revenue_group_subtype,\n  t0.revenue_type,\n  t0.sales_segment_l_2_name,\n  t0.sales_segment_l_2_name_sync,\n  t0.unified_publication_name,\n  t0.fix_date_lod\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY SAFE_CAST(t0.booking_line_created_date AS DATE) DESC, t0.gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""2025-06-23 10:00:32.354880+00"",
          ""context"": ""Used as a fixed reference date for calculating relative dates (e.g., 365 days prior) and for filtering. This date seems to be the 'current' date for FY26 interim reporting."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter for the reporting date. If it's a specific FY end date, it should be derived from a fiscal calendar table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'$\\'000'"", ""'$'""],
          ""context"": ""Controls whether revenue amounts are divided by 1000. This is an unusual way to implement a 'thousands' toggle."",
          ""suggested_governance"": ""Implement a boolean parameter (e.g., `show_in_thousands BOOLEAN`) in Looker Studio or a configuration table to control this conversion."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'OUTSTREAM'"", ""'XTEND'"", ""'EDMEDIA'"", ""'ECOMMERCE'""],
          ""context"": ""Specific categories of 'unified_publication_name' used in a filter for 'clmn27_'."",
          ""suggested_governance"": ""Create a reference table for 'unified_publication_name_categories' or define these as a Looker Studio parameter list."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Consortium QLD'""],
          ""context"": ""Specific 'sales_segment_l_2_name' used as a filter."",
          ""suggested_governance"": ""Create a reference table for 'sales_segments' or define as a Looker Studio parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""exclusions"",
          ""hardcoded_values"": [""'DOUBLECLICK'""],
          ""context"": ""Specific 'advertiser_parent' excluded from some calculations."",
          ""suggested_governance"": ""Create a reference table for 'excluded_advertisers' or define as a Looker Studio parameter."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""0"", ""1""],
          ""context"": ""Used for 'relative_fy_year_offset' to distinguish current (0) vs. previous (1) fiscal year revenue."",
          ""suggested_governance"": ""Document these values clearly or derive them from a fiscal calendar table that explicitly defines 'current_fy_offset' and 'previous_fy_offset'."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'DIGITAL'"", ""'Digital Other'""],
          ""context"": ""Used for 'revenue_group_subtype', 'revenue_type', and 'sales_segment_l_2_name_sync' in conditional logic."",
          ""suggested_governance"": ""Define these categories in a lookup table if they are subject to change or need more detailed definitions."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Jul Q1 H1'""],
          ""context"": ""Specific combined period string used as a filter for advertiser_parent."",
          ""suggested_governance"": ""This complex string should be derived from date parameters (e.g., selected month, quarter, half-year) rather than hardcoded."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `_DS_START_DATE`, `_DS_END_DATE`) or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Introduce a boolean parameter for 'Show in Thousands' to control the /1000 division."",
      ""Replace hardcoded lookup values for 'unified_publication_name' categories, 'sales_segment_l_2_name', and 'advertiser_parent' exclusions with joins to governed reference tables or Looker Studio parameters."",
      ""Define fiscal year logic (quarter to half-year mapping, relative year offsets) in a dedicated date dimension table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_parent"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The top-level parent entity for an advertiser."",
      ""sql_logic"": ""t0.advertiser_parent"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""clmn11_ IN ('Jul Q1 H1')"", ""clmn1_ != 'DOUBLECLICK'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping sales performance by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'DOUBLECLICK'""],
      ""governance_issues"": [""'DOUBLECLICK' should be managed via a lookup table or parameter.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter of the transaction."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for time-based grouping and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The abbreviated financial month of the transaction."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for time-based grouping and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""quarter_display"",
      ""metric_name"": ""Quarter Display"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""financial_quarter""],
      ""business_description"": ""Formatted quarter string (e.g., 'Q1')."",
      ""sql_logic"": ""CONCAT('Q',SAFE_CAST(financial_quarter AS STRING))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for display and filtering by quarter."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""half_year_display"",
      ""metric_name"": ""Half Year Display"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""financial_quarter""],
      ""business_description"": ""Determines if the quarter falls into H1 (Q1, Q2) or H2 (Q3, Q4)."",
      ""sql_logic"": ""CASE WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1' WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for display and filtering by half-year periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1"", ""2"", ""3"", ""4"", ""'H1'"", ""'H2'""],
      ""governance_issues"": [""Quarter to half-year mapping should be in a governed fiscal calendar.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""combined_period_string"",
      ""metric_name"": ""Combined Period String"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""financial_short_month"", ""quarter_display"", ""half_year_display""],
      ""business_description"": ""A concatenated string representing the month, quarter, and half-year (e.g., 'Jul Q1 H1')."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(financial_short_month AS STRING),' ',quarter_display,' ',half_year_display)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""combined_period_string IN ('Jul Q1 H1')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a primary filter for selecting specific reporting periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Jul Q1 H1'""],
      ""governance_issues"": [""This filter value should be dynamic, derived from dashboard date/period selections.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for a booking line."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Base metric for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential nulls or zero values that need handling.""]
    },
    {
      ""metric_id"": ""relative_fy_year_offset"",
      ""metric_name"": ""Relative FY Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Indicates the fiscal year relative to the current reporting year (0 for current, 1 for previous)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for distinguishing current vs. previous year revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""1""],
      ""governance_issues"": [""The meaning of 0 and 1 should be explicitly documented or derived from a fiscal calendar.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount"", ""relative_fy_year_offset""],
      ""business_description"": ""Gross revenue attributed to the current fiscal year (where relative_fy_year_offset is 0)."",
      ""sql_logic"": ""CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key performance indicator for current period sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount"", ""relative_fy_year_offset""],
      ""business_description"": ""Gross revenue attributed to the previous fiscal year (where relative_fy_year_offset is 1)."",
      ""sql_logic"": ""CASE WHEN (relative_fy_year_offset = 1) THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key performance indicator for year-over-year sales comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_display"",
      ""metric_name"": ""Current FY Gross Revenue (Display)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""current_fy_gross_revenue""],
      ""business_description"": ""Current FY Gross Revenue, potentially divided by 1000 based on a hardcoded display setting."",
      ""sql_logic"": ""CASE WHEN ('$\\'000' = '$') THEN current_fy_gross_revenue ELSE SAFE_DIVIDE(current_fy_gross_revenue, 1000) END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""The final displayed value for current year revenue, adjusted for thousands."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'$\\'000'"", ""'$'""],
      ""governance_issues"": [""The '$\\'000' vs '$' logic should be replaced by a proper boolean parameter.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_display"",
      ""metric_name"": ""Previous FY Gross Revenue (Display)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""previous_fy_gross_revenue""],
      ""business_description"": ""Previous FY Gross Revenue, potentially divided by 1000 based on a hardcoded display setting."",
      ""sql_logic"": ""CASE WHEN ('$\\'000' = '$') THEN previous_fy_gross_revenue ELSE SAFE_DIVIDE(previous_fy_gross_revenue, 1000) END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""The final displayed value for previous year revenue, adjusted for thousands."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'$\\'000'"", ""'$'""],
      ""governance_issues"": [""The '$\\'000' vs '$' logic should be replaced by a proper boolean parameter.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""conditional_gross_revenue_display"",
      ""metric_name"": ""Conditional Gross Revenue (Display)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""gross_revenue_amount"", ""relative_fy_year_offset"", ""unified_publication_name"", ""fix_date_lod"", ""booking_line_created_date"", ""advertiser_parent"", ""revenue_group_subtype"", ""revenue_type"", ""sales_segment_l_2_name_sync""],
      ""business_description"": ""A complex calculated revenue amount, potentially divided by 1000, based on multiple conditions including FY offset, publication name categories, and date comparisons. This metric appears to be a specific revenue type for digital/ecommerce."",
      ""sql_logic"": ""CASE WHEN ('$\\'000' = '$') THEN (CASE WHEN (CASE WHEN (relative_fy_year_offset = 0) THEN 1 ELSE 0 END = 1 AND UPPER(SAFE_CAST(unified_publication_name AS STRING)) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) THEN gross_revenue_amount WHEN (CASE WHEN (relative_fy_year_offset = 0) THEN 1 ELSE 0 END = 1 AND SAFE_CAST( (CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END) AS DATETIME) <= DATETIME_ADD(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney'), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE NULL END) ELSE SAFE_DIVIDE((CASE WHEN (CASE WHEN (relative_fy_year_offset = 0) THEN 1 ELSE 0 END = 1 AND UPPER(SAFE_CAST(unified_publication_name AS STRING)) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) THEN gross_revenue_amount WHEN (CASE WHEN (relative_fy_year_offset = 0) THEN 1 ELSE 0 END = 1 AND SAFE_CAST( (CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END) AS DATETIME) <= DATETIME_ADD(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney'), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE NULL END), 1000) END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A specific revenue calculation likely used for a particular segment or reporting requirement, possibly related to digital/ecommerce revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025-06-23""],
      ""hardcoded_values_in_metric"": [""'$\\'000'"", ""'$'"", ""'OUTSTREAM'"", ""'XTEND'"", ""'EDMEDIA'"", ""'ECOMMERCE'"", ""'DIGITAL'"", ""'Digital Other'"", ""'DOUBLECLICK'"", ""0""],
      ""governance_issues"": [""Hardcoded date, thousands logic, and category lists should be parameterized or governed.""],
      ""data_quality_concerns"": [""Complex logic might lead to unexpected nulls or misinterpretations if underlying data changes.""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_gross_revenue_display"",
      ""related_metrics"": [""current_fy_gross_revenue""],
      ""relationship_description"": ""The display version of current FY gross revenue depends on the raw current FY gross revenue and a hardcoded 'thousands' toggle."",
      ""mathematical_formula"": ""current_fy_gross_revenue_display = current_fy_gross_revenue / 1000 (conditional)"",
      ""business_validation"": ""Ensures revenue is presented in the desired scale (e.g., thousands)."",
      ""validation_sql"": ""SELECT SUM(current_fy_gross_revenue_display * 1000) = SUM(current_fy_gross_revenue) FROM your_table WHERE '$\\'000' != '$'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""previous_fy_gross_revenue_display"",
      ""related_metrics"": [""previous_fy_gross_revenue""],
      ""relationship_description"": ""The display version of previous FY gross revenue depends on the raw previous FY gross revenue and a hardcoded 'thousands' toggle."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_display = previous_fy_gross_revenue / 1000 (conditional)"",
      ""business_validation"": ""Ensures revenue is presented in the desired scale (e.g., thousands)."",
      ""validation_sql"": ""SELECT SUM(previous_fy_gross_revenue_display * 1000) = SUM(previous_fy_gross_revenue) FROM your_table WHERE '$\\'000' != '$'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_parent"",
      ""related_metrics"": [""combined_period_string""],
      ""relationship_description"": ""The list of 'advertiser_parent' values is filtered by a specific 'combined_period_string' ('Jul Q1 H1'). This implies a dashboard filter or control that affects the available advertisers."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures only relevant advertisers for the selected period are shown."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT advertiser_parent) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE CONCAT(SAFE_CAST(financial_short_month AS STRING),' ',CONCAT('Q',SAFE_CAST(financial_quarter AS STRING)),' ',(CASE WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1' WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END)) = 'Jul Q1 H1'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""sales_segment_l_2_name"",
      ""related_metrics"": [""current_fy_gross_revenue_display"", ""previous_fy_gross_revenue_display"", ""conditional_gross_revenue_display""],
      ""relationship_description"": ""All revenue metrics are filtered by 'sales_segment_l_2_name' being 'Consortium QLD'. This implies a dashboard filter or chart-specific filter."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures revenue metrics are specific to the 'Consortium QLD' segment."",
      ""validation_sql"": ""SELECT SUM(current_fy_gross_revenue_display) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE sales_segment_l_2_name = 'Consortium QLD'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,5
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""bb49fa78-5abe-4e68-a9c1-8172a832e724"",
    ""dashboard_name"": ""optimization"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""masthead_group"",
      ""finance_recognition"",
      ""fy_year"",
      ""fy_month_of_year"",
      ""fy_quarter_of_year"",
      ""fy_week_of_year""
    ],
    ""date_range_detected"": ""Fiscal Year 2024-2025, specifically Week 37 and Week 38"",
    ""hardcoded_dates_found"": [
      ""2025-03-26"",
      ""2025-03-25"",
      ""2024-07-03""
    ],
    ""hardcoded_values_found"": [
      ""2025"",
      ""2024"",
      ""'Discontinued'"",
      ""'Digital Recognition'"",
      ""1=1"",
      ""1=2"",
      ""1=3"",
      ""1=4"",
      ""0=0"",
      ""clmn19_ <= 2"",
      ""clmn10_ <= 2"",
      ""custom fiscal week buckets (e.g., <=4, <=9, <=13)""
    ],
    ""governance_opportunities"": [
      ""Dates used for 'current week' calculation should be parameterized or use relative date functions (e.g., CURRENT_DATE())."",
      ""Fiscal years (2025, 2024) should be parameterized or derived dynamically."",
      ""Filter values ('Discontinued', 'Digital Recognition') should be managed via a reference table or dashboard parameters."",
      ""The '1=X' logic in Query 3 makes the 'Dashboard View Type' static. This should be replaced by Looker Studio's native parameter controls for dynamic view selection.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.BudgetEarnedAmount,\n    t0.ClosingBase,\n    t0.EarnedAmount,\n    t0.ForecastBudgetEarnedAmount,\n    t0.NFEarnedAmount,\n    t0.NYBudgetEarnedAmount,\n    t0.OpeningBase,\n    t0.finance_recognition,\n    t0.fy_month_of_year,\n    t0.fy_quarter_of_year,\n    t0.fy_week_of_year,\n    t0.fy_year,\n    t0.masthead_group,\n    -- Derived week for Q1 (based on 2025-03-26, Wednesday, week 38)\n    CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP('2025-03-26 03:31:44.896010+00', 'Australia/Sydney')) - 1) <= 2\n         THEN DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1\n         ELSE DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)\n    END AS derived_week_q1,\n    -- Derived week for Q2 (based on 2025-03-25, Tuesday, week 37)\n    CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP('2025-03-25 23:59:29.736172+00', 'Australia/Sydney')) - 1) <= 2\n         THEN DATETIME_DIFF(SAFE_CAST(DATE '2025-03-25' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1\n         ELSE DATETIME_DIFF(SAFE_CAST(DATE '2025-03-25' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)\n    END AS derived_week_q2\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\n  WHERE\n    t0.masthead_group != 'Discontinued'\n    AND t0.finance_recognition = 'Digital Recognition'\n)\nSELECT\n  -- Metrics from Query 1 (FY2025, Week 38, and FY2024, Week 38)\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q1 THEN BudgetEarnedAmount ELSE 0 END) AS budget_earned_amount_fy25_wk38,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q1 THEN EarnedAmount ELSE NULL END) AS earned_amount_fy25_wk38,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q1 THEN ClosingBase ELSE 0 END) AS closing_base_fy25_wk38,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q1 THEN OpeningBase ELSE 0 END) AS opening_base_fy25_wk38,\n  (SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN ClosingBase ELSE 0 END) - SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN OpeningBase ELSE 0 END)) AS net_change_fy24_wk38,\n  \n  -- Metrics from Query 2 (FY2025, Week 37)\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q2 THEN ClosingBase ELSE 0 END) AS closing_base_fy25_wk37,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q2 THEN OpeningBase ELSE 0 END) AS opening_base_fy25_wk37,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q2 THEN EarnedAmount ELSE NULL END) AS earned_amount_fy25_wk37,\n  MAX(CASE WHEN fy_year = 2025 AND fy_week_of_year = derived_week_q2 THEN 1 ELSE 0 END) AS current_week_flag_fy25_wk37,\n  \n  -- Metrics from Query 3 (Dashboard View Type)\n  'Week to Date & Budget View' AS dashboard_view_type,\n  COUNT(DISTINCT 'Week to Date & Budget View') AS distinct_view_types_count\nFROM base_data\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(fy_year AS STRING) || '-' || SAFE_CAST(fy_week_of_year AS STRING)) AS unique_fiscal_weeks,\n  COUNT(DISTINCT masthead_group) AS unique_masthead_groups,\n  COUNT(DISTINCT finance_recognition) AS unique_finance_recognitions,\n  MIN(fy_year) AS earliest_fy_year,\n  MAX(fy_year) AS latest_fy_year,\n  APPROX_COUNT_DISTINCT(SAFE_CAST(fy_year AS STRING) || '-' || SAFE_CAST(fy_month_of_year AS STRING) || '-' || SAFE_CAST(fy_week_of_year AS STRING) || '-' || masthead_group || '-' || finance_recognition) AS approx_unique_grain_records\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(BudgetEarnedAmount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS budget_earned_amount_test,\n  CASE WHEN SUM(SAFE_CAST(EarnedAmount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS earned_amount_test,\n  CASE WHEN COUNT(DISTINCT masthead_group) > 1 THEN 'PASS' ELSE 'FAIL' END AS masthead_group_diversity_test,\n  CASE WHEN MAX(fy_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(CASE WHEN masthead_group = 'Discontinued' THEN 1 END) = 0 THEN 'PASS' ELSE 'FAIL' END AS discontinued_filter_test,\n  CASE WHEN COUNT(CASE WHEN finance_recognition = 'Digital Recognition' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS digital_recognition_filter_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'finance_recognition_filter' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE WHEN finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END) AS records_matching_digital_recognition,\n  SAFE_DIVIDE(SUM(CASE WHEN finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS digital_recognition_percentage,\n  'masthead_group_exclusion' AS rule_name_2,\n  SUM(CASE WHEN masthead_group = 'Discontinued' THEN 1 ELSE 0 END) AS records_matching_discontinued,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead_group = 'Discontinued' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS discontinued_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(fy_year AS INT64) AS fy_year,\n  SAFE_CAST(fy_month_of_year AS INT64) AS fy_month_of_year,\n  SAFE_CAST(fy_week_of_year AS INT64) AS fy_week_of_year,\n  masthead_group,\n  finance_recognition,\n  SAFE_CAST(BudgetEarnedAmount AS NUMERIC) AS BudgetEarnedAmount,\n  SAFE_CAST(EarnedAmount AS NUMERIC) AS EarnedAmount,\n  SAFE_CAST(ForecastBudgetEarnedAmount AS NUMERIC) AS ForecastBudgetEarnedAmount,\n  SAFE_CAST(NFEarnedAmount AS NUMERIC) AS NFEarnedAmount,\n  SAFE_CAST(NYBudgetEarnedAmount AS NUMERIC) AS NYBudgetEarnedAmount,\n  SAFE_CAST(ClosingBase AS NUMERIC) AS ClosingBase,\n  SAFE_CAST(OpeningBase AS NUMERIC) AS OpeningBase\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  AND masthead_group != 'Discontinued'\n  AND finance_recognition = 'Digital Recognition'\nORDER BY fy_year DESC, fy_week_of_year DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-03-26"",
          ""original_format"": ""2025-03-26 03:31:44.896010+00"",
          ""context"": ""Used as the reference date for calculating 'current' fiscal week (Week 38) in Query 1."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard parameter for dynamic 'current week' calculation."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-03-25"",
          ""original_format"": ""2025-03-25 23:59:29.736172+00"",
          ""context"": ""Used as the reference date for calculating 'current' fiscal week (Week 37) in Query 2."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard parameter for dynamic 'current week' calculation."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the baseline date for `DATETIME_DIFF` to calculate week numbers from the start of a fiscal year/period."",
          ""suggested_fix"": ""This might be a fixed fiscal year start date. If so, it should be documented. If it's meant to be dynamic, it should be parameterized or derived from a fiscal calendar table."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'Discontinued'"",
            ""'Digital Recognition'""
          ],
          ""context"": ""Used to filter `masthead_group` and `finance_recognition`."",
          ""suggested_governance"": ""These values should be managed in a reference table (e.g., `dim_masthead_status`, `dim_finance_recognition_type`) and joined, or exposed as dashboard parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""fiscal_years"",
          ""hardcoded_values"": [
            ""2025"",
            ""2024""
          ],
          ""context"": ""Used to filter data for specific fiscal years (current and prior)."",
          ""suggested_governance"": ""Replace with dynamic calculations (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`, `EXTRACT(YEAR FROM CURRENT_DATE()) - 1`) or dashboard parameters for selecting fiscal years."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""conditional_logic_flags"",
          ""hardcoded_values"": [
            ""1 = 1"",
            ""1 = 2"",
            ""1 = 3"",
            ""1 = 4"",
            ""0 = 0""
          ],
          ""context"": ""Used extensively in `CASE WHEN` statements to select specific branches of logic. In Query 3, this makes the 'Dashboard View Type' static."",
          ""suggested_governance"": ""This pattern often indicates Looker Studio's internal parameter handling. If the dashboard is intended to be dynamic, these conditions should be replaced by actual parameter values passed from Looker Studio. If static, the `CASE WHEN` can be simplified."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""custom_fiscal_week_buckets"",
          ""hardcoded_values"": [
            ""clmn30_ <= 4"",
            ""clmn30_ <= 9"",
            ""clmn30_ <= 13"",
            ""clmn30_ <= 17"",
            ""clmn30_ <= 22"",
            ""clmn30_ <= 26"",
            ""clmn30_ <= 30"",
            ""clmn30_ <= 35"",
            ""clmn30_ <= 39"",
            ""clmn30_ <= 43"",
            ""clmn30_ <= 48"",
            ""clmn30_ <= 53""
          ],
          ""context"": ""Used to categorize fiscal weeks into custom periods (e.g., for reporting cycles)."",
          ""suggested_governance"": ""These bucketing rules should be defined in a dedicated fiscal calendar dimension table or a configuration table, rather than hardcoded in queries. This allows for easier updates and consistency across reports."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-03-26', '2025-03-25') with Looker Studio date parameters or relative date functions like `CURRENT_DATE()` to ensure the dashboard always reflects current data."",
      ""Replace hardcoded fiscal years (e.g., 2025, 2024) with dynamic derivations (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`) or parameters to allow users to select reporting periods."",
      ""Externalize filter values ('Discontinued', 'Digital Recognition') into a configuration table or use Looker Studio controls for dynamic filtering."",
      ""Refactor the `1=X` conditional logic in Query 3 to leverage Looker Studio's native parameter and control features, enabling users to truly switch between 'view types' rather than having a static output.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""budget_earned_amount_fy25_wk38"",
      ""metric_name"": ""Budget Earned Amount (FY2025, Week 38)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total budgeted earned amount for fiscal year 2025, specifically for week 38. This represents the target revenue for that period."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 38 THEN t0.BudgetEarnedAmount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to compare actual performance against financial targets for a specific week."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-26"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""38""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": [
        ""potential nulls if BudgetEarnedAmount is not always populated""
      ]
    },
    {
      ""metric_id"": ""earned_amount_fy25_wk38"",
      ""metric_name"": ""Earned Amount (FY2025, Week 38)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total actual earned amount (revenue) for fiscal year 2025, specifically for week 38."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 38 THEN t0.EarnedAmount ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core revenue metric, used for performance tracking against budget and forecasts."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-26"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""38""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": [
        ""potential nulls if EarnedAmount is not always populated""
      ]
    },
    {
      ""metric_id"": ""closing_base_fy25_wk38"",
      ""metric_name"": ""Closing Base (FY2025, Week 38)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total closing base value for fiscal year 2025, week 38. This likely represents the end-of-period value of a financial base."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 38 THEN t0.ClosingBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in conjunction with opening base to calculate net change or growth."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-26"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""38""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""opening_base_fy25_wk38"",
      ""metric_name"": ""Opening Base (FY2025, Week 38)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total opening base value for fiscal year 2025, week 38. This likely represents the start-of-period value of a financial base."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 38 THEN t0.OpeningBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in conjunction with closing base to calculate net change or growth."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-26"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""38""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_change_fy24_wk38"",
      ""metric_name"": ""Net Change (FY2024, Week 38)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""closing_base_fy24_wk38"",
        ""opening_base_fy24_wk38""
      ],
      ""business_description"": ""The net change (Closing Base - Opening Base) for fiscal year 2024, week 38. This represents the growth or decline in the base from the prior year's corresponding week."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2024 AND t0.fy_week_of_year = 38 THEN t0.ClosingBase ELSE 0 END) - SUM(CASE WHEN t0.fy_year = 2024 AND t0.fy_week_of_year = 38 THEN t0.OpeningBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Crucial for year-on-year performance comparison and identifying trends in the financial base."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-26"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2024"",
        ""38""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": [
        ""potential for negative values if OpeningBase is greater than ClosingBase""
      ]
    },
    {
      ""metric_id"": ""closing_base_fy25_wk37"",
      ""metric_name"": ""Closing Base (FY2025, Week 37)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total closing base value for fiscal year 2025, week 37. This likely represents the end-of-period value of a financial base for a different week."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 37 THEN t0.ClosingBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in conjunction with opening base to calculate net change or growth for a specific week, potentially a 'week-to-date' or 'prior week' context."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-25"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""37""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""opening_base_fy25_wk37"",
      ""metric_name"": ""Opening Base (FY2025, Week 37)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total opening base value for fiscal year 2025, week 37. This likely represents the start-of-period value of a financial base for a different week."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 37 THEN t0.OpeningBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in conjunction with closing base to calculate net change or growth for a specific week, potentially a 'week-to-date' or 'prior week' context."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-25"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""37""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""earned_amount_fy25_wk37"",
      ""metric_name"": ""Earned Amount (FY2025, Week 37)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total actual earned amount (revenue) for fiscal year 2025, specifically for week 37."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 37 THEN t0.EarnedAmount ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core revenue metric, used for performance tracking for a specific week, potentially a 'week-to-date' or 'prior week' context."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-25"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""37""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": [
        ""potential nulls if EarnedAmount is not always populated""
      ]
    },
    {
      ""metric_id"": ""current_week_flag_fy25_wk37"",
      ""metric_name"": ""Current Week Flag (FY2025, Week 37)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag (1 if true, 0 if false) indicating if the data corresponds to fiscal year 2025, week 37. Used as a boolean indicator."",
      ""sql_logic"": ""MAX(CASE WHEN t0.fy_year = 2025 AND t0.fy_week_of_year = 37 THEN 1 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely used for conditional formatting or to highlight data for the specific week being analyzed."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-25"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025"",
        ""37""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""fiscal year and week should be dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dashboard_view_type"",
      ""metric_name"": ""Dashboard View Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""dashboard"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A descriptive label indicating the current view configuration of the dashboard. Due to hardcoded logic, it always evaluates to 'Week to Date & Budget View'."",
      ""sql_logic"": ""CASE WHEN (1 = 1) AND (1 = 1) THEN 'Week to Date & Budget View' WHEN (1 = 1) AND (1 = 2) THEN 'Week to Date & Forecast View' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Intended to provide context for the displayed data, but currently static."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Week to Date & Budget View'"",
        ""1=1"",
        ""1=2"",
        ""1=3"",
        ""1=4""
      ],
      ""governance_issues"": [
        ""hardcoded values make this metric static; should be dynamic via parameters""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""distinct_view_types_count"",
      ""metric_name"": ""Distinct Dashboard View Types Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""dashboard"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""dashboard_view_type""
      ],
      ""business_description"": ""Counts the number of unique dashboard view types. Due to the static nature of 'dashboard_view_type', this will always be 1."",
      ""sql_logic"": ""COUNT(DISTINCT clmn5_)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A diagnostic metric for the dashboard's configurability, currently indicating a lack of dynamic view selection."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""derived from a static metric, limiting its utility""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""all_metrics"",
      ""related_metrics"": [
        ""budget_earned_amount_fy25_wk38"",
        ""earned_amount_fy25_wk38"",
        ""closing_base_fy25_wk38"",
        ""opening_base_fy25_wk38"",
        ""net_change_fy24_wk38"",
        ""closing_base_fy25_wk37"",
        ""opening_base_fy25_wk37"",
        ""earned_amount_fy25_wk37"",
        ""current_week_flag_fy25_wk37"",
        ""dashboard_view_type"",
        ""distinct_view_types_count""
      ],
      ""relationship_description"": ""All identified metrics are filtered by `masthead_group != 'Discontinued'` and `finance_recognition = 'Digital Recognition'`. This ensures only relevant digital subscription data is included."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the dashboard focuses on active digital subscriptions and excludes discontinued products, providing a clean view of current performance."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN masthead_group = 'Discontinued' THEN 1 ELSE 0 END) AS discontinued_records_count,\n  SUM(CASE WHEN finance_recognition != 'Digital Recognition' THEN 1 ELSE 0 END) AS non_digital_recognition_records_count\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""net_change_fy24_wk38"",
      ""related_metrics"": [
        ""closing_base_fy24_wk38"",
        ""opening_base_fy24_wk38""
      ],
      ""relationship_description"": ""Net Change (FY2024, Week 38) is calculated as the difference between Closing Base and Opening Base for the specified prior fiscal period."",
      ""mathematical_formula"": ""Net Change = Closing Base - Opening Base"",
      ""business_validation"": ""This calculation provides insight into the growth or decline of the subscription base for the prior year's corresponding week, enabling year-on-year comparison."",
      ""validation_sql"": ""WITH base_data AS (\n  SELECT\n    t0.ClosingBase,\n    t0.OpeningBase,\n    t0.finance_recognition,\n    t0.fy_week_of_year,\n    t0.fy_year,\n    t0.masthead_group,\n    CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP('2025-03-26 03:31:44.896010+00', 'Australia/Sydney')) - 1) <= 2\n         THEN DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1\n         ELSE DATETIME_DIFF(SAFE_CAST(DATE '2025-03-26' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)\n    END AS derived_week_q1\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\n  WHERE\n    t0.masthead_group != 'Discontinued'\n    AND t0.finance_recognition = 'Digital Recognition'\n)\nSELECT\n  SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN ClosingBase ELSE 0 END) - SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN OpeningBase ELSE 0 END) AS calculated_net_change,\n  SUM(CASE WHEN fy_year = 2024 AND fy_week_of_year = derived_week_q1 THEN ClosingBase - OpeningBase ELSE 0 END) AS direct_net_change_sum\nFROM base_data\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""conditional_selection"",
      ""primary_metric"": ""all_metrics_with_fy_week_filter"",
      ""related_metrics"": [
        ""budget_earned_amount_fy25_wk38"",
        ""earned_amount_fy25_wk38"",
        ""closing_base_fy25_wk38"",
        ""opening_base_fy25_wk38"",
        ""net_change_fy24_wk38"",
        ""closing_base_fy25_wk37"",
        ""opening_base_fy25_wk37"",
        ""earned_amount_fy25_wk37"",
        ""current_week_flag_fy25_wk37""
      ],
      ""relationship_description"": ""Metrics are conditionally summed based on specific `fy_year` and `fy_week_of_year` values, which are derived from hardcoded dates (2025-03-26 for Week 38, 2025-03-25 for Week 37)."",
      ""mathematical_formula"": ""SUM(CASE WHEN fy_year = [YEAR] AND fy_week_of_year = [WEEK] THEN [METRIC_COLUMN] ELSE 0 END)"",
      ""business_validation"": ""This logic isolates data for specific reporting periods (e.g., 'current week', 'prior year same week'). The hardcoded dates make these calculations static and require manual updates or parameterization for ongoing relevance."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = 38 THEN EarnedAmount ELSE 0 END) AS earned_amount_wk38,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = 37 THEN EarnedAmount ELSE 0 END) AS earned_amount_wk37\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE masthead_group != 'Discontinued' AND finance_recognition = 'Digital Recognition'\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,6
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6a26c78f-0070-4fb3-88b8-691ee4a4485a"",
    ""dashboard_name"": ""Circ Budget Revenue Weekly Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 9,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_quarter"",
      ""os_level_8_category"",
      ""publication_standardized"",
      ""state_region_derived"",
      ""channel_group"",
      ""publication_group"",
      ""period_label"",
      ""day_of_week_group"",
      ""fiscal_month"",
      ""fiscal_week""
    ],
    ""date_range_detected"": ""FY2025 (Fiscal Year 2025)"",
    ""hardcoded_dates_found"": [
      ""2025-04-15"",
      ""2024-07-03""
    ],
    ""hardcoded_values_found"": [
      ""CIRCULATION"",
      ""FY2025"",
      ""CP"",
      ""PY"",
      ""Free News & Lifestyle"",
      ""Food"",
      ""Prestige"",
      ""DTI Free Copies"",
      ""Retail"",
      ""ALL SALES CHANNELS"",
      ""PNG"",
      ""6 Day Pubs"",
      ""M-F"",
      ""SAT"",
      ""Sun"",
      ""YTD"",
      ""The Daily Telegraph"",
      ""The Herald Sun"",
      ""The Advertiser"",
      ""Courier Mail"",
      ""Weekly Times"",
      ""The Australian"",
      ""The Sportsman"",
      ""Mercury"",
      ""Northern Territory News"",
      ""Geelong Advertiser"",
      ""Cairns Post"",
      ""GCB"",
      ""Townsville Bulletin"",
      ""The Chronicle"",
      ""Daily Mercury"",
      ""Sunshine Coast"",
      ""Mercury and Sunday Tas"",
      ""NT News & Sunday Territorian"",
      ""Other""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Publication names, channel names, and other lookup values should be sourced from governed reference tables instead of hardcoded CASE statements"",
      ""Fiscal year ('FY2025') should be a parameter or derived from a fiscal calendar table"",
      ""Period names ('CP', 'PY') should be managed via a configuration table"",
      ""Business rules like '6 Day Pubs' vs '7 Day Pubs' logic should be externalized or managed in a dimension table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.source_system_name,\n      os.sub_source_system_name,\n      CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n      os.gl_publication_code,\n      os.day_of_week,\n      os.state,\n      os.os_level_1,\n      os.os_level_2,\n      os.os_level_3,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_8,\n      os.os_level_9,\n      os.os_level_10,\n      os.os_level_11,\n      os.os_level_12,\n      os.Estimate,\n      os.True_Up_Adjustment,\n      os.Actual_Amount,\n      os.volume,\n      os.Last_Year_Actual_Amount,\n      os.Last_Year_volume,\n      os.Budget_Draft_Amount,\n      os.Budget_Draft_Volume,\n      os.Budget_Amount,\n      os.Budget_Volume,\n      os.Forecast_Amount,\n      os.Forecast_Volume,\n      os.Budget_Jan_Amount,\n      os.Budget_Jan_Volume,\n      os.Budget_Feb_Amount,\n      os.Budget_Feb_Volume,\n      os.Budget_Mar_Amount,\n      os.Budget_Mar_Volume,\n      os.Budget_Apr_Amount,\n      os.Budget_Apr_Volume,\n      os.Budget_May_Amount,\n      os.Budget_May_Volume,\n      os.Budget_Jun_Amount,\n      os.Budget_Jun_Volume,\n      os.Budget_Jul_Amount,\n      os.Budget_Jul_Volume,\n      os.Budget_Aug_Amount,\n      os.Budget_Aug_Volume,\n      os.Budget_Sep_Amount,\n      os.Budget_Sep_Volume,\n      os.Budget_Oct_Amount,\n      os.Budget_Oct_Volume,\n      os.Budget_Nov_Amount,\n      os.Budget_Nov_Volume,\n      os.Budget_Dec_Amount,\n      os.Budget_Dec_Volume,\n      os.Forecast_Q1F_Amount,\n      os.Forecast_Q1F_Volume,\n      os.Forecast_Q2F_Amount,\n      os.Forecast_Q2F_Volume,\n      os.Forecast_Q3F_Amount,\n      os.Forecast_Q3F_Volume,\n      os.Forecast_Q4F_Amount,\n      os.Forecast_Q4F_Volume,\n      os.Forecast_Q5F_Amount,\n      os.Forecast_Q5F_Volume,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      pub.gl_hierarchy_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND pub.gl_hierarchy_code = 'FY2025'\n),\npre_calculated_data AS (\n    SELECT\n        *,\n        -- Derived clmn7_ (publication_name with PNG override)\n        CASE WHEN publication_code = 'Post Courier' THEN 'PNG' ELSE publication_name END AS derived_publication_name_clmn7,\n\n        -- Derived clmn8_, clmn9_ (Budget_Volume for past weeks)\n        CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END AS budget_volume_past_weeks_clmn8_9,\n\n        -- Derived clmn10_, clmn11_, clmn12_ (Standardized Publication Name)\n        CASE\n            WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n            WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name = 'Toowoomba' THEN 'The Chronicle'\n            WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin'\n            WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB'\n            WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser'\n            WHEN publication_name = 'Cairns Post' THEN 'Cairns Post'\n            WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast'\n            WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail'\n            WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury'\n            WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News'\n            WHEN publication_name = 'Mackay' THEN 'Daily Mercury'\n            ELSE NULL\n        END AS standardized_publication_name,\n\n        -- Derived clmn13_ (State/Region from standardized publication name)\n        CASE\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Daily Telegraph' THEN ' NSW'\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times') THEN '  VIC'\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Advertiser' THEN '   SA'\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast') THEN '     QLD'\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Northern Territory News' THEN '      NT'\n            WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Mercury' THEN '    TAS'\n            ELSE NULL\n        END AS derived_state_region,\n\n        -- Derived clmn24_ (Day of week from hardcoded date)\n        EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1 AS derived_day_of_week_from_date,\n\n        -- Derived clmn25_ (Weeks difference from hardcoded date)\n        DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS derived_weeks_diff,\n\n        -- Derived clmn28_ (Day of week group)\n        CASE\n            WHEN day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F'\n            WHEN day_of_week = 'Sat' THEN 'SAT'\n            WHEN day_of_week = 'Sun' THEN 'Sun'\n            ELSE NULL\n        END AS day_of_week_group,\n\n        -- Derived clmn34_ (Channel Group)\n        CASE\n            WHEN os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels') THEN 'Alternative Channels'\n            WHEN os_level_10 IN ('Petrol and Convenience') THEN 'Convenience Stores / Service Stations'\n            WHEN os_level_10 IN ('Agent & Dist') THEN 'Newsagencies'\n            WHEN os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub') THEN 'Subscriptions'\n            WHEN os_level_10 IN ('Supermarkets') THEN 'Supermarkets'\n            ELSE 'Unspec Channel'\n        END AS channel_group,\n\n        -- Derived clmn35_ (os_level_7 uppercase)\n        UPPER(SAFE_CAST(os_level_7 AS STRING)) AS os_level_7_upper,\n\n        -- Derived clmn37_ (Budget_Amount if relative_fisc_week_number < 0)\n        CASE WHEN relative_fisc_week_number < 0 THEN Budget_Amount ELSE 0 END AS budget_amount_past_weeks,\n\n        -- Derived clmn38_ (Budget_Amount if relative_fisc_year_number = 0)\n        CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END AS budget_amount_current_year,\n\n        -- Derived clmn49_ (Publication Group)\n        CASE\n            WHEN publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs'\n            WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas'\n            WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian'\n            WHEN publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other'\n            WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n            WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n            ELSE publication_name\n        END AS publication_group,\n\n        -- Derived clmn52_ (Conditional week number)\n        CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END AS conditional_week_num,\n\n        -- Derived clmn54_ (Is Courier Mail)\n        (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail' AS is_courier_mail,\n\n        -- Derived clmn55_ (Is The Australian)\n        (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' AS is_the_australian,\n\n        -- Derived clmn61_ (Week number for calculations)\n        CASE WHEN (0 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) ELSE 0 END AS week_num_for_calc,\n\n        -- Derived clmn63_ (Is Courier Mail or Australian)\n        ((CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' OR (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail') AS is_courier_mail_or_australian,\n\n        -- Derived clmn64_ (Is week 26 or 40)\n        ((CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 26 OR (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 40) AS is_week_26_or_40,\n\n        -- Derived clmn70_ (Always 12 based on hardcoded 0)\n        SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) AS hardcoded_month_num_clmn70,\n\n        -- Derived clmn71_, clmn72_ (Forecast Amount adjusted)\n        CASE WHEN (TRUE) THEN (CASE WHEN conditional_week_num <= fy_year_week_number THEN Actual_Amount ELSE 0 END) ELSE 0 END AS forecast_amount_adjusted_clmn71_72,\n\n        -- Derived clmn73_ (Budget Amount adjusted)\n        CASE WHEN ('2' = '1') THEN (CASE WHEN fy_week_of_year = week_num_for_calc THEN Budget_Amount ELSE 0 END) WHEN (TRUE AND ('2' = '1')) THEN budget_amount_past_weeks WHEN ('2' = '2') THEN budget_amount_current_year WHEN ('2' = '3') THEN budget_amount_current_year ELSE 0 END AS budget_amount_adjusted_clmn73,\n\n        -- Derived clmn74_ (Actual Amount adjusted based on month/week)\n        CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END AS actual_amount_adjusted_clmn74,\n\n        -- Derived clmn75_ (Volume adjusted based on month/week)\n        CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN volume ELSE Forecast_Volume END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN volume ELSE Forecast_Volume END) WHEN fy_month_of_year < 10 THEN volume ELSE Forecast_Volume END AS volume_adjusted_clmn75\n),\nfinal_calculations AS (\n    SELECT\n        *,\n        -- Derived clmn76_ (Final Actual Amount)\n        CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END AS final_actual_amount_clmn76,\n\n        -- Derived clmn77_ (Final Budget Volume)\n        CASE WHEN ('1' = '1') THEN Budget_Volume WHEN ('1' = '2') THEN volume_adjusted_clmn75 WHEN ('1' = '3') THEN Last_Year_volume ELSE 0 END AS final_budget_volume_clmn77,\n\n        -- Derived clmn78_ (Actual Amount for ALL SALES CHANNELS)\n        CASE WHEN (os_level_7_upper = 'ALL SALES CHANNELS') THEN (CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) ELSE 0 END AS actual_amount_all_sales_channels_clmn78,\n\n        -- Derived clmn79_ (Forecast Volume for The Sportsman)\n        SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*2))*5 AS forecast_volume_sportsman_clmn79,\n\n        -- Derived clmn80_ (Budget Volume for Weekly Times)\n        final_budget_volume_clmn77*5 AS budget_volume_weekly_times_clmn80,\n\n        -- Derived clmn81_ (Budget Volume M-F)\n        SAFE_DIVIDE(final_budget_volume_clmn77, 4)*5 AS budget_volume_mf_clmn81,\n\n        -- Derived clmn82_ (Forecast Volume for Weekly Times)\n        SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc)*5 AS forecast_volume_weekly_times_clmn82,\n\n        -- Derived clmn83_ (Forecast Volume M-F)\n        SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*5))*5 AS forecast_volume_mf_clmn83,\n\n        -- Derived clmn84_ (Forecast Volume general)\n        SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc) AS forecast_volume_general_clmn84,\n\n        -- Derived clmn85_ (Budget Volume for The Sportsman)\n        SAFE_DIVIDE(final_budget_volume_clmn77, 2)*5 AS budget_volume_sportsman_clmn85\n)\n, daily_adjusted_metrics AS (\n    SELECT\n        *,\n        -- Derived clmn86_ (Budget Volume adjusted for M-F)\n        CASE WHEN (day_of_week_group = 'M-F') THEN budget_volume_mf_clmn81 ELSE final_budget_volume_clmn77 END AS budget_volume_adjusted_mf_clmn86,\n\n        -- Derived clmn87_ (Forecast Volume adjusted for M-F)\n        CASE WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83 ELSE forecast_volume_general_clmn84 END AS forecast_volume_adjusted_mf_clmn87\n)\n, final_daily_metrics AS (\n    SELECT\n        *,\n        -- Derived clmn88_ (Final Budget Volume for daily calculation)\n        CASE\n            WHEN (is_week_26_or_40 AND is_courier_mail_or_australian) THEN budget_volume_adjusted_mf_clmn86\n            WHEN (standardized_publication_name = 'The Sportsman') THEN budget_volume_sportsman_clmn85\n            WHEN (standardized_publication_name = 'Weekly Times') THEN budget_volume_weekly_times_clmn80\n            WHEN (publication_group = 'PNG') THEN 0\n            ELSE final_budget_volume_clmn77\n        END AS final_daily_budget_volume_clmn88,\n\n        -- Derived clmn89_ (Final Forecast Volume for daily calculation)\n        CASE\n            WHEN (is_the_australian OR is_courier_mail) THEN forecast_volume_adjusted_mf_clmn87\n            WHEN (standardized_publication_name = 'The Sportsman') THEN forecast_volume_sportsman_clmn79\n            WHEN (standardized_publication_name = 'Weekly Times') THEN forecast_volume_weekly_times_clmn82\n            WHEN (publication_group = 'PNG') THEN 0\n            WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83\n            ELSE forecast_volume_general_clmn84\n        END AS final_daily_forecast_volume_clmn89\n)\nSELECT\n    fy_quarter_of_year AS fiscal_quarter,\n    os_level_8 AS os_level_8_category,\n    standardized_publication_name AS publication_standardized,\n    derived_state_region AS state_region_derived,\n    channel_group,\n    publication_group,\n    'YTD' AS period_label,\n    day_of_week_group,\n    fy_month_of_year AS fiscal_month,\n    fy_week_of_year AS fiscal_week,\n    relative_fisc_week_number,\n    relative_fisc_year_number,\n    fiscal_week_id,\n    gl_publication_code,\n    os_level_10,\n    os_level_7,\n    SUM(Actual_Amount) AS raw_actual_amount,\n    SUM(Budget_Amount) AS raw_budget_amount,\n    SUM(Budget_Volume) AS raw_budget_volume,\n    SUM(Forecast_Amount) AS raw_forecast_amount,\n    SUM(Forecast_Volume) AS raw_forecast_volume,\n    SUM(Last_Year_Actual_Amount) AS raw_last_year_actual_amount,\n    SUM(Last_Year_volume) AS raw_last_year_volume,\n    SUM(volume) AS raw_volume,\n\n    -- Metrics from Query 1\n    SUM(budget_volume_past_weeks_clmn8_9) AS budget_volume_past_weeks,\n    SUM(volume - budget_volume_past_weeks_clmn8_9) AS volume_vs_budget_past_weeks,\n    SUM(volume) AS total_volume,\n\n    -- Metrics from Query 2\n    SUM(final_budget_volume_clmn77) AS total_budget_volume,\n    SUM(final_actual_amount_clmn76) AS total_actual_amount,\n    SUM(actual_amount_all_sales_channels_clmn78) AS actual_amount_all_sales_channels,\n    SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_budget_volume_clmn88, 6) ELSE SAFE_DIVIDE(final_daily_budget_volume_clmn88, 7) END) AS daily_budget_volume_adjusted,\n    SUM(forecast_amount_adjusted_clmn71_72) AS total_forecast_amount,\n    SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_forecast_volume_clmn89, 6) ELSE SAFE_DIVIDE(final_daily_forecast_volume_clmn89, 7) END) AS daily_forecast_volume_adjusted\nFROM\n    final_daily_metrics\nWHERE\n    os_level_8 != 'DTI Free Copies'\n    AND NOT(standardized_publication_name IS NULL)\n    AND channel_group = 'Retail'\nGROUP BY\n    fiscal_quarter,\n    os_level_8_category,\n    publication_standardized,\n    state_region_derived,\n    channel_group,\n    publication_group,\n    period_label,\n    day_of_week_group,\n    fiscal_month,\n    fiscal_week,\n    relative_fisc_week_number,\n    relative_fisc_year_number,\n    fiscal_week_id,\n    gl_publication_code,\n    os_level_10,\n    os_level_7\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS STRING)) as unique_fiscal_weeks,\n  COUNT(DISTINCT gl_publication_code) as unique_publication_codes,\n  COUNT(DISTINCT os_level_8) as unique_os_level_8_categories,\n  COUNT(DISTINCT os_level_10) as unique_os_level_10_channels,\n  MIN(SAFE_CAST(fiscal_week_id AS INT64)) as earliest_fiscal_week_id,\n  MAX(SAFE_CAST(fiscal_week_id AS INT64)) as latest_fiscal_week_id,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(fiscal_week_id AS STRING), gl_publication_code, os_level_8, os_level_10)) as approx_unique_record_combinations\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  upper(os_level_6) = 'CIRCULATION'\n  AND gl_hierarchy_code = 'FY2025'\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(SAFE_CAST(Budget_Volume AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_volume_test,\n  CASE WHEN MAX(SAFE_CAST(fiscal_week_id AS INT64)) >= (SELECT MAX(SAFE_CAST(fy_year_week_number AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE SAFE_CAST(fy_year AS INT64) = 2025) - 4 THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as circulation_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  gl_hierarchy_code = 'FY2025'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Circulation_FY2025_Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' AND pub.gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' AND pub.gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\nWHERE\n  SAFE_CAST(os.fiscal_week_id AS INT64) >= (SELECT MIN(SAFE_CAST(fy_year_week_number AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE SAFE_CAST(fy_year AS INT64) = 2025)\n  AND SAFE_CAST(os.fiscal_week_id AS INT64) <= (SELECT MAX(SAFE_CAST(fy_year_week_number AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE SAFE_CAST(fy_year AS INT64) = 2025)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(fiscal_week_id AS INT64) as fiscal_week_id,\n  gl_publication_code,\n  publication_name,\n  os_level_8,\n  os_level_10,\n  Actual_Amount,\n  Budget_Volume,\n  Forecast_Amount,\n  volume,\n  relative_fisc_week_number,\n  fy_quarter_of_year,\n  fy_month_of_year,\n  day_of_week\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  upper(os_level_6) = 'CIRCULATION'\n  AND gl_hierarchy_code = 'FY2025'\n  AND SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fy_year_week_number AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE SAFE_CAST(fy_year AS INT64) = 2025) - 4\nORDER BY\n  fiscal_week_id DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-04-15"",
          ""original_format"": ""2025-04-15 04:14:20.297382+00"",
          ""context"": ""Used as a reference date for calculating day of week and week differences. Appears in multiple nested calculations."",
          ""suggested_fix"": ""Replace with CURRENT_TIMESTAMP() or a dashboard date parameter to allow dynamic reporting."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date in DATETIME_DIFF calculation for week differences. Appears in multiple nested calculations."",
          ""suggested_fix"": ""Replace with a dynamic fiscal year start date from a calendar dimension table or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Daily Telegraph'"",
            ""'The Herald Sun'"",
            ""'The Advertiser'"",
            ""'Courier Mail'"",
            ""'Weekly Times'"",
            ""'The Australian'"",
            ""'The Sportsman'"",
            ""'Mercury'"",
            ""'Northern Territory News'"",
            ""'Geelong Advertiser'"",
            ""'Cairns Post'"",
            ""'GCB'"",
            ""'Townsville Bulletin'"",
            ""'The Chronicle'"",
            ""'Daily Mercury'"",
            ""'Sunshine Coast'""
          ],
          ""context"": ""Publication names are hardcoded in extensive CASE statements for standardization and grouping. This logic is duplicated across queries."",
          ""suggested_governance"": ""Create a `dim_publication` table with `publication_code`, `publication_name`, `standardized_name`, `state_region`, `publication_group` (e.g., '6 Day Pubs', 'PNG'), and join to this dimension."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CIRCULATION'"",
            ""'FY2025'"",
            ""'Free News & Lifestyle'"",
            ""'Food'"",
            ""'Prestige'"",
            ""'DTI Free Copies'"",
            ""'Retail'"",
            ""'ALL SALES CHANNELS'"",
            ""'6 Day Pubs'"",
            ""'PNG'"",
            ""'M-F'"",
            ""'SAT'"",
            ""'Sun'"",
            ""'YTD'""
          ],
          ""context"": ""Core business filters and categorization logic are hardcoded directly in WHERE clauses and CASE statements."",
          ""suggested_governance"": ""Externalize these rules into configuration tables or flags within dimension tables. For example, a `dim_channel` table for 'Retail' or a `dim_product_category` for 'Food'/'Prestige'. Fiscal year 'FY2025' should be a parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""0"",
            ""1"",
            ""2"",
            ""3"",
            ""4"",
            ""5"",
            ""6"",
            ""7"",
            ""9"",
            ""10"",
            ""12"",
            ""26"",
            ""40""
          ],
          ""context"": ""Numeric values used in conditional logic (e.g., `relative_fisc_week_number < 0`, `fy_month_of_year < 4`, `week_num_for_calc*2`, `week_num_for_calc*5`, `fy_week_of_year = 26`)."",
          ""suggested_governance"": ""Review if these are fixed business rules or configurable thresholds. If configurable, move to a configuration table. If fixed, add comments to explain their business meaning."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-04-15', '2024-07-03') with dashboard date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., publication names, channel types, publication groups) with joins to governed reference tables (e.g., `dim_publication`, `dim_channel`)."",
      ""Use a dashboard parameter for the fiscal year (e.g., 'FY2025') instead of hardcoding it in the WHERE clause."",
      ""Externalize complex business rules (e.g., daily volume adjustments based on publication type) into a dedicated business rule table or a more structured dimension table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""raw_actual_amount"",
      ""metric_name"": ""Raw Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw actual financial amount from the source fact table."",
      ""sql_logic"": ""SUM(Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric for circulation reporting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""raw_budget_amount"",
      ""metric_name"": ""Raw Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw budgeted financial amount from the source fact table."",
      ""sql_logic"": ""SUM(Budget_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric for circulation planning and comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""raw_budget_volume"",
      ""metric_name"": ""Raw Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw budgeted volume from the source fact table."",
      ""sql_logic"": ""SUM(Budget_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Base volume metric for circulation planning and comparison."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""raw_forecast_amount"",
      ""metric_name"": ""Raw Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw forecasted financial amount from the source fact table."",
      ""sql_logic"": ""SUM(Forecast_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric for circulation forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""raw_forecast_volume"",
      ""metric_name"": ""Raw Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw forecasted volume from the source fact table."",
      ""sql_logic"": ""SUM(Forecast_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Base volume metric for circulation forecasting."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_volume_past_weeks"",
      ""metric_name"": ""Budget Volume (Past Weeks)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_budget_volume"",
        ""relative_fiscal_week_number""
      ],
      ""business_description"": ""The sum of Budget Volume for weeks where the relative fiscal week number is less than 0 (i.e., past weeks relative to a current point)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to track budget performance for completed periods."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""volume_vs_budget_past_weeks"",
      ""metric_name"": ""Volume vs. Budget (Past Weeks)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""difference_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_volume"",
        ""budget_volume_past_weeks""
      ],
      ""business_description"": ""The difference between actual volume and budgeted volume for past weeks. Represents variance from budget."",
      ""sql_logic"": ""SUM(volume - (CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key performance indicator for assessing past circulation performance against budget."",
      ""metric_category"": ""efficiency"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_volume"",
      ""metric_name"": ""Total Volume"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_volume""
      ],
      ""business_description"": ""The total actual circulation volume."",
      ""sql_logic"": ""SUM(volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Fundamental metric for overall circulation performance."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_volume"",
      ""metric_name"": ""Total Budget Volume"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_budget_volume"",
        ""raw_last_year_volume"",
        ""raw_forecast_volume""
      ],
      ""business_description"": ""The total budgeted volume, potentially adjusted based on complex internal logic involving current budget, forecast, and last year's volume."",
      ""sql_logic"": ""SUM(CASE WHEN ('1' = '1') THEN Budget_Volume WHEN ('1' = '2') THEN volume_adjusted_clmn75 WHEN ('1' = '3') THEN Last_Year_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Represents the target volume for circulation, used for performance comparison."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-04-15"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'1'"",
        ""'2'"",
        ""'3'""
      ],
      ""governance_issues"": [
        ""Hardcoded selection logic ('1'='1') should be parameterized or removed if always true."",
        ""Complex nested logic for `volume_adjusted_clmn75` should be simplified or externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_amount"",
      ""metric_name"": ""Total Actual Amount"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_actual_amount"",
        ""raw_budget_amount"",
        ""raw_last_year_actual_amount"",
        ""raw_forecast_amount""
      ],
      ""business_description"": ""The total actual financial amount, potentially adjusted based on complex internal logic involving current budget, forecast, and last year's amount."",
      ""sql_logic"": ""SUM(CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for overall circulation revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-04-15"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'1'"",
        ""'2'"",
        ""'3'""
      ],
      ""governance_issues"": [
        ""Hardcoded selection logic ('1'='1') should be parameterized or removed if always true."",
        ""Complex nested logic for `actual_amount_adjusted_clmn74` should be simplified or externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""actual_amount_all_sales_channels"",
      ""metric_name"": ""Actual Amount (All Sales Channels)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_actual_amount"",
        ""os_level_7""
      ],
      ""business_description"": ""The total actual financial amount specifically for 'ALL SALES CHANNELS'."",
      ""sql_logic"": ""SUM(CASE WHEN os_level_7_upper = 'ALL SALES CHANNELS' THEN final_actual_amount_clmn76 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a specific view of revenue from all sales channels, likely for a particular report or analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ALL SALES CHANNELS'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'ALL SALES CHANNELS' should be managed via a dimension table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""daily_budget_volume_adjusted"",
      ""metric_name"": ""Daily Budget Volume (Adjusted)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_budget_volume"",
        ""publication_group"",
        ""day_of_week_group""
      ],
      ""business_description"": ""Daily budgeted volume, adjusted based on publication type (e.g., 6-day vs 7-day pubs) and other complex rules."",
      ""sql_logic"": ""SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_budget_volume_clmn88, 6) ELSE SAFE_DIVIDE(final_daily_budget_volume_clmn88, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a daily view of budgeted circulation, accounting for different publication schedules. Critical for daily operational planning."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-04-15"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Hardcoded division factors (6, 7) and publication groups ('PNG', '6 Day Pubs') should be externalized to a configuration or dimension table."",
        ""Complex nested logic for `final_daily_budget_volume_clmn88` should be simplified or externalized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for division by zero if `final_daily_budget_volume_clmn88` is null or zero, though SAFE_DIVIDE mitigates this.""
      ]
    },
    {
      ""metric_id"": ""total_forecast_amount"",
      ""metric_name"": ""Total Forecast Amount"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_actual_amount"",
        ""raw_forecast_amount"",
        ""fiscal_week""
      ],
      ""business_description"": ""The total forecasted financial amount, adjusted based on whether the current week is past a certain threshold (conditional_week_num vs fy_year_week_number)."",
      ""sql_logic"": ""SUM(CASE WHEN (TRUE) THEN (CASE WHEN conditional_week_num <= fy_year_week_number THEN Actual_Amount ELSE 0 END) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key financial metric for future circulation revenue projections."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-04-15"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Complex logic for `conditional_week_num` and `fy_year_week_number` should be simplified or externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""daily_forecast_volume_adjusted"",
      ""metric_name"": ""Daily Forecast Volume (Adjusted)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_forecast_volume"",
        ""publication_group"",
        ""day_of_week_group""
      ],
      ""business_description"": ""Daily forecasted volume, adjusted based on publication type (e.g., 6-day vs 7-day pubs) and other complex rules."",
      ""sql_logic"": ""SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_forecast_volume_clmn89, 6) ELSE SAFE_DIVIDE(final_daily_forecast_volume_clmn89, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group = 'Retail'"",
        ""NOT(standardized_publication_name IS NULL)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a daily view of forecasted circulation, accounting for different publication schedules. Critical for daily operational planning."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-04-15"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'6 Day Pubs'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Hardcoded division factors (6, 7) and publication groups ('6 Day Pubs') should be externalized to a configuration or dimension table."",
        ""Complex nested logic for `final_daily_forecast_volume_clmn89` should be simplified or externalized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for division by zero if `final_daily_forecast_volume_clmn89` is null or zero, though SAFE_DIVIDE mitigates this.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""volume_vs_budget_past_weeks"",
      ""related_metrics"": [
        ""total_volume"",
        ""budget_volume_past_weeks""
      ],
      ""relationship_description"": ""Volume vs. Budget (Past Weeks) is calculated as the difference between Total Volume and Budget Volume (Past Weeks)."",
      ""mathematical_formula"": ""volume_vs_budget_past_weeks = total_volume - budget_volume_past_weeks"",
      ""business_validation"": ""This relationship is fundamental for understanding budget adherence and performance variance."",
      ""validation_sql"": ""SELECT\n  SUM(volume - (CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END)) AS calculated_variance,\n  SUM(volume) - SUM(CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END) AS derived_variance_check\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND gl_hierarchy_code = 'FY2025'\n  AND os.os_level_8 != 'DTI Free Copies'\n  AND NOT(CASE WHEN os.publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN os.publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN os.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN os.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN os.publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN os.publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN os.publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN os.publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN os.publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN os.publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN os.publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN os.publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN os.publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN os.publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END IS NULL)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""actual_amount_all_sales_channels""
      ],
      ""relationship_description"": ""Actual Amount (All Sales Channels) is a subset of Total Actual Amount, filtered specifically for records where `os_level_7` is 'ALL SALES CHANNELS'."",
      ""mathematical_formula"": ""actual_amount_all_sales_channels = SUM(Total_Actual_Amount WHERE os_level_7 = 'ALL SALES CHANNELS')"",
      ""business_validation"": ""This highlights a specific segment of revenue, allowing for focused analysis on a particular sales channel group."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN ('1' = '1') THEN (CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END) WHEN ('1' = '2') THEN (CASE WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 9 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END) WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) AS total_actual_amount_unfiltered,\n  SUM(CASE WHEN UPPER(os_level_7) = 'ALL SALES CHANNELS' THEN (CASE WHEN ('1' = '1') THEN (CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END) WHEN ('1' = '2') THEN (CASE WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END) WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) ELSE 0 END) AS actual_amount_all_sales_channels_filtered\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND gl_hierarchy_code = 'FY2025'\n  AND (CASE WHEN os.os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels') THEN 'Alternative Channels' WHEN os.os_level_10 IN ('Petrol and Convenience') THEN 'Convenience Stores / Service Stations' WHEN os.os_level_10 IN ('Agent & Dist') THEN 'Newsagencies' WHEN os.os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub') THEN 'Subscriptions' WHEN os.os_level_10 IN ('Supermarkets') THEN 'Supermarkets' ELSE 'Unspec Channel' END) = 'Retail'\n  AND NOT(CASE WHEN os.publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN os.publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN os.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN os.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN os.publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN os.publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN os.publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN os.publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN os.publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN os.publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN os.publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN os.publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN os.publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN os.publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END IS NULL)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""daily_budget_volume_adjusted"",
      ""related_metrics"": [
        ""publication_group""
      ],
      ""relationship_description"": ""The calculation of daily budget volume is conditional on the `publication_group` (e.g., 'PNG', '6 Day Pubs'), implying a hierarchical business rule for different publication types."",
      ""mathematical_formula"": ""daily_budget_volume_adjusted = SUM(IF publication_group = 'PNG' THEN 0 ELSE IF publication_group = '6 Day Pubs' THEN final_daily_budget_volume_clmn88 / 6 ELSE final_daily_budget_volume_clmn88 / 7 END)"",
      ""business_validation"": ""This reflects specific operational differences in how daily volumes are calculated for different types of publications (e.g., 6-day vs 7-day publishing schedules)."",
      ""validation_sql"": ""SELECT\n  publication_group,\n  SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(final_daily_budget_volume_clmn88, 6) ELSE SAFE_DIVIDE(final_daily_budget_volume_clmn88, 7) END) AS daily_budget_volume_adjusted_check,\n  SUM(final_daily_budget_volume_clmn88) AS total_budget_volume_for_daily_calc\nFROM (\n    -- Replicate the CTEs up to final_daily_metrics to get final_daily_budget_volume_clmn88 and publication_group\n    WITH OSandFACT AS (\n        SELECT\n          os.source_system_name, os.sub_source_system_name, CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id, os.gl_publication_code, os.day_of_week, os.state, os.os_level_1, os.os_level_2, os.os_level_3, os.os_level_4, os.os_level_5, os.os_level_6, os.os_level_7, os.os_level_8, os.os_level_9, os.os_level_10, os.os_level_11, os.os_level_12, os.Estimate, os.True_Up_Adjustment, os.Actual_Amount, os.volume, os.Last_Year_Actual_Amount, os.Last_Year_volume, os.Budget_Draft_Amount, os.Budget_Draft_Volume, os.Budget_Amount, os.Budget_Volume, os.Forecast_Amount, os.Forecast_Volume, os.Budget_Jan_Amount, os.Budget_Jan_Volume, os.Budget_Feb_Amount, os.Budget_Feb_Volume, os.Budget_Mar_Amount, os.Budget_Mar_Volume, os.Budget_Apr_Amount, os.Budget_Apr_Volume, os.Budget_May_Amount, os.Budget_May_Volume, os.Budget_Jun_Amount, os.Budget_Jun_Volume, os.Budget_Jul_Amount, os.Budget_Jul_Volume, os.Budget_Aug_Amount, os.Budget_Aug_Volume, os.Budget_Sep_Amount, os.Budget_Sep_Volume, os.Budget_Oct_Amount, os.Budget_Oct_Volume, os.Budget_Nov_Amount, os.Budget_Nov_Volume, os.Budget_Dec_Amount, os.Budget_Dec_Volume, os.Forecast_Q1F_Amount, os.Forecast_Q1F_Volume, os.Forecast_Q2F_Amount, os.Forecast_Q2F_Volume, os.Forecast_Q3F_Amount, os.Forecast_Q3F_Volume, os.Forecast_Q4F_Amount, os.Forecast_Q4F_Volume, os.Forecast_Q5F_Amount, os.Forecast_Q5F_Volume, pub.l04_publication_code, pub.l06_publication_code, pub.gl_hierarchy_code, calendar.fy_week_of_year, calendar.fy_year_week_number, calendar.fy_first_day_of_week, calendar.fy_last_day_of_week, calendar.fy_month_of_year, calendar.fy_year_month_number, calendar.relative_fisc_year_number, calendar.relative_fisc_week_number, calendar.fy_month_of_year_short_name, calendar.month_end_flag, calendar.fy_quarter_of_year, calendar.fy_year\n        FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code\n        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\n        LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep ON os.os_level_12 = dep.department_code\n        WHERE upper(os.os_level_6) = 'CIRCULATION' AND pub.l04_publication_code <> 'Free News & Lifestyle' AND pub.l06_publication_code NOT IN ('Food', 'Prestige') AND pub.gl_hierarchy_code = 'FY2025'\n    ),\n    pre_calculated_data AS (\n        SELECT\n            *,\n            CASE WHEN publication_code = 'Post Courier' THEN 'PNG' ELSE publication_name END AS derived_publication_name_clmn7,\n            CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END AS budget_volume_past_weeks_clmn8_9,\n            CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END AS standardized_publication_name,\n            CASE WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Daily Telegraph' THEN ' NSW' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times') THEN '  VIC' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'The Advertiser' THEN '   SA' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast') THEN '     QLD' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Northern Territory News' THEN '      NT' WHEN (CASE WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Weekly Times') THEN 'Weekly Times' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Toowoomba' THEN 'The Chronicle' WHEN publication_name = 'Townsville Bulletin' THEN 'Townsville Bulletin' WHEN publication_name = 'Gold Coast Bulletin' THEN 'GCB' WHEN publication_name = 'Geelong Advertiser' THEN 'Geelong Advertiser' WHEN publication_name = 'Cairns Post' THEN 'Cairns Post' WHEN publication_name = 'Sunshine Coast' THEN 'Sunshine Coast' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'Courier Mail' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury' WHEN publication_name IN ('Sunday Territorian', 'NT News') THEN 'Northern Territory News' WHEN publication_name = 'Mackay' THEN 'Daily Mercury' ELSE NULL END) = 'Mercury' THEN '    TAS' ELSE NULL END AS derived_state_region,\n            EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1 AS derived_day_of_week_from_date,\n            DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS derived_weeks_diff,\n            CASE WHEN day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F' WHEN day_of_week = 'Sat' THEN 'SAT' WHEN day_of_week = 'Sun' THEN 'Sun' ELSE NULL END AS day_of_week_group,\n            CASE WHEN os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels') THEN 'Alternative Channels' WHEN os_level_10 IN ('Petrol and Convenience') THEN 'Convenience Stores / Service Stations' WHEN os_level_10 IN ('Agent & Dist') THEN 'Newsagencies' WHEN os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub') THEN 'Subscriptions' WHEN os_level_10 IN ('Supermarkets') THEN 'Supermarkets' ELSE 'Unspec Channel' END AS channel_group,\n            UPPER(SAFE_CAST(os_level_7 AS STRING)) AS os_level_7_upper,\n            CASE WHEN relative_fisc_week_number < 0 THEN Budget_Amount ELSE 0 END AS budget_amount_past_weeks,\n            CASE WHEN relative_fisc_year_number = 0 THEN Budget_Amount ELSE 0 END AS budget_amount_current_year,\n            CASE WHEN publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs' WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas' WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian' WHEN publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other' WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' ELSE publication_name END AS publication_group,\n            CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END AS conditional_week_num,\n            (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail' AS is_courier_mail,\n            (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' AS is_the_australian,\n            CASE WHEN (0 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) ELSE 0 END AS week_num_for_calc,\n            ((CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Australian' OR (CASE WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun' WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser' WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail' WHEN publication_name = 'The Australian' THEN 'The Australian' WHEN publication_name = 'The Sportsman' THEN 'The Sportsman' WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph' WHEN publication_name = 'Weekly Times' THEN 'Weekly Times' ELSE NULL END) = 'The Courier Mail') AS is_courier_mail_or_australian,\n            ((CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 26 OR (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP '2025-04-15 04:14:20.297382+00' AT TIME ZONE 'Australia/Sydney') - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(TIMESTAMP '2025-04-15 04:14:20.297382+00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = 40) AS is_week_26_or_40,\n            SAFE_CAST(CASE WHEN (0 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (0 <= 4) THEN '1' WHEN (0 <= 9) THEN '2' WHEN (0 <= 13) THEN '3' WHEN (0 <= 17) THEN '4' WHEN (0 <= 22) THEN '5' WHEN (0 <= 26) THEN '6' WHEN (0 <= 30) THEN '7' WHEN (0 <= 35) THEN '8' WHEN (0 <= 39) THEN '9' WHEN (0 <= 43) THEN '10' WHEN (0 <= 48) THEN '11' WHEN (0 <= 52) THEN '12' ELSE '12' END AS INT64) AS hardcoded_month_num_clmn70,\n            CASE WHEN (TRUE) THEN (CASE WHEN conditional_week_num <= fy_year_week_number THEN Actual_Amount ELSE 0 END) ELSE 0 END AS forecast_amount_adjusted_clmn71_72,\n            CASE WHEN ('2' = '1') THEN (CASE WHEN fy_week_of_year = week_num_for_calc THEN Budget_Amount ELSE 0 END) WHEN (TRUE AND ('2' = '1')) THEN budget_amount_past_weeks WHEN ('2' = '2') THEN budget_amount_current_year WHEN ('2' = '3') THEN budget_amount_current_year ELSE 0 END AS budget_amount_adjusted_clmn73,\n            CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN Actual_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN Actual_Amount ELSE Forecast_Amount END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Amount WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN Actual_Amount ELSE Forecast_Amount END) WHEN fy_month_of_year < 10 THEN Actual_Amount ELSE Forecast_Amount END AS actual_amount_adjusted_clmn74,\n            CASE WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 4 THEN volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 6 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN volume ELSE Forecast_Volume END) WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) < 9 THEN Budget_Volume WHEN SAFE_CAST(hardcoded_month_num_clmn70 AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN volume ELSE Forecast_Volume END) WHEN fy_month_of_year < 10 THEN volume ELSE Forecast_Volume END AS volume_adjusted_clmn75\n    ),\n    final_calculations AS (\n        SELECT\n            *,\n            CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END AS final_actual_amount_clmn76,\n            CASE WHEN ('1' = '1') THEN Budget_Volume WHEN ('1' = '2') THEN volume_adjusted_clmn75 WHEN ('1' = '3') THEN Last_Year_volume ELSE 0 END AS final_budget_volume_clmn77,\n            CASE WHEN (os_level_7_upper = 'ALL SALES CHANNELS') THEN (CASE WHEN ('1' = '1') THEN budget_amount_adjusted_clmn73 WHEN ('1' = '2') THEN actual_amount_adjusted_clmn74 WHEN ('1' = '3') THEN Last_Year_Actual_Amount ELSE 0 END) ELSE 0 END AS actual_amount_all_sales_channels_clmn78,\n            SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*2))*5 AS forecast_volume_sportsman_clmn79,\n            final_budget_volume_clmn77*5 AS budget_volume_weekly_times_clmn80,\n            SAFE_DIVIDE(final_budget_volume_clmn77, 4)*5 AS budget_volume_mf_clmn81,\n            SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc)*5 AS forecast_volume_weekly_times_clmn82,\n            SAFE_DIVIDE(final_budget_volume_clmn77, (week_num_for_calc*5))*5 AS forecast_volume_mf_clmn83,\n            SAFE_DIVIDE(final_budget_volume_clmn77, week_num_for_calc) AS forecast_volume_general_clmn84,\n            SAFE_DIVIDE(final_budget_volume_clmn77, 2)*5 AS budget_volume_sportsman_clmn85\n    )\n    , daily_adjusted_metrics AS (\n        SELECT\n            *,\n            CASE WHEN (day_of_week_group = 'M-F') THEN budget_volume_mf_clmn81 ELSE final_budget_volume_clmn77 END AS budget_volume_adjusted_mf_clmn86,\n            CASE WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83 ELSE forecast_volume_general_clmn84 END AS forecast_volume_adjusted_mf_clmn87\n    )\n    SELECT\n        *,\n        CASE WHEN (is_week_26_or_40 AND is_courier_mail_or_australian) THEN budget_volume_adjusted_mf_clmn86 WHEN (standardized_publication_name = 'The Sportsman') THEN budget_volume_sportsman_clmn85 WHEN (standardized_publication_name = 'Weekly Times') THEN budget_volume_weekly_times_clmn80 WHEN (publication_group = 'PNG') THEN 0 ELSE final_budget_volume_clmn77 END AS final_daily_budget_volume_clmn88,\n        CASE WHEN (is_the_australian OR is_courier_mail) THEN forecast_volume_adjusted_mf_clmn87 WHEN (standardized_publication_name = 'The Sportsman') THEN forecast_volume_sportsman_clmn79 WHEN (standardized_publication_name = 'Weekly Times') THEN forecast_volume_weekly_times_clmn82 WHEN (publication_group = 'PNG') THEN 0 WHEN (day_of_week_group = 'M-F') THEN forecast_volume_mf_clmn83 ELSE forecast_volume_general_clmn84 END AS final_daily_forecast_volume_clmn89\n    FROM daily_adjusted_metrics\n    WHERE\n        os_level_8 != 'DTI Free Copies'\n        AND NOT(standardized_publication_name IS NULL)\n        AND channel_group = 'Retail'\n) AS subquery\nGROUP BY\n  publication_group\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,7
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26"",
    ""dashboard_name"": ""Optimizing Digital Subscriptions Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance|marketing"",
    ""complexity_score"": 8,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""transaction_date"",
      ""masthead_name"",
      ""masthead_group"",
      ""recognition_type"",
      ""fiscal_year_week_string"",
      ""period_type_scenario"",
      ""metric_type_scenario_gross_cancellations"",
      ""metric_type_scenario_gross_acquisitions""
    ],
    ""date_range_detected"": ""Snapshot for 2025-03-23 (Q1), fiscal weeks relative to 2024-07-03. Actual data likely filtered by Looker Studio's date range."",
    ""hardcoded_dates_found"": [
      ""2025-03-23"",
      ""2024-07-03"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'All Mastheads'"",
      ""'Digital Recognition'"",
      ""'Print Recognition'"",
      ""'The Australian'"",
      ""'Metros'"",
      ""'Regionals'"",
      ""'Others'"",
      ""'Deep Niche Publications'"",
      ""'Discontinued'"",
      ""'The Australian and Prestige'"",
      ""'States & Community'"",
      ""'Commercial Content'"",
      ""'Free & Lifestyle'"",
      ""specific gl_publication_code numbers (e.g., '100', '400', '301')"",
      ""specific masthead_code abbreviations (e.g., 'TA', 'CM', 'DT', 'HS')"",
      ""'Standard Paid'"",
      ""'The Oz'"",
      ""'Bundle'"",
      ""'subsnapfact'"",
      ""'Y'"",
      ""'N'"",
      ""'BUD'"",
      ""'FCT'"",
      ""'YOY'"",
      ""'BUD NY'"",
      ""'Gross Cancellations'"",
      ""'Net Cancellations'"",
      ""'Gross Acquisitions'"",
      ""'Net Acquisitions'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions for dynamic reporting instead of hardcoded snapshots."",
      ""Masthead and publication codes should join to governed reference tables for maintainability and consistency."",
      ""Business rules for categorizing mastheads and recognition types should be externalized or managed in configuration tables."",
      ""Scenario/period types and metric types should be managed as parameters or reference data to avoid hardcoded strings.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together\nWITH\n  base_data AS (\n    SELECT\n      t0.transaction_date, -- Assuming this is the actual transaction date column\n      t0.classification_level_1_description,\n      t0.classification_level_2_description,\n      t0.delivery_medium_type,\n      t0.gl_publication_code,\n      t0.masthead_code,\n      t0.subscriber_has_email_flag,\n      t0.subscription_id, -- Assuming this exists for counting subscriptions\n      t0.revenue_amount -- Assuming this exists for summing revenue\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    WHERE\n      SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) -- Filter for a reasonable date range\n  ),\n  derived_dimensions AS (\n    SELECT\n      transaction_date,\n      subscription_id,\n      revenue_amount,\n      -- Derived from transaction_date\n      EXTRACT(DAYOFWEEK FROM TIMESTAMP(transaction_date)) - 1 AS day_of_week_num,\n      DATETIME_DIFF(SAFE_CAST(transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS fiscal_week_relative_num,\n      (classification_level_1_description = 'Standard Paid') AS is_standard_paid,\n      (classification_level_2_description = 'The Oz') AS is_the_oz,\n      (delivery_medium_type = 'Bundle') AS is_bundle,\n      -- Masthead Name (clmn86_ in Q1, clmn83_ in Q2, clmn85_ in Q3)\n      CASE\n        WHEN (gl_publication_code = '100' OR gl_publication_code = '101' OR masthead_code = 'TA') THEN 'The Australian'\n        WHEN (gl_publication_code = '400' OR gl_publication_code = '401' OR gl_publication_code = '402' OR masthead_code = 'CM') THEN 'Courier Mail'\n        WHEN (gl_publication_code = '110' OR gl_publication_code = '111' OR gl_publication_code = '116' OR masthead_code = 'DT') THEN 'Daily Telegraph'\n        WHEN (gl_publication_code = '301' OR gl_publication_code = '302' OR gl_publication_code = '303' OR masthead_code = 'HS') THEN 'Herald Sun'\n        WHEN (gl_publication_code = '500' OR gl_publication_code = '501' OR gl_publication_code = '560' OR masthead_code = 'AA') THEN 'The Advertiser'\n        WHEN (gl_publication_code = '450' OR gl_publication_code = '460' OR masthead_code = 'CP') THEN 'Cairns Post'\n        WHEN (gl_publication_code = '350' OR gl_publication_code = '351' OR masthead_code = 'GA') THEN 'Geelong'\n        WHEN (gl_publication_code = '670' OR gl_publication_code = '685' OR masthead_code = 'GC') THEN 'Gold Coast'\n        WHEN (gl_publication_code = '961' OR gl_publication_code = '962' OR gl_publication_code = '963' OR masthead_code = 'NT') THEN 'NT News'\n        WHEN (gl_publication_code = '850' OR gl_publication_code = '851' OR gl_publication_code = '852' OR masthead_code = 'TM') THEN 'The Mercury'\n        WHEN (gl_publication_code = '5053' OR gl_publication_code = '5253' OR masthead_code = 'TC') THEN 'Toowoomba'\n        WHEN (gl_publication_code = '475' OR gl_publication_code = '490' OR masthead_code = 'TB') THEN 'Townsville'\n        WHEN (gl_publication_code = '305' OR gl_publication_code = '307' OR masthead_code = 'WT') THEN 'Weekly Times'\n        WHEN (gl_publication_code = '9001' OR masthead_code = 'CS') THEN 'Code'\n        WHEN (gl_publication_code = '8821' OR gl_publication_code = 'Punters.com.au' OR masthead_code = 'PU') THEN 'Punters'\n        WHEN (gl_publication_code = '8822' OR gl_publication_code = 'Racenet' OR masthead_code = 'RN') THEN 'Racenet'\n        WHEN (gl_publication_code = '9653' OR masthead_code = 'SC') THEN 'Supercoach Plus'\n        WHEN (gl_publication_code = '9600' OR masthead_code = 'TS') THEN 'Taste Online'\n        WHEN (gl_publication_code = '9003' OR masthead_code = 'AP') THEN 'Apple Podcast: Crime X'\n        WHEN (gl_publication_code = '103' OR masthead_code = 'OZ') THEN 'The Oz'\n        WHEN (gl_publication_code = '9000' OR masthead_code = 'NW') THEN 'news.com.au'\n        WHEN (gl_publication_code = '121') THEN 'Others'\n        WHEN (gl_publication_code = '9002' OR masthead_code = 'BG') THEN 'Brain Games'\n        WHEN (gl_publication_code IN ('9504', '9514', '9556', '9558', '9603', '9623', '9560')) THEN 'Others'\n        WHEN (gl_publication_code = '9644') THEN 'Suddenly'\n        WHEN (gl_publication_code = '9903') THEN 'News Corporate'\n        WHEN (gl_publication_code = 'Group Newspaper Management - Digital') THEN 'Group Newspaper Management - Digital'\n        ELSE 'Unknown Masthead'\n      END AS masthead_name,\n      -- Recognition Type (clmn88_ in Q1, clmn84_ in Q2, clmn86_ in Q3)\n      CASE\n        WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition'\n        WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition'\n        ELSE 'Digital Recognition'\n      END AS recognition_type,\n      -- Masthead Group (clmn127_ in Q1, clmn103_ in Q2, clmn105_ in Q3)\n      CASE\n        WHEN (masthead_code = 'TA') THEN 'The Australian'\n        WHEN (masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM')) THEN 'Metros'\n        WHEN (masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB')) THEN 'Regionals'\n        WHEN (masthead_code = 'WT') THEN 'Others'\n        WHEN (masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS')) THEN 'Deep Niche Publications'\n        ELSE 'Discontinued'\n      END AS masthead_group,\n      -- Fiscal Week String (clmn133_ in Q1)\n      CONCAT('FY ', '2025', ' Week ', SAFE_CAST(fiscal_week_relative_num AS STRING), ' (', SAFE_CAST(\n        CASE\n          WHEN (fiscal_week_relative_num <= 4) THEN 'July'\n          WHEN (fiscal_week_relative_num <= 9) THEN 'August'\n          WHEN (fiscal_week_relative_num <= 13) THEN 'September'\n          WHEN (fiscal_week_relative_num <= 17) THEN 'October'\n          WHEN (fiscal_week_relative_num <= 22) THEN 'November'\n          WHEN (fiscal_week_relative_num <= 26) THEN 'December'\n          WHEN (fiscal_week_relative_num <= 30) THEN 'January'\n          WHEN (fiscal_week_relative_num <= 35) THEN 'February'\n          WHEN (fiscal_week_relative_num <= 39) THEN 'March'\n          WHEN (fiscal_week_relative_num <= 43) THEN 'April'\n          WHEN (fiscal_week_relative_num <= 48) THEN 'May'\n          WHEN (fiscal_week_relative_num <= 53) THEN 'June'\n          ELSE NULL\n        END AS STRING\n      ), ')') AS fiscal_year_week_string,\n      -- Hardcoded scenario/metric types (from Q2 and Q3)\n      'FCT' AS period_type_scenario,\n      'Gross Cancellations' AS metric_type_scenario_gross_cancellations,\n      'Gross Acquisitions' AS metric_type_scenario_gross_acquisitions\n    FROM\n      base_data\n  )\nSELECT\n  SAFE_CAST(transaction_date AS DATE) AS transaction_date,\n  fiscal_year_week_string,\n  masthead_name,\n  masthead_group,\n  recognition_type,\n  period_type_scenario,\n  metric_type_scenario_gross_cancellations,\n  metric_type_scenario_gross_acquisitions,\n  COUNT(DISTINCT subscription_id) AS digital_subscription_count,\n  SUM(SAFE_CAST(revenue_amount AS NUMERIC)) AS digital_subscription_revenue\nFROM\n  derived_dimensions\nWHERE\n  recognition_type = 'Digital Recognition'\n  AND masthead_group != 'Discontinued'\nGROUP BY\n  SAFE_CAST(transaction_date AS DATE),\n  fiscal_year_week_string,\n  masthead_name,\n  masthead_group,\n  recognition_type,\n  period_type_scenario,\n  metric_type_scenario_gross_cancellations,\n  metric_type_scenario_gross_acquisitions\nORDER BY\n  transaction_date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.transaction_date AS DATE)) AS unique_transaction_dates,\n  COUNT(DISTINCT t0.subscription_id) AS unique_subscriptions,\n  COUNT(DISTINCT t0.gl_publication_code) AS unique_publication_codes,\n  COUNT(DISTINCT t0.masthead_code) AS unique_masthead_codes,\n  MIN(SAFE_CAST(t0.transaction_date AS DATE)) AS earliest_transaction_date,\n  MAX(SAFE_CAST(t0.transaction_date AS DATE)) AS latest_transaction_date,\n  APPROX_COUNT_DISTINCT(t0.subscription_id) AS approx_unique_subscription_ids,\n  SUM(CASE WHEN t0.revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_revenue_count,\n  SUM(CASE WHEN t0.delivery_medium_type IS NULL THEN 1 ELSE 0 END) AS null_delivery_medium_type_count\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE\n  SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(CASE WHEN derived.recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS digital_recognition_records_test,\n  CASE WHEN SUM(CASE WHEN derived.masthead_group = 'Metros' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS metros_group_records_test,\n  CASE WHEN MAX(SAFE_CAST(derived.transaction_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(DISTINCT derived.fiscal_year_week_string) > 0 THEN 'PASS' ELSE 'FAIL' END AS fiscal_week_string_generation_test\nFROM\n  (\n    SELECT\n      t0.transaction_date,\n      t0.delivery_medium_type,\n      t0.subscriber_has_email_flag,\n      t0.gl_publication_code,\n      t0.masthead_code,\n      EXTRACT(DAYOFWEEK FROM TIMESTAMP(t0.transaction_date)) - 1 AS day_of_week_num,\n      DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS fiscal_week_relative_num,\n      CASE\n        WHEN (t0.delivery_medium_type = 'Print') THEN 'Print Recognition'\n        WHEN (t0.subscriber_has_email_flag = 'N') THEN 'Print Recognition'\n        ELSE 'Digital Recognition'\n      END AS recognition_type,\n      CASE\n        WHEN (t0.masthead_code = 'TA') THEN 'The Australian'\n        WHEN (t0.masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM')) THEN 'Metros'\n        WHEN (t0.masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB')) THEN 'Regionals'\n        WHEN (t0.masthead_code = 'WT') THEN 'Others'\n        WHEN (t0.masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS')) THEN 'Deep Niche Publications'\n        ELSE 'Discontinued'\n      END AS masthead_group,\n      CONCAT('FY ', '2025', ' Week ', SAFE_CAST(DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS STRING), ' (', SAFE_CAST(\n        CASE\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 4) THEN 'July'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 9) THEN 'August'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 13) THEN 'September'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 17) THEN 'October'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 22) THEN 'November'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 26) THEN 'December'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 30) THEN 'January'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 35) THEN 'February'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 39) THEN 'March'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 43) THEN 'April'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 48) THEN 'May'\n          WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 53) THEN 'June'\n          ELSE NULL\n        END AS STRING\n      ), ')') AS fiscal_year_week_string\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    WHERE\n      SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\n  ) AS derived\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Digital Recognition Rule' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN derived.recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END) AS digital_recognition_records,\n  SUM(CASE WHEN derived.recognition_type = 'Print Recognition' THEN 1 ELSE 0 END) AS print_recognition_records,\n  SAFE_DIVIDE(SUM(CASE WHEN derived.recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS digital_recognition_percentage,\n  'Masthead Grouping Rule' AS rule_name_2,\n  SUM(CASE WHEN derived.masthead_group = 'Metros' THEN 1 ELSE 0 END) AS metros_records,\n  SUM(CASE WHEN derived.masthead_group = 'Regionals' THEN 1 ELSE 0 END) AS regionals_records,\n  SUM(CASE WHEN derived.masthead_group = 'Discontinued' THEN 1 ELSE 0 END) AS discontinued_records\nFROM\n  (\n    SELECT\n      t0.delivery_medium_type,\n      t0.subscriber_has_email_flag,\n      t0.masthead_code,\n      CASE\n        WHEN (t0.delivery_medium_type = 'Print') THEN 'Print Recognition'\n        WHEN (t0.subscriber_has_email_flag = 'N') THEN 'Print Recognition'\n        ELSE 'Digital Recognition'\n      END AS recognition_type,\n      CASE\n        WHEN (t0.masthead_code = 'TA') THEN 'The Australian'\n        WHEN (t0.masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM')) THEN 'Metros'\n        WHEN (t0.masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB')) THEN 'Regionals'\n        WHEN (t0.masthead_code = 'WT') THEN 'Others'\n        WHEN (t0.masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS')) THEN 'Deep Niche Publications'\n        ELSE 'Discontinued'\n      END AS masthead_group\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    WHERE\n      SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  ) AS derived;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.transaction_date AS DATE) AS transaction_date,\n  t0.classification_level_1_description,\n  t0.classification_level_2_description,\n  t0.delivery_medium_type,\n  t0.gl_publication_code,\n  t0.masthead_code,\n  t0.subscriber_has_email_flag,\n  t0.subscription_id,\n  SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE\n  SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND t0.subscription_id IS NOT NULL\nORDER BY\n  SAFE_CAST(t0.transaction_date AS DATE) DESC, SAFE_CAST(t0.revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-03-23"",
          ""original_format"": ""2025-03-23 04:54:02.058726+00"",
          ""context"": ""Used as a fixed snapshot date for fiscal week calculations in Query 1. This implies a static report."",
          ""suggested_fix"": ""Replace with a dynamic date (e.g., CURRENT_DATE()) or a Looker Studio date parameter to allow for flexible reporting periods."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the baseline date for calculating fiscal week numbers (DATETIME_DIFF)."",
          ""suggested_fix"": ""Parameterize the fiscal year start date or derive it from a fiscal calendar table."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""Hardcoded fiscal year in the 'FY YYYY Week WW (Month Name)' string."",
          ""suggested_fix"": ""Derive the fiscal year dynamically from the transaction date or a fiscal calendar table."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'a' = 'a'"",
            ""0 = 0"",
            ""1 = 1"",
            ""2 = 1"",
            ""2 = 2"",
            ""2 = 3"",
            ""2 = 4""
          ],
          ""context"": ""Redundant or hardcoded conditions used for scenario selection or simple pass-through logic."",
          ""suggested_governance"": ""Remove redundant conditions. For scenario selection, use parameters or a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'All Mastheads'"",
            ""'Digital Recognition'"",
            ""'Print Recognition'"",
            ""'The Australian'"",
            ""'Metros'"",
            ""'Regionals'"",
            ""'Others'"",
            ""'Deep Niche Publications'"",
            ""'Discontinued'"",
            ""'The Australian and Prestige'"",
            ""'States & Community'"",
            ""'Commercial Content'"",
            ""'Free & Lifestyle'""
          ],
          ""context"": ""Categorical values for masthead groups, recognition types, and masthead categories are hardcoded within CASE statements."",
          ""suggested_governance"": ""Create and join to a `masthead_lookup` or `category_master` table. This centralizes definitions and simplifies updates."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""specific gl_publication_code numbers (e.g., '100', '400', '301')"",
            ""specific masthead_code abbreviations (e.g., 'TA', 'CM', 'DT', 'HS')"",
            ""'Standard Paid'"",
            ""'The Oz'"",
            ""'Bundle'"",
            ""'subsnapfact'"",
            ""'Y'"",
            ""'N'""
          ],
          ""context"": ""Direct comparison of raw `gl_publication_code`, `masthead_code`, and other flags to derive human-readable masthead names and recognition types."",
          ""suggested_governance"": ""Implement a `masthead_dimension` table that maps these codes to their descriptive names and categories. Join to this table instead of using complex CASE statements."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""scenario_types"",
          ""hardcoded_values"": [
            ""'BUD'"",
            ""'FCT'"",
            ""'YOY'"",
            ""'BUD NY'"",
            ""'Gross Cancellations'"",
            ""'Net Cancellations'"",
            ""'Gross Acquisitions'"",
            ""'Net Acquisitions'""
          ],
          ""context"": ""Hardcoded strings representing period types (e.g., Forecast, Budget) and metric types (e.g., Gross Cancellations, Gross Acquisitions). These are used as labels or filters."",
          ""suggested_governance"": ""Define these scenarios/metric types in a configuration table or use Looker Studio parameters to allow dynamic selection and management."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB`) to enable dynamic date range selection."",
      ""Replace hardcoded lookup values (e.g., masthead codes, publication codes, category names) with joins to governed reference tables. This centralizes data definitions and simplifies maintenance."",
      ""Externalize complex business rules (e.g., mapping fiscal weeks to months, or masthead codes to groups) into dedicated configuration tables or UDFs (User-Defined Functions) for better readability and maintainability."",
      ""Utilize Looker Studio parameters for scenario selection (e.g., 'FCT', 'BUD') and metric type selection ('Gross Acquisitions', 'Net Cancellations') instead of hardcoding them in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fiscal_year_week_string"",
      ""metric_name"": ""Fiscal Year Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function|conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""fiscal_week_relative_num"",
        ""fiscal_month_name""
      ],
      ""business_description"": ""A formatted string representing the fiscal year, week number, and corresponding fiscal month (e.g., 'FY 2025 Week 35 (February)'). Used for time-based grouping and filtering."",
      ""sql_logic"": ""CONCAT('FY ', '2025', ' Week ', SAFE_CAST(fiscal_week_relative_num AS STRING), ' (', SAFE_CAST(fiscal_month_name AS STRING), ')')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a granular time dimension for analyzing subscription trends within a fiscal year."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Fiscal year '2025' is hardcoded and should be dynamic."",
        ""Fiscal week to month mapping is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_relative_num"",
      ""metric_name"": ""Fiscal Week Number (Relative)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The week number relative to the start of the fiscal year (July 3, 2024). Used as an intermediate step for fiscal week string and month derivation."",
      ""sql_logic"": ""DATETIME_DIFF(SAFE_CAST(transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Foundation for fiscal period analysis, enabling weekly trend tracking."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Fiscal year start date '2024-07-03' is hardcoded and should be parameterized or derived from a fiscal calendar.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_month_name"",
      ""metric_name"": ""Fiscal Month Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""fiscal_week_relative_num""
      ],
      ""business_description"": ""The fiscal month name (e.g., 'July', 'August') derived from the fiscal week number. Used for monthly grouping."",
      ""sql_logic"": ""CASE WHEN (fiscal_week_relative_num <= 4) THEN 'July' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a higher-level time dimension for monthly reporting and analysis."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'July'"",
        ""'August'"",
        ""'September'"",
        ""'October'"",
        ""'November'"",
        ""'December'"",
        ""'January'"",
        ""'February'"",
        ""'March'"",
        ""'April'"",
        ""'May'"",
        ""'June'""
      ],
      ""governance_issues"": [
        ""Fiscal week to month mapping is hardcoded and should be managed in a configuration table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""recognition_type"",
      ""metric_name"": ""Recognition Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorizes subscriptions as 'Digital Recognition' or 'Print Recognition' based on delivery medium and email flag. Crucial for segmenting digital vs. print performance."",
      ""sql_logic"": ""CASE WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition' WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition' ELSE 'Digital Recognition' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for analyzing digital subscription performance, allowing focus on relevant data."",
      ""metric_category"": ""segmentation"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Print'"",
        ""'N'"",
        ""'Print Recognition'"",
        ""'Digital Recognition'""
      ],
      ""governance_issues"": [
        ""Recognition type logic is hardcoded and should be externalized to a business rule configuration.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_name"",
      ""metric_name"": ""Masthead Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific masthead (e.g., 'The Australian', 'Daily Telegraph', 'Herald Sun') derived from `gl_publication_code` and `masthead_code`. Used for detailed masthead-level analysis."",
      ""sql_logic"": ""Complex CASE WHEN based on gl_publication_code and masthead_code mapping to masthead names."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables performance tracking and comparison across individual mastheads."",
      ""metric_category"": ""segmentation"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""specific gl_publication_code numbers"",
        ""specific masthead_code abbreviations"",
        ""all masthead names (e.g., 'The Australian', 'Courier Mail')""
      ],
      ""governance_issues"": [
        ""Masthead mapping logic is hardcoded and should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_group"",
      ""metric_name"": ""Masthead Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""masthead_name""
      ],
      ""business_description"": ""Broader grouping of mastheads (e.g., 'Metros', 'Regionals', 'Deep Niche Publications', 'Discontinued') for higher-level analysis and aggregation."",
      ""sql_logic"": ""Complex CASE WHEN based on masthead_code mapping to masthead groups."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Facilitates aggregated reporting and strategic analysis across masthead portfolios."",
      ""metric_category"": ""segmentation"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""specific masthead_code abbreviations"",
        ""all masthead group names (e.g., 'Metros', 'Regionals', 'Discontinued')""
      ],
      ""governance_issues"": [
        ""Masthead group logic is hardcoded and should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""period_type_scenario"",
      ""metric_name"": ""Period Type Scenario"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""hardcoded_value"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""report"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded string representing the scenario type for the report (e.g., 'FCT' for Forecast). Likely used for filtering or labeling the dashboard view."",
      ""sql_logic"": ""'FCT'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Indicates the financial planning context (e.g., actuals, budget, forecast) for the displayed metrics."",
      ""metric_category"": ""scenario_type"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FCT'"",
        ""'BUD'"",
        ""'YOY'"",
        ""'BUD NY'""
      ],
      ""governance_issues"": [
        ""Hardcoded scenario type should be parameterized for flexibility.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""metric_type_scenario_gross_cancellations"",
      ""metric_name"": ""Metric Type Scenario (Gross Cancellations)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""hardcoded_value"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""report"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded string indicating 'Gross Cancellations'. Likely used for filtering or labeling a specific metric view."",
      ""sql_logic"": ""'Gross Cancellations'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Identifies the specific type of acquisition/cancellation metric being displayed."",
      ""metric_category"": ""scenario_type"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Gross Cancellations'"",
        ""'Net Cancellations'"",
        ""'Gross Acquisitions'"",
        ""'Net Acquisitions'""
      ],
      ""governance_issues"": [
        ""Hardcoded metric type should be parameterized for flexibility.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""digital_subscription_count"",
      ""metric_name"": ""Digital Subscription Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly|masthead|recognition_type"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""recognition_type"",
        ""masthead_group""
      ],
      ""business_description"": ""The total count of unique digital subscriptions, filtered for 'Digital Recognition' and non-'Discontinued' masthead groups. This is a core KPI for digital subscription performance."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""recognition_type = 'Digital Recognition'"",
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the volume of active digital subscriptions, indicating growth or decline."",
      ""metric_category"": ""volume|growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Recognition'"",
        ""'Discontinued'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on uniqueness of 'subscription_id' and correct 'recognition_type' classification.""
      ]
    },
    {
      ""metric_id"": ""digital_subscription_revenue"",
      ""metric_name"": ""Digital Subscription Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly|masthead|recognition_type"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""recognition_type"",
        ""masthead_group""
      ],
      ""business_description"": ""The total revenue generated from digital subscriptions, filtered for 'Digital Recognition' and non-'Discontinued' masthead groups. This is a core financial KPI."",
      ""sql_logic"": ""SUM(revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""recognition_type = 'Digital Recognition'"",
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures the financial performance of digital subscriptions, directly impacting profitability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Recognition'"",
        ""'Discontinued'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the completeness and correctness of 'revenue_amount' data.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""digital_subscription_count"",
      ""related_metrics"": [
        ""recognition_type"",
        ""masthead_group""
      ],
      ""relationship_description"": ""The 'Digital Subscription Count' is directly filtered by 'recognition_type' being 'Digital Recognition' and 'masthead_group' not being 'Discontinued'."",
      ""mathematical_formula"": ""COUNT(DISTINCT subscription_id) WHERE recognition_type = 'Digital Recognition' AND masthead_group != 'Discontinued'"",
      ""business_validation"": ""Ensures that the dashboard focuses specifically on active digital subscriptions from relevant mastheads, aligning with the 'Optimizing Digital Subscriptions' goal."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE (CASE WHEN delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN subscriber_has_email_flag = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' AND (CASE WHEN masthead_code = 'TA' THEN 'The Australian' WHEN masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN masthead_code = 'WT' THEN 'Others' WHEN masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END) != 'Discontinued';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""digital_subscription_revenue"",
      ""related_metrics"": [
        ""recognition_type"",
        ""masthead_group""
      ],
      ""relationship_description"": ""The 'Digital Subscription Revenue' is directly filtered by 'recognition_type' being 'Digital Recognition' and 'masthead_group' not being 'Discontinued'."",
      ""mathematical_formula"": ""SUM(revenue_amount) WHERE recognition_type = 'Digital Recognition' AND masthead_group != 'Discontinued'"",
      ""business_validation"": ""Ensures that revenue figures are attributed only to digital subscriptions from relevant mastheads, providing a clear financial picture for the digital business."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE (CASE WHEN delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN subscriber_has_email_flag = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' AND (CASE WHEN masthead_code = 'TA' THEN 'The Australian' WHEN masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN masthead_code = 'WT' THEN 'Others' WHEN masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END) != 'Discontinued';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""masthead_group"",
      ""related_metrics"": [
        ""masthead_name""
      ],
      ""relationship_description"": ""'Masthead Group' is a higher-level aggregation of 'Masthead Name'. Each 'Masthead Name' belongs to exactly one 'Masthead Group'."",
      ""mathematical_formula"": ""N/A (Categorization)"",
      ""business_validation"": ""Allows for analysis at different levels of granularity, from individual mastheads to broader portfolio segments."",
      ""validation_sql"": ""SELECT masthead_name, COUNT(DISTINCT masthead_group) FROM (SELECT t0.masthead_code, CASE WHEN t0.masthead_code = 'TA' THEN 'The Australian' WHEN t0.masthead_code IN ('NT', 'DT', 'HS', 'AA', 'CM') THEN 'Metros' WHEN t0.masthead_code IN ('CP', 'GA', 'GC', 'TM', 'TC', 'TB') THEN 'Regionals' WHEN t0.masthead_code = 'WT' THEN 'Others' WHEN t0.masthead_code IN ('SC', 'RN', 'PU', 'CS', 'AP', 'TS') THEN 'Deep Niche Publications' ELSE 'Discontinued' END AS masthead_group, CASE WHEN (t0.gl_publication_code = '100' OR t0.gl_publication_code = '101' OR t0.masthead_code = 'TA') THEN 'The Australian' WHEN (t0.gl_publication_code = '400' OR t0.gl_publication_code = '401' OR t0.gl_publication_code = '402' OR t0.masthead_code = 'CM') THEN 'Courier Mail' ELSE 'Other' END AS masthead_name FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0) GROUP BY masthead_name HAVING COUNT(DISTINCT masthead_group) > 1 LIMIT 10; -- Should ideally return 0 rows if mapping is 1:1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""fiscal_year_week_string"",
      ""related_metrics"": [
        ""fiscal_week_relative_num"",
        ""fiscal_month_name""
      ],
      ""relationship_description"": ""'Fiscal Year Week String' is a composite dimension built from 'Fiscal Week Number' and 'Fiscal Month Name'."",
      ""mathematical_formula"": ""N/A (String Concatenation)"",
      ""business_validation"": ""Provides a user-friendly representation of the fiscal period while retaining the underlying numerical and categorical components for detailed analysis."",
      ""validation_sql"": ""SELECT fiscal_year_week_string, fiscal_week_relative_num, fiscal_month_name FROM (SELECT DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS fiscal_week_relative_num, CASE WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 4) THEN 'July' WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 9) THEN 'August' ELSE NULL END AS fiscal_month_name, CONCAT('FY ', '2025', ' Week ', SAFE_CAST(DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS STRING), ' (', SAFE_CAST(CASE WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 4) THEN 'July' WHEN (DATETIME_DIFF(SAFE_CAST(t0.transaction_date AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) <= 9) THEN 'August' ELSE NULL END AS STRING), ')') AS fiscal_year_week_string FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 10) GROUP BY fiscal_year_week_string, fiscal_week_relative_num, fiscal_month_name HAVING COUNT(*) > 0;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,8
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""783f341c-8660-4e90-bab8-9bc860119cf5"",
    ""dashboard_name"": ""Deals Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 1,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""reporting_month"",
      ""advertiser"",
      ""buyer"",
      ""source"",
      ""transaction_type_upper"",
      ""fiscal_year_quarter_label""
    ],
    ""date_range_detected"": ""2024-11-01 to 2025-06-01 (based on hardcoded filters)"",
    ""hardcoded_dates_found"": [
      ""2024-11-01"",
      ""2024-12-01"",
      ""2025-01-01"",
      ""2025-02-01"",
      ""2025-03-01"",
      ""2025-04-01"",
      ""2025-05-01"",
      ""2025-06-01""
    ],
    ""hardcoded_values_found"": [
      ""'AdX'"",
      ""'AppNexus'"",
      ""'DFP'"",
      ""'Index Exchange'"",
      ""'InSkin'"",
      ""'Kargo'"",
      ""'Playground XYZ'"",
      ""'PubMatic'"",
      ""'Rubicon'"",
      ""'Tremor'"",
      ""'DEAL'"",
      ""'UFR'"",
      ""'PG - CPD'"",
      ""'PG - CPM'"",
      ""'DIRECT'"",
      ""'The Smith Family *'"",
      ""'Kmart Corporation *'"",
      ""'Target Corporation *'"",
      ""'Myer *'"",
      ""'FY25 Q2'"",
      ""'FY25 Q3'"",
      ""'FY25 Q4'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative date functions"",
      ""source platforms should use a reference table"",
      ""transaction types should use a reference table"",
      ""advertiser names should use a reference table and handle wildcards explicitly if intended""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates the total net revenue by reporting month, source, advertiser, buyer, and transaction type, incorporating all common transformations and filters found in the provided queries.\n-- It aims to provide a consolidated view of the core data used in the dashboard.\n\nWITH base_data AS (\n    SELECT\n        t0.advertiser,\n        t0.buyer,\n        t0.financialmonthnumber,\n        t0.financialquarter,\n        t0.financialyear,\n        t0.revenuenet,\n        t0.source,\n        t0.source_transactiontype,\n        -- Derived columns as seen in the original queries\n        DATE(t0.financialyear, t0.financialmonthnumber, 1) AS financial_month_start_date_raw\n    FROM\n        `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n    WHERE\n        -- Apply a general date filter to limit data processed, assuming recent data is most relevant\n        SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\n),\ntransformed_data AS (\n    SELECT\n        advertiser,\n        buyer,\n        financialmonthnumber,\n        financialquarter,\n        financialyear,\n        revenuenet,\n        source,\n        source_transactiontype,\n        financial_month_start_date_raw,\n        SUBSTR(SAFE_CAST(financialyear AS STRING), 3, 2) AS financial_year_short,\n        UPPER(SAFE_CAST(source_transactiontype AS STRING)) AS transaction_type_upper,\n        DATETIME_SUB(SAFE_CAST(financial_month_start_date_raw AS DATETIME), INTERVAL 6 MONTH) AS adjusted_date\n    FROM\n        base_data\n),\nfinal_data AS (\n    SELECT\n        advertiser,\n        buyer,\n        financialmonthnumber,\n        financialquarter,\n        financialyear,\n        revenuenet,\n        source,\n        source_transactiontype,\n        financial_month_start_date_raw,\n        financial_year_short,\n        transaction_type_upper,\n        adjusted_date,\n        CONCAT('FY', financial_year_short, ' ', SAFE_CAST(financialquarter AS STRING)) AS fiscal_year_quarter_label,\n        SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(adjusted_date) AS DATETIME), MONTH) AS DATE) AS reporting_month\n    FROM\n        transformed_data\n)\nSELECT\n    reporting_month,\n    advertiser,\n    buyer,\n    source,\n    transaction_type_upper,\n    fiscal_year_quarter_label,\n    SUM(SAFE_CAST(revenuenet AS NUMERIC)) AS total_revenue_net\nFROM\n    final_data\nWHERE\n    -- Combined filters from all queries. Note: The original query 1 had two 'source' filters, the second being a subset.\n    -- The effective filter is the intersection, which is the narrower set: ('DFP', 'Index Exchange', 'Rubicon').\n    -- Filters are made optional with 'OR <column> IS NULL' for a more flexible consolidated query.\n    (source IN ('DFP', 'Index Exchange', 'Rubicon') OR source IS NULL)\n    AND (transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') OR transaction_type_upper IS NULL)\n    AND (advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *') OR advertiser IS NULL)\n    AND (fiscal_year_quarter_label IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4') OR fiscal_year_quarter_label IS NULL)\n    AND (reporting_month IN (DATE '2024-11-01', DATE '2024-12-01', DATE '2025-01-01', DATE '2025-02-01', DATE '2025-03-01', DATE '2025-04-01', DATE '2025-05-01', DATE '2025-06-01') OR reporting_month IS NULL)\nGROUP BY\n    reporting_month,\n    advertiser,\n    buyer,\n    source,\n    transaction_type_upper,\n    fiscal_year_quarter_label\nORDER BY\n    reporting_month DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financialyear AS STRING) || '-' || SAFE_CAST(t0.financialmonthnumber AS STRING)) as unique_financial_months,\n  COUNT(DISTINCT t0.advertiser) as unique_advertisers,\n  COUNT(DISTINCT t0.buyer) as unique_buyers,\n  COUNT(DISTINCT t0.source) as unique_sources,\n  COUNT(DISTINCT t0.source_transactiontype) as unique_transaction_types,\n  MIN(DATE(t0.financialyear, t0.financialmonthnumber, 1)) as earliest_financial_month_start,\n  MAX(DATE(t0.financialyear, t0.financialmonthnumber, 1)) as latest_financial_month_start,\n  SUM(CASE WHEN t0.revenuenet IS NULL THEN 1 ELSE 0 END) as null_revenuenet_count\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE\n  -- Sample recent data for structure analysis\n  DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1000;\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present\nWITH transformed_data AS (\n    SELECT\n        t0.advertiser,\n        t0.buyer,\n        t0.financialmonthnumber,\n        t0.financialquarter,\n        t0.financialyear,\n        t0.revenuenet,\n        t0.source,\n        t0.source_transactiontype,\n        DATE(t0.financialyear, t0.financialmonthnumber, 1) AS financial_month_start_date_raw,\n        UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) AS transaction_type_upper,\n        DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH) AS adjusted_date\n    FROM\n        `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n    WHERE\n        DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\n)\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(revenuenet AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_calculation_test,\n  CASE WHEN COUNT(DISTINCT advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_dimension_test,\n  CASE WHEN COUNT(DISTINCT buyer) > 0 THEN 'PASS' ELSE 'FAIL' END as buyer_dimension_test,\n  CASE WHEN MAX(SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(adjusted_date) AS DATETIME), MONTH) AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 MONTH) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN transaction_type_upper IN ('DEAL', 'UFR') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_type_filter_test\nFROM\n  transformed_data\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nWITH transformed_data AS (\n    SELECT\n        t0.advertiser,\n        t0.source,\n        t0.source_transactiontype,\n        UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) AS transaction_type_upper,\n        CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS fiscal_year_quarter_label\n    FROM\n        `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n    WHERE\n        DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'transaction_type_coverage' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') THEN 1 ELSE 0 END) as records_matching_transaction_types,\n  SAFE_DIVIDE(SUM(CASE WHEN transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') THEN 1 ELSE 0 END), COUNT(*)) * 100 as transaction_type_match_percentage,\n  'source_filter_coverage' as rule_name_2,\n  SUM(CASE WHEN source IN ('AdX', 'AppNexus', 'DFP', 'Index Exchange', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Rubicon', 'Tremor') THEN 1 ELSE 0 END) as records_matching_sources,\n  SAFE_DIVIDE(SUM(CASE WHEN source IN ('AdX', 'AppNexus', 'DFP', 'Index Exchange', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Rubicon', 'Tremor') THEN 1 ELSE 0 END), COUNT(*)) * 100 as source_match_percentage,\n  'advertiser_wildcard_check' as rule_name_3,\n  SUM(CASE WHEN advertiser LIKE '% *' THEN 1 ELSE 0 END) as advertisers_with_wildcard_pattern -- Check if '*' is actually part of the name\nFROM\n  transformed_data\nLIMIT 1;\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis, including all raw and key derived columns\nSELECT\n  t0.advertiser,\n  t0.buyer,\n  t0.financialmonthnumber,\n  t0.financialquarter,\n  t0.financialyear,\n  SAFE_CAST(t0.revenuenet AS NUMERIC) AS revenuenet,\n  t0.source,\n  t0.source_transactiontype,\n  DATE(t0.financialyear, t0.financialmonthnumber, 1) AS financial_month_start_date_raw,\n  SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2) AS financial_year_short,\n  UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) AS transaction_type_upper,\n  DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH) AS adjusted_date,\n  CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS fiscal_year_quarter_label,\n  SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH) AS DATETIME), MONTH) AS DATE) AS reporting_month\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE\n  -- Sample recent data with non-null revenue\n  DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\n  AND t0.revenuenet IS NOT NULL\nORDER BY\n  reporting_month DESC,\n  revenuenet DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024-11-01"",
          ""original_format"": ""DATE '2024-11-01'"",
          ""context"": ""Specific reporting month filter in query 1"",
          ""suggested_fix"": ""replace with date parameters (e.g., start_date, end_date) or relative date functions (e.g., DATE_TRUNC(CURRENT_DATE(), MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-01"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""Specific reporting month filter in query 1"",
          ""suggested_fix"": ""replace with date parameters (e.g., start_date, end_date) or relative date functions (e.g., DATE_TRUNC(CURRENT_DATE(), MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""FY25 Q2"",
          ""original_format"": ""'FY25 Q2'"",
          ""context"": ""Specific fiscal year quarter filter in query 1, 2, 3"",
          ""suggested_fix"": ""replace with parameters or derive dynamically based on current date and fiscal year logic"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'AdX'"",
            ""'AppNexus'"",
            ""'DFP'"",
            ""'Index Exchange'"",
            ""'InSkin'"",
            ""'Kargo'"",
            ""'Playground XYZ'"",
            ""'PubMatic'"",
            ""'Rubicon'"",
            ""'Tremor'""
          ],
          ""context"": ""Source platform filter in query 1 (broad set)"",
          ""suggested_governance"": ""join to a `source_platform_lookup` reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DFP'"",
            ""'Index Exchange'"",
            ""'Rubicon'""
          ],
          ""context"": ""Source platform filter in query 1 (narrower set, effectively the active filter)"",
          ""suggested_governance"": ""join to a `source_platform_lookup` reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DEAL'"",
            ""'UFR'"",
            ""'PG - CPD'"",
            ""'PG - CPM'"",
            ""'DIRECT'""
          ],
          ""context"": ""Transaction type filter in all queries"",
          ""suggested_governance"": ""join to a `transaction_type_lookup` reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Smith Family *'"",
            ""'Kmart Corporation *'"",
            ""'Target Corporation *'"",
            ""'Myer *'""
          ],
          ""context"": ""Advertiser name filter in all queries. The '*' suggests a potential misunderstanding of `IN` vs `LIKE`."",
          ""suggested_governance"": ""join to an `advertiser_master` table. If wildcard matching is intended, use `LIKE` operator."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `DATE_SUB(CURRENT_DATE(), INTERVAL X MONTH)`)."",
      ""Replace hardcoded lookup values for 'source', 'transaction_type', and 'advertiser' with joins to governed reference tables. This allows for centralized management and avoids dashboard breakage when values change."",
      ""Consider using a configuration table for fiscal year definitions if the 6-month offset is not standard or might change.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_revenue_net"",
      ""metric_name"": ""Total Revenue Net"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of net revenue generated from programmatic advertising deals, adjusted for a specific fiscal calendar."",
      ""sql_logic"": ""SUM(t0.revenuenet) after applying a 6-month date adjustment and truncating to month."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source IN ('DFP', 'Index Exchange', 'Rubicon')"",
        ""transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')"",
        ""advertiser IN ('The Smith Family *')"",
        ""fiscal_year_quarter_label IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4')"",
        ""reporting_month IN (DATE '2024-11-01', ..., DATE '2025-06-01')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for tracking performance of programmatic advertising deals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly (based on source table name)"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-11-01"",
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'Rubicon'"",
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'"",
        ""'The Smith Family *'"",
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""date filters are hardcoded"",
        ""lookup values for source, transaction type, and advertiser are hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in revenuenet"",
        ""accuracy of financial_monthnumber and financialyear for date construction"",
        ""consistency of '*' in advertiser names""
      ]
    },
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic deal."",
      ""sql_logic"": ""t0.advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and segmenting revenue by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Smith Family *'"",
        ""'Kmart Corporation *'"",
        ""'Target Corporation *'"",
        ""'Myer *'""
      ],
      ""governance_issues"": [
        ""hardcoded values, potential wildcard misunderstanding""
      ],
      ""data_quality_concerns"": [
        ""consistency of naming conventions (e.g., presence of '*')""
      ]
    },
    {
      ""metric_id"": ""buyer"",
      ""metric_name"": ""Buyer"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the buyer associated with the programmatic deal."",
      ""sql_logic"": ""t0.buyer"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')"",
        ""fiscal_year_quarter_label IN ('FY25 Q4')"",
        ""reporting_month IN (DATE '2025-05-01')"",
        ""advertiser IN ('Kmart Corporation *', 'Target Corporation *', 'Myer *')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and segmenting data by buyer, often for specific deal types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'"",
        ""'FY25 Q4'"",
        ""'Kmart Corporation *'"",
        ""'Target Corporation *'"",
        ""'Myer *'""
      ],
      ""governance_issues"": [
        ""hardcoded values and dates""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source"",
      ""metric_name"": ""Source Platform"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The programmatic platform or source of the transaction."",
      ""sql_logic"": ""t0.source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source IN ('AdX', 'AppNexus', 'DFP', 'Index Exchange', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Rubicon', 'Tremor')"",
        ""source IN ('DFP', 'Index Exchange', 'Rubicon')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze revenue distribution across different ad platforms."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""'AppNexus'"",
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'InSkin'"",
        ""'Kargo'"",
        ""'Playground XYZ'"",
        ""'PubMatic'"",
        ""'Rubicon'"",
        ""'Tremor'""
      ],
      ""governance_issues"": [
        ""hardcoded values, potential for inconsistencies if not managed centrally""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type_upper"",
      ""metric_name"": ""Transaction Type (Upper)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""calculated_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The uppercased type of programmatic transaction (e.g., DEAL, UFR)."",
      ""sql_logic"": ""UPPER(SAFE_CAST(t0.source_transactiontype AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for categorizing deals and applying specific business rules."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'""
      ],
      ""governance_issues"": [
        ""hardcoded values""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""reporting_month"",
      ""metric_name"": ""Reporting Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""calculated_field"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the month for reporting, derived after a 6-month adjustment from the financial month."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH)) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""reporting_month IN (DATE '2024-11-01', ..., DATE '2025-06-01')""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary date dimension for time-series analysis and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2024-11-01"",
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""hardcoded date filters""
      ],
      ""data_quality_concerns"": [
        ""accuracy of underlying financial date columns""
      ]
    },
    {
      ""metric_id"": ""fiscal_year_quarter_label"",
      ""metric_name"": ""Fiscal Year Quarter Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""calculated_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A concatenated label representing the fiscal year and quarter (e.g., 'FY25 Q4')."",
      ""sql_logic"": ""CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""fiscal_year_quarter_label IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and reporting by fiscal quarter."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""hardcoded values""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_revenue_net"",
      ""related_metrics"": [
        ""advertiser"",
        ""buyer"",
        ""source"",
        ""transaction_type_upper"",
        ""reporting_month"",
        ""fiscal_year_quarter_label""
      ],
      ""relationship_description"": ""All identified dimensions are used to filter or group the 'Total Revenue Net' metric. The specific combinations of filters vary per dashboard component."",
      ""mathematical_formula"": ""SUM(RevenueNet) WHERE Dimension_X = 'Value_A' AND Dimension_Y = 'Value_B'"",
      ""business_validation"": ""Ensures that revenue figures are presented in the correct business context and segmentation."",
      ""validation_sql"": ""SELECT reporting_month, SUM(SAFE_CAST(revenuenet AS NUMERIC)) FROM final_data WHERE advertiser = 'The Smith Family *' GROUP BY 1 LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""reporting_month"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""relationship_description"": ""The 'Reporting Month' dimension is derived from 'financial_year' and 'financial_month_number' with a 6-month offset and then truncated to the start of the month. This implies a specific fiscal calendar definition."",
      ""mathematical_formula"": ""reporting_month = DATE_TRUNC(DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH), MONTH)"",
      ""business_validation"": ""Critical for understanding the fiscal calendar alignment and ensuring time-series data is correctly interpreted."",
      ""validation_sql"": ""SELECT financial_year, financial_month_number, DATE(financial_year, financial_month_number, 1) as raw_date, DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH) as adjusted_date, SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE_SUB(DATE(financial_year, financial_month_number, 1), INTERVAL 6 MONTH) AS DATETIME), MONTH) AS DATE) as reporting_month FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fiscal_year_quarter_label"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_quarter""
      ],
      ""relationship_description"": ""The 'Fiscal Year Quarter Label' is a string concatenation of 'FY', a shortened 'financial_year', and 'financial_quarter'."",
      ""mathematical_formula"": ""fiscal_year_quarter_label = CONCAT('FY', SUBSTR(financial_year, 3, 2), ' ', financial_quarter)"",
      ""business_validation"": ""Provides a human-readable label for fiscal periods, used for filtering and reporting."",
      ""validation_sql"": ""SELECT financial_year, financial_quarter, CONCAT('FY', SUBSTR(SAFE_CAST(financial_year AS STRING), 3, 2), ' ', SAFE_CAST(financial_quarter AS STRING)) as calculated_label FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,9
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""1a5f7b4e-ea3a-46e4-8b77-b428f4178510"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""Sales_Group"",
      ""advertiser_parent"",
      ""financial_year"",
      ""relative_fy_year_offset"",
      ""GSD"",
      ""fin_adtype_name"",
      ""revenue_type"",
      ""booking_line_created_date""
    ],
    ""date_range_detected"": ""Relative to current Financial Year (Last FY, Current FY, Next FY) with a specific hardcoded date reference (2025-01-02)"",
    ""hardcoded_dates_found"": [
      ""2025-01-02""
    ],
    ""hardcoded_values_found"": [
      ""'DOUBLECLICK'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'Client'"",
      ""'MRCA'"",
      ""'XTEND'"",
      ""'Ian Paterson'"",
      ""account_number IN ('17114', '29172', '52809')"",
      ""relative_fy_year_offset IN (-1, 0, 1)""
    ],
    ""governance_opportunities"": [
      ""Dates like '2025-01-02' should be replaced with CURRENT_DATE() or parameterized for dynamic reporting."",
      ""Hardcoded string values (e.g., 'DOUBLECLICK', 'BILLED', 'XTEND') should be managed via reference tables or configuration parameters."",
      ""Conditional logic like '$' = '$' or '1' = '1' are redundant and indicate potential copy-paste errors or unused logic that should be reviewed."",
      ""Account numbers and specific sales segment names should be managed in governed lookup tables.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN --\n-- This query consolidates all identified metrics and dimensions from the provided SQL samples.\n-- It applies common filters and groupings to provide a unified view of the 'Team Sales Performance' dashboard data.\n-- Note: The hardcoded date '2025-01-02' from the original query is retained for exact replication of the logic, but highlighted as a governance issue.\n\nWITH SFCE_USER AS (\n  SELECT\n    UPPER(network_user_name) AS login_name,\n    UPPER(user_name) AS full_name\n  FROM\n    `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n  WHERE\n    dw_source_system_code = 'SFCE'\n  QUALIFY ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) = 1\n),\nCTE2 AS (\n  SELECT\n    unified_publication_name,\n    unified_publication_gl_code,\n    fy_year_month_number,\n    financial_year,\n    financial_quarter,\n    financial_month,\n    financial_short_month,\n    financial_week,\n    revenue_transaction_status,\n    is_print_digital_flag,\n    current_financial_month,\n    current_financial_week,\n    fy_year_week_number,\n    style_name,\n    UPPER(fin_adtype_name) AS fin_adtype_name,\n    CASE\n      WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n      ELSE 'Client'\n    END AS Sales_Group,\n    EXTRACT(DAYOFWEEK FROM CURRENT_DATE()) AS DOW_Today,\n    sales_segment_l_1_name,\n    sales_segment_l_2_name,\n    sales_segment_l_1_name_sync,\n    sales_segment_l_2_name_sync,\n    fy_quarter_of_year_name,\n    relative_fy_year_offset,\n    relative_fy_quarter_offset,\n    relative_fy_month_offset,\n    relative_fy_week_offset,\n    advertiser_group,\n    advertiser_parent,\n    SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n    sales_segment_gm_name,\n    CASE\n      WHEN UPPER(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW',\n        'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n      ELSE sales_segment_gm_name_sync\n    END AS sales_segment_gm_name_sync,\n    revenue_group_level_1_name,\n    revenue_group_level_2_name,\n    SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n    SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n    SUM(IFNULL(pipeline, 0)) AS pipeline,\n    SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n    UPPER(revenue_type) AS revenue_type,\n    UPPER(revenue_group_subtype) AS revenue_group_subtype,\n    current_portfolio_group_owner_sync,\n    portfolio_group_name_sync,\n    portfolio_group_name_current,\n    portfolio_parent_group_name_sync,\n    nca_industry_pillar,\n    publishing_division_group,\n    publishing_division_parent,\n    is_future_period_flag,\n    ly_is_future_period_flag,\n    ny_is_future_period_flag,\n    cost_model_type,\n    CASE\n      WHEN source_system_code = 'PLUTO' THEN NULL\n      ELSE booking_line_created_date\n    END AS booking_line_created_date,\n    advertiser_name,\n    current_portfolio_conformed_owner_sync,\n    portfolio_conformed_name_sync,\n    publishing_division,\n    booking_line_created_week,\n    booking_line_created_month,\n    booking_line_created_short_month,\n    booking_line_created_quarter,\n    booking_line_created_year,\n    agency_parent,\n    agency_group,\n    agency_name,\n    agency_number,\n    calendar_month_name,\n    calendar_year,\n    classification_name,\n    SUM(IFNULL(target, 0)) AS target,\n    IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n    LEFT JOIN\n    SFCE_USER AS GSD_JOIN\n    ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED',\n      'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division,\n        'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n    (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n  GROUP BY\n    unified_publication_name, unified_publication_gl_code, fy_year_month_number, financial_year, financial_quarter,\n    financial_month, financial_short_month, financial_week, revenue_transaction_status, is_print_digital_flag,\n    current_financial_month, current_financial_week, fy_year_week_number, style_name, fin_adtype_name, Sales_Group,\n    DOW_Today, sales_segment_l_1_name, sales_segment_l_2_name, sales_segment_l_1_name_sync, sales_segment_l_2_name_sync,\n    fy_quarter_of_year_name, relative_fy_year_offset, relative_fy_quarter_offset, relative_fy_month_offset,\n    relative_fy_week_offset, advertiser_group, advertiser_parent, sales_segment_gm_name, sales_segment_gm_name_sync,\n    revenue_group_level_1_name, revenue_group_level_2_name, revenue_type, revenue_group_subtype,\n    current_portfolio_group_owner_sync, portfolio_group_name_sync, portfolio_group_name_current,\n    portfolio_parent_group_name_sync, nca_industry_pillar, publishing_division_group, publishing_division_parent,\n    is_future_period_flag, ly_is_future_period_flag, ny_is_future_period_flag, cost_model_type, booking_line_created_date,\n    advertiser_name, current_portfolio_conformed_owner_sync, portfolio_conformed_name_sync, publishing_division,\n    booking_line_created_week, booking_line_created_month, booking_line_created_short_month, booking_line_created_quarter,\n    booking_line_created_year, agency_parent, agency_group, agency_name, agency_number, calendar_month_name,\n    calendar_year, classification_name, GSD\n),\nfinal_data AS (\n  SELECT\n    *,\n    MIN(\n      CASE\n        WHEN advertiser_parent = \""DOUBLECLICK\"" THEN SAFE_CAST(booking_line_created_date AS DATE)\n      END) OVER (PARTITION BY financial_year) AS fix_date_lod\n  FROM\n    CTE2\n)\nSELECT\n  -- Dimensions\n  fd.Sales_Group,\n  fd.advertiser_parent,\n  CASE WHEN fd.fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE fd.revenue_type END AS fin_adtype_revenue_type_derived,\n  fd.financial_year,\n  fd.financial_quarter,\n  fd.financial_month,\n  fd.financial_short_month,\n  fd.financial_week,\n  fd.relative_fy_year_offset,\n  fd.GSD,\n  SAFE_CAST(fd.booking_line_created_date AS DATE) AS booking_created_date,\n  SAFE_CAST(fd.fix_date_lod AS DATE) AS fix_date_lod_calculated,\n\n  -- Metrics\n  SUM(fd.gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(CASE WHEN fd.relative_fy_year_offset = -1 THEN fd.gross_revenue_amount ELSE 0 END) AS ly_gross_revenue_amount,\n  SUM(CASE WHEN fd.relative_fy_year_offset = 0 THEN fd.gross_revenue_amount ELSE 0 END) AS cy_gross_revenue_amount,\n  SUM(CASE WHEN fd.relative_fy_year_offset = -1 THEN fd.gross_revenue_amount ELSE 0 END) / 1000 AS ly_gross_revenue_amount_k,\n  SUM(CASE WHEN fd.relative_fy_year_offset = 0 THEN fd.gross_revenue_amount ELSE 0 END) / 1000 AS cy_gross_revenue_amount_k,\n  MAX(CASE WHEN fd.relative_fy_year_offset = -1 THEN fd.gross_revenue_amount ELSE 0 END) AS max_ly_gross_revenue_amount,\n\n  -- Specific conditional metric from Query 1 (clmn31_/clmn32_ equivalent)\n  SUM(\n    CASE\n      WHEN fd.relative_fy_year_offset = -1\n      AND (\n        CASE\n          WHEN fd.revenue_type = 'DIGITAL'\n          AND fd.revenue_group_subtype = 'DIGITAL'\n          AND fd.sales_segment_l_2_name_sync = 'Digital Other'\n          AND fd.advertiser_parent != 'DOUBLECLICK' THEN SAFE_CAST(fd.fix_date_lod AS DATETIME)\n          ELSE SAFE_CAST(PARSE_DATE('%Y-%m-%d', fd.booking_line_created_date) AS DATETIME)\n        END\n      ) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-02 01:26:03.721975+00', 'UTC') AS DATETIME), INTERVAL -365 DAY)\n      THEN fd.gross_revenue_amount\n      ELSE 0\n    END\n  ) AS ly_gross_revenue_amount_conditional_date,\n\n  SUM(fd.adjustment_amount) AS total_adjustment_amount,\n  SUM(fd.pub_lgb) AS total_pub_lgb,\n  SUM(fd.ss_lgb) AS total_ss_lgb,\n  SUM(fd.pipeline) AS total_pipeline,\n  SUM(fd.target) AS total_target\n\nFROM\n  final_data AS fd\nWHERE\n  fd.Sales_Group = 'Client' -- Filter applied in Query 1\nGROUP BY\n  fd.Sales_Group,\n  fd.advertiser_parent,\n  fin_adtype_revenue_type_derived,\n  fd.financial_year,\n  fd.financial_quarter,\n  fd.financial_month,\n  fd.financial_short_month,\n  fd.financial_week,\n  fd.relative_fy_year_offset,\n  fd.GSD,\n  booking_created_date,\n  fix_date_lod_calculated\nORDER BY\n  fd.financial_year DESC, fd.financial_month DESC\nLIMIT 10000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(booking_line_created_date AS DATE)) AS unique_booking_dates,\n  COUNT(DISTINCT advertiser_parent) AS unique_advertiser_parents,\n  COUNT(DISTINCT Sales_Group) AS unique_sales_groups,\n  COUNT(DISTINCT financial_year) AS unique_financial_years,\n  MIN(SAFE_CAST(booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(booking_line_created_date AS DATE)) AS latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(booking_line_created_date AS STRING), advertiser_parent, Sales_Group)) AS approx_unique_combinations\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 * 2 DAY) -- Look back 2 years for relevant data\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_parent_test,\n  CASE WHEN MAX(SAFE_CAST(booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(CASE WHEN UPPER(SAFE_CAST(revenue_transaction_status AS STRING)) IN ('BILLED', 'BOOKED') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_status_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Revenue Transaction Status Filter' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Sales Group Client Filter' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'Client' THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'Client' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(booking_line_created_date AS DATE) AS booking_date,\n  advertiser_parent,\n  gross_revenue_amount,\n  relative_fy_year_offset,\n  revenue_transaction_status,\n  style_name,\n  fin_adtype_name,\n  revenue_type,\n  sales_segment_l_2_name_sync,\n  IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n  LEFT JOIN (\n    SELECT\n      UPPER(network_user_name) AS login_name,\n      UPPER(user_name) AS full_name\n    FROM\n      `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n    WHERE\n      dw_source_system_code = 'SFCE'\n    QUALIFY ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) = 1\n  ) AS GSD_JOIN\n  ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(booking_line_created_date AS DATE) DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-01-02"",
          ""original_format"": ""2025-01-02 01:26:03.721975+00"",
          ""context"": ""Used as a fixed reference point for date calculations (clmn0_ in query 1)."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter for dynamic reporting."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'BILLED'"",
            ""'BOOKED'""
          ],
          ""context"": ""Revenue transaction statuses used for filtering."",
          ""suggested_governance"": ""Manage valid statuses in a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'ROP COMPOSITE'"",
            ""'MEDIUM RARE CONTENT AGENCY'""
          ],
          ""context"": ""Specific style names and publishing divisions excluded from analysis."",
          ""suggested_governance"": ""Manage exclusion lists in a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'""
          ],
          ""context"": ""Complex logic for publication names and associated account numbers."",
          ""suggested_governance"": ""Define these exceptions in a dedicated business rule table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'MRCA'"",
            ""'Client'""
          ],
          ""context"": ""Categorization of Sales_Group."",
          ""suggested_governance"": ""If these are fixed, they can remain; otherwise, consider a lookup."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'XTEND'""
          ],
          ""context"": ""Specific value used in `fin_adtype_name` derivation."",
          ""suggested_governance"": ""If this is a dynamic category, manage in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CONSORTIUM NSW'"",
            ""'KEY ACCOUNTS NSW RETAIL'"",
            ""'DIRECT NSW'"",
            ""'INDEPENDENT AGENCIES NSW'"",
            ""'PRESTIGE'""
          ],
          ""context"": ""Specific sales segments mapped to 'Ian Paterson'."",
          ""suggested_governance"": ""Manage GM assignments in a dedicated mapping table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""conditional_logic"",
          ""hardcoded_values"": [
            ""'$' = '$'"",
            ""'$\\'000' = '$'"",
            ""'1' = '1'"",
            ""'1' = '2'"",
            ""'1' = '3'""
          ],
          ""context"": ""Redundant or always true/false conditions in CASE statements, indicating potential legacy or unused logic."",
          ""suggested_governance"": ""Refactor queries to remove these redundant conditions for clarity and efficiency."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-01-02') with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Replace hardcoded lookup values (e.g., revenue statuses, style names, publication exceptions) with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables for complex business rules (e.g., GM assignments, publication exceptions) instead of embedding them directly in SQL logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total sum of gross revenue amounts across all relevant transactions, after applying core dashboard filters."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for sales performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for null gross_revenue_amount values (handled by IFNULL in source CTE).""
      ]
    },
    {
      ""metric_id"": ""ly_gross_revenue_amount"",
      ""metric_name"": ""Last Year Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the last financial year (relative_fy_year_offset = -1)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_gross_revenue_amount"",
      ""metric_name"": ""Current Year Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary revenue metric for current period performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue_amount_k"",
      ""metric_name"": ""Last Year Gross Revenue Amount (in '000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""ly_gross_revenue_amount""
      ],
      ""business_description"": ""Last Year Gross Revenue Amount divided by 1000, for display in thousands."",
      ""sql_logic"": ""ly_gross_revenue_amount / 1000"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Presentation metric for easier readability of large revenue figures."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_gross_revenue_amount_k"",
      ""metric_name"": ""Current Year Gross Revenue Amount (in '000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""cy_gross_revenue_amount""
      ],
      ""business_description"": ""Current Year Gross Revenue Amount divided by 1000, for display in thousands."",
      ""sql_logic"": ""cy_gross_revenue_amount / 1000"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Presentation metric for easier readability of large revenue figures."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""max_ly_gross_revenue_amount"",
      ""metric_name"": ""Max Last Year Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount""
      ],
      ""business_description"": ""The maximum gross revenue amount for a single transaction in the last financial year."",
      ""sql_logic"": ""MAX(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to identify largest individual revenue contributions from the previous year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue_amount_conditional_date"",
      ""metric_name"": ""Last Year Gross Revenue Amount (Conditional Date)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount"",
        ""fix_date_lod_calculated"",
        ""booking_created_date""
      ],
      ""business_description"": ""Last Year Gross Revenue Amount with a complex date condition. This metric includes revenue from the last financial year where the booking date (or fixed LOD date for Doubleclick) is before a specific hardcoded date (2025-01-02 minus 365 days)."",
      ""sql_logic"": ""SUM(CASE WHEN fd.relative_fy_year_offset = -1 AND (CASE WHEN fd.revenue_type = 'DIGITAL' AND fd.revenue_group_subtype = 'DIGITAL' AND fd.sales_segment_l_2_name_sync = 'Digital Other' AND fd.advertiser_parent != 'DOUBLECLICK' THEN SAFE_CAST(fd.fix_date_lod AS DATETIME) ELSE SAFE_CAST(PARSE_DATE('%Y-%m-%d', fd.booking_line_created_date) AS DATETIME) END) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-02 01:26:03.721975+00', 'UTC') AS DATETIME), INTERVAL -365 DAY) THEN fd.gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A highly specific revenue metric, likely used for a very particular historical comparison or data cut-off analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-02""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'"",
        ""-365""
      ],
      ""governance_issues"": [
        ""Date '2025-01-02' should be parameterized."",
        ""Hardcoded string values should be managed via reference tables.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_adjustment_amount"",
      ""metric_name"": ""Total Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all adjustment amounts."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to understand financial adjustments impacting revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pub_lgb"",
      ""metric_name"": ""Total Publication LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of 'pub_lgb' values, likely related to publication-level targets or budgets."",
      ""sql_logic"": ""SUM(IFNULL(pub_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for tracking publication-specific performance against targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ss_lgb"",
      ""metric_name"": ""Total Sales Segment LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of 'ss_lgb' values, likely related to sales segment-level targets or budgets."",
      ""sql_logic"": ""SUM(IFNULL(ss_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for tracking sales segment performance against targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of pipeline values, representing potential future revenue."",
      ""sql_logic"": ""SUM(IFNULL(pipeline, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for forecasting and understanding sales funnel health."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_target"",
      ""metric_name"": ""Total Target"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of target values, representing sales goals."",
      ""sql_logic"": ""SUM(IFNULL(target, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter logic"",
        ""Sales_Group = 'Client'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to measure performance against set sales targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""ly_gross_revenue_amount_k"",
      ""related_metrics"": [
        ""ly_gross_revenue_amount""
      ],
      ""relationship_description"": ""Last Year Gross Revenue Amount (in '000s) is derived directly from Last Year Gross Revenue Amount by dividing by 1000."",
      ""mathematical_formula"": ""ly_gross_revenue_amount_k = ly_gross_revenue_amount / 1000"",
      ""business_validation"": ""Ensures consistent scaling for presentation of large numbers."",
      ""validation_sql"": ""SELECT SUM(ly_gross_revenue_amount_k * 1000) = SUM(ly_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE ly_gross_revenue_amount IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""cy_gross_revenue_amount_k"",
      ""related_metrics"": [
        ""cy_gross_revenue_amount""
      ],
      ""relationship_description"": ""Current Year Gross Revenue Amount (in '000s) is derived directly from Current Year Gross Revenue Amount by dividing by 1000."",
      ""mathematical_formula"": ""cy_gross_revenue_amount_k = cy_gross_revenue_amount / 1000"",
      ""business_validation"": ""Ensures consistent scaling for presentation of large numbers."",
      ""validation_sql"": ""SELECT SUM(cy_gross_revenue_amount_k * 1000) = SUM(cy_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE cy_gross_revenue_amount IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""ly_gross_revenue_amount_conditional_date"",
      ""related_metrics"": [
        ""ly_gross_revenue_amount"",
        ""fix_date_lod_calculated"",
        ""booking_created_date""
      ],
      ""relationship_description"": ""This metric is a subset of Last Year Gross Revenue Amount, further filtered by a complex date condition involving `fix_date_lod` or `booking_created_date` relative to a hardcoded future date."",
      ""mathematical_formula"": ""ly_gross_revenue_amount_conditional_date <= ly_gross_revenue_amount"",
      ""business_validation"": ""The conditional date metric should always be less than or equal to the total Last Year Gross Revenue Amount."",
      ""validation_sql"": ""SELECT SUM(ly_gross_revenue_amount_conditional_date) <= SUM(ly_gross_revenue_amount) FROM (/* primary_analysis_sql here */) WHERE ly_gross_revenue_amount IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""Sales_Group""
      ],
      ""relationship_description"": ""All revenue metrics are filtered by `Sales_Group = 'Client'`, as observed in Query 1. This significantly narrows the scope of the dashboard's analysis."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Confirms that the dashboard focuses specifically on 'Client' sales performance, excluding 'MRCA' or other sales groups."",
      ""validation_sql"": ""SELECT COUNTIF(Sales_Group = 'Client') / COUNT(*) AS client_sales_ratio FROM (/* primary_analysis_sql here */); -- Should be 1.0 if filter is applied correctly."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,10
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""3ee20092-1897-49b7-8bcd-4157d5f816eb"",
    ""dashboard_name"": ""AdSales Data for Pacing Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_week"",
      ""revenue_group_subtype""
    ],
    ""date_range_detected"": ""2024 to 2025"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'SUNDRY ADSALES OVERLAY'"",
      ""'2025'"",
      ""'2024'"",
      ""47, 48, 49, 50, 51, 52""
    ],
    ""governance_opportunities"": [
      ""financial_year should be parameterized or derived from current date"",
      ""revenue_group_subtype values should be managed in a lookup table"",
      ""financial_week exclusion list should be parameterized or derived from a business calendar""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_adsales_data AS (\n  SELECT\n    t0.financial_year,\n    t0.financial_week,\n    t0.revenue_group_subtype,\n    -- Assuming 'revenue' is the primary metric for a Pacing Report\n    SAFE_CAST(t0.revenue AS NUMERIC) AS revenue_amount\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    -- Filter from job_BUjTW7YGaSH0alMHKZZXNmosCioO (revenue_group_subtype filter)\n    (t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY' OR TRUE) -- Apply if specific filter is needed, otherwise TRUE for all\n    AND\n    -- Filter from job_Dq3y_fZwu5Vvm8AyidX7IeOMTGjP (financial_year filter)\n    (SAFE_CAST(t0.financial_year AS STRING) = '2025' OR TRUE) -- Apply if specific filter is needed, otherwise TRUE for all\n    AND\n    -- Filters from job_kBhca8c_b2djBMHH3ux3prckr1Hr (financial_year and financial_week filters)\n    (SAFE_CAST(t0.financial_year AS STRING) IN ('2025', '2024'))\n    AND\n    (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR t0.financial_week IS NULL)\n)\nSELECT\n  financial_year,\n  financial_week,\n  revenue_group_subtype,\n  SUM(revenue_amount) AS total_adsales_revenue,\n  COUNT(*) AS record_count\nFROM base_adsales_data\nWHERE revenue_amount IS NOT NULL -- Ensure we only sum valid revenue figures\nGROUP BY\n  financial_year,\n  financial_week,\n  revenue_group_subtype\nORDER BY\n  financial_year DESC,\n  financial_week DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(financial_week AS INT64)) as unique_financial_weeks,\n  COUNT(DISTINCT revenue_group_subtype) as unique_revenue_subtypes,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year,\n  MIN(SAFE_CAST(financial_week AS INT64)) as earliest_financial_week,\n  MAX(SAFE_CAST(financial_week AS INT64)) as latest_financial_week,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(financial_year AS STRING), '-', SAFE_CAST(financial_week AS STRING), '-', revenue_group_subtype)) as approx_unique_grain_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025') -- Focus on relevant years for structure analysis\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN SUM(CASE WHEN SAFE_CAST(financial_year AS STRING) = '2025' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as year_2025_data_test,\n  CASE WHEN SUM(CASE WHEN revenue_group_subtype = 'SUNDRY ADSALES OVERLAY' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as sundry_adsales_overlay_data_test,\n  CASE WHEN SUM(CASE WHEN SAFE_CAST(financial_week AS INT64) IN (47, 48, 49, 50, 51, 52) THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_week_exclusion_data_test_presence\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'financial_week_exclusion_rule' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN SAFE_CAST(financial_week AS INT64) IN (47, 48, 49, 50, 51, 52) THEN 1 ELSE 0 END) as records_in_excluded_weeks,\n  SUM(CASE WHEN SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL THEN 1 ELSE 0 END) as records_passing_exclusion_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025');"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(financial_week AS INT64) as financial_week,\n  revenue_group_subtype,\n  SAFE_CAST(revenue AS NUMERIC) as revenue_amount -- Assuming 'revenue' column exists\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\nORDER BY financial_year DESC, financial_week DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SUNDRY ADSALES OVERLAY'""
          ],
          ""context"": ""Specific revenue group subtype used as a filter."",
          ""suggested_governance"": ""Replace with a parameter or join to a `revenue_group_subtype_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'2025'"",
            ""'2024'""
          ],
          ""context"": ""Specific financial years used as filters."",
          ""suggested_governance"": ""Replace with dynamic calculations (e.g., `CURRENT_FINANCIAL_YEAR`, `PREVIOUS_FINANCIAL_YEAR`) or dashboard parameters."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""47"",
            ""48"",
            ""49"",
            ""50"",
            ""51"",
            ""52""
          ],
          ""context"": ""Specific financial weeks excluded from analysis (likely end-of-year/holiday weeks)."",
          ""suggested_governance"": ""Define these weeks in a configuration table or derive them dynamically based on a financial calendar."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with dynamic calculations (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` for current year, or Looker Studio date parameters)."",
      ""Replace hardcoded `revenue_group_subtype` values with dashboard parameters or values from a governed lookup table."",
      ""Replace hardcoded financial week exclusion lists with a configuration table or a derived list based on a financial calendar definition.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the ad sales performance data."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('2025', '2024')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping ad sales data by financial year, crucial for pacing reports."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""'2024'""
      ],
      ""governance_issues"": [
        ""Hardcoded years should be parameterized or dynamic.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week within the financial year for the ad sales performance data."",
      ""sql_logic"": ""t0.financial_week"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""NOT IN (47, 48, 49, 50, 51, 52) OR IS NULL""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for filtering and grouping ad sales data by financial week, essential for granular pacing analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""47"",
        ""48"",
        ""49"",
        ""50"",
        ""51"",
        ""52""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion list for financial weeks should be dynamic or parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls handled explicitly in filter logic.""
      ]
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A detailed categorization of the revenue group, e.g., 'SUNDRY ADSALES OVERLAY'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('SUNDRY ADSALES OVERLAY')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering ad sales data to specific revenue categories, allowing focused analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'SUNDRY ADSALES OVERLAY'""
      ],
      ""governance_issues"": [
        ""Hardcoded subtype values should be managed in a lookup table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_adsales_revenue"",
      ""metric_name"": ""Total AdSales Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue generated from ad sales for a given financial period and revenue subtype. This is an inferred metric crucial for a 'Pacing Report'."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.revenue AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025', '2024')"",
        ""financial_week NOT IN (47, 48, 49, 50, 51, 52) OR IS NULL"",
        ""revenue_group_subtype IN ('SUNDRY ADSALES OVERLAY')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""The core metric for tracking ad sales performance against targets and historical data in a pacing report."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""'2024'"",
        ""'SUNDRY ADSALES OVERLAY'"",
        ""47"",
        ""48"",
        ""49"",
        ""50"",
        ""51"",
        ""52""
      ],
      ""governance_issues"": [
        ""Filters applied to this metric use hardcoded values that should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on the accuracy and completeness of the underlying 'revenue' column."",
        ""Potential for nulls in 'revenue' column if not handled by SAFE_CAST and WHERE clause.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_adsales_revenue"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_week"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""The 'Total AdSales Revenue' is directly impacted by the filters applied to 'Financial Year', 'Financial Week', and 'Revenue Group Subtype'. These dimensions act as contextual filters for the revenue metric."",
      ""mathematical_formula"": ""SUM(Revenue) WHERE Financial_Year IN (...) AND Financial_Week NOT IN (...) AND Revenue_Group_Subtype IN (...)"",
      ""business_validation"": ""Ensures that the reported revenue aligns with specific reporting periods and business segments, crucial for accurate pacing analysis."",
      ""validation_sql"": ""SELECT\n  SUM(SAFE_CAST(t0.revenue AS NUMERIC)) AS filtered_revenue,\n  (SELECT SUM(SAFE_CAST(t1.revenue AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t1) AS total_unfiltered_revenue\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) IN ('2025', '2024')\n  AND (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR t0.financial_week IS NULL)\n  AND t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,11
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""155c4518-72bf-4309-a0e9-240dd564f421"",
    ""dashboard_name"": ""Portfolio Performance Dashboard"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""GSD"",
      ""advertiser_group"",
      ""portfolio_conformed_name_sync"",
      ""product_group"",
      ""revenue_type"",
      ""fin_adtype_name"",
      ""sales_segment_gm_name_sync"",
      ""relative_fy_quarter_offset"",
      ""relative_fy_year_offset"",
      ""financial_month"",
      ""financial_quarter""
    ],
    ""date_range_detected"": ""Relative to current FY"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""0 (for @reporting_mth)"",
      ""1 (for @customer_retention_type)"",
      ""0.01 (for blank_portfolio_flag threshold)"",
      ""1 (for retention logic thresholds)"",
      ""'DESIREE DURRANT'"",
      ""'CHRIS JEFFS'"",
      ""'PRINT'"",
      ""'XTEND'"",
      ""'The Australian & Prestige'"",
      ""'State & Communities'"",
      ""'Free News & Lifestyle'"",
      ""'Client'"",
      ""'Commercial Content'"",
      ""'Group Functions'"",
      ""'Others'"",
      ""'Unknown'"",
      ""'NEW BUSINESS'"",
      ""'RETAINED'"",
      ""'INACTIVE'"",
      ""'LAPSED'"",
      ""'Other'"",
      ""'All'"",
      ""'include'"",
      ""'exclude'""
    ],
    ""governance_opportunities"": [
      ""Parameterize reporting period and customer retention type"",
      ""Externalize customer status business rules (thresholds and categories)"",
      ""Use reference tables for product group mappings"",
      ""Parameterize GSD names for filtering"",
      ""Parameterize revenue/ad type exclusions"",
      ""Externalize revenue/target thresholds for blank_portfolio_flag""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""DECLARE reporting_mth INT64 DEFAULT 0; -- Default to 0 for dynamic month selection (current month or -12)\nDECLARE customer_retention_type STRING DEFAULT '0'; -- Default to '0' for detailed customer status, '1' for 'All'\n\nWITH base_data AS (\n  WITH CTE AS (\n    SELECT\n      *,\n      CASE\n        WHEN reporting_mth = 0 THEN\n        CASE\n          WHEN relative_fy_month_offset = 0 OR relative_fy_month_offset = -12 THEN SAFE_CAST(financial_month AS INT64)\n        END\n        ELSE reporting_mth\n      END AS filter_reporting_month,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ly_lgr,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\n  )\n  SELECT\n    t0.GSD,\n    t0.advertiser_group,\n    t0.portfolio_conformed_name_sync,\n    t0.product_group,\n    t0.fin_adtype_name,\n    t0.revenue_type,\n    t0.sales_segment_gm_name_sync,\n    t0.gross_revenue_amount,\n    t0.target,\n    t0.relative_fy_year_offset,\n    t0.relative_fy_quarter_offset,\n    t0.financial_month,\n    t0.financial_quarter,\n    MAX(\n      CASE\n        WHEN filter_reporting_month = SAFE_CAST(financial_month AS INT64) THEN financial_quarter\n        WHEN reporting_mth = 0 THEN IF(relative_fy_quarter_offset = 0, financial_quarter, null)\n        ELSE NULL\n      END) OVER (PARTITION BY filter_reporting_month) AS report_quarter,\n    CASE\n      WHEN customer_retention_type = '1' THEN 'All'\n      ELSE\n      CASE\n        WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS'\n        WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED'\n        WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE'\n        WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED'\n        ELSE 'Other'\n      END\n    END AS customer_status_full,\n    CASE\n      WHEN SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) OVER (PARTITION BY portfolio_conformed_name_sync) > 0.01 OR SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) OVER (PARTITION BY portfolio_conformed_name_sync) < -0.01 OR SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) != 0 THEN 'include'\n      ELSE 'exclude'\n    END AS blank_portfolio_flag\n  FROM\n    CTE AS t0\n  WHERE\n    -- Apply a general date filter for performance, e.g., last 2 fiscal years of data\n    t0.relative_fy_year_offset BETWEEN -2 AND 0\n)\nSELECT\n  GSD,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  product_group,\n  fin_adtype_name,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  customer_status_full,\n  blank_portfolio_flag,\n  -- Metrics from Query 1 (conditional sums)\n  SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS current_year_q1_revenue_k,\n  SUM(CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS last_year_q4_revenue_k,\n  SUM(CASE WHEN (relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(target, 1000) ELSE NULL END) AS current_quarter_target_k,\n  -- Record count (similar to Query 2's count, but generalized)\n  COUNT(*) AS record_count_for_group,\n  -- Raw values for deeper analysis\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(target) AS total_target_amount\nFROM\n  base_data\nGROUP BY\n  GSD,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  product_group,\n  fin_adtype_name,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  customer_status_full,\n  blank_portfolio_flag\nORDER BY\n  GSD, advertiser_group\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT GSD) as unique_gsds,\n  COUNT(DISTINCT advertiser_group) as unique_advertiser_groups,\n  COUNT(DISTINCT portfolio_conformed_name_sync) as unique_portfolios,\n  COUNT(DISTINCT product_group) as unique_product_groups,\n  COUNT(DISTINCT fin_adtype_name) as unique_fin_adtypes,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  MIN(relative_fy_year_offset) as min_fy_year_offset,\n  MAX(relative_fy_year_offset) as max_fy_year_offset,\n  MIN(financial_month) as min_financial_month,\n  MAX(financial_month) as max_financial_month,\n  AVG(gross_revenue_amount) as avg_gross_revenue_amount,\n  AVG(target) as avg_target_amount\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  -- Filter to recent data for structure analysis\n  relative_fy_year_offset BETWEEN -2 AND 0\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_group) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_group_test,\n  CASE WHEN MAX(relative_fy_year_offset) >= 0 THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(product_group AS STRING) IS NOT NULL THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as product_group_data_test\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  relative_fy_year_offset = 0 -- Current fiscal year\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH CTE AS (\n    SELECT\n      *,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ly_lgr,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\n    WHERE\n      relative_fy_year_offset BETWEEN -1 AND 0 -- Only need current and last FY for retention logic\n  )\nSELECT\n  'Business Rule Validation' as validation_type,\n  'customer_status_full_logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN customer_status_full = 'NEW BUSINESS' THEN 1 ELSE 0 END) as new_business_count,\n  SUM(CASE WHEN customer_status_full = 'RETAINED' THEN 1 ELSE 0 END) as retained_count,\n  SUM(CASE WHEN customer_status_full = 'INACTIVE' THEN 1 ELSE 0 END) as inactive_count,\n  SUM(CASE WHEN customer_status_full = 'LAPSED' THEN 1 ELSE 0 END) as lapsed_count,\n  SUM(CASE WHEN customer_status_full = 'Other' THEN 1 ELSE 0 END) as other_count\nFROM (\n  SELECT\n    CASE\n      WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS'\n      WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED'\n      WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE'\n      WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED'\n      ELSE 'Other'\n    END AS customer_status_full\n  FROM CTE\n) AS sub\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  -- Cast all potentially problematic columns for safe viewing\n  SAFE_CAST(GSD AS STRING) as GSD,\n  SAFE_CAST(advertiser_group AS STRING) as advertiser_group,\n  SAFE_CAST(portfolio_conformed_name_sync AS STRING) as portfolio_conformed_name_sync,\n  SAFE_CAST(product_group AS STRING) as product_group,\n  SAFE_CAST(fin_adtype_name AS STRING) as fin_adtype_name,\n  SAFE_CAST(revenue_type AS STRING) as revenue_type,\n  SAFE_CAST(sales_segment_gm_name_sync AS STRING) as sales_segment_gm_name_sync,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(target AS NUMERIC) as target,\n  SAFE_CAST(relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  SAFE_CAST(relative_fy_quarter_offset AS INT64) as relative_fy_quarter_offset,\n  SAFE_CAST(financial_month AS INT64) as financial_month,\n  SAFE_CAST(financial_quarter AS STRING) as financial_quarter\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  relative_fy_year_offset = 0 -- Sample from current fiscal year\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0 (for @reporting_mth)"",
            ""1 (for @customer_retention_type)"",
            ""0.01 (for blank_portfolio_flag threshold)"",
            ""1 (for retention logic thresholds)""
          ],
          ""context"": ""Parameters and thresholds for derived dimensions and metrics are hardcoded in the SQL."",
          ""suggested_governance"": ""These values should be externalized as Looker Studio parameters or configuration tables."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DESIREE DURRANT'"",
            ""'CHRIS JEFFS'"",
            ""'PRINT'"",
            ""'XTEND'"",
            ""'The Australian & Prestige'"",
            ""'State & Communities'"",
            ""'Free News & Lifestyle'"",
            ""'Client'"",
            ""'Commercial Content'"",
            ""'Group Functions'"",
            ""'Others'"",
            ""'Unknown'"",
            ""'NEW BUSINESS'"",
            ""'RETAINED'"",
            ""'INACTIVE'"",
            ""'LAPSED'"",
            ""'Other'"",
            ""'All'""
          ],
          ""context"": ""Specific GSD names, revenue/ad types, product group names, and customer status categories are hardcoded."",
          ""suggested_governance"": ""Use Looker Studio filter controls for GSD names. Map product groups and customer statuses using governed reference tables."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded `@reporting_mth` and `@customer_retention_type` with Looker Studio parameters."",
      ""Externalize customer retention thresholds (e.g., `fix_ly_lgr <= 1`) into a configuration table or parameters."",
      ""Externalize product group integer mappings into a lookup table."",
      ""Allow GSD names and revenue/ad type exclusions to be selected via dashboard filters rather than hardcoding in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for an ad sales transaction."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric used for calculating various revenue-based KPIs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy of source data""
      ]
    },
    {
      ""metric_id"": ""target_amount"",
      ""metric_name"": ""Target Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The target revenue amount for an ad sales transaction."",
      ""sql_logic"": ""t0.target"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to measure performance against set goals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy of source data""
      ]
    },
    {
      ""metric_id"": ""current_year_q1_revenue_k"",
      ""metric_name"": ""Current Year Q1 Revenue (k)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Sum of gross revenue amount in thousands for the current fiscal year (relative_fy_year_offset = 0) and current fiscal quarter (relative_fy_quarter_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_quarter_offset = 0"",
        ""GSD IN ('DESIREE DURRANT') (in original query context)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current quarter revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (for year offset)"",
        ""0 (for quarter offset)"",
        ""1000 (for division)""
      ],
      ""governance_issues"": [
        ""division by 1000 should be dynamic if '000s toggle exists""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""last_year_q4_revenue_k"",
      ""metric_name"": ""Last Year Q4 Revenue (k)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Sum of gross revenue amount in thousands for the previous fiscal year (relative_fy_year_offset = -1) and last fiscal quarter (relative_fy_quarter_offset = -4)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""relative_fy_quarter_offset = -4"",
        ""GSD IN ('DESIREE DURRANT') (in original query context)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparison and trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1 (for year offset)"",
        ""-4 (for quarter offset)"",
        ""1000 (for division)""
      ],
      ""governance_issues"": [
        ""division by 1000 should be dynamic if '000s toggle exists""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""current_quarter_target_k"",
      ""metric_name"": ""Current Quarter Target (k)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""target_amount""
      ],
      ""business_description"": ""Sum of target amount in thousands for the current fiscal quarter (relative_fy_quarter_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(target, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_quarter_offset = 0"",
        ""GSD IN ('DESIREE DURRANT') (in original query context)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures target achievement for the current quarter."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (for quarter offset)"",
        ""1000 (for division)""
      ],
      ""governance_issues"": [
        ""division by 1000 should be dynamic if '000s toggle exists""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""customer_status_full"",
      ""metric_name"": ""Customer Status Full"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""fix_ly_lgr"",
        ""fix_ty_lgr""
      ],
      ""business_description"": ""Categorizes customers based on their gross revenue performance in the last fiscal year (LY) and current fiscal year (TY)."",
      ""sql_logic"": ""CASE WHEN @customer_retention_type = '1' THEN 'All' ELSE CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS' WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED' WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE' WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED' ELSE 'Other' END END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for customer segmentation and retention analysis."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'1' (for @customer_retention_type)"",
        ""1 (for revenue thresholds)"",
        ""'NEW BUSINESS'"",
        ""'RETAINED'"",
        ""'INACTIVE'"",
        ""'LAPSED'"",
        ""'Other'"",
        ""'All'""
      ],
      ""governance_issues"": [
        ""thresholds should be configurable"",
        ""categories should be externalized""
      ],
      ""data_quality_concerns"": [
        ""depends on accurate fix_ly_lgr and fix_ty_lgr""
      ]
    },
    {
      ""metric_id"": ""blank_portfolio_flag"",
      ""metric_name"": ""Blank Portfolio Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""portfolio"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""target_amount""
      ],
      ""business_description"": ""Flags portfolios that have significant gross revenue or target amounts (summed over the portfolio). Used to include/exclude portfolios from analysis."",
      ""sql_logic"": ""CASE WHEN SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) > 0.01 OR SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) < -0.01 OR SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) != 0 THEN 'include' ELSE 'exclude' END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Data quality or filtering mechanism for portfolio-level reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0.01 (threshold)"",
        ""1000 (division)"",
        ""0 (year offset for target)"",
        ""'include'"",
        ""'exclude'""
      ],
      ""governance_issues"": [
        ""thresholds should be configurable""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in target""
      ]
    },
    {
      ""metric_id"": ""record_count_by_product_group"",
      ""metric_name"": ""Record Count by Product Group"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product_group"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Counts the number of records for each product group, after applying specific filters."",
      ""sql_logic"": ""COUNT(*)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""GSD IN ('CHRIS JEFFS') (in original query context)"",
        ""(revenue_type NOT IN ('PRINT') OR (fin_adtype_name = 'XTEND' AND revenue_type = 'PRINT')) (in original query context)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides volume metrics per product group, useful for understanding distribution."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CHRIS JEFFS'"",
        ""'PRINT'"",
        ""'XTEND'"",
        ""product group mappings""
      ],
      ""governance_issues"": [
        ""product group mappings should be externalized"",
        ""filters should be configurable""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_of_product_group_mapping"",
      ""metric_name"": ""Sum of Product Group Mapping"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product_group"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sums the integer mapping of product groups. This metric is likely an artifact of Looker Studio's internal metric generation and has limited business meaning."",
      ""sql_logic"": ""SUM(CASE WHEN (product_group = 'The Australian & Prestige') THEN 1 ... ELSE 9 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""GSD IN ('CHRIS JEFFS') (in original query context)"",
        ""(revenue_type NOT IN ('PRINT') OR (fin_adtype_name = 'XTEND' AND revenue_type = 'PRINT')) (in original query context)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely a technical artifact, not a direct business metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""product group mappings""
      ],
      ""governance_issues"": [
        ""product group mappings should be externalized""
      ],
      ""data_quality_concerns"": [
        ""low business value""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""customer_status_full"",
      ""related_metrics"": [
        ""fix_ly_lgr"",
        ""fix_ty_lgr""
      ],
      ""relationship_description"": ""The 'Customer Status Full' dimension is directly calculated based on the 'Last Year's Gross Revenue (fix_ly_lgr)' and 'This Year's Gross Revenue (fix_ty_lgr)' for each advertiser group."",
      ""mathematical_formula"": ""N/A (conditional logic)"",
      ""business_validation"": ""Ensures customer segmentation aligns with defined revenue thresholds for retention analysis."",
      ""validation_sql"": ""SELECT customer_status_full, fix_ly_lgr, fix_ty_lgr FROM base_data LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fix_ly_lgr"",
      ""related_metrics"": [
        ""gross_revenue_amount""
      ],
      ""relationship_description"": ""fix_ly_lgr (Last Year's Gross Revenue) is a sum of gross_revenue_amount partitioned by advertiser_group for relative_fy_year_offset = -1."",
      ""mathematical_formula"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""business_validation"": ""Provides the baseline for year-over-year revenue comparison for customer retention."",
      ""validation_sql"": ""SELECT advertiser_group, SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS calculated_ly_lgr FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY advertiser_group LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fix_ty_lgr"",
      ""related_metrics"": [
        ""gross_revenue_amount""
      ],
      ""relationship_description"": ""fix_ty_lgr (This Year's Gross Revenue) is a sum of gross_revenue_amount partitioned by advertiser_group for relative_fy_year_offset = 0."",
      ""mathematical_formula"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""business_validation"": ""Provides the current year's revenue for comparison in customer retention logic."",
      ""validation_sql"": ""SELECT advertiser_group, SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS calculated_ty_lgr FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY advertiser_group LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""blank_portfolio_flag"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""target_amount""
      ],
      ""relationship_description"": ""The 'Blank Portfolio Flag' is determined by the sum of gross revenue and target amounts (for current FY) within each portfolio, checking against a threshold (0.01)."",
      ""mathematical_formula"": ""N/A (conditional logic based on sums)"",
      ""business_validation"": ""Ensures that only relevant portfolios (with significant revenue or targets) are included in certain analyses, preventing noise from empty or negligible portfolios."",
      ""validation_sql"": ""SELECT portfolio_conformed_name_sync, SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) AS total_revenue_k, SUM(IF(relative_fy_year_offset = 0, target, null)) AS total_target FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance GROUP BY portfolio_conformed_name_sync LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_year_q1_revenue_k"",
      ""related_metrics"": [
        ""gross_revenue_amount""
      ],
      ""relationship_description"": ""Current Year Q1 Revenue (k) is a conditional sum of gross revenue amount, specifically for the current fiscal year and quarter, divided by 1000."",
      ""mathematical_formula"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN gross_revenue_amount / 1000 ELSE NULL END)"",
      ""business_validation"": ""Directly measures current quarter revenue performance against targets and historical data."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS calculated_q1_revenue_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""last_year_q4_revenue_k"",
      ""related_metrics"": [
        ""gross_revenue_amount""
      ],
      ""relationship_description"": ""Last Year Q4 Revenue (k) is a conditional sum of gross revenue amount, specifically for the previous fiscal year and its last quarter, divided by 1000."",
      ""mathematical_formula"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN gross_revenue_amount / 1000 ELSE NULL END)"",
      ""business_validation"": ""Provides a historical benchmark for comparing current performance and identifying trends."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) AS calculated_ly_q4_revenue_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_quarter_target_k"",
      ""related_metrics"": [
        ""target_amount""
      ],
      ""relationship_description"": ""Current Quarter Target (k) is a conditional sum of the target amount for the current fiscal quarter, divided by 1000."",
      ""mathematical_formula"": ""SUM(CASE WHEN (relative_fy_quarter_offset = 0) THEN target / 1000 ELSE NULL END)"",
      ""business_validation"": ""Measures the target set for the current quarter, crucial for performance tracking and gap analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(target, 1000) ELSE NULL END) AS calculated_q_target_k FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE GSD = 'DESIREE DURRANT' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,12
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3"",
    ""dashboard_name"": ""Copy of Interim Adsales Performance Dashboard for FY26"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""product_group"",
      ""revenue_type"",
      ""unified_publication_name"",
      ""relative_fy_year_offset"",
      ""dw_asl_load_timestamp""
    ],
    ""date_range_detected"": ""Not explicitly detected from SQL, but 'relative_fy_year_offset' implies fiscal year context (current vs. previous FY)."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'The Australian & Prestige'"",
      ""'PRINT'"",
      ""'GQ Mag'"",
      ""0 (for current FY offset)"",
      ""1 (for previous FY offset)"",
      ""'$'000' = '$' (unit conversion condition, always false)"",
      ""List of 30+ specific publication names for 'Sundry Pubs' classification""
    ],
    ""governance_opportunities"": [
      ""relative_fy_year_offset should be derived from a fiscal calendar dimension table or dynamic date parameters."",
      ""The hardcoded list of 'Sundry Pubs' should be moved to a governed reference table."",
      ""The unit conversion logic ('$'000' = '$') appears to be dead code or misconfigured; it should be removed or made dynamic."",
      ""Specific filter values like 'The Australian & Prestige', 'PRINT', 'GQ Mag' should be parameterized for user selection.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates key metrics and dimensions from the dashboard's underlying SQL.\n-- It calculates current and previous fiscal year gross revenue (in thousands) and categorizes publications.\n-- A general date filter is applied for performance, assuming 'dw_asl_load_timestamp' is the primary date column.\nWITH base_data AS (\n  SELECT\n    t0.gross_revenue_amount,\n    t0.product_group,\n    t0.relative_fy_year_offset,\n    t0.revenue_type,\n    t0.unified_publication_name,\n    t0.dw_asl_load_timestamp\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) -- Filter for recent data\n)\nSELECT\n  product_group,\n  CASE\n    WHEN unified_publication_name IN (\n      'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n      'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n      'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au',\n      'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n      'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG',\n      'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n    ) THEN 'Sundry Pubs'\n    ELSE 'Non Sundry Pubs'\n  END AS publication_type,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) AS current_fy_gross_revenue_000s,\n  SUM(CASE WHEN relative_fy_year_offset = 1 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) AS previous_fy_gross_revenue_000s,\n  MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) AS min_data_load_timestamp\nFROM base_data\nWHERE product_group IN ('The Australian & Prestige') -- Common filter from original revenue query\nGROUP BY\n  product_group,\n  publication_type\nORDER BY\n  product_group,\n  publication_type\nLIMIT 100;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(dw_asl_load_timestamp AS DATE)) as unique_load_dates,\n  COUNT(DISTINCT product_group) as unique_product_groups,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT unified_publication_name) as unique_publication_names,\n  COUNT(DISTINCT relative_fy_year_offset) as unique_fy_offsets,\n  MIN(SAFE_CAST(dw_asl_load_timestamp AS DATE)) as earliest_load_date,\n  MAX(SAFE_CAST(dw_asl_load_timestamp AS DATE)) as latest_load_date,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present.\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT product_group) > 0 THEN 'PASS' ELSE 'FAIL' END as product_group_test,\n  CASE WHEN MAX(SAFE_CAST(dw_asl_load_timestamp AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN relative_fy_year_offset = 0 THEN 1 END) > 0 AND COUNT(CASE WHEN relative_fy_year_offset = 1 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as fy_offset_data_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, specifically the 'Sundry Pubs' classification.\nSELECT\n  'Business Rule Validation' as validation_type,\n  'sundry_pubs_classification' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE\n    WHEN unified_publication_name IN (\n      'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n      'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n      'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au',\n      'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n      'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG',\n      'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n    ) THEN 1 ELSE 0 END\n  ) as sundry_pubs_count,\n  SUM(CASE\n    WHEN unified_publication_name NOT IN (\n      'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n      'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n      'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au',\n      'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n      'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG',\n      'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n    ) THEN 1 ELSE 0 END\n  ) as non_sundry_pubs_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 100;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis.\nSELECT\n  SAFE_CAST(dw_asl_load_timestamp AS DATETIME) as dw_asl_load_timestamp,\n  product_group,\n  revenue_type,\n  unified_publication_name,\n  relative_fy_year_offset,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY dw_asl_load_timestamp DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Admin.ADV'"",
            ""'Admin.DTM'"",
            ""'Admin.HWT'"",
            ""'Admin.International'"",
            ""'Admin.Sales'"",
            ""'Admin.Sport'"",
            ""'Admin.TCM'"",
            ""'Bestrecipes.Admin'"",
            ""'Bodyandsoul.Admin'"",
            ""'CODE'"",
            ""'CodeBet'"",
            ""'Delicious.admin'"",
            ""'Escape.Admin'"",
            ""'GQ.Admin'"",
            ""'Kidspot.Admin'"",
            ""'National Sundry'"",
            ""'National Tabloid PrePrint'"",
            ""'News.Admin'"",
            ""'odds.com.au'"",
            ""'Punters.com.au'"",
            ""'Qantas Travel Insider'"",
            ""'RACENET'"",
            ""'Shortlyster Managed Service'"",
            ""'Sky News'"",
            ""'SKYNEWS.ADMIN'"",
            ""'Stellar.Admin'"",
            ""'Stockhead'"",
            ""'SUDDENLY.CW'"",
            ""'SUDDENLY.NORTH'"",
            ""'SUDDENLY.TGG'"",
            ""'Taste.Admin'"",
            ""'TAUS.ADMIN'"",
            ""'The Sunday Times'"",
            ""'TOOWOOMBACUSTOM'"",
            ""'Vogue.Admin'"",
            ""'Vogueliving.Admin'""
          ],
          ""context"": ""List of unified_publication_name values used to classify 'Sundry Pubs'."",
          ""suggested_governance"": ""Move this list to a dedicated reference table (e.g., `dim_publication_type`) and join to it."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1""
          ],
          ""context"": ""Numeric offsets (0 for current FY, 1 for previous FY) used to determine fiscal year context."",
          ""suggested_governance"": ""Derive fiscal year context from a fiscal calendar dimension table that maps dates to fiscal years and relative offsets."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""filters"",
          ""hardcoded_values"": [
            ""'The Australian & Prestige'"",
            ""'PRINT'"",
            ""'GQ Mag'""
          ],
          ""context"": ""Specific values used to filter product_group, revenue_type, and unified_publication_name."",
          ""suggested_governance"": ""Replace with Looker Studio parameters or allow dynamic selection by users."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""'$'000' = '$'""
          ],
          ""context"": ""Conditional logic for unit conversion (thousands) that evaluates to false, effectively hardcoding the output to thousands."",
          ""suggested_governance"": ""Remove this dead code or implement a proper dynamic unit conversion mechanism."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year offsets (0, 1) with dynamic calculations based on current date and a fiscal calendar."",
      ""Replace the hardcoded list of 'Sundry Pubs' with a join to a governed reference table."",
      ""Parameterize specific filter values for product groups, revenue types, and publication names in Looker Studio.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""current_fy_gross_revenue_000s"",
      ""metric_name"": ""Current Year Gross Revenue ('000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the current fiscal year, expressed in thousands. This is a key indicator of current period sales performance."",
      ""sql_logic"": ""SUM(CASE WHEN t0.relative_fy_year_offset = 0 THEN SAFE_DIVIDE(t0.gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track and report current fiscal year advertising sales performance, often compared against targets or previous periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""The 'relative_fy_year_offset' (0) should be dynamically determined from a fiscal calendar."",
        ""The 'product_group' filter should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in 'gross_revenue_amount' could impact totals if not handled by SAFE_DIVIDE.""
      ]
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_000s"",
      ""metric_name"": ""Previous Year Gross Revenue ('000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the previous fiscal year, expressed in thousands. Used for year-over-year comparisons."",
      ""sql_logic"": ""SUM(CASE WHEN t0.relative_fy_year_offset = 1 THEN SAFE_DIVIDE(t0.gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for calculating year-over-year growth or decline, providing context for current performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""The 'relative_fy_year_offset' (1) should be dynamically determined from a fiscal calendar."",
        ""The 'product_group' filter should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in 'gross_revenue_amount' could impact totals if not handled by SAFE_DIVIDE.""
      ]
    },
    {
      ""metric_id"": ""publication_type"",
      ""metric_name"": ""Sundry/Non-Sundry Publication Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorizes publications into 'Sundry Pubs' or 'Non Sundry Pubs' based on a predefined, hardcoded list of publication names."",
      ""sql_logic"": ""CASE WHEN t0.unified_publication_name IN ('Admin.ADV', ..., 'Vogueliving.Admin') THEN 'Sundry Pubs' ELSE 'Non Sundry Pubs' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')"",
        ""revenue_type IN ('PRINT')"",
        ""unified_publication_name IN ('GQ Mag')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting and analyzing ad sales performance by specific publication categories, allowing for focused reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""static"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""List of 30+ publication names"",
        ""'Sundry Pubs'"",
        ""'Non Sundry Pubs'"",
        ""'The Australian & Prestige'"",
        ""'PRINT'"",
        ""'GQ Mag'""
      ],
      ""governance_issues"": [
        ""The extensive hardcoded list of publication names should be managed in a governed reference table for easier maintenance and consistency.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy and completeness of this classification depend entirely on the maintenance of the hardcoded list. New publications or changes to existing ones will require manual SQL updates.""
      ]
    },
    {
      ""metric_id"": ""min_data_load_timestamp"",
      ""metric_name"": ""Minimum Data Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""overall"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The earliest timestamp indicating when data was loaded into the ad sales performance table. This metric is used for data freshness monitoring."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Provides transparency on data recency, assuring users of the timeliness of the dashboard's information."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""The accuracy of this metric relies on the source system's 'dw_asl_load_timestamp' being correctly and consistently updated. If the source timestamp is stale, the freshness indicator will be misleading.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_000s"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue_000s""
      ],
      ""relationship_description"": ""Current year and previous year gross revenues are fundamentally linked for year-over-year performance analysis, typically to calculate growth percentage."",
      ""mathematical_formula"": ""((current_fy_gross_revenue_000s - previous_fy_gross_revenue_000s) / previous_fy_gross_revenue_000s) * 100"",
      ""business_validation"": ""This relationship validates the growth or decline in ad sales performance between fiscal years, a critical business insight."",
      ""validation_sql"": ""SELECT\n  SAFE_DIVIDE(\n    (SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) - \n     SUM(CASE WHEN relative_fy_year_offset = 1 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)),\n    SUM(CASE WHEN relative_fy_year_offset = 1 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)\n  ) * 100 AS yoy_growth_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE product_group IN ('The Australian & Prestige')\n  AND SAFE_CAST(dw_asl_load_timestamp AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,13
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b15d856f-e3ce-4991-bf2a-92395390524f"",
    ""dashboard_name"": ""Programmatic Rolling 60 Day Overview_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 4,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""ProductType"",
      ""TransactionType"",
      ""TransactionTypeGroup""
    ],
    ""date_range_detected"": ""Rolling 60 days (implied by dashboard name, assuming 'EventDate' column exists in source table)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""Deal"",
      ""pmp"",
      ""PG - CPM"",
      ""AG"",
      ""PMP_DEAL"",
      ""RTB"",
      ""PG - CPD"",
      ""Open Auction"",
      ""Unknown"",
      ""UFR"",
      ""Guaranteed""
    ],
    ""governance_opportunities"": [
      ""TransactionType mapping should be in a governed lookup table"",
      ""Date filtering should be parameterized""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""SELECT\n  SAFE_CAST(t0.EventDate AS DATE) AS EventDate, -- Assuming 'EventDate' column exists for time-series context\n  SAFE_CAST(t0.ProductType AS STRING) AS ProductType,\n  SAFE_CAST(t0.RevenueNet AS NUMERIC) AS RevenueNet,\n  SAFE_CAST(t0.TransactionType AS STRING) AS TransactionType,\n  CASE\n    WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed'\n    WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal'\n    WHEN (t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'RTB' OR t0.TransactionType = 'Unknown') THEN 'Open Auction'\n    ELSE SAFE_CAST(t0.TransactionType AS STRING)\n  END AS TransactionTypeGroup\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\nWHERE\n  SAFE_CAST(t0.EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY) -- Filter for rolling 60 days\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(EventDate AS DATE)) AS unique_dates, -- Assuming 'EventDate' column exists\n  COUNT(DISTINCT SAFE_CAST(ProductType AS STRING)) AS unique_product_types,\n  COUNT(DISTINCT SAFE_CAST(TransactionType AS STRING)) AS unique_transaction_types,\n  MIN(SAFE_CAST(EventDate AS DATE)) AS earliest_date,\n  MAX(SAFE_CAST(EventDate AS DATE)) AS latest_date,\n  SUM(CASE WHEN RevenueNet IS NULL THEN 1 ELSE 0 END) AS null_revenue_net_count\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nWHERE\n  SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(RevenueNet AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(ProductType AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_product_types_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(TransactionType AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_transaction_types_test,\n  CASE WHEN MAX(SAFE_CAST(EventDate AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test -- Assuming 'EventDate' column exists\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nWHERE\n  SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'transaction_type_grouping_coverage' AS rule_name,\n  COUNT(*) AS total_records_tested,\n  SUM(\n    CASE\n      WHEN (\n        CASE\n          WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n          WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n          WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction'\n          ELSE SAFE_CAST(TransactionType AS STRING)\n        END\n      ) IS NOT NULL THEN 1\n      ELSE 0\n    END\n  ) AS records_with_group,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN (\n          CASE\n            WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n            WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n            WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction'\n            ELSE SAFE_CAST(TransactionType AS STRING)\n          END\n        ) IS NOT NULL THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS coverage_percentage,\n  ARRAY_AGG(\n    DISTINCT SAFE_CAST(TransactionType AS STRING) IGNORE NULLS\n    ORDER BY SAFE_CAST(TransactionType AS STRING)\n  ) AS all_distinct_transaction_types,\n  ARRAY_AGG(\n    DISTINCT SAFE_CAST(TransactionType AS STRING) IGNORE NULLS\n    HAVING NOT (\n      TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD' OR\n      TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR' OR\n      TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown'\n    )\n    ORDER BY SAFE_CAST(TransactionType AS STRING)\n    LIMIT 10\n  ) AS sample_transaction_types_falling_into_else_clause\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nWHERE\n  SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY); -- Assuming 'EventDate' column exists"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(EventDate AS DATE) AS EventDate, -- Assuming 'EventDate' column exists\n  SAFE_CAST(ProductType AS STRING) AS ProductType,\n  SAFE_CAST(RevenueNet AS NUMERIC) AS RevenueNet,\n  SAFE_CAST(TransactionType AS STRING) AS TransactionType,\n  CASE\n    WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n    WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n    WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction'\n    ELSE SAFE_CAST(TransactionType AS STRING)\n  END AS TransactionTypeGroup\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nWHERE\n  SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Assuming 'EventDate' column exists\n  AND RevenueNet IS NOT NULL\nORDER BY\n  SAFE_CAST(EventDate AS DATE) DESC,\n  SAFE_CAST(RevenueNet AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Deal'"",
            ""'pmp'"",
            ""'PG - CPM'"",
            ""'AG'"",
            ""'PMP_DEAL'"",
            ""'RTB'"",
            ""'PG - CPD'"",
            ""'Open Auction'"",
            ""'Unknown'"",
            ""'UFR'""
          ],
          ""context"": ""TransactionType values hardcoded in CASE statement for grouping"",
          ""suggested_governance"": ""join to a `transaction_type_lookup` table with 'TransactionType' and 'TransactionTypeGroup' columns"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (implied 60-day window) with date parameters or relative date functions in Looker Studio's data source configuration."",
      ""Replace hardcoded lookup values for 'TransactionTypeGroup' with joins to a governed reference table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""product_type_dimension"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of products as defined in the source data."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by different product offerings."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_net_base"",
      ""metric_name"": ""Revenue Net (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The base net revenue amount for each transaction."",
      ""sql_logic"": ""t0.RevenueNet"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The fundamental financial metric from which all revenue aggregations are derived."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""outliers expected""
      ]
    },
    {
      ""metric_id"": ""total_revenue_by_product_type"",
      ""metric_name"": ""Total Revenue by Product Type"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_net_base"",
        ""product_type_dimension""
      ],
      ""business_description"": ""The sum of net revenue grouped by product type. This metric helps understand revenue contribution from different product categories."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [
        ""rolling 60-day window (implied)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for product-level revenue analysis, showing which product types are generating the most revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type_dimension"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The original transaction type as recorded in the source system."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides granular detail on the nature of each programmatic transaction, used for further grouping."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type_group_dimension"",
      ""metric_name"": ""Transaction Type Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""transaction_type_dimension""
      ],
      ""business_description"": ""A categorized grouping of transaction types into 'Guaranteed', 'Deal', 'Open Auction', or the original type if none of the explicit conditions match. This simplifies analysis of programmatic revenue streams."",
      ""sql_logic"": ""CASE WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal' WHEN (t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'RTB' OR t0.TransactionType = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(t0.TransactionType AS STRING) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for high-level analysis of programmatic revenue by deal type, simplifying complex transaction types into actionable categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PG - CPD'"",
        ""'pmp'"",
        ""'PMP_DEAL'"",
        ""'UFR'"",
        ""'RTB'"",
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_revenue_by_transaction_type_group"",
      ""metric_name"": ""Total Revenue by Transaction Type Group"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_net_base"",
        ""transaction_type_group_dimension""
      ],
      ""business_description"": ""The sum of net revenue grouped by the categorized transaction type. This metric provides insight into revenue performance across different programmatic deal types (e.g., Guaranteed, Deal, Open Auction)."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY (CASE WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal' WHEN (t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'RTB' OR t0.TransactionType = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(t0.TransactionType AS STRING) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [
        ""rolling 60-day window (implied)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical for understanding the mix of programmatic revenue, allowing stakeholders to assess the performance of different deal structures."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PG - CPD'"",
        ""'pmp'"",
        ""'PMP_DEAL'"",
        ""'UFR'"",
        ""'RTB'"",
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_revenue_by_product_type"",
      ""related_metrics"": [
        ""revenue_net_base"",
        ""product_type_dimension""
      ],
      ""relationship_description"": ""Total Revenue by Product Type is an aggregation (sum) of Revenue Net, grouped by Product Type."",
      ""mathematical_formula"": ""SUM(RevenueNet) GROUP BY ProductType"",
      ""business_validation"": ""Ensures that revenue is correctly attributed to product categories."",
      ""validation_sql"": ""SELECT ProductType, SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY) GROUP BY ProductType LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_revenue_by_transaction_type_group"",
      ""related_metrics"": [
        ""revenue_net_base"",
        ""transaction_type_group_dimension""
      ],
      ""relationship_description"": ""Total Revenue by Transaction Type Group is an aggregation (sum) of Revenue Net, grouped by the derived Transaction Type Group."",
      ""mathematical_formula"": ""SUM(RevenueNet) GROUP BY TransactionTypeGroup"",
      ""business_validation"": ""Ensures that revenue is correctly categorized by programmatic deal type."",
      ""validation_sql"": ""SELECT CASE WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal' WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(TransactionType AS STRING) END AS TransactionTypeGroup, SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY) GROUP BY TransactionTypeGroup LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_revenue_by_product_type"",
      ""related_metrics"": [
        ""total_revenue_by_transaction_type_group""
      ],
      ""relationship_description"": ""Both revenue metrics are implicitly filtered by a rolling 60-day window, meaning they represent revenue generated within the last 60 days. This common filter ensures consistency in the time period analyzed."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that all reported revenue figures pertain to the same recent period, allowing for comparable analysis."",
      ""validation_sql"": ""SELECT MIN(SAFE_CAST(EventDate AS DATE)), MAX(SAFE_CAST(EventDate AS DATE)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` WHERE SAFE_CAST(EventDate AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,14
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""80ca81f3-0671-40ef-a0a9-825a1580ca1b"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 2,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""date"",
      ""advertiser_name"",
      ""portfolio_conformed_name_sync"",
      ""sales_segment_l_2_name_sync""
    ],
    ""date_range_detected"": ""None"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'GAD RAM A1'"",
      ""'HBT RAM A1'"",
      ""'VIC DIRECT A7'"",
      ""'VIC DIRECT A8'"",
      ""'VIC DIRECT A9'""
    ],
    ""governance_opportunities"": [
      ""portfolio names should be parameterised or use a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    SAFE_CAST(t0.date_column AS DATE) AS report_date, -- Assuming a date column exists\n    t0.advertiser_name,\n    t0.portfolio_conformed_name_sync,\n    t0.sales_segment_l_2_name_sync,\n    SAFE_CAST(t0.total_sales_amount AS NUMERIC) AS total_sales_amount, -- Inferred metric\n    SAFE_CAST(t0.total_impressions AS NUMERIC) AS total_impressions -- Inferred metric\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Example date filter\n)\nSELECT\n  report_date,\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync,\n  COUNT(*) AS record_count,\n  SUM(total_sales_amount) AS sum_total_sales_amount,\n  SUM(total_impressions) AS sum_total_impressions,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers\nFROM base_data\nWHERE portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9') -- Applying the hardcoded filter from one query\nGROUP BY\n  report_date,\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync\nORDER BY\n  report_date DESC, sum_total_sales_amount DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.date_column AS DATE)) AS unique_dates, -- Assuming a date column exists\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT t0.portfolio_conformed_name_sync) AS unique_portfolios,\n  COUNT(DISTINCT t0.sales_segment_l_2_name_sync) AS unique_sales_segments,\n  MIN(SAFE_CAST(t0.date_column AS DATE)) AS earliest_date, -- Assuming a date column exists\n  MAX(SAFE_CAST(t0.date_column AS DATE)) AS latest_date -- Assuming a date column exists\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY); -- Analyze last year of data"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.total_sales_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS sales_amount_test, -- Inferred metric\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_test,\n  CASE WHEN MAX(SAFE_CAST(t0.date_column AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test, -- Assuming a date column exists\n  CASE WHEN COUNT(CASE WHEN t0.portfolio_conformed_name_sync IS NULL THEN 1 END) = 0 THEN 'PASS' ELSE 'FAIL' END AS portfolio_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Hardcoded Portfolio Values Coverage' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN t0.portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9') THEN 1 ELSE 0 END) AS records_matching_hardcoded_list,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS match_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.date_column AS DATE) AS date_column, -- Assuming a date column exists\n  t0.advertiser_name,\n  t0.portfolio_conformed_name_sync,\n  t0.sales_segment_l_2_name_sync,\n  SAFE_CAST(t0.total_sales_amount AS NUMERIC) AS total_sales_amount, -- Inferred metric\n  SAFE_CAST(t0.total_impressions AS NUMERIC) AS total_impressions -- Inferred metric\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Sample recent data\n  AND t0.advertiser_name IS NOT NULL\nORDER BY SAFE_CAST(t0.date_column AS DATE) DESC, SAFE_CAST(t0.total_sales_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'GAD RAM A1'"",
            ""'HBT RAM A1'"",
            ""'VIC DIRECT A7'"",
            ""'VIC DIRECT A8'"",
            ""'VIC DIRECT A9'""
          ],
          ""context"": ""portfolio_conformed_name_sync values hardcoded in WHERE clause for filtering `advertiser_name`."",
          ""suggested_governance"": ""These values should be managed in a governed reference table (e.g., `portfolio_lookup`) and joined, or passed as parameters from the dashboard."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded portfolio names with a dynamic parameter or a join to a `portfolio_lookup` table."",
      ""Introduce date parameters for dashboard date range selection instead of relying on implicit or fixed date filters.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the ad sales performance record."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping sales performance data by specific advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The conformed name of the portfolio to which the ad sales record belongs. Used for filtering."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting sales performance by specific portfolio groups."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'GAD RAM A1'"",
        ""'HBT RAM A1'"",
        ""'VIC DIRECT A7'"",
        ""'VIC DIRECT A8'"",
        ""'VIC DIRECT A9'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table or be parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment Level 2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the sales segment at level 2 for the ad sales record."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing sales performance by sales team or segment."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_sales_amount"",
      ""metric_name"": ""Total Sales Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total monetary value of sales generated for a given period or dimension. (Inferred from dashboard name)"",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.total_sales_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary KPI for measuring sales team performance and revenue generation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls if sales amount is not always recorded""
      ]
    },
    {
      ""metric_id"": ""total_impressions"",
      ""metric_name"": ""Total Ad Impressions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of times an ad was displayed. (Inferred from dashboard name and 'adsales')"",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.total_impressions AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key metric for understanding ad delivery volume and reach."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls if impressions are not always recorded""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_name"",
      ""related_metrics"": [
        ""portfolio_conformed_name_sync"",
        ""total_sales_amount"",
        ""total_impressions""
      ],
      ""relationship_description"": ""The `advertiser_name` dimension is filtered by specific `portfolio_conformed_name_sync` values. This filter directly impacts the set of advertisers and consequently the aggregated sales amounts and impressions shown."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that sales performance is analyzed only for advertisers belonging to specific, predefined portfolios."",
      ""validation_sql"": ""SELECT\n  t0.advertiser_name,\n  t0.portfolio_conformed_name_sync,\n  SUM(SAFE_CAST(t0.total_sales_amount AS NUMERIC)) AS total_sales\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE t0.portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9')\nGROUP BY t0.advertiser_name, t0.portfolio_conformed_name_sync\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,15
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c560ed20-040d-4c6a-9c3f-ec8bce27d132"",
    ""dashboard_name"": ""Xtend Details"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 14,
    ""date_grain"": ""monthly|yearly|financial_yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""calendar_year"",
      ""calendar_month"",
      ""publication_name"",
      ""source_publishing_division"",
      ""revenue_transaction_status"",
      ""revenue_group_subtype"",
      ""advertiser_name"",
      ""advertiser_group"",
      ""booking_number"",
      ""revenue_type"",
      ""source_unified_publication_name""
    ],
    ""date_range_detected"": ""Financial Year '202' (ambiguous), Calendar Years 2022 (excluded), 2024, 2025"",
    ""hardcoded_dates_found"": [
      ""202"",
      ""2022"",
      ""2024"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'Medium Rare Content Agency'"",
      ""'Billed'"",
      ""'Booked'"",
      ""'Digital'"",
      ""'Print'"",
      ""'INTERNAL PUIG Oceania'"",
      ""'PUIG Oceania'"",
      ""'Greyhound Racing Victoria'""
    ],
    ""governance_opportunities"": [
      ""Financial year codes should be mapped to full dates or a dedicated dimension table."",
      ""Specific calendar years should be replaced with relative date parameters (e.g., CURRENT_YEAR(), LAST_YEAR())."",
      ""Advertiser names, revenue group subtypes, transaction statuses, and publishing divisions should be managed via governed lookup tables or dashboard parameters.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates key metrics and dimensions from the dashboard's underlying data.\n-- It applies common filters and aggregates the primary revenue metric.\n-- Date filters are set to analyze recent data for performance and relevance.\nSELECT\n  SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n  SAFE_CAST(t0.calendar_year AS INT64) AS calendar_year,\n  SAFE_CAST(t0.calendar_month AS INT64) AS calendar_month,\n  t0.publication_name AS publication_name,\n  t0.source_publishing_division AS source_publishing_division,\n  t0.revenue_transaction_status AS revenue_transaction_status,\n  t0.revenue_group_subtype AS revenue_group_subtype,\n  t0.advertiser_name AS advertiser_name,\n  t0.advertiser_group AS advertiser_group,\n  t0.revenue_type AS revenue_type,\n  SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS total_gross_revenue,\n  COUNT(DISTINCT t0.booking_number) AS distinct_bookings,\n  COUNT(DISTINCT t0.advertiser_name) AS distinct_advertisers\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  t0.financial_year IS NOT NULL\n  AND t0.source_publishing_division != 'Medium Rare Content Agency'\n  AND t0.revenue_transaction_status IN ('Billed', 'Booked')\n  AND t0.revenue_group_subtype IN ('Digital', 'Print')\n  -- Example date filter for recent data, adjust as needed\n  AND SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nGROUP BY\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10\nORDER BY\n  calendar_year DESC, calendar_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- This query helps understand the data structure, grain, and key dimensions.\n-- It provides counts, unique values, and date ranges for critical columns.\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS STRING)) AS unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.calendar_year AS INT64)) AS unique_calendar_years,\n  COUNT(DISTINCT t0.publication_name) AS unique_publication_names,\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertiser_names,\n  COUNT(DISTINCT t0.revenue_transaction_status) AS unique_transaction_statuses,\n  COUNT(DISTINCT t0.revenue_group_subtype) AS unique_revenue_subtypes,\n  MIN(SAFE_CAST(t0.calendar_year AS INT64)) AS earliest_calendar_year,\n  MAX(SAFE_CAST(t0.calendar_year AS INT64)) AS latest_calendar_year,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_count\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3\nLIMIT 1;"",
    ""validation_sql"": ""-- This query performs quick validation checks on data quality and freshness.\n-- It verifies if key metrics are present and if data is recent.\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_count_test,\n  CASE WHEN MAX(SAFE_CAST(t0.calendar_year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END AS freshness_year_test,\n  CASE WHEN COUNT(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS transaction_status_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This query validates specific business rules identified from the dashboard queries.\n-- It checks the adherence to exclusion and inclusion criteria for key dimensions.\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Medium Rare Content Agency Exclusion' AS rule_name,\n  COUNT(*) AS total_records_checked,\n  SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) AS records_passing_exclusion,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS exclusion_pass_rate_percent,\n  'Billed/Booked Status Inclusion' AS rule_name_2,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END) AS records_passing_status_inclusion,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS status_inclusion_pass_rate_percent\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""sample_data_sql"": ""-- This query retrieves a representative sample of raw data for further analysis.\n-- It includes key dimensions and metrics, with appropriate type casting.\nSELECT\n  t0.advertiser_group,\n  t0.advertiser_name,\n  t0.booking_number,\n  SAFE_CAST(t0.calendar_month AS INT64) AS calendar_month,\n  SAFE_CAST(t0.calendar_year AS INT64) AS calendar_year,\n  SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  t0.revenue_group_subtype,\n  t0.revenue_transaction_status,\n  t0.revenue_type,\n  t0.source_publishing_division,\n  t0.source_unified_publication_name,\n  t0.publication_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(t0.calendar_year AS INT64) DESC, SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""202"",
          ""original_format"": ""string"",
          ""context"": ""financial_year filter in query 1"",
          ""suggested_fix"": ""Map to a standard date range or use a parameter for financial year selection."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2022"",
          ""original_format"": ""string"",
          ""context"": ""calendar_year exclusion in query 2"",
          ""suggested_fix"": ""Replace with relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) - 2`) or a parameter."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2024"",
          ""original_format"": ""string"",
          ""context"": ""calendar_year inclusion in query 3"",
          ""suggested_fix"": ""Replace with relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`) or a parameter."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""string"",
          ""context"": ""calendar_year inclusion in query 3"",
          ""suggested_fix"": ""Replace with relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) + 1`) or a parameter."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Exclusion filter for source_publishing_division across all queries."",
          ""suggested_governance"": ""Manage excluded divisions in a configuration table or parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Billed'"",
            ""'Booked'""
          ],
          ""context"": ""Inclusion filter for revenue_transaction_status across all queries."",
          ""suggested_governance"": ""Use a lookup table for transaction statuses or a parameter for selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Digital'"",
            ""'Print'""
          ],
          ""context"": ""Inclusion filter for revenue_group_subtype in queries 2 and 3."",
          ""suggested_governance"": ""Use a lookup table for revenue group subtypes or a parameter for selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'INTERNAL PUIG Oceania'"",
            ""'PUIG Oceania'"",
            ""'Greyhound Racing Victoria'""
          ],
          ""context"": ""Specific advertiser_name inclusions in queries 2 and 3."",
          ""suggested_governance"": ""Manage advertiser lists in a reference table or use dashboard parameters for selection."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial and calendar years with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Introduce parameters for `source_publishing_division` exclusions, `revenue_transaction_status` inclusions, `revenue_group_subtype` inclusions, and specific `advertiser_name` selections."",
      ""Utilize governed reference tables for categorical values (e.g., transaction statuses, revenue subtypes, publishing divisions, advertiser names) to ensure consistency and ease of maintenance.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the publication associated with the advertising revenue transaction."",
      ""sql_logic"": ""t0.publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""financial_year IN ('202')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'202'""
      ],
      ""governance_issues"": [
        ""Hardcoded financial year '202' and status values should be parameterized or use reference tables.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the revenue transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IS NOT NULL"",
        ""IN ('202')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for financial reporting and trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""202""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded financial year '202' is ambiguous and should be parameterized or mapped to a date range.""
      ],
      ""data_quality_concerns"": [
        ""Potential for inconsistent formatting or meaning of financial year codes.""
      ]
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The current status of the revenue transaction (e.g., Billed, Booked)."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for filtering revenue to only include confirmed or expected amounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""Hardcoded status values should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue transaction originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""!= 'Medium Rare Content Agency'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to exclude specific divisions from revenue reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion value should be managed via a configuration table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser for the revenue transaction."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('INTERNAL PUIG Oceania', 'PUIG Oceania')"",
        ""IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for advertiser-specific revenue analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INTERNAL PUIG Oceania'"",
        ""'PUIG Oceania'"",
        ""'Greyhound Racing Victoria'""
      ],
      ""governance_issues"": [
        ""Hardcoded advertiser names should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_month"",
      ""metric_name"": ""Calendar Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar month of the revenue transaction."",
      ""sql_logic"": ""t0.calendar_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for monthly trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_year"",
      ""metric_name"": ""Calendar Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar year of the revenue transaction."",
      ""sql_logic"": ""t0.calendar_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""NOT IN ('2022') OR IS NULL"",
        ""IN ('2024', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for yearly trend analysis and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2022"",
        ""2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded calendar years should be parameterized or use relative date functions.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The subtype of revenue group (e.g., Digital, Print)."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Digital', 'Print')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by digital vs. print channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital'"",
        ""'Print'""
      ],
      ""governance_issues"": [
        ""Hardcoded subtype values should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""numeric_calendar_month"",
      ""metric_name"": ""Numeric Calendar Month"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""safe_cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""calendar_month""
      ],
      ""business_description"": ""Calendar month converted to a numeric type (FLOAT64), likely for numerical sorting or specific calculations."",
      ""sql_logic"": ""SAFE_CAST(t0.calendar_month AS FLOAT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""float"",
      ""business_context"": ""Used as a numerical dimension for grouping or ordering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Casting month to FLOAT64 is unusual; consider casting to INT64 if only numerical representation is needed.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group to which the advertiser belongs."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level advertiser segmentation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_number"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an advertising booking."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for granular transaction identification."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue amounts for advertising transactions, filtered by specific criteria."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Primary financial metric for advertising performance, showing total revenue generated."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Digital'"",
        ""'Print'"",
        ""'Greyhound Racing Victoria'""
      ],
      ""governance_issues"": [
        ""Hardcoded years and filter values should be parameterized or use reference tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls in gross_revenue_amount if not handled by SAFE_CAST or explicit NULL checks.""
      ]
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific type of revenue (e.g., display, classified)."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue by its nature."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_unified_publication_name"",
      ""metric_name"": ""Source Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A unified name for the source publication, potentially consolidating different naming conventions."",
      ""sql_logic"": ""t0.source_unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a standardized view of publication names for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""revenue_group_subtype"",
        ""calendar_year"",
        ""advertiser_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""Total Gross Revenue is consistently filtered by transaction status ('Billed', 'Booked'), excluding 'Medium Rare Content Agency' division, and often restricted to specific revenue subtypes (Digital, Print), calendar years, or advertiser names. Financial year is also a common filter."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE status IN ('Billed', 'Booked') AND division != 'Medium Rare Content Agency' AND ..."",
      ""business_validation"": ""Ensures that revenue figures reflect only confirmed/expected transactions from relevant divisions and specific business segments/periods."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Billed', 'Booked') AND source_publishing_division != 'Medium Rare Content Agency' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""advertiser_group"",
      ""related_metrics"": [
        ""advertiser_name""
      ],
      ""relationship_description"": ""Advertiser Name is a more granular dimension that rolls up into Advertiser Group."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows for analysis at both a detailed advertiser level and a summarized group level."",
      ""validation_sql"": ""SELECT advertiser_group, COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` GROUP BY advertiser_group LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""calendar_year"",
      ""related_metrics"": [
        ""calendar_month"",
        ""numeric_calendar_month""
      ],
      ""relationship_description"": ""Calendar Month and Numeric Calendar Month are components of Calendar Year, providing finer granularity for date-based analysis."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Enables drilling down from annual to monthly trends."",
      ""validation_sql"": ""SELECT SAFE_CAST(calendar_year AS INT64), SAFE_CAST(calendar_month AS INT64), COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` GROUP BY 1,2 ORDER BY 1 DESC, 2 DESC LIMIT 12;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,16
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""fed70b12-c274-4cde-9920-592ca4c4dab0"",
    ""dashboard_name"": ""Independent Agency Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_dcp.ia;ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""mixed"",
    ""key_dimensions"": [
      ""agency_parent"",
      ""account_number"",
      ""revenue_group_subtype"",
      ""booking_line_created_date"",
      ""movement_date"",
      ""financial_month"",
      ""financial_quarter"",
      ""financial_year"",
      ""relative_fy_year_offset"",
      ""relative_fy_month_offset"",
      ""movement_financial_week""
    ],
    ""date_range_detected"": ""Relative to hardcoded future dates (2025-05-23, 2025-06-22) for previous year calculations. Implies a current date reference."",
    ""hardcoded_dates_found"": [
      ""2025-05-23"",
      ""2025-06-22""
    ],
    ""hardcoded_values_found"": [
      ""'FY'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""'Current Week'"",
      ""-365"",
      ""-12"",
      ""-1"",
      ""0"",
      ""6""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use CURRENT_DATE() for dynamic reporting."",
      ""The 'FY' condition (always true) should be removed or replaced with a true parameter."",
      ""Revenue group subtypes like 'PROGRAMMATIC EXCHANGE' should be managed in a reference table."",
      ""Month and quarter mappings could be externalized for easier maintenance if fiscal year logic changes.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates key revenue metrics from the 'ia' table, which is used in two of the provided queries.\n-- It calculates Current Fiscal Year Revenue, Previous Fiscal Year Revenue, and a conditional revenue metric.\n-- It groups by agency parent, financial quarter, adjusted financial month, and financial year.\n-- Note: The 'revenue_movement' table is distinct and not easily joinable with 'ia' without further business context.\n\nWITH base_ia_data AS (\n  SELECT\n    t0.agency_parent,\n    SAFE_CAST(t0.booking_line_created_date AS TIMESTAMP) AS booking_line_created_timestamp,\n    SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n    SAFE_CAST(t0.relative_fy_month_offset AS INT64) AS relative_fy_month_offset,\n    SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n    SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n    SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n    SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n    t0.revenue_group_subtype\n  FROM `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\n  WHERE (t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL)\n),\n\ncalculated_metrics AS (\n  SELECT\n    agency_parent,\n    financial_quarter,\n    financial_year,\n    -- Adjusted Financial Month (from Query 2 logic)\n    CASE WHEN financial_month > 6 THEN financial_month - 6 ELSE financial_month + 6 END AS adjusted_financial_month,\n    \n    -- Current Fiscal Year Revenue\n    CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue,\n    \n    -- Previous Fiscal Year Revenue\n    CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END AS previous_fy_gross_revenue,\n    \n    -- Conditional Revenue (based on Query 1 & 2 logic)\n    -- This logic is complex and relies on a hardcoded future date for comparison.\n    -- For this consolidated query, we'll simplify the conditional revenue to focus on the FY month offset.\n    -- The original logic: (clmn11_ < -12) THEN clmn17_ ELSE clmn20_ (Query 1)\n    -- clmn17_ is Previous FY Revenue\n    -- clmn20_ is Gross Revenue if relative_fy_year_offset is -1 AND Booking Line Created Date <= Previous Year Date Reference\n    -- The hardcoded date reference makes this metric less generalizable without parameterization.\n    -- We will use a simplified version for demonstration, focusing on the relative_fy_month_offset condition.\n    CASE\n      WHEN relative_fy_month_offset < -12 THEN (CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)\n      ELSE (CASE WHEN relative_fy_year_offset = -1 AND SAFE_CAST(booking_line_created_timestamp AS DATE) <= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) THEN gross_revenue_amount ELSE 0 END)\n    END AS conditional_revenue_metric\n\n  FROM base_ia_data\n)\n\nSELECT\n  agency_parent,\n  financial_quarter,\n  adjusted_financial_month,\n  financial_year,\n  SUM(current_fy_gross_revenue) AS total_current_fy_gross_revenue,\n  SUM(previous_fy_gross_revenue) AS total_previous_fy_gross_revenue,\n  SUM(conditional_revenue_metric) AS total_conditional_revenue_metric,\n  COUNT(*) AS record_count\nFROM calculated_metrics\nGROUP BY\n  agency_parent,\n  financial_quarter,\n  adjusted_financial_month,\n  financial_year\nORDER BY\n  total_current_fy_gross_revenue DESC\nLIMIT 100;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling for both primary tables.\nSELECT\n  'sbx_dcp.ia' AS source_table,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.agency_parent) AS unique_agency_parents,\n  COUNT(DISTINCT SAFE_CAST(t0.booking_line_created_date AS DATE)) AS unique_booking_dates,\n  MIN(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS latest_booking_date,\n  AVG(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS avg_gross_revenue_amount\nFROM `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\n\nUNION ALL\n\nSELECT\n  'asl_finance_derived.revenue_movement' AS source_table,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.account_number) AS unique_account_numbers,\n  COUNT(DISTINCT SAFE_CAST(t0.movement_date AS DATE)) AS unique_movement_dates,\n  MIN(SAFE_CAST(t0.movement_date AS DATE)) AS earliest_movement_date,\n  MAX(SAFE_CAST(t0.movement_date AS DATE)) AS latest_movement_date,\n  AVG(SAFE_CAST(t0.GROSS_AMOUNT_DIFF AS NUMERIC)) AS avg_gross_amount_diff\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\nWHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and return non-zero values for recent data.\nSELECT\n  'Validation Check - sbx_dcp.ia' AS test_type,\n  CASE WHEN SUM(CASE WHEN t0.relative_fy_year_offset = 0 THEN SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS current_fy_revenue_test,\n  CASE WHEN SUM(CASE WHEN t0.relative_fy_year_offset = -1 THEN SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS previous_fy_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.agency_parent) > 0 THEN 'PASS' ELSE 'FAIL' END AS agency_parent_test,\n  CASE WHEN MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test\nFROM `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n\nUNION ALL\n\nSELECT\n  'Validation Check - revenue_movement' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.GROSS_AMOUNT_DIFF AS NUMERIC)) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS gross_amount_diff_test,\n  CASE WHEN COUNT(DISTINCT t0.account_number) > 0 THEN 'PASS' ELSE 'FAIL' END AS account_number_test,\n  CASE WHEN MAX(SAFE_CAST(t0.movement_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  'N/A' AS dummy_column -- To match column count for UNION ALL\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\nWHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality.\nSELECT\n  'Business Rule Validation - Revenue Group Subtype Exclusion' AS validation_type,\n  'PROGRAMMATIC EXCHANGE exclusion' AS rule_name,\n  COUNT(*) AS total_records_scanned,\n  SUM(CASE WHEN t0.revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END) AS records_matching_excluded_type,\n  SUM(CASE WHEN t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL THEN 1 ELSE 0 END) AS records_passing_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n\nUNION ALL\n\nSELECT\n  'Business Rule Validation - Revenue Movement Min Week Exclusion' AS validation_type,\n  'Movement Financial Week != Min Week' AS rule_name,\n  COUNT(*) AS total_records_scanned,\n  SUM(CASE WHEN SAFE_CAST(t0.movement_financial_week AS INT64) = SAFE_CAST(t0.min_week AS INT64) THEN 1 ELSE 0 END) AS records_matching_excluded_condition,\n  SUM(CASE WHEN SAFE_CAST(t0.movement_financial_week AS INT64) != SAFE_CAST(t0.min_week AS INT64) THEN 1 ELSE 0 END) AS records_passing_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(t0.movement_financial_week AS INT64) != SAFE_CAST(t0.min_week AS INT64) THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\nWHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis from both primary tables.\nSELECT\n  'sbx_dcp.ia' AS source_table,\n  SAFE_CAST(t0.booking_line_created_date AS DATE) AS primary_date,\n  t0.agency_parent,\n  NULL AS account_number,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS primary_metric,\n  t0.revenue_group_subtype,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n  SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n  SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n  SAFE_CAST(t0.financial_year AS INT64) AS financial_year\nFROM `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nORDER BY SAFE_CAST(t0.booking_line_created_date AS DATE) DESC, SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 250\n\nUNION ALL\n\nSELECT\n  'asl_finance_derived.revenue_movement' AS source_table,\n  SAFE_CAST(t0.movement_date AS DATE) AS primary_date,\n  t0.agency_parent,\n  t0.account_number,\n  SAFE_CAST(t0.GROSS_AMOUNT_DIFF AS NUMERIC) AS primary_metric,\n  NULL AS revenue_group_subtype,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n  SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n  SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n  SAFE_CAST(t0.financial_year AS INT64) AS financial_year\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\nWHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nORDER BY SAFE_CAST(t0.movement_date AS DATE) DESC, SAFE_CAST(t0.GROSS_AMOUNT_DIFF AS NUMERIC) DESC\nLIMIT 250;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-23"",
          ""original_format"": ""DATE(TIMESTAMP '2025-05-23 01:19:32.916346+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed 'current date' reference point for calculating previous year dates (e.g., -365 days)."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter to make the report dynamic and current."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-22"",
          ""original_format"": ""DATE(TIMESTAMP '2025-06-22 22:46:58.786738+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed 'current date' reference point for calculating previous year dates (e.g., -365 days)."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter to make the report dynamic and current."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'PROGRAMMATIC EXCHANGE'""
          ],
          ""context"": ""Used in WHERE clause to exclude a specific revenue group subtype."",
          ""suggested_governance"": ""Manage excluded revenue subtypes in a configuration table or a governed list that can be joined or referenced."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Mapping calendar month short names to month numbers."",
          ""suggested_governance"": ""While common, if month names or mappings change, this requires code modification. A date dimension table would contain this mapping."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Q1'"",
            ""'Q2'"",
            ""'Q3'"",
            ""'Q4'""
          ],
          ""context"": ""Mapping financial months to financial quarters."",
          ""suggested_governance"": ""Similar to month names, if fiscal quarter definitions change, this requires code modification. A fiscal calendar dimension table would be ideal."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY'""
          ],
          ""context"": ""Used in `CASE WHEN ('FY' = 'FY') THEN ... ELSE ... END` which is always true. This indicates a redundant condition or a placeholder for a parameter that was never implemented."",
          ""suggested_governance"": ""Remove the redundant `CASE WHEN` or replace with a dashboard parameter (e.g., `fiscal_year_flag`) if the intention was to switch between fiscal and calendar logic."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-05-23') with `CURRENT_DATE()` or Looker Studio date parameters to ensure dynamic reporting."",
      ""Consider externalizing business rules like 'PROGRAMMATIC EXCHANGE' exclusion into a configuration table or a governed list."",
      ""If the 'FY' vs 'Calendar Year' logic is ever intended to be dynamic, implement a dashboard parameter to control it instead of the hardcoded 'FY' = 'FY' condition.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for a booking line."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric used for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current Fiscal Year Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue for the current fiscal year (where relative_fy_year_offset is 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous Fiscal Year Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue for the previous fiscal year (where relative_fy_year_offset is -1)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparison and trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""conditional_revenue_metric"",
      ""metric_name"": ""Conditional Revenue Metric"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_month_offset"",
        ""relative_fy_year_offset"",
        ""booking_line_created_date"",
        ""previous_year_date_reference""
      ],
      ""business_description"": ""A complex conditional revenue calculation. In Query 1, it's 'If relative_fy_month_offset < -12, then Previous FY Revenue, else (Gross Revenue if relative_fy_year_offset is -1 AND Booking Line Created Date <= Previous Year Date Reference)'. In Query 2, it's similar. The exact business meaning is unclear without further context."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_month_offset < -12 THEN (CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) ELSE (CASE WHEN relative_fy_year_offset = -1 AND SAFE_CAST(booking_line_created_date AS DATE) <= DATE_SUB(SAFE_CAST(hardcoded_date_reference AS DATE), INTERVAL 365 DAY) THEN gross_revenue_amount ELSE 0 END) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely a specific comparison or adjustment for revenue based on fiscal month and year offsets, potentially for a specific reporting period or anomaly detection."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-23"",
        ""2025-06-22""
      ],
      ""hardcoded_values_in_metric"": [
        ""-12"",
        ""-1"",
        ""-365""
      ],
      ""governance_issues"": [
        ""Hardcoded future dates make this metric non-dynamic and potentially misleading over time."",
        ""The complex conditional logic should be clearly documented or simplified if possible.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on hardcoded dates could lead to stale or incorrect comparisons.""
      ]
    },
    {
      ""metric_id"": ""gross_amount_difference"",
      ""metric_name"": ""Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the gross amount difference, likely representing a movement or change in financial figures."",
      ""sql_logic"": ""SUM(t0.GROSS_AMOUNT_DIFF)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_financial_week != min_week""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track financial movements or adjustments, potentially for reconciliation or variance analysis."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""agency_parent"",
      ""metric_name"": ""Agency Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent agency associated with the booking or financial movement."",
      ""sql_logic"": ""t0.agency_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary grouping dimension for agency-level reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjusted_financial_month"",
      ""metric_name"": ""Adjusted Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_month""
      ],
      ""business_description"": ""Financial month adjusted by 6 (either +6 or -6) based on whether the financial month is greater than 6. This creates a cyclical month number, possibly for a specific fiscal year alignment."",
      ""sql_logic"": ""CASE WHEN financial_month > 6 THEN financial_month - 6 ELSE financial_month + 6 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping revenue by a custom financial month definition."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""6""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter of the year."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Standard financial period dimension for quarterly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Standard financial period dimension for yearly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""week_label"",
      ""metric_name"": ""Week Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional_string"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""movement_financial_week"",
        ""max_week""
      ],
      ""business_description"": ""A label for the financial week, either 'Current Week' if it matches the max week, or ' Week ' concatenated with the movement financial week number."",
      ""sql_logic"": ""CASE WHEN movement_financial_week = max_week THEN 'Current Week' ELSE CONCAT(' Week ',SAFE_CAST(movement_financial_week AS STRING)) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a user-friendly label for financial weeks, highlighting the 'Current Week'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Current Week'"",
        ""' Week '""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current Fiscal Year Gross Revenue is a subset of Gross Revenue Amount, filtered by the relative fiscal year offset being 0."",
      ""mathematical_formula"": ""Current FY Gross Revenue = SUM(Gross Revenue Amount WHERE relative_fy_year_offset = 0)"",
      ""business_validation"": ""Ensures that only revenue pertaining to the current fiscal period is aggregated."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""previous_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Previous Fiscal Year Gross Revenue is a subset of Gross Revenue Amount, filtered by the relative fiscal year offset being -1."",
      ""mathematical_formula"": ""Previous FY Gross Revenue = SUM(Gross Revenue Amount WHERE relative_fy_year_offset = -1)"",
      ""business_validation"": ""Enables accurate year-over-year comparisons for revenue performance."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = -1 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) AND SAFE_CAST(booking_line_created_date AS DATE) < DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""All revenue metrics derived from `sbx_dcp.ia` exclude 'PROGRAMMATIC EXCHANGE' revenue group subtype."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that programmatic exchange revenue is not included in the reported figures, aligning with specific business reporting needs."",
      ""validation_sql"": ""SELECT COUNT(*) AS total_records, SUM(CASE WHEN revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END) AS programmatic_records FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_amount_difference"",
      ""related_metrics"": [
        ""movement_financial_week"",
        ""min_week""
      ],
      ""relationship_description"": ""Gross Amount Difference excludes records where `movement_financial_week` is equal to `min_week`."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""This filter likely excludes initial or baseline week data from the movement calculation, focusing on changes after a certain point."",
      ""validation_sql"": ""SELECT COUNT(*) AS total_records, SUM(CASE WHEN SAFE_CAST(movement_financial_week AS INT64) = SAFE_CAST(min_week AS INT64) THEN 1 ELSE 0 END) AS min_week_records FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,17
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6e8b534b-485a-48dd-842d-13dc6bebb01a"",
    ""dashboard_name"": ""SuperCoach Subscriptions"",
    ""primary_data_sources"": ""prstn_consumer_views.v_subscription_movement"",
    ""business_domain"": ""consumer"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_datetime"",
      ""masthead"",
      ""subscription_id_src"",
      ""subscriber_id_src"",
      ""sold_in_rate_plan_code"",
      ""sold_in_source_code""
    ],
    ""date_range_detected"": ""2024-07-01 to 2024-08-19"",
    ""hardcoded_dates_found"": [
      ""2024-07-01"",
      ""2024-08-19""
    ],
    ""hardcoded_values_found"": [
      ""'SC'"",
      ""'acquisition'"",
      ""'SC_SDO_AP24AM12'"",
      ""'SC_SDO_AP20AM12'"",
      ""2452260"",
      ""'CS'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""rate plan codes should join to product_master"",
      ""subscriber ID should be a parameter/filter selection"",
      ""source masthead prefixes should use a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH filtered_movements AS (\n  SELECT\n    SAFE_CAST(movement_datetime AS DATE) AS movement_date,\n    masthead,\n    subscription_id_src,\n    subscriber_id_src,\n    subscription_movement_count_type,\n    sold_in_rate_plan_code,\n    SUBSTR(sold_in_source_code, 1, 2) AS source_masthead_prefix\n  FROM `prstn_consumer_views.v_subscription_movement`\n  WHERE\n    movement_datetime >= DATE '2024-07-01' -- Hardcoded start date\n    AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) -- Hardcoded end date\n    AND masthead = 'SC'\n    AND subscription_movement_count_type = 'acquisition'\n)\nSELECT\n  movement_date,\n  source_masthead_prefix,\n  sold_in_rate_plan_code,\n  subscriber_id_src,\n  COUNT(DISTINCT subscription_id_src) AS daily_unique_acquisitions,\n  COUNT(DISTINCT CASE\n    WHEN\n      sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12')\n      AND subscriber_id_src = 2452260\n      AND source_masthead_prefix = 'CS'\n    THEN subscription_id_src\n    ELSE NULL\n  END) AS daily_unique_acquisitions_specific_filters\nFROM filtered_movements\nGROUP BY\n  movement_date,\n  source_masthead_prefix,\n  sold_in_rate_plan_code,\n  subscriber_id_src\nORDER BY movement_date DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(movement_datetime AS DATE)) as unique_movement_dates,\n  COUNT(DISTINCT subscription_id_src) as unique_subscriptions,\n  COUNT(DISTINCT subscriber_id_src) as unique_subscribers,\n  COUNT(DISTINCT masthead) as unique_mastheads,\n  COUNT(DISTINCT subscription_movement_count_type) as unique_movement_types,\n  MIN(SAFE_CAST(movement_datetime AS DATE)) as earliest_movement_date,\n  MAX(SAFE_CAST(movement_datetime AS DATE)) as latest_movement_date\nFROM `prstn_consumer_views.v_subscription_movement`\nWHERE SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(DISTINCT subscription_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_subscriptions_test,\n  CASE WHEN COUNT(DISTINCT subscriber_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_subscribers_test,\n  CASE WHEN MAX(SAFE_CAST(movement_datetime AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN masthead = 'SC' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as supercoach_data_present_test,\n  CASE WHEN COUNT(CASE WHEN subscription_movement_count_type = 'acquisition' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as acquisition_data_present_test\nFROM `prstn_consumer_views.v_subscription_movement`\nWHERE SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'SuperCoach Acquisition Data' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage,\n  COUNT(DISTINCT sold_in_rate_plan_code) as distinct_rate_plans_in_scope,\n  COUNT(DISTINCT SUBSTR(sold_in_source_code, 1, 2)) as distinct_source_masthead_prefixes_in_scope\nFROM `prstn_consumer_views.v_subscription_movement`\nWHERE SAFE_CAST(movement_datetime AS DATE) >= DATE '2024-07-01' AND SAFE_CAST(movement_datetime AS DATE) < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(movement_datetime AS DATE) as movement_date,\n  masthead,\n  subscription_id_src,\n  subscriber_id_src,\n  subscription_movement_count_type,\n  sold_in_rate_plan_code,\n  sold_in_source_code,\n  is_paying_flag\nFROM `prstn_consumer_views.v_subscription_movement`\nWHERE SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND masthead = 'SC'\n  AND subscription_movement_count_type = 'acquisition'\nORDER BY movement_datetime DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024-07-01"",
          ""original_format"": ""DATE '2024-07-01'"",
          ""context"": ""Start date for filtering subscription movements"",
          ""suggested_fix"": ""replace with dashboard date parameter or relative date function (e.g., DATE_SUB(CURRENT_DATE(), INTERVAL X DAY))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-08-19"",
          ""original_format"": ""DATE '2024-08-19'"",
          ""context"": ""End date for filtering subscription movements"",
          ""suggested_fix"": ""replace with dashboard date parameter or relative date function (e.g., CURRENT_DATE())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'SC'""
          ],
          ""context"": ""Filtering for 'SuperCoach' masthead"",
          ""suggested_governance"": ""Use a parameter for masthead selection or join to a governed 'masthead_lookup' table if multiple mastheads are expected."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'acquisition'""
          ],
          ""context"": ""Filtering for 'acquisition' movement type"",
          ""suggested_governance"": ""Use a parameter for movement type selection or join to a governed 'movement_type_lookup' table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SC_SDO_AP24AM12'"",
            ""'SC_SDO_AP20AM12'""
          ],
          ""context"": ""Specific rate plan codes used for filtering"",
          ""suggested_governance"": ""These product/rate plan codes should be managed in a 'product_master' or 'rate_plan_lookup' table and joined, rather than hardcoded."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""2452260""
          ],
          ""context"": ""Specific subscriber ID used for filtering"",
          ""suggested_governance"": ""This is likely a specific filter selected by the user. It should be a dashboard parameter or filter control."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CS'""
          ],
          ""context"": ""Specific source masthead prefix used for filtering"",
          ""suggested_governance"": ""If 'CS' represents a category, it should be defined in a 'source_masthead_prefix_lookup' table and joined."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., CURRENT_DATE(), DATE_SUB())"",
      ""Replace hardcoded lookup values (masthead, movement type, rate plan codes, source masthead prefix) with joins to governed reference tables or dashboard parameters."",
      ""Parameterize specific subscriber IDs for dynamic filtering.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""movement_date"",
      ""metric_name"": ""Movement Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date component of the subscription movement timestamp, truncated to the day."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(movement_datetime, SECOND) AS DATE)"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for analyzing subscription trends."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead"",
      ""metric_name"": ""Masthead"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The masthead associated with the subscription (e.g., 'SC' for SuperCoach)."",
      ""sql_logic"": ""masthead"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""masthead = 'SC'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting subscription data by brand/product."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'SC'""
      ],
      ""governance_issues"": [
        ""hardcoded values should use a lookup table or parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscription_id_src"",
      ""metric_name"": ""Subscription ID (Source)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a subscription in the source system."",
      ""sql_logic"": ""subscription_id_src"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for counting distinct subscriptions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscriber_id_src"",
      ""metric_name"": ""Subscriber ID (Source)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a subscriber in the source system."",
      ""sql_logic"": ""subscriber_id_src"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""subscriber_id_src = 2452260""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for identifying individual subscribers and filtering data for specific users."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""2452260""
      ],
      ""governance_issues"": [
        ""hardcoded values should be parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscription_movement_count_type"",
      ""metric_name"": ""Subscription Movement Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of subscription movement (e.g., 'acquisition', 'churn', 'renewal')."",
      ""sql_logic"": ""subscription_movement_count_type"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""subscription_movement_count_type = 'acquisition'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for categorizing subscription events and focusing on specific lifecycle stages."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'acquisition'""
      ],
      ""governance_issues"": [
        ""hardcoded values should use a lookup table or parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sold_in_rate_plan_code"",
      ""metric_name"": ""Sold In Rate Plan Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The code for the rate plan under which the subscription was sold."",
      ""sql_logic"": ""sold_in_rate_plan_code"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze performance of specific subscription products/plans."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'SC_SDO_AP24AM12'"",
        ""'SC_SDO_AP20AM12'""
      ],
      ""governance_issues"": [
        ""hardcoded values should use a product master table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_masthead_prefix"",
      ""metric_name"": ""Source Masthead Prefix"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first two characters of the 'sold_in_source_code', often indicating a broader source category."",
      ""sql_logic"": ""SUBSTR(sold_in_source_code, 1, 2)"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""SUBSTR(sold_in_source_code, 1, 2) = 'CS'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting acquisitions by high-level source channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CS'""
      ],
      ""governance_issues"": [
        ""hardcoded values should use a lookup table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unique_acquisitions_total"",
      ""metric_name"": ""Total Unique Acquisitions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""subscription_id_src"",
        ""movement_date"",
        ""masthead"",
        ""subscription_movement_count_type""
      ],
      ""business_description"": ""The total count of distinct subscription IDs for 'SuperCoach' acquisitions within the specified date range."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src)"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)"",
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A primary KPI for measuring the volume of new SuperCoach subscriptions."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-01"",
        ""2024-08-19""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'""
      ],
      ""governance_issues"": [
        ""date range should be parameterized"",
        ""masthead and movement type should be from lookup/parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unique_acquisitions_by_specific_filters"",
      ""metric_name"": ""Unique Acquisitions by Specific Filters"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""source_masthead_prefix"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""subscription_id_src"",
        ""movement_date"",
        ""masthead"",
        ""subscription_movement_count_type"",
        ""sold_in_rate_plan_code"",
        ""subscriber_id_src"",
        ""source_masthead_prefix""
      ],
      ""business_description"": ""The count of distinct subscription IDs for 'SuperCoach' acquisitions that match specific rate plans, a particular subscriber, and a 'CS' source masthead prefix, within the specified date range."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src) filtered by sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS'"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)"",
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'"",
        ""sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12')"",
        ""subscriber_id_src = 2452260"",
        ""SUBSTR(sold_in_source_code, 1, 2) = 'CS'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a granular view of acquisitions based on specific product offerings, individual subscriber activity, and source channels."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-01"",
        ""2024-08-19""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'"",
        ""'SC_SDO_AP24AM12'"",
        ""'SC_SDO_AP20AM12'"",
        ""2452260"",
        ""'CS'""
      ],
      ""governance_issues"": [
        ""date range should be parameterized"",
        ""all hardcoded filter values should be from lookups/parameters""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_previous_samesubscriber"",
      ""metric_name"": ""Is Previous Same Subscriber"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""window_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""subscriber_id_src"",
        ""subscription_movement_count_type"",
        ""masthead"",
        ""is_paying_flag"",
        ""movement_datetime""
      ],
      ""business_description"": ""A flag indicating if there was a previous subscription movement for the same subscriber, movement type, masthead, and paying status. Calculated using a window function."",
      ""sql_logic"": ""COUNT(*) OVER (PARTITION BY subscriber_id_src, subscription_movement_count_type, masthead, is_paying_flag ORDER BY movement_datetime ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING)"",
      ""data_sources"": [
        ""prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Potentially used for churn analysis or understanding subscriber journey, though not directly used in the provided dashboard queries' final SELECT statements."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""unique_acquisitions_total"",
      ""related_metrics"": [
        ""unique_acquisitions_by_specific_filters""
      ],
      ""relationship_description"": ""The 'Unique Acquisitions by Specific Filters' metric is a subset of 'Total Unique Acquisitions', applying additional granular filters on rate plan, subscriber ID, and source masthead prefix."",
      ""mathematical_formula"": ""Unique Acquisitions by Specific Filters <= Total Unique Acquisitions"",
      ""business_validation"": ""This relationship ensures that the specific acquisition count never exceeds the total acquisition count for the same base period and masthead/movement type."",
      ""validation_sql"": ""SELECT\n  (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition') AS total_acquisitions,\n  (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS') AS specific_acquisitions,\n  CASE WHEN (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition') >= (SELECT COUNT(DISTINCT subscription_id_src) FROM `prstn_consumer_views.v_subscription_movement` WHERE movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS') THEN 'PASS' ELSE 'FAIL' END AS validation_result\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,18
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""2104a3f5-9424-4087-a928-e67fecae789a"",
    ""dashboard_name"": ""Circulation Performance Dashboard_dev_20250415"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""publication_name"",
      ""os_level_7 (Sales Channel)"",
      ""day_of_week"",
      ""fiscal_week_id"",
      ""fy_year"",
      ""gl_publication_code"",
      ""state"",
      ""publication_category""
    ],
    ""date_range_detected"": ""FY2025 (Fiscal Year 2025)"",
    ""hardcoded_dates_found"": [
      ""2025-06-23 04:08:01.229999+00"",
      ""2024-07-03T00:00:00"",
      ""2025-06-04 07:28:59.451817+00""
    ],
    ""hardcoded_values_found"": [
      ""'CIRCULATION'"",
      ""'FY2025'"",
      ""'Free News & Lifestyle'"",
      ""'Food'"",
      ""'Prestige'"",
      ""'Weekly Times'"",
      ""'Sunshine Coast'"",
      ""'Mackay'"",
      ""'All Sales Channels'"",
      ""'CP'"",
      ""'PY'"",
      ""Publication names for categorization (e.g., 'NT News', 'The Daily Telegraph', 'Herald Sun')"",
      ""Day of week categories ('M-F', 'SAT', 'Sun')"",
      ""Numeric literals in calculations (e.g., 2, 5, 6, 7, 48, 2025)""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterised or use relative date functions (e.g., CURRENT_DATE(), fiscal calendar lookups)."",
      ""Publication names and categories should be managed in a dedicated dimension table with a clear hierarchy and lookup keys."",
      ""Sales channel names should be managed in a dimension table."",
      ""Fiscal year ('FY2025') should be dynamic or parameterised."",
      ""Period names ('CP', 'PY') should be managed in a reference table."",
      ""Business rules for volume calculation (e.g., 6-day pubs, M-F, Sportsman, Weekly Times) should be externalized to a configuration table or UDFs for easier maintenance and transparency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.*,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND os.l04_publication_code <> 'Free News & Lifestyle'\n      AND os.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n      AND EXISTS (\n        SELECT 1 FROM `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n        WHERE control.source_week_number = calendar.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      )\n  ),\n  CalculatedMetrics AS (\n    SELECT\n      osf.*,\n      -- Common date calculations (from Q1 and Q3)\n      EXTRACT(DAYOFWEEK FROM SAFE_CAST(osf.fy_first_day_of_week AS TIMESTAMP)) - 1 AS day_of_week_num,\n      DATETIME_DIFF(SAFE_CAST(osf.fy_first_day_of_week AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS week_diff_from_baseline,\n      -- Q1 specific derived columns for date alignment\n      (2025 * 100) + (CASE WHEN (EXTRACT(DAYOFWEEK FROM SAFE_CAST(osf.fy_first_day_of_week AS TIMESTAMP)) - 1) <= 2 THEN DATETIME_DIFF(SAFE_CAST(osf.fy_first_day_of_week AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) - 1 ELSE DATETIME_DIFF(SAFE_CAST(osf.fy_first_day_of_week AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) END) = osf.fy_year_week_number AS is_aligned_week,\n      -- Q2 specific publication categorization\n      CASE\n        WHEN osf.publication_code = 'Post Courier' THEN 'PNG'\n        ELSE osf.publication_name\n      END AS publication_name_q2_step1,\n      CASE\n        WHEN (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END) IN ('NT News', 'Sunday Territorian') THEN 'Northern Territory'\n        WHEN (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END) IN ('', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Others'\n        WHEN (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END) IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n        WHEN (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END) IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n        WHEN (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END) IN ('Sunday Tasmanian', 'Mercury') THEN 'Mercury'\n        ELSE (CASE WHEN osf.publication_code = 'Post Courier' THEN 'PNG' ELSE osf.publication_name END)\n      END AS publication_category_q2,\n      -- Q3 specific day of week categorization\n      CASE\n        WHEN osf.day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F'\n        WHEN osf.day_of_week = 'Sat' THEN 'SAT'\n        WHEN osf.day_of_week = 'Sun' THEN 'Sun'\n        ELSE NULL\n      END AS day_of_week_category,\n      -- Q3 specific publication type categorization\n      CASE\n        WHEN osf.publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs'\n        WHEN osf.publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas'\n        WHEN osf.publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian'\n        WHEN osf.publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other'\n        WHEN osf.publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n        WHEN osf.publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail'\n        WHEN osf.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n        WHEN osf.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n        ELSE osf.publication_name\n      END AS publication_type_q3,\n      -- Q3 specific publication grouping for filters\n      CASE\n        WHEN osf.publication_name IN ('NT News', 'Sunday Territorian') THEN 'Northern Territory'\n        WHEN osf.publication_name IN ('', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Others'\n        WHEN osf.publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n        WHEN osf.publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n        ELSE osf.publication_name\n      END AS publication_group_q3,\n      -- Q3 specific flags for Courier Mail and Australian\n      (osf.publication_name = 'The Courier Mail') AS is_courier_mail,\n      (osf.publication_name = 'The Australian') AS is_the_australian,\n      -- Q3 specific period control logic (clmn50_)\n      (osf.fy_year = 2025 AND osf.fy_year_week_number <= ((2025*100)+osf.fy_month_of_year)) AS is_current_period_q3,\n      -- Q3 volume calculation (clmn54_ equivalent, choosing Forecast_Volume based on hardcoded '2')\n      osf.Forecast_Volume AS selected_volume_for_calc,\n      -- Q3 clmn38_ equivalent (fy_month_of_year or 48) - using fy_month_of_year as 48 is a hardcoded fallback\n      CASE WHEN 48 = 0 THEN osf.fy_month_of_year ELSE 48 END AS fy_month_or_48,\n      -- Q3 derived volume calculations (clmn56_, clmn57_, clmn58_, clmn59_)\n      (SAFE_DIVIDE(osf.Forecast_Volume, (CASE WHEN 48 = 0 THEN osf.fy_month_of_year ELSE 48 END * 2)) * 5) AS sportsman_volume_calc,\n      (SAFE_DIVIDE(osf.Forecast_Volume, CASE WHEN 48 = 0 THEN osf.fy_month_of_year ELSE 48 END) * 5) AS weekly_times_volume_calc,\n      (SAFE_DIVIDE(osf.Forecast_Volume, (CASE WHEN 48 = 0 THEN osf.fy_month_of_year ELSE 48 END * 5)) * 5) AS mf_volume_calc,\n      SAFE_DIVIDE(osf.Forecast_Volume, CASE WHEN 48 = 0 THEN osf.fy_month_of_year ELSE 48 END) AS default_volume_calc\n    FROM OSandFACT AS osf\n  )\nSELECT\n  -- Dimensions\n  cm.publication_name,\n  cm.os_level_7 AS sales_channel,\n  cm.day_of_week,\n  cm.fy_year_week_number AS fiscal_week,\n  cm.fy_year AS fiscal_year,\n  cm.publication_category_q2 AS publication_category_q2,\n  cm.publication_type_q3 AS publication_type_q3,\n  cm.publication_group_q3 AS publication_group_q3,\n  cm.day_of_week_category AS day_of_week_category,\n  -- Metrics\n  SUM(SAFE_CAST(cm.Actual_Amount AS NUMERIC)) AS total_actual_amount,\n  SUM(SAFE_CAST(cm.volume AS NUMERIC)) AS total_volume,\n  SUM(SAFE_CAST(cm.Budget_Volume AS NUMERIC)) AS total_budget_volume,\n  SUM(SAFE_CAST(cm.Forecast_Volume AS NUMERIC)) AS total_forecast_volume,\n  SUM(SAFE_CAST(cm.Last_Year_volume AS NUMERIC)) AS total_last_year_volume,\n  -- Q3 calculated volume (clmn55_ equivalent)\n  SUM(CASE\n    WHEN cm.publication_type_q3 = 'PNG' THEN 0\n    WHEN cm.publication_type_q3 = '6 Day Pubs' THEN SAFE_DIVIDE(SAFE_CAST(cm.selected_volume_for_calc AS NUMERIC), 6)\n    ELSE SAFE_DIVIDE(SAFE_CAST(cm.selected_volume_for_calc AS NUMERIC), 7)\n  END) AS calculated_volume_q3,\n  -- Q3 calculated volume per day (clmn64_ equivalent)\n  SUM(CASE\n    WHEN cm.is_the_australian OR cm.is_courier_mail THEN\n      (CASE WHEN cm.day_of_week_category = 'M-F' THEN SAFE_CAST(cm.mf_volume_calc AS NUMERIC) ELSE SAFE_CAST(cm.default_volume_calc AS NUMERIC) END)\n    WHEN cm.publication_name = 'The Sportsman' THEN SAFE_CAST(cm.sportsman_volume_calc AS NUMERIC)\n    WHEN cm.publication_name = 'Weekly Times' THEN SAFE_CAST(cm.weekly_times_volume_calc AS NUMERIC)\n    WHEN cm.publication_type_q3 = 'PNG' THEN 0\n    WHEN cm.day_of_week_category = 'M-F' THEN SAFE_CAST(cm.mf_volume_calc AS NUMERIC)\n    ELSE SAFE_CAST(cm.default_volume_calc AS NUMERIC)\n  END) AS calculated_volume_per_day_q3\nFROM CalculatedMetrics AS cm\nWHERE\n  -- Q1 filters\n  cm.is_aligned_week = TRUE\n  AND cm.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n  AND cm.os_level_7 = 'All Sales Channels'\n  -- Q3 filters (some duplicated from Q1 for clarity of original query logic)\n  AND cm.is_current_period_q3 = TRUE\n  AND cm.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n  AND cm.os_level_7 = 'All Sales Channels'\n  AND cm.publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')\nGROUP BY\n  cm.publication_name,\n  cm.os_level_7,\n  cm.day_of_week,\n  cm.fy_year_week_number,\n  cm.fy_year,\n  cm.publication_category_q2,\n  cm.publication_type_q3,\n  cm.publication_group_q3,\n  cm.day_of_week_category\nORDER BY\n  cm.fy_year DESC, cm.fy_year_week_number DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(os.fiscal_week_id AS STRING)) as unique_fiscal_week_ids,\n  COUNT(DISTINCT os.gl_publication_code) as unique_publication_codes,\n  COUNT(DISTINCT os.os_level_7) as unique_sales_channels,\n  MIN(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as earliest_fiscal_week_date,\n  MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) as latest_fiscal_week_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(os.fiscal_week_id AS STRING), os.gl_publication_code, os.os_level_7, os.day_of_week)) as approx_unique_grain_records\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND upper(os.os_level_6) = 'CIRCULATION'\nLIMIT 1000;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(os.Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(SAFE_CAST(os.volume AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as volume_test,\n  CASE WHEN COUNT(DISTINCT os.gl_publication_code) > 0 THEN 'PASS' ELSE 'FAIL' END as publication_test,\n  CASE WHEN MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as period_control_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control ON control.source_week_number = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND upper(os.os_level_6) = 'CIRCULATION'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Circulation_Filter' as rule_name_1,\n  SUM(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END) as circulation_records,\n  'Publication_Exclusion_Filter' as rule_name_2,\n  SUM(CASE WHEN os.l04_publication_code <> 'Free News & Lifestyle' AND os.l06_publication_code NOT IN ('Food', 'Prestige') THEN 1 ELSE 0 END) as publication_exclusion_records,\n  'FY2025_Filter' as rule_name_3,\n  SUM(CASE WHEN os.gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) as fy2025_records,\n  'Sales_Channel_Filter' as rule_name_4,\n  SUM(CASE WHEN os.os_level_7 = 'All Sales Channels' THEN 1 ELSE 0 END) as all_sales_channels_records,\n  'Period_Control_Filter' as rule_name_5,\n  SUM(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 ELSE 0 END) as period_control_records\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control ON control.source_week_number = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(os.fiscal_week_id AS STRING) as fiscal_week_id,\n  os.gl_publication_code,\n  pub.publication_name,\n  os.day_of_week,\n  os.os_level_7,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) as actual_amount,\n  SAFE_CAST(os.volume AS NUMERIC) as volume,\n  SAFE_CAST(os.Budget_Volume AS NUMERIC) as budget_volume,\n  SAFE_CAST(os.Forecast_Volume AS NUMERIC) as forecast_volume,\n  SAFE_CAST(os.Last_Year_volume AS NUMERIC) as last_year_volume,\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) as fy_first_day_of_week,\n  SAFE_CAST(calendar.fy_year AS INT64) as fy_year,\n  SAFE_CAST(calendar.fy_month_of_year AS INT64) as fy_month_of_year\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND upper(os.os_level_6) = 'CIRCULATION'\nORDER BY\n  calendar.fy_first_day_of_week DESC, os.Actual_Amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date in DATETIME_DIFF calculations to determine week differences. This date is fixed and does not dynamically adjust."",
          ""suggested_fix"": ""Replace with a dynamic fiscal year start date from a calendar dimension table or a parameter. E.g., `(SELECT MIN(fy_first_day_of_week) FROM v_asl_DIM_calendar WHERE fy_year = EXTRACT(YEAR FROM CURRENT_DATE()))` or a dashboard parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""2025-06-23 04:08:01.229999+00"",
          ""context"": ""Used as a fixed date in a date alignment calculation (clmn1_ in Q1)."",
          ""suggested_fix"": ""Replace with a dynamic date, potentially `CURRENT_DATE()` or a fiscal period end date from a calendar dimension table or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-04"",
          ""original_format"": ""2025-06-04 07:28:59.451817+00"",
          ""context"": ""Used as a fixed date in date calculations (clmn1_, clmn2_ in Q3)."",
          ""suggested_fix"": ""Replace with a dynamic date, potentially `CURRENT_DATE()` or a fiscal period end date from a calendar dimension table or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'CIRCULATION'""],
          ""context"": ""Filter on `os_level_6` to 'CIRCULATION'. While often static, it could be managed via a configuration table if business units change."",
          ""suggested_governance"": ""Consider a `business_unit_config` table if this filter needs to be dynamic or managed centrally."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'FY2025'""],
          ""context"": ""Filter on `gl_hierarchy_code` to 'FY2025'. This will make the dashboard obsolete after FY2025."",
          ""suggested_governance"": ""Replace with a dynamic fiscal year derived from `CURRENT_DATE()` and the fiscal calendar, or a dashboard parameter for fiscal year selection."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'"", ""'Weekly Times'"", ""'Sunshine Coast'"", ""'Mackay'""],
          ""context"": ""Exclusions of specific publication codes/names. These are hardcoded in `WHERE` clauses and `CASE` statements."",
          ""suggested_governance"": ""Create a `publication_exclusion_list` table or a `publication_master` dimension with an `is_excluded` flag. Join to this table for filtering."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'All Sales Channels'""],
          ""context"": ""Filter on `os_level_7` to 'All Sales Channels'."",
          ""suggested_governance"": ""Manage sales channel categories in a `sales_channel_dimension` table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'CP'"", ""'PY'""],
          ""context"": ""Filter on `period_name` in `v_asl_DIM_period_control`."",
          ""suggested_governance"": ""These seem to be standard fiscal period types, but if they are subject to change or new types are introduced, a `period_type_dimension` table would be beneficial."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'NT News'"", ""'Sunday Territorian'"", ""'The Daily Telegraph'"", ""'Herald Sun'"", ""'Mercury'"", ""etc.""],
          ""context"": ""Extensive `CASE` statements for categorizing `publication_name` into broader groups (e.g., 'Northern Territory', 'The Daily Telegraph', 'Others', '6 Day Pubs')."",
          ""suggested_governance"": ""These categorizations should be defined in the `v_asl_DIM_os_publication_hierachy` table itself or a separate `publication_grouping_dimension` table. This avoids complex, hardcoded `CASE` logic in queries."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'M-F'"", ""'SAT'"", ""'Sun'"", ""'Mon'"", ""'Tue'"", ""'Wed'"", ""'Thu'"", ""'Fri'"", ""'Weekday Entry'""],
          ""context"": ""Categorization of `day_of_week`."",
          ""suggested_governance"": ""The `v_asl_DIM_calendar` table should ideally contain these categorizations as columns (e.g., `is_weekday`, `is_weekend`, `day_type_category`)."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [""2"", ""5"", ""6"", ""7"", ""48"", ""2025""],
          ""context"": ""Numeric literals used in complex volume calculations (e.g., `SAFE_DIVIDE(volume, 6)` for 6-day pubs, `(2025*100)+clmn38_`, `(clmn38_*2)*5`). The '2' in `CASE WHEN ('2' = '1') THEN clmn0_ WHEN ('2' = '2') THEN clmn51_ WHEN ('2' = '3') THEN clmn4_ ELSE 0 END` is particularly problematic as it hardcodes the selection of `Forecast_Volume`."",
          ""suggested_governance"": ""These calculation factors and selection logic should be externalized. The '2' for selecting Forecast_Volume should be a parameter or a dynamic lookup based on a 'current scenario' setting. Calculation factors (6, 7, 2, 5) could be in a `calculation_factors_config` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2024-07-03') with dashboard date parameters or dynamic fiscal period start/end dates from the calendar dimension."",
      ""Replace hardcoded fiscal year ('FY2025') with a dashboard parameter or derive it dynamically from `CURRENT_DATE()` and the fiscal calendar."",
      ""Externalize publication exclusion lists and categorization logic into dedicated dimension tables or configuration tables, joining them to the main fact data."",
      ""Parameterize the 'scenario selection' (e.g., 'Actual', 'Budget', 'Forecast', 'Last Year') instead of hardcoding '2' to select 'Forecast_Volume'."",
      ""Move complex business rules for volume calculations (e.g., 6-day pubs, M-F adjustments, Sportsman/Weekly Times specific logic) into UDFs or a configuration table that defines the calculation logic per publication type/day type.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual financial amount recorded for circulation performance."",
      ""sql_logic"": ""SUM(t0.Actual_Amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""Date alignment logic based on '2024-07-03' and '2025-06-23'"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for tracking circulation revenue/cost."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2024-07-03T00:00:00"", ""2025-06-23 04:08:01.229999+00""],
      ""hardcoded_values_in_metric"": [""'CIRCULATION'"", ""'FY2025'"", ""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'"", ""'Weekly Times'"", ""'Sunshine Coast'"", ""'Mackay'"", ""'All Sales Channels'"", ""2025""],
      ""governance_issues"": [""Date and year hardcoding, publication/sales channel exclusions should be externalized.""],
      ""data_quality_concerns"": [""Reliance on complex date alignment logic may lead to misinterpretations if fiscal calendar changes.""]
    },
    {
      ""metric_id"": ""volume"",
      ""metric_name"": ""Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume (e.g., units, copies) for circulation performance."",
      ""sql_logic"": ""SUM(t0.volume)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""Date alignment logic based on '2024-07-03' and '2025-06-23'"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key operational metric for tracking physical circulation units."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2024-07-03T00:00:00"", ""2025-06-23 04:08:01.229999+00""],
      ""hardcoded_values_in_metric"": [""'CIRCULATION'"", ""'FY2025'"", ""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'"", ""'Weekly Times'"", ""'Sunshine Coast'"", ""'Mackay'"", ""'All Sales Channels'"", ""2025""],
      ""governance_issues"": [""Date and year hardcoding, publication/sales channel exclusions should be externalized.""],
      ""data_quality_concerns"": [""Reliance on complex date alignment logic may lead to misinterpretations if fiscal calendar changes.""]
    },
    {
      ""metric_id"": ""publication_category_q2"",
      ""metric_name"": ""Publication Category (Q2)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""publication"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""publication_name"", ""publication_code""],
      ""business_description"": ""Categorization of publications for reporting purposes, used in Q2 query."",
      ""sql_logic"": ""CASE WHEN (t0.publication_code = 'Post Courier') THEN 'PNG' ELSE t0.publication_name END AS clmn3_, THEN further CASE WHEN clmn3_ IN (...) THEN 'Category' ELSE clmn3_ END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"", ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""Filtered for 'Advertiser' category""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping publications in charts and filters, specifically for a count of records."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Post Courier'"", ""'NT News'"", ""'Sunday Territorian'"", ""'Brisbane Other'"", ""etc."", ""'Advertiser'""],
      ""governance_issues"": [""Extensive hardcoded publication names for categorization; should be managed in a dimension table.""],
      ""data_quality_concerns"": [""New publications or changes in categorization require code modification.""]
    },
    {
      ""metric_id"": ""total_records_by_publication_category"",
      ""metric_name"": ""Total Records by Publication Category"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""publication_category"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""publication_category_q2""],
      ""business_description"": ""Count of records per publication category, used for a filter or dropdown."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"", ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""Filtered for 'Advertiser' category""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides counts for populating a filter or selection list in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Advertiser'""],
      ""governance_issues"": [""Relies on hardcoded publication categories.""],
      ""data_quality_concerns"": [""Accuracy depends on the completeness of the hardcoded category list.""]
    },
    {
      ""metric_id"": ""calculated_volume_q3"",
      ""metric_name"": ""Calculated Volume (Q3)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""forecast_volume"", ""publication_type_q3""],
      ""business_description"": ""Volume adjusted based on publication type (e.g., 6-day pubs, PNG) and a hardcoded selection of Forecast_Volume."",
      ""sql_logic"": ""SUM(CASE WHEN (clmn32_ = 'PNG') THEN 0 WHEN (clmn32_ = '6 Day Pubs') THEN SAFE_DIVIDE(clmn49_, 6) ELSE SAFE_DIVIDE(clmn49_, 7) END) where clmn49_ is derived from Forecast_Volume"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""is_current_period_q3 = TRUE"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'"",
        ""publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key adjusted volume metric, likely used for specific performance comparisons or targets."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-06-04 07:28:59.451817+00""],
      ""hardcoded_values_in_metric"": [""'2' (for selecting Forecast_Volume)"", ""6"", ""7"", ""'PNG'"", ""'6 Day Pubs'"", ""2025"", ""48"", ""Publication names for categorization and filtering""],
      ""governance_issues"": [""Hardcoded selection of Forecast_Volume, hardcoded division factors, and extensive hardcoded publication categorizations. These should be parameterized or externalized.""],
      ""data_quality_concerns"": [""Accuracy depends on the correctness of hardcoded business rules and the fixed selection of Forecast_Volume.""]
    },
    {
      ""metric_id"": ""calculated_volume_per_day_q3"",
      ""metric_name"": ""Calculated Volume Per Day (Q3)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""forecast_volume"", ""publication_name"", ""day_of_week_category"", ""publication_type_q3""],
      ""business_description"": ""Volume per day, with specific adjustments for Courier Mail, The Australian, Sportsman, Weekly Times, M-F, and PNG publications."",
      ""sql_logic"": ""SUM(CASE WHEN (clmn37_ OR clmn36_) THEN clmn60_ WHEN (clmn31_ = 'The Sportsman') THEN clmn56_ WHEN (clmn31_ = 'Weekly Times') THEN clmn57_ WHEN (clmn32_ = 'PNG') THEN 0 WHEN (clmn19_ = 'M-F') THEN clmn58_ ELSE clmn59_ END) where clmn56_, clmn57_, clmn58_, clmn59_ are derived from Forecast_Volume and fy_month_of_year/48."",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""is_current_period_q3 = TRUE"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'"",
        ""publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a normalized volume metric per day, accounting for specific publication characteristics and reporting needs."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025-06-04 07:28:59.451817+00""],
      ""hardcoded_values_in_metric"": [""'2' (for selecting Forecast_Volume)"", ""2"", ""5"", ""48"", ""2025"", ""'The Courier Mail'"", ""'The Australian'"", ""'The Sportsman'"", ""'Weekly Times'"", ""'PNG'"", ""'M-F'"", ""Publication names for categorization and filtering""],
      ""governance_issues"": [""Highly complex and hardcoded business rules for volume calculation. These should be externalized to a configuration table or UDFs.""],
      ""data_quality_concerns"": [""High risk of errors due to complex nested CASE statements and hardcoded logic. Maintenance is difficult.""]
    },
    {
      ""metric_id"": ""budget_volume"",
      ""metric_name"": ""Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The budgeted volume for circulation performance."",
      ""sql_logic"": ""t0.Budget_Volume"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for comparison against actuals and forecasts."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'CIRCULATION'"", ""'FY2025'"", ""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_volume"",
      ""metric_name"": ""Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The forecasted volume for circulation performance."",
      ""sql_logic"": ""t0.Forecast_Volume"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for comparison against actuals and budgets, and as a base for other calculations."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'CIRCULATION'"", ""'FY2025'"", ""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_volume"",
      ""metric_name"": ""Last Year Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The volume from the previous fiscal year for comparison."",
      ""sql_logic"": ""t0.Last_Year_volume"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for year-over-year performance analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'CIRCULATION'"", ""'FY2025'"", ""'Free News & Lifestyle'"", ""'Food'"", ""'Prestige'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""calculated_volume_q3"",
      ""related_metrics"": [""forecast_volume"", ""publication_type_q3""],
      ""relationship_description"": ""Calculated Volume (Q3) is derived from Forecast Volume, adjusted based on the publication's type (e.g., 6-day pubs, PNG). It also implicitly depends on a hardcoded selection of 'Forecast_Volume' over other volume types."",
      ""mathematical_formula"": ""Calculated_Volume = SUM(CASE WHEN publication_type = 'PNG' THEN 0 WHEN publication_type = '6 Day Pubs' THEN Forecast_Volume / 6 ELSE Forecast_Volume / 7 END)"",
      ""business_validation"": ""Ensures volume is normalized correctly for different publication models. The hardcoded selection of Forecast_Volume means this metric always reflects the forecast, not actuals or budget."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN publication_type_q3 = 'PNG' THEN 0 WHEN publication_type_q3 = '6 Day Pubs' THEN SAFE_DIVIDE(SAFE_CAST(selected_volume_for_calc AS NUMERIC), 6) ELSE SAFE_DIVIDE(SAFE_CAST(selected_volume_for_calc AS NUMERIC), 7) END) AS re_calculated_volume_q3, SUM(SAFE_CAST(calculated_volume_q3 AS NUMERIC)) AS original_calculated_volume_q3 FROM CalculatedMetrics WHERE is_current_period_q3 = TRUE AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' AND publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') GROUP BY 1,2 LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""calculated_volume_per_day_q3"",
      ""related_metrics"": [""forecast_volume"", ""publication_name"", ""day_of_week_category"", ""publication_type_q3""],
      ""relationship_description"": ""Calculated Volume Per Day (Q3) is a highly conditional metric, adjusting Forecast Volume based on specific publication names (Courier Mail, Australian, Sportsman, Weekly Times), day of week, and publication type (PNG). It involves complex division factors."",
      ""mathematical_formula"": ""Calculated_Volume_Per_Day = SUM(CASE WHEN (is_the_australian OR is_courier_mail) THEN (IF day_of_week_category = 'M-F' THEN Forecast_Volume / (fy_month_or_48 * 5) * 5 ELSE Forecast_Volume / fy_month_or_48 END) WHEN publication_name = 'The Sportsman' THEN Forecast_Volume / (fy_month_or_48 * 2) * 5 WHEN publication_name = 'Weekly Times' THEN Forecast_Volume / fy_month_or_48 * 5 WHEN publication_type = 'PNG' THEN 0 WHEN day_of_week_category = 'M-F' THEN Forecast_Volume / (fy_month_or_48 * 5) * 5 ELSE Forecast_Volume / fy_month_or_48 END)"",
      ""business_validation"": ""Provides a highly tailored daily volume metric, reflecting specific business rules for different publications and days. Critical for detailed performance analysis but prone to errors if rules change."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN (is_the_australian OR is_courier_mail) THEN (CASE WHEN day_of_week_category = 'M-F' THEN SAFE_CAST(mf_volume_calc AS NUMERIC) ELSE SAFE_CAST(default_volume_calc AS NUMERIC) END) WHEN publication_name = 'The Sportsman' THEN SAFE_CAST(sportsman_volume_calc AS NUMERIC) WHEN publication_name = 'Weekly Times' THEN SAFE_CAST(weekly_times_volume_calc AS NUMERIC) WHEN publication_type_q3 = 'PNG' THEN 0 WHEN day_of_week_category = 'M-F' THEN SAFE_CAST(mf_volume_calc AS NUMERIC) ELSE SAFE_CAST(default_volume_calc AS NUMERIC) END) AS re_calculated_volume_per_day_q3, SUM(SAFE_CAST(calculated_volume_per_day_q3 AS NUMERIC)) AS original_calculated_volume_per_day_q3 FROM CalculatedMetrics WHERE is_current_period_q3 = TRUE AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' AND publication_group_q3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') GROUP BY 1,2 LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [""volume"", ""calculated_volume_q3"", ""calculated_volume_per_day_q3"", ""budget_volume"", ""forecast_volume"", ""last_year_volume""],
      ""relationship_description"": ""All primary metrics are heavily filtered by common business rules: 'CIRCULATION' `os_level_6`, 'FY2025' `gl_hierarchy_code`, exclusion of specific publications ('Free News & Lifestyle', 'Food', 'Prestige', 'Weekly Times', 'Sunshine Coast', 'Mackay'), and 'All Sales Channels' `os_level_7`. The period control filter ('CP', 'PY') also applies to the base data."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that all reported metrics are consistent and apply to the defined 'Circulation Performance' scope. Any change in these filters will affect all metrics."",
      ""validation_sql"": ""SELECT COUNT(*) FROM OSandFACT WHERE upper(os_level_6) = 'CIRCULATION' AND l04_publication_code <> 'Free News & Lifestyle' AND l06_publication_code NOT IN ('Food', 'Prestige') AND gl_hierarchy_code = 'FY2025' AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND os_level_7 = 'All Sales Channels' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,20
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""77c68c35-20ce-477a-b216-0c781d43a8ca"",
    ""dashboard_name"": ""Cecile - Adsales Adhoc Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"",
    ""business_domain"": ""advertising|finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 13,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""mixed"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_week_id"",
      ""source_system_code"",
      ""os_level_5"",
      ""unified_publication_gl_code"",
      ""revenue_transaction_status"",
      ""source_publishing_division""
    ],
    ""date_range_detected"": ""2025 (explicitly filtered)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202548"",
      ""202549"",
      ""202550"",
      ""202551""
    ],
    ""hardcoded_values_found"": [
      ""'Booked'"",
      ""'Billed'"",
      ""'Medium Rare Content Agency'"",
      ""'-1'"",
      ""'PLUTO'"",
      ""'CPQ'"",
      ""'ADPT'"",
      ""'9707'"",
      ""'9655'"",
      ""'9658'""
    ],
    ""governance_opportunities"": [
      ""Dates (financial_year, fiscal_week_id) should be parameterized or use relative date functions."",
      ""Lookup values (revenue_transaction_status, source_publishing_division, source_system_code, unified_publication_gl_code) should be managed via governed reference tables instead of hardcoded lists."",
      ""Invoice number '-1' should be documented or replaced with a descriptive constant if it represents a specific transaction type.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query attempts to consolidate metrics from different sources by joining on a common 'year' dimension.\n-- Due to disparate grouping keys in the original queries, many columns will show NULLs where data does not align.\n-- This provides a high-level, year-based overview of the identified metrics.\n\nWITH RevenueData AS (\n  SELECT\n    t0.financial_year AS financial_year,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week_id,\n    t0.source_system_code AS source_system_code,\n    t0.source_publishing_division AS source_publishing_division,\n    SUM(t0.gross_revenue_amount) AS total_gross_revenue_amount,\n    SUM(SAFE_CAST(t0.financial_week AS INT64)) AS sum_financial_week_id_for_ordering -- This metric is unusual, likely for internal sorting/ordering\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND t0.invoice_number = '-1'\n    AND t0.source_system_code IN ('PLUTO', 'CPQ', 'ADPT')\n    AND t0.financial_year IN ('2025') -- Hardcoded year\n  GROUP BY\n    t0.financial_year,\n    SAFE_CAST(t0.financial_week AS INT64),\n    t0.source_system_code,\n    t0.source_publishing_division\n),\nOperatingStatementData AS (\n  SELECT\n    SUBSTR(t0.fiscal_week_id, 1, 4) AS fiscal_year, -- Extract year from fiscal_week_id\n    t0.os_level_5 AS os_level_5,\n    COUNT(1) AS record_count_os_level_5\n  FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement` AS t0\n  WHERE\n    t0.fiscal_week_id IN ('202548', '202549', '202550', '202551') -- Hardcoded fiscal weeks\n  GROUP BY\n    SUBSTR(t0.fiscal_week_id, 1, 4),\n    t0.os_level_5\n),\nDataLoadData AS (\n  SELECT\n    CAST(EXTRACT(YEAR FROM t0.data_load_datetime) AS STRING) AS data_load_year, -- Extract year from datetime\n    t0.unified_publication_gl_code AS unified_publication_gl_code,\n    DATETIME_TRUNC(t0.data_load_datetime, SECOND) AS data_load_datetime_truncated -- This is a dimension, not a metric\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.unified_publication_gl_code IN ('9707', '9655', '9658') -- Hardcoded GL codes\n  GROUP BY -- Grouping by a datetime truncated to second will result in many rows, essentially distinct values\n    CAST(EXTRACT(YEAR FROM t0.data_load_datetime) AS STRING),\n    t0.unified_publication_gl_code,\n    DATETIME_TRUNC(t0.data_load_datetime, SECOND)\n)\nSELECT\n  COALESCE(R.financial_year, OS.fiscal_year, DL.data_load_year) AS common_year,\n  R.financial_week_id,\n  R.source_system_code,\n  R.source_publishing_division,\n  R.total_gross_revenue_amount,\n  R.sum_financial_week_id_for_ordering,\n  OS.os_level_5,\n  OS.record_count_os_level_5,\n  DL.unified_publication_gl_code,\n  DL.data_load_datetime_truncated\nFROM RevenueData R\nFULL OUTER JOIN OperatingStatementData OS\n  ON R.financial_year = OS.fiscal_year\nFULL OUTER JOIN DataLoadData DL\n  ON COALESCE(R.financial_year, OS.fiscal_year) = DL.data_load_year\nORDER BY\n  common_year DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling from the primary revenue table.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.data_load_datetime AS DATE)) as unique_data_load_dates,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_week AS STRING)) as unique_financial_weeks,\n  COUNT(DISTINCT t0.source_system_code) as unique_source_systems,\n  COUNT(DISTINCT t0.source_publishing_division) as unique_publishing_divisions,\n  COUNT(DISTINCT t0.revenue_transaction_status) as unique_transaction_statuses,\n  MIN(SAFE_CAST(t0.data_load_datetime AS DATE)) as earliest_data_load_date,\n  MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) as latest_data_load_date,\n  MIN(t0.financial_year) as earliest_financial_year,\n  MAX(t0.financial_year) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.invoice_number, '_', t0.financial_week, '_', t0.source_system_code)) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that key metric calculations and filters work syntactically and return expected data.\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_calculation_test,\n  CASE WHEN COUNT(DISTINCT t0.financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_presence_test,\n  CASE WHEN MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test,\n  CASE WHEN COUNT(CASE WHEN t0.invoice_number = '-1' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as invoice_number_filter_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic and filter effectiveness.\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_status_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_status_percentage,\n  'Source Publishing Division Exclusion' as rule_name_2,\n  SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_division_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_division_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis from the primary revenue table.\nSELECT\n  t0.financial_year,\n  SAFE_CAST(t0.financial_week AS INT64) AS financial_week_id,\n  t0.gross_revenue_amount,\n  t0.invoice_number,\n  t0.revenue_transaction_status,\n  t0.source_publishing_division,\n  t0.source_system_code,\n  SAFE_CAST(t0.data_load_datetime AS DATETIME) AS data_load_datetime,\n  t0.unified_publication_gl_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY SAFE_CAST(t0.data_load_datetime AS DATE) DESC, t0.gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""Used as a filter for financial_year in revenue calculation (Query 1)."",
          ""suggested_fix"": ""Replace with a Looker Studio date parameter (e.g., @DS_FINANCIAL_YEAR) or a relative date function (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202548, 202549, 202550, 202551"",
          ""original_format"": ""('202548', '202549', '202550', '202551')"",
          ""context"": ""Used as a filter for fiscal_week_id in operating statement calculation (Query 2)."",
          ""suggested_fix"": ""Replace with a Looker Studio date range parameter that can derive fiscal weeks, or a dynamic calculation based on CURRENT_DATE()."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""Revenue transaction statuses used as a filter (Query 1)."",
          ""suggested_governance"": ""Use a governed reference table for transaction statuses, or a Looker Studio parameter for user selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Source publishing division excluded from revenue calculation (Query 1)."",
          ""suggested_governance"": ""Manage exclusions in a configuration table or allow parameterization for flexibility."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'-1'""
          ],
          ""context"": ""Invoice number filter (Query 1). This value likely represents a specific type of transaction (e.g., internal, placeholder)."",
          ""suggested_governance"": ""Document the meaning of '-1' in a data dictionary. If it's a type, use a descriptive code from a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'"",
            ""'CPQ'"",
            ""'ADPT'""
          ],
          ""context"": ""Source system codes used as a filter (Query 1)."",
          ""suggested_governance"": ""Use a governed reference table for source system codes, or a Looker Studio parameter for user selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'9707'"",
            ""'9655'"",
            ""'9658'""
          ],
          ""context"": ""Unified publication GL codes used as a filter (Query 3)."",
          ""suggested_governance"": ""Use a governed reference table for GL codes, or a Looker Studio parameter for user selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates and fiscal periods with Looker Studio date range parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values (e.g., transaction statuses, source systems, GL codes) with joins to governed reference tables or Looker Studio parameters for dynamic filtering."",
      ""Consider externalizing business rules (like exclusions) into configuration tables for easier maintenance and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the advertising revenue transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key temporal dimension for revenue reporting."",
      ""metric_category"": ""temporal"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue generated from advertising sales, filtered by specific transaction statuses, source systems, and exclusions."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary revenue metric for ad sales performance analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'-1'"",
        ""'PLUTO'"",
        ""'CPQ'"",
        ""'ADPT'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in gross_revenue_amount"",
        ""accuracy depends on correct transaction status and system codes""
      ]
    },
    {
      ""metric_id"": ""financial_week_id"",
      ""metric_name"": ""Financial Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week identifier, cast to an integer, associated with the revenue transaction."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Granular temporal dimension for revenue reporting."",
      ""metric_category"": ""temporal"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential casting errors if financial_week is not numeric""
      ]
    },
    {
      ""metric_id"": ""sum_financial_week_id"",
      ""metric_name"": ""Sum of Financial Week ID (Internal)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_week_id""
      ],
      ""business_description"": ""An aggregated sum of financial week IDs. This metric appears to be used primarily for ordering or internal Looker Studio calculations rather than a direct business KPI."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.financial_week AS INT64))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely an artifact of Looker Studio's query generation for sorting or internal logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_code"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The system from which the advertising revenue transaction originated (e.g., PLUTO, CPQ, ADPT)."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue by source system."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction (e.g., Booked, Billed). Used to filter revenue data."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Booked', 'Billed')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Critical filter for defining 'recognized' revenue."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division associated with the revenue transaction. Used to exclude specific divisions."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""!= 'Medium Rare Content Agency' OR IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting or excluding revenue by internal division."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""invoice_number"",
      ""metric_name"": ""Invoice Number"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The invoice number for the transaction. Filtered to a specific placeholder value."",
      ""sql_logic"": ""t0.invoice_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""= '-1'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Specific filter, likely for internal or placeholder transactions."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'-1'""
      ],
      ""governance_issues"": [
        ""value should be documented or use a descriptive constant""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5"",
      ""metric_name"": ""Operating Statement Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific level of detail within the finance operating statement hierarchy."",
      ""sql_logic"": ""t0.os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for finance reporting and analysis."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""record_count_os_level_5"",
      ""metric_name"": ""Record Count by OS Level 5"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The count of records within the finance operating statement, grouped by OS Level 5, for specific fiscal weeks."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Volume metric for understanding activity within finance operating statements."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week identifier. Used to filter operating statement data."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Critical temporal filter for finance reporting."",
      ""metric_category"": ""temporal"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""data_load_datetime_truncated"",
      ""metric_name"": ""Data Load Datetime (Truncated to Second)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""second"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp indicating when the data was loaded, truncated to the second. Used as a dimension for analysis."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.data_load_datetime, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Provides insight into data freshness or processing times, segmented by GL code."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""real_time"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_gl_code"",
      ""metric_name"": ""Unified Publication GL Code"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger code for unified publications. Used to filter data load datetime information."",
      ""sql_logic"": ""t0.unified_publication_gl_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('9707', '9655', '9658')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Filter for specific GL codes, likely related to specific publication types or business units."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'9707'"",
        ""'9655'"",
        ""'9658'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""invoice_number"",
        ""source_system_code"",
        ""financial_year""
      ],
      ""relationship_description"": ""The 'Total Gross Revenue Amount' is directly impacted by filters on transaction status, publishing division, invoice number, source system, and financial year. Only 'Booked' or 'Billed' transactions, excluding 'Medium Rare Content Agency' division, with invoice number '-1', from 'PLUTO', 'CPQ', or 'ADPT' systems, and in '2025' financial year are included."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [filters apply]"",
      ""business_validation"": ""Ensures that revenue reported aligns with specific business rules for recognition and source."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) AND t0.invoice_number = '-1' AND t0.source_system_code IN ('PLUTO', 'CPQ', 'ADPT') AND t0.financial_year = '2025' THEN t0.gross_revenue_amount ELSE 0 END) AS filtered_revenue, SUM(t0.gross_revenue_amount) AS total_unfiltered_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0 WHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""record_count_os_level_5"",
      ""related_metrics"": [
        ""fiscal_week_id""
      ],
      ""relationship_description"": ""The 'Record Count by OS Level 5' is directly impacted by the filter on 'Fiscal Week ID'. Only records from specific fiscal weeks ('202548', '202549', '202550', '202551') are included in the count."",
      ""mathematical_formula"": ""COUNT(1) WHERE [fiscal_week_id filter applies]"",
      ""business_validation"": ""Ensures that the record count reflects activity within a specific, defined fiscal period."",
      ""validation_sql"": ""SELECT COUNT(CASE WHEN t0.fiscal_week_id IN ('202548', '202549', '202550', '202551') THEN 1 ELSE 0 END) AS filtered_count, COUNT(1) AS total_unfiltered_count FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement` AS t0 WHERE SAFE_CAST(SUBSTR(t0.fiscal_week_id, 1, 4) AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR));"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""data_load_datetime_truncated"",
      ""related_metrics"": [
        ""unified_publication_gl_code""
      ],
      ""relationship_description"": ""The 'Data Load Datetime (Truncated to Second)' dimension is filtered by 'Unified Publication GL Code'. Only data load events associated with specific GL codes ('9707', '9655', '9658') are displayed."",
      ""mathematical_formula"": ""DATETIME_TRUNC(data_load_datetime, SECOND) WHERE [unified_publication_gl_code filter applies]"",
      ""business_validation"": ""Focuses data load analysis on specific publication types or business units."",
      ""validation_sql"": ""SELECT COUNT(CASE WHEN t0.unified_publication_gl_code IN ('9707', '9655', '9658') THEN 1 ELSE 0 END) AS filtered_records, COUNT(1) AS total_unfiltered_records FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0 WHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,21
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a1b901e6-c4fb-44bc-955a-3d7070c15829"",
    ""dashboard_name"": ""Revenue Movement"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_date"",
      ""financial_year"",
      ""advertiser_group"",
      ""advertiser_parent"",
      ""portfolio_group_name_sync"",
      ""portfolio_parent_group_name_sync"",
      ""portfolio_conformed_name_sync"",
      ""revenue_type"",
      ""revenue_sub_type"",
      ""xtend_flag"",
      ""revenue_category""
    ],
    ""date_range_detected"": ""2025-05-29 to 2025-06-23"",
    ""hardcoded_dates_found"": [
      ""2025-05-29"",
      ""2025-06-23""
    ],
    ""hardcoded_values_found"": [
      ""2025"",
      ""CONSORTIUM SA"",
      ""DIRECT SA WA"",
      ""CONSORTIUM NSW"",
      ""QLD IA C2"",
      ""Y"",
      ""DIGITAL"",
      ""PRINT"",
      ""PRO"",
      ""SUNDRY"",
      ""DIGITAL OTHER"",
      ""Nah""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions."",
      ""Financial year should be parameterized or derived dynamically."",
      ""Portfolio group/conformed names should be managed via a reference table."",
      ""Revenue types/subtypes should be managed via a reference table."",
      ""Xtend flag values should be standardized or mapped from a reference table."",
      ""The 'Nah' replacement for NULL advertiser groups should be standardized (e.g., 'Unknown' from a lookup table).""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all identified metrics and dimensions from the dashboard's SQL queries.\n-- It applies all transformations and aggregations found, using a dynamic date range for broader analysis.\nWITH raw_data AS (\n  SELECT\n    t0.GROSS_AMOUNT_DIFF,\n    t0.advertiser_group,\n    t0.advertiser_parent,\n    t0.booking_line_id,\n    t0.booking_number,\n    t0.financial_short_month,\n    t0.financial_year,\n    t0.movement_date,\n    t0.portfolio_group_name_sync,\n    t0.portfolio_parent_group_name_sync,\n    t0.revenue_sub_type,\n    t0.revenue_type,\n    t0.xtend_flag,\n    t0.portfolio_conformed_name_sync -- Included from Query 3, assumed to be in base table\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  WHERE\n    SAFE_CAST(t0.movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 180 DAY) -- Dynamic date range for analysis\n    AND SAFE_CAST(t0.movement_date AS DATE) <= CURRENT_DATE()\n),\ntransformed_data AS (\n  SELECT\n    GROSS_AMOUNT_DIFF,\n    -- Derived Dimension: advertiser_group_cleaned (from clmn13_ / clmn7_ in original queries)\n    CASE WHEN (advertiser_group IS NULL) THEN 'Nah' ELSE advertiser_group END AS advertiser_group_cleaned,\n    advertiser_parent,\n    booking_line_id,\n    booking_number,\n    financial_short_month,\n    financial_year,\n    movement_date,\n    portfolio_group_name_sync,\n    portfolio_parent_group_name_sync,\n    revenue_sub_type,\n    revenue_type,\n    xtend_flag,\n    portfolio_conformed_name_sync,\n\n    -- Intermediate for parsed_financial_date (from clmn14_)\n    CONCAT(SAFE_CAST(financial_year AS STRING),'-',SAFE_CAST(financial_short_month AS STRING),'-1') AS financial_date_str,\n\n    -- Derived Boolean: is_digital_other (from clmn15_)\n    (portfolio_parent_group_name_sync = 'DIGITAL OTHER') AS is_digital_other,\n    -- Derived String: revenue_sub_type_prefix_6 (from clmn16_)\n    SAFE.LEFT(revenue_sub_type, 6) AS revenue_sub_type_prefix_6,\n    -- Derived String: revenue_sub_type_prefix_3 (from clmn17_)\n    SAFE.LEFT(revenue_sub_type, 3) AS revenue_sub_type_prefix_3,\n    -- Derived Boolean: is_digital_revenue_sub_type (from clmn18_)\n    (revenue_sub_type = 'DIGITAL') AS is_digital_revenue_sub_type,\n\n    -- Derived Metric: digital_gross_amount_diff (from clmn19_)\n    CASE WHEN (revenue_type = 'DIGITAL') THEN GROSS_AMOUNT_DIFF ELSE 0 END AS digital_gross_amount_diff,\n    -- Derived Metric: print_gross_amount_diff (from clmn20_)\n    CASE WHEN (revenue_type = 'PRINT') THEN GROSS_AMOUNT_DIFF ELSE 0 END AS print_gross_amount_diff\n  FROM raw_data\n),\nfinal_transformed_data AS (\n  SELECT\n    GROSS_AMOUNT_DIFF,\n    advertiser_group_cleaned,\n    advertiser_parent,\n    booking_line_id,\n    booking_number,\n    financial_short_month,\n    financial_year,\n    movement_date,\n    portfolio_group_name_sync,\n    portfolio_parent_group_name_sync,\n    revenue_sub_type,\n    revenue_type,\n    xtend_flag,\n    portfolio_conformed_name_sync,\n    digital_gross_amount_diff,\n    print_gross_amount_diff,\n\n    -- Derived Dimension: parsed_financial_date (from clmn21_)\n    PARSE_DATE('%Y-%b-%d', financial_date_str) AS parsed_financial_date,\n    -- Derived Boolean: is_pro_revenue_sub_type (from clmn22_)\n    (revenue_sub_type_prefix_3 = 'PRO') AS is_pro_revenue_sub_type,\n    -- Derived Boolean: is_digital_other_and_digital (from clmn23_)\n    (is_digital_other AND is_digital_revenue_sub_type) AS is_digital_other_and_digital,\n    -- Derived Dimension: revenue_category (from clmn24_)\n    CASE\n      WHEN (xtend_flag = 'Y') THEN 'XTEND'\n      WHEN (is_pro_revenue_sub_type OR is_digital_other_and_digital) THEN 'PROGRAMMATIC'\n      WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n      WHEN (revenue_sub_type_prefix_6 = 'SUNDRY') THEN 'SUNDRY'\n      ELSE revenue_sub_type\n    END AS revenue_category\n  FROM transformed_data\n)\nSELECT\n  SAFE_CAST(movement_date AS DATE) AS movement_date,\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  SAFE_CAST(financial_short_month AS STRING) AS financial_short_month,\n  advertiser_group_cleaned,\n  advertiser_parent,\n  booking_line_id,\n  booking_number,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  revenue_sub_type,\n  revenue_type,\n  xtend_flag,\n  portfolio_conformed_name_sync,\n  parsed_financial_date,\n  revenue_category,\n  SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) AS total_gross_amount_diff,\n  SUM(SAFE_CAST(digital_gross_amount_diff AS NUMERIC)) AS total_digital_gross_amount_diff,\n  SUM(SAFE_CAST(print_gross_amount_diff AS NUMERIC)) AS total_print_gross_amount_diff\nFROM final_transformed_data\nGROUP BY\n  movement_date,\n  financial_year,\n  financial_short_month,\n  advertiser_group_cleaned,\n  advertiser_parent,\n  booking_line_id,\n  booking_number,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  revenue_sub_type,\n  revenue_type,\n  xtend_flag,\n  portfolio_conformed_name_sync,\n  parsed_financial_date,\n  revenue_category\nORDER BY movement_date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(movement_date AS DATE)) as unique_movement_dates,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT advertiser_group) as unique_advertiser_groups,\n  COUNT(DISTINCT portfolio_parent_group_name_sync) as unique_portfolio_parent_groups,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  MIN(SAFE_CAST(movement_date AS DATE)) as earliest_movement_date,\n  MAX(SAFE_CAST(movement_date AS DATE)) as latest_movement_date,\n  APPROX_COUNT_DISTINCT(booking_line_id) as approx_unique_booking_line_ids\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present.\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_amount_diff_test,\n  CASE WHEN SUM(CASE WHEN revenue_type = 'DIGITAL' THEN SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as digital_revenue_test,\n  CASE WHEN MAX(SAFE_CAST(movement_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(DISTINCT portfolio_parent_group_name_sync) > 0 THEN 'PASS' ELSE 'FAIL' END as portfolio_group_presence_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, specifically the 'Revenue Category' derivation.\nWITH transformed_data AS (\n  SELECT\n    GROSS_AMOUNT_DIFF,\n    xtend_flag,\n    portfolio_parent_group_name_sync,\n    revenue_sub_type,\n    SAFE.LEFT(revenue_sub_type, 6) AS revenue_sub_type_prefix_6,\n    SAFE.LEFT(revenue_sub_type, 3) AS revenue_sub_type_prefix_3,\n    (portfolio_parent_group_name_sync = 'DIGITAL OTHER') AS is_digital_other,\n    (revenue_sub_type = 'DIGITAL') AS is_digital_revenue_sub_type,\n    (SAFE.LEFT(revenue_sub_type, 3) = 'PRO') AS is_pro_revenue_sub_type\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\n  WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Category Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN xtend_flag = 'Y' THEN 1 ELSE 0 END) as xtend_category_count,\n  SUM(CASE WHEN (is_pro_revenue_sub_type OR (is_digital_other AND is_digital_revenue_sub_type)) THEN 1 ELSE 0 END) as programmatic_category_count,\n  SUM(CASE WHEN revenue_sub_type = 'DIGITAL' AND NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR (is_digital_other AND is_digital_revenue_sub_type))) THEN 1 ELSE 0 END) as adpt_digital_category_count,\n  SUM(CASE WHEN revenue_sub_type_prefix_6 = 'SUNDRY' AND NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR (is_digital_other AND is_digital_revenue_sub_type)) OR revenue_sub_type = 'DIGITAL') THEN 1 ELSE 0 END) as sundry_category_count,\n  SUM(CASE WHEN NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR (is_digital_other AND is_digital_revenue_sub_type)) OR revenue_sub_type = 'DIGITAL' OR revenue_sub_type_prefix_6 = 'SUNDRY') THEN 1 ELSE 0 END) as other_category_count\nFROM transformed_data;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis, casting columns for safety.\nSELECT\n  SAFE_CAST(movement_date AS DATE) as movement_date,\n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(financial_short_month AS STRING) as financial_short_month,\n  advertiser_group,\n  advertiser_parent,\n  booking_line_id,\n  booking_number,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_sub_type,\n  revenue_type,\n  xtend_flag,\n  SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) as gross_amount_diff\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND GROSS_AMOUNT_DIFF IS NOT NULL\nORDER BY SAFE_CAST(movement_date AS DATE) DESC, SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-29"",
          ""original_format"": ""DATE '2025-05-29'"",
          ""context"": ""Used as a fixed date filter for movement_date in Query 1."",
          ""suggested_fix"": ""Replace with a dashboard date parameter or relative date function (e.g., CURRENT_DATE())."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""DATE '2025-06-23'"",
          ""context"": ""Used as a fixed date filter for movement_date in Query 2."",
          ""suggested_fix"": ""Replace with a dashboard date parameter or relative date function (e.g., CURRENT_DATE())."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'2025'""
          ],
          ""context"": ""Financial year filter in all queries."",
          ""suggested_governance"": ""Use a parameter for financial year or derive dynamically (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM SA'"",
            ""'DIRECT SA WA'"",
            ""'CONSORTIUM NSW'"",
            ""'QLD IA C2'""
          ],
          ""context"": ""Filters on portfolio_parent_group_name_sync and portfolio_conformed_name_sync."",
          ""suggested_governance"": ""Manage these values in a governed reference table (e.g., `dim_portfolio_groups`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Y'"",
            ""'DIGITAL'"",
            ""'PRINT'"",
            ""'PRO'"",
            ""'SUNDRY'"",
            ""'DIGITAL OTHER'""
          ],
          ""context"": ""Values used in CASE statements for 'Revenue Category' derivation and direct filters on `xtend_flag`, `revenue_type`, `revenue_sub_type`."",
          ""suggested_governance"": ""Define these business rules and categories in a configuration table or a dedicated business logic layer, rather than hardcoding in SQL."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""data_quality_handling"",
          ""hardcoded_values"": [
            ""'Nah'""
          ],
          ""context"": ""Replacement for NULL `advertiser_group` values."",
          ""suggested_governance"": ""Standardize NULL handling across the organization, potentially mapping to a generic 'Unknown' value from a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Replace hardcoded financial years with a parameter or `EXTRACT(YEAR FROM CURRENT_DATE())`."",
      ""Replace hardcoded lookup values for portfolio groups, revenue types, and flags with joins to governed reference tables."",
      ""Externalize complex business logic (like 'Revenue Category' derivation) into UDFs or a dedicated transformation layer if it becomes more complex or needs frequent updates.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_amount_diff"",
      ""metric_name"": ""Total Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the gross amount differences, representing the total revenue movement."",
      ""sql_logic"": ""SUM(GROSS_AMOUNT_DIFF)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for tracking revenue changes and performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls in GROSS_AMOUNT_DIFF if not handled upstream.""
      ]
    },
    {
      ""metric_id"": ""total_digital_gross_amount_diff"",
      ""metric_name"": ""Total Digital Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_gross_amount_diff"",
        ""revenue_type""
      ],
      ""business_description"": ""The sum of gross amount differences specifically for 'DIGITAL' revenue types."",
      ""sql_logic"": ""SUM(CASE WHEN revenue_type = 'DIGITAL' THEN GROSS_AMOUNT_DIFF ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the digital segment's contribution to revenue movement."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'DIGITAL' value for revenue_type should be from a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_print_gross_amount_diff"",
      ""metric_name"": ""Total Print Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_gross_amount_diff"",
        ""revenue_type""
      ],
      ""business_description"": ""The sum of gross amount differences specifically for 'PRINT' revenue types."",
      ""sql_logic"": ""SUM(CASE WHEN revenue_type = 'PRINT' THEN GROSS_AMOUNT_DIFF ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the print segment's contribution to revenue movement."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'PRINT' value for revenue_type should be from a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_category"",
      ""metric_name"": ""Revenue Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""business_description"": ""Categorization of revenue based on various flags and types (XTEND, PROGRAMMATIC, ADPT DIGITAL, SUNDRY, or original revenue_sub_type)."",
      ""sql_logic"": ""CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO') OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC' WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL' WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') THEN 'SUNDRY' ELSE revenue_sub_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level segmentation and analysis of revenue streams."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'"",
        ""'PRO'"",
        ""'DIGITAL OTHER'"",
        ""'DIGITAL'"",
        ""'PROGRAMMATIC'"",
        ""'ADPT DIGITAL'"",
        ""'SUNDRY'""
      ],
      ""governance_issues"": [
        ""All hardcoded category names and logic values should be managed in a business rule configuration table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_group_cleaned"",
      ""metric_name"": ""Advertiser Group (Cleaned)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""advertiser_group""
      ],
      ""business_description"": ""The advertiser group, with NULL values replaced by 'Nah'."",
      ""sql_logic"": ""CASE WHEN (advertiser_group IS NULL) THEN 'Nah' ELSE advertiser_group END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Standardized dimension for grouping by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Nah'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'Nah' for NULLs should be standardized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""parsed_financial_date"",
      ""metric_name"": ""Parsed Financial Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_short_month""
      ],
      ""business_description"": ""A date representation derived from financial year and short month, typically representing the first day of the month."",
      ""sql_logic"": ""PARSE_DATE('%Y-%b-%d', CONCAT(SAFE_CAST(financial_year AS STRING),'-',SAFE_CAST(financial_short_month AS STRING),'-1'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Used for financial period-based analysis, distinct from transaction date."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential parsing errors if financial_year or financial_short_month are malformed.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_digital_gross_amount_diff"",
      ""related_metrics"": [
        ""total_gross_amount_diff"",
        ""revenue_type""
      ],
      ""relationship_description"": ""Total Digital Gross Amount Difference is a subset of Total Gross Amount Difference, filtered by 'DIGITAL' revenue type."",
      ""mathematical_formula"": ""Total Digital Gross Amount Diff = SUM(GROSS_AMOUNT_DIFF WHERE revenue_type = 'DIGITAL')"",
      ""business_validation"": ""Ensures that digital revenue is correctly isolated for specific analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN revenue_type = 'DIGITAL' THEN SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) ELSE 0 END) AS digital_sum, SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) AS total_sum FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_print_gross_amount_diff"",
      ""related_metrics"": [
        ""total_gross_amount_diff"",
        ""revenue_type""
      ],
      ""relationship_description"": ""Total Print Gross Amount Difference is a subset of Total Gross Amount Difference, filtered by 'PRINT' revenue type."",
      ""mathematical_formula"": ""Total Print Gross Amount Diff = SUM(GROSS_AMOUNT_DIFF WHERE revenue_type = 'PRINT')"",
      ""business_validation"": ""Ensures that print revenue is correctly isolated for specific analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN revenue_type = 'PRINT' THEN SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) ELSE 0 END) AS print_sum, SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) AS total_sum FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_category"",
      ""related_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""relationship_description"": ""Revenue Category is a derived dimension based on a complex set of conditional rules involving multiple source columns."",
      ""mathematical_formula"": ""Categorical assignment based on nested CASE WHEN logic."",
      ""business_validation"": ""Ensures that revenue is classified according to predefined business rules for reporting and analysis."",
      ""validation_sql"": ""SELECT revenue_category, COUNT(*) AS record_count FROM (\n  SELECT\n    xtend_flag,\n    portfolio_parent_group_name_sync,\n    revenue_sub_type,\n    CASE\n      WHEN (xtend_flag = 'Y') THEN 'XTEND'\n      WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO') OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'\n      WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n      WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') THEN 'SUNDRY'\n      ELSE revenue_sub_type\n    END AS revenue_category\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\n  WHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n) GROUP BY revenue_category ORDER BY revenue_category;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,22
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f"",
    ""dashboard_name"": ""Pacing Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month;ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 3,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""CurrentMonthFlag"",
      ""FinancialMonthNumber"",
      ""FinancialYear"",
      ""Source"",
      ""StaticDays"",
      ""NumDays"",
      ""ProductType""
    ],
    ""date_range_detected"": ""Current period (indicated by CurrentMonthFlag = 1)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""1 (for CurrentMonthFlag)"",
      ""'Kargo' (for Source)"",
      ""'AdX' (for Source)""
    ],
    ""governance_opportunities"": [
      ""CurrentMonthFlag should be derived dynamically or parameterized"",
      ""Source values ('Kargo', 'AdX') should be managed in a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query identifies the distinct filter values presented to the user by the dashboard, along with their counts.\n-- It consolidates the output of the three provided Looker Studio filter queries.\nWITH FilterOptions_FinMonth AS (\n  SELECT\n    CONCAT(SAFE_CAST(t0.StaticDays AS STRING), CONCAT(' (', SAFE_CAST(((t0.FinancialYear * 100) + t0.FinancialMonthNumber) AS STRING)), ' )') AS financial_period_display_static_days,\n    CONCAT(SAFE_CAST(t0.NumDays AS STRING), CONCAT(' (', SAFE_CAST(((t0.FinancialYear * 100) + t0.FinancialMonthNumber) AS STRING)), ' )') AS financial_period_display_num_days,\n    t0.Source AS source_value,\n    t0.CurrentMonthFlag AS current_month_flag,\n    'programmatic_fin_month' AS source_table\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n),\nFilterOptions_CalMonth AS (\n  SELECT\n    t0.ProductType AS product_type_value,\n    'programmatic_cal_month' AS source_table\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\n)\nSELECT\n  'Financial Period Filter (Kargo)' AS filter_type,\n  fm.financial_period_display_static_days AS filter_value,\n  COUNT(*) AS distinct_value_count\nFROM FilterOptions_FinMonth AS fm\nWHERE fm.current_month_flag = 1 AND fm.source_value = 'Kargo'\nGROUP BY 1, 2\nUNION ALL\nSELECT\n  'Financial Period Filter (Non-AdX)' AS filter_type,\n  fm.financial_period_display_num_days AS filter_value,\n  COUNT(*) AS distinct_value_count\nFROM FilterOptions_FinMonth AS fm\nWHERE fm.current_month_flag = 1 AND (fm.source_value NOT IN ('AdX') OR fm.source_value IS NULL)\nGROUP BY 1, 2\nUNION ALL\nSELECT\n  'Product Type Filter' AS filter_type,\n  cm.product_type_value AS filter_value,\n  COUNT(*) AS distinct_value_count\nFROM FilterOptions_CalMonth AS cm\nGROUP BY 1, 2\nORDER BY filter_type, distinct_value_count DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'programmatic_fin_month' AS table_name,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialMonthNumber AS STRING)) AS unique_financial_periods,\n  COUNT(DISTINCT Source) AS unique_sources,\n  MIN(SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialMonthNumber AS STRING)) AS earliest_financial_period,\n  MAX(SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialMonthNumber AS STRING)) AS latest_financial_period\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nUNION ALL\nSELECT\n  'programmatic_cal_month' AS table_name,\n  COUNT(*) AS total_records,\n  NULL AS unique_financial_periods,\n  COUNT(DISTINCT ProductType) AS unique_product_types,\n  NULL AS earliest_financial_period,\n  NULL AS latest_financial_period\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\nLIMIT 100;"",
    ""validation_sql"": ""SELECT\n  'Validation Check - programmatic_fin_month' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_presence_test,\n  CASE WHEN SUM(CASE WHEN CurrentMonthFlag = 1 THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS current_month_flag_test,\n  CASE WHEN COUNT(DISTINCT Source) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_sources_test,\n  CASE WHEN MAX(FinancialYear) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_year_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nUNION ALL\nSELECT\n  'Validation Check - programmatic_cal_month' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_presence_test,\n  NULL AS current_month_flag_test,\n  CASE WHEN COUNT(DISTINCT ProductType) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_product_types_test,\n  NULL AS data_freshness_year_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'CurrentMonthFlag_Filter_Kargo' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN CurrentMonthFlag = 1 AND Source = 'Kargo' THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN CurrentMonthFlag = 1 AND Source = 'Kargo' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'CurrentMonthFlag_Filter_NonAdX' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  'programmatic_fin_month' AS source_table,\n  SAFE_CAST(CurrentMonthFlag AS STRING) AS current_month_flag,\n  SAFE_CAST(FinancialMonthNumber AS STRING) AS financial_month_number,\n  SAFE_CAST(FinancialYear AS STRING) AS financial_year,\n  Source AS source_dimension,\n  SAFE_CAST(StaticDays AS STRING) AS static_days,\n  SAFE_CAST(NumDays AS STRING) AS num_days,\n  NULL AS product_type\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Sample recent data\nLIMIT 250\nUNION ALL\nSELECT\n  'programmatic_cal_month' AS source_table,\n  NULL AS current_month_flag,\n  NULL AS financial_month_number,\n  NULL AS financial_year,\n  NULL AS source_dimension,\n  NULL AS static_days,\n  NULL AS num_days,\n  ProductType AS product_type\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\nLIMIT 250;"",
    ""hardcoded_issues"": [
      {
        ""date_value"": null,
        ""original_format"": null,
        ""context"": null,
        ""suggested_fix"": null,
        ""impact"": null,
        ""urgency"": null
      },
      {
        ""variable_type"": ""business_rules"",
        ""hardcoded_values"": [
          ""1""
        ],
        ""context"": ""CurrentMonthFlag = 1 used to filter for the current financial month"",
        ""suggested_governance"": ""derive from a date dimension table or use a dashboard parameter to allow dynamic selection of 'current' period"",
        ""impact"": ""medium"",
        ""maintenance_risk"": ""medium""
      },
      {
        ""variable_type"": ""lookup_codes"",
        ""hardcoded_values"": [
          ""'Kargo'""
        ],
        ""context"": ""Source IN ('Kargo') used to filter for a specific advertising source"",
        ""suggested_governance"": ""join to a governed 'source_master' lookup table or use a dashboard parameter for source selection"",
        ""impact"": ""high"",
        ""maintenance_risk"": ""high""
      },
      {
        ""variable_type"": ""lookup_codes"",
        ""hardcoded_values"": [
          ""'AdX'""
        ],
        ""context"": ""Source NOT IN ('AdX') used to exclude a specific advertising source"",
        ""suggested_governance"": ""join to a governed 'source_master' lookup table or use a dashboard parameter for source exclusion"",
        ""impact"": ""high"",
        ""maintenance_risk"": ""high""
      }
    ],
    ""parameterisation_recommendations"": [
      ""Replace hardcoded 'CurrentMonthFlag = 1' with a dynamic calculation based on CURRENT_DATE() and a date dimension table, or a dashboard parameter."",
      ""Replace hardcoded 'Source' values ('Kargo', 'AdX') with values from a governed reference table for Source dimensions, or allow user selection via dashboard parameters."",
      ""Consider creating a unified date dimension table to manage financial periods and current flags.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""current_month_flag"",
      ""metric_name"": ""Current Month Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag (0 or 1) indicating if a financial period is the current reporting month."",
      ""sql_logic"": ""t0.CurrentMonthFlag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used as a primary filter to focus dashboard views on the most recent financial period."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded '1' in filters should be parameterized or derived.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_number"",
      ""metric_name"": ""Financial Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The numerical representation of the financial month (e.g., 1 for July, 2 for August if financial year starts July)."",
      ""sql_logic"": ""t0.FinancialMonthNumber"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Part of the financial period definition, used in conjunction with FinancialYear."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the data."",
      ""sql_logic"": ""t0.FinancialYear"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Part of the financial period definition, used in conjunction with FinancialMonthNumber."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_dimension"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The advertising source or platform (e.g., 'Kargo', 'AdX')."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Source IN ('Kargo')"",
        ""Source NOT IN ('AdX') OR Source IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting advertising performance by platform."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Kargo'"",
        ""'AdX'""
      ],
      ""governance_issues"": [
        ""Hardcoded values should be managed in a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Potential NULL values for Source, handled by 'OR Source IS NULL' in one query.""
      ]
    },
    {
      ""metric_id"": ""static_days"",
      ""metric_name"": ""Static Days"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A static count of days, likely related to a financial period, used in a display string."",
      ""sql_logic"": ""t0.StaticDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for display purposes in the 'Financial Period (Kargo Display)' filter."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""num_days"",
      ""metric_name"": ""Number of Days"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The number of days, likely within a financial period, used in a display string."",
      ""sql_logic"": ""t0.NumDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for display purposes in the 'Financial Period (Non-AdX Display)' filter."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_type"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of advertising products (e.g., 'Display', 'Video')."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a filter dimension to segment data by product type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period_numeric"",
      ""metric_name"": ""Financial Period (Numeric)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""business_description"": ""A concatenated numeric representation of the financial year and month (e.g., 202307 for July 2023)."",
      ""sql_logic"": ""((FinancialYear * 100) + FinancialMonthNumber)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""An intermediate calculation used to create a unique identifier for each financial period, primarily for display purposes."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period_display_kargo"",
      ""metric_name"": ""Financial Period (Kargo Display)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""static_days"",
        ""financial_period_numeric"",
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""business_description"": ""A formatted string combining StaticDays and the numeric financial period, specifically for the 'Kargo' source filter."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(StaticDays AS STRING),CONCAT(' (',SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)),' )')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source = 'Kargo'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""This is a user-facing filter option in the dashboard, allowing selection of financial periods relevant to 'Kargo' advertising."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1 (for CurrentMonthFlag)"",
        ""'Kargo' (for Source)""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be parameterized or derived.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period_display_non_adx"",
      ""metric_name"": ""Financial Period (Non-AdX Display)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""num_days"",
        ""financial_period_numeric"",
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""business_description"": ""A formatted string combining NumDays and the numeric financial period, specifically for non-'AdX' sources."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(NumDays AS STRING),CONCAT(' (',SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)),' )')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source NOT IN ('AdX') OR Source IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""This is a user-facing filter option in the dashboard, allowing selection of financial periods relevant to advertising sources other than 'AdX'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1 (for CurrentMonthFlag)"",
        ""'AdX' (for Source)""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be parameterized or derived.""
      ],
      ""data_quality_concerns"": [
        ""Handles NULL values for Source explicitly.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_period_numeric"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""relationship_description"": ""Financial Period (Numeric) is calculated directly from Financial Year and Financial Month Number."",
      ""mathematical_formula"": ""Financial Period (Numeric) = (FinancialYear * 100) + FinancialMonthNumber"",
      ""business_validation"": ""Ensures a consistent numeric representation of each financial period."",
      ""validation_sql"": ""SELECT ((FinancialYear * 100) + FinancialMonthNumber) AS calculated_period, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_period_display_kargo"",
      ""related_metrics"": [
        ""static_days"",
        ""financial_period_numeric""
      ],
      ""relationship_description"": ""Financial Period (Kargo Display) is a string concatenation of Static Days and Financial Period (Numeric)."",
      ""mathematical_formula"": ""CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(FinancialPeriodNumeric AS STRING), ' )')"",
      ""business_validation"": ""Forms the user-friendly display for the Kargo filter."",
      ""validation_sql"": ""SELECT CONCAT(SAFE_CAST(StaticDays AS STRING), CONCAT(' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)), ' )') AS display_string, StaticDays, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE Source = 'Kargo' LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_period_display_non_adx"",
      ""related_metrics"": [
        ""num_days"",
        ""financial_period_numeric""
      ],
      ""relationship_description"": ""Financial Period (Non-AdX Display) is a string concatenation of Num Days and Financial Period (Numeric)."",
      ""mathematical_formula"": ""CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(FinancialPeriodNumeric AS STRING), ' )')"",
      ""business_validation"": ""Forms the user-friendly display for the Non-AdX filter."",
      ""validation_sql"": ""SELECT CONCAT(SAFE_CAST(NumDays AS STRING), CONCAT(' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING)), ' )') AS display_string, NumDays, FinancialYear, FinancialMonthNumber FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE (Source NOT IN ('AdX') OR Source IS NULL) LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""financial_period_display_kargo"",
      ""related_metrics"": [
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""relationship_description"": ""The 'Financial Period (Kargo Display)' filter is constrained by 'CurrentMonthFlag = 1' and 'Source = 'Kargo''."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the filter only shows relevant financial periods for the 'Kargo' source in the current month."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND Source = 'Kargo';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""financial_period_display_non_adx"",
      ""related_metrics"": [
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""relationship_description"": ""The 'Financial Period (Non-AdX Display)' filter is constrained by 'CurrentMonthFlag = 1' and 'Source NOT IN ('AdX') OR Source IS NULL'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the filter only shows relevant financial periods for non-'AdX' sources in the current month."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,23
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d8074b2-17a8-48ba-babe-c536359b1f64"",
    ""dashboard_name"": ""Final_Draft Adsales Performance Dashboard - FY25 20241127"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 21,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_short_month"",
      ""financial_quarter"",
      ""sales_segment_l_2_name_sync"",
      ""revenue_type"",
      ""xtend_flag"",
      ""relative_fy_month_offset"",
      ""relative_fy_year_offset"",
      ""advertiser_parent"",
      ""product_group"",
      ""unified_publication_name""
    ],
    ""date_range_detected"": ""FY24 to FY25 (anchored to 2025-01-06)"",
    ""hardcoded_dates_found"": [
      ""2025-01-06""
    ],
    ""hardcoded_values_found"": [
      ""'DOUBLECLICK'"",
      ""'N'"",
      ""0"",
      ""-1"",
      ""1"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""'Y'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterised or use relative date functions (e.g., CURRENT_DATE())."",
      ""Lookup values like 'DOUBLECLICK', 'DIGITAL', 'Digital Other', 'Y' should be sourced from governed reference tables."",
      ""Month mappings ('Jul' to '1.Jul') should be handled via a date dimension table or a configuration table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.DOW_Today,\n    t0.advertiser_parent,\n    SAFE_CAST(t0.booking_line_created_date AS DATE) AS booking_line_created_date,\n    SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n    t0.financial_short_month,\n    SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n    t0.fix_date_lod,\n    SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n    t0.is_future_period_flag,\n    SAFE_CAST(t0.pipeline AS NUMERIC) AS pipeline,\n    SAFE_CAST(t0.relative_fy_month_offset AS INT64) AS relative_fy_month_offset,\n    SAFE_CAST(t0.relative_fy_week_offset AS INT64) AS relative_fy_week_offset,\n    SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n    t0.revenue_group_subtype,\n    t0.revenue_type,\n    t0.sales_segment_l_2_name_sync,\n    SAFE_CAST(t0.ss_lgb AS NUMERIC) AS ss_lgb,\n    t0.xtend_flag,\n    DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS anchor_date_fy25,\n    DATE_SUB(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney'), INTERVAL 365 DAY) AS anchor_date_fy24\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Filter for recent data\n),\nderived_data AS (\n  SELECT\n    DOW_Today,\n    advertiser_parent,\n    booking_line_created_date,\n    financial_quarter,\n    financial_short_month,\n    financial_year,\n    fix_date_lod,\n    gross_revenue_amount,\n    is_future_period_flag,\n    pipeline,\n    relative_fy_month_offset,\n    relative_fy_week_offset,\n    relative_fy_year_offset,\n    revenue_group_subtype,\n    revenue_type,\n    sales_segment_l_2_name_sync,\n    ss_lgb,\n    xtend_flag,\n    anchor_date_fy25,\n    anchor_date_fy24,\n    -- Derived fields (clmnX_ equivalents)\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick,\n    SAFE_DIVIDE(gross_revenue_amount, 1000) AS gross_revenue_amount_k,\n    (is_future_period_flag = 'N') AS is_not_future_period,\n    (relative_fy_week_offset = 0) AS is_current_fy_week,\n    (relative_fy_week_offset < 0) AS is_past_fy_week,\n    (relative_fy_year_offset = 0) AS is_current_fy,\n    (relative_fy_year_offset = -1) AS is_previous_fy,\n    (relative_fy_year_offset = 1) AS is_next_fy,\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype,\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type,\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment_flag,\n    SAFE_DIVIDE((ss_lgb * DOW_Today), 7) AS ss_lgb_weekly_avg,\n    SAFE_DIVIDE(ss_lgb, 1000) AS ss_lgb_k,\n    CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_or_xtend_dim,\n    CASE WHEN (financial_short_month = 'Jul') THEN '1.Jul' WHEN (financial_short_month = 'Aug') THEN '2.Aug' WHEN (financial_short_month = 'Sep') THEN '3.Sep' WHEN (financial_short_month = 'Oct') THEN '4.Oct' WHEN (financial_short_month = 'Nov') THEN '5.Nov' WHEN (financial_short_month = 'Dec') THEN '6.Dec' WHEN (financial_short_month = 'Jan') THEN '7.Jan' WHEN (financial_short_month = 'Feb') THEN '8.Feb' WHEN (financial_short_month = 'Mar') THEN '9.Mar' WHEN (financial_short_month = 'Apr') THEN '10.Apr' WHEN (financial_short_month = 'May') THEN '11.May' WHEN (financial_short_month = 'Jun') THEN '12.Jun' ELSE NULL END AS financial_short_month_formatted\n  FROM base_data\n)\nSELECT\n  financial_year,\n  financial_short_month,\n  financial_short_month_formatted,\n  financial_quarter,\n  relative_fy_month_offset,\n  relative_fy_year_offset,\n  sales_segment_l_2_name_sync,\n  revenue_type_or_xtend_dim,\n  SUM(CASE WHEN is_current_fy AND is_current_fy_week THEN ss_lgb_weekly_avg ELSE 0 END) AS current_fy_current_week_forecasted_revenue,\n  MAX(is_digital_other_sales_segment_flag) AS is_digital_other_sales_segment,\n  SUM(CASE WHEN is_current_fy THEN gross_revenue_amount_k ELSE 0 END) AS current_fy_gross_revenue_k,\n  SUM(CASE WHEN is_current_fy THEN gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue,\n  SUM(CASE WHEN is_current_fy AND is_not_future_period THEN gross_revenue_amount_k ELSE 0 END) AS current_fy_non_future_gross_revenue_k,\n  MAX(relative_fy_month_offset) AS latest_fy_month_offset,\n  SUM(pipeline) AS total_pipeline,\n  SUM(CASE WHEN is_current_fy THEN ss_lgb_k ELSE 0 END) AS current_fy_ss_lgb_k,\n  SUM(CASE WHEN is_current_fy AND is_past_fy_week THEN ss_lgb ELSE 0 END) AS current_fy_past_week_ss_lgb,\n  MAX(relative_fy_year_offset) AS latest_fy_year_offset,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(CASE WHEN is_previous_fy THEN gross_revenue_amount ELSE 0 END) AS previous_fy_gross_revenue,\n  SUM(ss_lgb) AS total_ss_lgb,\n  SUM(CASE WHEN is_previous_fy AND (SAFE_CAST(CASE WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment_flag AND is_not_doubleclick) THEN fix_date_lod ELSE booking_line_created_date END AS DATETIME) <= SAFE_CAST(anchor_date_fy24 AS DATETIME)) THEN gross_revenue_amount ELSE 0 END) AS previous_fy_gross_revenue_filtered_by_date,\n  SUM(CASE WHEN is_next_fy THEN gross_revenue_amount_k ELSE 0 END) AS next_fy_gross_revenue_k,\n  SUM(CASE WHEN is_current_fy THEN gross_revenue_amount_k ELSE 0 END) - SUM(CASE WHEN is_current_fy THEN ss_lgb_k ELSE 0 END) AS current_fy_gross_revenue_minus_ss_lgb_k,\n  SUM(CASE WHEN is_previous_fy THEN gross_revenue_amount_k ELSE 0 END) AS previous_fy_gross_revenue_k,\n  SUM(CASE WHEN is_previous_fy AND (SAFE_CAST(CASE WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment_flag AND is_not_doubleclick) THEN fix_date_lod ELSE booking_line_created_date END AS DATETIME) <= SAFE_CAST(anchor_date_fy24 AS DATETIME)) THEN gross_revenue_amount_k ELSE 0 END) AS previous_fy_gross_revenue_filtered_by_date_k\nFROM derived_data\nGROUP BY\n  financial_year,\n  financial_short_month,\n  financial_short_month_formatted,\n  financial_quarter,\n  relative_fy_month_offset,\n  relative_fy_year_offset,\n  sales_segment_l_2_name_sync,\n  revenue_type_or_xtend_dim\nORDER BY financial_year DESC, financial_quarter DESC, financial_short_month_formatted DESC\nLIMIT 1000"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.booking_line_created_date AS DATE)) AS unique_booking_dates,\n  COUNT(DISTINCT t0.advertiser_parent) AS unique_advertiser_parents,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS INT64)) AS unique_financial_years,\n  MIN(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.booking_line_created_date, t0.advertiser_parent, t0.gross_revenue_amount)) AS approx_unique_records_combo\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.financial_year) >= 2 THEN 'PASS' ELSE 'FAIL' END AS multiple_fy_data_test,\n  CASE WHEN MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.relative_fy_year_offset AS INT64) = 0 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS current_fy_data_exists_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Financial Month Mapping Accuracy' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN t0.financial_short_month = 'Jul' AND (CASE WHEN (t0.financial_short_month = 'Jul') THEN '1.Jul' WHEN (t0.financial_short_month = 'Aug') THEN '2.Aug' WHEN (t0.financial_short_month = 'Sep') THEN '3.Sep' WHEN (t0.financial_short_month = 'Oct') THEN '4.Oct' WHEN (t0.financial_short_month = 'Nov') THEN '5.Nov' WHEN (t0.financial_short_month = 'Dec') THEN '6.Dec' WHEN (t0.financial_short_month = 'Jan') THEN '7.Jan' WHEN (t0.financial_short_month = 'Feb') THEN '8.Feb' WHEN (t0.financial_short_month = 'Mar') THEN '9.Mar' WHEN (t0.financial_short_month = 'Apr') THEN '10.Apr' WHEN (t0.financial_short_month = 'May') THEN '11.May' WHEN (t0.financial_short_month = 'Jun') THEN '12.Jun' ELSE NULL END) = '1.Jul' THEN 1 ELSE 0 END) AS jul_mapping_correct,\n  SUM(CASE WHEN t0.revenue_type = 'DIGITAL' AND t0.revenue_group_subtype = 'DIGITAL' AND t0.sales_segment_l_2_name_sync = 'Digital Other' AND t0.advertiser_parent != 'DOUBLECLICK' THEN 1 ELSE 0 END) AS digital_revenue_complex_filter_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.booking_line_created_date AS DATE) AS booking_date,\n  t0.advertiser_parent,\n  SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n  t0.financial_short_month,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  SAFE_CAST(t0.pipeline AS NUMERIC) AS pipeline,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n  t0.revenue_type,\n  t0.sales_segment_l_2_name_sync,\n  SAFE_CAST(t0.ss_lgb AS NUMERIC) AS ss_lgb,\n  t0.xtend_flag\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nORDER BY SAFE_CAST(t0.booking_line_created_date AS DATE) DESC\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-01-06"",
          ""original_format"": ""DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney')"",
          ""context"": ""Used as an anchor date for current FY calculations and previous FY comparisons (via -365 days). This date is fixed and will not update automatically."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter for the 'as-of' date."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'"",
            ""'N'"",
            ""'DIGITAL'"",
            ""'Digital Other'"",
            ""'Y'""
          ],
          ""context"": ""These string literals are used to filter or categorize data based on specific business rules (e.g., advertiser type, future flag, revenue type, sales segment, XTEND flag)."",
          ""suggested_governance"": ""Create and join to a small reference table for these categories, or define them as dashboard parameters/variables."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""-1"",
            ""1""
          ],
          ""context"": ""Numeric values representing relative financial year/week offsets (current, previous, next)."",
          ""suggested_governance"": ""While these are common offsets, consider defining them as named constants or parameters if the definition of 'current', 'previous', 'next' might change or need flexibility."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'"",
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'""
          ],
          ""context"": ""Month names used in a CASE statement to create a sorted month dimension ('1.Jul', '2.Aug', etc.)."",
          ""suggested_governance"": ""Implement a proper date dimension table that includes financial month names and their sort keys, then join to it. This avoids hardcoding and allows for flexible financial year starts."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace the hardcoded anchor date ('2025-01-06') with a Looker Studio date parameter (e.g., `_DS_LAST_REFRESH_DATE` or a user-defined date parameter) to ensure calculations are always relative to the current reporting period."",
      ""Externalize business logic values (e.g., 'DOUBLECLICK', 'DIGITAL', 'Y' for flags) into a small configuration table or Looker Studio parameters/fields. This allows for easier updates without modifying SQL."",
      ""For month sorting, consider a date dimension table in BigQuery that contains `financial_short_month` and its corresponding sort order. This is more robust than hardcoded CASE statements.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A high-level grouping or category for products, used for filtering and segmentation."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze performance across different product portfolios."",
      ""metric_category"": ""categorization"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The standardized name of the publication associated with the ad sales, used for filtering and segmentation."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of ad sales performance by specific publication or masthead."",
      ""metric_category"": ""categorization"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_current_week_forecasted_revenue"",
      ""metric_name"": ""Current FY Current Week Forecasted Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""ss_lgb"",
        ""DOW_Today"",
        ""relative_fy_year_offset"",
        ""relative_fy_week_offset""
      ],
      ""business_description"": ""The sum of `ss_lgb` (likely a booked or forecasted revenue metric) adjusted by `DOW_Today` and divided by 7, specifically for the current financial year and current financial week. Represents a weekly average or allocation."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 0 AND t0.relative_fy_week_offset = 0) THEN (t0.ss_lgb * t0.DOW_Today) / 7 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_week_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key performance indicator for real-time or near-real-time tracking of current week's revenue forecast."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""7""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on `DOW_Today` and `ss_lgb` data quality.""
      ]
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment"",
      ""metric_name"": ""Is Digital Other Sales Segment"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""A flag indicating if any record within the aggregated group belongs to the 'Digital Other' sales segment. (MAX of a boolean will be 1 if any are true)."",
      ""sql_logic"": ""MAX(t0.sales_segment_l_2_name_sync = 'Digital Other')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for filtering or highlighting data related to a specific sales segment."",
      ""metric_category"": ""categorization"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""Hardcoded string 'Digital Other' should be externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k"",
      ""metric_name"": ""Current FY Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue for the current financial year, expressed in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.gross_revenue_amount / 1000 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core revenue metric for the current financial year, often used for high-level reporting and comparisons."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue for the current financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary revenue metric for the current financial year, used for detailed financial analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_non_future_gross_revenue_k"",
      ""metric_name"": ""Current FY Non-Future Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""is_future_period_flag""
      ],
      ""business_description"": ""Total gross revenue for the current financial year, excluding any periods marked as 'future', expressed in thousands. This focuses on actual or past-due revenue."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (t0.relative_fy_year_offset = 0 AND t0.is_future_period_flag = 'N') THEN t0.gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""is_future_period_flag = 'N'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Important for understanding realized revenue, excluding forward-looking projections."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'N'"",
        ""1000""
      ],
      ""governance_issues"": [
        ""Hardcoded string 'N' should be externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""latest_fy_month_offset"",
      ""metric_name"": ""Latest Financial Year Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""relative_fy_month_offset""
      ],
      ""business_description"": ""The maximum `relative_fy_month_offset` observed within the aggregated data, indicating the latest month relative to the financial year start."",
      ""sql_logic"": ""MAX(t0.relative_fy_month_offset)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Useful for understanding the temporal scope of the data being analyzed, especially in dashboards that might show data up to the current period."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""pipeline""
      ],
      ""business_description"": ""The sum of all `pipeline` values, representing the total potential revenue in the sales pipeline."",
      ""sql_logic"": ""SUM(t0.pipeline)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A critical metric for sales forecasting and resource allocation, indicating future revenue potential."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_ss_lgb_k"",
      ""metric_name"": ""Current FY SS_LGB (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""ss_lgb"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total `ss_lgb` (Sales Segment Lookback Gross Booking) for the current financial year, expressed in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.ss_lgb / 1000 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the booked or recognized revenue specific to sales segments for the current year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_past_week_ss_lgb"",
      ""metric_name"": ""Current FY Past Week SS_LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""ss_lgb"",
        ""relative_fy_year_offset"",
        ""relative_fy_week_offset""
      ],
      ""business_description"": ""Total `ss_lgb` for the current financial year, specifically for financial weeks that have already passed (relative_fy_week_offset < 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 0 AND t0.relative_fy_week_offset < 0) THEN t0.ss_lgb ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_week_offset < 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track historical `ss_lgb` within the current financial year, providing a view of past performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""latest_fy_year_offset"",
      ""metric_name"": ""Latest Financial Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The maximum `relative_fy_year_offset` observed within the aggregated data, indicating the latest financial year relative to the current one."",
      ""sql_logic"": ""MAX(t0.relative_fy_year_offset)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides context on the range of financial years included in the analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""The sum of all `gross_revenue_amount` records, representing the total gross revenue across all periods in the dataset."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A foundational metric for overall revenue volume, often used as a base for other calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue for the previous financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = -1) THEN t0.gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for year-over-year performance comparisons and trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ss_lgb"",
      ""metric_name"": ""Total SS_LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""ss_lgb""
      ],
      ""business_description"": ""The sum of all `ss_lgb` values across all periods in the dataset."",
      ""sql_logic"": ""SUM(t0.ss_lgb)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides an overall volume of booked revenue related to sales segments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_filtered_by_date"",
      ""metric_name"": ""Previous FY Gross Revenue (Date Filtered)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync"",
        ""advertiser_parent"",
        ""fix_date_lod"",
        ""booking_line_created_date""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, subject to a complex date filter. The filter checks if a derived date (either `fix_date_lod` or `booking_line_created_date` based on several conditions) is less than or equal to the previous year's anchor date (2024-01-06)."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (t0.revenue_type = 'DIGITAL' AND t0.revenue_group_subtype = 'DIGITAL' AND t0.sales_segment_l_2_name_sync = 'Digital Other' AND t0.advertiser_parent != 'DOUBLECLICK') THEN t0.fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY))) THEN t0.gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""complex date condition based on '2025-01-06' and 'DIGITAL', 'Digital Other', 'DOUBLECLICK' criteria""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely used for a specific historical comparison or a 'like-for-like' analysis against a fixed prior period, potentially for digital revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-06""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded anchor date and categorical values make this calculation rigid and hard to maintain."",
        ""The complex nested CASE WHEN for date derivation should be simplified or pre-calculated.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the consistency of date formats and categorical values.""
      ]
    },
    {
      ""metric_id"": ""next_fy_gross_revenue_k"",
      ""metric_name"": ""Next FY Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue for the next financial year, expressed in thousands. This represents future booked or forecasted revenue."",
      ""sql_logic"": ""SUM(CASE WHEN (t0.relative_fy_year_offset = 1) THEN t0.gross_revenue_amount / 1000 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for long-term forecasting and strategic planning."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_minus_ss_lgb_k"",
      ""metric_name"": ""Current FY Gross Revenue - SS_LGB (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_ss_lgb_k""
      ],
      ""business_description"": ""The difference between Current FY Gross Revenue (in thousands) and Current FY SS_LGB (in thousands). This could represent a net revenue figure or a variance."",
      ""sql_logic"": ""SUM((CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.gross_revenue_amount / 1000 ELSE 0 END) - (CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.ss_lgb / 1000 ELSE 0 END))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a specific view of revenue after accounting for `ss_lgb`, potentially indicating a 'net' or 'adjusted' revenue figure for the current year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month_formatted"",
      ""metric_name"": ""Financial Short Month (Formatted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_short_month""
      ],
      ""business_description"": ""The financial month name (e.g., 'Jul') prefixed with a number (e.g., '1.Jul') to ensure correct chronological sorting in visualizations, assuming a July financial year start."",
      ""sql_logic"": ""CASE WHEN (t0.financial_short_month = 'Jul') THEN '1.Jul' WHEN (t0.financial_short_month = 'Aug') THEN '2.Aug' WHEN (t0.financial_short_month = 'Sep') THEN '3.Sep' WHEN (t0.financial_short_month = 'Oct') THEN '4.Oct' WHEN (t0.financial_short_month = 'Nov') THEN '5.Nov' WHEN (t0.financial_short_month = 'Dec') THEN '6.Dec' WHEN (t0.financial_short_month = 'Jan') THEN '7.Jan' WHEN (t0.financial_short_month = 'Feb') THEN '8.Feb' WHEN (t0.financial_short_month = 'Mar') THEN '9.Mar' WHEN (t0.financial_short_month = 'Apr') THEN '10.Apr' WHEN (t0.financial_short_month = 'May') THEN '11.May' WHEN (t0.financial_short_month = 'Jun') THEN '12.Jun' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for accurate time-series visualization and analysis of monthly trends."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jul'"",
        ""'Aug'"",
        ""'Sep'"",
        ""'Oct'"",
        ""'Nov'"",
        ""'Dec'"",
        ""'Jan'"",
        ""'Feb'"",
        ""'Mar'"",
        ""'Apr'"",
        ""'May'"",
        ""'Jun'""
      ],
      ""governance_issues"": [
        ""Hardcoded month mappings are inflexible; a date dimension table is recommended.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_or_xtend"",
      ""metric_name"": ""Revenue Type or XTEND"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_type""
      ],
      ""business_description"": ""Categorizes revenue as 'XTEND' if the `xtend_flag` is 'Y', otherwise uses the original `revenue_type`. This creates a consolidated revenue categorization."",
      ""sql_logic"": ""CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting revenue performance by a custom business classification."",
      ""metric_category"": ""categorization"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""Hardcoded string 'Y' and 'XTEND' should be externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_int"",
      ""metric_name"": ""Financial Quarter (Integer)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""safe_cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_quarter""
      ],
      ""business_description"": ""The financial quarter as an integer, derived by safely casting the original `financial_quarter` column."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_quarter AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping and analyzing data by financial quarter."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Jul', 'Aug')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing data by financial month."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the data."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A primary dimension for all financial reporting and year-over-year analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_month_offset"",
      ""metric_name"": ""Relative Financial Year Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The offset of the current month from the start of the financial year (e.g., 0 for the current month, -1 for the previous month)."",
      ""sql_logic"": ""t0.relative_fy_month_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for relative time-based analysis within a financial year."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset"",
      ""metric_name"": ""Relative Financial Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The offset of the current year from the current financial year (e.g., 0 for the current year, -1 for the previous year, 1 for the next year)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Fundamental for year-over-year comparisons and defining current/previous/next financial periods."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment L2 Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The synchronized name of the sales segment at level 2, used for detailed sales performance analysis."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for granular analysis of sales performance by specific sales segments."",
      ""metric_category"": ""categorization"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k"",
      ""metric_name"": ""Previous FY Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue for the previous financial year, expressed in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (t0.relative_fy_year_offset = -1) THEN t0.gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons of revenue, providing a scaled view."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_filtered_by_date_k"",
      ""metric_name"": ""Previous FY Gross Revenue (Date Filtered, Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""previous_fy_gross_revenue_filtered_by_date""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, subject to a complex date filter, expressed in thousands. This is a scaled version of 'previous_fy_gross_revenue_filtered_by_date'."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (t0.relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (t0.revenue_type = 'DIGITAL' AND t0.revenue_group_subtype = 'DIGITAL' AND t0.sales_segment_l_2_name_sync = 'Digital Other' AND t0.advertiser_parent != 'DOUBLECLICK') THEN t0.fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY))) THEN t0.gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""complex date condition based on '2025-01-06' and 'DIGITAL', 'Digital Other', 'DOUBLECLICK' criteria""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a scaled view of the date-filtered previous FY revenue, useful for specific comparative reports."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-06""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""1000"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Same governance issues as 'previous_fy_gross_revenue_filtered_by_date' regarding hardcoded dates and values.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_k"",
      ""related_metrics"": [
        ""current_fy_gross_revenue""
      ],
      ""relationship_description"": ""Current FY Gross Revenue (Thousands) is Current FY Gross Revenue divided by 1000."",
      ""mathematical_formula"": ""current_fy_gross_revenue_k = current_fy_gross_revenue / 1000"",
      ""business_validation"": ""Ensures consistency in reporting units (thousands vs. full amount)."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE_DIVIDE(current_fy_gross_revenue, 1000) = current_fy_gross_revenue_k THEN 1 ELSE 0 END) / COUNT(*) AS consistency_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_minus_ss_lgb_k"",
      ""related_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_ss_lgb_k""
      ],
      ""relationship_description"": ""Current FY Gross Revenue - SS_LGB (Thousands) is the difference between Current FY Gross Revenue (Thousands) and Current FY SS_LGB (Thousands)."",
      ""mathematical_formula"": ""current_fy_gross_revenue_minus_ss_lgb_k = current_fy_gross_revenue_k - current_fy_ss_lgb_k"",
      ""business_validation"": ""Represents a net or adjusted revenue figure, crucial for specific profitability or efficiency analyses."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN (current_fy_gross_revenue_k - current_fy_ss_lgb_k) = current_fy_gross_revenue_minus_ss_lgb_k THEN 1 ELSE 0 END) / COUNT(*) AS consistency_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""previous_fy_gross_revenue_filtered_by_date"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue""
      ],
      ""relationship_description"": ""The 'filtered by date' metric is a subset of the total previous FY gross revenue, applying a complex date and categorical filter. It's designed for a specific 'like-for-like' comparison."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_filtered_by_date <= previous_fy_gross_revenue"",
      ""business_validation"": ""Ensures that the filtered metric correctly represents a specific, comparable segment of the previous year's revenue, often for digital or specific booking types."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN previous_fy_gross_revenue_filtered_by_date <= previous_fy_gross_revenue THEN 1 ELSE 0 END) / COUNT(*) AS subset_validation_ratio FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""financial_year"",
      ""related_metrics"": [
        ""financial_quarter_int"",
        ""financial_short_month"",
        ""financial_short_month_formatted""
      ],
      ""relationship_description"": ""Financial Year is the highest level in the time hierarchy, containing Financial Quarters and Financial Months."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures proper drill-down and aggregation across time dimensions."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT financial_quarter_int) AS distinct_quarters_in_year, COUNT(DISTINCT financial_short_month) AS distinct_months_in_year FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE) GROUP BY financial_year LIMIT 10"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_short_month_formatted"",
      ""related_metrics"": [
        ""financial_short_month""
      ],
      ""relationship_description"": ""Financial Short Month (Formatted) is directly derived from Financial Short Month for sorting purposes."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures correct chronological ordering of months in reports."",
      ""validation_sql"": ""SELECT financial_short_month, financial_short_month_formatted, COUNT(*) FROM (YOUR_PRIMARY_ANALYSIS_SQL_HERE) GROUP BY 1,2 ORDER BY 2 LIMIT 12"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,24
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""61f1feb4-fc3e-4bee-b987-84c86cfe6425"",
    ""dashboard_name"": ""Digital - Publications and Products Monthly"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""revenue_group_subtype"",
      ""unified_publication_name"",
      ""revenue_type"",
      ""xtend_flag"",
      ""revenue_group_category"",
      ""transaction_date""
    ],
    ""date_range_detected"": ""Financial Years 2024-2025"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'2024'"",
      ""'2025'"",
      ""'DIGITAL'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'Y'"",
      ""'XTEND'"",
      ""'PRINT'"",
      ""'digital'""
    ],
    ""governance_opportunities"": [
      ""financial years should be parameterised or derived from a date dimension table"",
      ""revenue group subtypes and types should use governed lookup tables"",
      ""XTEND flag logic could be externalized into a view or governed dimension""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.revenue_group_subtype,\n    t0.unified_publication_name,\n    t0.revenue_type,\n    t0.xtend_flag,\n    t0.dw_asl_load_timestamp,\n    -- Assumed columns for a \""Publications and Products Monthly\"" dashboard\n    SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount,\n    SAFE_CAST(t0.ad_impressions AS INT64) AS ad_impressions,\n    SAFE_CAST(t0.transaction_date AS DATE) AS transaction_date\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025')\n),\ncalculated_dimensions AS (\n  SELECT\n    financial_year,\n    revenue_group_subtype,\n    unified_publication_name,\n    revenue_amount,\n    ad_impressions,\n    transaction_date,\n    dw_asl_load_timestamp,\n    -- Calculated dimension: revenue_type_adjusted_for_xtend\n    CASE\n      WHEN (xtend_flag = 'Y') THEN 'XTEND'\n      ELSE revenue_type\n    END AS revenue_type_adjusted_for_xtend\n  FROM base_data\n),\nfinal_dimensions AS (\n  SELECT\n    financial_year,\n    revenue_group_subtype,\n    unified_publication_name,\n    revenue_amount,\n    ad_impressions,\n    transaction_date,\n    dw_asl_load_timestamp,\n    -- Calculated dimension: revenue_group_category\n    CASE\n      WHEN (revenue_type_adjusted_for_xtend = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)'\n      WHEN (revenue_type_adjusted_for_xtend = 'PRINT') THEN 'PRINT'\n      WHEN (revenue_type_adjusted_for_xtend = 'XTEND') THEN 'XTEND ONLY'\n      ELSE NULL\n    END AS revenue_group_category\n  FROM calculated_dimensions\n)\nSELECT\n  financial_year,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_group_category,\n  DATETIME_TRUNC(SAFE_CAST(transaction_date AS DATETIME), MONTH) AS month_start_date,\n  SUM(revenue_amount) AS total_revenue,\n  SUM(ad_impressions) AS total_ad_impressions,\n  MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) AS min_load_timestamp\nFROM final_dimensions\nWHERE\n  -- Apply filter from query 1\n  revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')\n  -- Apply filter from query 2, assuming case-insensitive match for 'digital' to 'DIGITAL (excl.XTEND)'\n  AND LOWER(revenue_group_category) = 'digital (excl.xtend)'\nGROUP BY\n  financial_year,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_group_category,\n  month_start_date\nORDER BY\n  financial_year DESC,\n  month_start_date DESC,\n  unified_publication_name\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT t0.unified_publication_name) as unique_publications,\n  COUNT(DISTINCT t0.revenue_group_subtype) as unique_revenue_subtypes,\n  COUNT(DISTINCT t0.revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT t0.xtend_flag) as unique_xtend_flags,\n  MIN(SAFE_CAST(t0.dw_asl_load_timestamp AS TIMESTAMP)) as earliest_load_timestamp,\n  MAX(SAFE_CAST(t0.dw_asl_load_timestamp AS TIMESTAMP)) as latest_load_timestamp,\n  MIN(SAFE_CAST(t0.transaction_date AS DATE)) as earliest_transaction_date, -- Assumed\n  MAX(SAFE_CAST(t0.transaction_date AS DATE)) as latest_transaction_date,   -- Assumed\n  APPROX_COUNT_DISTINCT(t0.dw_asl_load_timestamp) as approx_unique_load_timestamps\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025') -- Apply relevant filters for context\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test, -- Assumed\n  CASE WHEN COUNT(DISTINCT t0.unified_publication_name) > 0 THEN 'PASS' ELSE 'FAIL' END as publication_data_test,\n  CASE WHEN MAX(SAFE_CAST(t0.dw_asl_load_timestamp AS TIMESTAMP)) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 1 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_filter_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025')\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.revenue_type,\n    t0.xtend_flag\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025')\n),\ncalculated_dimensions AS (\n  SELECT\n    financial_year,\n    revenue_type,\n    xtend_flag,\n    CASE\n      WHEN (xtend_flag = 'Y') THEN 'XTEND'\n      ELSE revenue_type\n    END AS revenue_type_adjusted_for_xtend\n  FROM base_data\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'XTEND_revenue_type_logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN xtend_flag = 'Y' AND revenue_type_adjusted_for_xtend = 'XTEND' THEN 1 ELSE 0 END) as xtend_flag_correctly_applied,\n  SUM(CASE WHEN xtend_flag != 'Y' AND revenue_type_adjusted_for_xtend = revenue_type THEN 1 ELSE 0 END) as non_xtend_flag_correctly_applied,\n  SAFE_DIVIDE(\n    SUM(CASE WHEN xtend_flag = 'Y' AND revenue_type_adjusted_for_xtend = 'XTEND' THEN 1 ELSE 0 END) +\n    SUM(CASE WHEN xtend_flag != 'Y' AND revenue_type_adjusted_for_xtend = revenue_type THEN 1 ELSE 0 END),\n    COUNT(*)\n  ) * 100 as logic_pass_rate_percentage\nFROM calculated_dimensions\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(t0.financial_year AS STRING) as financial_year,\n  t0.revenue_group_subtype,\n  t0.unified_publication_name,\n  t0.revenue_type,\n  t0.xtend_flag,\n  SAFE_CAST(t0.dw_asl_load_timestamp AS TIMESTAMP) as dw_asl_load_timestamp,\n  SAFE_CAST(t0.revenue_amount AS NUMERIC) as revenue_amount, -- Assumed\n  SAFE_CAST(t0.ad_impressions AS INT64) as ad_impressions,   -- Assumed\n  SAFE_CAST(t0.transaction_date AS DATE) as transaction_date -- Assumed\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) IN ('2024', '2025')\nORDER BY SAFE_CAST(t0.dw_asl_load_timestamp AS TIMESTAMP) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'2024'"",
            ""'2025'""
          ],
          ""context"": ""financial years used in WHERE clause"",
          ""suggested_governance"": ""parameterize or derive from a date dimension table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DIGITAL'"",
            ""'PROGRAMMATIC EXCHANGE'"",
            ""'PROGRAMMATIC SOURCE'""
          ],
          ""context"": ""revenue group subtypes used in WHERE clause"",
          ""suggested_governance"": ""join to a `dim_revenue_subtype` lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Y'"",
            ""'XTEND'"",
            ""'DIGITAL'"",
            ""'PRINT'""
          ],
          ""context"": ""logic for `revenue_type_adjusted_for_xtend` and `revenue_group_category`"",
          ""suggested_governance"": ""externalize logic into a governed view or configuration table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'digital'""
          ],
          ""context"": ""filter value for `revenue_group_category`"",
          ""suggested_governance"": ""use a parameter or join to a `dim_revenue_category` lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with date parameters or relative date functions (e.g., `CURRENT_FINANCIAL_YEAR()`)"",
      ""Replace hardcoded lookup values for revenue subtypes and categories with joins to governed reference tables"",
      ""Use configuration tables for business rules (like XTEND logic) instead of hardcoded CASE statements""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the ad sales performance record."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2024', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a primary time-based filter and grouping dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2024'"",
        ""'2025'""
      ],
      ""governance_issues"": [
        ""financial years should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Granular classification of revenue groups, e.g., DIGITAL, PRINT, PROGRAMMATIC EXCHANGE, PROGRAMMATIC SOURCE."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize ad sales by their underlying business model or channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""publication"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The standardized name of the publication (e.g., newspaper, magazine) associated with the ad sale."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for analyzing ad sales performance across different publications."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_adjusted_for_xtend"",
      ""metric_name"": ""Revenue Type (Adjusted for XTEND)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""business_description"": ""Categorizes revenue type, specifically identifying 'XTEND' based on a flag, otherwise using the original revenue type. This is an intermediate step for further categorization."",
      ""sql_logic"": ""CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting revenue that falls under the 'XTEND' program from other revenue types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""XTEND flag logic could be externalized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_category"",
      ""metric_name"": ""Revenue Group Category"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_type_adjusted_for_xtend""
      ],
      ""business_description"": ""Further categorizes revenue groups, specifically separating 'DIGITAL' into 'DIGITAL (excl.XTEND)' and identifying 'PRINT' and 'XTEND ONLY'."",
      ""sql_logic"": ""CASE WHEN (revenue_type_adjusted_for_xtend = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)' WHEN (revenue_type_adjusted_for_xtend = 'PRINT') THEN 'PRINT' WHEN (revenue_type_adjusted_for_xtend = 'XTEND') THEN 'XTEND ONLY' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""LOWER(revenue_group_category) = 'digital (excl.xtend)'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A high-level categorization used for dashboard filtering and reporting, providing a consolidated view of revenue types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'PRINT'"",
        ""'XTEND'"",
        ""'DIGITAL (excl.XTEND)'"",
        ""'XTEND ONLY'"",
        ""'digital'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dw_asl_load_timestamp_min"",
      ""metric_name"": ""Minimum Data Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""dashboard_level"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The earliest timestamp when data was loaded into the ad sales performance table, indicating data freshness or the start of the data available for the dashboard."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Primarily for data quality and operational monitoring, ensuring the dashboard data is up-to-date."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""data freshness dependent""
      ]
    },
    {
      ""metric_id"": ""revenue_amount"",
      ""metric_name"": ""Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The monetary value of the ad sale. This is an assumed core metric for a financial dashboard."",
      ""sql_logic"": ""t0.revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary financial performance indicator for ad sales, used to track income."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""outliers expected""
      ]
    },
    {
      ""metric_id"": ""ad_impressions"",
      ""metric_name"": ""Ad Impressions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The number of times an ad was displayed. This is an assumed volume metric for an ad sales dashboard."",
      ""sql_logic"": ""t0.ad_impressions"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the volume and reach of ad campaigns, often alongside revenue."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""transaction_date"",
      ""metric_name"": ""Transaction Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date on which the ad sales transaction occurred. Assumed for monthly aggregation."",
      ""sql_logic"": ""t0.transaction_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Essential for time-series analysis and grouping data by month, as indicated by the dashboard name."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw revenue type classification from the source system."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as an input for the `revenue_type_adjusted_for_xtend` calculation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""xtend_flag"",
      ""metric_name"": ""XTEND Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag indicating if the revenue record is associated with the XTEND program ('Y' or 'N')."",
      ""sql_logic"": ""t0.xtend_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as an input for the `revenue_type_adjusted_for_xtend` calculation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dw_asl_load_timestamp"",
      ""metric_name"": ""Data Warehouse Load Timestamp"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""timestamp"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp when the individual record was loaded into the data warehouse."",
      ""sql_logic"": ""t0.dw_asl_load_timestamp"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""timestamp"",
      ""business_context"": ""Used to derive data freshness metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_type_adjusted_for_xtend"",
      ""related_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""relationship_description"": ""`revenue_type_adjusted_for_xtend` is derived from `revenue_type` and `xtend_flag`. If `xtend_flag` is 'Y', it becomes 'XTEND', otherwise it retains its original `revenue_type`."",
      ""mathematical_formula"": ""IF xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type"",
      ""business_validation"": ""Ensures that XTEND-related revenue is correctly identified and separated from other revenue types for specific reporting needs."",
      ""validation_sql"": ""SELECT COUNTIF(CASE WHEN xtend_flag = 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN TRUE WHEN xtend_flag != 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = revenue_type THEN TRUE ELSE FALSE END) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_group_category"",
      ""related_metrics"": [
        ""revenue_type_adjusted_for_xtend""
      ],
      ""relationship_description"": ""`revenue_group_category` is derived from `revenue_type_adjusted_for_xtend` by mapping specific values to broader categories like 'DIGITAL (excl.XTEND)', 'PRINT', and 'XTEND ONLY'."",
      ""mathematical_formula"": ""IF revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ELSE IF revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' ELSE IF revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL"",
      ""business_validation"": ""Provides a high-level, business-friendly categorization of revenue streams, essential for dashboard filtering and summary views."",
      ""validation_sql"": ""SELECT COUNTIF(CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'DIGITAL (excl.XTEND)' THEN TRUE WHEN revenue_type_adjusted_for_xtend = 'PRINT' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'PRINT' THEN TRUE WHEN revenue_type_adjusted_for_xtend = 'XTEND' AND (CASE WHEN revenue_type_adjusted_for_xtend = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_adjusted_for_xtend = 'PRINT' THEN 'PRINT' WHEN revenue_type_adjusted_for_xtend = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'XTEND ONLY' THEN TRUE ELSE FALSE END) / COUNT(*) FROM (SELECT *, CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_adjusted_for_xtend FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025'))"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""financial_year"",
      ""related_metrics"": [
        ""revenue_amount"",
        ""ad_impressions"",
        ""unified_publication_name"",
        ""revenue_group_subtype"",
        ""revenue_group_category""
      ],
      ""relationship_description"": ""The dashboard queries are explicitly filtered by `financial_year` ('2024', '2025'), limiting all displayed metrics and dimensions to these specific periods."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the dashboard focuses on the most relevant and current financial periods for analysis, aligning with business planning cycles."",
      ""validation_sql"": ""SELECT COUNTIF(financial_year IN ('2024', '2025')) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""revenue_group_subtype"",
      ""related_metrics"": [
        ""revenue_amount"",
        ""ad_impressions"",
        ""unified_publication_name"",
        ""revenue_group_category""
      ],
      ""relationship_description"": ""Metrics are filtered to include only specific `revenue_group_subtype` values: 'DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Focuses the dashboard on key digital and programmatic revenue channels, excluding other types like print, which might be covered in other reports."",
      ""validation_sql"": ""SELECT COUNTIF(revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')) / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""revenue_group_category"",
      ""related_metrics"": [
        ""revenue_amount"",
        ""ad_impressions"",
        ""unified_publication_name"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""Metrics are further filtered by `revenue_group_category` to include only 'DIGITAL (excl.XTEND)' (based on the original query's 'digital' filter)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Narrows the scope to specific digital revenue categories, which is critical for a dashboard titled 'Digital - Publications and Products Monthly'."",
      ""validation_sql"": ""SELECT COUNTIF(LOWER(CASE WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) = 'digital (excl.xtend)') / COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025')"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,25
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b1c5901f-a535-42eb-870d-05cc025f7c27"",
    ""dashboard_name"": ""OS extract for month end rec"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_week_of_year"",
      ""gl_hierarchy_code"",
      ""os_level_4"",
      ""is_print_digital_flag"",
      ""l12_publication_code"",
      ""publication_name"",
      ""os_level_5"",
      ""os_level_6"",
      ""os_level_7"",
      ""os_level_9"",
      ""l03_publication_code"",
      ""fy_year""
    ],
    ""date_range_detected"": ""Fiscal Year 2025, Fiscal Week 40"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'FY2025'"",
      ""40"",
      ""'Total Revenue'"",
      ""'Total Expenses'"",
      ""'News Media Publishing'"",
      ""'Circulation'"",
      ""'Subscription'"",
      ""'Content Licensing'"",
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""Fiscal year and week should be parameterized or derived from a dynamic period control table."",
      ""OS level categories (e.g., 'Total Revenue', 'Circulation') should be sourced from governed lookup tables."",
      ""Publication codes (e.g., 'News Media Publishing') should join to a publication dimension table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates the core metrics and dimensions from the dashboard's underlying queries.\n-- It applies the most common filters observed across the queries to represent the dashboard's typical scope.\n-- All non-aggregated columns are included in the GROUP BY clause.\n-- SAFE_CAST is used for robust type handling.\n\nWITH OSandFACT AS (\n    SELECT\n        os.source_system_name,\n        os.sub_source_system_name,\n        SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n        os.gl_publication_code,\n        os.day_of_week,\n        os.state,\n        os.os_level_1,\n        os.os_level_2,\n        os.os_level_3,\n        os.os_level_4,\n        os.os_level_5,\n        os.os_level_6,\n        os.os_level_7,\n        os.os_level_8,\n        os.os_level_9,\n        os.os_level_10,\n        os.os_level_11,\n        os.os_level_12,\n        SAFE_CAST(os.Estimate AS NUMERIC) AS Estimate,\n        SAFE_CAST(os.True_Up_Adjustment AS NUMERIC) AS True_Up_Adjustment,\n        SAFE_CAST(os.Actual_Amount AS NUMERIC) AS Actual_Amount,\n        SAFE_CAST(os.volume AS NUMERIC) AS volume,\n        SAFE_CAST(os.Last_Year_Actual_Amount AS NUMERIC) AS Last_Year_Actual_Amount,\n        SAFE_CAST(os.Last_Year_volume AS NUMERIC) AS Last_Year_volume,\n        SAFE_CAST(os.Budget_Draft_Amount AS NUMERIC) AS Budget_Draft_Amount,\n        SAFE_CAST(os.Budget_Draft_Volume AS NUMERIC) AS Budget_Draft_Volume,\n        SAFE_CAST(os.Budget_Amount AS NUMERIC) AS Budget_Amount,\n        SAFE_CAST(os.Budget_Volume AS NUMERIC) AS Budget_Volume,\n        SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS Forecast_Amount,\n        SAFE_CAST(os.Forecast_Volume AS NUMERIC) AS Forecast_Volume,\n        SAFE_CAST(os.Budget_Jan_Amount AS NUMERIC) AS Budget_Jan_Amount,\n        SAFE_CAST(os.Budget_Jan_Volume AS NUMERIC) AS Budget_Jan_Volume,\n        SAFE_CAST(os.Budget_Feb_Amount AS NUMERIC) AS Budget_Feb_Amount,\n        SAFE_CAST(os.Budget_Feb_Volume AS NUMERIC) AS Budget_Feb_Volume,\n        SAFE_CAST(os.Budget_Mar_Amount AS NUMERIC) AS Budget_Mar_Amount,\n        SAFE_CAST(os.Budget_Mar_Volume AS NUMERIC) AS Budget_Mar_Volume,\n        SAFE_CAST(os.Budget_Apr_Amount AS NUMERIC) AS Budget_Apr_Amount,\n        SAFE_CAST(os.Budget_Apr_Volume AS NUMERIC) AS Budget_Apr_Volume,\n        SAFE_CAST(os.Budget_May_Amount AS NUMERIC) AS Budget_May_Amount,\n        SAFE_CAST(os.Budget_May_Volume AS NUMERIC) AS Budget_May_Volume,\n        SAFE_CAST(os.Budget_Jun_Amount AS NUMERIC) AS Budget_Jun_Amount,\n        SAFE_CAST(os.Budget_Jun_Volume AS NUMERIC) AS Budget_Jun_Volume,\n        SAFE_CAST(os.Budget_Jul_Amount AS NUMERIC) AS Budget_Jul_Amount,\n        SAFE_CAST(os.Budget_Jul_Volume AS NUMERIC) AS Budget_Jul_Volume,\n        SAFE_CAST(os.Budget_Aug_Amount AS NUMERIC) AS Budget_Aug_Amount,\n        SAFE_CAST(os.Budget_Aug_Volume AS NUMERIC) AS Budget_Aug_Volume,\n        SAFE_CAST(os.Budget_Sep_Amount AS NUMERIC) AS Budget_Sep_Amount,\n        SAFE_CAST(os.Budget_Sep_Volume AS NUMERIC) AS Budget_Sep_Volume,\n        SAFE_CAST(os.Budget_Oct_Amount AS NUMERIC) AS Budget_Oct_Amount,\n        SAFE_CAST(os.Budget_Oct_Volume AS NUMERIC) AS Budget_Oct_Volume,\n        SAFE_CAST(os.Budget_Nov_Amount AS NUMERIC) AS Budget_Nov_Amount,\n        SAFE_CAST(os.Budget_Nov_Volume AS NUMERIC) AS Budget_Nov_Volume,\n        SAFE_CAST(os.Budget_Dec_Amount AS NUMERIC) AS Budget_Dec_Amount,\n        SAFE_CAST(os.Budget_Dec_Volume AS NUMERIC) AS Budget_Dec_Volume,\n        SAFE_CAST(os.Forecast_Q1F_Amount AS NUMERIC) AS Forecast_Q1F_Amount,\n        SAFE_CAST(os.Forecast_Q1F_Volume AS NUMERIC) AS Forecast_Q1F_Volume,\n        SAFE_CAST(os.Forecast_Q2F_Amount AS NUMERIC) AS Forecast_Q2F_Amount,\n        SAFE_CAST(os.Forecast_Q2F_Volume AS NUMERIC) AS Forecast_Q2F_Volume,\n        SAFE_CAST(os.Forecast_Q3F_Amount AS NUMERIC) AS Forecast_Q3F_Amount,\n        SAFE_CAST(os.Forecast_Q3F_Volume AS NUMERIC) AS Forecast_Q3F_Volume,\n        SAFE_CAST(os.Forecast_Q4F_Amount AS NUMERIC) AS Forecast_Q4F_Amount,\n        SAFE_CAST(os.Forecast_Q4F_Volume AS NUMERIC) AS Forecast_Q4F_Volume,\n        SAFE_CAST(os.Forecast_Q5F_Amount AS NUMERIC) AS Forecast_Q5F_Amount,\n        SAFE_CAST(os.Forecast_Q5F_Volume AS NUMERIC) AS Forecast_Q5F_Volume,\n        pub.l03_publication_code,\n        pub.l12_publication_code,\n        calendar.fy_week_of_year,\n        calendar.fy_year_week_number,\n        calendar.fy_first_day_of_week,\n        calendar.fy_last_day_of_week,\n        calendar.fy_month_of_year,\n        calendar.fy_year_month_number,\n        calendar.relative_fisc_year_number,\n        calendar.relative_fisc_week_number,\n        calendar.fy_month_of_year_short_name,\n        calendar.month_end_flag,\n        calendar.fy_quarter_of_year,\n        calendar.fy_year,\n        dep.department_code,\n        os.gl_hierarchy_code AS gl_hierarchy_code_from_os, -- Renamed to avoid conflict with calendar.fy_year\n        os.is_print_digital_flag,\n        os.publication_name\n    FROM\n        `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN\n        `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN\n        (\n            SELECT DISTINCT\n                SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n                SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n                SAFE_CAST(c.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n                SAFE_CAST(c.fy_last_day_of_week AS DATE) AS fy_last_day_of_week,\n                SAFE_CAST(c.fy_month_of_year AS INT64) AS fy_month_of_year,\n                SAFE_CAST(c.fy_year_month_number AS INT64) AS fy_year_month_number,\n                SAFE_CAST(c.relative_fisc_year_number AS INT64) AS relative_fisc_year_number,\n                SAFE_CAST(c.relative_fisc_week_number AS INT64) AS relative_fisc_week_number,\n                c.fy_month_of_year_short_name,\n                CASE\n                    WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y'\n                    ELSE 'N'\n                END AS month_end_flag,\n                SAFE_CAST(c.fy_quarter_of_year AS INT64) AS fy_quarter_of_year,\n                SAFE_CAST(c.fy_year AS INT64) AS fy_year\n            FROM\n                `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n            JOIN\n                `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n                ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')\n        ) AS calendar\n        ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    LEFT JOIN\n        `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department` AS dep\n        ON os.os_level_12 = dep.department_code\n)\nSELECT\n    fy_week_of_year,\n    gl_hierarchy_code_from_os AS gl_hierarchy_code,\n    is_print_digital_flag,\n    l12_publication_code,\n    os_level_4,\n    os_level_5,\n    os_level_6,\n    os_level_7,\n    os_level_9,\n    publication_name,\n    l03_publication_code,\n    fy_year,\n    SUM(Actual_Amount) AS total_actual_amount,\n    SUM(Budget_Amount) AS total_budget_amount,\n    SUM(Forecast_Amount) AS total_forecast_amount\nFROM\n    OSandFACT\nWHERE\n    gl_hierarchy_code_from_os = 'FY2025' -- Common filter across queries\n    AND fy_week_of_year = 40 -- Common filter across queries\n    AND os_level_4 IN ('Total Revenue', 'Total Expenses') -- Common filter across queries\nGROUP BY\n    fy_week_of_year,\n    gl_hierarchy_code_from_os,\n    is_print_digital_flag,\n    l12_publication_code,\n    os_level_4,\n    os_level_5,\n    os_level_6,\n    os_level_7,\n    os_level_9,\n    publication_name,\n    l03_publication_code,\n    fy_year\nORDER BY\n    fy_year DESC, fy_week_of_year DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS INT64)) as unique_fiscal_weeks,\n  COUNT(DISTINCT SAFE_CAST(gl_publication_code AS STRING)) as unique_gl_publication_codes,\n  COUNT(DISTINCT SAFE_CAST(os_level_4 AS STRING)) as unique_os_level_4_categories,\n  MIN(SAFE_CAST(fiscal_week_id AS INT64)) as earliest_fiscal_week_id,\n  MAX(SAFE_CAST(fiscal_week_id AS INT64)) as latest_fiscal_week_id,\n  SUM(CASE WHEN Actual_Amount IS NULL THEN 1 ELSE 0 END) as null_actual_amount_count,\n  SUM(CASE WHEN Budget_Amount IS NULL THEN 1 ELSE 0 END) as null_budget_amount_count,\n  SUM(CASE WHEN Forecast_Amount IS NULL THEN 1 ELSE 0 END) as null_forecast_amount_count\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000 -- Sample recent data\nLIMIT 1;\n"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_positive_test,\n  CASE WHEN SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_amount_positive_test,\n  CASE WHEN SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as forecast_amount_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(gl_hierarchy_code AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as gl_hierarchy_code_present_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(fy_week_of_year AS INT64)) > 0 THEN 'PASS' ELSE 'FAIL' END as fy_week_of_year_present_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(os_level_4 AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as os_level_4_present_test\nFROM\n  (\n    SELECT\n      t0.Actual_Amount,\n      t0.Budget_Amount,\n      t0.Forecast_Amount,\n      t0.gl_hierarchy_code,\n      calendar.fy_week_of_year,\n      t0.os_level_4\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0\n    LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n        JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n      ON SAFE_CAST(t0.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    WHERE\n      SAFE_CAST(t0.fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000 -- Sample recent data\n  )\nLIMIT 1;\n"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Fiscal Year and Week Consistency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END) as records_matching_dashboard_filters,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END), COUNT(*)) * 100 as match_rate_percentage\nFROM\n  (\n    SELECT\n      t0.gl_hierarchy_code,\n      calendar.fy_week_of_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0\n    LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n        JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n      ON SAFE_CAST(t0.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    WHERE\n      SAFE_CAST(t0.fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000 -- Sample recent data\n  )\nLIMIT 1;\n"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n  os.gl_publication_code,\n  os.os_level_4,\n  os.os_level_5,\n  os.os_level_6,\n  os.os_level_7,\n  os.os_level_9,\n  os.gl_hierarchy_code,\n  os.is_print_digital_flag,\n  pub.l03_publication_code,\n  pub.l12_publication_code,\n  os.publication_name,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) AS Actual_Amount,\n  SAFE_CAST(os.Budget_Amount AS NUMERIC) AS Budget_Amount,\n  SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS Forecast_Amount,\n  SAFE_CAST(calendar.fy_week_of_year AS INT64) AS fy_week_of_year,\n  SAFE_CAST(calendar.fy_year AS INT64) AS fy_year\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\nLEFT JOIN\n  `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n  ON os.gl_publication_code = pub.publication_code\nLEFT JOIN\n  (\n    SELECT DISTINCT\n      SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n      SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n      SAFE_CAST(c.fy_year AS INT64) AS fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n    JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n      ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')\n  ) AS calendar\n  ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(os.fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000 -- Sample recent data\nORDER BY\n  SAFE_CAST(os.fiscal_week_id AS INT64) DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY2025'""
          ],
          ""context"": ""Fiscal year filter applied to gl_hierarchy_code."",
          ""suggested_governance"": ""Replace with a dynamic fiscal year parameter or derive from a period control table based on current date."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""40""
          ],
          ""context"": ""Fiscal week filter applied to fy_week_of_year."",
          ""suggested_governance"": ""Replace with a dynamic fiscal week parameter or derive from a period control table based on current date."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Total Revenue'"",
            ""'Total Expenses'""
          ],
          ""context"": ""OS Level 4 categories filtered."",
          ""suggested_governance"": ""Join to a `dim_os_level_4` lookup table or use a parameter for category selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'News Media Publishing'""
          ],
          ""context"": ""L03 Publication Code filtered."",
          ""suggested_governance"": ""Join to a `dim_publication_hierarchy` table and filter by publication key."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Circulation'"",
            ""'Subscription'"",
            ""'Content Licensing'""
          ],
          ""context"": ""OS Level 6 categories filtered."",
          ""suggested_governance"": ""Join to a `dim_os_level_6` lookup table or use a parameter for category selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""Period names used in `v_asl_DIM_period_control` join."",
          ""suggested_governance"": ""These are likely standard, but if period definitions change, they should be managed via a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year ('FY2025') and fiscal week (40) with dashboard parameters or dynamic calculations based on `CURRENT_DATE()` and the fiscal calendar."",
      ""Replace hardcoded category values (e.g., 'Total Revenue', 'Circulation') with joins to dedicated dimension/lookup tables to ensure data integrity and flexibility."",
      ""Implement a robust period control mechanism that dynamically determines 'CP' (Current Period) and 'PY' (Prior Year) based on the current fiscal date, rather than relying on static values in the `v_asl_DIM_period_control` table if its content is not dynamically updated.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""actual_amount_sum"",
      ""metric_name"": ""Sum of Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total actual financial amount recorded for a given period and set of dimensions. This represents the real-world financial performance."",
      ""sql_logic"": ""SUM(SAFE_CAST(Actual_Amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing' (in some contexts)"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing') (in some contexts)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for tracking actual revenue and expenses against budget and forecast, crucial for month-end reconciliation."",
      ""metric_category"": ""revenue|cost"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in Actual_Amount column if not all transactions have values."",
        ""Data freshness dependent on `v_asl_FCT_finance_os_aggregated` update frequency.""
      ]
    },
    {
      ""metric_id"": ""budget_amount_sum"",
      ""metric_name"": ""Sum of Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total budgeted financial amount for a given period and set of dimensions. This represents the planned financial performance."",
      ""sql_logic"": ""SUM(SAFE_CAST(Budget_Amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing' (in some contexts)"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing') (in some contexts)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for variance analysis against actuals and forecasts to assess financial planning accuracy and performance against targets."",
      ""metric_category"": ""revenue|cost"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in Budget_Amount column."",
        ""Accuracy dependent on budget data input processes.""
      ]
    },
    {
      ""metric_id"": ""forecast_amount_sum"",
      ""metric_name"": ""Sum of Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total forecasted financial amount for a given period and set of dimensions. This represents the projected financial performance based on current trends and expectations."",
      ""sql_logic"": ""SUM(SAFE_CAST(Forecast_Amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing' (in some contexts)"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing') (in some contexts)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for re-forecasting and comparing against actuals and budget to understand deviations and adjust future plans."",
      ""metric_category"": ""revenue|cost"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in Forecast_Amount column."",
        ""Accuracy dependent on forecasting methodology and input data.""
      ]
    },
    {
      ""metric_id"": ""fiscal_week_of_year"",
      ""metric_name"": ""Fiscal Week of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year, derived from the calendar dimension."",
      ""sql_logic"": ""fy_week_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for weekly financial reporting and analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_year_hierarchy_code"",
      ""metric_name"": ""Fiscal Year Hierarchy Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A code representing the fiscal year, typically used for filtering and grouping financial data."",
      ""sql_logic"": ""gl_hierarchy_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for filtering data by fiscal year."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded fiscal year value should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_print_digital_flag"",
      ""metric_name"": ""Print/Digital Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Indicates whether the financial amount relates to print or digital operations."",
      ""sql_logic"": ""is_print_digital_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for analysis of financial performance across different media platforms."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""l12_publication_code"",
      ""metric_name"": ""L12 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific level 12 publication code from the publication hierarchy, representing a granular publication entity."",
      ""sql_logic"": ""l12_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for detailed reporting and analysis at the individual publication level."",
      ""metric_category"": ""organizational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_4"",
      ""metric_name"": ""OS Level 4 Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 4 category, typically representing high-level financial classifications like 'Total Revenue' or 'Total Expenses'."",
      ""sql_logic"": ""os_level_4"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting financial data into major revenue and expense buckets."",
      ""metric_category"": ""financial_classification"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Total Revenue'"",
        ""'Total Expenses'""
      ],
      ""governance_issues"": [
        ""Hardcoded category values should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5"",
      ""metric_name"": ""OS Level 5 Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 5 category, providing a more granular financial classification than OS Level 4."",
      ""sql_logic"": ""os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for deeper dives into specific revenue or expense streams."",
      ""metric_category"": ""financial_classification"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_6"",
      ""metric_name"": ""OS Level 6 Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 6 category, offering further granularity in financial classification, e.g., 'Circulation', 'Subscription'."",
      ""sql_logic"": ""os_level_6"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of specific revenue or cost drivers within broader categories."",
      ""metric_category"": ""financial_classification"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""Hardcoded category values should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_7"",
      ""metric_name"": ""OS Level 7 Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 7 category, providing the most granular financial classification."",
      ""sql_logic"": ""os_level_7"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for highly detailed financial reporting and specific operational insights."",
      ""metric_category"": ""financial_classification"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_9"",
      ""metric_name"": ""OS Level 9 Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 9 category, another granular financial classification."",
      ""sql_logic"": ""os_level_9"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides additional detail for financial analysis."",
      ""metric_category"": ""financial_classification"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The human-readable name of the publication associated with the financial data."",
      ""sql_logic"": ""publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for reporting and analysis by specific publication titles."",
      ""metric_category"": ""organizational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""l03_publication_code"",
      ""metric_name"": ""L03 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific level 3 publication code from the publication hierarchy, representing a broader grouping of publications (e.g., 'News Media Publishing')."",
      ""sql_logic"": ""l03_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level reporting and analysis across major publication categories."",
      ""metric_category"": ""organizational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'News Media Publishing'""
      ],
      ""governance_issues"": [
        ""Hardcoded publication category should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The full fiscal year number, derived from the calendar dimension."",
      ""sql_logic"": ""fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for yearly financial reporting and analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""actual_amount_sum"",
      ""related_metrics"": [
        ""budget_amount_sum"",
        ""forecast_amount_sum""
      ],
      ""relationship_description"": ""Actual Amount is compared against Budget Amount and Forecast Amount to calculate variances and assess performance."",
      ""mathematical_formula"": ""Variance_vs_Budget = Actual_Amount - Budget_Amount; Variance_vs_Forecast = Actual_Amount - Forecast_Amount"",
      ""business_validation"": ""These variances are critical for financial performance review, identifying deviations from plans, and informing future financial strategies."",
      ""validation_sql"": ""SELECT\n  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) AS total_actual,\n  SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS total_budget,\n  SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS total_forecast,\n  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS variance_actual_budget,\n  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS variance_actual_forecast\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""actual_amount_sum"",
      ""related_metrics"": [
        ""fiscal_year_hierarchy_code"",
        ""fiscal_week_of_year"",
        ""os_level_4"",
        ""l03_publication_code"",
        ""os_level_6""
      ],
      ""relationship_description"": ""All financial metrics (Actual, Budget, Forecast) are heavily filtered by specific fiscal periods and OS/publication categories, indicating a focused reporting scope."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""The dashboard is designed to provide a 'month-end reconciliation' view for specific, pre-defined financial segments and time periods. Changes to these filters would significantly alter the reported figures."",
      ""validation_sql"": ""SELECT\n  COUNT(*) AS total_records,\n  SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' THEN 1 ELSE 0 END) AS records_fy2025,\n  SUM(CASE WHEN SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END) AS records_week40,\n  SUM(CASE WHEN SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) AS records_revenue_expenses\nFROM\n  (\n    SELECT\n      t0.gl_hierarchy_code,\n      calendar.fy_week_of_year,\n      t0.os_level_4\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0\n    LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n        JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64) AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n      ON SAFE_CAST(t0.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    WHERE\n      SAFE_CAST(t0.fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`) - 500000\n  )\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,26
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""87651b69-c43e-471f-9c4b-98df1208a844"",
    ""dashboard_name"": ""Programmatic Sales Patches"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""sales|advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""Source"",
      ""TransactionType"",
      ""Month Start Date""
    ],
    ""date_range_detected"": ""Specific date: 2025-06-01 (hardcoded)"",
    ""hardcoded_dates_found"": [
      ""2025-06-01""
    ],
    ""hardcoded_values_found"": [
      ""'Guaranteed'"",
      ""'Chemist Warehouse *'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions"",
      ""Advertiser names and Transaction Types should be managed via governed reference tables instead of hardcoded values""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.Source AS source_dimension,\n    t0.Advertiser AS advertiser_dimension,\n    t0.TransactionType AS transaction_type_dimension,\n    SAFE_CAST(t0.PaidImpressions AS NUMERIC) AS paid_impressions,\n    SAFE_CAST(t0.RevenueGross AS NUMERIC) AS revenue_gross,\n    SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS month_start_date_dimension\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\n  -- Apply a general date filter for analysis, not the specific hardcoded one from the dashboard\n  WHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\n)\nSELECT\n  month_start_date_dimension,\n  source_dimension,\n  advertiser_dimension,\n  transaction_type_dimension,\n  SUM(paid_impressions) AS total_paid_impressions,\n  SUM(revenue_gross) AS total_revenue_gross,\n  COUNT(*) AS record_count\nFROM base_data\nGROUP BY\n  month_start_date_dimension,\n  source_dimension,\n  advertiser_dimension,\n  transaction_type_dimension\nORDER BY\n  month_start_date_dimension DESC,\n  advertiser_dimension ASC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE)) as unique_month_start_dates,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT Source) as unique_sources,\n  COUNT(DISTINCT TransactionType) as unique_transaction_types,\n  MIN(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE)) as earliest_date,\n  MAX(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE)) as latest_date,\n  SUM(CASE WHEN PaidImpressions IS NULL THEN 1 ELSE 0 END) as null_paid_impressions_count,\n  SUM(CASE WHEN RevenueGross IS NULL THEN 1 ELSE 0 END) as null_revenue_gross_count\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\nWHERE SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(RevenueGross AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_test,\n  CASE WHEN SUM(SAFE_CAST(PaidImpressions AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as impressions_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_test,\n  CASE WHEN MAX(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\nWHERE SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS month_start_date,\n    Advertiser,\n    TransactionType,\n    PaidImpressions,\n    RevenueGross\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`\n  WHERE SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Guaranteed Transaction Type Filter' as rule_name,\n  COUNT(*) as total_records_in_period,\n  SUM(CASE WHEN TransactionType = 'Guaranteed' THEN 1 ELSE 0 END) as records_matching_guaranteed_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN TransactionType = 'Guaranteed' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_guaranteed,\n  'Chemist Warehouse Advertiser Filter' as rule_name_2,\n  SUM(CASE WHEN Advertiser = 'Chemist Warehouse *' THEN 1 ELSE 0 END) as records_matching_chemist_warehouse_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN Advertiser = 'Chemist Warehouse *' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_chemist_warehouse,\n  'Specific Date Filter (2025-06-01)' as rule_name_3,\n  SUM(CASE WHEN month_start_date = DATE '2025-06-01' THEN 1 ELSE 0 END) as records_matching_specific_date_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN month_start_date = DATE '2025-06-01' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_specific_date\nFROM base_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.Source AS source_dimension,\n  t0.Advertiser AS advertiser_dimension,\n  t0.TransactionType AS transaction_type_dimension,\n  SAFE_CAST(t0.PaidImpressions AS NUMERIC) AS paid_impressions,\n  SAFE_CAST(t0.RevenueGross AS NUMERIC) AS revenue_gross,\n  SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS month_start_date_dimension,\n  t0.CalendarMonth,\n  t0.CalendarYear\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\nORDER BY month_start_date_dimension DESC, t0.RevenueGross DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-01"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""used as a specific filter for 'Month Start Date'"",
          ""suggested_fix"": ""replace with a Looker Studio date parameter or relative date function (e.g., CURRENT_DATE())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Guaranteed'""
          ],
          ""context"": ""TransactionType filter in one query"",
          ""suggested_governance"": ""use a Looker Studio parameter or join to a `transaction_type_master` reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Chemist Warehouse *'""
          ],
          ""context"": ""Advertiser filter in one query"",
          ""suggested_governance"": ""use a Looker Studio parameter or join to an `advertiser_master` reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 MONTH)`)."",
      ""Replace hardcoded lookup values for 'Advertiser' and 'TransactionType' with joins to governed reference tables or Looker Studio parameters for user selection."",
      ""Consider creating a configuration table for common business rules/filters to centralize management.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""source_dimension"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_reference"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The source of the programmatic advertising campaign."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter or group data by advertising source, providing insights into channel performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_dimension"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_reference"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The advertiser associated with the programmatic sales."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""Advertiser = 'Chemist Warehouse *'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing sales performance by client, crucial for client-specific reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type_dimension"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_reference"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of advertising transaction (e.g., Guaranteed, Non-Guaranteed)."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment sales data by transaction type, important for understanding different revenue streams."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""month_start_date_dimension"",
      ""metric_name"": ""Month Start Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the calendar month for the transaction, derived from CalendarYear and CalendarMonth."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""Month Start Date = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for monthly reporting, enabling trend analysis over time."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_paid_impressions"",
      ""metric_name"": ""Total Paid Impressions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of paid impressions delivered for programmatic advertising campaigns."",
      ""sql_logic"": ""SUM(t0.PaidImpressions)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'"",
        ""Advertiser = 'Chemist Warehouse *'"",
        ""Month Start Date = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key volume metric for programmatic sales performance, indicating campaign reach and delivery."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls if PaidImpressions is not always populated""
      ]
    },
    {
      ""metric_id"": ""total_revenue_gross"",
      ""metric_name"": ""Total Revenue Gross"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue generated from programmatic advertising campaigns."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'"",
        ""Advertiser = 'Chemist Warehouse *'"",
        ""Month Start Date = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary financial metric for programmatic sales performance, directly reflecting income."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls if RevenueGross is not always populated""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""co_occurrence"",
      ""primary_metric"": ""total_paid_impressions"",
      ""related_metrics"": [
        ""total_revenue_gross"",
        ""advertiser_dimension"",
        ""month_start_date_dimension"",
        ""source_dimension"",
        ""transaction_type_dimension""
      ],
      ""relationship_description"": ""Total Paid Impressions and Total Revenue Gross are frequently analyzed together, often alongside Advertiser, Source, Transaction Type, and Month Start Date, to understand campaign effectiveness and financial performance."",
      ""mathematical_formula"": ""N/A (no explicit formula in queries, but common business ratios like RPM (Revenue Per Mille Impressions) could be derived)"",
      ""business_validation"": ""These metrics are fundamental for evaluating the success and profitability of programmatic advertising efforts. Analyzing them together helps identify high-performing advertisers, sources, and transaction types."",
      ""validation_sql"": ""SELECT month_start_date_dimension, advertiser_dimension, SUM(total_paid_impressions) AS total_impressions, SUM(total_revenue_gross) AS total_revenue FROM ( /* primary_analysis_sql content */ ) GROUP BY 1,2 HAVING SUM(total_paid_impressions) > 0 AND SUM(total_revenue_gross) > 0 LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,27
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f65a9149-93b4-4aa9-aef6-d12002853222"",
    ""dashboard_name"": ""Digital Video Content Audio"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""sales_segment_l_2_name_sync"",
      ""booking_number"",
      ""adsize_name"",
      ""fin_adtype_name"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""financial_year""
    ],
    ""date_range_detected"": ""2025 to 2026"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""2026""
    ],
    ""hardcoded_values_found"": [
      ""'Booked'"",
      ""'Billed'"",
      ""'Medium Rare Content Agency'"",
      ""'Audio (Targeted)'"",
      ""'Audio (Non-Targeted)'"",
      ""'Events (Non-Targeted)'"",
      ""'Events (Targeted)'"",
      ""'Rich Media (Non-Targeted)'"",
      ""'Rich Media (Targeted)'"",
      ""'Social Display (Targeted)'"",
      ""'Social Display (Non-Targeted)'"",
      ""'Standard Display (Targeted)'"",
      ""'Standard Display (Non-Targeted)'"",
      ""'TTIV (Targeted)'"",
      ""'TTIV (Non-Targeted)'"",
      ""'Content Discovery (Non-Targeted)'"",
      ""'Content Discovery (Targeted)'"",
      ""'Native (Non-Targeted)'"",
      ""'Native (Targeted)'""
    ],
    ""governance_opportunities"": [
      ""Financial years should be dynamic/parameterized"",
      ""Ad type names should use a lookup table"",
      ""Transaction statuses should use a lookup table"",
      ""Publishing divisions should use a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_filtered_data AS (\n  SELECT\n    t0.fin_adtype_name,\n    t0.revenue_transaction_status,\n    t0.sales_segment_l_2_name_sync,\n    t0.source_publishing_division,\n    t0.booking_number,\n    t0.financial_year,\n    t0.adsize_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Booked', 'Billed')\n    AND (SAFE_CAST(t0.source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND SAFE_CAST(t0.financial_year AS STRING) IN ('2025', '2026') -- Filter for relevant years\n)\nSELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year_dimension,\n  COUNT(*) AS total_records_in_filtered_scope,\n  COUNT(DISTINCT\n    CASE\n      WHEN SAFE_CAST(fin_adtype_name AS STRING) IN (\n        'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n        'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n        'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)'\n      )\n      THEN SAFE_CAST(sales_segment_l_2_name_sync AS STRING)\n    END\n  ) AS distinct_sales_segments_q1_scope,\n  COUNT(DISTINCT\n    CASE\n      WHEN SAFE_CAST(fin_adtype_name AS STRING) IN (\n        'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n      )\n      AND SAFE_CAST(financial_year AS STRING) IN ('2026', '2025')\n      THEN SAFE_CAST(booking_number AS STRING)\n    END\n  ) AS distinct_booking_numbers_q2_scope,\n  COUNT(DISTINCT\n    CASE\n      WHEN SAFE_CAST(fin_adtype_name AS STRING) IN (\n        'Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)',\n        'Native (Non-Targeted)', 'Native (Targeted)',\n        'Rich Media (Non-Targeted)', 'Rich Media (Targeted)',\n        'Social Display (Non-Targeted)', 'Social Display (Targeted)',\n        'Standard Display (Non-Targeted)', 'Standard Display (Targeted)',\n        'TTIV (Targeted)', 'TTIV (Non-Targeted)'\n      )\n      AND SAFE_CAST(financial_year AS STRING) = '2025'\n      THEN SAFE_CAST(adsize_name AS STRING)\n    END\n  ) AS distinct_ad_sizes_q3_scope\nFROM\n  base_filtered_data\nGROUP BY\n  financial_year_dimension\nORDER BY\n  financial_year_dimension DESC\nLIMIT 100"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(fin_adtype_name AS STRING)) as unique_ad_types,\n  COUNT(DISTINCT SAFE_CAST(revenue_transaction_status AS STRING)) as unique_transaction_statuses,\n  COUNT(DISTINCT SAFE_CAST(source_publishing_division AS STRING)) as unique_publishing_divisions,\n  COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) as unique_sales_segments,\n  COUNT(DISTINCT SAFE_CAST(booking_number AS STRING)) as unique_booking_numbers,\n  COUNT(DISTINCT SAFE_CAST(adsize_name AS STRING)) as unique_ad_sizes,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) >= SAFE_CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 2 AS STRING)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as records_exist_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) >= 2 THEN 'PASS' ELSE 'FAIL' END as multiple_financial_years_test,\n  CASE WHEN COUNT(DISTINCT CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as booked_billed_status_test,\n  CASE WHEN COUNT(DISTINCT CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IS NOT NULL THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as ad_type_data_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Common Filter Application Rate' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_booked_billed,\n  SUM(CASE WHEN (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_not_medium_rare,\n  SUM(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_common_filters,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as common_filters_pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(fin_adtype_name AS STRING) as fin_adtype_name,\n  SAFE_CAST(revenue_transaction_status AS STRING) as revenue_transaction_status,\n  SAFE_CAST(source_publishing_division AS STRING) as source_publishing_division,\n  SAFE_CAST(sales_segment_l_2_name_sync AS STRING) as sales_segment_l_2_name_sync,\n  SAFE_CAST(booking_number AS STRING) as booking_number,\n  SAFE_CAST(adsize_name AS STRING) as adsize_name\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nORDER BY financial_year DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2026"",
          ""original_format"": ""STRING"",
          ""context"": ""Used as a specific financial year filter in query 2."",
          ""suggested_fix"": ""Replace with a dynamic calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) + 1` for next financial year) or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""STRING"",
          ""context"": ""Used as a specific financial year filter in query 2 and query 3."",
          ""suggested_fix"": ""Replace with a dynamic calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` for current financial year) or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""Transaction statuses used as a filter."",
          ""suggested_governance"": ""Join to a `transaction_status_lookup` table or use a configuration table for valid statuses."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Specific publishing division excluded from results."",
          ""suggested_governance"": ""Join to a `publishing_division_lookup` table with an 'is_excluded' flag, or use a configuration table for excluded divisions."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Audio (Targeted)'"",
            ""'Audio (Non-Targeted)'"",
            ""'Events (Non-Targeted)'"",
            ""'Events (Targeted)'"",
            ""'Rich Media (Non-Targeted)'"",
            ""'Rich Media (Targeted)'"",
            ""'Social Display (Targeted)'"",
            ""'Social Display (Non-Targeted)'"",
            ""'Standard Display (Targeted)'"",
            ""'Standard Display (Non-Targeted)'"",
            ""'TTIV (Targeted)'"",
            ""'TTIV (Non-Targeted)'"",
            ""'Content Discovery (Non-Targeted)'"",
            ""'Content Discovery (Targeted)'"",
            ""'Native (Non-Targeted)'"",
            ""'Native (Targeted)'""
          ],
          ""context"": ""Specific ad type names used as filters across multiple queries."",
          ""suggested_governance"": ""Create a `fin_adtype_name_lookup` table with categories and join to it, or use a configuration table for ad type groupings."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values for `fin_adtype_name`, `revenue_transaction_status`, and `source_publishing_division` with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., excluded divisions, valid statuses) instead of hardcoded logic within queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment Level 2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents a specific sales segment at level 2, used for grouping and analysis of ad sales."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting ad sales performance."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_number"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an ad booking."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to identify and count individual ad sales transactions."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adsize_name"",
      ""metric_name"": ""Ad Size Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Describes the size or format of an advertisement."",
      ""sql_logic"": ""t0.adsize_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for analyzing ad performance by size/format."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of ad types for financial reporting, e.g., 'Audio (Targeted)', 'Native (Non-Targeted)'."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for filtering and segmenting ad sales data by product type. Heavily used in all queries."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Audio (Targeted)'"",
        ""'Audio (Non-Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Events (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'"",
        ""'Content Discovery (Non-Targeted)'"",
        ""'Content Discovery (Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Status of the revenue transaction, e.g., 'Booked', 'Billed'."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter for active or completed transactions. Critical for revenue reporting accuracy."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division associated with the ad sale."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter out specific divisions (e.g., 'Medium Rare Content Agency')."",
      ""metric_category"": ""operations"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter data by specific financial periods. Critical for time-based analysis."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""2026""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""distinct_sales_segments_q1_scope"",
      ""metric_name"": ""Distinct Sales Segments (Q1 Scope)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync"",
        ""fin_adtype_name"",
        ""revenue_transaction_status"",
        ""source_publishing_division""
      ],
      ""business_description"": ""Counts the number of unique sales segments for ad types related to Audio, Events, Rich Media, Social Display, Standard Display, and TTIV, for 'Booked' or 'Billed' transactions, excluding 'Medium Rare Content Agency'."",
      ""sql_logic"": ""COUNT(DISTINCT CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') THEN SAFE_CAST(sales_segment_l_2_name_sync AS STRING) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""fin_adtype_name IN ('Audio (Targeted)', ..., 'TTIV (Non-Targeted)')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides insight into the breadth of sales segments engaged for specific ad product categories."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Targetted)'"",
        ""'Audio (Non-Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Events (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""distinct_booking_numbers_q2_scope"",
      ""metric_name"": ""Distinct Booking Numbers (Q2 Scope)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""booking_number"",
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""business_description"": ""Counts the number of unique booking numbers for 'Content Discovery' and 'Native' ad types in financial years 2025 and 2026."",
      ""sql_logic"": ""COUNT(DISTINCT CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND SAFE_CAST(financial_year AS STRING) IN ('2026', '2025') THEN SAFE_CAST(booking_number AS STRING) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""fin_adtype_name IN ('Content Discovery (Non-Targeted)', ..., 'Native (Targeted)')"",
        ""financial_year IN ('2026', '2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the volume of distinct ad bookings for specific content discovery and native ad products, focusing on future financial performance."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""2026""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Content Discovery (Non-Targeted)'"",
        ""'Content Discovery (Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'""
      ],
      ""governance_issues"": [
        ""Date should be parameterised"",
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""distinct_ad_sizes_q3_scope"",
      ""metric_name"": ""Distinct Ad Sizes (Q3 Scope)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""adsize_name"",
        ""fin_adtype_name"",
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""financial_year""
      ],
      ""business_description"": ""Counts the number of unique ad sizes for a broad range of ad types (Audio, Events, Native, Rich Media, Social Display, Standard Display, TTIV) in financial year 2025, for 'Booked' or 'Billed' transactions, excluding 'Medium Rare Content Agency'."",
      ""sql_logic"": ""COUNT(DISTINCT CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND SAFE_CAST(financial_year AS STRING) = '2025' THEN SAFE_CAST(adsize_name AS STRING) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""fin_adtype_name IN ('Audio (Non-Targeted)', ..., 'TTIV (Non-Targeted)')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Analyzes the variety of ad sizes used for a wide range of ad products, focusing on the upcoming financial year's inventory."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Non-Targeted)'"",
        ""'Audio (Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Date should be parameterised"",
        ""Lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""distinct_sales_segments_q1_scope"",
      ""related_metrics"": [
        ""fin_adtype_name"",
        ""revenue_transaction_status"",
        ""source_publishing_division""
      ],
      ""relationship_description"": ""The count of distinct sales segments is directly impacted by specific filters on ad type, transaction status, and publishing division. Changes to these filter criteria will alter the resulting count."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that sales segment analysis is focused on relevant, active ad sales from specific product categories and divisions."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""distinct_booking_numbers_q2_scope"",
      ""related_metrics"": [
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""The count of distinct booking numbers is directly impacted by specific filters on ad type (Content Discovery, Native) and financial year (2025, 2026)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that booking volume analysis is focused on specific ad product types and relevant future financial periods."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(booking_number AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(fin_adtype_name AS STRING) IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND SAFE_CAST(financial_year AS STRING) IN ('2026', '2025') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""distinct_ad_sizes_q3_scope"",
      ""related_metrics"": [
        ""fin_adtype_name"",
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""financial_year""
      ],
      ""relationship_description"": ""The count of distinct ad sizes is directly impacted by specific filters on ad type, transaction status, publishing division, and financial year (2025)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that ad size variety analysis is focused on relevant, active ad sales from specific product categories and divisions for a particular financial year."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(adsize_name AS STRING)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') AND (SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND SAFE_CAST(fin_adtype_name AS STRING) IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND SAFE_CAST(financial_year AS STRING) = '2025' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,28
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52dd1ac1-19b5-4695-a7e6-632ef7a9dba3"",
    ""dashboard_name"": ""Consumer Finance Landing Page"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 2,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""none"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""scenario""
    ],
    ""date_range_detected"": ""N/A"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [],
    ""governance_opportunities"": []
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.scenario AS scenario_dimension\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n)\nSELECT\n  scenario_dimension,\n  COUNT(1) AS count_by_scenario,\n  SUM(COUNT(1)) OVER () AS total_records_count\nFROM base_data\nGROUP BY scenario_dimension\nORDER BY count_by_scenario DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.scenario AS STRING)) as unique_scenarios,\n  'No date columns identified in provided queries' as date_column_status\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(1) > 0 THEN 'PASS' ELSE 'FAIL' END as records_exist_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.scenario AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as scenarios_exist_test,\n  'No date freshness test possible without date column' as date_freshness_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'scenario_null_check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.scenario IS NOT NULL THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.scenario IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.scenario AS STRING) as scenario_dimension\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": []
    },
    ""parameterisation_recommendations"": []
  },
  ""metrics"": [
    {
      ""metric_id"": ""scenario_dimension"",
      ""metric_name"": ""Scenario"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents different scenarios or categories within the digital subscriptions dataset, used for grouping and filtering."",
      ""sql_logic"": ""t0.scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a categorical breakdown for subscription data, allowing analysis by different business contexts or types of subscriptions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""total_records_count"",
      ""metric_name"": ""Total Records Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of records present in the 'digital_subscriptions' dataset."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a high-level overview of the dataset size, useful for data validation and understanding overall volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""count_by_scenario"",
      ""metric_name"": ""Count by Scenario"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""scenario_dimension""
      ],
      ""business_description"": ""The number of digital subscription records associated with each specific scenario."",
      ""sql_logic"": ""COUNT(1) GROUP BY scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the distribution of records across different scenarios, highlighting which scenarios have more or fewer entries."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_records_count"",
      ""related_metrics"": [
        ""count_by_scenario""
      ],
      ""relationship_description"": ""The 'Total Records Count' is the sum of 'Count by Scenario' across all distinct scenarios."",
      ""mathematical_formula"": ""total_records_count = SUM(count_by_scenario)"",
      ""business_validation"": ""Ensures data consistency by verifying that the sum of records broken down by scenario equals the overall total record count."",
      ""validation_sql"": ""WITH scenario_counts AS (\n  SELECT\n    SAFE_CAST(scenario AS STRING) as scenario_dimension,\n    COUNT(1) AS count_by_scenario\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\n  GROUP BY 1\n),\ntotal_count AS (\n  SELECT COUNT(1) AS total_records FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\n)\nSELECT\n  'Metric Interaction Validation' as validation_type,\n  (SELECT SUM(count_by_scenario) FROM scenario_counts) as sum_of_scenario_counts,\n  (SELECT total_records FROM total_count) as overall_total_count,\n  CASE WHEN (SELECT SUM(count_by_scenario) FROM scenario_counts) = (SELECT total_records FROM total_count) THEN 'PASS' ELSE 'FAIL' END as consistency_check\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,29
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d4d68a71-2b12-4caf-bc6b-96fc2d18a025"",
    ""dashboard_name"": ""Adsales Details Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""adsales"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""publication_date"",
      ""advertiser_name"",
      ""agency_group"",
      ""employee_name"",
      ""financial_year"",
      ""financial_short_month"",
      ""portfolio_conformed_name_current"",
      ""unified_publication_name"",
      ""dow""
    ],
    ""date_range_detected"": ""Mixed (historical, current, and future years like 2025 detected in filters)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""2024""
    ],
    ""hardcoded_values_found"": [
      ""'Monday'"",
      ""'Tuesday'"",
      ""'Wednesday'"",
      ""'Thursday'"",
      ""'Friday'"",
      ""'Saturday'"",
      ""'Sunday'"",
      ""'Fin'"",
      ""'Curr'"",
      ""'NSW IA C3'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Marley-Kale Kentia'"",
      ""'Australian Meat Processor Corporation'"",
      ""'Australian Pork'"",
      ""'CMC Markets'"",
      ""'Coco Republic'"",
      ""'Dry July Limited'"",
      ""'Fred Hollows Foundation'"",
      ""'LGT Crestone'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Vogue Australia'""
    ],
    ""governance_opportunities"": [
      ""Dates (years) should be parameterized or derived dynamically."",
      ""Specific names (advertisers, employees, publications, portfolios) should be sourced from governed lookup tables."",
      ""The 'Fin'/'Curr' hardcoded logic should be reviewed; if always true, simplify the query; if dynamic, parameterize the selection."",
      ""Custom day of week sorting should be managed via a lookup table or a more robust sorting mechanism.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.publication_date AS publication_date,\n    t0.advertiser_name AS advertiser_name,\n    t0.agency_group AS agency_group,\n    t0.employee_name AS employee_name,\n    t0.financial_year AS financial_year,\n    t0.financial_short_month AS financial_short_month,\n    t0.portfolio_conformed_name_current AS portfolio_conformed_name_current,\n    t0.unified_publication_name AS unified_publication_name,\n    t0.dow AS day_of_week,\n    -- Inferred metrics based on dashboard type (Adsales Details) and common finance/adsales data\n    SAFE_CAST(t0.total_booked_value AS NUMERIC) AS total_booked_value, -- Assuming this column exists\n    SAFE_CAST(t0.total_impressions AS NUMERIC) AS total_impressions -- Assuming this column exists\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n  WHERE SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Filter for recent data\n)\nSELECT\n  publication_date,\n  advertiser_name,\n  agency_group,\n  employee_name,\n  financial_year,\n  financial_short_month,\n  portfolio_conformed_name_current,\n  unified_publication_name,\n  day_of_week,\n  SUM(total_booked_value) AS sum_total_booked_value,\n  SUM(total_impressions) AS sum_total_impressions,\n  COUNT(DISTINCT advertiser_name) AS distinct_advertisers,\n  COUNT(DISTINCT employee_name) AS distinct_employees,\n  COUNT(*) AS record_count\nFROM base_data\nGROUP BY\n  publication_date,\n  advertiser_name,\n  agency_group,\n  employee_name,\n  financial_year,\n  financial_short_month,\n  portfolio_conformed_name_current,\n  unified_publication_name,\n  day_of_week\nORDER BY publication_date DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.publication_date AS DATE)) AS unique_publication_dates,\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT t0.agency_group) AS unique_agency_groups,\n  COUNT(DISTINCT t0.employee_name) AS unique_employees,\n  COUNT(DISTINCT t0.financial_year) AS unique_financial_years,\n  COUNT(DISTINCT t0.financial_short_month) AS unique_financial_months,\n  MIN(SAFE_CAST(t0.publication_date AS DATE)) AS earliest_publication_date,\n  MAX(SAFE_CAST(t0.publication_date AS DATE)) AS latest_publication_date,\n  SUM(CASE WHEN t0.total_booked_value IS NULL THEN 1 ELSE 0 END) AS null_total_booked_value_count, -- Inferred column\n  SUM(CASE WHEN t0.total_impressions IS NULL THEN 1 ELSE 0 END) AS null_total_impressions_count -- Inferred column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 180 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.total_booked_value AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_booked_value_test,\n  CASE WHEN SUM(SAFE_CAST(t0.total_impressions AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_impressions_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS distinct_advertiser_test,\n  CASE WHEN MAX(SAFE_CAST(t0.publication_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(*) > 1000 THEN 'PASS' ELSE 'FAIL' END AS sufficient_data_volume_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Financial vs Calendar Month/Year and Current vs Sync Portfolio Selection' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN t0.financial_short_month IS NOT NULL THEN 1 ELSE 0 END) AS financial_month_populated_count,\n  SUM(CASE WHEN t0.calendar_month_short_name IS NOT NULL THEN 1 ELSE 0 END) AS calendar_month_populated_count,\n  SUM(CASE WHEN t0.financial_year IS NOT NULL THEN 1 ELSE 0 END) AS financial_year_populated_count,\n  SUM(CASE WHEN t0.calendar_year IS NOT NULL THEN 1 ELSE 0 END) AS calendar_year_populated_count,\n  SUM(CASE WHEN t0.portfolio_conformed_name_current IS NOT NULL THEN 1 ELSE 0 END) AS current_portfolio_populated_count,\n  SUM(CASE WHEN t0.portfolio_conformed_name_sync IS NOT NULL THEN 1 ELSE 0 END) AS sync_portfolio_populated_count,\n  -- Validate that the hardcoded 'Fin'/'Curr' logic effectively selects the intended columns\n  SUM(CASE WHEN 'Fin' = 'Fin' AND t0.financial_short_month IS NOT NULL THEN 1 ELSE 0 END) AS effective_month_is_financial_month_count,\n  SUM(CASE WHEN 'Fin' = 'Fin' AND t0.financial_year IS NOT NULL THEN 1 ELSE 0 END) AS effective_year_is_financial_year_count,\n  SUM(CASE WHEN 'Curr' = 'Curr' AND t0.portfolio_conformed_name_current IS NOT NULL THEN 1 ELSE 0 END) AS effective_portfolio_is_current_portfolio_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.publication_date AS DATE) AS publication_date,\n  t0.advertiser_name,\n  t0.agency_group,\n  t0.employee_name,\n  t0.financial_year,\n  t0.financial_short_month,\n  t0.portfolio_conformed_name_current,\n  t0.unified_publication_name,\n  t0.dow,\n  SAFE_CAST(t0.total_booked_value AS NUMERIC) AS total_booked_value, -- Inferred column\n  SAFE_CAST(t0.total_impressions AS NUMERIC) AS total_impressions -- Inferred column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND t0.total_booked_value IS NOT NULL -- Ensure some data with values\nORDER BY SAFE_CAST(t0.publication_date AS DATE) DESC, SAFE_CAST(t0.total_booked_value AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Used as a specific financial year filter for publication dates."",
          ""suggested_fix"": ""Replace with a dashboard parameter or dynamic calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) + 1`)."",
          ""impact"": ""high"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2024"",
          ""original_format"": ""2024"",
          ""context"": ""Used as an exclusion financial year filter."",
          ""suggested_fix"": ""Replace with a dashboard parameter or dynamic calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
          ""impact"": ""high"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Fin'"",
            ""'Curr'""
          ],
          ""context"": ""Constants in CASE statements that effectively hardcode the selection of financial period columns (`financial_short_month`, `financial_year`) over calendar ones, and `portfolio_conformed_name_current` over `portfolio_conformed_name_sync`."",
          ""suggested_governance"": ""If the choice is truly static, simplify the SQL by removing the `CASE` statement. If it's meant to be dynamic, parameterize the selection (e.g., `CASE WHEN @period_type = 'Fin' THEN ...`)."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Monday'"",
            ""'Tuesday'"",
            ""'Wednesday'"",
            ""'Thursday'"",
            ""'Friday'"",
            ""'Saturday'"",
            ""'Sunday'""
          ],
          ""context"": ""Used for custom sorting/display of day of week."",
          ""suggested_governance"": ""Use a dedicated lookup table for day names and their sort order, or use BigQuery's built-in date formatting functions with appropriate locale settings."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'NSW IA C3'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Marley-Kale Kentia'"",
            ""'Australian Meat Processor Corporation'"",
            ""'Australian Pork'"",
            ""'CMC Markets'"",
            ""'Coco Republic'"",
            ""'Dry July Limited'"",
            ""'Fred Hollows Foundation'"",
            ""'LGT Crestone'"",
            ""'Vogue Australia'""
          ],
          ""context"": ""Specific values used in `IN` or `=` filters for dimensions like portfolio, month, employee, advertiser, and publication."",
          ""suggested_governance"": ""These values should be driven by dashboard parameters (e.g., dropdowns) or joined from governed reference tables (e.g., `advertiser_master`, `employee_directory`, `publication_list`)."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (years) with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values for dimensions (e.g., advertiser names, employee names, publication names, portfolio names, months) with dashboard parameters or joins to governed reference tables."",
      ""Consider parameterizing the 'Fin'/'Curr' selection logic if there's a business need to dynamically switch between financial/calendar or current/sync views.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""day_of_week_display"",
      ""metric_name"": ""Day of Week Display Order"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Custom formatted day of the week string, used for specific sorting or display order in reports. The leading spaces are for sorting purposes in Looker Studio."",
      ""sql_logic"": ""CASE WHEN (dow = 'Monday') THEN 'Monday' WHEN (dow = 'Tuesday') THEN ' Tuesday' WHEN (dow = 'Wednesday') THEN '  Wednesday' WHEN (dow = 'Thursday') THEN '   Thursday' WHEN (dow = 'Friday') THEN '    Friday' WHEN (dow = 'Saturday') THEN '     Saturday' WHEN (dow = 'Sunday') THEN '      Sunday' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a specific display order for days of the week in dashboard components, ensuring consistent visual presentation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Monday'"",
        ""'Tuesday'"",
        ""'Wednesday'"",
        ""'Thursday'"",
        ""'Friday'"",
        ""'Saturday'"",
        ""'Sunday'""
      ],
      ""governance_issues"": [
        ""Hardcoded strings for day names and their specific sorting prefixes. Better managed via a lookup table or native date formatting/sorting.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_date_filtered"",
      ""metric_name"": ""Filtered Publication Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publication date of an ad, filtered by specific financial periods (year, month), portfolio, employee, and advertiser names. This query is likely used for a date filter or a list of available dates."",
      ""sql_logic"": ""t0.publication_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""portfolio_conformed_name_current = 'NSW IA C3'"",
        ""financial_short_month IN ('Feb', 'Mar', 'Apr', 'May', 'Jun')"",
        ""employee_name = 'Marley-Kale Kentia'"",
        ""advertiser_name IN ('Australian Meat Processor Corporation', 'Australian Pork', 'CMC Markets', 'Coco Republic', 'Dry July Limited', 'Fred Hollows Foundation', 'LGT Crestone')""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Used to narrow down the scope of analysis to specific campaigns, sales periods, or responsible parties."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NSW IA C3'"",
        ""'Feb'"",
        ""'Mar'"",
        ""'Apr'"",
        ""'May'"",
        ""'Jun'"",
        ""'Marley-Kale Kentia'"",
        ""'Australian Meat Processor Corporation'"",
        ""'Australian Pork'"",
        ""'CMC Markets'"",
        ""'Coco Republic'"",
        ""'Dry July Limited'"",
        ""'Fred Hollows Foundation'"",
        ""'LGT Crestone'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for year, portfolio, months, employee, and advertisers. These should be parameterized or sourced from reference tables.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""agency_group_filtered"",
      ""metric_name"": ""Filtered Agency Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The agency group associated with an ad, filtered by specific financial months, financial year exclusions, and unified publication name. This query likely populates a filter dropdown or a list of agency groups."",
      ""sql_logic"": ""t0.agency_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""financial_short_month IN ('Jul', 'Aug', 'Sep')"",
        ""financial_year NOT IN ('2024') OR financial_year IS NULL"",
        ""unified_publication_name = 'Vogue Australia'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze data specific to certain agency groups and publications, often for performance tracking or reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Jul'"",
        ""'Aug'"",
        ""'Sep'"",
        ""'Vogue Australia'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for months, year exclusion, and publication name. These should be parameterized or sourced from reference tables.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_booked_value_inferred"",
      ""metric_name"": ""Total Booked Value (Inferred)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total value of ad bookings or sales. This metric is inferred based on the dashboard's name ('Adsales Details Dashboard') and common financial reporting needs. Assumes a column like `total_booked_value` exists in the source table."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.total_booked_value AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core financial performance indicator, crucial for understanding revenue generation and sales effectiveness."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Column name `total_booked_value` is inferred; actual column name should be confirmed.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in the source column could affect aggregation."",
        ""Data freshness is critical for accurate financial reporting.""
      ]
    },
    {
      ""metric_id"": ""total_impressions_inferred"",
      ""metric_name"": ""Total Impressions (Inferred)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total number of ad impressions served. This metric is inferred based on the dashboard's name ('Adsales Details Dashboard') and common advertising performance metrics. Assumes a column like `total_impressions` exists in the source table."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.total_impressions AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the scale and reach of advertising campaigns, often used in conjunction with booked value to calculate efficiency metrics."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Column name `total_impressions` is inferred; actual column name should be confirmed.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in the source column could affect aggregation."",
        ""Accuracy depends on reliable impression tracking.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""publication_date_filtered"",
      ""related_metrics"": [
        ""total_booked_value_inferred"",
        ""total_impressions_inferred""
      ],
      ""relationship_description"": ""The filters applied to `publication_date_filtered` (financial year, month, portfolio, employee, advertiser) will directly impact the aggregated values of `total_booked_value_inferred` and `total_impressions_inferred` when these dimensions are used for grouping or filtering."",
      ""mathematical_formula"": ""N/A (filter relationship)"",
      ""business_validation"": ""Ensures that financial and volume metrics are reported within the specific business contexts defined by the filters."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""agency_group_filtered"",
      ""related_metrics"": [
        ""total_booked_value_inferred"",
        ""total_impressions_inferred""
      ],
      ""relationship_description"": ""The filters applied to `agency_group_filtered` (financial month, financial year exclusion, publication name) will directly impact the aggregated values of `total_booked_value_inferred` and `total_impressions_inferred` when these dimensions are used for grouping or filtering."",
      ""mathematical_formula"": ""N/A (filter relationship)"",
      ""business_validation"": ""Ensures that financial and volume metrics are reported for specific agency groups and publications as defined by the filters."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""day_of_week_display"",
      ""related_metrics"": [],
      ""relationship_description"": ""This metric is a direct transformation of the `dow` (day of week) column from the source table, primarily for display and sorting purposes."",
      ""mathematical_formula"": ""N/A (transformation)"",
      ""business_validation"": ""Ensures consistent ordering of days of the week across reports."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,30
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a17622e2-ad43-49cc-b3c5-19c95036fd14"",
    ""dashboard_name"": ""Advertising Rebates Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_month"",
      ""account_number"",
      ""advertiser_name"",
      ""revenue_type"",
      ""source_publishing_division"",
      ""revenue_transaction_status""
    ],
    ""date_range_detected"": ""October 2025 (hardcoded in some queries)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""10.000000 (representing October)""
    ],
    ""hardcoded_values_found"": [
      ""'Booked'"",
      ""'Billed'"",
      ""'Medium Rare Content Agency'"",
      ""'Print'"",
      ""'Digital'"",
      ""'Programmatic Source'"",
      ""'4039072'"",
      ""0.000000""
    ],
    ""governance_opportunities"": [
      ""Financial year and month should be parameterized or use relative date functions."",
      ""Revenue transaction statuses, revenue types, revenue group subtypes, and source publishing divisions should be managed via lookup tables."",
      ""Specific account numbers should be parameterized."",
      ""The 'rebate_3_amount != 0' filter could be a configurable business rule.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.account_number,\n    t0.advertiser_name,\n    t0.advertiser_parent,\n    SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n    SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n    t0.invoice_number,\n    t0.revenue_group_subtype,\n    t0.revenue_transaction_status,\n    t0.revenue_type,\n    t0.source_publishing_division,\n    t0.source_system_code,\n    t0.unified_publication_name,\n    SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC) AS gross_revenue_ex_adj_amount,\n    SAFE_CAST(t0.rebate_3_amount AS NUMERIC) AS rebate_3_amount,\n    SAFE_CAST(t0.adjustment_amount AS NUMERIC) AS adjustment_amount,\n    SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND t0.financial_year IS NOT NULL\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND t0.revenue_type IN ('Print', 'Digital')\n    AND t0.revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')\n    AND SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)) -- Dynamic filter for recent data\n)\nSELECT\n  financial_year,\n  financial_month,\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  revenue_type,\n  source_publishing_division,\n  SUM(gross_revenue_ex_adj_amount) AS total_gross_revenue_ex_adj,\n  SUM(rebate_3_amount) AS total_rebate_3_amount,\n  SUM(adjustment_amount) AS total_adjustment_amount,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  COUNT(DISTINCT invoice_number) AS distinct_invoices,\n  COUNT(DISTINCT account_number) AS distinct_accounts\nFROM base_data\nGROUP BY\n  financial_year,\n  financial_month,\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  revenue_type,\n  source_publishing_division\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.account_number) as unique_account_numbers,\n  COUNT(DISTINCT t0.advertiser_name) as unique_advertiser_names,\n  COUNT(DISTINCT t0.invoice_number) as unique_invoice_numbers,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS INT64)) as unique_financial_years,\n  MIN(SAFE_CAST(t0.financial_year AS INT64)) as earliest_financial_year,\n  MAX(SAFE_CAST(t0.financial_year AS INT64)) as latest_financial_year,\n  COUNT(DISTINCT t0.revenue_transaction_status) as unique_transaction_statuses,\n  COUNT(DISTINCT t0.revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT t0.revenue_group_subtype) as unique_revenue_subtypes,\n  COUNT(DISTINCT t0.source_publishing_division) as unique_publishing_divisions,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_amount_count,\n  SUM(CASE WHEN t0.rebate_3_amount IS NULL THEN 1 ELSE 0 END) as null_rebate_3_amount_count\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR))\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_positive_test,\n  CASE WHEN SUM(SAFE_CAST(t0.rebate_3_amount AS NUMERIC)) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as rebate_3_amount_exists_test,\n  CASE WHEN COUNT(DISTINCT t0.account_number) > 0 THEN 'PASS' ELSE 'FAIL' END as distinct_accounts_test,\n  CASE WHEN MAX(SAFE_CAST(t0.financial_year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as booked_billed_status_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name_1,\n  COUNT(*) as records_tested_1,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_status_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as status_pass_rate_percentage,\n  'Source Publishing Division Filter' as rule_name_2,\n  SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_division_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as division_pass_rate_percentage,\n  'Revenue Type Filter' as rule_name_3,\n  SUM(CASE WHEN t0.revenue_type IN ('Print', 'Digital') THEN 1 ELSE 0 END) as records_passing_revenue_type_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_type IN ('Print', 'Digital') THEN 1 ELSE 0 END), COUNT(*)) * 100 as revenue_type_pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.account_number,\n  t0.advertiser_name,\n  t0.advertiser_parent,\n  SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n  SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n  t0.invoice_number,\n  t0.revenue_group_subtype,\n  t0.revenue_transaction_status,\n  t0.revenue_type,\n  t0.source_publishing_division,\n  t0.source_system_code,\n  t0.unified_publication_name,\n  SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC) AS gross_revenue_ex_adj_amount,\n  SAFE_CAST(t0.rebate_3_amount AS NUMERIC) AS rebate_3_amount,\n  SAFE_CAST(t0.adjustment_amount AS NUMERIC) AS adjustment_amount,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))\nORDER BY SAFE_CAST(t0.financial_year AS INT64) DESC, SAFE_CAST(t0.financial_month AS INT64) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""STRING"",
          ""context"": ""Used as a specific financial year filter (clmn5_ IN ('2025'))"",
          ""suggested_fix"": ""Replace with a parameter or relative year function (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""10.000000"",
          ""original_format"": ""FLOAT64"",
          ""context"": ""Used as a specific financial month filter (clmn17_ IN (10.000000))"",
          ""suggested_fix"": ""Replace with a parameter or relative month function (e.g., EXTRACT(MONTH FROM CURRENT_DATE()))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""Revenue transaction status filter (clmn11_ IN (...))"",
          ""suggested_governance"": ""Join to a 'revenue_transaction_status_lookup' table or use a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Exclusion filter for source publishing division (clmn13_ != ...)"",
          ""suggested_governance"": ""Manage excluded divisions in a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Print'"",
            ""'Digital'""
          ],
          ""context"": ""Revenue type filter (clmn12_ IN (...))"",
          ""suggested_governance"": ""Join to a 'revenue_type_lookup' table or use a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic Source'"",
            ""'Print'"",
            ""'Digital'""
          ],
          ""context"": ""Revenue group subtype filter (clmn10_ IN (...))"",
          ""suggested_governance"": ""Join to a 'revenue_group_subtype_lookup' table or use a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'4039072'""
          ],
          ""context"": ""Specific account number filter (clmn0_ = ...)"",
          ""suggested_governance"": ""Parameterize the account number or manage specific accounts in a configuration table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""0.000000""
          ],
          ""context"": ""Rebate amount filter (clmn9_ != 0.000000)"",
          ""suggested_governance"": ""If this threshold can change, parameterize it or manage in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and months with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`, `EXTRACT(MONTH FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values (e.g., transaction statuses, revenue types, publishing divisions) with joins to governed reference tables or configuration tables."",
      ""Parameterize specific identifiers like `account_number` to allow dynamic filtering without query modification."",
      ""Consider externalizing business rules (e.g., specific exclusions or thresholds) into configuration tables for easier maintenance and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_ex_adj_amount"",
      ""metric_name"": ""Gross Revenue Excl. Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue generated from advertising sales, excluding any adjustments. This represents the raw revenue before any corrections or modifications."",
      ""sql_logic"": ""SUM(t0.gross_revenue_ex_adj_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year IN ('2025') (in some queries)"",
        ""financial_month IN (10.000000) (in some queries)"",
        ""account_number = '4039072' (in some queries)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core revenue metric, often used as a baseline for performance analysis before considering adjustments or rebates. Crucial for understanding underlying sales volume."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10.000000""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Print'"",
        ""'Digital'"",
        ""'Programmatic Source'"",
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Date components should be parameterized."",
        ""Lookup values should use reference tables."",
        ""Account number should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if source data is incomplete."",
        ""Accuracy depends on correct classification of 'Booked'/'Billed' statuses.""
      ]
    },
    {
      ""metric_id"": ""rebate_3_amount"",
      ""metric_name"": ""Rebate 3 Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of 'Rebate 3' applied to advertising sales. This is a specific type of rebate."",
      ""sql_logic"": ""SUM(t0.rebate_3_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""rebate_3_amount != 0.000000 (in some queries)"",
        ""financial_year IN ('2025') (in some queries)"",
        ""financial_month IN (10.000000) (in some queries)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track the impact of specific rebate programs on overall revenue. Important for financial reconciliation and rebate program effectiveness analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10.000000""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Print'"",
        ""'Digital'"",
        ""'Programmatic Source'"",
        ""0.000000""
      ],
      ""governance_issues"": [
        ""Date components should be parameterized."",
        ""Lookup values should use reference tables."",
        ""The '!= 0' filter might need to be parameterized if the business rule changes.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if rebate data is not consistently captured."",
        ""Reliance on accurate 'rebate_3_amount' population.""
      ]
    },
    {
      ""metric_id"": ""adjustment_amount"",
      ""metric_name"": ""Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of adjustments applied to advertising revenue. Adjustments can be positive or negative."",
      ""sql_logic"": ""SUM(t0.adjustment_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year IN ('2025') (in some queries)"",
        ""financial_month IN (10.000000) (in some queries)"",
        ""rebate_3_amount != 0.000000 (in some queries)"",
        ""account_number = '4039072' (in some queries)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to understand the impact of corrections, credits, or debits on gross revenue. Essential for calculating net revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10.000000""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Print'"",
        ""'Digital'"",
        ""'Programmatic Source'"",
        ""0.000000"",
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Date components should be parameterized."",
        ""Lookup values should use reference tables."",
        ""Account number should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls."",
        ""Accuracy depends on proper recording of adjustments.""
      ]
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_ex_adj_amount"",
        ""adjustment_amount""
      ],
      ""business_description"": ""The total gross revenue generated from advertising sales, including any adjustments. This is the reported gross revenue."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year IN ('2025') (in some queries)"",
        ""financial_month IN (10.000000) (in some queries)"",
        ""rebate_3_amount != 0.000000 (in some queries)"",
        ""account_number = '4039072' (in some queries)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary financial metric representing the total revenue before any rebates or discounts are applied. Often used for top-line reporting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10.000000""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Print'"",
        ""'Digital'"",
        ""'Programmatic Source'"",
        ""0.000000"",
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Date components should be parameterized."",
        ""Lookup values should use reference tables."",
        ""Account number should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls."",
        ""Accuracy depends on the correct calculation of gross_revenue_ex_adj_amount and adjustment_amount.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""gross_revenue_ex_adj_amount"",
        ""adjustment_amount""
      ],
      ""relationship_description"": ""Gross Revenue Amount is the sum of Gross Revenue Excluding Adjustment and Adjustment Amount. This indicates how adjustments impact the total reported gross revenue."",
      ""mathematical_formula"": ""Gross Revenue Amount = Gross Revenue Excl. Adjustment + Adjustment Amount"",
      ""business_validation"": ""This relationship ensures that all revenue components are accounted for and provides a clear audit trail for how gross revenue is derived from its constituent parts. It's fundamental for financial accuracy."",
      ""validation_sql"": ""SELECT\n  SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS total_gross_revenue,\n  SUM(SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC)) AS total_gross_revenue_ex_adj,\n  SUM(SAFE_CAST(t0.adjustment_amount AS NUMERIC)) AS total_adjustment_amount,\n  CASE\n    WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) = SUM(SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC)) + SUM(SAFE_CAST(t0.adjustment_amount AS NUMERIC))\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS relationship_check\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS INT64) >= EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,31
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52c11c9c-052a-4e45-9cda-8fecd87d7964"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)(with Pluto Reporting Date)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily;ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""advertising|sales|finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 8,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_quarter"",
      ""financial_month"",
      ""financial_week"",
      ""calendar_year"",
      ""calendar_month_name"",
      ""calendar_quarter_of_year"",
      ""calendar_week"",
      ""adtype_l1"",
      ""fin_adtype_name"",
      ""revenue_group_subtype"",
      ""revenue_type"",
      ""portfolio_parent_group_name_sync"",
      ""sales_segment_l_2_name_sync"",
      ""unified_publication_name"",
      ""cost_model_type"",
      ""advertiser_parent"",
      ""Derived_Ad_Type_Category""
    ],
    ""date_range_detected"": ""Current FY, Previous FY, Next FY (Fiscal Year Offset); Current CY, Previous CY (Calendar Year Offset)"",
    ""hardcoded_dates_found"": [
      ""2025-05-08""
    ],
    ""hardcoded_values_found"": [
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'-'"",
      ""'DOUBLECLICK'"",
      ""'$\\'000'"",
      ""'$'"",
      ""'OUTSTREAM'"",
      ""'XTEND'"",
      ""'EDMEDIA'"",
      ""'ECOMMERCE'"",
      ""'PRINT'"",
      ""'DIGITAL'"",
      ""'PROGRAMMATIC'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'SUNDRY ADSALES OVERLAY'"",
      ""'GUA'"",
      ""'NON'"",
      ""'PMP'"",
      ""'DIGITAL OTHER'"",
      ""'MRCA'"",
      ""'Client'"",
      ""'VACANT'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use CURRENT_DATE() for dynamic reporting periods."",
      ""Lookup values (e.g., transaction statuses, style names, publication names, advertiser IDs, ad types, revenue types, cost models, sales segments) should be managed in governed reference tables instead of hardcoded in queries."",
      ""Unit conversion logic ('$\\'000' vs '$') should be driven by a dashboard parameter or configuration."",
      ""Complex business rules for derived dimensions (e.g., 'PROGRAMMATIC - DIGITAL OTHER') should be defined in a central view or UDF for consistency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together\nWITH\n  base_data AS (\n    SELECT\n      ad_type_name,\n      is_xtend_flag AS xtend_flag,\n      unified_publication_name,\n      unified_publication_gl_code,\n      CASE\n        WHEN unified_publication_name IN ('Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales',\n          'Admin.Sport', 'Admin.TCM', 'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin',\n          'Escape.Admin', 'GQ.Admin', 'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin',\n          'odds.com.au', 'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n          'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin',\n          'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin') THEN 'Sundry Pubs'\n        ELSE 'Non Sundry Pubs'\n      END AS Sundry_Pubs_Flag,\n      fy_year_month_number,\n      CAST(RIGHT(CAST(fy_year_month_number AS STRING), 2) AS INT) AS fiscal_month_number,\n      fy_year AS financial_year,\n      fy_quarter_of_year AS financial_quarter,\n      fy_month_of_year AS financial_month,\n      fy_month_short_name AS financial_short_month,\n      fy_week_of_year AS financial_week,\n      revenue_transaction_status_code AS revenue_transaction_status,\n      is_print_digital_flag,\n      current_fy_month_of_year AS current_financial_month,\n      current_fy_week_of_year AS current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(ASL.fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sync_sales_segment_l2_name = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE('Australia/Sydney')) AS DOW_Today,\n      sales_segment_l1_name AS sales_segment_l_1_name,\n      sales_segment_l2_name AS sales_segment_l_2_name,\n      sync_sales_segment_l1_name AS sales_segment_l_1_name_sync,\n      sync_sales_segment_l2_name AS sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      customer_group_name AS advertiser_group,\n      customer_group_parent_name AS advertiser_parent,\n      IFNULL(adjustment_amount, 0) AS adjustment_amount,\n      curr_sales_segment_gm_name AS sales_segment_gm_name,\n      sync_sales_segment_gm_name AS sales_segment_gm_name_sync,\n      revenue_group_level1_name AS revenue_group_level_1_name,\n      revenue_group_level2_name AS revenue_group_level_2_name,\n      IFNULL(lgb_pub_amount, 0) AS pub_lgb,\n      IFNULL(lgb_ss_amount, 0) AS ss_lgb,\n      IFNULL(pipeline_amount, 0) AS pipeline,\n      IFNULL(gross_revenue_amount, 0) AS gross_revenue_amount,\n      UPPER(revenue_group_type_code) AS revenue_type,\n      UPPER(revenue_type_level2_code) AS revenue_type_Level2,\n      UPPER(ASL.revenue_group_sub_type_code) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      sync_portfolio_group_name AS portfolio_group_name_sync,\n      current_portfolio_group_name AS portfolio_group_name_current,\n      sync_portfolio_parent_group_name AS portfolio_parent_group_name_sync,\n      industry_level1_name AS aszsic_industry_level_1_name,\n      industry_level1_code AS anzsic_industry_level_1_code,\n      industry_level2_code AS anzsic_industry_level_2_code,\n      industry_level2_name AS aszsic_industry_level_2_name,\n      industry_level3_code AS anzsic_industry_level_3_code,\n      industry_level3_name AS anzsic_industry_level_3_name,\n      industry_level4_code AS anzsic_industry_level_4_code,\n      industry_level4_name AS anzsic_industry_level_4_name,\n      industry_pillar_name AS nca_industry_pillar,\n      industry_pillar_group_name AS nca_industry_anzsic_pillar_group,\n      ASL.product_group_name AS product_group,\n      division_group_name AS publishing_division_group,\n      division_parent_group_name AS publishing_division_parent,\n      CASE\n        WHEN client_reporting_date >= CURRENT_DATE('Australia/Sydney') THEN 'Y'\n        ELSE 'N'\n      END AS is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ly_is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ny_is_future_period_flag,\n      cost_model_type_code AS cost_model_type,\n      CASE\n        WHEN dw_source_system_code = 'PLUTO' THEN SAFE_CAST(client_reporting_date AS STRING)\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      sync_portfolio_conformed_name AS portfolio_conformed_name_sync,\n      publishing_division_name AS publishing_division,\n      booking_line_created_week_of_year AS booking_line_created_week,\n      booking_line_created_month_of_year AS booking_line_created_month,\n      booking_line_created_month_short_name AS booking_line_created_short_month,\n      booking_line_created_quarter_of_year AS booking_line_created_quarter,\n      booking_line_created_year,\n      agency_group_parent_name AS agency_parent,\n      agency_group_name AS agency_group,\n      agency_name,\n      agency_id_src AS agency_number,\n      cal_month_name AS calendar_month_name,\n      cal_year AS calendar_year,\n      section_l5_name AS classification_name,\n      IFNULL(target_amount, 0) AS target,\n      IFNULL(current_portfolio_group_owner_full_name_sync, 'VACANT') AS GSD,\n      IFNULL(current_portfolio_group_owner_full_name_current, 'VACANT') AS current_portfolio_group_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS portfolio_full_name_sync,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS sync_portfolio_conformed_owner_full,\n      current_portfolio_conformed_owner_current,\n      current_portfolio_group_owner_current,\n      adtype_l1,\n      adtype_l2,\n      legacy_growth_flag,\n      relative_cal_year_offset,\n      cal_quarter_of_year_name AS calendar_quarter_of_year,\n      cal_year_week_number AS calendar_week\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\n    WHERE\n      (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(revenue_transaction_status_code,\n          'XXX')) IN ('BILLED', 'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division_name,\n          'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n      (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name =\n      '-')))\n  ),\n  derived_data AS (\n    SELECT\n      *,\n      MIN(\n        CASE\n          WHEN advertiser_parent = \""DOUBLECLICK\"" THEN SAFE_CAST(booking_line_created_date AS DATE)\n        END) OVER (PARTITION BY financial_year) AS fix_date_lod,\n      DATETIME(TIMESTAMP(CURRENT_TIMESTAMP()), \""Australia/Sydney\"") AS dw_asl_load_timestamp,\n      -- Derived dimensions for grouping\n      CASE\n        WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC'\n        ELSE revenue_group_subtype\n      END AS Derived_Ad_Type_Category,\n      -- Conditional Gross Revenue calculation (clmn45_ / clmn36_ equivalent)\n      CASE\n        WHEN relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') THEN gross_revenue_amount\n        WHEN relative_fy_year_offset = 0 AND (\n          SAFE_CAST(\n            CASE\n              WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod\n              ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date)\n            END AS DATETIME)\n          <= DATETIME_ADD(CURRENT_DATETIME('Australia/Sydney'), INTERVAL -365 DAY)\n        )\n        THEN gross_revenue_amount\n        ELSE 0\n      END AS Conditional_Gross_Revenue_Amount\n    FROM\n      base_data\n  )\nSELECT\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_short_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_quarter_of_year,\n  calendar_week,\n  adtype_l1,\n  fin_adtype_name,\n  revenue_group_subtype,\n  revenue_type,\n  portfolio_parent_group_name_sync,\n  sales_segment_l_2_name_sync,\n  unified_publication_name,\n  cost_model_type,\n  advertiser_parent,\n  Derived_Ad_Type_Category,\n  SUM(gross_revenue_amount) AS Total_Gross_Revenue,\n  SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0)) AS Current_FY_Gross_Revenue,\n  SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0)) AS Next_FY_Gross_Revenue,\n  SUM(Conditional_Gross_Revenue_Amount) AS Conditional_Gross_Revenue,\n  SUM(adjustment_amount) AS Total_Adjustment_Amount,\n  SUM(pub_lgb) AS Total_Pub_LGB,\n  SUM(ss_lgb) AS Total_SS_LGB,\n  SUM(pipeline) AS Total_Pipeline,\n  SUM(target) AS Total_Target\nFROM\n  derived_data\nGROUP BY\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_short_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_quarter_of_year,\n  calendar_week,\n  adtype_l1,\n  fin_adtype_name,\n  revenue_group_subtype,\n  revenue_type,\n  portfolio_parent_group_name_sync,\n  sales_segment_l_2_name_sync,\n  unified_publication_name,\n  cost_model_type,\n  advertiser_parent,\n  Derived_Ad_Type_Category\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 1000"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(client_reporting_date AS DATE)) AS unique_client_reporting_dates,\n  COUNT(DISTINCT SAFE_CAST(booking_line_created_date AS DATE)) AS unique_booking_dates,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT unified_publication_name) AS unique_publications,\n  MIN(SAFE_CAST(client_reporting_date AS DATE)) AS earliest_client_reporting_date,\n  MAX(SAFE_CAST(client_reporting_date AS DATE)) AS latest_client_reporting_date,\n  MIN(SAFE_CAST(booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(booking_line_created_date AS DATE)) AS latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(client_reporting_date AS STRING), '-', SAFE_CAST(advertiser_id_src AS STRING), '-', SAFE_CAST(ad_type_name AS STRING))) AS approx_unique_transactions\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  SAFE_CAST(client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 90 DAY)\nLIMIT 100;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS unique_advertiser_test,\n  CASE WHEN MAX(SAFE_CAST(client_reporting_date AS DATE)) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS transaction_status_filter_test,\n  CASE WHEN COUNT(CASE WHEN relative_fy_year_offset = 0 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS current_fy_data_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  SAFE_CAST(client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Excluded Publication Check' AS rule_name,\n  COUNT(*) AS total_records_in_scope,\n  SUM(CASE WHEN UPPER(IFNULL(publication_name, 'XXX')) LIKE 'SUDDENLY%' AND NOT (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-') THEN 1 ELSE 0 END) AS records_excluded_by_suddenly_rule,\n  SUM(CASE WHEN UPPER(IFNULL(style_name, 'XXX')) = 'ROP COMPOSITE' THEN 1 ELSE 0 END) AS records_excluded_by_style_name_rule,\n  SUM(CASE WHEN UPPER(IFNULL(source_publishing_division_name, 'XXX')) = 'MEDIUM RARE CONTENT AGENCY' THEN 1 ELSE 0 END) AS records_excluded_by_division_rule,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) NOT IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_excluded_by_status_rule,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN 1 ELSE 0 END) AS current_fy_records,\n  SUM(CASE WHEN relative_fy_year_offset = -1 THEN 1 ELSE 0 END) AS previous_fy_records,\n  SUM(CASE WHEN relative_fy_year_offset = 1 THEN 1 ELSE 0 END) AS next_fy_records\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  SAFE_CAST(client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 * 2 DAY);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(client_reporting_date AS DATE) AS client_reporting_date,\n  SAFE_CAST(booking_line_created_date AS DATE) AS booking_line_created_date,\n  financial_year,\n  financial_month,\n  advertiser_name,\n  advertiser_parent,\n  unified_publication_name,\n  fin_adtype_name,\n  revenue_type,\n  revenue_group_subtype,\n  gross_revenue_amount,\n  adjustment_amount,\n  pipeline_amount,\n  target_amount,\n  relative_fy_year_offset,\n  relative_cal_year_offset,\n  dw_source_system_code,\n  cost_model_type_code\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  SAFE_CAST(client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 14 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(client_reporting_date AS DATE) DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-08"",
          ""original_format"": ""DATE(TIMESTAMP '2025-05-08 01:48:02.510465+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed reference point for calculating relative dates (e.g., in the complex date comparison for `Conditional_Gross_Revenue`). This date is effectively `CURRENT_DATE()` at the time the query was generated/saved."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE('Australia/Sydney')` or a dashboard date parameter to ensure calculations are always relative to the current day."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'BILLED'"",
            ""'BOOKED'""
          ],
          ""context"": ""Revenue transaction status codes used for filtering."",
          ""suggested_governance"": ""Define valid transaction statuses in a reference table (e.g., `dim_transaction_status`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'ROP COMPOSITE'""
          ],
          ""context"": ""Specific style name excluded from results."",
          ""suggested_governance"": ""Manage excluded style names in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'MEDIUM RARE CONTENT AGENCY'""
          ],
          ""context"": ""Specific source publishing division name excluded from results."",
          ""suggested_governance"": ""Manage excluded division names in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'17114'"",
            ""'29172'"",
            ""'52809'""
          ],
          ""context"": ""Specific advertiser IDs used in a conditional filter for 'SUDDENLY%' publications."",
          ""suggested_governance"": ""Store these special advertiser IDs in a reference table (e.g., `dim_special_advertisers`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'-'""
          ],
          ""context"": ""Specific ad type name used in a conditional filter for 'SUDDENLY%' publications."",
          ""suggested_governance"": ""Store special ad type names in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'""
          ],
          ""context"": ""Specific advertiser parent used in `fix_date_lod` calculation."",
          ""suggested_governance"": ""Manage special advertiser parents in a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""'$\\'000'"",
            ""'$'""
          ],
          ""context"": ""String literals used to determine if a metric should be divided by 1000 for display (unit conversion)."",
          ""suggested_governance"": ""Use a dashboard parameter or a configuration table to control display units, rather than hardcoded string comparisons."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'OUTSTREAM'"",
            ""'XTEND'"",
            ""'EDMEDIA'"",
            ""'ECOMMERCE'""
          ],
          ""context"": ""Specific unified publication names used in conditional revenue calculations."",
          ""suggested_governance"": ""Define these categories in a reference table (e.g., `dim_publication_category`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'PRINT'"",
            ""'DIGITAL'"",
            ""'PROGRAMMATIC'"",
            ""'PROGRAMMATIC EXCHANGE'"",
            ""'PROGRAMMATIC SOURCE'"",
            ""'SUNDRY ADSALES OVERLAY'""
          ],
          ""context"": ""Specific revenue types/subtypes used in derived dimensions and conditional logic."",
          ""suggested_governance"": ""Define these categories in a reference table (e.g., `dim_revenue_type_category`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'GUA'"",
            ""'NON'"",
            ""'PMP'""
          ],
          ""context"": ""Specific cost model types used in derived dimensions."",
          ""suggested_governance"": ""Define these categories in a reference table (e.g., `dim_cost_model_type`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DIGITAL OTHER'""
          ],
          ""context"": ""Specific portfolio parent group name used in derived dimensions."",
          ""suggested_governance"": ""Define these categories in a reference table (e.g., `dim_portfolio_group_category`) and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'MRCA'"",
            ""'Client'""
          ],
          ""context"": ""Specific sales group names used in derived dimensions."",
          ""suggested_governance"": ""Define these categories in a reference table (e.g., `dim_sales_group`) and join to it."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""default_values"",
          ""hardcoded_values"": [
            ""'VACANT'""
          ],
          ""context"": ""Default value for owner names when NULL."",
          ""suggested_governance"": ""Standard practice, but ensure 'VACANT' is a universally understood and accepted placeholder."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-05-08') with `CURRENT_DATE('Australia/Sydney')` or Looker Studio date parameters for dynamic reporting."",
      ""Introduce a dashboard parameter for unit conversion (e.g., 'Display_Units' with values 'Units' or 'Thousands') to replace the hardcoded '$\\'000' vs '$' logic."",
      ""Externalize all hardcoded lookup values (e.g., transaction statuses, style names, advertiser IDs, revenue types, cost models) into dedicated reference tables. This allows for easier maintenance, consistency across dashboards, and better data governance."",
      ""Consider creating a BigQuery view or UDFs for complex derived dimensions and business rules (e.g., `Derived_Ad_Type_Category`, `Conditional_Gross_Revenue`) to centralize logic and improve reusability and maintainability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adtype_l1"",
      ""metric_name"": ""Ad Type Level 1"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The highest level classification of advertisement type."",
      ""sql_logic"": ""adtype_l1"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping sales performance by broad ad categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for a given transaction line item, before any specific period or conditional filtering."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue-based metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the current fiscal year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current fiscal year sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""next_fy_gross_revenue"",
      ""metric_name"": ""Next FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the next fiscal year (relative_fy_year_offset = 1)."",
      ""sql_logic"": ""SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for future fiscal year sales pipeline and booking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""conditional_gross_revenue"",
      ""metric_name"": ""Conditional Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""unified_publication_name"",
        ""fix_date_lod"",
        ""booking_line_created_date"",
        ""advertiser_parent"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""Gross revenue amount filtered by complex conditions including current fiscal year, specific unified publication names, and a date comparison involving `fix_date_lod` and `booking_line_created_date` relative to a hardcoded date offset."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') THEN gross_revenue_amount WHEN relative_fy_year_offset = 0 AND (SAFE_CAST(CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(CURRENT_DATETIME('Australia/Sydney'), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents a specific subset of revenue, likely for particular digital or programmatic campaigns, with complex date and publication criteria."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-08""
      ],
      ""hardcoded_values_in_metric"": [
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded date '2025-05-08' should be dynamic (CURRENT_DATE())."",
        ""Hardcoded publication names and sales segment names should be externalized to reference tables."",
        ""The complex conditional logic should be documented and potentially simplified or moved to a UDF/view.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on a hardcoded date for relative date calculations can lead to stale results.""
      ]
    },
    {
      ""metric_id"": ""total_adjustment_amount"",
      ""metric_name"": ""Total Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all adjustment amounts."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to understand financial adjustments to revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""total_pub_lgb"",
      ""metric_name"": ""Total LGB (Publisher)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of LGB (Looks Good By) amounts from the publisher's perspective."",
      ""sql_logic"": ""SUM(IFNULL(lgb_pub_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for internal financial reconciliation and forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""total_ss_lgb"",
      ""metric_name"": ""Total LGB (Sales System)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of LGB (Looks Good By) amounts from the sales system's perspective."",
      ""sql_logic"": ""SUM(IFNULL(lgb_ss_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for internal sales system reconciliation and forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of pipeline amounts, representing potential future revenue."",
      ""sql_logic"": ""SUM(IFNULL(pipeline_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for sales forecasting and pipeline management."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""total_target"",
      ""metric_name"": ""Total Target Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of target amounts, representing sales goals."",
      ""sql_logic"": ""SUM(IFNULL(target_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track performance against sales targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""derived_ad_type_category"",
      ""metric_name"": ""Derived Ad Type Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""portfolio_parent_group_name_sync"",
        ""revenue_group_subtype""
      ],
      ""business_description"": ""A categorized ad type based on a specific rule: if portfolio parent group is 'DIGITAL OTHER' AND revenue group subtype is 'DIGITAL', then 'PROGRAMMATIC', otherwise use the original revenue group subtype. This is a simplified representation of the complex original logic."",
      ""sql_logic"": ""CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a high-level categorization of ad types for reporting, consolidating various underlying attributes."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL OTHER'"",
        ""'DIGITAL'"",
        ""'PROGRAMMATIC'""
      ],
      ""governance_issues"": [
        ""Complex CASE WHEN logic with hardcoded values should be externalized to a UDF or a derived view for better maintainability and consistency."",
        ""Hardcoded category names should be managed in reference tables.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current FY Gross Revenue is a subset of Gross Revenue Amount, specifically for records where the fiscal year offset is 0 (current year)."",
      ""mathematical_formula"": ""Current_FY_Gross_Revenue = SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))"",
      ""business_validation"": ""Ensures that current year performance is accurately isolated from other fiscal periods."",
      ""validation_sql"": ""SELECT SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0)) AS current_fy_sum, SUM(gross_revenue_amount) AS total_gross_revenue FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 0;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""next_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Next FY Gross Revenue is a subset of Gross Revenue Amount, specifically for records where the fiscal year offset is 1 (next year)."",
      ""mathematical_formula"": ""Next_FY_Gross_Revenue = SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0))"",
      ""business_validation"": ""Provides insight into future revenue bookings and pipeline."",
      ""validation_sql"": ""SELECT SUM(IF(relative_fy_year_offset = 1, gross_revenue_amount, 0)) AS next_fy_sum, SUM(gross_revenue_amount) AS total_gross_revenue FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""revenue_transaction_status_code"",
        ""style_name"",
        ""source_publishing_division_name"",
        ""publication_name"",
        ""advertiser_id_src"",
        ""ad_type_name""
      ],
      ""relationship_description"": ""All revenue metrics are filtered to include only 'BILLED' or 'BOOKED' transactions, exclude 'ROP COMPOSITE' style, 'MEDIUM RARE CONTENT AGENCY' division, and apply specific rules for 'SUDDENLY%' publications."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that reported revenue is based on valid and relevant transactions, excluding specific internal or non-revenue generating items."",
      ""validation_sql"": ""SELECT COUNT(*) AS total_records, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS valid_status_records, SUM(CASE WHEN UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' THEN 1 ELSE 0 END) AS valid_style_records FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` LIMIT 1000;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""conditional_gross_revenue"",
      ""related_metrics"": [
        ""fix_date_lod"",
        ""booking_line_created_date"",
        ""advertiser_parent"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync"",
        ""unified_publication_name""
      ],
      ""relationship_description"": ""Conditional Gross Revenue relies on a complex set of conditions involving multiple dimensions and a derived date (`fix_date_lod`) which itself depends on `advertiser_parent` and `booking_line_created_date`."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Highlights the specific and nuanced business rules applied to certain revenue streams, often for specialized reporting needs."",
      ""validation_sql"": ""SELECT SUM(Conditional_Gross_Revenue_Amount) FROM (SELECT *, MIN(CASE WHEN advertiser_parent = \""DOUBLECLICK\"" THEN SAFE_CAST(booking_line_created_date AS DATE) END) OVER (PARTITION BY financial_year) AS fix_date_lod, CASE WHEN relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') THEN gross_revenue_amount WHEN relative_fy_year_offset = 0 AND (SAFE_CAST(CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(CURRENT_DATETIME('Australia/Sydney'), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END AS Conditional_Gross_Revenue_Amount FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')) AS subquery;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,32
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f353b933-30eb-4853-9976-d35371db77"",
    ""dashboard_name"": ""Month End Reporting Reconcilation"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 2,
    ""consolidation_score"": 1,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""month_name"",
      ""fy_month_num""
    ],
    ""date_range_detected"": ""Last 12 months (inferred from common dashboard practices and fy_month_num usage)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [],
    ""governance_opportunities"": []
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.fy_month_num,\n    t0.month_name\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\n  -- Assuming fy_month_num is YYYYMM format and we want data for the last 12 months\n  WHERE SAFE_CAST(t0.fy_month_num AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)) AS INT64)\n)\nSELECT\n  base_data.fy_month_num,\n  base_data.month_name,\n  COUNT(base_data.fy_month_num) AS count_fy_month_num,\n  SUM(SAFE_CAST(base_data.fy_month_num AS NUMERIC)) AS sum_fy_month_num\nFROM base_data\nGROUP BY base_data.fy_month_num, base_data.month_name\nORDER BY base_data.fy_month_num DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.month_name) as unique_month_names,\n  COUNT(DISTINCT t0.fy_month_num) as unique_fy_month_nums,\n  MIN(SAFE_CAST(t0.fy_month_num AS INT64)) as earliest_fy_month_num,\n  MAX(SAFE_CAST(t0.fy_month_num AS INT64)) as latest_fy_month_num\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.fy_month_num AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH)) AS INT64)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(t0.fy_month_num) > 0 THEN 'PASS' ELSE 'FAIL' END as fy_month_num_count_test,\n  CASE WHEN SUM(SAFE_CAST(t0.fy_month_num AS NUMERIC)) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as fy_month_num_sum_test,\n  CASE WHEN COUNT(DISTINCT t0.month_name) > 0 THEN 'PASS' ELSE 'FAIL' END as month_name_distinct_test,\n  CASE WHEN MAX(SAFE_CAST(t0.fy_month_num AS INT64)) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)) AS INT64) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.fy_month_num AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)) AS INT64)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'null_check_fy_month_num' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.fy_month_num IS NULL THEN 1 ELSE 0 END) as null_fy_month_num_count,\n  SUM(CASE WHEN t0.month_name IS NULL THEN 1 ELSE 0 END) as null_month_name_count\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.fy_month_num AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)) AS INT64)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.fy_month_num AS INT64) as fy_month_num,\n  SAFE_CAST(t0.month_name AS STRING) as month_name\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.fy_month_num AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%m', DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)) AS INT64)\nORDER BY SAFE_CAST(t0.fy_month_num AS INT64) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": []
    },
    ""parameterisation_recommendations"": [
      ""Consider parameterizing the date range for `fy_month_num` instead of hardcoding relative dates (e.g., 'last 12 months').""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fy_month_num_count"",
      ""metric_name"": ""Count of FY Month Numbers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the total number of records available for each fiscal month. In a reconciliation context, this could indicate the volume of entries processed or available for matching."",
      ""sql_logic"": ""COUNT(t0.fy_month_num)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for understanding data completeness and volume during month-end reconciliation processes. A significant drop or spike could indicate data ingestion issues."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in fy_month_num could lead to undercounting if not handled explicitly.""
      ]
    },
    {
      ""metric_id"": ""fy_month_num_sum"",
      ""metric_name"": ""Sum of FY Month Numbers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Calculates the sum of the fiscal month numbers for all records within a given month. While not a standard business metric, it might be used as a checksum or for specific internal reconciliation validation if 'fy_month_num' holds a unique numerical property beyond just a month identifier (e.g., a unique identifier per month)."",
      ""sql_logic"": ""SUM(t0.fy_month_num)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Its direct business meaning is unclear without further context on the 'fy_month_num' column's specific use. Could serve as an internal data integrity check."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""The business meaning of summing 'fy_month_num' is ambiguous and should be clarified."",
        ""Potential for large, non-intuitive numbers if 'fy_month_num' is in YYYYMM format.""
      ]
    }
  ],
  ""metric_interactions"": []
}
```",success,33
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""258a722d-9b6e-45df-ba00-1b9954ec36b2"",
    ""dashboard_name"": ""Debtor to Account Mapping"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref;sdm_advertisingexternals.__TABLES__"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 4,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""adpoint_account"",
      ""genera_booking_account"",
      ""medium_rare_debtor_account"",
      ""national_debtor_account""
    ],
    ""date_range_detected"": ""N/A (single point in time for update status)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'56694'""
    ],
    ""governance_opportunities"": [
      ""Adpoint_Account filter should be parameterized""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN --\n-- This query provides a consolidated view of account mappings and their counts.\n-- It also includes the last update time of the underlying data source as a separate metric.\n\nWITH AccountMappings AS (\n  SELECT\n    t0.Adpoint_Account AS adpoint_account,\n    t0.Genera_Booking_Account AS genera_booking_account,\n    t0.Medium_Rare_Debtor_Account AS medium_rare_debtor_account,\n    t0.National_Debtor_Account AS national_debtor_account\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` AS t0\n),\nLastUpdateTime AS (\n  SELECT\n    DATETIME_TRUNC(\n      PARSE_DATETIME(\n        '%Y-%m-%dT%H:%M:%S',\n        FORMAT_TIMESTAMP(\n          '%Y-%m-%dT%H:%M:%S',\n          SAFE_CAST(\n            CAST(FORMAT_DATETIME('%F %X', datetime(timestamp_millis(last_modified_time), \""Australia/Sydney\"")) AS STRING)\n            AS TIMESTAMP\n          )\n        )\n      ),\n      SECOND\n    ) AS last_data_update_time\n  FROM `sdm_advertisingexternals.__TABLES__`\n  WHERE table_id = \""gbaba_act_xref\""\n)\nSELECT\n  am.adpoint_account,\n  am.genera_booking_account,\n  am.medium_rare_debtor_account,\n  am.national_debtor_account,\n  COUNT(*) AS account_mapping_count,\n  (SELECT last_data_update_time FROM LastUpdateTime) AS last_data_update_time\nFROM AccountMappings AS am\nGROUP BY\n  am.adpoint_account,\n  am.genera_booking_account,\n  am.medium_rare_debtor_account,\n  am.national_debtor_account\nORDER BY\n  am.adpoint_account ASC\nLIMIT 1000; -- Limiting for sample analysis, remove for full dataset"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(Adpoint_Account AS STRING)) as unique_adpoint_accounts,\n  COUNT(DISTINCT SAFE_CAST(Genera_Booking_Account AS STRING)) as unique_genera_booking_accounts,\n  COUNT(DISTINCT SAFE_CAST(Medium_Rare_Debtor_Account AS STRING)) as unique_medium_rare_debtor_accounts,\n  COUNT(DISTINCT SAFE_CAST(National_Debtor_Account AS STRING)) as unique_national_debtor_accounts\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(t0.Adpoint_Account) > 0 THEN 'PASS' ELSE 'FAIL' END as adpoint_account_presence_test,\n  CASE WHEN COUNT(t0.Genera_Booking_Account) > 0 THEN 'PASS' ELSE 'FAIL' END as genera_booking_account_presence_test,\n  CASE WHEN (SELECT COUNT(*) FROM `sdm_advertisingexternals.__TABLES__` WHERE table_id = \""gbaba_act_xref\"") > 0 THEN 'PASS' ELSE 'FAIL' END as source_table_metadata_presence_test,\n  CASE WHEN (SELECT DATETIME_DIFF(CURRENT_DATETIME(\""Australia/Sydney\""), DATETIME(timestamp_millis(last_modified_time), \""Australia/Sydney\""), HOUR) < 24 FROM `sdm_advertisingexternals.__TABLES__` WHERE table_id = \""gbaba_act_xref\"" LIMIT 1) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test_24h\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` AS t0\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' as validation_type,\n  'adpoint_account_filter_check' as rule_name,\n  COUNT(*) as total_records_in_view,\n  SUM(CASE WHEN SAFE_CAST(Adpoint_Account AS STRING) = '56694' THEN 1 ELSE 0 END) as records_matching_hardcoded_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(Adpoint_Account AS STRING) = '56694' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_matching_filter\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(Adpoint_Account AS STRING) AS adpoint_account,\n  SAFE_CAST(Genera_Booking_Account AS STRING) AS genera_booking_account,\n  SAFE_CAST(Medium_Rare_Debtor_Account AS STRING) AS medium_rare_debtor_account,\n  SAFE_CAST(National_Debtor_Account AS STRING) AS national_debtor_account\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nWHERE SAFE_CAST(Adpoint_Account AS STRING) IS NOT NULL -- Ensure at least one key dimension is present\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'56694'""
          ],
          ""context"": ""Filter applied to Adpoint_Account in one of the dashboard queries."",
          ""suggested_governance"": ""This value should be replaced with a parameter in Looker Studio or derived from a configuration table if it represents a specific business entity."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded account ID '56694' with a Looker Studio parameter to allow dynamic filtering by users."",
      ""Consider creating a configuration table for frequently used filter values if they represent business rules.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adpoint_account"",
      ""metric_name"": ""Adpoint Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""account"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an account in the Adpoint system."",
      ""sql_logic"": ""t0.Adpoint_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary key for mapping other account types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""data consistency across systems""
      ]
    },
    {
      ""metric_id"": ""genera_booking_account"",
      ""metric_name"": ""Genera Booking Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""account"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an account in the Genera Booking system."",
      ""sql_logic"": ""t0.Genera_Booking_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for cross-referencing accounts across different advertising systems."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""data consistency across systems""
      ]
    },
    {
      ""metric_id"": ""medium_rare_debtor_account"",
      ""metric_name"": ""Medium Rare Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""account"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a debtor account specific to Medium Rare."",
      ""sql_logic"": ""t0.Medium_Rare_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for cross-referencing accounts across different advertising systems."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""data consistency across systems""
      ]
    },
    {
      ""metric_id"": ""national_debtor_account"",
      ""metric_name"": ""National Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""account"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a debtor account at a national level."",
      ""sql_logic"": ""t0.National_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for cross-referencing accounts across different advertising systems."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""data consistency across systems""
      ]
    },
    {
      ""metric_id"": ""account_mapping_count"",
      ""metric_name"": ""Account Mapping Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""adpoint_account"",
        ""genera_booking_account"",
        ""medium_rare_debtor_account"",
        ""national_debtor_account""
      ],
      ""business_description"": ""The number of unique combinations of account mappings found."",
      ""sql_logic"": ""COUNT(*)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of the distinct account mapping entries."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_data_update_time"",
      ""metric_name"": ""Last Data Update Time"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""single_value"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The last time the underlying 'gbaba_act_xref' table was modified, indicating data freshness."",
      ""sql_logic"": ""DATETIME_TRUNC(PARSE_DATETIME('%Y-%m-%dT%H:%M:%S', FORMAT_TIMESTAMP('%Y-%m-%dT%H:%M:%S', SAFE_CAST(CAST(FORMAT_DATETIME('%F %X', datetime(timestamp_millis(last_modified_time), \""Australia/Sydney\"")) AS STRING) AS TIMESTAMP))), SECOND)"",
      ""data_sources"": [
        ""sdm_advertisingexternals.__TABLES__""
      ],
      ""filters_applied"": [
        ""table_id = \""gbaba_act_xref\""""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Crucial for understanding the recency of the account mapping data presented in the dashboard."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""\""gbaba_act_xref\""""
      ],
      ""governance_issues"": [
        ""The complex string formatting and parsing for datetime conversion could be simplified if the source `last_modified_time` is directly usable as a timestamp."",
        ""The table_id filter is hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""timezone handling"",
        ""potential for null `last_modified_time`""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""adpoint_account"",
      ""related_metrics"": [
        ""genera_booking_account"",
        ""medium_rare_debtor_account"",
        ""national_debtor_account"",
        ""account_mapping_count""
      ],
      ""relationship_description"": ""Filtering by 'Adpoint Account' (e.g., '56694') directly impacts the subset of 'Genera Booking Account', 'Medium Rare Debtor Account', and 'National Debtor Account' mappings displayed, and consequently the 'Account Mapping Count'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Users often need to see mappings for a specific Adpoint account, making this filter critical for targeted analysis."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` WHERE SAFE_CAST(Adpoint_Account AS STRING) = '56694';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""account_mapping_count"",
      ""related_metrics"": [
        ""adpoint_account"",
        ""genera_booking_account"",
        ""medium_rare_debtor_account"",
        ""national_debtor_account""
      ],
      ""relationship_description"": ""The 'Account Mapping Count' is a direct aggregation (count) of the distinct combinations of the four account dimensions."",
      ""mathematical_formula"": ""COUNT(DISTINCT adpoint_account, genera_booking_account, medium_rare_debtor_account, national_debtor_account)"",
      ""business_validation"": ""This count indicates the total number of unique mapping relationships present in the dataset."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT Adpoint_Account, Genera_Booking_Account, Medium_Rare_Debtor_Account, National_Debtor_Account) FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,34
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b9dfd2f4-92fa-4f81-a5b1-17de880470f9"",
    ""dashboard_name"": ""Contra Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard;ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily;ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data"",
    ""business_domain"": ""finance|advertising|sales"",
    ""complexity_score"": 9,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""adpoint_account_number"",
      ""advertiser_name"",
      ""calendar_year_month"",
      ""financial_year"",
      ""portfolio_conformed_name_current"",
      ""sales_segment_gm_name"",
      ""revenue_type"",
      ""current_portfolio_conformed_owner_full""
    ],
    ""date_range_detected"": ""Dynamic based on data availability"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Contra'"",
      ""'Renee Sycamore'"",
      ""'13019'"",
      ""'52246'"",
      ""'18387'"",
      ""'ctr1'"",
      ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'"",
      ""'Guaranteed'"",
      ""'Exchange'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'-'"",
      ""'CTR_2023_AFL SPORT'"",
      ""'CTR_2023_GWS GIANTS'"",
      ""'CTR_2023_SYDNEY SWANS'"",
      ""'CTR_2025_Greater Western Sydney Giants'"",
      ""'CTR_2025_Raising Literacy Australia'"",
      ""'VACANT'"",
      ""'XXX'""
    ],
    ""governance_opportunities"": [
      ""Account numbers and advertiser names used in CASE statements should be managed via a lookup table."",
      ""Specific sales segment GM names and industry pillars should be parameters or part of a governed dimension table."",
      ""Revenue transaction statuses, cost model types, style names, source publishing divisions, and publication names should be managed via reference data tables."",
      ""The 'Contra Sheet Data' lookup should be a governed and regularly updated reference table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates the core Gross Revenue Amount with all applied business rules and transformations.\n-- It focuses on the most complex query (job_g0C_QrpRueq_Y03aHpxOoN1xe-AU) which is central to the 'Contra Report'.\n-- It includes the sheet account flag, advertiser name transformations, and all relevant filters.\n\nWITH base_revenue_data AS (\n  SELECT\n    t0.financial_year,\n    SAFE_CAST(t0.financial_month AS INT64) AS financial_month_no,\n    t0.financial_short_month,\n    t0.calendar_year_month,\n    t0.sales_segment_gm_name,\n    t0.portfolio_conformed_name_current,\n    IFNULL(t0.current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n    t0.advertiser_name AS original_advertiser_name,\n    t0.adpoint_account_number,\n    t0.revenue_type,\n    t0.relative_fy_year_offset,\n    CASE\n      WHEN t0.adpoint_account_number IN (\n        SELECT DISTINCT\n          NMBS_T_Number\n        FROM\n          `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`\n      ) THEN 'Y'\n      ELSE 'N'\n    END AS sheet_account_flag,\n    SUM(t0.gross_revenue_amount) AS gross_revenue_amount\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\n  WHERE\n    LOWER(LEFT(t0.advertiser_name, 3)) = 'ctr'\n    AND NOT (t0.cost_model_type = 'Guaranteed' AND t0.revenue_group_name = 'Exchange')\n    AND UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n    AND UPPER(IFNULL(t0.style_name, 'XXX')) <> 'ROP COMPOSITE'\n    AND UPPER(IFNULL(t0.source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n    AND (\n      UPPER(IFNULL(t0.publication_name, 'XXX')) NOT LIKE 'SUDDENLY%'\n      OR (\n        UPPER(t0.publication_name) LIKE 'SUDDENLY%'\n        AND (\n          t0.account_number IN ('17114', '29172', '52809')\n          OR t0.adtype_name = '-'\n        )\n      )\n    )\n    -- Sample data for recent activity, adjust as needed\n    AND SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH)\n  GROUP BY\n    t0.financial_year,\n    financial_month_no,\n    t0.financial_short_month,\n    t0.calendar_year_month,\n    t0.sales_segment_gm_name,\n    t0.portfolio_conformed_name_current,\n    current_portfolio_conformed_owner_full,\n    original_advertiser_name,\n    t0.adpoint_account_number,\n    t0.revenue_type,\n    t0.relative_fy_year_offset,\n    sheet_account_flag\n),\ntransformed_advertiser_data AS (\n  SELECT\n    *,\n    CASE\n      WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'ctr1'\n      ELSE SAFE_CAST(adpoint_account_number AS STRING)\n    END AS adpoint_account_number_transformed_level1,\n    CASE\n      WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'\n      ELSE original_advertiser_name\n    END AS advertiser_name_transformed_level2\n  FROM\n    base_revenue_data\n)\nSELECT\n  financial_year,\n  financial_month_no,\n  financial_short_month,\n  calendar_year_month,\n  sales_segment_gm_name,\n  portfolio_conformed_name_current,\n  current_portfolio_conformed_owner_full,\n  original_advertiser_name,\n  adpoint_account_number,\n  adpoint_account_number_transformed_level1,\n  advertiser_name_transformed_level2,\n  revenue_type,\n  sheet_account_flag,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount\nFROM\n  transformed_advertiser_data\nGROUP BY\n  financial_year,\n  financial_month_no,\n  financial_short_month,\n  calendar_year_month,\n  sales_segment_gm_name,\n  portfolio_conformed_name_current,\n  current_portfolio_conformed_owner_full,\n  original_advertiser_name,\n  adpoint_account_number,\n  adpoint_account_number_transformed_level1,\n  advertiser_name_transformed_level2,\n  revenue_type,\n  sheet_account_flag\nORDER BY\n  calendar_year_month DESC, total_gross_revenue_amount DESC\nLIMIT 100;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.calendar_year_month AS STRING)) AS unique_calendar_months,\n  COUNT(DISTINCT t0.adpoint_account_number) AS unique_adpoint_accounts,\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT t0.sales_segment_gm_name) AS unique_sales_gms,\n  MIN(SAFE_CAST(t0.calendar_year_month || '-01' AS DATE)) AS earliest_calendar_month,\n  MAX(SAFE_CAST(t0.calendar_year_month || '-01' AS DATE)) AS latest_calendar_month,\n  APPROX_COUNT_DISTINCT(t0.adpoint_account_number || '-' || t0.calendar_year_month) AS approx_unique_revenue_entries\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.adpoint_account_number) > 0 THEN 'PASS' ELSE 'FAIL' END AS unique_accounts_test,\n  CASE WHEN MAX(SAFE_CAST(t0.calendar_year_month || '-01' AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(CASE WHEN UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS billed_booked_status_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Revenue Transaction Status Distribution' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) = 'BILLED' THEN 1 ELSE 0 END) AS billed_records,\n  SUM(CASE WHEN UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) = 'BOOKED' THEN 1 ELSE 0 END) AS booked_records,\n  SUM(CASE WHEN UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) NOT IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS other_status_records,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS billed_booked_percentage,\n  'Advertiser Name Starts With CTR' AS rule_name_2,\n  SUM(CASE WHEN LOWER(LEFT(t0.advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END) AS ctr_advertiser_records,\n  SAFE_DIVIDE(SUM(CASE WHEN LOWER(LEFT(t0.advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS ctr_advertiser_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis from the primary revenue table\nSELECT\n  SAFE_CAST(t0.financial_year AS INT64) AS financial_year,\n  SAFE_CAST(t0.financial_month AS INT64) AS financial_month_no,\n  t0.financial_short_month,\n  t0.calendar_year_month,\n  t0.sales_segment_gm_name,\n  t0.portfolio_conformed_name_current,\n  IFNULL(t0.current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n  t0.advertiser_name,\n  t0.adpoint_account_number,\n  t0.revenue_type,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  t0.cost_model_type,\n  t0.revenue_group_name,\n  t0.revenue_transaction_status,\n  t0.style_name,\n  t0.source_publishing_division,\n  t0.publication_name,\n  t0.account_number,\n  t0.adtype_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) DESC,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Contra'"",
            ""'Renee Sycamore'""
          ],
          ""context"": ""Filtering `nca_industry_pillar` and `sales_segment_gm_name` in Query 1."",
          ""suggested_governance"": ""These values should be configurable parameters or derived from a business unit/sales hierarchy table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'13019'"",
            ""'52246'"",
            ""'18387'""
          ],
          ""context"": ""Specific `adpoint_account_number` values used to create `ctr1` alias in Query 2."",
          ""suggested_governance"": ""These account numbers should be part of a 'Contra Account' lookup table, allowing for easier updates and transparency."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
          ],
          ""context"": ""Specific string used to re-categorize `advertiser_name` based on `ctr1` alias in Query 2."",
          ""suggested_governance"": ""This complex string should be defined in a configuration table or a dedicated 'Contra Advertiser Grouping' lookup table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Guaranteed'"",
            ""'Exchange'"",
            ""'BILLED'"",
            ""'BOOKED'"",
            ""'ROP COMPOSITE'"",
            ""'MEDIUM RARE CONTENT AGENCY'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'"",
            ""'-'"",
            ""'VACANT'"",
            ""'XXX'""
          ],
          ""context"": ""Various filters and default values for `cost_model_type`, `revenue_group_name`, `revenue_transaction_status`, `style_name`, `source_publishing_division`, `publication_name`, `account_number`, `adtype_name`, and `current_portfolio_conformed_owner_full` in Query 2."",
          ""suggested_governance"": ""These operational values should be managed in reference data tables or configuration tables to ensure consistency and ease of update."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CTR_2023_AFL SPORT'"",
            ""'CTR_2023_GWS GIANTS'"",
            ""'CTR_2023_SYDNEY SWANS'"",
            ""'CTR_2025_Greater Western Sydney Giants'"",
            ""'CTR_2025_Raising Literacy Australia'""
          ],
          ""context"": ""Specific `advertiser_name` values used for filtering in Query 3."",
          ""suggested_governance"": ""These specific advertiser names should be part of a 'Contra Advertiser List' lookup table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded account numbers and advertiser names with joins to governed reference tables (e.g., `contra_accounts_lookup`, `advertiser_groupings`)."",
      ""Replace hardcoded filter values (e.g., 'Contra', 'Renee Sycamore', 'BILLED', 'BOOKED') with dashboard parameters or configuration tables."",
      ""Consider externalizing complex `CASE` logic for advertiser name transformations into a dedicated UDF or a mapping table for better maintainability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_sum"",
      ""metric_name"": ""Gross Revenue Amount (Sum)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""advertiser_name_transformed_level2"",
        ""sheet_account_flag"",
        ""revenue_transaction_status_filter"",
        ""cost_model_type_filter"",
        ""style_name_filter"",
        ""source_publishing_division_filter"",
        ""publication_name_filter""
      ],
      ""business_description"": ""The total gross revenue amount, aggregated by various dimensions, after applying specific business rules and exclusions related to contra accounts and revenue types."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount) from `v_adsales_revenue_client_daily` after applying multiple WHERE clauses and CASE transformations."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily"",
        ""ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data""
      ],
      ""filters_applied"": [
        ""advertiser_name starts with 'ctr'"",
        ""cost_model_type is not 'Guaranteed' AND revenue_group_name is not 'Exchange'"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""complex publication_name logic (NOT LIKE 'SUDDENLY%' OR (LIKE 'SUDDENLY%' AND (account_number IN ('17114', '29172', '52809') OR adtype_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is the primary financial metric for the Contra Report, showing revenue attributed to specific contra accounts and categories."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Exchange'"",
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'"",
        ""'-'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be externalized."",
        ""Complex publication name logic should be simplified or managed via a lookup.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on `IFNULL` with 'XXX' suggests potential nulls in source data."",
        ""Accuracy depends on the `contra_sheet_data` lookup table freshness.""
      ]
    },
    {
      ""metric_id"": ""record_count_accounts"",
      ""metric_name"": ""Account Record Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""advertiser_name_filtered_list""
      ],
      ""business_description"": ""A count of records (likely unique account-adpoint account pairs) filtered by specific advertiser names, used for understanding the volume of specific contra accounts."",
      ""sql_logic"": ""COUNT(1) GROUP BY account_number, adpoint_account_number FROM `details_dashboard`"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of specific contra accounts, potentially used for validation or high-level overview."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CTR_2023_AFL SPORT'"",
        ""'CTR_2023_GWS GIANTS'"",
        ""'CTR_2023_SYDNEY SWANS'"",
        ""'CTR_2025_Greater Western Sydney Giants'"",
        ""'CTR_2025_Raising Literacy Australia'""
      ],
      ""governance_issues"": [
        ""Hardcoded advertiser names should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_portfolio_conformed_owner_full"",
      ""metric_name"": ""Current Portfolio Conformed Owner Full"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The full name of the current portfolio conformed owner, defaulting to 'VACANT' if null."",
      ""sql_logic"": ""IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping revenue by the responsible portfolio owner."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'""
      ],
      ""governance_issues"": [
        ""Default 'VACANT' value is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""nca_industry_pillar"",
      ""metric_name"": ""NCA Industry Pillar"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The industry pillar classification for the account."",
      ""sql_logic"": ""t0.nca_industry_pillar"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""nca_industry_pillar = 'Contra'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter data specifically for 'Contra' related accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Contra'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter value 'Contra'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_gm_name"",
      ""metric_name"": ""Sales Segment GM Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the General Manager for the sales segment."",
      ""sql_logic"": ""t0.sales_segment_gm_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""sales_segment_gm_name IN ('Renee Sycamore')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter and group data by specific sales managers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Renee Sycamore'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter value 'Renee Sycamore'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adpoint_account_number"",
      ""metric_name"": ""Adpoint Account Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unique account number from the Adpoint system."",
      ""sql_logic"": ""t0.adpoint_account_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key identifier for accounts, used for grouping and transformations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name_original"",
      ""metric_name"": ""Advertiser Name (Original)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The original name of the advertiser as it appears in the source system."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""lower(left(advertiser_name, 3)) = 'ctr'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Base dimension for advertiser, subject to further transformations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ctr'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter 'ctr'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name_transformed_level1"",
      ""metric_name"": ""Advertiser Name (Transformed Level 1)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""adpoint_account_number""
      ],
      ""business_description"": ""An intermediate transformation of `adpoint_account_number` to 'ctr1' for specific accounts, otherwise retaining the original account number."",
      ""sql_logic"": ""CASE WHEN (clmn0_ IN ('13019', '52246', '18387')) THEN 'ctr1' ELSE clmn0_ END"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a flag to group specific contra accounts before further advertiser name transformation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'13019'"",
        ""'52246'"",
        ""'18387'"",
        ""'ctr1'""
      ],
      ""governance_issues"": [
        ""Hardcoded account numbers and 'ctr1' alias.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name_transformed_level2"",
      ""metric_name"": ""Advertiser Name (Transformed Level 2)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""advertiser_name_transformed_level1"",
        ""advertiser_name_original""
      ],
      ""business_description"": ""The final transformed advertiser name, which groups specific 'ctr1' accounts into a consolidated 'CTR_2023_AFL Sports...' name, otherwise retaining the original advertiser name."",
      ""sql_logic"": ""CASE WHEN (clmn9_ = 'ctr1') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE clmn1_ END"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""The primary advertiser dimension used for reporting, consolidating specific contra accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ctr1'"",
        ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'ctr1' alias and the long consolidated advertiser name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_year_month"",
      ""metric_name"": ""Calendar Year Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar year and month (e.g., '2023-01')."",
      ""sql_logic"": ""t0.calendar_year_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for monthly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for financial year reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sheet_account_flag"",
      ""metric_name"": ""Contra Sheet Account Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""adpoint_account_number""
      ],
      ""business_description"": ""A flag ('Y' or 'N') indicating if an `adpoint_account_number` is present in the `contra_sheet_data` table."",
      ""sql_logic"": ""CASE WHEN adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) THEN 'Y' ELSE 'N' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily"",
        ""ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for identifying and categorizing 'contra' accounts based on a specific lookup list."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'N'""
      ],
      ""governance_issues"": [
        ""Reliance on an external lookup table (`contra_sheet_data`) which needs to be governed and kept up-to-date.""
      ],
      ""data_quality_concerns"": [
        ""Data freshness and accuracy of `contra_sheet_data` directly impacts this flag.""
      ]
    },
    {
      ""metric_id"": ""revenue_transaction_status_filter"",
      ""metric_name"": ""Revenue Transaction Status Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Filters revenue transactions to include only those with status 'BILLED' or 'BOOKED'."",
      ""sql_logic"": ""UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Ensures only recognized revenue transactions are included in calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'XXX'""
      ],
      ""governance_issues"": [
        ""Hardcoded status values and default 'XXX'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cost_model_type_filter"",
      ""metric_name"": ""Cost Model Type Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Excludes revenue from 'Guaranteed' cost model type and 'Exchange' revenue group name combinations."",
      ""sql_logic"": ""NOT(cost_model_type = 'Guaranteed' AND revenue_group_name = 'Exchange')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Excludes specific types of revenue that are not relevant for this report."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Exchange'""
      ],
      ""governance_issues"": [
        ""Hardcoded cost model type and revenue group name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""style_name_filter"",
      ""metric_name"": ""Style Name Exclusion Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Excludes revenue transactions where the style name is 'ROP COMPOSITE'."",
      ""sql_logic"": ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Removes specific style-related revenue that is not relevant."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ROP COMPOSITE'"",
        ""'XXX'""
      ],
      ""governance_issues"": [
        ""Hardcoded style name and default 'XXX'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division_filter"",
      ""metric_name"": ""Source Publishing Division Exclusion Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Excludes revenue transactions from 'MEDIUM RARE CONTENT AGENCY' publishing division."",
      ""sql_logic"": ""UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Removes revenue from a specific publishing division not relevant for this report."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'XXX'""
      ],
      ""governance_issues"": [
        ""Hardcoded division name and default 'XXX'.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_name_filter"",
      ""metric_name"": ""Publication Name Exclusion Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Complex filter for publication names, generally excluding those starting with 'SUDDENLY%' unless specific account numbers or adtype are present."",
      ""sql_logic"": ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (account_number IN ('17114', '29172', '52809') OR adtype_name = '-')))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Specific business rule for including/excluding revenue based on publication and account details."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'"",
        ""'-'"",
        ""'XXX'""
      ],
      ""governance_issues"": [
        ""Hardcoded publication name pattern, account numbers, adtype, and default 'XXX'. This logic is complex and prone to errors if not well-documented and governed.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_amount_sum"",
      ""related_metrics"": [
        ""advertiser_name_transformed_level2"",
        ""sheet_account_flag"",
        ""revenue_transaction_status_filter"",
        ""cost_model_type_filter"",
        ""style_name_filter"",
        ""source_publishing_division_filter"",
        ""publication_name_filter""
      ],
      ""relationship_description"": ""The `gross_revenue_amount_sum` is directly impacted by all listed filters and is aggregated by the transformed advertiser name and the sheet account flag."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [all filters apply] GROUP BY [dimensions including transformed_advertiser_name, sheet_account_flag]"",
      ""business_validation"": ""Ensures that only relevant and correctly categorized revenue is included in the Contra Report."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE NOT (UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')) LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""advertiser_name_transformed_level2"",
      ""related_metrics"": [
        ""advertiser_name_transformed_level1"",
        ""advertiser_name_original""
      ],
      ""relationship_description"": ""The final `advertiser_name_transformed_level2` is derived from `advertiser_name_transformed_level1` (which itself depends on `adpoint_account_number`) and the `advertiser_name_original`."",
      ""mathematical_formula"": ""CASE WHEN (advertiser_name_transformed_level1 = 'ctr1') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name_original END"",
      ""business_validation"": ""This transformation consolidates specific 'contra' accounts under a single, descriptive name for reporting purposes."",
      ""validation_sql"": ""SELECT adpoint_account_number, advertiser_name, CASE WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'ctr1' ELSE SAFE_CAST(adpoint_account_number AS STRING) END AS transformed_level1, CASE WHEN (CASE WHEN SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') THEN 'ctr1' ELSE SAFE_CAST(adpoint_account_number AS STRING) END) = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END AS transformed_level2 FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE SAFE_CAST(adpoint_account_number AS STRING) IN ('13019', '52246', '18387') LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""sheet_account_flag"",
      ""related_metrics"": [
        ""adpoint_account_number""
      ],
      ""relationship_description"": ""The `sheet_account_flag` is determined by whether the `adpoint_account_number` exists in the `contra_sheet_data` lookup table."",
      ""mathematical_formula"": ""CASE WHEN adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) THEN 'Y' ELSE 'N' END"",
      ""business_validation"": ""This flag correctly identifies accounts that are officially designated as 'contra' based on a master list."",
      ""validation_sql"": ""SELECT t1.adpoint_account_number, CASE WHEN t1.adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) THEN 'Y' ELSE 'N' END AS calculated_flag FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t1 WHERE t1.adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`) LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,35
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6f1c8731-02da-464f-b146-bf2947860735"",
    ""dashboard_name"": ""Programmatic Sales_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 1,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""PortfolioParentGroup"",
      ""PortfolioChildGroup"",
      ""TransactionType"",
      ""FinancialYear"",
      ""FinancialQuarter"",
      ""FinancialMonthNumber"",
      ""FiscalMonthStartDate""
    ],
    ""date_range_detected"": ""Data filtered up to 2025-06-26 and specific to FY2025-Q4"",
    ""hardcoded_dates_found"": [
      ""2025-06-26""
    ],
    ""hardcoded_values_found"": [
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'Guaranteed'"",
      ""'FY2025 - Q4'"",
      ""'CONSORTIUM VIC'"",
      ""'Deal'"",
      ""'VIC CON B3'"",
      ""'VIC CON B2'"",
      ""'VIC CON B1'""
    ],
    ""governance_opportunities"": [
      ""Dates (e.g., '2025-06-26') should be replaced with dynamic parameters or CURRENT_DATE() for current reporting."",
      ""Fiscal month mapping (CASE statement) should be externalized to a configuration table or a UDF for maintainability."",
      ""Business unit/group names (e.g., 'INDEPENDENT AGENCIES NSW', 'CONSORTIUM VIC', 'VIC CON B3') and transaction types ('Guaranteed', 'Deal') should be managed in governed lookup tables."",
      ""Financial periods ('FY2025 - Q4') should be derived dynamically or selected via parameters.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.Advertiser,\n    t0.PortfolioParentGroup,\n    t0.RevenueGross,\n    t0.TransactionType,\n    t0.FinancialQuarter,\n    t0.FinancialYear,\n    t0.FinancialMonthNumber,\n    t0.PortfolioChildGroup,\n    -- Hardcoded reference date from query 3\n    DATE(DATETIME(TIMESTAMP '2025-06-26 07:36:48.083696+00', 'UTC')) AS hardcoded_ref_date_q3\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n  -- Add a general date filter for performance, covering relevant financial years\n  WHERE t0.FinancialYear >= 2023 AND t0.FinancialYear <= 2025\n),\nderived_dimensions AS (\n  SELECT\n    Advertiser,\n    PortfolioParentGroup,\n    SAFE_CAST(RevenueGross AS NUMERIC) AS RevenueGross, -- Cast early for consistency\n    TransactionType,\n    FinancialQuarter,\n    FinancialYear,\n    FinancialMonthNumber,\n    PortfolioChildGroup,\n    hardcoded_ref_date_q3,\n    -- Derived Financial Period (FY-Q)\n    CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) AS financial_period_fy_q,\n    -- Derived Fiscal Month Start Date (with fiscal month adjustment)\n    SAFE_CAST(DATETIME_TRUNC(DATE(FinancialYear,\n      CASE\n        WHEN (FinancialMonthNumber = 1) THEN 7\n        WHEN (FinancialMonthNumber = 2) THEN 8\n        WHEN (FinancialMonthNumber = 3) THEN 9\n        WHEN (FinancialMonthNumber = 4) THEN 10\n        WHEN (FinancialMonthNumber = 5) THEN 11\n        WHEN (FinancialMonthNumber = 6) THEN 12\n        WHEN (FinancialMonthNumber = 7) THEN 1\n        WHEN (FinancialMonthNumber = 8) THEN 2\n        WHEN (FinancialMonthNumber = 9) THEN 3\n        WHEN (FinancialMonthNumber = 10) THEN 4\n        WHEN (FinancialMonthNumber = 11) THEN 5\n        WHEN (FinancialMonthNumber = 12) THEN 6\n        ELSE NULL\n      END, 1), MONTH) AS DATE) AS fiscal_month_start_date,\n    -- Derived date for comparison in query 3\n    DATE(FinancialYear,\n      CASE\n        WHEN (FinancialMonthNumber = 1) THEN 7\n        WHEN (FinancialMonthNumber = 2) THEN 8\n        WHEN (FinancialMonthNumber = 3) THEN 9\n        WHEN (FinancialMonthNumber = 4) THEN 10\n        WHEN (FinancialMonthNumber = 5) THEN 11\n        WHEN (FinancialMonthNumber = 6) THEN 12\n        WHEN (FinancialMonthNumber = 7) THEN 1\n        WHEN (FinancialMonthNumber = 8) THEN 2\n        WHEN (FinancialMonthNumber = 9) THEN 3\n        WHEN (FinancialMonthNumber = 10) THEN 4\n        WHEN (FinancialMonthNumber = 11) THEN 5\n        WHEN (FinancialMonthNumber = 12) THEN 6\n        ELSE NULL\n      END, 1) AS derived_date_for_comparison_q3\n  FROM base_data\n)\nSELECT\n  -- Core Dimensions\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  financial_period_fy_q,\n  fiscal_month_start_date,\n  -- Core Metric (Total Gross Revenue without specific filters)\n  SUM(RevenueGross) AS total_gross_revenue,\n  -- Conditional Metric for Query 1 (Total Gross Revenue for Independent Agencies NSW, excluding Guaranteed)\n  SUM(CASE\n    WHEN PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW') AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL)\n    THEN RevenueGross\n    ELSE 0\n  END) AS total_gross_revenue_indep_nsw_filtered,\n  -- Flag for Query 2 context (Advertiser filter based on FY-Q)\n  MAX(CASE\n    WHEN financial_period_fy_q IN ('FY2025 - Q4')\n    THEN TRUE\n    ELSE FALSE\n  END) AS is_fy2025_q4_advertiser_context,\n  -- Flag for Query 3 context (Date, Portfolio, TransactionType, ChildGroup)\n  MAX(CASE\n    WHEN\n      derived_date_for_comparison_q3 <= hardcoded_ref_date_q3\n      AND PortfolioParentGroup IN ('CONSORTIUM VIC')\n      AND financial_period_fy_q IN ('FY2025 - Q4')\n      AND TransactionType IN ('Deal')\n      AND PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')\n    THEN TRUE\n    ELSE FALSE\n  END) AS is_vic_consortium_deal_context\nFROM derived_dimensions\nGROUP BY\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  financial_period_fy_q,\n  fiscal_month_start_date\nORDER BY\n  total_gross_revenue DESC\nLIMIT 500;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialQuarter AS STRING)) as unique_financial_periods,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT PortfolioParentGroup) as unique_parent_groups,\n  COUNT(DISTINCT PortfolioChildGroup) as unique_child_groups,\n  COUNT(DISTINCT TransactionType) as unique_transaction_types,\n  MIN(FinancialYear) as earliest_financial_year,\n  MAX(FinancialYear) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(Advertiser || PortfolioParentGroup || PortfolioChildGroup || SAFE_CAST(FinancialYear AS STRING) || SAFE_CAST(FinancialQuarter AS STRING) || SAFE_CAST(FinancialMonthNumber AS STRING)) as approx_unique_rows_at_fin_month_grain\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= 2023 AND FinancialYear <= 2025 -- Limit to relevant years for performance"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(RevenueGross AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(FinancialYear) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as data_freshness_test_financial_year,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(TransactionType AS STRING) IN ('Guaranteed', 'Deal') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_type_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Check recent data\nLIMIT 1"",
    ""business_rules_sql"": ""WITH fiscal_month_mapping_test AS (\n  SELECT\n    FinancialMonthNumber,\n    CASE\n      WHEN (FinancialMonthNumber = 1) THEN 7\n      WHEN (FinancialMonthNumber = 2) THEN 8\n      WHEN (FinancialMonthNumber = 3) THEN 9\n      WHEN (FinancialMonthNumber = 4) THEN 10\n      WHEN (FinancialMonthNumber = 5) THEN 11\n      WHEN (FinancialMonthNumber = 6) THEN 12\n      WHEN (FinancialMonthNumber = 7) THEN 1\n      WHEN (FinancialMonthNumber = 8) THEN 2\n      WHEN (FinancialMonthNumber = 9) THEN 3\n      WHEN (FinancialMonthNumber = 10) THEN 4\n      WHEN (FinancialMonthNumber = 11) THEN 5\n      WHEN (FinancialMonthNumber = 12) THEN 6\n      ELSE NULL\n    END AS adjusted_month,\n    COUNT(*) as record_count\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\n  WHERE FinancialYear = 2024 -- Sample a recent year\n  GROUP BY 1, 2\n  ORDER BY 1\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Fiscal Month Mapping' as rule_name,\n  (SELECT SUM(record_count) FROM fiscal_month_mapping_test) as total_records_tested,\n  (SELECT COUNT(DISTINCT FinancialMonthNumber) FROM fiscal_month_mapping_test WHERE adjusted_month IS NOT NULL) as distinct_months_mapped,\n  (SELECT COUNT(*) FROM fiscal_month_mapping_test WHERE adjusted_month IS NULL) as unmapped_months_count,\n  (SELECT MAX(CASE WHEN adjusted_month IS NOT NULL THEN 'PASS' ELSE 'FAIL' END) FROM fiscal_month_mapping_test) as mapping_completeness_check,\n  (SELECT MAX(CASE WHEN EXISTS(SELECT 1 FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE PortfolioParentGroup = 'INDEPENDENT AGENCIES NSW') THEN 'PASS' ELSE 'FAIL' END)) as indep_agencies_nsw_exists,\n  (SELECT MAX(CASE WHEN EXISTS(SELECT 1 FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) = 'FY2025 - Q4') THEN 'PASS' ELSE 'FAIL' END)) as fy2025_q4_exists\nFROM DUAL;"",
    ""sample_data_sql"": ""SELECT \n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  SAFE_CAST(RevenueGross AS NUMERIC) as RevenueGross,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= 2024 -- Get recent data\nORDER BY FinancialYear DESC, FinancialQuarter DESC, FinancialMonthNumber DESC, RevenueGross DESC\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-26"",
          ""original_format"": ""2025-06-26 07:36:48.083696+00"",
          ""context"": ""Used as a fixed reference date in a comparison (derived_date <= hardcoded_ref_date) for filtering data in Query 3."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() for current reporting or a parameter for dynamic selection."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'INDEPENDENT AGENCIES NSW'""
          ],
          ""context"": ""Filter for PortfolioParentGroup in Query 1."",
          ""suggested_governance"": ""Manage in a governed lookup table for agency groups."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Guaranteed'""
          ],
          ""context"": ""Exclusion filter for TransactionType in Query 1."",
          ""suggested_governance"": ""Manage in a governed lookup table for transaction types."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY2025 - Q4'""
          ],
          ""context"": ""Specific financial period filter in Query 2 and Query 3."",
          ""suggested_governance"": ""Derive dynamically based on current date and fiscal calendar, or use a parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM VIC'""
          ],
          ""context"": ""Filter for PortfolioParentGroup in Query 3."",
          ""suggested_governance"": ""Manage in a governed lookup table for agency groups."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Deal'""
          ],
          ""context"": ""Filter for TransactionType in Query 3."",
          ""suggested_governance"": ""Manage in a governed lookup table for transaction types."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'VIC CON B3'"",
            ""'VIC CON B2'"",
            ""'VIC CON B1'""
          ],
          ""context"": ""Filter for PortfolioChildGroup in Query 3."",
          ""suggested_governance"": ""Manage in a governed lookup table for child agency groups."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""1-12 mapping to 7-12, 1-6""
          ],
          ""context"": ""CASE statement for fiscal month adjustment in Query 3."",
          ""suggested_governance"": ""Externalize to a configuration table or a UDF for fiscal calendar logic."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., CURRENT_DATE())."",
      ""Replace hardcoded lookup values (e.g., agency groups, transaction types) with joins to governed reference tables."",
      ""Use configuration tables or UDFs for complex business rules like fiscal month mapping instead of hardcoded CASE statements."",
      ""Parameterize financial periods (e.g., 'FY2025 - Q4') to allow dynamic selection.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of gross revenue from programmatic advertising sales."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW')"",
        ""TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is a core revenue metric, specifically filtered for 'INDEPENDENT AGENCIES NSW' and excluding 'Guaranteed' transactions, indicating a focus on non-guaranteed programmatic revenue from a specific agency segment."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueGross"",
        ""correctness of TransactionType classification""
      ]
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic sales data."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Financial Period (FY-Q) IN ('FY2025 - Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting and analyzing sales performance by individual advertisers, particularly within the 'FY2025 - Q4' financial period."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for inconsistent naming or typos""
      ]
    },
    {
      ""metric_id"": ""financial_period_fy_q"",
      ""metric_name"": ""Financial Period (FY-Q)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A concatenated string representing the Financial Year and Financial Quarter (e.g., 'FY2025 - Q4')."",
      ""sql_logic"": ""CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Financial Period (FY-Q) IN ('FY2025 - Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key time dimension for reporting and analysis, aligning with the company's financial calendar. The hardcoded filter suggests a focus on a specific future or current quarter."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025 - Q4'""
      ],
      ""governance_issues"": [
        ""should be parameterised or derived dynamically""
      ],
      ""data_quality_concerns"": [
        ""potential for incorrect year/quarter values if source data is flawed""
      ]
    },
    {
      ""metric_id"": ""fiscal_month_start_date"",
      ""metric_name"": ""Fiscal Month Start Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calculated start date of the fiscal month, derived by adjusting the calendar month based on a specific fiscal year definition and then truncating to the month."",
      ""sql_logic"": ""DATETIME_TRUNC(DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 WHEN (t0.FinancialMonthNumber = 2) THEN 8 WHEN (t0.FinancialMonthNumber = 3) THEN 9 WHEN (t0.FinancialMonthNumber = 4) THEN 10 WHEN (t0.FinancialMonthNumber = 5) THEN 11 WHEN (t0.FinancialMonthNumber = 6) THEN 12 WHEN (t0.FinancialMonthNumber = 7) THEN 1 WHEN (t0.FinancialMonthNumber = 8) THEN 2 WHEN (t0.FinancialMonthNumber = 9) THEN 3 WHEN (t0.FinancialMonthNumber = 10) THEN 4 WHEN (t0.FinancialMonthNumber = 11) THEN 5 WHEN (t0.FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1), MONTH)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""DerivedDate <= '2025-06-26'"",
        ""PortfolioParentGroup IN ('CONSORTIUM VIC')"",
        ""Financial Period (FY-Q) IN ('FY2025 - Q4')"",
        ""TransactionType IN ('Deal')"",
        ""PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""This dimension is crucial for time-series analysis that aligns with the company's unique fiscal calendar. The complex filters indicate a highly specific view, likely for a particular business unit and transaction type within a defined period."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-26""
      ],
      ""hardcoded_values_in_metric"": [
        ""1-12 mapping to 7-12, 1-6 (fiscal month adjustment)"",
        ""'CONSORTIUM VIC'"",
        ""'FY2025 - Q4'"",
        ""'Deal'"",
        ""'VIC CON B3'"",
        ""'VIC CON B2'"",
        ""'VIC CON B1'""
      ],
      ""governance_issues"": [
        ""hardcoded reference date should be dynamic"",
        ""fiscal month mapping should be in a lookup table"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""correctness of fiscal month mapping logic"",
        ""potential for nulls if FinancialMonthNumber is outside 1-12""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""advertiser_name"",
        ""financial_period_fy_q"",
        ""fiscal_month_start_date""
      ],
      ""relationship_description"": ""The 'Total Gross Revenue' metric is filtered and aggregated based on specific combinations of 'Advertiser Name' (via PortfolioParentGroup), 'Financial Period (FY-Q)', and 'Fiscal Month Start Date' (via various filters on PortfolioParentGroup, PortfolioChildGroup, TransactionType, and a hardcoded date comparison)."",
      ""mathematical_formula"": ""SUM(RevenueGross) WHERE [specific filters from original queries]"",
      ""business_validation"": ""Ensures that revenue is reported for the correct segments and timeframes as defined by the business rules embedded in the dashboard queries."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW') AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q1,\n  SUM(CASE WHEN CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) = 'FY2025 - Q4' THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q2_context,\n  SUM(CASE WHEN \n    DATE(FinancialYear, \n      CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) <= DATE(DATETIME(TIMESTAMP '2025-06-26 07:36:48.083696+00', 'UTC'))\n    AND PortfolioParentGroup IN ('CONSORTIUM VIC')\n    AND CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) IN ('FY2025 - Q4')\n    AND TransactionType IN ('Deal')\n    AND PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')\n  THEN SAFE_CAST(RevenueGross AS NUMERIC) ELSE 0 END) AS revenue_q3_context\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= 2023 AND FinancialYear <= 2025;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fiscal_month_start_date"",
      ""related_metrics"": [
        ""FinancialYear"",
        ""FinancialMonthNumber""
      ],
      ""relationship_description"": ""The 'Fiscal Month Start Date' is a complex derived dimension that depends directly on the 'FinancialYear' and 'FinancialMonthNumber' columns, applying a specific fiscal month mapping logic."",
      ""mathematical_formula"": ""DATETIME_TRUNC(DATE(FinancialYear, FiscalMonthMapping(FinancialMonthNumber), 1), MONTH)"",
      ""business_validation"": ""Ensures that time-based reporting aligns with the company's internal fiscal calendar, which is critical for accurate financial analysis."",
      ""validation_sql"": ""SELECT \n  FinancialYear,\n  FinancialMonthNumber,\n  CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END AS adjusted_month,\n  SAFE_CAST(DATETIME_TRUNC(DATE(FinancialYear, CASE WHEN (FinancialMonthNumber = 1) THEN 7 WHEN (FinancialMonthNumber = 2) THEN 8 WHEN (FinancialMonthNumber = 3) THEN 9 WHEN (FinancialMonthNumber = 4) THEN 10 WHEN (FinancialMonthNumber = 5) THEN 11 WHEN (FinancialMonthNumber = 6) THEN 12 WHEN (FinancialMonthNumber = 7) THEN 1 WHEN (FinancialMonthNumber = 8) THEN 2 WHEN (FinancialMonthNumber = 9) THEN 3 WHEN (FinancialMonthNumber = 10) THEN 4 WHEN (FinancialMonthNumber = 11) THEN 5 WHEN (FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1), MONTH) AS DATE) AS calculated_fiscal_month_start_date\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear = 2024 AND FinancialMonthNumber IS NOT NULL\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,36
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e9d8a216-4950-4d30-b344-5011776edbdf"",
    ""dashboard_name"": ""Adex Report"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""date"",
      ""Major_Category"",
      ""Media_Network"",
      ""Media_Group"",
      ""Media_Type"",
      ""Is_Previous_Year_Period""
    ],
    ""date_range_detected"": ""2022-08-01 to 2024-06-01"",
    ""hardcoded_dates_found"": [
      ""Jun 24"",
      ""Aug 23""
    ],
    ""hardcoded_values_found"": [
      ""Retail"",
      ""NEWS CORP"",
      ""Jan"",
      ""Feb"",
      ""Mar"",
      ""Apr"",
      ""May"",
      ""Jun"",
      ""Jul"",
      ""Aug"",
      ""Sep"",
      ""Oct"",
      ""Nov"",
      ""Dec""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE(), DATE_SUB)"",
      ""Business categories ('Retail', 'NEWS CORP') should be managed via a lookup table or parameters for flexibility and consistency."",
      ""Month name to number conversion logic could be encapsulated in a UDF or a lookup table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  ),\n  adex_date_fact AS (\n    SELECT\n      Media_Type,\n      portfolio_parent_group_name,\n      date,\n      DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n      DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n    FROM\n      (\n        SELECT DISTINCT\n          Media_Type,\n          portfolio_parent_group_name\n        FROM\n          adex_data\n      )\n      CROSS JOIN\n      UNNEST(GENERATE_DATE_ARRAY((\n          SELECT\n            MIN(date)\n          FROM\n            adex_data\n        ), (\n          SELECT\n            MAX(date)\n          FROM\n            adex_data\n        ), INTERVAL 1 MONTH)) AS date\n  ),\n  adex_full_date AS (\n    SELECT\n      adf.*,\n      financial_year,\n      Major_Category,\n      Advertiser_Group___Advertiser,\n      Advertiser,\n      Media_Network,\n      Media_Group,\n      Ad_Type,\n      Brand,\n      Product,\n      Category,\n      Sub_Category,\n      Spend,\n      sales_segment_gm_name\n    FROM\n      adex_date_fact AS adf\n      LEFT JOIN\n      adex_data\n      ON adf.date = adex_data.date AND adf.Media_Type = adex_data.Media_Type AND adf.portfolio_parent_group_name =\n        adex_data.portfolio_parent_group_name\n  ),\n  base_adex_data AS (\n    SELECT\n      afd.*,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year,\n      SUM(Spend) OVER (PARTITION BY date) AS spend_monthly_agg,\n      latest_date\n    FROM\n      adex_full_date AS afd\n      CROSS JOIN\n      (\n        SELECT\n          MAX(adf.date) AS latest_date\n        FROM\n          adex_full_date AS adf\n      )\n  ),\n  -- Define date range parameters based on original hardcoded values\n  date_parameters AS (\n    SELECT\n      PARSE_DATE('%Y-%m-%d', CONCAT('20', SAFE_CAST(SAFE.RIGHT('Aug 23', 2) AS STRING), '-', LPAD(CAST(\n        CASE\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Jan' THEN 1\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Feb' THEN 2\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Mar' THEN 3\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Apr' THEN 4\n          WHEN SAFE.LEFT('Aug 23', 3) = 'May' THEN 5\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Jun' THEN 6\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Jul' THEN 7\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Aug' THEN 8\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Sep' THEN 9\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Oct' THEN 10\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Nov' THEN 11\n          WHEN SAFE.LEFT('Aug 23', 3) = 'Dec' THEN 12\n          ELSE NULL\n        END AS STRING), 2, '0'), '-01')) AS current_period_start_date,\n      PARSE_DATE('%Y-%m-%d', CONCAT('20', SAFE_CAST(SAFE.RIGHT('Jun 24', 2) AS STRING), '-', LPAD(CAST(\n        CASE\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Jan' THEN 1\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Feb' THEN 2\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Mar' THEN 3\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Apr' THEN 4\n          WHEN SAFE.LEFT('Jun 24', 3) = 'May' THEN 5\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Jun' THEN 6\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Jul' THEN 7\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Aug' THEN 8\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Sep' THEN 9\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Oct' THEN 10\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Nov' THEN 11\n          WHEN SAFE.LEFT('Jun 24', 3) = 'Dec' THEN 12\n          ELSE NULL\n        END AS STRING), 2, '0'), '-01')) AS current_period_end_date\n  )\nSELECT\n  b.date,\n  b.Major_Category,\n  b.Media_Network,\n  b.Media_Group,\n  b.Media_Type,\n  -- Dimensions\n  (SAFE_CAST(b.date AS DATETIME) >= DATE_ADD(p.current_period_start_date, INTERVAL -12 MONTH) AND SAFE_CAST(b.date AS DATETIME) <= DATE_ADD(p.current_period_end_date, INTERVAL -12 MONTH)) AS is_previous_year_period,\n  -- Metrics\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(b.date AS DATETIME) >= p.current_period_start_date AND SAFE_CAST(b.date AS DATETIME) <= p.current_period_end_date THEN b.Spend ELSE 0 END AS NUMERIC)) AS spend_current_period,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(b.date AS DATETIME) >= DATE_ADD(p.current_period_start_date, INTERVAL -12 MONTH) AND SAFE_CAST(b.date AS DATETIME) <= DATE_ADD(p.current_period_end_date, INTERVAL -12 MONTH) THEN b.Spend ELSE 0 END AS NUMERIC)) AS spend_previous_year,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(b.date AS DATETIME) >= p.current_period_start_date AND SAFE_CAST(b.date AS DATETIME) <= p.current_period_end_date AND b.Media_Network = 'NEWS CORP' THEN b.Spend ELSE 0 END AS NUMERIC)) AS spend_current_period_newscorp,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(b.date AS DATETIME) >= DATE_ADD(p.current_period_start_date, INTERVAL -12 MONTH) AND SAFE_CAST(b.date AS DATETIME) <= DATE_ADD(p.current_period_end_date, INTERVAL -12 MONTH) AND b.Media_Network = 'NEWS CORP' THEN b.Spend ELSE 0 END AS NUMERIC)) AS spend_previous_year_newscorp,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(b.date AS DATETIME) >= DATE_ADD(p.current_period_start_date, INTERVAL -12 MONTH) AND SAFE_CAST(b.date AS DATETIME) <= DATE_ADD(p.current_period_end_date, INTERVAL -12 MONTH) AND b.Major_Category = 'Retail' THEN b.Spend ELSE 0 END AS NUMERIC)) AS spend_previous_year_retail,\n  SUM(SAFE_CAST(b.Spend AS NUMERIC)) AS base_spend_amount\nFROM\n  base_adex_data AS b\n  CROSS JOIN\n  date_parameters AS p\nGROUP BY\n  b.date,\n  b.Major_Category,\n  b.Media_Network,\n  b.Media_Group,\n  b.Media_Type,\n  is_previous_year_period\nORDER BY\n  b.date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  column_name,\n  data_type,\n  is_nullable\nFROM \n  `ncau-data-newsquery-prd`.sbx_dcp.INFORMATION_SCHEMA.COLUMNS\nWHERE \n  table_name = 'adex_datasource'\nORDER BY \n  column_name\nLIMIT 100;"",
    ""validation_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  )\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_count_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(date AS DATE)) > 0 THEN 'PASS' ELSE 'FAIL' END AS unique_dates_test,\n  CASE WHEN SUM(SAFE_CAST(Spend AS NUMERIC)) IS NOT NULL AND SUM(SAFE_CAST(Spend AS NUMERIC)) >= 0 THEN 'PASS' ELSE 'FAIL' END AS spend_positive_test,\n  CASE WHEN MAX(SAFE_CAST(date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test_30_days,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(Media_Type AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_media_types_test\nFROM\n  adex_data\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Retail Category Spend Check' AS rule_name,\n  COUNT(CASE WHEN SAFE_CAST(Major_Category AS STRING) = 'Retail' THEN 1 END) AS total_retail_records,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(Major_Category AS STRING) = 'Retail' THEN Spend ELSE 0 END AS NUMERIC)) AS total_retail_spend,\n  'NEWS CORP Media Network Spend Check' AS rule_name_2,\n  COUNT(CASE WHEN SAFE_CAST(Media_Network AS STRING) = 'NEWS CORP' THEN 1 END) AS total_newscorp_records,\n  SUM(SAFE_CAST(CASE WHEN SAFE_CAST(Media_Network AS STRING) = 'NEWS CORP' THEN Spend ELSE 0 END AS NUMERIC)) AS total_newscorp_spend\nFROM\n  adex_data\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(date AS DATE) AS date,\n  SAFE_CAST(Media_Type AS STRING) AS media_type,\n  SAFE_CAST(portfolio_parent_group_name AS STRING) AS portfolio_parent_group_name,\n  SAFE_CAST(Major_Category AS STRING) AS major_category,\n  SAFE_CAST(Media_Network AS STRING) AS media_network,\n  SAFE_CAST(Spend AS NUMERIC) AS spend_amount,\n  SAFE_CAST(financial_year AS STRING) AS financial_year\nFROM \n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE \n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY)\nORDER BY \n  date DESC, spend_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""Jun 24"",
          ""original_format"": ""Jun 24"",
          ""context"": ""Used to derive the end month and year for the current period date range."",
          ""suggested_fix"": ""Replace with a dashboard parameter or derive dynamically from CURRENT_DATE()."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""Aug 23"",
          ""original_format"": ""Aug 23"",
          ""context"": ""Used to derive the start month and year for the current period date range."",
          ""suggested_fix"": ""Replace with a dashboard parameter or derive dynamically from CURRENT_DATE()."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Retail'""
          ],
          ""context"": ""Filters 'Major_Category' for 'Spend_PY_Retail' metric."",
          ""suggested_governance"": ""Use a configuration table for major categories or a dashboard parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'NEWS CORP'""
          ],
          ""context"": ""Filters 'Media_Network' for 'Spend_CP_NewsCorp' and 'Spend_PY_NewsCorp' metrics."",
          ""suggested_governance"": ""Use a configuration table for media networks or a dashboard parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Converts month abbreviations to month numbers for date parsing."",
          ""suggested_governance"": ""Encapsulate in a UDF or use a small lookup table for month names."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded date strings ('Jun 24', 'Aug 23') with Looker Studio date range parameters or BigQuery's `CURRENT_DATE()` and `DATE_SUB`/`DATE_ADD` functions to define relative periods."",
      ""Introduce dashboard parameters for 'Major_Category' and 'Media_Network' filters (e.g., `p_major_category`, `p_media_network`) to allow users to dynamically select values."",
      ""Consider creating a BigQuery User-Defined Function (UDF) for month name to number conversion to centralize and simplify date parsing logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""date"",
      ""metric_name"": ""Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The reporting date, typically the first day of the month, representing the period for which spend data is recorded."",
      ""sql_logic"": ""t0.date"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for all spend analysis and period-over-period comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""major_category"",
      ""metric_name"": ""Major Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The high-level category of the advertiser, e.g., 'Retail'."",
      ""sql_logic"": ""t0.Major_Category"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting spend by industry or business type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_network"",
      ""metric_name"": ""Media Network"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific media network where the advertising spend occurred, e.g., 'NEWS CORP'."",
      ""sql_logic"": ""t0.Media_Network"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing spend distribution across different media entities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_group"",
      ""metric_name"": ""Media Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The broader group to which a media network belongs."",
      ""sql_logic"": ""t0.Media_Group"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for higher-level aggregation of spend across media entities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_type"",
      ""metric_name"": ""Media Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of media used for advertising, e.g., 'Digital', 'Print'."",
      ""sql_logic"": ""t0.Media_Type"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides insight into the mix of advertising channels used."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_previous_year_period"",
      ""metric_name"": ""Is Previous Year Period"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""date""],
      ""business_description"": ""A boolean flag indicating if the record's date falls within the defined previous year period (2022-08-01 to 2023-06-01). This is derived from the hardcoded date logic in the original queries."",
      ""sql_logic"": ""SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2022-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2023-06-01')"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to categorize data points into current or previous year for comparative analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2022-08-01"", ""2023-06-01""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Date range is hardcoded and should be parameterized.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_current_period"",
      ""metric_name"": ""Spend (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""base_spend_amount"", ""date""],
      ""business_description"": ""Total advertising spend within the defined current period (2023-08-01 to 2024-06-01)."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2023-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2024-06-01') THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [""date range filter""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core metric for current performance assessment, often compared with previous periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2023-08-01"", ""2024-06-01""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Date range is hardcoded and should be parameterized.""],
      ""data_quality_concerns"": [""Potential nulls in Spend if no data for a date/dimension combination.""]
    },
    {
      ""metric_id"": ""spend_previous_year"",
      ""metric_name"": ""Spend (Previous Year)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""base_spend_amount"", ""date""],
      ""business_description"": ""Total advertising spend within the defined previous year period (2022-08-01 to 2023-06-01)."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2022-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2023-06-01') THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [""date range filter""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Crucial for year-over-year performance comparison and trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2022-08-01"", ""2023-06-01""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Date range is hardcoded and should be parameterized.""],
      ""data_quality_concerns"": [""Potential nulls in Spend if no data for a date/dimension combination.""]
    },
    {
      ""metric_id"": ""spend_current_period_newscorp"",
      ""metric_name"": ""Spend (Current Period, NEWS CORP)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""base_spend_amount"", ""date"", ""media_network""],
      ""business_description"": ""Total advertising spend for 'NEWS CORP' media network within the current period (2023-08-01 to 2024-06-01)."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2023-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2024-06-01') AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [""date range filter"", ""Media_Network = 'NEWS CORP'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Specific spend analysis for a key media partner."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2023-08-01"", ""2024-06-01""],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'""],
      ""governance_issues"": [""Date range and 'NEWS CORP' filter are hardcoded.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_previous_year_newscorp"",
      ""metric_name"": ""Spend (Previous Year, NEWS CORP)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""base_spend_amount"", ""date"", ""media_network""],
      ""business_description"": ""Total advertising spend for 'NEWS CORP' media network within the previous year period (2022-08-01 to 2023-06-01)."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2022-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2023-06-01') AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [""date range filter"", ""Media_Network = 'NEWS CORP'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Year-over-year comparison for 'NEWS CORP' spend."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2022-08-01"", ""2023-06-01""],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'""],
      ""governance_issues"": [""Date range and 'NEWS CORP' filter are hardcoded.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_previous_year_retail"",
      ""metric_name"": ""Spend (Previous Year, Retail)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""base_spend_amount"", ""date"", ""major_category""],
      ""business_description"": ""Total advertising spend for 'Retail' major category within the previous year period (2022-08-01 to 2023-06-01)."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE_CAST(date AS DATETIME) >= PARSE_DATETIME('%Y-%m-%d', '2022-08-01') AND SAFE_CAST(date AS DATETIME) <= PARSE_DATETIME('%Y-%m-%d', '2023-06-01') AND Major_Category = 'Retail' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [""date range filter"", ""Major_Category = 'Retail'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Specific spend analysis for the 'Retail' sector."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2022-08-01"", ""2023-06-01""],
      ""hardcoded_values_in_metric"": [""'Retail'""],
      ""governance_issues"": [""Date range and 'Retail' filter are hardcoded.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""base_spend_amount"",
      ""metric_name"": ""Base Spend Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend""],
      ""business_description"": ""The raw advertising spend amount for the given date, major category, media network, media group, and media type combination. This is the foundational spend value from which other metrics are derived."",
      ""sql_logic"": ""SUM(Spend)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Represents the most granular spend data available for analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""spend_current_period"",
      ""related_metrics"": [""spend_previous_year""],
      ""relationship_description"": ""Year-over-year comparison of total advertising spend."",
      ""mathematical_formula"": ""Spend_CP_YoY_Growth = (Spend_CP - Spend_PY) / Spend_PY"",
      ""business_validation"": ""Measures the growth or decline in advertising spend compared to the same period in the previous year, indicating business performance trends."",
      ""validation_sql"": ""SELECT (SUM(spend_current_period) - SUM(spend_previous_year)) / NULLIF(SUM(spend_previous_year), 0) FROM your_unified_query_result"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""spend_current_period_newscorp"",
      ""related_metrics"": [""spend_current_period"", ""media_network""],
      ""relationship_description"": ""Spend for 'NEWS CORP' is a subset of total current period spend, filtered by Media_Network."",
      ""mathematical_formula"": ""Spend_CP_NewsCorp <= Spend_CP"",
      ""business_validation"": ""Highlights the contribution of 'NEWS CORP' to the overall current period advertising spend."",
      ""validation_sql"": ""SELECT SUM(spend_current_period_newscorp) <= SUM(spend_current_period) FROM your_unified_query_result"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""spend_previous_year_retail"",
      ""related_metrics"": [""spend_previous_year"", ""major_category""],
      ""relationship_description"": ""Spend for 'Retail' is a subset of total previous year spend, filtered by Major_Category."",
      ""mathematical_formula"": ""Spend_PY_Retail <= Spend_PY"",
      ""business_validation"": ""Highlights the contribution of the 'Retail' category to the overall previous year advertising spend."",
      ""validation_sql"": ""SELECT SUM(spend_previous_year_retail) <= SUM(spend_previous_year) FROM your_unified_query_result"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""base_spend_amount"",
      ""related_metrics"": [""media_type""],
      ""relationship_description"": ""The 'Total Spend by Media Type' metric (from original query 3) is an aggregation of 'Base Spend Amount' grouped solely by 'Media Type'."",
      ""mathematical_formula"": ""Total_Spend_by_MediaType = SUM(base_spend_amount) GROUP BY media_type"",
      ""business_validation"": ""This relationship shows how granular spend data rolls up to higher-level summaries, providing different perspectives on spend distribution."",
      ""validation_sql"": ""SELECT media_type, SUM(base_spend_amount) FROM your_unified_query_result GROUP BY media_type"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,37
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d05b3d29-4437-4ee5-987a-e0109eb9590e"",
    ""dashboard_name"": ""Digi Subsifying"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 30,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_year"",
      ""fiscal_quarter"",
      ""fiscal_month"",
      ""fiscal_week"",
      ""masthead_group"",
      ""recognition_type"",
      ""is_digital_platform_subscription"",
      ""gl_publication_code"",
      ""masthead_code"",
      ""delivery_medium_type"",
      ""dw_billing_system_code"",
      ""rate_plan_group_name"",
      ""table_union_source""
    ],
    ""date_range_detected"": ""Fiscal Year 2025, with calculations relative to 2024-07-03"",
    ""hardcoded_dates_found"": [
      ""2025-04-01"",
      ""2024-07-03"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'The Australian'"",
      ""'Metros'"",
      ""'Regionals'"",
      ""'Others'"",
      ""'Deep Niche Publications'"",
      ""'Discontinued'"",
      ""'Print Recognition'"",
      ""'Digital Recognition'"",
      ""'APLP'"",
      ""'APLS'"",
      ""'GPLA'"",
      ""'SWG'"",
      ""'Racenet'"",
      ""'Supercoach Plus'"",
      ""'Townsville'"",
      ""'Code'"",
      ""'Herald Sun'"",
      ""'Toowoomba'"",
      ""'Geelong'"",
      ""'The Mercury'"",
      ""'Punters'"",
      ""'Daily Telegraph'"",
      ""'The Advertiser'"",
      ""'Cairns Post'"",
      ""'Gold Coast'"",
      ""'Courier Mail'"",
      ""'NT News'"",
      ""'Apple Podcast: Crime X'"",
      ""'Taste Online'"",
      ""'The Oz'"",
      ""'news.com.au'"",
      ""'Brain Games'"",
      ""'Suddenly'"",
      ""'News Corporate'"",
      ""'Group Newspaper Management - Digital'"",
      ""'subsnapfact'"",
      ""'budgetforecast'"",
      ""'bmasnap_move'"",
      ""'bmasnap_close'"",
      ""'exclsionnetcancels'"",
      ""'nfmanualhist'"",
      ""'SC - CODE Manual APLS'"",
      ""'SC Manual APLS'"",
      ""'Taste Manual APLS'"",
      ""'Taste Manual GPLA'"",
      ""'Taste Manual PRES'"",
      ""121"",
      ""9644"",
      ""9903"",
      ""100"",
      ""101"",
      ""103"",
      ""110"",
      ""111"",
      ""116"",
      ""301"",
      ""302"",
      ""303"",
      ""305"",
      ""307"",
      ""350"",
      ""351"",
      ""400"",
      ""401"",
      ""402"",
      ""450"",
      ""460"",
      ""475"",
      ""490"",
      ""500"",
      ""501"",
      ""5053"",
      ""5253"",
      ""560"",
      ""670"",
      ""685"",
      ""850"",
      ""851"",
      ""852"",
      ""961"",
      ""962"",
      ""963"",
      ""9000"",
      ""9001"",
      ""9002"",
      ""9003"",
      ""9504"",
      ""9514"",
      ""9556"",
      ""9558"",
      ""9560"",
      ""9600"",
      ""9603"",
      ""9623"",
      ""9653"",
      ""8821"",
      ""8822"",
      ""22"",
      ""13"",
      ""26"",
      ""39"",
      ""53"",
      ""4"",
      ""9"",
      ""17"",
      ""18"",
      ""23"",
      ""30"",
      ""31"",
      ""35"",
      ""43"",
      ""44"",
      ""48"",
      ""49""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., `CURRENT_DATE()`, `DATE_TRUNC()`)."",
      ""Lookup values for masthead grouping, publication codes, and billing system codes should be managed in governed reference tables and joined to the main data."",
      ""Scenario selection (Budget, Forecast, YOY, NY) should be driven by a Looker Studio parameter, not hardcoded `(2 = 1)` logic."",
      ""The `table_union_source` values should be documented and potentially mapped to a governed dimension table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.BudgetAddsQty,\n    t0.BudgetCancelsQty,\n    t0.BudgetClosingBase,\n    t0.BudgetEarnedAmount,\n    t0.BudgetNetAddsQty,\n    t0.BudgetNetCancelsQty,\n    t0.BudgetOpeningBase,\n    t0.ClosingBase,\n    t0.EarnedAmount,\n    t0.ExclusionReasonCancellation,\n    t0.ForecastAddsQty,\n    t0.ForecastBudgetEarnedAmount,\n    t0.ForecastCancelsQty,\n    t0.ForecastClosingBase,\n    t0.ForecastNetAddsQty,\n    t0.ForecastNetCancelsQty,\n    t0.ForecastOpeningBase,\n    t0.NFEarnedAmount,\n    t0.NYBudgetAddsQty,\n    t0.NYBudgetCancelsQty,\n    t0.NYBudgetClosingBase,\n    t0.NYBudgetEarnedAmount,\n    t0.NYBudgetOpeningBase,\n    t0.NetAcquisition,\n    t0.NetCanellation,\n    t0.OpeningBase,\n    t0.TotalAcquisition,\n    t0.TotalCancellation,\n    t0.classification_level_1_description,\n    t0.classification_level_2_description,\n    t0.delivery_medium_type,\n    t0.dw_billing_system_code,\n    t0.fy_month_of_year,\n    t0.fy_quarter_of_year,\n    t0.fy_week_of_year,\n    t0.fy_year,\n    t0.gl_publication_code,\n    t0.masthead_code,\n    t0.rate_plan_group_name,\n    t0.subscriber_has_email_flag,\n    t0.table_union_source,\n    DATE(TIMESTAMP '2025-04-01 05:58:44.965022+00', 'Australia/Sydney') AS hardcoded_date_q2,\n    DATETIME_DIFF(SAFE_CAST(DATE(TIMESTAMP '2025-04-01 05:58:44.965022+00', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS calculated_week_from_hardcoded_date\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n),\n\nderived_dimensions AS (\n  SELECT\n    *,\n    -- Derived Dimension: masthead_group (unified logic from all queries)\n    CASE\n      WHEN (gl_publication_code = 'The Australian') THEN 'The Australian'\n      WHEN (masthead_code IN ('CM', 'DT', 'HS', 'AA') OR gl_publication_code IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros'\n      WHEN (masthead_code IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TC', 'TB') OR gl_publication_code IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals'\n      WHEN (gl_publication_code = 'Weekly Times') THEN 'Others'\n      WHEN (masthead_code IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU', 'BG', 'OZ', 'NW') OR gl_publication_code IN ('Supercoach Plus', 'Code', 'Taste Online', 'Apple Podcast: Crime X', 'Racenet', 'Punters', 'Others', 'The Oz', 'news.com.au', 'Brain Games')) THEN 'Deep Niche Publications'\n      ELSE 'Discontinued'\n    END AS masthead_group,\n    -- Derived Dimension: recognition_type\n    CASE\n      WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition'\n      WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition'\n      ELSE 'Digital Recognition'\n    END AS recognition_type,\n    -- Derived Dimension: is_digital_platform_subscription\n    (dw_billing_system_code IN ('APLP', 'APLS', 'GPLA', 'SWG')\n    OR (table_union_source = 'budgetforecast' AND rate_plan_group_name IN ('Apple Podcasts', 'Google Play', 'Subscribe with Google (SWG)', 'Apple Store'))\n    ) AS is_digital_platform_subscription,\n    -- Derived Dimension: Period Type (from Q1 clmn0_ / clmn10_)\n    CASE\n        WHEN (1 = 1) THEN 'Budget'\n        WHEN (1 = 2) THEN 'Forecast'\n        WHEN (1 = 3) THEN 'YOY'\n        WHEN (1 = 4) THEN 'NYBudget'\n        ELSE NULL\n    END AS period_type_selector -- This simulates the Looker Studio parameter\n  FROM base_data\n)\nSELECT\n  -- Dimensions\n  fy_year,\n  fy_quarter_of_year,\n  fy_month_of_year,\n  fy_week_of_year,\n  masthead_group,\n  recognition_type,\n  is_digital_platform_subscription,\n  gl_publication_code,\n  masthead_code,\n  delivery_medium_type,\n  dw_billing_system_code,\n  rate_plan_group_name,\n  table_union_source,\n  -- Metrics (consolidated from Query 2, assuming all scenarios are calculated)\n  SUM(BudgetAddsQty) AS total_budget_adds_qty,\n  SUM(BudgetCancelsQty) AS total_budget_cancels_qty,\n  SUM(BudgetClosingBase) AS total_budget_closing_base,\n  SUM(BudgetEarnedAmount) AS total_budget_earned_amount,\n  SUM(BudgetNetAddsQty) AS total_budget_net_adds_qty,\n  SUM(BudgetNetCancelsQty) AS total_budget_net_cancels_qty,\n  SUM(BudgetOpeningBase) AS total_budget_opening_base,\n  SUM(ClosingBase) AS total_closing_base,\n  SUM(EarnedAmount) AS total_earned_amount,\n  SUM(ForecastAddsQty) AS total_forecast_adds_qty,\n  SUM(ForecastBudgetEarnedAmount) AS total_forecast_budget_earned_amount,\n  SUM(ForecastCancelsQty) AS total_forecast_cancels_qty,\n  SUM(ForecastClosingBase) AS total_forecast_closing_base,\n  SUM(ForecastNetAddsQty) AS total_forecast_net_adds_qty,\n  SUM(ForecastNetCancelsQty) AS total_forecast_net_cancels_qty,\n  SUM(ForecastOpeningBase) AS total_forecast_opening_base,\n  SUM(NFEarnedAmount) AS total_nf_earned_amount,\n  SUM(NYBudgetAddsQty) AS total_ny_budget_adds_qty,\n  SUM(NYBudgetCancelsQty) AS total_ny_budget_cancels_qty,\n  SUM(NYBudgetClosingBase) AS total_ny_budget_closing_base,\n  SUM(NYBudgetEarnedAmount) AS total_ny_budget_earned_amount,\n  SUM(NYBudgetOpeningBase) AS total_ny_budget_opening_base,\n  SUM(NetAcquisition) AS total_net_acquisition,\n  SUM(NetCanellation) AS total_net_cancellation,\n  SUM(OpeningBase) AS total_opening_base,\n  SUM(TotalAcquisition) AS total_acquisition,\n  SUM(TotalCancellation) AS total_cancellation,\n  -- Specific derived metrics from Query 2\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = calculated_week_from_hardcoded_date AND table_union_source IN ('bmasnap_close', 'SC - CODE Manual APLS', 'SC Manual APLS') THEN ClosingBase ELSE 0 END) AS closing_base_specific_week_2025,\n  SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = calculated_week_from_hardcoded_date THEN NYBudgetClosingBase ELSE 0 END) AS ny_budget_closing_base_specific_week_2025,\n  SUM(CASE WHEN fy_year = 2025 AND table_union_source = 'bmasnap_open' THEN BudgetOpeningBase ELSE 0 END) AS budget_opening_base_2025_bmasnap_open,\n  SUM(CASE WHEN fy_year = 2025 AND table_union_source = 'bmasnap_open' THEN NYBudgetCancelsQty ELSE 0 END) AS ny_budget_cancels_qty_2025_bmasnap_open,\n  SUM(SAFE_DIVIDE(ForecastBudgetEarnedAmount, 1000)) AS forecast_budget_earned_amount_k,\n  SUM(SAFE_DIVIDE(BudgetEarnedAmount, 1000)) AS budget_earned_amount_k,\n  SUM(ClosingBase - NYBudgetCancelsQty) AS closing_base_minus_ny_cancels\nFROM derived_dimensions\nWHERE\n  masthead_group != 'Discontinued'\n  AND recognition_type = 'Digital Recognition'\n  AND is_digital_platform_subscription = true\nGROUP BY\n  fy_year,\n  fy_quarter_of_year,\n  fy_month_of_year,\n  fy_week_of_year,\n  masthead_group,\n  recognition_type,\n  is_digital_platform_subscription,\n  gl_publication_code,\n  masthead_code,\n  delivery_medium_type,\n  dw_billing_system_code,\n  rate_plan_group_name,\n  table_union_source\nORDER BY fy_year DESC, fy_week_of_year DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_year AS STRING) || '-' || LPAD(SAFE_CAST(t0.fy_week_of_year AS STRING), 2, '0')) AS unique_fiscal_weeks,\n  COUNT(DISTINCT SAFE_CAST(t0.gl_publication_code AS STRING)) AS unique_publication_codes,\n  COUNT(DISTINCT SAFE_CAST(t0.masthead_code AS STRING)) AS unique_masthead_codes,\n  COUNT(DISTINCT SAFE_CAST(t0.delivery_medium_type AS STRING)) AS unique_delivery_medium_types,\n  COUNT(DISTINCT SAFE_CAST(t0.dw_billing_system_code AS STRING)) AS unique_billing_system_codes,\n  COUNT(DISTINCT SAFE_CAST(t0.rate_plan_group_name AS STRING)) AS unique_rate_plan_groups,\n  COUNT(DISTINCT SAFE_CAST(t0.table_union_source AS STRING)) AS unique_table_union_sources,\n  MIN(SAFE_CAST(t0.fy_year AS INT64)) AS earliest_fiscal_year,\n  MAX(SAFE_CAST(t0.fy_year AS INT64)) AS latest_fiscal_year,\n  APPROX_COUNT_DISTINCT(t0.fiscal_week_id) AS approx_unique_fiscal_week_ids -- Assuming fiscal_week_id is a unique identifier for a week's record\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2;\n"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.BudgetEarnedAmount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS budget_earned_amount_test,\n  CASE WHEN SUM(SAFE_CAST(t0.ClosingBase AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS closing_base_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.gl_publication_code AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_publication_codes_test,\n  CASE WHEN MAX(SAFE_CAST(t0.fy_year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.delivery_medium_type AS STRING) = 'Digital' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS digital_data_exists_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());\n"",
    ""business_rules_sql"": ""WITH derived_data AS (\n  SELECT\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.delivery_medium_type,\n    t0.subscriber_has_email_flag,\n    t0.dw_billing_system_code,\n    t0.rate_plan_group_name,\n    t0.table_union_source,\n    -- Derived Dimension: masthead_group\n    CASE\n      WHEN (t0.gl_publication_code = 'The Australian') THEN 'The Australian'\n      WHEN (t0.masthead_code IN ('CM', 'DT', 'HS', 'AA') OR t0.gl_publication_code IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros'\n      WHEN (t0.masthead_code IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TC', 'TB') OR t0.gl_publication_code IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals'\n      WHEN (t0.gl_publication_code = 'Weekly Times') THEN 'Others'\n      WHEN (t0.masthead_code IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU', 'BG', 'OZ', 'NW') OR t0.gl_publication_code IN ('Supercoach Plus', 'Code', 'Taste Online', 'Apple Podcast: Crime X', 'Racenet', 'Punters', 'Others', 'The Oz', 'news.com.au', 'Brain Games')) THEN 'Deep Niche Publications'\n      ELSE 'Discontinued'\n    END AS masthead_group,\n    -- Derived Dimension: recognition_type\n    CASE\n      WHEN (t0.delivery_medium_type = 'Print') THEN 'Print Recognition'\n      WHEN (t0.subscriber_has_email_flag = 'N') THEN 'Print Recognition'\n      ELSE 'Digital Recognition'\n    END AS recognition_type,\n    -- Derived Dimension: is_digital_platform_subscription\n    (t0.dw_billing_system_code IN ('APLP', 'APLS', 'GPLA', 'SWG')\n    OR (t0.table_union_source = 'budgetforecast' AND t0.rate_plan_group_name IN ('Apple Podcasts', 'Google Play', 'Subscribe with Google (SWG)', 'Apple Store'))\n    ) AS is_digital_platform_subscription\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n  WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE())\n)\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Digital Recognition Filter' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END) AS records_passing_digital_recognition,\n  SAFE_DIVIDE(SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS digital_recognition_pass_rate_percent,\n  'Masthead Group Filter' AS rule_name_2,\n  SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END) AS records_passing_masthead_group,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS masthead_group_pass_rate_percent,\n  'Digital Platform Subscription Filter' AS rule_name_3,\n  SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END) AS records_passing_digital_platform_subscription,\n  SAFE_DIVIDE(SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END), COUNT(*)) * 100 AS digital_platform_pass_rate_percent\nFROM derived_data;\n"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.fy_year AS INT64) AS fiscal_year,\n  SAFE_CAST(t0.fy_quarter_of_year AS INT64) AS fiscal_quarter,\n  SAFE_CAST(t0.fy_month_of_year AS INT64) AS fiscal_month,\n  SAFE_CAST(t0.fy_week_of_year AS INT64) AS fiscal_week,\n  SAFE_CAST(t0.gl_publication_code AS STRING) AS gl_publication_code,\n  SAFE_CAST(t0.masthead_code AS STRING) AS masthead_code,\n  SAFE_CAST(t0.delivery_medium_type AS STRING) AS delivery_medium_type,\n  SAFE_CAST(t0.dw_billing_system_code AS STRING) AS dw_billing_system_code,\n  SAFE_CAST(t0.rate_plan_group_name AS STRING) AS rate_plan_group_name,\n  SAFE_CAST(t0.subscriber_has_email_flag AS STRING) AS subscriber_has_email_flag,\n  SAFE_CAST(t0.table_union_source AS STRING) AS table_union_source,\n  SAFE_CAST(t0.BudgetAddsQty AS NUMERIC) AS budget_adds_qty,\n  SAFE_CAST(t0.BudgetEarnedAmount AS NUMERIC) AS budget_earned_amount,\n  SAFE_CAST(t0.ClosingBase AS NUMERIC) AS closing_base,\n  SAFE_CAST(t0.EarnedAmount AS NUMERIC) AS earned_amount,\n  SAFE_CAST(t0.ForecastClosingBase AS NUMERIC) AS forecast_closing_base,\n  SAFE_CAST(t0.NYBudgetClosingBase AS NUMERIC) AS ny_budget_closing_base\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE())\n  AND SAFE_CAST(t0.fy_week_of_year AS INT64) = EXTRACT(WEEK FROM CURRENT_DATE())\nORDER BY t0.fy_year DESC, t0.fy_week_of_year DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-04-01"",
          ""original_format"": ""2025-04-01 05:58:44.965022+00"",
          ""context"": ""Used as a fixed date for calculating week differences and determining a specific fiscal week for snapshot metrics."",
          ""suggested_fix"": ""Replace with a Looker Studio date parameter or `CURRENT_DATE()` adjusted for fiscal year start, to allow dynamic reporting."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date for `DATETIME_DIFF` to calculate a relative week number. This week number is then used to filter data for a specific snapshot."",
          ""suggested_fix"": ""Replace with a Looker Studio date parameter or a dynamic fiscal year start date from a configuration table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Hardcoded fiscal year for filtering data (`fy_year = 2025`) and in calculations like `(2025-1)`. This limits the dashboard to a single fiscal year."",
          ""suggested_fix"": ""Replace with a Looker Studio year parameter or `EXTRACT(YEAR FROM CURRENT_DATE())` for current fiscal year, and `EXTRACT(YEAR FROM CURRENT_DATE()) + 1` for next fiscal year."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Australian'"",
            ""'Metros'"",
            ""'Regionals'"",
            ""'Others'"",
            ""'Deep Niche Publications'"",
            ""'Discontinued'"",
            ""'Print Recognition'"",
            ""'Digital Recognition'"",
            ""'APLP'"",
            ""'APLS'"",
            ""'GPLA'"",
            ""'SWG'"",
            ""'Racenet'"",
            ""'Supercoach Plus'"",
            ""'Townsville'"",
            ""'Code'"",
            ""'Herald Sun'"",
            ""'Toowoomba'"",
            ""'Geelong'"",
            ""'The Mercury'"",
            ""'Punters'"",
            ""'Daily Telegraph'"",
            ""'The Advertiser'"",
            ""'Cairns Post'"",
            ""'Gold Coast'"",
            ""'Courier Mail'"",
            ""'NT News'"",
            ""'Apple Podcast: Crime X'"",
            ""'Taste Online'"",
            ""'The Oz'"",
            ""'news.com.au'"",
            ""'Brain Games'"",
            ""'Suddenly'"",
            ""'News Corporate'"",
            ""'Group Newspaper Management - Digital'"",
            ""'AP'"",
            ""'NT'"",
            ""'SC'"",
            ""'CM'"",
            ""'DT'"",
            ""'BG'"",
            ""'TA'"",
            ""'TS'"",
            ""'NW'"",
            ""'AA'"",
            ""'PU'"",
            ""'TM'"",
            ""'TB'"",
            ""'CP'"",
            ""'RN'"",
            ""'CS'"",
            ""'GC'"",
            ""'TC'"",
            ""'WT'"",
            ""'HS'"",
            ""'GA'"",
            ""'Apple Podcasts'"",
            ""'Google Play'"",
            ""'Subscribe with Google (SWG)'"",
            ""'Apple Store'"",
            ""'subsnapfact'"",
            ""'budgetforecast'"",
            ""'bmasnap_move'"",
            ""'bmasnap_close'"",
            ""'exclsionnetcancels'"",
            ""'nfmanualhist'"",
            ""'SC - CODE Manual APLS'"",
            ""'SC Manual APLS'"",
            ""'Taste Manual APLS'"",
            ""'Taste Manual GPLA'"",
            ""'Taste Manual PRES'"",
            ""121"",
            ""9644"",
            ""9903"",
            ""100"",
            ""101"",
            ""103"",
            ""110"",
            ""111"",
            ""116"",
            ""301"",
            ""302"",
            ""303"",
            ""305"",
            ""307"",
            ""350"",
            ""351"",
            ""400"",
            ""401"",
            ""402"",
            ""450"",
            ""460"",
            ""475"",
            ""490"",
            ""500"",
            ""501"",
            ""5053"",
            ""5253"",
            ""560"",
            ""670"",
            ""685"",
            ""850"",
            ""851"",
            ""852"",
            ""961"",
            ""962"",
            ""963"",
            ""9000"",
            ""9001"",
            ""9002"",
            ""9003"",
            ""9504"",
            ""9514"",
            ""9556"",
            ""9558"",
            ""9560"",
            ""9600"",
            ""9603"",
            ""9623"",
            ""9653"",
            ""8821"",
            ""8822""
          ],
          ""context"": ""Extensive use of hardcoded strings and numeric IDs for `gl_publication_code`, `masthead_code`, `dw_billing_system_code`, `rate_plan_group_name`, and `table_union_source` in complex `CASE` statements for derived dimensions (Masthead Group, Recognition Type, Digital Platform Subscription)."",
          ""suggested_governance"": ""Create and maintain governed reference tables for these codes and their corresponding descriptive names/groupings. Join these tables to the `digital_subscriptions` table to derive dimensions dynamically. This centralizes business logic and simplifies maintenance."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""22"",
            ""13"",
            ""26"",
            ""39"",
            ""53"",
            ""4"",
            ""9"",
            ""17"",
            ""18"",
            ""23"",
            ""30"",
            ""31"",
            ""35"",
            ""43"",
            ""44"",
            ""48"",
            ""49""
          ],
          ""context"": ""Numeric thresholds used for grouping fiscal weeks into quarters and months (e.g., `fy_week_of_year <= 13` for Q1)."",
          ""suggested_governance"": ""Define fiscal calendar rules (week-to-month/quarter mapping) in a dedicated fiscal calendar dimension table. This allows for flexible and accurate fiscal period definitions."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-04-01', '2024-07-03', '2025') with Looker Studio date parameters or dynamic date functions (`CURRENT_DATE()`, `DATE_SUB()`) to enable flexible date range selection."",
      ""Introduce a Looker Studio parameter for 'Period Type' (Budget, Forecast, YOY, NY) to allow users to dynamically select the scenario, replacing the hardcoded `(2 = 1)` type logic."",
      ""Externalize all lookup values (e.g., `gl_publication_code` to `masthead_group` mappings, `dw_billing_system_code` categories) into governed reference tables. This allows for easier updates and consistency across dashboards."",
      ""Consider creating a fiscal calendar dimension table to manage fiscal year, quarter, month, and week definitions, removing hardcoded week thresholds.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""masthead_group"",
      ""metric_name"": ""Masthead Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of publications/mastheads into broader groups like 'The Australian', 'Metros', 'Regionals', 'Deep Niche Publications', 'Others', and 'Discontinued'."",
      ""sql_logic"": ""CASE WHEN (gl_publication_code = 'The Australian') THEN 'The Australian' WHEN (masthead_code IN ('CM', 'DT', 'HS', 'AA') OR gl_publication_code IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros' WHEN (masthead_code IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TC', 'TB') OR gl_publication_code IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals' WHEN (gl_publication_code = 'Weekly Times') THEN 'Others' WHEN (masthead_code IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU', 'BG', 'OZ', 'NW') OR gl_publication_code IN ('Supercoach Plus', 'Code', 'Taste Online', 'Apple Podcast: Crime X', 'Racenet', 'Punters', 'Others', 'The Oz', 'news.com.au', 'Brain Games')) THEN 'Deep Niche Publications' ELSE 'Discontinued' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level reporting and analysis of subscription performance across different publication tiers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian'"",
        ""'Metros'"",
        ""'Regionals'"",
        ""'Others'"",
        ""'Deep Niche Publications'"",
        ""'Discontinued'"",
        ""specific masthead/publication codes""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on comprehensive and correct mapping of gl_publication_code and masthead_code.""
      ]
    },
    {
      ""metric_id"": ""recognition_type"",
      ""metric_name"": ""Recognition Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Classifies subscriptions as 'Print Recognition' or 'Digital Recognition' based on delivery medium and email flag. The dashboard focuses on 'Digital Recognition'."",
      ""sql_logic"": ""CASE WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition' WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition' ELSE 'Digital Recognition' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting digital vs. print subscription performance, aligning with the dashboard's 'Digi Subsifying' theme."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Print Recognition'"",
        ""'Digital Recognition'"",
        ""'Print'"",
        ""'N'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""The logic `subscriber_has_email_flag = 'N' THEN 'Print Recognition'` seems counter-intuitive for digital recognition and might need review.""
      ]
    },
    {
      ""metric_id"": ""is_digital_platform_subscription"",
      ""metric_name"": ""Is Digital Platform Subscription"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A boolean flag indicating if a subscription originates from specific digital billing systems or rate plan groups (e.g., Apple, Google, SWG)."",
      ""sql_logic"": ""(dw_billing_system_code IN ('APLP', 'APLS', 'GPLA', 'SWG') OR (table_union_source = 'budgetforecast' AND rate_plan_group_name IN ('Apple Podcasts', 'Google Play', 'Subscribe with Google (SWG)', 'Apple Store')))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Filters the data to focus on subscriptions acquired through key digital platforms, which is central to the dashboard's purpose."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'APLP'"",
        ""'APLS'"",
        ""'GPLA'"",
        ""'SWG'"",
        ""'budgetforecast'"",
        ""'Apple Podcasts'"",
        ""'Google Play'"",
        ""'Subscribe with Google (SWG)'"",
        ""'Apple Store'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_adds_qty"",
      ""metric_name"": ""Total Budget Adds Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of new subscriptions added according to the budget plan."",
      ""sql_logic"": ""SUM(BudgetAddsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key performance indicator for tracking acquisition against financial targets."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_cancels_qty"",
      ""metric_name"": ""Total Budget Cancels Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of subscriptions cancelled according to the budget plan."",
      ""sql_logic"": ""SUM(BudgetCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key performance indicator for tracking churn against financial targets."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_closing_base"",
      ""metric_name"": ""Total Budget Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscribers at the end of a period, as per the budget."",
      ""sql_logic"": ""SUM(BudgetClosingBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A core metric for evaluating the projected subscriber base against actuals."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_earned_amount"",
      ""metric_name"": ""Total Budget Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue earned from subscriptions, as per the budget."",
      ""sql_logic"": ""SUM(BudgetEarnedAmount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A primary financial metric for assessing revenue performance against budget."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_closing_base"",
      ""metric_name"": ""Total Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual total number of subscribers at the end of a period."",
      ""sql_logic"": ""SUM(ClosingBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Core metric for current subscriber count."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_earned_amount"",
      ""metric_name"": ""Total Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual total revenue earned from subscriptions."",
      ""sql_logic"": ""SUM(EarnedAmount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Primary financial metric for actual revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_adds_qty"",
      ""metric_name"": ""Total Forecast Adds Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of new subscriptions added according to the forecast."",
      ""sql_logic"": ""SUM(ForecastAddsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key performance indicator for tracking acquisition against future projections."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_budget_earned_amount"",
      ""metric_name"": ""Total Forecast Budget Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue earned from subscriptions, as per the forecast budget."",
      ""sql_logic"": ""SUM(ForecastBudgetEarnedAmount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A primary financial metric for assessing revenue performance against forecast budget."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_cancels_qty"",
      ""metric_name"": ""Total Forecast Cancels Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of subscriptions cancelled according to the forecast."",
      ""sql_logic"": ""SUM(ForecastCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key performance indicator for tracking churn against future projections."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_closing_base"",
      ""metric_name"": ""Total Forecast Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscribers at the end of a period, as per the forecast."",
      ""sql_logic"": ""SUM(ForecastClosingBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A core metric for evaluating the projected subscriber base against actuals."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_net_adds_qty"",
      ""metric_name"": ""Total Forecast Net Adds Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net new subscriptions (adds minus cancels) according to the forecast."",
      ""sql_logic"": ""SUM(ForecastNetAddsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the projected growth of the subscriber base."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_forecast_net_cancels_qty"",
      ""metric_name"": ""Total Forecast Net Cancels Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net cancellations (cancels minus adds) according to the forecast."",
      ""sql_logic"": ""SUM(ForecastNetCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the projected decline of the subscriber base."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ny_budget_adds_qty"",
      ""metric_name"": ""Total Next Year Budget Adds Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of new subscriptions added according to the next fiscal year's budget plan."",
      ""sql_logic"": ""SUM(NYBudgetAddsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Forward-looking KPI for future acquisition targets."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ny_budget_cancels_qty"",
      ""metric_name"": ""Total Next Year Budget Cancels Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total quantity of subscriptions cancelled according to the next fiscal year's budget plan."",
      ""sql_logic"": ""SUM(NYBudgetCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Forward-looking KPI for future churn targets."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ny_budget_closing_base"",
      ""metric_name"": ""Total Next Year Budget Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscribers at the end of a period, as per the next fiscal year's budget."",
      ""sql_logic"": ""SUM(NYBudgetClosingBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A core metric for evaluating the projected subscriber base for the next fiscal year."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ny_budget_earned_amount"",
      ""metric_name"": ""Total Next Year Budget Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue earned from subscriptions, as per the next fiscal year's budget."",
      ""sql_logic"": ""SUM(NYBudgetEarnedAmount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A primary financial metric for assessing future revenue targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_net_acquisition"",
      ""metric_name"": ""Total Net Acquisition"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net new subscriptions (adds minus cancels) for the period."",
      ""sql_logic"": ""SUM(NetAcquisition)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the overall growth of the subscriber base."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_net_cancellation"",
      ""metric_name"": ""Total Net Cancellation"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net cancellations (cancels minus adds) for the period."",
      ""sql_logic"": ""SUM(NetCanellation)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the overall decline of the subscriber base."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_opening_base"",
      ""metric_name"": ""Total Opening Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscribers at the beginning of a period."",
      ""sql_logic"": ""SUM(OpeningBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Baseline for subscriber count analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_acquisition"",
      ""metric_name"": ""Total Acquisition"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of new subscriptions acquired."",
      ""sql_logic"": ""SUM(TotalAcquisition)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures gross new subscriber volume."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancellation"",
      ""metric_name"": ""Total Cancellation"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscriptions cancelled."",
      ""sql_logic"": ""SUM(TotalCancellation)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures gross subscriber churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_specific_week_2025"",
      ""metric_name"": ""Closing Base (Specific Week 2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Closing Base for a specific fiscal week in 2025, derived from a hardcoded date and filtered by specific `table_union_source` values."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = calculated_week_from_hardcoded_date AND table_union_source IN ('bmasnap_close', 'SC - CODE Manual APLS', 'SC Manual APLS') THEN ClosingBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Snapshot metric for subscriber base at a particular point in time for the next fiscal year."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""2025-04-01"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'bmasnap_close'"",
        ""'SC - CODE Manual APLS'"",
        ""'SC Manual APLS'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ny_budget_closing_base_specific_week_2025"",
      ""metric_name"": ""Next Year Budget Closing Base (Specific Week 2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Next Year Budget Closing Base for a specific fiscal week in 2025, derived from a hardcoded date."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = 2025 AND fy_week_of_year = calculated_week_from_hardcoded_date THEN NYBudgetClosingBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Snapshot metric for projected subscriber base at a particular point in time for the next fiscal year."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""2025-04-01"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_opening_base_2025_bmasnap_open"",
      ""metric_name"": ""Budget Opening Base (FY2025, bmasnap_open)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Budget Opening Base for Fiscal Year 2025, specifically for records with `table_union_source` as 'bmasnap_open'."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = 2025 AND table_union_source = 'bmasnap_open' THEN BudgetOpeningBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Specific budget opening base for a particular data source type in FY2025."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'bmasnap_open'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ny_budget_cancels_qty_2025_bmasnap_open"",
      ""metric_name"": ""Next Year Budget Cancels Quantity (FY2025, bmasnap_open)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Next Year Budget Cancels Quantity for Fiscal Year 2025, specifically for records with `table_union_source` as 'bmasnap_open'."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = 2025 AND table_union_source = 'bmasnap_open' THEN NYBudgetCancelsQty ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Specific next year budget cancellations for a particular data source type in FY2025."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'bmasnap_open'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_budget_earned_amount_k"",
      ""metric_name"": ""Forecast Budget Earned Amount (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_forecast_budget_earned_amount""
      ],
      ""business_description"": ""The total forecast budget earned amount, divided by 1000 for presentation in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(ForecastBudgetEarnedAmount, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Financial metric for forecast revenue, scaled for readability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_earned_amount_k"",
      ""metric_name"": ""Budget Earned Amount (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_budget_earned_amount""
      ],
      ""business_description"": ""The total budget earned amount, divided by 1000 for presentation in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(BudgetEarnedAmount, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Financial metric for budget revenue, scaled for readability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_minus_ny_cancels"",
      ""metric_name"": ""Closing Base minus NY Cancels"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_closing_base"",
        ""total_ny_budget_cancels_qty""
      ],
      ""business_description"": ""The difference between the actual Closing Base and the Next Year Budget Cancels Quantity."",
      ""sql_logic"": ""SUM(ClosingBase - NYBudgetCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A custom calculation likely used for specific financial reconciliation or variance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_net_adds_qty"",
      ""metric_name"": ""Budget Net Adds Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The net quantity of new subscriptions (adds minus cancels) according to the budget plan."",
      ""sql_logic"": ""SUM(BudgetNetAddsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the projected net growth of the subscriber base against budget."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_net_cancels_qty"",
      ""metric_name"": ""Budget Net Cancels Quantity"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The net quantity of cancellations (cancels minus adds) according to the budget plan."",
      ""sql_logic"": ""SUM(BudgetNetCancelsQty)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the projected net decline of the subscriber base against budget."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_opening_base"",
      ""metric_name"": ""Budget Opening Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of subscribers at the beginning of a period, as per the budget."",
      ""sql_logic"": ""SUM(BudgetOpeningBase)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Baseline for budget subscriber count analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""nf_earned_amount"",
      ""metric_name"": ""NF Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Earned amount for 'Non-Forecast' or 'Non-Financial' scenarios. Specific meaning depends on business context."",
      ""sql_logic"": ""SUM(NFEarnedAmount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Additional financial metric, likely for specific reporting needs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""exclusion_reason_cancellation"",
      ""metric_name"": ""Exclusion Reason Cancellation"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Reason for a cancellation being excluded from certain calculations."",
      ""sql_logic"": ""ExclusionReasonCancellation"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for detailed analysis of cancellations and data quality."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_id_sum"",
      ""metric_name"": ""Fiscal Week ID Sum"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of fiscal week IDs. This is likely a misinterpretation of a dimension as a measure or a proxy for a count."",
      ""sql_logic"": ""SUM(fiscal_week_id)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""recognition_type = 'Digital Recognition'"",
        ""is_digital_platform_subscription = true""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Unclear business context for summing an ID. Potentially used as a record count or a unique count of weeks if grouped appropriately."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""This metric is likely an error in dashboard configuration, summing a dimension.""
      ],
      ""data_quality_concerns"": [
        ""Summing an ID is usually not meaningful. Should be COUNT(DISTINCT fiscal_week_id) or used as a dimension.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""closing_base_minus_ny_cancels"",
      ""related_metrics"": [
        ""total_closing_base"",
        ""total_ny_budget_cancels_qty""
      ],
      ""relationship_description"": ""Calculates the difference between the actual closing subscriber base and the next year's budgeted cancellations."",
      ""mathematical_formula"": ""Closing_Base - NY_Budget_Cancels_Qty"",
      ""business_validation"": ""This relationship helps in understanding the net impact on the subscriber base when considering future planned cancellations against the current base. It could indicate a 'net future base' or a variance."",
      ""validation_sql"": ""SELECT SUM(t0.ClosingBase - t0.NYBudgetCancelsQty) AS calculated_metric, SUM(t0.ClosingBase) - SUM(t0.NYBudgetCancelsQty) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""forecast_budget_earned_amount_k"",
      ""related_metrics"": [
        ""total_forecast_budget_earned_amount""
      ],
      ""relationship_description"": ""Scales the total forecast budget earned amount by dividing it by 1000."",
      ""mathematical_formula"": ""Forecast_Budget_Earned_Amount / 1000"",
      ""business_validation"": ""This transformation is purely for presentation, making large monetary values more readable (e.g., in thousands)."",
      ""validation_sql"": ""SELECT SUM(SAFE_DIVIDE(t0.ForecastBudgetEarnedAmount, 1000)) AS calculated_metric, SAFE_DIVIDE(SUM(t0.ForecastBudgetEarnedAmount), 1000) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""budget_earned_amount_k"",
      ""related_metrics"": [
        ""total_budget_earned_amount""
      ],
      ""relationship_description"": ""Scales the total budget earned amount by dividing it by 1000."",
      ""mathematical_formula"": ""Budget_Earned_Amount / 1000"",
      ""business_validation"": ""This transformation is purely for presentation, making large monetary values more readable (e.g., in thousands)."",
      ""validation_sql"": ""SELECT SUM(SAFE_DIVIDE(t0.BudgetEarnedAmount, 1000)) AS calculated_metric, SAFE_DIVIDE(SUM(t0.BudgetEarnedAmount), 1000) AS validation_check FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0 WHERE SAFE_CAST(t0.fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE());"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""masthead_group"",
      ""related_metrics"": [
        ""total_budget_adds_qty"",
        ""total_closing_base"",
        ""total_earned_amount""
      ],
      ""relationship_description"": ""All primary metrics are filtered to exclude records where 'Masthead Group' is 'Discontinued'."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""This ensures that the dashboard focuses only on active or relevant mastheads, excluding those no longer in operation or considered for analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN masthead_group != 'Discontinued' THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT CASE WHEN (gl_publication_code = 'The Australian') THEN 'The Australian' WHEN (masthead_code IN ('CM', 'DT', 'HS', 'AA') OR gl_publication_code IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros' WHEN (masthead_code IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TC', 'TB') OR gl_publication_code IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals' WHEN (gl_publication_code = 'Weekly Times') THEN 'Others' WHEN (masthead_code IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU', 'BG', 'OZ', 'NW') OR gl_publication_code IN ('Supercoach Plus', 'Code', 'Taste Online', 'Apple Podcast: Crime X', 'Racenet', 'Punters', 'Others', 'The Oz', 'news.com.au', 'Brain Games')) THEN 'Deep Niche Publications' ELSE 'Discontinued' END AS masthead_group FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""recognition_type"",
      ""related_metrics"": [
        ""total_budget_adds_qty"",
        ""total_closing_base"",
        ""total_earned_amount""
      ],
      ""relationship_description"": ""All primary metrics are filtered to include only records where 'Recognition Type' is 'Digital Recognition'."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""This filter ensures the dashboard focuses exclusively on digital subscription performance, aligning with the 'Digi Subsifying' theme."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN recognition_type = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT CASE WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition' WHEN (subscriber_has_email_flag = 'N') THEN 'Print Recognition' ELSE 'Digital Recognition' END AS recognition_type FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""is_digital_platform_subscription"",
      ""related_metrics"": [
        ""total_budget_adds_qty"",
        ""total_closing_base"",
        ""total_earned_amount""
      ],
      ""relationship_description"": ""All primary metrics are filtered to include only records where 'Is Digital Platform Subscription' is true."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""This filter narrows the focus to subscriptions originating from key digital platforms, which is a critical segment for analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END) AS records_included, COUNT(*) AS total_records, SAFE_DIVIDE(SUM(CASE WHEN is_digital_platform_subscription = TRUE THEN 1 ELSE 0 END), COUNT(*)) AS inclusion_rate FROM (SELECT (dw_billing_system_code IN ('APLP', 'APLS', 'GPLA', 'SWG') OR (table_union_source = 'budgetforecast' AND rate_plan_group_name IN ('Apple Podcasts', 'Google Play', 'Subscribe with Google (SWG)', 'Apple Store'))) AS is_digital_platform_subscription FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` WHERE SAFE_CAST(fy_year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()));"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,38
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6de90f2a-b3f3-46fe-a4fe-13474b2d6618"",
    ""dashboard_name"": ""PACMAN AND EXCLUDE LOD"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4;ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [""Margin_Level"", ""Category"", ""Product_L3"", ""Fiscal_Year""],
    ""date_range_detected"": ""Mixed (Fiscal Year 2025 and All Time)"",
    ""hardcoded_dates_found"": [""2025""],
    ""hardcoded_values_found"": [""'Category'""],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""dynamic category selection logic in CASE WHEN should be reviewed/parameterised"",
      ""SUM(Fiscal_Year) metric should be reviewed for business validity""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH ExcludeLODData AS (\n  SELECT\n    SAFE_CAST(t0.Margin_Level AS STRING) AS Margin_Level,\n    SAFE_CAST(t0.Category AS STRING) AS Category_Dimension,\n    SAFE_CAST(t0.Product_Revenue AS NUMERIC) AS Product_Revenue_Exclude_LOD,\n    SAFE_CAST(t0.Product_Revenue_Merged_OneRow AS NUMERIC) AS Product_Revenue_Merged_OneRow\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\n),\nPacmanData AS (\n  SELECT\n    SAFE_CAST(t0.Fiscal_Year AS INT64) AS Fiscal_Year,\n    SAFE_CAST(t0.Product_L3 AS STRING) AS Product_L3,\n    SAFE_CAST(t0.Product_Revenue AS NUMERIC) AS Pacman_Product_Revenue\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\n)\nSELECT\n  'ExcludeLOD' AS source_table,\n  Margin_Level,\n  Category_Dimension,\n  NULL AS Fiscal_Year,\n  NULL AS Product_L3,\n  SUM(Product_Revenue_Exclude_LOD) AS total_product_revenue_exclude_lod,\n  SUM(Product_Revenue_Merged_OneRow) AS total_product_revenue_merged_one_row,\n  NULL AS total_pacman_product_revenue_2025,\n  NULL AS total_sum_fiscal_year_by_product_l3\nFROM ExcludeLODData\nGROUP BY 1, 2, 3\n\nUNION ALL\n\nSELECT\n  'PACMAN' AS source_table,\n  NULL AS Margin_Level,\n  NULL AS Category_Dimension,\n  Fiscal_Year,\n  Product_L3,\n  NULL AS total_product_revenue_exclude_lod,\n  NULL AS total_product_revenue_merged_one_row,\n  SUM(CASE WHEN Fiscal_Year = 2025 THEN Pacman_Product_Revenue ELSE 0 END) AS total_pacman_product_revenue_2025,\n  SUM(Fiscal_Year) AS total_sum_fiscal_year_by_product_l3\nFROM PacmanData\nGROUP BY 1, 4, 5\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.Category AS STRING)) AS unique_categories,\n  COUNT(DISTINCT SAFE_CAST(t0.Margin_Level AS STRING)) AS unique_margin_levels,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_L1 AS STRING)) AS unique_product_l1s,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_L2 AS STRING)) AS unique_product_l2s,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_L3 AS STRING)) AS unique_product_l3s,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_L4 AS STRING)) AS unique_product_l4s,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_Name AS STRING)) AS unique_product_names,\n  MIN(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) AS min_product_revenue,\n  MAX(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) AS max_product_revenue,\n  AVG(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) AS avg_product_revenue\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS product_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(t0.Product_Revenue_Merged_OneRow AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS merged_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.Margin_Level AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS margin_level_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.Category AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS category_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\nWHERE SAFE_CAST(t0.Product_Revenue AS NUMERIC) IS NOT NULL\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Category_Selection_Logic' AS rule_name,\n  COUNT(*) AS total_records_tested,\n  SUM(CASE WHEN SAFE_CAST(t0.Category AS STRING) IS NOT NULL THEN 1 ELSE 0 END) AS records_with_category,\n  SUM(CASE WHEN ('Category' = 'Category') THEN 1 ELSE 0 END) AS records_matching_hardcoded_category_logic,\n  'The CASE WHEN logic always defaults to the Category column due to hardcoded condition. Review if dynamic selection was intended.' AS observation\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.Category AS STRING) AS Category,\n  SAFE_CAST(t0.Margin_Level AS STRING) AS Margin_Level,\n  SAFE_CAST(t0.Product_L1 AS STRING) AS Product_L1,\n  SAFE_CAST(t0.Product_L2 AS STRING) AS Product_L2,\n  SAFE_CAST(t0.Product_L3 AS STRING) AS Product_L3,\n  SAFE_CAST(t0.Product_L4 AS STRING) AS Product_L4,\n  SAFE_CAST(t0.Product_Name AS STRING) AS Product_Name,\n  SAFE_CAST(t0.Product_Revenue AS NUMERIC) AS Product_Revenue,\n  SAFE_CAST(t0.Product_Revenue_Merged_OneRow AS NUMERIC) AS Product_Revenue_Merged_OneRow\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\nWHERE SAFE_CAST(t0.Product_Revenue AS NUMERIC) IS NOT NULL\nORDER BY SAFE_CAST(t0.Product_Revenue AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""used as a filter for Fiscal_Year in PACMAN Product Revenue metric"",
          ""suggested_fix"": ""replace with CURRENT_DATE()'s fiscal year or a parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Category'"", ""'Product_Name'"", ""'Product_L1'"", ""'Product_L2'"", ""'Product_L3'"", ""'Product_L4'""],
          ""context"": ""string literals used in CASE WHEN conditions for dynamic category selection, where ('Category' = 'Category') makes other conditions redundant."",
          ""suggested_governance"": ""review business logic; if dynamic selection is intended, use a parameter or a more robust configuration."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year '2025' with a date parameter or relative date function (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))."",
      ""Review and parameterize the dynamic category selection logic in the CASE WHEN statement to allow flexible reporting without code changes.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""product_revenue_merged_one_row"",
      ""metric_name"": ""Product Revenue Merged One Row"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue where multiple rows for a product might have been merged into a single row for reporting purposes. This metric is derived from the 'dv_exclude_product_l3_and_l4' table."",
      ""sql_logic"": ""SUM(t0.Product_Revenue_Merged_OneRow)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key revenue metric for product performance analysis, potentially adjusted for specific reporting needs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential for data loss/aggregation issues if merging logic is not clear""]
    },
    {
      ""metric_id"": ""product_revenue_exclude_lod"",
      ""metric_name"": ""Product Revenue (Exclude LOD)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue, likely excluding specific levels of detail (LOD) or specific product categories as per the table name 'dv_exclude_product_l3_and_l4'."",
      ""sql_logic"": ""SUM(t0.Product_Revenue)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for product performance, potentially representing a specific view of revenue after exclusions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""pacman_product_revenue_2025"",
      ""metric_name"": ""PACMAN Product Revenue (FY 2025)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue specifically for the Fiscal Year 2025, derived from the 'dv_pacman_running_expense' dataset."",
      ""sql_logic"": ""SUM(t0.Product_Revenue) WHERE t0.Fiscal_Year = 2025"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""],
      ""filters_applied"": [""Fiscal_Year = 2025""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific revenue target or actuals for a future fiscal year, likely for budgeting or forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""date should be parameterised""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_fiscal_year_by_product_l3"",
      ""metric_name"": ""Sum of Fiscal Year by Product L3"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of fiscal year values, grouped by Product L3. This metric is unusual and its business meaning should be clarified. It might be an error or represent a count of fiscal years per product, or a weighted average if divided by a count."",
      ""sql_logic"": ""SUM(t0.Fiscal_Year)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Unclear. Potentially used for internal data validation or a misconfigured metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""metric definition should be reviewed for business validity""],
      ""data_quality_concerns"": [""potential for misinterpretation due to unusual aggregation""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""product_revenue_exclude_lod"",
      ""related_metrics"": [""product_revenue_merged_one_row""],
      ""relationship_description"": ""Both metrics represent product revenue from the same source table. 'Product Revenue Merged One Row' likely represents a specific aggregation or adjustment of 'Product Revenue (Exclude LOD)'. The exact relationship (e.g., subset, transformation) is not explicitly defined in the provided SQL but implies a difference in how revenue is counted or grouped."",
      ""mathematical_formula"": ""Not explicitly defined, but Product_Revenue_Merged_OneRow is likely a derivative of Product_Revenue."",
      ""business_validation"": ""Understanding the difference between these two revenue figures is crucial for accurate financial reporting and analysis. It should be clear when to use each metric."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(Product_Revenue AS NUMERIC)) AS total_revenue, SUM(SAFE_CAST(Product_Revenue_Merged_OneRow AS NUMERIC)) AS total_merged_revenue FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` LIMIT 1;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,39
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""23c8b213-a9f0-4158-b8fa-bff14425abb5"",
    ""dashboard_name"": ""TM1 NewsQuery Tables"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions;ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 4,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""category_name"",
      ""gl_publication_code"",
      ""channel"",
      ""state""
    ],
    ""date_range_detected"": ""Specific fiscal week (202535) detected, no dynamic date range"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""202535""
    ],
    ""governance_opportunities"": [
      ""fiscal_week_id should be parameterized or derived from a date dimension table for dynamic reporting.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  subscriptions_data AS (\n    SELECT\n      SAFE_CAST(t0.fiscal_week_id AS INT64) AS fiscal_week_id,\n      t0.category_name,\n      t0.gl_publication_code,\n      NULL AS channel, -- Not in this table\n      NULL AS state, -- Not in this table\n      SAFE_CAST(t0.add_volume AS NUMERIC) AS add_volume,\n      SAFE_CAST(t0.closing_base AS NUMERIC) AS closing_base,\n      SAFE_CAST(t0.earned_amount AS NUMERIC) AS earned_amount,\n      SAFE_CAST(t0.opening_base AS NUMERIC) AS opening_base,\n      SAFE_CAST(t0.red_volume AS NUMERIC) AS red_volume,\n      SAFE_CAST(t0.transfer_in AS NUMERIC) AS transfer_in,\n      SAFE_CAST(t0.transfer_out AS NUMERIC) AS transfer_out,\n      NULL AS home_del_charge, -- Not in this table\n      NULL AS returns_credit_amount, -- Not in this table\n      NULL AS rev_adjust, -- Not in this table\n      'dv_tm1_pbf_subscriptions' AS source_table\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions` AS t0\n    WHERE\n      SAFE_CAST(t0.fiscal_week_id AS INT64) = 202535 -- Applying the hardcoded filter\n  ),\n  circulation_data AS (\n    SELECT\n      NULL AS fiscal_week_id, -- Not in this table\n      NULL AS category_name, -- Not in this table\n      NULL AS gl_publication_code, -- Not in this table\n      t0.channel,\n      t0.state,\n      NULL AS add_volume, -- Not in this table\n      NULL AS closing_base, -- Not in this table\n      NULL AS earned_amount, -- Not in this table\n      NULL AS opening_base, -- Not in this table\n      NULL AS red_volume, -- Not in this table\n      NULL AS transfer_in, -- Not in this table\n      NULL AS transfer_out, -- Not in this table\n      SAFE_CAST(t0.home_del_charge AS NUMERIC) AS home_del_charge,\n      SAFE_CAST(t0.returns_credit_amount AS NUMERIC) AS returns_credit_amount,\n      SAFE_CAST(t0.rev_adjust AS NUMERIC) AS rev_adjust,\n      'dv_tm1_pbf_circulation_actuals' AS source_table\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals` AS t0\n  )\nSELECT\n  fiscal_week_id,\n  state,\n  category_name,\n  gl_publication_code,\n  channel,\n  source_table,\n  SUM(add_volume) AS total_add_volume,\n  SUM(closing_base) AS total_closing_base,\n  SUM(earned_amount) AS total_earned_amount,\n  SUM(opening_base) AS total_opening_base,\n  SUM(red_volume) AS total_red_volume,\n  SUM(transfer_in) AS total_transfer_in,\n  SUM(transfer_out) AS total_transfer_out,\n  SUM(home_del_charge) AS total_home_del_charge,\n  SUM(returns_credit_amount) AS total_returns_credit_amount,\n  SUM(rev_adjust) AS total_rev_adjust\nFROM\n  (\n    SELECT * FROM subscriptions_data\n    UNION ALL\n    SELECT * FROM circulation_data\n  )\nGROUP BY\n  fiscal_week_id,\n  state,\n  category_name,\n  gl_publication_code,\n  channel,\n  source_table\nORDER BY\n  source_table, fiscal_week_id DESC, state DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'dv_tm1_pbf_subscriptions' AS table_name,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS INT64)) AS unique_fiscal_weeks,\n  MIN(SAFE_CAST(fiscal_week_id AS INT64)) AS min_fiscal_week_id,\n  MAX(SAFE_CAST(fiscal_week_id AS INT64)) AS max_fiscal_week_id,\n  COUNT(DISTINCT category_name) AS unique_categories,\n  COUNT(DISTINCT gl_publication_code) AS unique_gl_publication_codes,\n  SUM(CASE WHEN add_volume IS NULL THEN 1 ELSE 0 END) AS null_add_volume_count,\n  SUM(CASE WHEN earned_amount IS NULL THEN 1 ELSE 0 END) AS null_earned_amount_count,\n  NULL AS unique_channels, -- Not applicable\n  NULL AS unique_states, -- Not applicable\n  NULL AS null_home_del_charge_count, -- Not applicable\n  NULL AS null_rev_adjust_count -- Not applicable\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nUNION ALL\nSELECT\n  'dv_tm1_pbf_circulation_actuals' AS table_name,\n  COUNT(*) AS total_records,\n  NULL AS unique_fiscal_weeks, -- Not applicable\n  NULL AS min_fiscal_week_id, -- Not applicable\n  NULL AS max_fiscal_week_id, -- Not applicable\n  NULL AS unique_categories, -- Not applicable\n  NULL AS unique_gl_publication_codes, -- Not applicable\n  NULL AS null_add_volume_count, -- Not applicable\n  NULL AS null_earned_amount_count, -- Not applicable\n  COUNT(DISTINCT channel) AS unique_channels,\n  COUNT(DISTINCT state) AS unique_states,\n  SUM(CASE WHEN home_del_charge IS NULL THEN 1 ELSE 0 END) AS null_home_del_charge_count,\n  SUM(CASE WHEN rev_adjust IS NULL THEN 1 ELSE 0 END) AS null_rev_adjust_count\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`;"",
    ""validation_sql"": ""SELECT\n  'Validation Check - Subscriptions' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_count_test,\n  CASE WHEN SUM(SAFE_CAST(earned_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS earned_amount_positive_test,\n  CASE WHEN MAX(SAFE_CAST(fiscal_week_id AS INT64)) >= 202535 THEN 'PASS' ELSE 'FAIL' END AS fiscal_week_freshness_test,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS INT64)) AS distinct_fiscal_weeks_in_sample\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) >= 202530 -- Check recent fiscal weeks\nUNION ALL\nSELECT\n  'Validation Check - Circulation Actuals' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_count_test,\n  CASE WHEN SUM(SAFE_CAST(rev_adjust AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS rev_adjust_positive_test,\n  'N/A' AS fiscal_week_freshness_test, -- No fiscal_week_id in this table\n  NULL AS distinct_fiscal_weeks_in_sample -- No fiscal_week_id in this table\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`\nLIMIT 2;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation - Subscriptions Fiscal Week Filter' AS validation_type,\n  'Hardcoded Fiscal Week 202535' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN SAFE_CAST(fiscal_week_id AS INT64) = 202535 THEN 1 ELSE 0 END) AS records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(fiscal_week_id AS INT64) = 202535 THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) >= 202530 -- Look at recent fiscal weeks to see if the rule applies\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  'dv_tm1_pbf_subscriptions' AS source_table,\n  SAFE_CAST(fiscal_week_id AS INT64) AS fiscal_week_id,\n  category_name,\n  gl_publication_code,\n  SAFE_CAST(add_volume AS NUMERIC) AS add_volume,\n  SAFE_CAST(earned_amount AS NUMERIC) AS earned_amount,\n  NULL AS channel,\n  NULL AS state,\n  NULL AS home_del_charge,\n  NULL AS rev_adjust\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) = 202535 -- Use the filtered week for relevance\nORDER BY\n  earned_amount DESC\nLIMIT 50\nUNION ALL\nSELECT\n  'dv_tm1_pbf_circulation_actuals' AS source_table,\n  NULL AS fiscal_week_id,\n  NULL AS category_name,\n  NULL AS gl_publication_code,\n  NULL AS add_volume,\n  NULL AS earned_amount,\n  channel,\n  state,\n  SAFE_CAST(home_del_charge AS NUMERIC) AS home_del_charge,\n  SAFE_CAST(rev_adjust AS NUMERIC) AS rev_adjust\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`\nORDER BY\n  rev_adjust DESC\nLIMIT 50;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""fiscal_period_id"",
          ""hardcoded_values"": [
            ""202535""
          ],
          ""context"": ""Used to filter fiscal_week_id in dv_tm1_pbf_subscriptions query."",
          ""suggested_governance"": ""Replace with a dynamic parameter (e.g., current fiscal week, or user-selected fiscal week) or join to a fiscal calendar dimension table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal week IDs with date parameters or relative fiscal period functions."",
      ""Consider using configuration tables for business rules or lookup values if more complex filtering or categorization is needed.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""add_volume"",
      ""metric_name"": ""Add Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the volume added for subscriptions."",
      ""sql_logic"": ""t0.add_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in subscription performance analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""category_name"",
      ""metric_name"": ""Category Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_select"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the subscription category."",
      ""sql_logic"": ""t0.category_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment subscription data by category."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base"",
      ""metric_name"": ""Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The closing base number for subscriptions."",
      ""sql_logic"": ""t0.closing_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key metric for tracking subscription base changes."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""earned_amount"",
      ""metric_name"": ""Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The amount earned from subscriptions."",
      ""sql_logic"": ""t0.earned_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core revenue metric for subscription performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_select"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Identifier for the fiscal week."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""202535""
      ],
      ""governance_issues"": [
        ""Hardcoded fiscal week ID should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_select"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger publication code for subscriptions."",
      ""sql_logic"": ""t0.gl_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize subscriptions by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""opening_base"",
      ""metric_name"": ""Opening Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The opening base number for subscriptions."",
      ""sql_logic"": ""t0.opening_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key metric for tracking subscription base changes."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""red_volume"",
      ""metric_name"": ""Red Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the redemptions or reductions in volume for subscriptions."",
      ""sql_logic"": ""t0.red_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used in subscription performance analysis to track churn/reductions."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transfer_in"",
      ""metric_name"": ""Transfer In"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume transferred into the subscription base."",
      ""sql_logic"": ""t0.transfer_in"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to track internal movements affecting subscription base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transfer_out"",
      ""metric_name"": ""Transfer Out"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume transferred out of the subscription base."",
      ""sql_logic"": ""t0.transfer_out"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to track internal movements affecting subscription base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""channel"",
      ""metric_name"": ""Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_select"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Distribution channel for circulation actuals."",
      ""sql_logic"": ""t0.channel"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment circulation data by channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""home_del_charge"",
      ""metric_name"": ""Home Delivery Charge"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Charge associated with home delivery for circulation."",
      ""sql_logic"": ""t0.home_del_charge"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Cost component in circulation analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""returns_credit_amount"",
      ""metric_name"": ""Returns Credit Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Credit amount for returns in circulation."",
      ""sql_logic"": ""t0.returns_credit_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Revenue or cost adjustment in circulation analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""rev_adjust"",
      ""metric_name"": ""Revenue Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Revenue adjustment amount for circulation."",
      ""sql_logic"": ""t0.rev_adjust"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key revenue adjustment metric for circulation performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""state"",
      ""metric_name"": ""State"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_select"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Australian state for circulation actuals."",
      ""sql_logic"": ""t0.state"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment circulation data by geographic region."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": []
}
```",success,40
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""705edcb5-737a-4600-b1a7-11870177f97a"",
    ""dashboard_name"": ""Programmatic Impact Reporting"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_short_month"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""advertiser_name"",
      ""cost_model_type"",
      ""revenue_type_level2"",
      ""revenue_group_subtype"",
      ""source_system_code"",
      ""data_load_datetime""
    ],
    ""date_range_detected"": ""October 2025"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""Oct""
    ],
    ""hardcoded_values_found"": [
      ""Medium Rare Content Agency"",
      ""Billed"",
      ""Booked"",
      ""Programmatic"",
      ""Programmatic Source"",
      ""Digital"",
      ""Foxtel Management Pty Ltd"",
      ""PLUTO""
    ],
    ""governance_opportunities"": [
      ""financial_year and financial_short_month should be parameterized or use relative date logic"",
      ""source_publishing_division, revenue_transaction_status, revenue_type_level2, revenue_group_subtype, advertiser_name, and source_system_code values should be managed via lookup tables or configuration, not hardcoded in queries.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.data_load_datetime,\n    t0.financial_short_month,\n    t0.financial_year,\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.cost_model_type,\n    t0.advertiser_name,\n    t0.gross_revenue_amount,\n    t0.revenue_group_subtype,\n    t0.revenue_type_level2,\n    t0.source_system_code\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    NOT(t0.financial_year IS NULL)\n    AND SAFE_CAST(t0.source_publishing_division AS STRING) != 'Medium Rare Content Agency'\n    AND SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Billed', 'Booked')\n    AND SAFE_CAST(t0.financial_year AS STRING) = '2025'\n)\nSELECT\n  DATETIME_TRUNC(base_data.data_load_datetime, SECOND) AS data_load_datetime_second_grain,\n  SAFE_CAST(base_data.financial_short_month AS STRING) AS financial_short_month,\n  SAFE_CAST(base_data.financial_year AS STRING) AS financial_year,\n  SAFE_CAST(base_data.revenue_transaction_status AS STRING) AS revenue_transaction_status,\n  SAFE_CAST(base_data.source_publishing_division AS STRING) AS source_publishing_division,\n  SAFE_CAST(base_data.cost_model_type AS STRING) AS cost_model_type,\n  SAFE_CAST(base_data.advertiser_name AS STRING) AS advertiser_name,\n  SAFE_CAST(base_data.revenue_group_subtype AS STRING) AS revenue_group_subtype,\n  SAFE_CAST(base_data.revenue_type_level2 AS STRING) AS revenue_type_level2,\n  SAFE_CAST(base_data.source_system_code AS STRING) AS source_system_code,\n  SUM(SAFE_CAST(base_data.gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  SUM(CASE\n    WHEN SAFE_CAST(base_data.revenue_type_level2 AS STRING) = 'Programmatic'\n    AND SAFE_CAST(base_data.revenue_group_subtype AS STRING) IN ('Programmatic Source', 'Digital')\n    AND SAFE_CAST(base_data.advertiser_name AS STRING) = 'Foxtel Management Pty Ltd'\n    AND SAFE_CAST(base_data.source_system_code AS STRING) = 'PLUTO'\n    AND SAFE_CAST(base_data.financial_short_month AS STRING) = 'Oct'\n    THEN SAFE_CAST(base_data.gross_revenue_amount AS NUMERIC)\n    ELSE 0\n  END) AS programmatic_gross_revenue_oct_foxtel_pluto\nFROM base_data\nGROUP BY\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10\nORDER BY\n  financial_year DESC, financial_short_month DESC, data_load_datetime_second_grain DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.data_load_datetime AS DATE)) AS unique_data_load_dates,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS STRING)) AS unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_short_month AS STRING)) AS unique_financial_months,\n  COUNT(DISTINCT SAFE_CAST(t0.advertiser_name AS STRING)) AS unique_advertisers,\n  COUNT(DISTINCT SAFE_CAST(t0.source_publishing_division AS STRING)) AS unique_publishing_divisions,\n  MIN(SAFE_CAST(t0.data_load_datetime AS DATE)) AS earliest_data_load_date,\n  MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) AS latest_data_load_date,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_amount_count\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) = '2025'\nLIMIT 1000;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.advertiser_name AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_test,\n  CASE WHEN MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test_last_year,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Billed', 'Booked') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS transaction_status_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) = '2025'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'revenue_transaction_status_rule' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Billed', 'Booked') THEN 1 ELSE 0 END) AS records_passing_status_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage_status,\n  'source_publishing_division_exclusion_rule' AS rule_name_2,\n  SUM(CASE WHEN SAFE_CAST(t0.source_publishing_division AS STRING) != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) AS records_passing_division_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(t0.source_publishing_division AS STRING) != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage_division\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.financial_year AS STRING) = '2025'\nLIMIT 1000;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.data_load_datetime AS DATETIME) AS data_load_datetime,\n  SAFE_CAST(t0.financial_short_month AS STRING) AS financial_short_month,\n  SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n  SAFE_CAST(t0.revenue_transaction_status AS STRING) AS revenue_transaction_status,\n  SAFE_CAST(t0.source_publishing_division AS STRING) AS source_publishing_division,\n  SAFE_CAST(t0.cost_model_type AS STRING) AS cost_model_type,\n  SAFE_CAST(t0.advertiser_name AS STRING) AS advertiser_name,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  SAFE_CAST(t0.revenue_group_subtype AS STRING) AS revenue_group_subtype,\n  SAFE_CAST(t0.revenue_type_level2 AS STRING) AS revenue_type_level2,\n  SAFE_CAST(t0.source_system_code AS STRING) AS source_system_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  NOT(t0.financial_year IS NULL)\n  AND SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND SAFE_CAST(t0.financial_short_month AS STRING) = 'Oct'\nORDER BY\n  SAFE_CAST(t0.data_load_datetime AS DATETIME) DESC,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""Used as a filter for financial_year in all queries."",
          ""suggested_fix"": ""Replace with a parameter or relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or a dashboard date range filter)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""Oct"",
          ""original_format"": ""'Oct'"",
          ""context"": ""Used as a filter for financial_short_month in Query 1 and implicitly in Query 3's specific programmatic revenue calculation."",
          ""suggested_fix"": ""Replace with a parameter or relative date logic (e.g., `FORMAT_DATE('%b', CURRENT_DATE())` or a dashboard date range filter)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Exclusion filter for `source_publishing_division` in all queries."",
          ""suggested_governance"": ""Manage excluded divisions in a configuration table or parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Billed'"",
            ""'Booked'""
          ],
          ""context"": ""Inclusion filter for `revenue_transaction_status` in all queries."",
          ""suggested_governance"": ""Manage valid transaction statuses in a lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic'""
          ],
          ""context"": ""Filter for `revenue_type_level2` in Query 3."",
          ""suggested_governance"": ""Manage revenue types in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic Source'"",
            ""'Digital'""
          ],
          ""context"": ""Filter for `revenue_group_subtype` in Query 3."",
          ""suggested_governance"": ""Manage revenue group subtypes in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Foxtel Management Pty Ltd'""
          ],
          ""context"": ""Filter for `advertiser_name` in Query 3."",
          ""suggested_governance"": ""Manage advertiser names in a lookup table or use advertiser IDs."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'""
          ],
          ""context"": ""Filter for `source_system_code` in Query 3."",
          ""suggested_governance"": ""Manage source system codes in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial year and month with dashboard date range parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_TRUNC(CURRENT_DATE(), YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., `revenue_transaction_status`, `revenue_type_level2`, `source_system_code`) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., `source_publishing_division` exclusions) instead of hardcoded logic within queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""data_load_datetime_second_grain"",
      ""metric_name"": ""Data Load Datetime (Second Grain)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The exact timestamp when the data was loaded, truncated to the second, used for granular time-series analysis."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.data_load_datetime, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""financial_short_month = 'Oct'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Provides a very granular time dimension for understanding data freshness or event timing."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""Oct""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in data_load_datetime""
      ]
    },
    {
      ""metric_id"": ""financial_short_month_dimension"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The abbreviated financial month (e.g., 'Oct', 'Nov') associated with the revenue transaction."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for monthly revenue reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""financial_year_dimension"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the revenue transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for annual revenue reporting and trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_transaction_status_dimension"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction (e.g., 'Billed', 'Booked')."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for filtering revenue to only include confirmed or committed transactions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""source_publishing_division_dimension"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by internal business units, with a specific exclusion for 'Medium Rare Content Agency'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""cost_model_type_dimension"",
      ""metric_name"": ""Cost Model Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of cost model associated with the advertising campaign (e.g., CPM, CPC)."",
      ""sql_logic"": ""t0.cost_model_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides insight into the pricing structure of advertising deals."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""advertiser_name_dimension"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the revenue."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for client-level revenue analysis, specifically filtered for 'Foxtel Management Pty Ltd' in programmatic context."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_group_subtype_dimension"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A more granular classification of revenue type, such as 'Programmatic Source' or 'Digital'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize programmatic revenue further."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_type_level2_dimension"",
      ""metric_name"": ""Revenue Type Level 2"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A secondary classification of revenue type, specifically 'Programmatic' in one query."",
      ""sql_logic"": ""t0.revenue_type_level2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to identify and filter for programmatic revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""source_system_code_dimension"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The code identifying the source system from which the revenue data originated, specifically 'PLUTO' in one query."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter revenue by the originating system, specifically for 'PLUTO' in programmatic context."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue amounts for all transactions matching the common filters."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Represents the overall revenue generated under specified conditions, serving as a core financial metric."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in gross_revenue_amount""
      ]
    },
    {
      ""metric_id"": ""programmatic_gross_revenue_oct_foxtel_pluto"",
      ""metric_name"": ""Programmatic Gross Revenue (Oct, Foxtel, PLUTO)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount"",
        ""revenue_type_level2_dimension"",
        ""revenue_group_subtype_dimension"",
        ""advertiser_name_dimension"",
        ""source_system_code_dimension"",
        ""financial_short_month_dimension""
      ],
      ""business_description"": ""The sum of gross revenue amounts specifically for programmatic transactions, from 'Foxtel Management Pty Ltd', via 'PLUTO' system, for October 2025, and with 'Billed' or 'Booked' status, excluding 'Medium Rare Content Agency'."",
      ""sql_logic"": ""SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital') AND t0.advertiser_name = 'Foxtel Management Pty Ltd' AND t0.source_system_code = 'PLUTO' AND t0.financial_short_month = 'Oct' THEN t0.gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A highly specific and critical metric for programmatic revenue impact reporting, focusing on a particular client, system, and period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""Oct""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date filters should be parameterized"",
        ""lookup values should use reference table"",
        ""advertiser name and source system code should be parameterized or use reference tables""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in gross_revenue_amount"",
        ""accuracy depends on correct categorization of revenue types and subtypes""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""financial_year_dimension"",
        ""financial_short_month_dimension"",
        ""revenue_transaction_status_dimension"",
        ""source_publishing_division_dimension""
      ],
      ""relationship_description"": ""The `total_gross_revenue_amount` is directly filtered by the `financial_year`, `financial_short_month`, `revenue_transaction_status`, and `source_publishing_division` dimensions. Any change in these filter values will directly impact the calculated total revenue."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE financial_year = '2025' AND financial_short_month = 'Oct' AND revenue_transaction_status IN ('Billed', 'Booked') AND source_publishing_division != 'Medium Rare Content Agency'"",
      ""business_validation"": ""Ensures that only relevant and confirmed revenue for the specified period and divisions is included in the total."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(financial_short_month AS STRING) = 'Oct' AND SAFE_CAST(revenue_transaction_status AS STRING) IN ('Billed', 'Booked') AND SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""programmatic_gross_revenue_oct_foxtel_pluto"",
      ""related_metrics"": [
        ""total_gross_revenue_amount"",
        ""revenue_type_level2_dimension"",
        ""revenue_group_subtype_dimension"",
        ""advertiser_name_dimension"",
        ""source_system_code_dimension"",
        ""financial_short_month_dimension""
      ],
      ""relationship_description"": ""The `programmatic_gross_revenue_oct_foxtel_pluto` is a subset of the `total_gross_revenue_amount`, specifically filtered by `revenue_type_level2 = 'Programmatic'`, `revenue_group_subtype` in ('Programmatic Source', 'Digital'), `advertiser_name = 'Foxtel Management Pty Ltd'`, `source_system_code = 'PLUTO'`, and `financial_short_month = 'Oct'`, in addition to the common filters."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE (common filters) AND revenue_type_level2 = 'Programmatic' AND revenue_group_subtype IN ('Programmatic Source', 'Digital') AND advertiser_name = 'Foxtel Management Pty Ltd' AND source_system_code = 'PLUTO' AND financial_short_month = 'Oct'"",
      ""business_validation"": ""This relationship defines the specific criteria for 'Programmatic Impact' as understood by the dashboard, allowing for focused analysis on a key segment."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE SAFE_CAST(financial_year AS STRING) = '2025' AND SAFE_CAST(financial_short_month AS STRING) = 'Oct' AND SAFE_CAST(revenue_transaction_status AS STRING) IN ('Billed', 'Booked') AND SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' AND SAFE_CAST(revenue_type_level2 AS STRING) = 'Programmatic' AND SAFE_CAST(revenue_group_subtype AS STRING) IN ('Programmatic Source', 'Digital') AND SAFE_CAST(advertiser_name AS STRING) = 'Foxtel Management Pty Ltd' AND SAFE_CAST(source_system_code AS STRING) = 'PLUTO';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,41
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c441950c-1e3f-432c-9838-847d1d315b9e"",
    ""dashboard_name"": ""Circulation Insights for Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights;ncau-data-newsquery-prd.prstn_finance.v_calendar_dim"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""day_of_week"",
      ""charge_type"",
      ""gl_publication_code"",
      ""sales_channel_l4"",
      ""charge_date""
    ],
    ""date_range_detected"": ""Fiscal Year 2025 (specific weeks within)"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'Sun'"",
      ""202541"",
      ""202542"",
      ""202543"",
      ""202544"",
      ""202545"",
      ""202533"",
      ""202534"",
      ""202535"",
      ""202536"",
      ""202537"",
      ""202538"",
      ""202539"",
      ""202540"",
      ""'DRAW'"",
      ""'RETURNS'"",
      ""'ADJUSTMENT'"",
      ""'Subscriptions'"",
      ""'DT'"",
      ""'500'"",
      ""'560'"",
      ""'100'"",
      ""'400'"",
      ""'402'"",
      ""'9504'"",
      ""'9505'"",
      ""'110'"",
      ""'116'"",
      ""'350'"",
      ""'670'"",
      ""'180'"",
      ""'156'"",
      ""'301'"",
      ""'303'"",
      ""'5003'"",
      ""'850'"",
      ""'852'"",
      ""'961'"",
      ""'963'"",
      ""'158'"",
      ""'Post Courier'"",
      ""'5024'"",
      ""'9514'"",
      ""'9515'"",
      ""'5053'"",
      ""'450'"",
      ""'475'"",
      ""'9560'"",
      ""'9556'"",
      ""'305'""
    ],
    ""governance_opportunities"": [
      ""Fiscal year and week filters should be parameterized or use relative date logic."",
      ""Day of week, charge type, and sales channel filters should be parameterized."",
      ""GL publication codes and their corresponding names should be managed in a dedicated lookup table (e.g., `prstn_finance.dim_gl_publication_codes`) and joined, rather than hardcoded in CASE statements.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all identified metrics and key dimensions into a single, BigQuery-compliant view.\n-- It applies a general fiscal year filter and includes the complex GL publication mapping.\n\nWITH base_circulation_data AS (\n  SELECT\n    ci.charge_date,\n    ci.charge_type,\n    ci.day_of_week,\n    SAFE_CAST(ci.fiscal_week_id AS STRING) AS fiscal_week_id_str,\n    ci.route_volume,\n    ci.charge_amount,\n    SAFE_CAST(ci.gl_publication_code AS STRING) AS gl_publication_code_str,\n    ci.sales_channel_l4,\n    cal.day_short_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n    LEFT JOIN\n    `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n    ON ci.charge_date = cal.calendar_date\n  WHERE\n    -- Filter for fiscal year 2025 as detected in original queries\n    SAFE_LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) = '2025'\n    -- Add a general date range for performance, e.g., last 180 days if data is recent\n    AND ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 180 DAY)\n),\n\ncalculated_metrics AS (\n  SELECT\n    charge_date,\n    charge_type,\n    day_of_week,\n    fiscal_week_id_str,\n    gl_publication_code_str,\n    sales_channel_l4,\n    day_short_name,\n    route_volume,\n    charge_amount,\n    -- Derived GL Publication Name (hardcoded mapping from original query)\n    CASE\n      WHEN gl_publication_code_str IN ('500', '560') THEN 'ADV'\n      WHEN gl_publication_code_str = '100' THEN 'AUS'\n      WHEN gl_publication_code_str IN ('400', '402') THEN 'CM'\n      WHEN gl_publication_code_str = '9504' THEN 'Delicious'\n      WHEN gl_publication_code_str = '9505' THEN 'Delicious Specials'\n      WHEN gl_publication_code_str IN ('110', '116') THEN 'DT'\n      WHEN gl_publication_code_str = '350' THEN 'GAD'\n      WHEN gl_publication_code_str = '670' THEN 'GCB'\n      WHEN gl_publication_code_str = '180' THEN 'Group Shared Services'\n      WHEN gl_publication_code_str = '156' THEN 'Hobart Print Services'\n      WHEN gl_publication_code_str IN ('301', '303') THEN 'HS'\n      WHEN gl_publication_code_str = '5003' THEN 'MDM'\n      WHEN gl_publication_code_str IN ('850', '852') THEN 'MERCURY'\n      WHEN gl_publication_code_str IN ('961', '963') THEN 'NTN'\n      WHEN gl_publication_code_str = '158' THEN 'Perth Print Services'\n      WHEN gl_publication_code_str = 'Post Courier' THEN 'Post Courier'\n      WHEN gl_publication_code_str = '5024' THEN 'SC'\n      WHEN gl_publication_code_str IN ('9514', '9515') THEN 'Taste'\n      WHEN gl_publication_code_str = '5053' THEN 'TCHRN'\n      WHEN gl_publication_code_str = '450' THEN 'TCP'\n      WHEN gl_publication_code_str = '475' THEN 'TVB'\n      WHEN gl_publication_code_str = '9560' THEN 'Vogue'\n      WHEN gl_publication_code_str = '9556' THEN 'Vogue Living'\n      WHEN gl_publication_code_str = '305' THEN 'WT'\n      ELSE 'Other'\n    END AS gl_publication_name,\n    -- Metric: Total Returns Volume\n    CASE WHEN charge_type = 'RETURNS' THEN SAFE_CAST(route_volume AS NUMERIC) ELSE 0 END AS returns_volume,\n    -- Metric: Total Draw Volume\n    CASE WHEN charge_type = 'DRAW' THEN SAFE_CAST(route_volume AS NUMERIC) ELSE 0 END AS draw_volume,\n    -- Metric: Total Adjustment Volume\n    CASE WHEN charge_type = 'ADJUSTMENT' THEN SAFE_CAST(route_volume AS NUMERIC) ELSE 0 END AS adjustment_volume,\n    -- Metric: Total Charge Amount\n    SAFE_CAST(charge_amount AS NUMERIC) AS charge_amount_numeric\n  FROM\n    base_circulation_data\n)\n\nSELECT\n  fiscal_week_id_str AS fiscal_week_id,\n  day_of_week,\n  gl_publication_name,\n  sales_channel_l4,\n  SUM(returns_volume) AS total_returns_volume,\n  SUM(draw_volume) AS total_draw_volume,\n  SUM(adjustment_volume) AS total_adjustment_volume,\n  SUM(returns_volume + draw_volume + adjustment_volume) AS total_volume_draw_returns_adjustment,\n  SUM(charge_amount_numeric) AS total_charge_amount\nFROM\n  calculated_metrics\nGROUP BY\n  fiscal_week_id_str,\n  day_of_week,\n  gl_publication_name,\n  sales_channel_l4\nORDER BY\n  fiscal_week_id_str DESC, day_of_week ASC\nLIMIT 1000;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(ci.charge_date AS DATE)) AS unique_charge_dates,\n  COUNT(DISTINCT SAFE_CAST(ci.fiscal_week_id AS STRING)) AS unique_fiscal_weeks,\n  COUNT(DISTINCT ci.charge_type) AS unique_charge_types,\n  COUNT(DISTINCT ci.gl_publication_code) AS unique_gl_publication_codes,\n  COUNT(DISTINCT ci.sales_channel_l4) AS unique_sales_channels,\n  MIN(SAFE_CAST(ci.charge_date AS DATE)) AS earliest_charge_date,\n  MAX(SAFE_CAST(ci.charge_date AS DATE)) AS latest_charge_date,\n  AVG(SAFE_CAST(ci.route_volume AS NUMERIC)) AS avg_route_volume,\n  AVG(SAFE_CAST(ci.charge_amount AS NUMERIC)) AS avg_charge_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\nWHERE\n  -- Sample data for recent period to ensure relevance and performance\n  ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and return plausible values\nWITH base_data AS (\n  SELECT\n    ci.charge_type,\n    ci.route_volume,\n    ci.charge_amount,\n    SAFE_CAST(ci.fiscal_week_id AS STRING) AS fiscal_week_id_str,\n    ci.gl_publication_code,\n    ci.sales_channel_l4,\n    ci.charge_date\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  WHERE\n    ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n    AND SAFE_LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) = '2025'\n)\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(CASE WHEN charge_type = 'RETURNS' THEN SAFE_CAST(route_volume AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS returns_volume_test,\n  CASE WHEN SUM(CASE WHEN charge_type = 'DRAW' THEN SAFE_CAST(route_volume AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS draw_volume_test,\n  CASE WHEN SUM(SAFE_CAST(charge_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS charge_amount_test,\n  CASE WHEN COUNT(DISTINCT fiscal_week_id_str) > 0 THEN 'PASS' ELSE 'FAIL' END AS fiscal_week_id_test,\n  CASE WHEN COUNT(DISTINCT gl_publication_code) > 0 THEN 'PASS' ELSE 'FAIL' END AS gl_publication_code_test,\n  CASE WHEN MAX(SAFE_CAST(charge_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test\nFROM\n  base_data\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\n-- Validating the GL Publication Code mapping coverage and 'Other' category usage\nWITH base_data AS (\n  SELECT\n    SAFE_CAST(gl_publication_code AS STRING) AS gl_publication_code_str\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights`\n  WHERE\n    charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n    AND SAFE_LEFT(SAFE_CAST(fiscal_week_id AS STRING), 4) = '2025'\n)\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'GL Publication Code Mapping Coverage' AS rule_name,\n  COUNT(*) AS total_records_tested,\n  SUM(CASE\n    WHEN gl_publication_code_str IN (\n      '500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156',\n      '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514',\n      '9515', '5053', '450', '475', '9560', '9556', '305'\n    ) THEN 1\n    ELSE 0\n  END) AS records_with_mapped_code,\n  SUM(CASE\n    WHEN gl_publication_code_str NOT IN (\n      '500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156',\n      '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514',\n      '9515', '5053', '450', '475', '9560', '9556', '305'\n    ) THEN 1\n    ELSE 0\n  END) AS records_falling_into_other,\n  SAFE_DIVIDE(\n    SUM(CASE\n      WHEN gl_publication_code_str IN (\n        '500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156',\n        '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514',\n        '9515', '5053', '450', '475', '9560', '9556', '305'\n      ) THEN 1\n      ELSE 0\n    END), COUNT(*)\n  ) * 100 AS percentage_mapped,\n  SAFE_DIVIDE(\n    SUM(CASE\n      WHEN gl_publication_code_str NOT IN (\n        '500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156',\n        '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514',\n        '9515', '5053', '450', '475', '9560', '9556', '305'\n      ) THEN 1\n      ELSE 0\n    END), COUNT(*)\n  ) * 100 AS percentage_other\nFROM\n  base_data\nLIMIT 1;\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(ci.charge_date AS DATE) AS charge_date,\n  ci.charge_type,\n  ci.day_of_week,\n  SAFE_CAST(ci.fiscal_week_id AS STRING) AS fiscal_week_id,\n  SAFE_CAST(ci.route_volume AS NUMERIC) AS route_volume,\n  SAFE_CAST(ci.charge_amount AS NUMERIC) AS charge_amount,\n  SAFE_CAST(ci.gl_publication_code AS STRING) AS gl_publication_code,\n  ci.sales_channel_l4,\n  cal.day_short_name\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  LEFT JOIN\n  `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n  ON ci.charge_date = cal.calendar_date\nWHERE\n  -- Filter for recent data and the detected fiscal year\n  ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND SAFE_LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) = '2025'\nORDER BY\n  ci.charge_date DESC, ci.charge_amount DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""Fiscal year filter applied to all queries."",
          ""suggested_fix"": ""Replace with a parameter (e.g., `{{fiscal_year_param}}`) or relative fiscal year logic (e.g., `CURRENT_FISCAL_YEAR()`)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'500'"",
            ""'560'"",
            ""'100'"",
            ""'400'"",
            ""'402'"",
            ""'9504'"",
            ""'9505'"",
            ""'110'"",
            ""'116'"",
            ""'350'"",
            ""'670'"",
            ""'180'"",
            ""'156'"",
            ""'301'"",
            ""'303'"",
            ""'5003'"",
            ""'850'"",
            ""'852'"",
            ""'961'"",
            ""'963'"",
            ""'158'"",
            ""'Post Courier'"",
            ""'5024'"",
            ""'9514'"",
            ""'9515'"",
            ""'5053'"",
            ""'450'"",
            ""'475'"",
            ""'9560'"",
            ""'9556'"",
            ""'305'""
          ],
          ""context"": ""GL publication codes mapped to names in a large CASE statement."",
          ""suggested_governance"": ""Create and join to a `dim_gl_publication_codes` lookup table in `prstn_finance` dataset."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'Sun'"",
            ""202541"",
            ""202542"",
            ""202543"",
            ""202544"",
            ""202545"",
            ""202533"",
            ""202534"",
            ""202535"",
            ""202536"",
            ""202537"",
            ""202538"",
            ""202539"",
            ""202540"",
            ""'DRAW'"",
            ""'RETURNS'"",
            ""'ADJUSTMENT'"",
            ""'Subscriptions'"",
            ""'DT'""
          ],
          ""context"": ""Specific day of week, fiscal week IDs, charge types, sales channels, and derived publication names used as filters."",
          ""suggested_governance"": ""Replace with Looker Studio controls/parameters for user selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal years and specific fiscal week IDs with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values for GL publication codes with joins to a governed reference table (`dim_gl_publication_codes`)."",
      ""Implement Looker Studio controls for filtering by 'Day of Week', 'Charge Type', 'Sales Channel L4', and 'GL Publication Name' instead of hardcoding values in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_returns_volume"",
      ""metric_name"": ""Total Returns Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume of circulation items classified as 'RETURNS'. This indicates the quantity of products returned to the distributor or publisher."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Crucial for understanding product flow, potential waste, and operational efficiency in circulation."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'RETURNS'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on correct classification of 'RETURNS' charge type.""
      ]
    },
    {
      ""metric_id"": ""total_draw_volume"",
      ""metric_name"": ""Total Draw Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume of circulation items classified as 'DRAW'. This represents the quantity of products initially distributed or supplied."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key indicator of distribution scale and initial supply planning."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DRAW'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on correct classification of 'DRAW' charge type.""
      ]
    },
    {
      ""metric_id"": ""total_adjustment_volume"",
      ""metric_name"": ""Total Adjustment Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume of circulation items classified as 'ADJUSTMENT'. This accounts for miscellaneous changes in volume not covered by standard draws or returns."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Important for reconciling total circulation figures and identifying unusual volume changes."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ADJUSTMENT'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on correct classification of 'ADJUSTMENT' charge type.""
      ]
    },
    {
      ""metric_id"": ""total_volume_draw_returns_adjustment"",
      ""metric_name"": ""Total Volume (Draw + Returns + Adjustment)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_draw_volume"",
        ""total_returns_volume"",
        ""total_adjustment_volume""
      ],
      ""business_description"": ""The combined total volume of circulation items for 'DRAW', 'RETURNS', and 'ADJUSTMENT' charge types. This represents the overall movement of physical products."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type IN ('DRAW', 'RETURNS', 'ADJUSTMENT') THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A comprehensive measure of physical product circulation, essential for logistics and inventory management."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DRAW'"",
        ""'RETURNS'"",
        ""'ADJUSTMENT'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on the accuracy of individual volume types.""
      ]
    },
    {
      ""metric_id"": ""total_charge_amount"",
      ""metric_name"": ""Total Charge Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total monetary amount charged for circulation items, representing revenue or cost depending on context."",
      ""sql_logic"": ""SUM(charge_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'"",
        ""fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540)"",
        ""sales_channel_l4 = 'Subscriptions'"",
        ""gl_publication_name = 'DT'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Directly impacts financial reporting and revenue analysis for circulation activities."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Subscriptions'"",
        ""'DT'""
      ],
      ""governance_issues"": [
        ""Lookup values for GL publication name ('DT') should use reference table."",
        ""Sales channel filter ('Subscriptions') should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls or incorrect values in charge_amount if data source is not clean.""
      ]
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Identifier for the fiscal week in YYYYWW format. Used for time-based aggregation and filtering."",
      ""sql_logic"": ""fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = '2025'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for financial and operational reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""day_of_week"",
      ""metric_name"": ""Day of Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Short name for the day of the week (e.g., 'Sun', 'Mon'). Used for daily trend analysis."",
      ""sql_logic"": ""day_of_week (from v_calendar_dim)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance.v_calendar_dim""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides granularity for daily patterns and operational scheduling."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""charge_type"",
      ""metric_name"": ""Charge Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of the circulation transaction (e.g., 'DRAW', 'RETURNS', 'ADJUSTMENT')."",
      ""sql_logic"": ""charge_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Fundamental for segmenting circulation volumes and understanding transaction types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_channel_l4"",
      ""metric_name"": ""Sales Channel Level 4"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The most granular level of sales channel classification."",
      ""sql_logic"": ""sales_channel_l4"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for analysis of circulation performance by specific sales channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_publication_name"",
      ""metric_name"": ""GL Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Human-readable name for the GL Publication Code, derived from a hardcoded mapping. Represents the specific publication or masthead."",
      ""sql_logic"": ""CASE WHEN gl_publication_code IN (...) THEN 'ADV' ... ELSE 'Other' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Critical for segmenting circulation data by publication, enabling specific product performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'500'"",
        ""'560'"",
        ""'100'"",
        ""'400'"",
        ""'402'"",
        ""'9504'"",
        ""'9505'"",
        ""'110'"",
        ""'116'"",
        ""'350'"",
        ""'670'"",
        ""'180'"",
        ""'156'"",
        ""'301'"",
        ""'303'"",
        ""'5003'"",
        ""'850'"",
        ""'852'"",
        ""'961'"",
        ""'963'"",
        ""'158'"",
        ""'Post Courier'"",
        ""'5024'"",
        ""'9514'"",
        ""'9515'"",
        ""'5053'"",
        ""'450'"",
        ""'475'"",
        ""'TVB'"",
        ""'9560'"",
        ""'9556'"",
        ""'305'"",
        ""'ADV'"",
        ""'AUS'"",
        ""'CM'"",
        ""'Delicious'"",
        ""'Delicious Specials'"",
        ""'DT'"",
        ""'GAD'"",
        ""'GCB'"",
        ""'Group Shared Services'"",
        ""'Hobart Print Services'"",
        ""'HS'"",
        ""'MDM'"",
        ""'MERCURY'"",
        ""'NTN'"",
        ""'Perth Print Services'"",
        ""'Post Courier'"",
        ""'SC'"",
        ""'Taste'"",
        ""'TCHRN'"",
        ""'TCP'"",
        ""'TVB'"",
        ""'Vogue'"",
        ""'Vogue Living'"",
        ""'WT'"",
        ""'Other'""
      ],
      ""governance_issues"": [
        ""Hardcoded lookup values; should be replaced by a join to a governed dimension table.""
      ],
      ""data_quality_concerns"": [
        ""New GL publication codes will fall into 'Other' category until mapping is updated.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_volume_draw_returns_adjustment"",
      ""related_metrics"": [
        ""total_draw_volume"",
        ""total_returns_volume"",
        ""total_adjustment_volume""
      ],
      ""relationship_description"": ""The total volume (Draw + Returns + Adjustment) is the sum of individual draw, returns, and adjustment volumes."",
      ""mathematical_formula"": ""Total Volume = Total Draw Volume + Total Returns Volume + Total Adjustment Volume"",
      ""business_validation"": ""Ensures that the overall physical product movement is accurately accounted for by summing its constituent parts."",
      ""validation_sql"": ""SELECT SUM(total_volume_draw_returns_adjustment) - (SUM(total_draw_volume) + SUM(total_returns_volume) + SUM(total_adjustment_volume)) AS difference FROM consolidated_metrics_table WHERE fiscal_year = '2025' AND difference != 0;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,42
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5491badf-5ec0-4b4f-a427-b12a3a3395dd"",
    ""dashboard_name"": ""Programmatic / Tubi Performance FY25"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_month"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""programmatic_type"",
      ""cost_model_type"",
      ""revenue_group_subtype"",
      ""unified_publication_name"",
      ""relative_fy_year_offset"",
      ""relative_fy_month_offset"",
      ""reporting_date""
    ],
    ""date_range_detected"": ""Current FY and Previous FY, with YTD as of 2025-06-18"",
    ""hardcoded_dates_found"": [
      ""2025-06-18""
    ],
    ""hardcoded_values_found"": [
      ""financial_quarter = 2"",
      ""relative_fy_year_offset = 0"",
      ""relative_fy_year_offset = -1"",
      ""'PMP'"",
      ""'TUBI'"",
      ""'PERFORMANCE'"",
      ""'PG'"",
      ""'OMP'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'Run of Audience Extension'"",
      ""'GUARANTEED'"",
      ""'NON-GUARANTEED'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized (e.g., YTD cut-off date)"",
      ""Financial quarter filter should be dynamic or parameterized"",
      ""Classification values (PMP, TUBI, etc.) should be managed in a governed lookup table and joined, rather than hardcoded in CASE statements.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Consolidated query for all key metrics\nWITH\n  base_data AS (\n    SELECT\n      t0.cost_model_type,\n      t0.financial_month,\n      t0.financial_quarter,\n      t0.financial_short_month,\n      t0.gross_revenue_amount,\n      t0.relative_fy_year_offset,\n      t0.relative_fy_month_offset,\n      t0.reporting_date,\n      t0.revenue_group_subtype,\n      t0.unified_publication_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n    WHERE\n      SAFE_CAST(t0.reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Filter for last 2 years for relevance\n  ),\n  derived_attributes AS (\n    SELECT\n      cost_model_type,\n      financial_month,\n      financial_quarter,\n      financial_short_month,\n      gross_revenue_amount,\n      relative_fy_year_offset,\n      relative_fy_month_offset,\n      reporting_date,\n      revenue_group_subtype,\n      unified_publication_name,\n      -- Derived flags and classifications\n      UPPER(SAFE_CAST(cost_model_type AS STRING)) AS cost_model_type_upper,\n      UPPER(SAFE_CAST(revenue_group_subtype AS STRING)) AS revenue_group_subtype_upper,\n      CASE\n        WHEN unified_publication_name = 'Run of Audience Extension' THEN 'Y'\n        ELSE 'N'\n      END AS is_run_of_audience_extension_flag,\n      CASE\n        WHEN unified_publication_name = 'TUBI' THEN 'TUBI'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'GUARANTEED' THEN 'PG'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'NON-GUARANTEED' THEN 'OMP'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'PMP' THEN 'PMP'\n        WHEN unified_publication_name = 'Run of Audience Extension' THEN 'PERFORMANCE'\n        ELSE NULL\n      END AS programmatic_type,\n      (relative_fy_year_offset = 0) AS is_current_fy,\n      (relative_fy_year_offset = -1) AS is_previous_fy,\n      (SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18')) AS is_ytd_period_as_of_hardcoded_date\n    FROM\n      base_data\n  ),\n  calculated_measures AS (\n    SELECT\n      financial_month,\n      financial_quarter,\n      financial_short_month,\n      programmatic_type,\n      cost_model_type_upper,\n      revenue_group_subtype_upper,\n      relative_fy_year_offset,\n      relative_fy_month_offset,\n      reporting_date,\n      gross_revenue_amount,\n      -- Programmatic Source Revenue (clmn12_ in Q1, clmn19_ in Q2)\n      CASE\n        WHEN revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount\n        ELSE NULL\n      END AS programmatic_source_revenue,\n      -- Base Revenue for FY Calculation (clmn14_/clmn15_ in Q1)\n      CASE\n        WHEN programmatic_type = 'PERFORMANCE' THEN gross_revenue_amount\n        WHEN revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount\n        ELSE NULL\n      END AS base_revenue_for_fy_calc,\n      -- Previous Year Revenue (Q1 clmn16_, clmn18_)\n      CASE\n        WHEN is_previous_fy THEN\n          CASE\n            WHEN programmatic_type = 'PERFORMANCE' THEN gross_revenue_amount\n            WHEN revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount\n            ELSE NULL\n          END\n        ELSE NULL\n      END AS py_revenue_total,\n      -- Current Year Revenue (Q1 clmn17_, clmn19_)\n      CASE\n        WHEN is_current_fy THEN\n          CASE\n            WHEN programmatic_type = 'PERFORMANCE' THEN gross_revenue_amount\n            WHEN revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount\n            ELSE NULL\n          END\n        ELSE NULL\n      END AS cy_revenue_total,\n      -- Combined Programmatic Revenue (Q2 clmn27_)\n      CASE\n        WHEN programmatic_type IN ('TUBI', 'PERFORMANCE') THEN gross_revenue_amount\n        WHEN revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount\n        ELSE NULL\n      END AS combined_programmatic_revenue\n    FROM\n      derived_attributes\n  )\nSELECT\n  financial_short_month,\n  financial_quarter,\n  financial_month,\n  programmatic_type,\n  relative_fy_year_offset,\n  relative_fy_month_offset,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(programmatic_source_revenue) AS total_programmatic_source_revenue,\n  SUM(py_revenue_total) AS total_py_revenue,\n  SUM(cy_revenue_total) AS total_cy_revenue,\n  SUM(CASE WHEN programmatic_type = 'PMP' AND is_previous_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS py_revenue_pmp,\n  SUM(CASE WHEN programmatic_type = 'TUBI' AND is_previous_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS py_revenue_tubi,\n  SUM(CASE WHEN programmatic_type = 'PERFORMANCE' AND is_previous_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS py_revenue_performance,\n  SUM(CASE WHEN programmatic_type = 'PG' AND is_previous_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS py_revenue_pg,\n  SUM(CASE WHEN programmatic_type = 'OMP' AND is_previous_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS py_revenue_omp,\n  SUM(CASE WHEN programmatic_type = 'PMP' AND is_current_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS cy_revenue_pmp,\n  SUM(CASE WHEN programmatic_type = 'TUBI' AND is_current_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS cy_revenue_tubi,\n  SUM(CASE WHEN programmatic_type = 'PERFORMANCE' AND is_current_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS cy_revenue_performance,\n  SUM(CASE WHEN programmatic_type = 'PG' AND is_current_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS cy_revenue_pg,\n  SUM(CASE WHEN programmatic_type = 'OMP' AND is_current_fy THEN base_revenue_for_fy_calc ELSE NULL END) AS cy_revenue_omp,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date THEN combined_programmatic_revenue ELSE NULL END) AS cy_combined_programmatic_revenue_ytd,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date AND programmatic_type = 'TUBI' THEN gross_revenue_amount ELSE NULL END) AS cy_tubi_revenue_ytd,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date AND programmatic_type = 'PERFORMANCE' THEN gross_revenue_amount ELSE NULL END) AS cy_performance_revenue_ytd,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date AND cost_model_type_upper = 'PMP' THEN combined_programmatic_revenue ELSE NULL END) AS cy_pmp_revenue_ytd,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date AND cost_model_type_upper = 'GUARANTEED' THEN combined_programmatic_revenue ELSE NULL END) AS cy_guaranteed_revenue_ytd,\n  SUM(CASE WHEN is_current_fy AND is_ytd_period_as_of_hardcoded_date AND cost_model_type_upper = 'NON-GUARANTEED' THEN combined_programmatic_revenue ELSE NULL END) AS cy_nonguaranteed_revenue_ytd\nFROM\n  calculated_measures\nWHERE\n  SAFE_CAST(financial_quarter AS INT64) = 2 -- Hardcoded filter from Q1\n  OR relative_fy_year_offset = 0 -- Filter from Q2\nGROUP BY\n  financial_short_month,\n  financial_quarter,\n  financial_month,\n  programmatic_type,\n  relative_fy_year_offset,\n  relative_fy_month_offset\nORDER BY\n  MIN(SAFE_CAST(financial_month AS INT64)) ASC -- Order by financial_month as in Q1\nLIMIT 100000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(reporting_date AS DATE)) AS unique_reporting_dates,\n  COUNT(DISTINCT SAFE_CAST(financial_month AS INT64)) AS unique_financial_months,\n  COUNT(DISTINCT SAFE_CAST(financial_quarter AS INT64)) AS unique_financial_quarters,\n  COUNT(DISTINCT unified_publication_name) AS unique_publication_names,\n  COUNT(DISTINCT cost_model_type) AS unique_cost_model_types,\n  COUNT(DISTINCT revenue_group_subtype) AS unique_revenue_subtypes,\n  MIN(SAFE_CAST(reporting_date AS DATE)) AS earliest_reporting_date,\n  MAX(SAFE_CAST(reporting_date AS DATE)) AS latest_reporting_date,\n  AVG(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS avg_gross_revenue_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE\n  SAFE_CAST(reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS total_revenue_positive_test,\n  CASE\n    WHEN COUNT(DISTINCT unified_publication_name) > 1 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS multiple_publication_names_test,\n  CASE\n    WHEN MAX(SAFE_CAST(reporting_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS data_freshness_test,\n  CASE\n    WHEN COUNT(CASE WHEN SAFE_CAST(relative_fy_year_offset AS INT64) = 0 THEN 1 END) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS current_fy_data_exists_test,\n  CASE\n    WHEN COUNT(CASE WHEN SAFE_CAST(financial_quarter AS INT64) = 2 THEN 1 END) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS quarter_2_data_exists_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE\n  SAFE_CAST(reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Programmatic Type Classification' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(\n    CASE\n      WHEN unified_publication_name = 'TUBI' AND programmatic_type = 'TUBI' THEN 1\n      WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'GUARANTEED' AND programmatic_type = 'PG' THEN 1\n      WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'NON-GUARANTEED' AND programmatic_type = 'OMP' THEN 1\n      WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'PMP' AND programmatic_type = 'PMP' THEN 1\n      WHEN unified_publication_name = 'Run of Audience Extension' AND programmatic_type = 'PERFORMANCE' THEN 1\n      ELSE 0\n    END\n  ) AS records_matching_rule,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN unified_publication_name = 'TUBI' AND programmatic_type = 'TUBI' THEN 1\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'GUARANTEED' AND programmatic_type = 'PG' THEN 1\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'NON-GUARANTEED' AND programmatic_type = 'OMP' THEN 1\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'PMP' AND programmatic_type = 'PMP' THEN 1\n        WHEN unified_publication_name = 'Run of Audience Extension' AND programmatic_type = 'PERFORMANCE' THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS compliance_percentage\nFROM\n  (\n    SELECT\n      unified_publication_name,\n      cost_model_type,\n      CASE\n        WHEN unified_publication_name = 'TUBI' THEN 'TUBI'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'GUARANTEED' THEN 'PG'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'NON-GUARANTEED' THEN 'OMP'\n        WHEN UPPER(SAFE_CAST(cost_model_type AS STRING)) = 'PMP' THEN 'PMP'\n        WHEN unified_publication_name = 'Run of Audience Extension' THEN 'PERFORMANCE'\n        ELSE NULL\n      END AS programmatic_type\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\n    WHERE\n      SAFE_CAST(reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  )\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(reporting_date AS DATE) AS reporting_date,\n  financial_short_month,\n  financial_quarter,\n  cost_model_type,\n  revenue_group_subtype,\n  unified_publication_name,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  SAFE_CAST(relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n  SAFE_CAST(relative_fy_month_offset AS INT64) AS relative_fy_month_offset\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE\n  SAFE_CAST(reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  reporting_date DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-18"",
          ""original_format"": ""DATE(TIMESTAMP '2025-06-18 03:06:41.434326+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed cut-off date for 'Year-to-Date' calculations in the second query."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` for dynamic YTD, or a dashboard parameter for user-defined YTD cut-off."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PMP'"",
            ""'TUBI'"",
            ""'PERFORMANCE'"",
            ""'PG'"",
            ""'OMP'"",
            ""'PROGRAMMATIC SOURCE'"",
            ""'Run of Audience Extension'"",
            ""'GUARANTEED'"",
            ""'NON-GUARANTEED'""
          ],
          ""context"": ""These values are used in `CASE` statements to classify revenue types (programmatic_type) and filter data. They represent business categories."",
          ""suggested_governance"": ""Create a `dim_programmatic_type` or `dim_revenue_classification` lookup table. Join to this table based on `unified_publication_name`, `cost_model_type`, and `revenue_group_subtype` to derive the `programmatic_type` dimension. This centralizes business logic and allows for easier updates."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""2""
          ],
          ""context"": ""The filter `clmn9_ = 2` (which maps to `financial_quarter = 2`) is hardcoded in the first query's `WHERE` clause."",
          ""suggested_governance"": ""Replace with a dashboard parameter for the financial quarter, or use relative date logic (e.g., `CURRENT_FINANCIAL_QUARTER()`)."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""relative_offsets"",
          ""hardcoded_values"": [
            ""0"",
            ""-1""
          ],
          ""context"": ""Used for `relative_fy_year_offset` to identify Current Year (0) and Previous Year (-1) data."",
          ""suggested_governance"": ""While relative offsets are generally good, these specific values could be defined as named constants or parameters if the definition of 'current' or 'previous' ever changes or needs to be dynamic (e.g., '2 years ago')."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded YTD cut-off date (2025-06-18) with a dashboard date parameter or `CURRENT_DATE()`."",
      ""Replace hardcoded financial quarter filter (e.g., `financial_quarter = 2`) with a dashboard parameter or relative quarter logic."",
      ""Externalize the classification logic for `programmatic_type` (TUBI, PMP, PERFORMANCE, PG, OMP) into a governed lookup table to avoid hardcoding in SQL.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount recorded for each transaction or record."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations, representing the total value generated before any specific programmatic or year-over-year breakdowns."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls if revenue is not recorded for all transactions.""
      ]
    },
    {
      ""metric_id"": ""programmatic_type"",
      ""metric_name"": ""Programmatic Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""unified_publication_name"",
        ""cost_model_type""
      ],
      ""business_description"": ""Categorizes revenue based on programmatic deal type or publication. Values include 'TUBI', 'PG' (Guaranteed), 'OMP' (Non-Guaranteed), 'PMP', and 'PERFORMANCE' (Run of Audience Extension)."",
      ""sql_logic"": ""CASE WHEN unified_publication_name = 'TUBI' THEN 'TUBI' WHEN UPPER(cost_model_type) = 'GUARANTEED' THEN 'PG' WHEN UPPER(cost_model_type) = 'NON-GUARANTEED' THEN 'OMP' WHEN UPPER(cost_model_type) = 'PMP' THEN 'PMP' WHEN unified_publication_name = 'Run of Audience Extension' THEN 'PERFORMANCE' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting and analyzing revenue performance across different programmatic strategies."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'GUARANTEED'"",
        ""'NON-GUARANTEED'"",
        ""'PMP'"",
        ""'Run of Audience Extension'"",
        ""'PG'"",
        ""'OMP'"",
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULLs if no matching case is found.""
      ]
    },
    {
      ""metric_id"": ""programmatic_source_revenue"",
      ""metric_name"": ""Programmatic Source Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""revenue_group_subtype""
      ],
      ""business_description"": ""Gross revenue specifically categorized under 'PROGRAMMATIC SOURCE' revenue group subtype."",
      ""sql_logic"": ""CASE WHEN UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE' THEN gross_revenue_amount ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used as a base for further revenue calculations, especially when 'PERFORMANCE' programmatic type is not applicable."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""base_revenue_for_fy_calc"",
      ""metric_name"": ""Base Revenue for FY Calculation"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""programmatic_type"",
        ""programmatic_source_revenue""
      ],
      ""business_description"": ""The base revenue amount used for year-over-year comparisons. It is the gross revenue if 'PERFORMANCE' type, otherwise it's the 'PROGRAMMATIC SOURCE' revenue."",
      ""sql_logic"": ""CASE WHEN programmatic_type = 'PERFORMANCE' THEN gross_revenue_amount ELSE programmatic_source_revenue END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""An intermediate calculation to standardize the revenue figure before applying fiscal year offsets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""py_revenue_total"",
      ""metric_name"": ""Previous Year Revenue (Total)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""base_revenue_for_fy_calc"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total base revenue for the previous fiscal year (where `relative_fy_year_offset` is -1)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year performance comparisons, providing a baseline from the prior fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_revenue_total"",
      ""metric_name"": ""Current Year Revenue (Total)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""base_revenue_for_fy_calc"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total base revenue for the current fiscal year (where `relative_fy_year_offset` is 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents current fiscal year performance, crucial for tracking progress against targets and comparing to previous year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""py_revenue_pmp"",
      ""metric_name"": ""Previous Year PMP Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""py_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from PMP deals in the previous fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'PMP' AND relative_fy_year_offset = -1 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of previous year revenue by programmatic type, allowing for detailed performance analysis of PMP deals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PMP'"",
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_revenue_pmp"",
      ""metric_name"": ""Current Year PMP Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""cy_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from PMP deals in the current fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'PMP' AND relative_fy_year_offset = 0 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of current year revenue by programmatic type, allowing for detailed performance analysis of PMP deals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PMP'"",
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""py_revenue_tubi"",
      ""metric_name"": ""Previous Year Tubi Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""py_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from Tubi in the previous fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'TUBI' AND relative_fy_year_offset = -1 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of previous year revenue by programmatic type, allowing for detailed performance analysis of Tubi."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_revenue_tubi"",
      ""metric_name"": ""Current Year Tubi Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""cy_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from Tubi in the current fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'TUBI' AND relative_fy_year_offset = 0 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of current year revenue by programmatic type, allowing for detailed performance analysis of Tubi."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""py_revenue_performance"",
      ""metric_name"": ""Previous Year Performance Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""py_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from Performance deals in the previous fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'PERFORMANCE' AND relative_fy_year_offset = -1 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of previous year revenue by programmatic type, allowing for detailed performance analysis of Performance deals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PERFORMANCE'"",
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_revenue_performance"",
      ""metric_name"": ""Current Year Performance Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""cy_revenue_total"",
        ""programmatic_type""
      ],
      ""business_description"": ""Revenue from Performance deals in the current fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN programmatic_type = 'PERFORMANCE' AND relative_fy_year_offset = 0 THEN base_revenue_for_fy_calc ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of current year revenue by programmatic type, allowing for detailed performance analysis of Performance deals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PERFORMANCE'"",
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_combined_programmatic_revenue_ytd"",
      ""metric_name"": ""Current Year Combined Programmatic Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""combined_programmatic_revenue"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Combined programmatic revenue (gross revenue for TUBI/PERFORMANCE or programmatic source revenue) for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN combined_programmatic_revenue ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a year-to-date view of combined programmatic revenue, crucial for tracking progress against targets within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_tubi_revenue_ytd"",
      ""metric_name"": ""Current Year Tubi Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""unified_publication_name"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Gross revenue from Tubi for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN unified_publication_name = 'TUBI' AND relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN gross_revenue_amount ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific YTD performance for Tubi, allowing for granular tracking of this key programmatic type."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_performance_revenue_ytd"",
      ""metric_name"": ""Current Year Performance Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""unified_publication_name"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Gross revenue from Performance deals for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN unified_publication_name = 'Run of Audience Extension' AND relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN gross_revenue_amount ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific YTD performance for Performance deals, allowing for granular tracking of this key programmatic type."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Run of Audience Extension'"",
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_pmp_revenue_ytd"",
      ""metric_name"": ""Current Year PMP Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""combined_programmatic_revenue"",
        ""cost_model_type"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Combined programmatic revenue from PMP deals for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN UPPER(cost_model_type) = 'PMP' AND relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN combined_programmatic_revenue ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific YTD performance for PMP deals, providing a granular view of this revenue stream."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""'PMP'"",
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_guaranteed_revenue_ytd"",
      ""metric_name"": ""Current Year Guaranteed Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""combined_programmatic_revenue"",
        ""cost_model_type"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Combined programmatic revenue from Guaranteed deals for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN UPPER(cost_model_type) = 'GUARANTEED' AND relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN combined_programmatic_revenue ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific YTD performance for Guaranteed deals, providing a granular view of this revenue stream."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""'GUARANTEED'"",
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_nonguaranteed_revenue_ytd"",
      ""metric_name"": ""Current Year Non-Guaranteed Revenue YTD"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""combined_programmatic_revenue"",
        ""cost_model_type"",
        ""relative_fy_year_offset"",
        ""reporting_date""
      ],
      ""business_description"": ""Combined programmatic revenue from Non-Guaranteed deals for the current fiscal year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(CASE WHEN UPPER(cost_model_type) = 'NON-GUARANTEED' AND relative_fy_year_offset = 0 AND SAFE_CAST(reporting_date AS DATE) < DATE('2025-06-18') THEN combined_programmatic_revenue ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific YTD performance for Non-Guaranteed deals, providing a granular view of this revenue stream."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NON-GUARANTEED'"",
        ""0""
      ],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""programmatic_source_revenue"",
        ""base_revenue_for_fy_calc"",
        ""py_revenue_total"",
        ""cy_revenue_total"",
        ""py_revenue_pmp"",
        ""cy_revenue_pmp"",
        ""py_revenue_tubi"",
        ""cy_revenue_tubi"",
        ""py_revenue_performance"",
        ""cy_revenue_performance"",
        ""cy_combined_programmatic_revenue_ytd"",
        ""cy_tubi_revenue_ytd"",
        ""cy_performance_revenue_ytd"",
        ""cy_pmp_revenue_ytd"",
        ""cy_guaranteed_revenue_ytd"",
        ""cy_nonguaranteed_revenue_ytd""
      ],
      ""relationship_description"": ""All revenue metrics are derived from the base `gross_revenue_amount`, with various filters and classifications applied."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that all specific revenue figures roll up correctly to the total gross revenue, providing a consistent view of financial performance."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_amount) AS total_gross_revenue, SUM(py_revenue_total) + SUM(cy_revenue_total) AS total_fy_revenue_sum FROM calculated_measures WHERE relative_fy_year_offset IN (0, -1) LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""programmatic_type"",
      ""related_metrics"": [
        ""py_revenue_pmp"",
        ""cy_revenue_pmp"",
        ""py_revenue_tubi"",
        ""cy_revenue_tubi"",
        ""py_revenue_performance"",
        ""cy_revenue_performance"",
        ""cy_tubi_revenue_ytd"",
        ""cy_performance_revenue_ytd""
      ],
      ""relationship_description"": ""The `programmatic_type` dimension is a key classification used to segment and calculate specific revenue metrics (e.g., PMP, Tubi, Performance revenue)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Accurate classification of programmatic types is critical for correct reporting and analysis of revenue streams."",
      ""validation_sql"": ""SELECT programmatic_type, SUM(gross_revenue_amount) AS revenue FROM derived_attributes GROUP BY programmatic_type LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""cy_combined_programmatic_revenue_ytd"",
      ""related_metrics"": [
        ""cy_tubi_revenue_ytd"",
        ""cy_performance_revenue_ytd"",
        ""cy_pmp_revenue_ytd"",
        ""cy_guaranteed_revenue_ytd"",
        ""cy_nonguaranteed_revenue_ytd""
      ],
      ""relationship_description"": ""All 'YTD' metrics are filtered by the `relative_fy_year_offset = 0` (Current Year) and a hardcoded `reporting_date < '2025-06-18'` condition."",
      ""mathematical_formula"": ""Metric_YTD = SUM(Revenue WHERE is_current_fy AND reporting_date < '2025-06-18')"",
      ""business_validation"": ""Ensures that YTD figures are consistently calculated up to a specific point in time, allowing for accurate progress tracking within the fiscal year."",
      ""validation_sql"": ""SELECT SUM(cy_combined_programmatic_revenue_ytd) AS total_ytd_revenue, SUM(cy_tubi_revenue_ytd) + SUM(cy_performance_revenue_ytd) + SUM(cy_pmp_revenue_ytd) + SUM(cy_guaranteed_revenue_ytd) + SUM(cy_nonguaranteed_revenue_ytd) AS sum_of_ytd_breakdowns FROM calculated_measures WHERE is_current_fy AND is_ytd_period_as_of_hardcoded_date LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,43
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d3bcf796-2396-4a6f-b0a3-da0b7f299a58"",
    ""dashboard_name"": ""Publisher and Product Performance Dashboard - FY25 v2"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""advertiser_group"",
      ""product_group"",
      ""fin_adtype_name"",
      ""financial_week""
    ],
    ""date_range_detected"": ""Not explicitly detected from provided queries, but likely covers recent financial periods."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Commercial Content'"",
      ""'Free News & Lifestyle'"",
      ""'State & Communities'"",
      ""'The Australian & Prestige'"",
      ""'Unknown'"",
      ""'' (empty string for product_group)""
    ],
    ""governance_opportunities"": [
      ""Product group names should be managed in a governed lookup table to avoid hardcoding."",
      ""Ad type names should be managed in a governed lookup table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query assumes the existence of 'total_revenue' and 'total_impressions' columns in the 'adsales_performance' table, as the provided queries only extract dimensions. It also assumes an 'event_date' column for standard date filtering, as 'financial_week' is not a DATE type.\nWITH base_data AS (\n  SELECT \n    t0.advertiser_group,\n    t0.product_group,\n    t0.fin_adtype_name,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week_int,\n    SAFE_CAST(t0.total_revenue AS NUMERIC) AS total_revenue, -- Assumed metric\n    SAFE_CAST(t0.total_impressions AS INT64) AS total_impressions, -- Assumed metric\n    SAFE_CAST(t0.event_date AS DATE) AS event_date -- Assumed date column for filtering\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.event_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Filter for recent data\n)\nSELECT \n  advertiser_group,\n  product_group,\n  fin_adtype_name,\n  financial_week_int,\n  COUNT(*) AS record_count,\n  SUM(total_revenue) AS sum_total_revenue,\n  SUM(total_impressions) AS sum_total_impressions,\n  COUNT(DISTINCT advertiser_group) AS distinct_advertiser_groups,\n  COUNT(DISTINCT product_group) AS distinct_product_groups,\n  COUNT(DISTINCT fin_adtype_name) AS distinct_fin_adtype_names\nFROM base_data\nGROUP BY \n  advertiser_group,\n  product_group,\n  fin_adtype_name,\n  financial_week_int\nORDER BY \n  financial_week_int DESC,\n  sum_total_revenue DESC\nLIMIT 100;"",
    ""structure_sql"": ""-- This query provides insights into the structure and basic statistics of the primary data source.\n-- It assumes 'event_date' as a general date column for filtering and 'financial_week' as a key dimension.\nSELECT \n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.event_date AS DATE)) AS unique_event_dates, -- Assumed date column\n  COUNT(DISTINCT t0.advertiser_group) AS unique_advertiser_groups,\n  COUNT(DISTINCT t0.product_group) AS unique_product_groups,\n  COUNT(DISTINCT t0.fin_adtype_name) AS unique_fin_adtype_names,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_week AS STRING)) AS unique_financial_weeks,\n  MIN(SAFE_CAST(t0.event_date AS DATE)) AS earliest_event_date, -- Assumed date column\n  MAX(SAFE_CAST(t0.event_date AS DATE)) AS latest_event_date, -- Assumed date column\n  APPROX_COUNT_DISTINCT(CONCAT(t0.advertiser_group, t0.product_group, SAFE_CAST(t0.financial_week AS STRING))) AS approx_unique_combinations -- Proxy for data grain\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.event_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY); -- Filter for recent data"",
    ""validation_sql"": ""-- This query performs basic validation checks on the primary data source.\n-- It assumes 'total_revenue' and 'total_impressions' as key metrics and 'event_date' for freshness.\nSELECT \n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.total_revenue AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_revenue_test, -- Assumed metric\n  CASE WHEN SUM(SAFE_CAST(t0.total_impressions AS INT64)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_impressions_test, -- Assumed metric\n  CASE WHEN COUNT(DISTINCT t0.advertiser_group) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_group_presence_test,\n  CASE WHEN MAX(SAFE_CAST(t0.event_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test, -- Assumed date column\n  CASE WHEN COUNT(CASE WHEN t0.product_group IS NULL THEN 1 END) = 0 THEN 'PASS' ELSE 'FAIL' END AS product_group_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.event_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This query validates the hardcoded business rules (filters) identified in the original queries.\nSELECT \n  'Business Rule Validation' AS validation_type,\n  'product_group_filter_coverage' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN t0.product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige') THEN 1 ELSE 0 END) AS records_matching_advertiser_group_filter,\n  SUM(CASE WHEN t0.product_group NOT IN ('Unknown') OR t0.product_group IS NULL THEN 1 ELSE 0 END) AS records_matching_adtype_filter,\n  SUM(CASE WHEN t0.product_group IN ('Free News & Lifestyle', 'State & Communities', '') THEN 1 ELSE 0 END) AS records_matching_financial_week_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pct_matching_advertiser_group_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.product_group NOT IN ('Unknown') OR t0.product_group IS NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pct_matching_adtype_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.product_group IN ('Free News & Lifestyle', 'State & Communities', '') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pct_matching_financial_week_filter\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.event_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY); -- Filter for recent data"",
    ""sample_data_sql"": ""-- This query retrieves a representative sample of data from the primary source, including key dimensions and assumed metrics.\nSELECT \n  SAFE_CAST(t0.event_date AS DATE) AS event_date, -- Assumed date column\n  t0.advertiser_group,\n  t0.product_group,\n  t0.fin_adtype_name,\n  SAFE_CAST(t0.financial_week AS INT64) AS financial_week_int,\n  SAFE_CAST(t0.total_revenue AS NUMERIC) AS total_revenue, -- Assumed metric\n  SAFE_CAST(t0.total_impressions AS INT64) AS total_impressions -- Assumed metric\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.event_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Filter for very recent data\n  AND t0.product_group IS NOT NULL -- Example filter to get meaningful data\nORDER BY \n  event_date DESC,\n  total_revenue DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Commercial Content'"",
            ""'Free News & Lifestyle'"",
            ""'State & Communities'"",
            ""'The Australian & Prestige'""
          ],
          ""context"": ""Used to filter 'product_group' for 'advertiser_group' selection."",
          ""suggested_governance"": ""These product group names should be stored in a `product_group_lookup` table with a `category` or `dashboard_filter_group` column. The query should join to this table instead of hardcoding values."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Unknown'""
          ],
          ""context"": ""Used to exclude 'Unknown' product groups when selecting 'fin_adtype_name'."",
          ""suggested_governance"": ""Standardize 'Unknown' values or manage exclusions via a configuration table. If 'Unknown' is a valid category, its exclusion should be a configurable business rule."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Free News & Lifestyle'"",
            ""'State & Communities'"",
            ""''""
          ],
          ""context"": ""Used to filter 'product_group' for 'financial_week' selection, including an empty string."",
          ""suggested_governance"": ""Similar to other product group filters, these should be managed in a `product_group_lookup` table. The empty string `''` suggests potential data quality issues or an unhandled category that should be explicitly defined or cleaned."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded product group values with joins to governed reference tables (e.g., `product_group_dimension`)."",
      ""Implement Looker Studio parameters for dynamic filtering of product groups instead of hardcoding in the SQL queries."",
      ""Address the empty string `''` in `product_group` filters; either clean the data, define it as a valid category, or explicitly handle it as an 'Other' or 'Uncategorized' type.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents a grouping of advertisers, used for filtering and analysis of ad sales performance."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting ad sales data by advertiser type or category."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Commercial Content'"",
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for product_group.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents a grouping of products (e.g., content types, news categories) under which ad sales performance is tracked. Acts as a primary filter."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial dimension for understanding performance across different content or product offerings. Heavily used for filtering other dimensions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Presence of empty string '' as a product group value, suggesting potential data quality or categorization issues."",
        ""Presence of 'Unknown' value, which is explicitly filtered out in some contexts.""
      ]
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the name of the financial advertising type, used for filtering and analysis."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group NOT IN ('Unknown') OR product_group IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Dimension for segmenting ad sales data by the specific type of advertisement (e.g., display, native, video)."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter value 'Unknown' for product_group.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""safe_cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the financial week number, likely in YYYYWW format, used for time-based filtering and trend analysis."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Free News & Lifestyle', 'State & Communities', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for analyzing ad sales performance over financial weeks."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for product_group, including an empty string.""
      ],
      ""data_quality_concerns"": [
        ""The empty string '' in product_group filter might indicate data quality issues or unhandled categories.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_group"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""The selection of 'advertiser_group' is filtered by specific 'product_group' values ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige'). This implies that certain advertiser groups are only relevant or visible within these product contexts."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that advertiser group analysis is focused on relevant product categories, potentially to avoid showing irrelevant or zero-value advertiser groups for certain product types."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT advertiser_group) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""fin_adtype_name"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""The selection of 'fin_adtype_name' excludes records where 'product_group' is 'Unknown' or NULL. This suggests that 'Unknown' product groups are considered irrelevant or problematic for ad type analysis."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that ad type analysis is based on clearly categorized product groups, improving data quality and relevance for reporting."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT fin_adtype_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (product_group NOT IN ('Unknown') OR product_group IS NULL);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""financial_week"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""The selection of 'financial_week' is filtered by specific 'product_group' values ('Free News & Lifestyle', 'State & Communities', ''). This implies that financial week trends are primarily analyzed for these specific product categories."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Focuses time-series analysis of financial weeks on key product categories, potentially to highlight performance within core news and community segments."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(financial_week AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Free News & Lifestyle', 'State & Communities', '');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,44
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""8956e94b-f6d1-46a3-9c7f-87a91fbe98b5"",
    ""dashboard_name"": ""LODs"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_month"",
      ""financial_quarter"",
      ""sales_segment_l_2_name_sync"",
      ""revenue_type_upper"",
      ""portfolio_group_name_sync"",
      ""gsd_name"",
      ""revenue_type_derived""
    ],
    ""date_range_detected"": ""Previous Financial Year to Next Financial Year (relative to current FY)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""relative_fy_year_offset: -1, 0, 1"",
      ""revenue_transaction_status: 'BILLED', 'BOOKED'"",
      ""style_name: 'ROP COMPOSITE'"",
      ""source_publishing_division: 'MEDIUM RARE CONTENT AGENCY'"",
      ""publication_name: 'SUDDENLY%'"",
      ""account_number: '17114', '29172', '52809'"",
      ""sales_segment_l_2_name_sync: 'MRCA', 'Digital Other'"",
      ""sales_segment_l_2_name_sync (for GM mapping): 'CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE'"",
      ""sales_segment_gm_name_sync: 'Ian Paterson'"",
      ""source_system_code: 'PLUTO'"",
      ""xtend_flag: 'Y'"",
      ""GSD_JOIN.full_name: 'VACANT'""
    ],
    ""governance_opportunities"": [
      ""Relative financial year offsets should be parameterized or derived dynamically."",
      ""Transaction statuses, style names, publishing divisions, sales segments, and source system codes should be managed in governed lookup tables."",
      ""Complex business rules for publication names and account numbers should be externalized to a configuration table or rule engine."",
      ""Sales GM mapping should be managed in a dedicated mapping table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH SFCE_USER AS (\n  SELECT\n    TEMP1.network_user_name AS login_name,\n    TEMP1.user_name AS full_name\n  FROM\n    (\n      SELECT\n        UPPER(network_user_name) AS network_user_name,\n        UPPER(user_name) AS user_name,\n        ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n      FROM\n        `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n      WHERE\n        dw_source_system_code = 'SFCE'\n    ) AS TEMP1\n  WHERE\n    TEMP1.RN = 1\n),\nbase_adsales_data AS (\n  SELECT\n    unified_publication_name,\n    unified_publication_gl_code,\n    fy_year_month_number,\n    financial_year,\n    financial_quarter,\n    financial_month,\n    financial_short_month,\n    financial_week,\n    revenue_transaction_status,\n    is_print_digital_flag,\n    current_financial_month,\n    current_financial_week,\n    fy_year_week_number,\n    style_name,\n    UPPER(fin_adtype_name) AS fin_adtype_name,\n    CASE\n      WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n      ELSE 'Client'\n    END AS Sales_Group,\n    EXTRACT(DAYOFWEEK FROM CURRENT_DATE()) AS DOW_Today,\n    sales_segment_l_1_name,\n    nca_industry_anzsic_pillar_group,\n    sales_segment_l_2_name,\n    sales_segment_l_1_name_sync,\n    sales_segment_l_2_name_sync,\n    fy_quarter_of_year_name,\n    relative_fy_year_offset,\n    relative_fy_quarter_offset,\n    relative_fy_month_offset,\n    relative_fy_week_offset,\n    advertiser_group,\n    advertiser_parent,\n    SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n    sales_segment_gm_name,\n    CASE\n      WHEN UPPER(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW',\n        'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n      ELSE sales_segment_gm_name_sync\n    END AS sales_segment_gm_name_sync,\n    revenue_group_level_1_name,\n    revenue_group_level_2_name,\n    SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n    SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n    SUM(IFNULL(pipeline, 0)) AS pipeline,\n    SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n    UPPER(revenue_type) AS revenue_type_upper,\n    UPPER(revenue_group_subtype) AS revenue_group_subtype,\n    current_portfolio_group_owner_sync,\n    portfolio_group_name_sync,\n    portfolio_group_name_current,\n    portfolio_parent_group_name_sync,\n    nca_industry_pillar,\n    publishing_division_group,\n    publishing_division_parent,\n    is_future_period_flag,\n    ly_is_future_period_flag,\n    xtend_flag,\n    ny_is_future_period_flag,\n    cost_model_type,\n    CASE\n      WHEN source_system_code = 'PLUTO' THEN NULL\n      ELSE booking_line_created_date\n    END AS booking_line_created_date,\n    advertiser_name,\n    current_portfolio_conformed_owner_sync,\n    portfolio_conformed_name_sync,\n    publishing_division,\n    booking_line_created_week,\n    booking_line_created_month,\n    booking_line_created_short_month,\n    booking_line_created_quarter,\n    booking_line_created_year,\n    agency_parent,\n    agency_group,\n    agency_name,\n    agency_number,\n    calendar_month_name,\n    calendar_year,\n    classification_name,\n    product_group,\n    SUM(IFNULL(target, 0)) AS target,\n    IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD,\n    current_portfolio_conformed_owner_current,\n    current_portfolio_group_owner_current,\n    IFNULL(GSD_JOIN_CURR.full_name, 'VACANT') AS current_portfolio_group_owner_full,\n    IFNULL(GSD_JOIN_CONFORM.full_name, 'VACANT') AS current_portfolio_conformed_owner_full\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n    LEFT JOIN\n    SFCE_USER AS GSD_JOIN\n    ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n    LEFT JOIN\n    SFCE_USER AS GSD_JOIN_CURR\n    ON UPPER(current_portfolio_group_owner_current) = GSD_JOIN_CURR.login_name\n    LEFT JOIN\n    SFCE_USER AS GSD_JOIN_CONFORM\n    ON UPPER(current_portfolio_conformed_owner_current) = GSD_JOIN_CONFORM.login_name\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED',\n      'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division,\n        'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n    (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n  GROUP BY ALL\n)\nSELECT\n  financial_year,\n  financial_month,\n  financial_quarter,\n  financial_short_month,\n  sales_segment_l_2_name_sync,\n  revenue_type_upper,\n  portfolio_group_name_sync,\n  GSD AS gsd_name,\n  CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type_upper END AS revenue_type_derived,\n  (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment_flag,\n  SAFE_CAST(financial_quarter AS FLOAT64) AS financial_quarter_float,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(pipeline) AS total_pipeline,\n  SUM(adjustment_amount) AS total_adjustment_amount,\n  SUM(pub_lgb) AS total_pub_lgb,\n  SUM(ss_lgb) AS total_ss_lgb,\n  SUM(target) AS total_target,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue_amount,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS current_fy_pipeline\nFROM\n  base_adsales_data\nGROUP BY\n  financial_year,\n  financial_month,\n  financial_quarter,\n  financial_short_month,\n  sales_segment_l_2_name_sync,\n  revenue_type_upper,\n  portfolio_group_name_sync,\n  gsd_name,\n  revenue_type_derived,\n  is_digital_other_sales_segment_flag,\n  financial_quarter_float\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING) || '-' || SAFE_CAST(financial_month AS STRING)) as unique_financial_months,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT portfolio_group_name_sync) as unique_portfolio_groups,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(unified_publication_name) as approx_unique_publications,\n  APPROX_COUNT_DISTINCT(advertiser_name) as approx_unique_advertisers\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(pipeline AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as pipeline_test,\n  CASE WHEN COUNT(DISTINCT financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_test,\n  CASE WHEN MAX(relative_fy_year_offset) >= -1 THEN 'PASS' ELSE 'FAIL' END as relative_fy_offset_test,\n  CASE WHEN COUNT(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) as records_passing_status_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_status_filter\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Publication Name SUDDENLY% Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809'))) THEN 1 ELSE 0 END) as records_passing_publication_logic,\n  SAFE_DIVIDE(SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809'))) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_publication_logic\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
    ""sample_data_sql"": ""SELECT\n  financial_year,\n  financial_month,\n  financial_quarter,\n  sales_segment_l_2_name_sync,\n  UPPER(revenue_type) AS revenue_type_upper,\n  portfolio_group_name_sync,\n  relative_fy_year_offset,\n  gross_revenue_amount,\n  pipeline,\n  xtend_flag,\n  revenue_transaction_status,\n  style_name,\n  source_publishing_division,\n  publication_name,\n  account_number,\n  current_portfolio_group_owner_sync\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(financial_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  financial_year DESC, financial_month DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""-1"", ""0"", ""1""],
          ""context"": ""relative_fy_year_offset values for filtering financial years"",
          ""suggested_governance"": ""Use a fiscal calendar table or parameters to dynamically determine these offsets based on current date."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'BILLED'"", ""'BOOKED'""],
          ""context"": ""revenue_transaction_status filter values"",
          ""suggested_governance"": ""Store valid transaction statuses in a reference table and join to it."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'ROP COMPOSITE'""],
          ""context"": ""style_name exclusion filter value"",
          ""suggested_governance"": ""Store excluded style names in a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'MEDIUM RARE CONTENT AGENCY'""],
          ""context"": ""source_publishing_division exclusion filter value"",
          ""suggested_governance"": ""Store excluded publishing divisions in a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'SUDDENLY%'"", ""'17114'"", ""'29172'"", ""'52809'""],
          ""context"": ""Complex logic for publication_name and account_number"",
          ""suggested_governance"": ""Externalize this complex business rule into a configuration table or a dedicated rule engine."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'MRCA'"", ""'Client'""],
          ""context"": ""Sales_Group derivation logic"",
          ""suggested_governance"": ""Manage sales group mappings in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'CONSORTIUM NSW'"", ""'KEY ACCOUNTS NSW RETAIL'"", ""'DIRECT NSW'"", ""'INDEPENDENT AGENCIES NSW'"", ""'PRESTIGE'"", ""'Ian Paterson'""],
          ""context"": ""sales_segment_gm_name_sync mapping logic"",
          ""suggested_governance"": ""Manage sales segment to GM mappings in a dedicated lookup table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'PLUTO'""],
          ""context"": ""source_system_code for booking_line_created_date logic"",
          ""suggested_governance"": ""Store valid source system codes in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Y'""],
          ""context"": ""xtend_flag value for 'XTEND' derivation"",
          ""suggested_governance"": ""If 'Y'/'N' is a common pattern, consider a boolean column or a lookup for flag values."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Digital Other'""],
          ""context"": ""sales_segment_l_2_name_sync value for 'is_digital_other_sales_segment_flag' derivation"",
          ""suggested_governance"": ""Store sales segment categories in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded relative financial year offsets with parameters or dynamic calculations (e.g., based on CURRENT_DATE() and a fiscal calendar table)."",
      ""Replace hardcoded lookup values (e.g., transaction statuses, style names, sales segments, source systems) with joins to governed reference tables."",
      ""Externalize complex business rules (e.g., publication name/account number logic, sales GM mapping) into configuration tables or a dedicated business rule service.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount across all relevant transactions."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for sales performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls (handled by IFNULL in source CTE)""
      ]
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total pipeline amount representing potential future revenue."",
      ""sql_logic"": ""SUM(pipeline)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator for future sales forecasting and sales team performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls (handled by IFNULL in source CTE)""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_amount"",
      ""metric_name"": ""Current FY Gross Revenue Amount"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue amount specifically for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic"",
        ""relative_fy_year_offset = 0 (internal to calculation)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for current period performance analysis and comparison against targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""relative year offset should be parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""current_fy_pipeline"",
      ""metric_name"": ""Current FY Pipeline"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_pipeline""
      ],
      ""business_description"": ""Pipeline amount specifically for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic"",
        ""relative_fy_year_offset = 0 (internal to calculation)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a focused view on immediate future revenue potential."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""relative year offset should be parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment_flag"",
      ""metric_name"": ""Is Digital Other Sales Segment"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional_boolean"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Flag indicating if the sales segment is 'Digital Other'."",
      ""sql_logic"": ""(sales_segment_l_2_name_sync = 'Digital Other')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for segmenting sales data by specific sales channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_adjustment_amount"",
      ""metric_name"": ""Total Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of adjustment amounts."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for internal accounting adjustments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pub_lgb"",
      ""metric_name"": ""Total Publication LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of publication LGB (Likely Good Business) amounts."",
      ""sql_logic"": ""SUM(IFNULL(pub_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for business forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ss_lgb"",
      ""metric_name"": ""Total Sales Segment LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of sales segment LGB (Likely Good Business) amounts."",
      ""sql_logic"": ""SUM(IFNULL(ss_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for business forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_target"",
      ""metric_name"": ""Total Target"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of target amounts."",
      ""sql_logic"": ""SUM(IFNULL(target, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name/account_number specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for sales target tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_gross_revenue_amount"",
      ""related_metrics"": [
        ""total_gross_revenue_amount""
      ],
      ""relationship_description"": ""Current FY Gross Revenue Amount is a conditional sum of Total Gross Revenue Amount, specifically filtered for the current financial year (relative_fy_year_offset = 0)."",
      ""mathematical_formula"": ""current_fy_gross_revenue_amount = SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""business_validation"": ""Ensures that current period revenue is accurately isolated from other financial years for focused analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_revenue_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_pipeline"",
      ""related_metrics"": [
        ""total_pipeline""
      ],
      ""relationship_description"": ""Current FY Pipeline is a conditional sum of Total Pipeline, specifically filtered for the current financial year (relative_fy_year_offset = 0)."",
      ""mathematical_formula"": ""current_fy_pipeline = SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END)"",
      ""business_validation"": ""Ensures that current period pipeline is accurately isolated for immediate future revenue forecasting."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS current_fy_pipeline_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,45
