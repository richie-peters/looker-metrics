raw_response,status,response_id
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""9269e9c6-1ad0-4415-96c3-aca8a710ba01"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_parent"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""sales_segment_l_2_name"",
      ""unified_publication_name"",
      ""revenue_group_subtype"",
      ""revenue_type"",
      ""relative_fy_year_offset"",
      ""booking_line_created_date"",
      ""fix_date_lod""
    ],
    ""date_range_detected"": ""FY24 to FY25 (based on hardcoded reference date 2025-06-23 and prior year calculations)"",
    ""hardcoded_dates_found"": [
      ""2025-06-23""
    ],
    ""hardcoded_values_found"": [
      ""'Jul Q1 H1'"",
      ""'Consortium QLD'"",
      ""'DOUBLECLICK'"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""'OUTSTREAM'"",
      ""'XTEND'"",
      ""'EDMEDIA'"",
      ""'ECOMMERCE'"",
      ""'$'"",
      ""'$\\'000'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized (e.g., CURRENT_DATE() or dashboard parameters) instead of hardcoded timestamps."",
      ""Lookup values for sales segments, publication names, and revenue types should be managed in governed reference tables."",
      ""The fiscal year logic (relative_fy_year_offset) should ideally be driven by a fiscal calendar dimension table."",
      ""The unit conversion logic (division by 1000) should be explicitly controlled by a parameter or configuration, not a redundant conditional check.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all metrics and dimensions from the provided SQL samples.\n-- It calculates current and prior FY gross revenues, and a conditional revenue metric, all in thousands.\n-- Filters are applied for specific financial periods and sales segments as found in the original queries.\n\nWITH RawData AS (\n  SELECT\n    t0.advertiser_parent,\n    SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter_int,\n    t0.financial_short_month,\n    PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) AS booking_date_parsed,\n    t0.fix_date_lod,\n    t0.gross_revenue_amount,\n    t0.relative_fy_year_offset,\n    t0.revenue_group_subtype,\n    t0.revenue_type,\n    t0.sales_segment_l_2_name,\n    t0.sales_segment_l_2_name_sync,\n    UPPER(SAFE_CAST(t0.unified_publication_name AS STRING)) AS unified_publication_name_upper\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Apply a general date filter for performance, assuming recent data is most relevant for a sales dashboard\n  -- Adjust this date range as needed for full historical context\n  WHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Last 2 years\n),\n\nCalculatedDimensions AS (\n  SELECT\n    advertiser_parent,\n    financial_quarter_int,\n    financial_short_month,\n    booking_date_parsed,\n    fix_date_lod,\n    gross_revenue_amount,\n    relative_fy_year_offset,\n    revenue_group_subtype,\n    revenue_type,\n    sales_segment_l_2_name,\n    sales_segment_l_2_name_sync,\n    unified_publication_name_upper,\n\n    -- Derived Dimensions/Flags from Query 1 & 2\n    SAFE_CAST(financial_quarter_int AS STRING) AS financial_quarter_str,\n    CONCAT('Q', SAFE_CAST(financial_quarter_int AS STRING)) AS financial_quarter_q_prefix,\n    CASE\n      WHEN (financial_quarter_int >= 1 AND financial_quarter_int <= 2) THEN 'H1'\n      WHEN (financial_quarter_int >= 3 AND financial_quarter_int <= 4) THEN 'H2'\n      ELSE SAFE_CAST(financial_quarter_int AS STRING)\n    END AS financial_half,\n    CONCAT(financial_short_month, ' ', CONCAT('Q',SAFE_CAST(financial_quarter_int AS STRING)), ' ', (CASE WHEN (financial_quarter_int >= 1 AND financial_quarter_int <= 2) THEN 'H1' WHEN (financial_quarter_int >= 3 AND financial_quarter_int <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter_int AS STRING) END)) AS financial_period_combined,\n\n    (relative_fy_year_offset = 0) AS is_current_fy,\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype,\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type,\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment,\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick_advertiser,\n    (unified_publication_name_upper IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) AS is_unified_publication_ecommerce_outstream_etc,\n\n    -- Hardcoded reference date (replace with parameter for production)\n    DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS report_reference_date,\n    DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY) AS prior_year_reference_date,\n\n    CASE\n      WHEN ( (revenue_type = 'DIGITAL') AND (revenue_group_subtype = 'DIGITAL') AND (sales_segment_l_2_name_sync = 'Digital Other') AND (advertiser_parent != 'DOUBLECLICK') )\n      THEN fix_date_lod\n      ELSE booking_date_parsed\n    END AS effective_date_for_revenue\n\n  FROM RawData\n),\n\nFinalMetrics AS (\n  SELECT\n    advertiser_parent,\n    financial_period_combined,\n    sales_segment_l_2_name,\n    financial_quarter_int,\n    financial_short_month,\n    financial_half,\n    unified_publication_name_upper,\n\n    -- Metrics (Gross Revenue)\n    CASE WHEN is_current_fy THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue_base,\n    CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END AS prior_fy_gross_revenue_base,\n\n    -- Conditional Gross Revenue (clmn33_ equivalent)\n    CASE\n      WHEN (is_current_fy AND is_unified_publication_ecommerce_outstream_etc) THEN gross_revenue_amount\n      WHEN (is_current_fy AND SAFE_CAST(effective_date_for_revenue AS DATETIME) <= prior_year_reference_date) THEN gross_revenue_amount\n      ELSE 0\n    END AS conditional_gross_revenue_base\n\n  FROM CalculatedDimensions\n  -- Apply filters from original queries\n  WHERE\n    financial_period_combined IN ('Jul Q1 H1')\n    AND sales_segment_l_2_name IN ('Consortium QLD')\n)\n\nSELECT\n  advertiser_parent,\n  financial_period_combined,\n  sales_segment_l_2_name,\n  financial_quarter_int,\n  financial_short_month,\n  financial_half,\n  unified_publication_name_upper,\n  SUM(current_fy_gross_revenue_base) AS total_current_fy_gross_revenue,\n  SUM(SAFE_DIVIDE(current_fy_gross_revenue_base, 1000)) AS total_current_fy_gross_revenue_k,\n  SUM(prior_fy_gross_revenue_base) AS total_prior_fy_gross_revenue,\n  SUM(SAFE_DIVIDE(prior_fy_gross_revenue_base, 1000)) AS total_prior_fy_gross_revenue_k,\n  SUM(conditional_gross_revenue_base) AS total_conditional_gross_revenue,\n  SUM(SAFE_DIVIDE(conditional_gross_revenue_base, 1000)) AS total_conditional_gross_revenue_k\nFROM FinalMetrics\nGROUP BY\n  advertiser_parent,\n  financial_period_combined,\n  sales_segment_l_2_name,\n  financial_quarter_int,\n  financial_short_month,\n  financial_half,\n  unified_publication_name_upper\nORDER BY\n  advertiser_parent ASC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_quarter AS STRING)) as unique_financial_quarters,\n  COUNT(DISTINCT t0.financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT t0.sales_segment_l_2_name) as unique_sales_segments,\n  MIN(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) as earliest_booking_date,\n  MAX(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) as latest_booking_date,\n  MIN(t0.fix_date_lod) as earliest_fix_date_lod,\n  MAX(t0.fix_date_lod) as latest_fix_date_lod,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.advertiser_parent, SAFE_CAST(t0.booking_line_created_date AS STRING), SAFE_CAST(t0.gross_revenue_amount AS STRING))) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END as distinct_advertisers_test,\n  CASE WHEN MAX(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test_booking_date,\n  CASE WHEN COUNT(CASE WHEN t0.relative_fy_year_offset = 0 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_exists_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'relative_fy_year_offset_distribution' as rule_name,\n  t0.relative_fy_year_offset,\n  COUNT(*) as record_count,\n  SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) as total_gross_revenue\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Last 2 years\nGROUP BY t0.relative_fy_year_offset\nORDER BY t0.relative_fy_year_offset;\n"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.advertiser_parent AS STRING) as advertiser_parent,\n  SAFE_CAST(t0.financial_quarter AS STRING) as financial_quarter,\n  SAFE_CAST(t0.financial_short_month AS STRING) as financial_short_month,\n  PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) as booking_line_created_date,\n  SAFE_CAST(t0.fix_date_lod AS DATE) as fix_date_lod,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  SAFE_CAST(t0.revenue_group_subtype AS STRING) as revenue_group_subtype,\n  SAFE_CAST(t0.revenue_type AS STRING) as revenue_type,\n  SAFE_CAST(t0.sales_segment_l_2_name AS STRING) as sales_segment_l_2_name,\n  SAFE_CAST(t0.sales_segment_l_2_name_sync AS STRING) as sales_segment_l_2_name_sync,\n  SAFE_CAST(t0.unified_publication_name AS STRING) as unified_publication_name\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed 'report as of' date to derive prior year reference dates and conditional revenue calculations."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter to ensure dynamic reporting."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jul Q1 H1'""
          ],
          ""context"": ""Specific financial period filter for 'financial_period_combined'."",
          ""suggested_governance"": ""Use dynamic date range filters or allow user selection via dashboard parameters for financial periods."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Consortium QLD'""
          ],
          ""context"": ""Specific sales segment filter for 'sales_segment_l_2_name'."",
          ""suggested_governance"": ""Use a governed dimension table for sales segments or allow user selection via dashboard parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'"",
            ""'DIGITAL'"",
            ""'Digital Other'"",
            ""'OUTSTREAM'"",
            ""'XTEND'"",
            ""'EDMEDIA'"",
            ""'ECOMMERCE'""
          ],
          ""context"": ""Categorization and exclusion rules for revenue types, sales segments, and publication names."",
          ""suggested_governance"": ""Define these categories in a configuration table or a dedicated dimension table for revenue types/publication types."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""1000""
          ],
          ""context"": ""Fixed division by 1000 for 'k' (thousands) metrics, implicitly enforced by a redundant conditional check ('$\\'000' = '$')."",
          ""suggested_governance"": ""Explicitly define the unit conversion factor (e.g., in a configuration table) or remove the redundant conditional logic."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-06-23') with dashboard date parameters or relative date functions (e.g., CURRENT_DATE())."",
      ""Replace hardcoded lookup values (e.g., 'Consortium QLD', 'Jul Q1 H1', 'DIGITAL') with joins to governed reference tables or allow user selection via dashboard controls."",
      ""Implement a fiscal calendar dimension table to handle `relative_fy_year_offset` and other fiscal period calculations dynamically, rather than fixed `INTERVAL 365 DAY`.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_parent"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The top-level parent company or group for an advertiser."",
      ""sql_logic"": ""t0.advertiser_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""advertiser_parent != 'DOUBLECLICK' (for effective_date_for_revenue calculation)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting sales performance by advertiser."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Exclusion of 'DOUBLECLICK' is hardcoded; should be managed via a configuration table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_int"",
      ""metric_name"": ""Financial Quarter (Integer)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter number (e.g., 1, 2, 3, 4)."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_quarter AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for defining financial halves and combined financial periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The abbreviated financial month name (e.g., 'Jul', 'Aug')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used in combination with quarter and half to form a comprehensive financial period string."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_half"",
      ""metric_name"": ""Financial Half (H1/H2)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_quarter_int""
      ],
      ""business_description"": ""Categorizes financial quarters into halves (H1 for Q1/Q2, H2 for Q3/Q4)."",
      ""sql_logic"": ""CASE WHEN (financial_quarter_int >= 1 AND financial_quarter_int <= 2) THEN 'H1' WHEN (financial_quarter_int >= 3 AND financial_quarter_int <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter_int AS STRING) END"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a higher-level aggregation for financial reporting periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'H1'"",
        ""'H2'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period_combined"",
      ""metric_name"": ""Financial Period Combined"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_short_month"",
        ""financial_quarter_int"",
        ""financial_half""
      ],
      ""business_description"": ""A concatenated string representing the financial month, quarter, and half (e.g., 'Jul Q1 H1')."",
      ""sql_logic"": ""CONCAT(financial_short_month, ' ', CONCAT('Q',SAFE_CAST(financial_quarter_int AS STRING)), ' ', financial_half)"",
      ""data_sources"": [],
      ""filters_applied"": [
        ""IN ('Jul Q1 H1')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a primary filter for selecting specific reporting periods in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jul Q1 H1'""
      ],
      ""governance_issues"": [
        ""The specific filter value 'Jul Q1 H1' is hardcoded; should be dynamic or user-selectable.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name"",
      ""metric_name"": ""Sales Segment L2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Level 2 sales segment name, used for filtering and grouping sales data."",
      ""sql_logic"": ""t0.sales_segment_l_2_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial dimension for filtering the dashboard by specific sales teams or regions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Consortium QLD'""
      ],
      ""governance_issues"": [
        ""The specific filter value 'Consortium QLD' is hardcoded; should be dynamic or user-selectable.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name_upper"",
      ""metric_name"": ""Unified Publication Name (Upper)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unified publication name, converted to uppercase for consistency."",
      ""sql_logic"": ""UPPER(SAFE_CAST(t0.unified_publication_name AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') (for conditional_gross_revenue_base)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used in specific business rules to categorize revenue by publication type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'""
      ],
      ""governance_issues"": [
        ""Specific publication types are hardcoded; should be managed via a configuration table or dimension.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""report_reference_date"",
      ""metric_name"": ""Report Reference Date"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded date used as the 'as of' point for various date calculations, particularly for prior year comparisons."",
      ""sql_logic"": ""DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney')"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Defines the current reporting period's end date for YTD or period-to-date calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""This date is hardcoded and will not update automatically, leading to stale reports. Should be replaced with CURRENT_DATE() or a parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prior_year_reference_date"",
      ""metric_name"": ""Prior Year Reference Date"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""report_reference_date""
      ],
      ""business_description"": ""Calculated as 365 days prior to the report reference date, used for prior year comparisons."",
      ""sql_logic"": ""DATETIME_ADD(SAFE_CAST(report_reference_date AS DATETIME), INTERVAL -365 DAY)"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Enables year-over-year comparisons for revenue metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Derived from a hardcoded date and uses a fixed 365-day interval, which may not align with fiscal year boundaries. Should use a fiscal calendar dimension.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""effective_date_for_revenue"",
      ""metric_name"": ""Effective Date for Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync"",
        ""advertiser_parent"",
        ""fix_date_lod"",
        ""booking_date_parsed""
      ],
      ""business_description"": ""Determines the relevant date for revenue based on digital flags: 'fix_date_lod' for specific digital criteria, otherwise 'booking_line_created_date'."",
      ""sql_logic"": ""CASE WHEN ((revenue_type = 'DIGITAL') AND (revenue_group_subtype = 'DIGITAL') AND (sales_segment_l_2_name_sync = 'Digital Other') AND (advertiser_parent != 'DOUBLECLICK')) THEN fix_date_lod ELSE booking_date_parsed END"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Crucial for accurate period-to-date calculations, especially for digital revenue streams."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Business rules for digital revenue categorization are hardcoded; should be externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_current_fy_gross_revenue"",
      ""metric_name"": ""Total Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for current sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_current_fy_gross_revenue_k"",
      ""metric_name"": ""Total Current FY Gross Revenue (000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_current_fy_gross_revenue""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the current financial year, expressed in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for current sales performance, presented in a more readable format."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000""
      ],
      ""governance_issues"": [
        ""The division by 1000 is hardcoded; should be a configurable parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_prior_fy_gross_revenue"",
      ""metric_name"": ""Total Prior FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the prior financial year (relative_fy_year_offset = 1)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for comparing current sales performance against the previous year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_prior_fy_gross_revenue_k"",
      ""metric_name"": ""Total Prior FY Gross Revenue (000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_prior_fy_gross_revenue""
      ],
      ""business_description"": ""The sum of gross revenue amounts for the prior financial year, expressed in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for comparing current sales performance against the previous year, presented in a more readable format."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000""
      ],
      ""governance_issues"": [
        ""The division by 1000 is hardcoded; should be a configurable parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_conditional_gross_revenue"",
      ""metric_name"": ""Total Conditional Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_current_fy"",
        ""is_unified_publication_ecommerce_outstream_etc"",
        ""is_effective_date_before_prior_year_ref""
      ],
      ""business_description"": ""A specific revenue calculation for the current FY, including digital publication types or revenue up to the prior year's reference date."",
      ""sql_logic"": ""SUM(CASE WHEN (is_current_fy AND is_unified_publication_ecommerce_outstream_etc) THEN gross_revenue_amount WHEN (is_current_fy AND SAFE_CAST(effective_date_for_revenue AS DATETIME) <= prior_year_reference_date) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely represents a specific 'Digital YTD' or 'Specific Product Revenue' KPI."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23""
      ],
      ""hardcoded_values_in_metric"": [
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded dates and business rules for categorization; should be parameterized or externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_conditional_gross_revenue_k"",
      ""metric_name"": ""Total Conditional Gross Revenue (000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_conditional_gross_revenue""
      ],
      ""business_description"": ""A specific revenue calculation for the current FY, including digital publication types or revenue up to the prior year's reference date, expressed in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (is_current_fy AND is_unified_publication_ecommerce_outstream_etc) THEN gross_revenue_amount WHEN (is_current_fy AND SAFE_CAST(effective_date_for_revenue AS DATETIME) <= prior_year_reference_date) THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_period_combined IN ('Jul Q1 H1')"",
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely represents a specific 'Digital YTD' or 'Specific Product Revenue' KPI, presented in a more readable format."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23""
      ],
      ""hardcoded_values_in_metric"": [
        ""1000"",
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded dates and business rules for categorization; should be parameterized or externalized. Division by 1000 is hardcoded.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_current_fy_gross_revenue_k"",
      ""related_metrics"": [
        ""total_current_fy_gross_revenue""
      ],
      ""relationship_description"": ""Total Current FY Gross Revenue (000s) is derived by dividing Total Current FY Gross Revenue by 1000."",
      ""mathematical_formula"": ""total_current_fy_gross_revenue_k = total_current_fy_gross_revenue / 1000"",
      ""business_validation"": ""Ensures revenue figures are presented in a consistent and easily digestible format (thousands)."",
      ""validation_sql"": ""SELECT SUM(total_current_fy_gross_revenue_k * 1000) = SUM(total_current_fy_gross_revenue) FROM FinalMetrics"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_prior_fy_gross_revenue_k"",
      ""related_metrics"": [
        ""total_prior_fy_gross_revenue""
      ],
      ""relationship_description"": ""Total Prior FY Gross Revenue (000s) is derived by dividing Total Prior FY Gross Revenue by 1000."",
      ""mathematical_formula"": ""total_prior_fy_gross_revenue_k = total_prior_fy_gross_revenue / 1000"",
      ""business_validation"": ""Ensures prior year revenue figures are presented in a consistent and easily digestible format (thousands)."",
      ""validation_sql"": ""SELECT SUM(total_prior_fy_gross_revenue_k * 1000) = SUM(total_prior_fy_gross_revenue) FROM FinalMetrics"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_conditional_gross_revenue_k"",
      ""related_metrics"": [
        ""total_conditional_gross_revenue""
      ],
      ""relationship_description"": ""Total Conditional Gross Revenue (000s) is derived by dividing Total Conditional Gross Revenue by 1000."",
      ""mathematical_formula"": ""total_conditional_gross_revenue_k = total_conditional_gross_revenue / 1000"",
      ""business_validation"": ""Ensures conditional revenue figures are presented in a consistent and easily digestible format (thousands)."",
      ""validation_sql"": ""SELECT SUM(total_conditional_gross_revenue_k * 1000) = SUM(total_conditional_gross_revenue) FROM FinalMetrics"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_current_fy_gross_revenue_k"",
      ""related_metrics"": [
        ""financial_period_combined"",
        ""sales_segment_l_2_name""
      ],
      ""relationship_description"": ""All aggregated revenue metrics are filtered by specific values of 'financial_period_combined' ('Jul Q1 H1') and 'sales_segment_l_2_name' ('Consortium QLD')."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""These filters define the scope of the sales performance being analyzed, focusing on a specific period and sales team."",
      ""validation_sql"": ""SELECT COUNT(*) FROM FinalMetrics WHERE financial_period_combined NOT IN ('Jul Q1 H1') OR sales_segment_l_2_name NOT IN ('Consortium QLD')"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_conditional_gross_revenue"",
      ""related_metrics"": [
        ""is_current_fy"",
        ""is_unified_publication_ecommerce_outstream_etc"",
        ""effective_date_for_revenue"",
        ""prior_year_reference_date"",
        ""gross_revenue_amount""
      ],
      ""relationship_description"": ""The 'Conditional Gross Revenue' metric has complex dependencies on multiple flags and date comparisons, indicating a specific business rule for this revenue type."",
      ""mathematical_formula"": ""SUM(CASE WHEN (is_current_fy AND is_unified_publication_ecommerce_outstream_etc) THEN gross_revenue_amount WHEN (is_current_fy AND effective_date_for_revenue <= prior_year_reference_date) THEN gross_revenue_amount ELSE 0 END)"",
      ""business_validation"": ""This metric likely represents a specific 'Digital YTD' or 'Product-Specific YTD' revenue, requiring careful validation of its underlying business logic and date alignment."",
      ""validation_sql"": ""SELECT COUNT(*) FROM FinalMetrics WHERE conditional_gross_revenue_base > 0 AND NOT ((is_current_fy AND is_unified_publication_ecommerce_outstream_etc) OR (is_current_fy AND SAFE_CAST(effective_date_for_revenue AS DATETIME) <= prior_year_reference_date))"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,0
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d8074b2-17a8-48ba-babe-c536359b1f64"",
    ""dashboard_name"": ""Final_Draft Adsales Performance Dashboard - FY25 20241127"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 18,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_short_month"",
      ""financial_quarter"",
      ""sales_segment_l_2_name_sync"",
      ""revenue_type_derived"",
      ""product_group"",
      ""unified_publication_name"",
      ""relative_fy_month_offset"",
      ""relative_fy_year_offset""
    ],
    ""date_range_detected"": ""Relative to 2025-01-06, focusing on current, previous, and next financial years."",
    ""hardcoded_dates_found"": [
      ""2025-01-06""
    ],
    ""hardcoded_values_found"": [
      ""'DOUBLECLICK'"",
      ""'N'"",
      ""'Y'"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""0"",
      ""-1"",
      ""1""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized (e.g., use CURRENT_DATE() or dashboard parameters) instead of hardcoded values."",
      ""Lookup values (e.g., 'DOUBLECLICK', 'DIGITAL', month names, 'Digital Other') should be managed in governed reference tables and joined, rather than hardcoded in CASE statements."",
      ""Business logic for derived dates and flags could be externalized into UDFs or configuration tables for better maintainability and reusability.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all identified metrics and dimensions from the dashboard's SQL into a single, BigQuery-compliant query.\n-- It replicates the nested logic using CTEs for clarity and maintainability.\n-- A date filter is applied to the base table for performance optimization.\n\nWITH base_data AS (\n  SELECT\n    t0.DOW_Today AS DOW_Today,\n    t0.advertiser_parent AS advertiser_parent,\n    t0.booking_line_created_date AS booking_line_created_date,\n    t0.financial_quarter AS financial_quarter,\n    t0.financial_short_month AS financial_short_month,\n    t0.financial_year AS financial_year,\n    t0.fix_date_lod AS fix_date_lod,\n    t0.gross_revenue_amount AS gross_revenue_amount,\n    t0.is_future_period_flag AS is_future_period_flag,\n    t0.pipeline AS pipeline,\n    t0.relative_fy_month_offset AS relative_fy_month_offset,\n    t0.relative_fy_week_offset AS relative_fy_week_offset,\n    t0.relative_fy_year_offset AS relative_fy_year_offset,\n    t0.revenue_group_subtype AS revenue_group_subtype,\n    t0.revenue_type AS revenue_type,\n    t0.sales_segment_l_2_name_sync AS sales_segment_l_2_name_sync,\n    t0.ss_lgb AS ss_lgb,\n    t0.xtend_flag AS xtend_flag,\n    -- Hardcoded date for calculations, should be parameterized for dynamic dashboards\n    DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS base_calc_date\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Apply a reasonable date filter to limit data processed and improve query performance.\n  -- Adjust the interval based on typical dashboard reporting periods.\n  WHERE SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n),\n-- First layer of transformations (equivalent to the first subquery's derived columns)\ntransformed_data_1 AS (\n  SELECT\n    *,\n    DATETIME_ADD(SAFE_CAST(base_calc_date AS DATETIME), INTERVAL -365 DAY) AS date_one_year_ago, -- Corresponds to clmn19_\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick, -- Corresponds to clmn20_\n    PARSE_DATE('%Y-%m-%d', booking_line_created_date) AS booking_date_parsed, -- Corresponds to clmn21_\n    SAFE_CAST(financial_quarter AS INT64) AS financial_quarter_int, -- Corresponds to clmn22_\n    CASE\n      WHEN (financial_short_month = 'Jul') THEN '1.Jul'\n      WHEN (financial_short_month = 'Aug') THEN '2.Aug'\n      WHEN (financial_short_month = 'Sep') THEN '3.Sep'\n      WHEN (financial_short_month = 'Oct') THEN '4.Oct'\n      WHEN (financial_short_month = 'Nov') THEN '5.Nov'\n      WHEN (financial_short_month = 'Dec') THEN '6.Dec'\n      WHEN (financial_short_month = 'Jan') THEN '7.Jan'\n      WHEN (financial_short_month = 'Feb') THEN '8.Feb'\n      WHEN (financial_short_month = 'Mar') THEN '9.Mar'\n      WHEN (financial_short_month = 'Apr') THEN '10.Apr'\n      WHEN (financial_short_month = 'May') THEN '11.May'\n      WHEN (financial_short_month = 'Jun') THEN '12.Jun'\n      ELSE NULL\n    END AS financial_month_mapped, -- Corresponds to clmn23_\n    SAFE_DIVIDE(gross_revenue_amount, 1000) AS gross_revenue_k, -- Corresponds to clmn24_\n    (is_future_period_flag = 'N') AS is_not_future_period, -- Corresponds to clmn25_\n    (relative_fy_week_offset = 0) AS is_current_week, -- Corresponds to clmn26_\n    (relative_fy_week_offset < 0) AS is_past_week, -- Corresponds to clmn27_\n    CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END AS prev_fy_gross_revenue_raw, -- Corresponds to clmn28_, clmn32_\n    (relative_fy_year_offset = 0) AS is_current_fy, -- Corresponds to clmn29_\n    (relative_fy_year_offset = -1) AS is_prev_fy, -- Corresponds to clmn30_\n    CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END AS curr_fy_gross_revenue_raw, -- Corresponds to clmn31_, clmn33_\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype, -- Corresponds to clmn34_\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type, -- Corresponds to clmn35_\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_segment, -- Corresponds to clmn36_\n    SAFE_DIVIDE((ss_lgb * DOW_Today), 7) AS weekly_avg_ss_lgb, -- Corresponds to clmn37_\n    SAFE_DIVIDE(ss_lgb, 1000) AS ss_lgb_k, -- Corresponds to clmn38_\n    CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_derived -- Corresponds to clmn39_\n  FROM transformed_data_1\n),\n-- Second layer of transformations (equivalent to the second subquery's derived columns)\ntransformed_data_2 AS (\n  SELECT\n    *,\n    CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_k ELSE 0 END AS curr_fy_revenue_k_any_period, -- Corresponds to clmn40_, clmn42_\n    CASE WHEN (relative_fy_year_offset = 1) THEN gross_revenue_k ELSE 0 END AS next_fy_revenue_k, -- Corresponds to clmn41_\n    CASE WHEN (is_current_fy AND is_past_week) THEN ss_lgb ELSE 0 END AS curr_fy_lgb_past_week_raw, -- Corresponds to clmn43_\n    CASE WHEN (is_current_fy AND is_not_future_period) THEN gross_revenue_amount ELSE 0 END AS curr_fy_gross_revenue_not_future_raw, -- Corresponds to clmn44_\n    CASE\n      WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_segment AND is_not_doubleclick) THEN fix_date_lod\n      ELSE booking_date_parsed\n    END AS derived_date_for_comparison, -- Corresponds to clmn45_\n    CASE WHEN (is_current_fy AND is_current_week) THEN weekly_avg_ss_lgb ELSE 0 END AS curr_fy_weekly_avg_lgb_curr_week_raw, -- Corresponds to clmn46_\n    CASE WHEN (relative_fy_year_offset = 0) THEN ss_lgb_k ELSE 0 END AS curr_fy_lgb_k_any_period -- Corresponds to clmn47_, clmn48_\n  FROM transformed_data_2\n),\n-- Third layer of transformations (equivalent to the third subquery's derived columns)\ntransformed_data_3 AS (\n  SELECT\n    *,\n    SAFE_DIVIDE(curr_fy_gross_revenue_not_future_raw, 1000) AS curr_fy_gross_revenue_k_not_future, -- Corresponds to clmn49_\n    (SAFE_CAST(derived_date_for_comparison AS DATETIME) <= date_one_year_ago) AS is_derived_date_before_one_year_ago -- Corresponds to clmn50_\n  FROM transformed_data_3\n),\n-- Fourth layer of transformations (equivalent to the fourth subquery's derived columns)\ntransformed_data_4 AS (\n  SELECT\n    *,\n    CASE WHEN (is_prev_fy AND is_derived_date_before_one_year_ago) THEN gross_revenue_amount ELSE 0 END AS prev_fy_gross_revenue_date_cond_raw -- Corresponds to clmn51_, clmn52_\n  FROM transformed_data_4\n)\n-- Final aggregation and selection of metrics and dimensions\nSELECT\n  financial_short_month,\n  financial_year,\n  financial_month_mapped,\n  revenue_type_derived,\n  financial_quarter_int,\n  relative_fy_month_offset,\n  relative_fy_year_offset,\n  sales_segment_l_2_name_sync,\n\n  -- Aggregated Metrics (renamed for clarity)\n  SUM(curr_fy_weekly_avg_lgb_curr_week_raw) AS current_fy_weekly_avg_lgb_current_week,\n  MAX(SAFE_CAST(is_digital_other_segment AS INT64)) AS digital_other_sales_segment_flag,\n  SUM(curr_fy_revenue_k_any_period) AS current_fy_gross_revenue_k,\n  SUM(curr_fy_gross_revenue_raw) AS current_fy_gross_revenue,\n  SUM(curr_fy_gross_revenue_k_not_future) AS current_fy_gross_revenue_k_not_future,\n  MAX(relative_fy_month_offset) AS max_relative_fy_month_offset,\n  SUM(pipeline) AS total_pipeline,\n  SUM(curr_fy_lgb_k_any_period) AS current_fy_lgb_k,\n  SUM(curr_fy_lgb_past_week_raw) AS current_fy_lgb_past_week,\n  MAX(relative_fy_year_offset) AS max_relative_fy_year_offset,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(prev_fy_gross_revenue_raw) AS previous_fy_gross_revenue,\n  SUM(curr_fy_revenue_k_any_period - curr_fy_lgb_k_any_period) AS current_fy_revenue_k_minus_lgb_k,\n  SUM(prev_fy_gross_revenue_date_cond_raw) AS previous_fy_gross_revenue_date_cond,\n  SUM(ss_lgb) AS total_lgb,\n  SUM(SAFE_DIVIDE(prev_fy_gross_revenue_date_cond_raw, 1000)) AS previous_fy_gross_revenue_date_cond_k,\n  SUM(next_fy_revenue_k) AS next_fy_revenue_k,\n  SUM(SAFE_DIVIDE(prev_fy_gross_revenue_raw, 1000)) AS previous_fy_gross_revenue_k\nFROM transformed_data_4\nGROUP BY\n  financial_short_month,\n  financial_year,\n  financial_month_mapped,\n  revenue_type_derived,\n  financial_quarter_int,\n  relative_fy_month_offset,\n  relative_fy_year_offset,\n  sales_segment_l_2_name_sync\nORDER BY\n  financial_year DESC, financial_quarter_int DESC, relative_fy_month_offset DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(booking_line_created_date AS DATE)) as unique_booking_dates,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  MIN(SAFE_CAST(booking_line_created_date AS DATE)) as earliest_booking_date,\n  MAX(SAFE_CAST(booking_line_created_date AS DATE)) as latest_booking_date,\n  AVG(SAFE_CAST(gross_revenue_amount AS NUMERIC)) as avg_gross_revenue_amount,\n  APPROX_COUNT_DISTINCT(CONCAT(financial_year, financial_short_month, sales_segment_l_2_name_sync)) as approx_unique_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_data_present,\n  CASE WHEN COUNT(DISTINCT financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_data_present,\n  CASE WHEN MAX(SAFE_CAST(booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN relative_fy_year_offset = 0 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_present,\n  CASE WHEN COUNT(CASE WHEN relative_fy_year_offset = -1 THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as previous_fy_data_present\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Digital Revenue Type Consistency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL') THEN 1 ELSE 0 END) as digital_revenue_matches,\n  SAFE_DIVIDE(SUM(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL') THEN 1 ELSE 0 END), COUNT(*)) * 100 as digital_match_percentage,\n  'Relative FY Offset Distribution' as rule_name_2,\n  COUNT(CASE WHEN relative_fy_year_offset = 0 THEN 1 END) as current_fy_records,\n  COUNT(CASE WHEN relative_fy_year_offset = -1 THEN 1 END) as previous_fy_records,\n  COUNT(CASE WHEN relative_fy_year_offset = 1 THEN 1 END) as next_fy_records\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(booking_line_created_date AS DATE) as booking_date,\n  financial_year,\n  financial_short_month,\n  financial_quarter,\n  gross_revenue_amount,\n  pipeline,\n  ss_lgb,\n  relative_fy_year_offset,\n  relative_fy_month_offset,\n  relative_fy_week_offset,\n  revenue_type,\n  sales_segment_l_2_name_sync,\n  advertiser_parent,\n  xtend_flag,\n  is_future_period_flag\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY SAFE_CAST(booking_line_created_date AS DATE) DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-01-06"",
          ""original_format"": ""DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed baseline date for calculating 'one year ago' and for conditional logic in 'previous_fy_gross_revenue_date_cond'."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter to make the dashboard dynamic and evergreen."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'"",
            ""'DIGITAL'"",
            ""'Digital Other'""
          ],
          ""context"": ""String literals used in direct comparisons for filtering or categorizing data (e.g., advertiser_parent, revenue_type, sales_segment_l_2_name_sync)."",
          ""suggested_governance"": ""Create and join to a `dim_advertiser_type`, `dim_revenue_type`, or `dim_sales_segment` reference table. This centralizes definitions and allows for easier updates."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'N'"",
            ""'Y'""
          ],
          ""context"": ""Boolean flags represented as string literals (e.g., `is_future_period_flag`, `xtend_flag`)."",
          ""suggested_governance"": ""Convert to boolean data types in the source or use a lookup table for flag definitions. Ensure consistent representation."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'"",
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'""
          ],
          ""context"": ""Month names used in a CASE statement to map `financial_short_month` to a sorted 'X.Month' format."",
          ""suggested_governance"": ""Create a `dim_month` table with month names and their sort order, then join to it. Alternatively, use BigQuery's `FORMAT_DATE` or `EXTRACT` functions if a proper date column is available for `financial_short_month`."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""0"",
            ""-1"",
            ""1""
          ],
          ""context"": ""Numeric values used for `relative_fy_year_offset` and `relative_fy_week_offset` to define current, previous, or next periods."",
          ""suggested_governance"": ""While these are relative offsets and often hardcoded, ensure their meaning is well-documented. If the definition of 'current week/year' changes (e.g., based on a different calendar system), this logic would need updating."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY/MONTH/YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., 'DOUBLECLICK', 'DIGITAL', month names) with joins to governed reference tables for centralized management and consistency."",
      ""Consider using configuration tables or UDFs for complex business rules (like the derived date logic) instead of embedding them deeply in nested SQL queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""current_fy_weekly_avg_lgb_current_week"",
      ""metric_name"": ""Current FY Weekly Avg LGB (Current Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Weekly average of 'Sales Segment Last Good Booking' (ss_lgb) for the current financial year and current week. This likely represents a key performance indicator for recent sales activity."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_week_offset = 0) THEN SAFE_DIVIDE(ss_lgb * DOW_Today, 7) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)"",
        ""relative_fy_week_offset = 0 (Current Week)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the current week's average booking performance within the current financial year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Reliance on DOW_Today and ss_lgb for accurate weekly average.""
      ]
    },
    {
      ""metric_id"": ""digital_other_sales_segment_flag"",
      ""metric_name"": ""Digital Other Sales Segment Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag (1 if true, 0 if false) indicating if the sales segment is 'Digital Other'. Max is used to get a single flag value per group."",
      ""sql_logic"": ""MAX(SAFE_CAST(sales_segment_l_2_name_sync = 'Digital Other' AS INT64))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for filtering or segmenting data by a specific sales segment type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""Hardcoded string 'Digital Other' should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k"",
      ""metric_name"": ""Current FY Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the current financial year, expressed in thousands of currency units."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core revenue metric for the current financial performance, scaled for readability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k_not_future"",
      ""metric_name"": ""Current FY Gross Revenue (Thousands, Not Future)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the current financial year, specifically excluding any future periods, expressed in thousands of currency units. This provides a view of realized or committed revenue."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND is_future_period_flag = 'N') THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)"",
        ""is_future_period_flag = 'N' (Not Future Period)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for understanding current, non-speculative revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'N'""
      ],
      ""governance_issues"": [
        ""Hardcoded flag 'N' should be managed consistently.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the current financial year, in original currency units."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A fundamental metric for current financial performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""max_relative_fy_month_offset"",
      ""metric_name"": ""Max Relative FY Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The maximum relative financial year month offset observed within the aggregated group. Useful for understanding the range of data included in the current view."",
      ""sql_logic"": ""MAX(relative_fy_month_offset)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides context on the time window covered by the aggregated data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total value of the sales pipeline, representing potential future revenue."",
      ""sql_logic"": ""SUM(pipeline)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for sales forecasting and resource planning."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_lgb_k"",
      ""metric_name"": ""Current FY LGB (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Sales Segment Last Good Booking' (ss_lgb) for the current financial year, expressed in thousands. This is a key metric for tracking sales commitments."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN SAFE_DIVIDE(ss_lgb, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into current financial year's booking performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_lgb_past_week"",
      ""metric_name"": ""Current FY LGB (Past Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Sales Segment Last Good Booking' (ss_lgb) for the current financial year, specifically for past weeks (relative_fy_week_offset < 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_week_offset < 0) THEN ss_lgb ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)"",
        ""relative_fy_week_offset < 0 (Past Week)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Helps analyze historical booking trends within the current financial year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""max_relative_fy_year_offset"",
      ""metric_name"": ""Max Relative FY Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The maximum relative financial year offset observed within the aggregated group. Useful for understanding the range of financial years (current, previous, next) included in the data."",
      ""sql_logic"": ""MAX(relative_fy_year_offset)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides context on the financial year scope of the aggregated data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total raw gross revenue amount from the source, without any financial year or period filtering applied at this aggregation level."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the overall revenue volume before specific period segmentation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the previous financial year. Used for year-over-year comparisons."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1 (Previous FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Essential for historical performance analysis and trend identification."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_revenue_k_minus_lgb_k"",
      ""metric_name"": ""Current FY Revenue (Thousands) minus Current FY LGB (Thousands)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_lgb_k""
      ],
      ""business_description"": ""The difference between current financial year gross revenue in thousands and current financial year 'ss_lgb' in thousands. This could represent a net revenue or a variance."",
      ""sql_logic"": ""SUM( (CASE WHEN (relative_fy_year_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) - (CASE WHEN (relative_fy_year_offset = 0) THEN SAFE_DIVIDE(ss_lgb, 1000) ELSE 0 END) )"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0 (Current FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a derived metric for specific financial analysis, potentially indicating unbooked revenue or a specific type of variance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_date_cond"",
      ""metric_name"": ""Previous FY Gross Revenue (Date Condition)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Gross revenue for the previous financial year, conditional on a complex derived date being on or before 2024-01-06. This metric is highly dependent on a hardcoded date and specific business rules for date derivation."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney'), INTERVAL -365 DAY))) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1 (Previous FY)"",
        ""Derived date <= 2024-01-06""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely used for specific historical comparisons or to track performance against a fixed past point in time, potentially for a specific digital segment."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-06""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded date '2025-01-06' makes this metric static and requires manual updates."",
        ""Complex derived date logic should be simplified or externalized for clarity and maintainability."",
        ""Hardcoded lookup values should be replaced with reference tables.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correctness of the complex derived date logic and the hardcoded date.""
      ]
    },
    {
      ""metric_id"": ""total_lgb"",
      ""metric_name"": ""Total LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Sales Segment Last Good Booking' (ss_lgb) amount, without any financial year or period filtering applied at this aggregation level."",
      ""sql_logic"": ""SUM(ss_lgb)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the overall volume of bookings before specific period segmentation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""next_fy_revenue_k"",
      ""metric_name"": ""Next FY Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the next financial year, expressed in thousands. This is likely for forward-looking analysis and forecasting."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 1) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 1 (Next FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Important for strategic planning and setting future targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k"",
      ""metric_name"": ""Previous FY Gross Revenue (Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue for the previous financial year, expressed in thousands of currency units. Used for year-over-year comparisons."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1 (Previous FY)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Essential for historical performance analysis and trend identification, scaled for readability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_date_cond_k"",
      ""metric_name"": ""Previous FY Gross Revenue (Date Condition, Thousands)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""previous_fy_gross_revenue_date_cond""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, conditional on a complex derived date being on or before 2024-01-06, expressed in thousands. This metric is highly dependent on a hardcoded date and specific business rules for date derivation."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney'), INTERVAL -365 DAY))) THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1 (Previous FY)"",
        ""Derived date <= 2024-01-06""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Scaled version of 'previous_fy_gross_revenue_date_cond' for readability in specific historical comparisons."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-06""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded date '2025-01-06' makes this metric static and requires manual updates."",
        ""Complex derived date logic should be simplified or externalized for clarity and maintainability."",
        ""Hardcoded lookup values should be replaced with reference tables.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correctness of the complex derived date logic and the hardcoded date.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_revenue_k_minus_lgb_k"",
      ""related_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_lgb_k""
      ],
      ""relationship_description"": ""This metric is a direct subtraction of 'Current FY LGB (Thousands)' from 'Current FY Gross Revenue (Thousands)'."",
      ""mathematical_formula"": ""current_fy_revenue_k_minus_lgb_k = current_fy_gross_revenue_k - current_fy_lgb_k"",
      ""business_validation"": ""Validates the net revenue or variance after accounting for 'Last Good Booking' within the current financial year."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) - \n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(ss_lgb, 1000) ELSE 0 END) AS calculated_difference,\n  SUM((CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) - (CASE WHEN relative_fy_year_offset = 0 THEN SAFE_DIVIDE(ss_lgb, 1000) ELSE 0 END)) AS direct_calculation\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""current_fy_gross_revenue"",
        ""previous_fy_gross_revenue"",
        ""next_fy_revenue_k""
      ],
      ""relationship_description"": ""The total gross revenue is the sum of revenue across all financial years. The FY-specific metrics are subsets of this total, filtered by `relative_fy_year_offset`."",
      ""mathematical_formula"": ""total_gross_revenue_amount = SUM(current_fy_gross_revenue) + SUM(previous_fy_gross_revenue) + SUM(next_fy_revenue_k * 1000) + other_years_revenue"",
      ""business_validation"": ""Ensures that the sum of segmented revenue aligns with the overall total revenue, providing a consistent view of financial performance across different time horizons."",
      ""validation_sql"": ""SELECT \n  SUM(gross_revenue_amount) AS total_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS previous_fy_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) AS next_fy_revenue,\n  SUM(CASE WHEN relative_fy_year_offset NOT IN (0, -1, 1) THEN gross_revenue_amount ELSE 0 END) AS other_fy_revenue\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""previous_fy_gross_revenue_date_cond"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue""
      ],
      ""relationship_description"": ""This metric is a more specific version of 'Previous FY Gross Revenue', adding a complex date condition. It is a subset of the general previous FY revenue."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_date_cond <= previous_fy_gross_revenue"",
      ""business_validation"": ""Used to compare a specific historical period's performance against the broader previous financial year, often for targeted analysis or campaign effectiveness."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS previous_fy_total,\n  SUM(CASE WHEN (relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney'), INTERVAL -365 DAY))) THEN gross_revenue_amount ELSE 0 END) AS previous_fy_date_cond_total\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,1
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c441950c-1e3f-432c-9838-847d1d315b9e"",
    ""dashboard_name"": ""Circulation Insights for Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights;ncau-data-newsquery-prd.prstn_finance.v_calendar_dim"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""day_of_week"",
      ""charge_type"",
      ""gl_publication_code"",
      ""sales_channel_l4"",
      ""publication_group""
    ],
    ""date_range_detected"": ""Fiscal Year 2025, specifically weeks 202533-202545"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""202541"",
      ""202542"",
      ""202543"",
      ""202544"",
      ""202545"",
      ""202533"",
      ""202534"",
      ""202535"",
      ""202536"",
      ""202537"",
      ""202538"",
      ""202539"",
      ""202540"",
      ""Sun"",
      ""DRAW"",
      ""RETURNS"",
      ""ADJUSTMENT"",
      ""Subscriptions"",
      ""DT"",
      ""500"",
      ""560"",
      ""100"",
      ""400"",
      ""402"",
      ""9504"",
      ""9505"",
      ""110"",
      ""116"",
      ""350"",
      ""670"",
      ""180"",
      ""156"",
      ""301"",
      ""303"",
      ""5003"",
      ""850"",
      ""852"",
      ""961"",
      ""963"",
      ""158"",
      ""Post Courier"",
      ""5024"",
      ""9514"",
      ""9515"",
      ""5053"",
      ""450"",
      ""475"",
      ""9560"",
      ""9556"",
      ""305""
    ],
    ""governance_opportunities"": [
      ""fiscal_year should be parameterized"",
      ""specific fiscal_week_ids should be dynamic or parameterized"",
      ""publication codes (gl_publication_code) should join to a governed lookup table instead of hardcoded CASE statements"",
      ""charge_type values should be from a controlled vocabulary or lookup table"",
      ""sales_channel_l4 values should be from a controlled vocabulary or lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates all identified metrics and dimensions from the dashboard's underlying data.\n-- It applies a broad fiscal year filter (2025, as seen in all original queries) and groups by all relevant dimensions.\n-- Specific filters from individual dashboard components (e.g., specific fiscal weeks, day of week, sales channel, publication group) are NOT applied here to provide a comprehensive dataset for unified analysis.\n-- Users can apply these specific filters on top of this consolidated dataset as needed.\n\nWITH base_data AS (\n  SELECT\n    ci.charge_date,\n    ci.fiscal_week_id,\n    cal.day_short_name AS day_of_week,\n    ci.charge_type,\n    ci.route_volume,\n    ci.charge_amount,\n    ci.gl_publication_code,\n    ci.sales_channel_l4\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n    LEFT JOIN\n    `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n    ON ci.charge_date = cal.calendar_date\n  WHERE\n    SAFE_CAST(LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- Common year filter\n),\n-- CTE to derive Publication Group based on gl_publication_code\nderived_data AS (\n  SELECT\n    charge_date,\n    fiscal_week_id,\n    day_of_week,\n    charge_type,\n    SAFE_CAST(route_volume AS NUMERIC) AS route_volume,\n    SAFE_CAST(charge_amount AS NUMERIC) AS charge_amount,\n    gl_publication_code,\n    sales_channel_l4,\n    CASE\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('500', '560') THEN 'ADV'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '100' THEN 'AUS'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('400', '402') THEN 'CM'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9504' THEN 'Delicious'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9505' THEN 'Delicious Specials'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('110', '116') THEN 'DT'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '350' THEN 'GAD'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '670' THEN 'GCB'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '180' THEN 'Group Shared Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '156' THEN 'Hobart Print Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('301', '303') THEN 'HS'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5003' THEN 'MDM'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('850', '852') THEN 'MERCURY'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('961', '963') THEN 'NTN'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '158' THEN 'Perth Print Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = 'Post Courier' THEN 'Post Courier'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5024' THEN 'SC'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('9514', '9515') THEN 'Taste'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5053' THEN 'TCHRN'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '450' THEN 'TCP'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '475' THEN 'TVB'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9560' THEN 'Vogue'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9556' THEN 'Vogue Living'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '305' THEN 'WT'\n      ELSE 'Other'\n    END AS publication_group\n  FROM\n    base_data\n)\nSELECT\n  fiscal_week_id,\n  day_of_week,\n  publication_group,\n  sales_channel_l4,\n  SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) AS total_returns_volume,\n  SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) AS total_draw_volume,\n  SUM(\n    CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END +\n    CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END +\n    CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END\n  ) AS total_volume_draw_adj_returns,\n  SUM(charge_amount) AS total_charge_amount\nFROM\n  derived_data\nGROUP BY\n  fiscal_week_id,\n  day_of_week,\n  publication_group,\n  sales_channel_l4\nORDER BY\n  fiscal_week_id DESC, day_of_week, publication_group, sales_channel_l4\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling.\n-- Focuses on the primary insights table and its join to calendar.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(ci.charge_date AS DATE)) as unique_charge_dates,\n  COUNT(DISTINCT SAFE_CAST(ci.fiscal_week_id AS STRING)) as unique_fiscal_weeks,\n  COUNT(DISTINCT ci.charge_type) as unique_charge_types,\n  COUNT(DISTINCT ci.gl_publication_code) as unique_publication_codes,\n  COUNT(DISTINCT ci.sales_channel_l4) as unique_sales_channels,\n  MIN(SAFE_CAST(ci.charge_date AS DATE)) as earliest_charge_date,\n  MAX(SAFE_CAST(ci.charge_date AS DATE)) as latest_charge_date,\n  AVG(SAFE_CAST(ci.route_volume AS NUMERIC)) as avg_route_volume,\n  AVG(SAFE_CAST(ci.charge_amount AS NUMERIC)) as avg_charge_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  LEFT JOIN\n  `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n  ON ci.charge_date = cal.calendar_date\nWHERE\n  SAFE_CAST(LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- Limit to the relevant year for performance\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present.\n-- Checks for data freshness and non-zero values for key metrics within the last 90 days or the detected fiscal year.\nWITH base_data AS (\n  SELECT\n    ci.charge_date,\n    ci.fiscal_week_id,\n    ci.charge_type,\n    ci.route_volume,\n    ci.charge_amount\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  WHERE\n    SAFE_CAST(LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- Focus on the relevant year\n)\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN MAX(SAFE_CAST(charge_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN SUM(SAFE_CAST(route_volume AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_volume_positive_test,\n  CASE WHEN SUM(SAFE_CAST(charge_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_charge_positive_test,\n  CASE WHEN COUNT(DISTINCT charge_type) >= 3 THEN 'PASS' ELSE 'FAIL' END as charge_type_diversity_test -- Expecting DRAW, RETURNS, ADJUSTMENT\nFROM\n  base_data\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, specifically the 'Publication Group' mapping.\n-- This checks the distribution and coverage of the hardcoded CASE statement.\nWITH base_data AS (\n  SELECT\n    gl_publication_code,\n    CASE\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('500', '560') THEN 'ADV'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '100' THEN 'AUS'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('400', '402') THEN 'CM'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9504' THEN 'Delicious'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9505' THEN 'Delicious Specials'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('110', '116') THEN 'DT'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '350' THEN 'GAD'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '670' THEN 'GCB'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '180' THEN 'Group Shared Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '156' THEN 'Hobart Print Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('301', '303') THEN 'HS'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5003' THEN 'MDM'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('850', '852') THEN 'MERCURY'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('961', '963') THEN 'NTN'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '158' THEN 'Perth Print Services'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = 'Post Courier' THEN 'Post Courier'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5024' THEN 'SC'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) IN ('9514', '9515') THEN 'Taste'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '5053' THEN 'TCHRN'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '450' THEN 'TCP'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '475' THEN 'TVB'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9560' THEN 'Vogue'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '9556' THEN 'Vogue Living'\n      WHEN SAFE_CAST(gl_publication_code AS STRING) = '305' THEN 'WT'\n      ELSE 'Other'\n    END AS publication_group\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights`\n  WHERE\n    SAFE_CAST(LEFT(SAFE_CAST(fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- Limit to the relevant year\n)\nSELECT\n  publication_group,\n  COUNT(*) AS record_count,\n  COUNT(DISTINCT gl_publication_code) AS distinct_source_codes,\n  SUM(CASE WHEN publication_group = 'Other' THEN 1 ELSE 0 END) AS other_category_count\nFROM\n  base_data\nGROUP BY\n  publication_group\nORDER BY\n  record_count DESC\nLIMIT 100;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis.\n-- Includes key dimensions and raw metric columns.\nSELECT\n  SAFE_CAST(ci.charge_date AS DATE) as charge_date,\n  SAFE_CAST(ci.fiscal_week_id AS STRING) as fiscal_week_id,\n  cal.day_short_name as day_of_week,\n  ci.charge_type,\n  SAFE_CAST(ci.route_volume AS NUMERIC) as route_volume,\n  SAFE_CAST(ci.charge_amount AS NUMERIC) as charge_amount,\n  SAFE_CAST(ci.gl_publication_code AS STRING) as gl_publication_code,\n  ci.sales_channel_l4\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  LEFT JOIN\n  `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n  ON ci.charge_date = cal.calendar_date\nWHERE\n  SAFE_CAST(LEFT(SAFE_CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- Filter to the relevant year\n  AND ci.route_volume IS NOT NULL -- Ensure relevant data is present\nORDER BY\n  ci.charge_date DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""string '2025'"",
          ""context"": ""Used as a hardcoded fiscal year filter in all queries."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @fiscal_year) or a dynamic calculation (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202541, 202542, 202543, 202544, 202545"",
          ""original_format"": ""integer list"",
          ""context"": ""Specific fiscal week IDs used as filters in the first query."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @fiscal_week_ids) or derive dynamically based on relative periods (e.g., last N weeks)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540"",
          ""original_format"": ""integer list"",
          ""context"": ""Specific fiscal week IDs used as filters in the second query."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @fiscal_week_ids) or derive dynamically based on relative periods (e.g., last N weeks)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'500'"",
            ""'560'"",
            ""'100'"",
            ""'400'"",
            ""'402'"",
            ""'9504'"",
            ""'9505'"",
            ""'110'"",
            ""'116'"",
            ""'350'"",
            ""'670'"",
            ""'180'"",
            ""'156'"",
            ""'301'"",
            ""'303'"",
            ""'5003'"",
            ""'850'"",
            ""'852'"",
            ""'961'"",
            ""'963'"",
            ""'158'"",
            ""'Post Courier'"",
            ""'5024'"",
            ""'9514'"",
            ""'9515'"",
            ""'5053'"",
            ""'450'"",
            ""'475'"",
            ""'9560'"",
            ""'9556'"",
            ""'305'""
          ],
          ""context"": ""GL publication codes hardcoded in a CASE statement to derive 'Publication Group'."",
          ""suggested_governance"": ""Create and join to a `dim_publication_group` lookup table that maps `gl_publication_code` to `publication_group_name`."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'DRAW'"",
            ""'RETURNS'"",
            ""'ADJUSTMENT'""
          ],
          ""context"": ""Charge types hardcoded in CASE statements for volume calculations."",
          ""suggested_governance"": ""Ensure these values are part of a controlled vocabulary or `dim_charge_type` table. While less critical for calculation logic, consistency is key."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'Sun'""
          ],
          ""context"": ""Day of week filter hardcoded in the first query."",
          ""suggested_governance"": ""Replace with a parameter (e.g., @day_of_week) or derive dynamically."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'Subscriptions'""
          ],
          ""context"": ""Sales channel filter hardcoded in the second query."",
          ""suggested_governance"": ""Replace with a parameter (e.g., @sales_channel) or join to a `dim_sales_channel` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'DT'""
          ],
          ""context"": ""Publication group filter hardcoded in the second query."",
          ""suggested_governance"": ""Replace with a parameter (e.g., @publication_group) or derive from the `dim_publication_group` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal years and fiscal week IDs with date parameters or relative date functions (e.g., `_FISC_YEAR_`, `_FISC_WEEK_`)."",
      ""Replace hardcoded lookup values for `gl_publication_code` with joins to a governed `dim_publication_group` reference table."",
      ""Replace hardcoded filter values for `day_of_week`, `sales_channel_l4`, and derived `publication_group` with Looker Studio parameters to allow user selection.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_returns_volume"",
      ""metric_name"": ""Total Returns Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume of products or units categorized as 'RETURNS'. This likely represents items returned from circulation."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = 2025"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to analyze circulation efficiency and potential losses due to returns, specifically for Sunday circulation in certain fiscal weeks."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202541"",
        ""202542"",
        ""202543"",
        ""202544"",
        ""202545""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Sun'"",
        ""'RETURNS'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in route_volume"",
        ""accuracy depends on correct charge_type classification""
      ]
    },
    {
      ""metric_id"": ""total_draw_volume"",
      ""metric_name"": ""Total Draw Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total volume of products or units categorized as 'DRAW'. This likely represents the initial quantity of items distributed for circulation."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = 2025"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to analyze the initial distribution volume, specifically for Sunday circulation in certain fiscal weeks."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202541"",
        ""202542"",
        ""202543"",
        ""202544"",
        ""202545""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Sun'"",
        ""'DRAW'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in route_volume"",
        ""accuracy depends on correct charge_type classification""
      ]
    },
    {
      ""metric_id"": ""total_volume_draw_adj_returns"",
      ""metric_name"": ""Total Volume (Draw + Adjustment + Returns)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_draw_volume"",
        ""total_returns_volume""
      ],
      ""business_description"": ""The sum of volumes for 'DRAW', 'ADJUSTMENT', and 'RETURNS' charge types. This represents the overall movement of units in the circulation process."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = 2025"",
        ""day_of_week = 'Sun'"",
        ""fiscal_week_id IN (202541, 202542, 202543, 202544, 202545)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key metric for understanding the total volume handled in circulation, combining initial distribution, adjustments, and returns, specifically for Sunday circulation in certain fiscal weeks."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202541"",
        ""202542"",
        ""202543"",
        ""202544"",
        ""202545""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Sun'"",
        ""'DRAW'"",
        ""'ADJUSTMENT'"",
        ""'RETURNS'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in route_volume"",
        ""accuracy depends on correct charge_type classification""
      ]
    },
    {
      ""metric_id"": ""total_charge_amount"",
      ""metric_name"": ""Total Charge Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""publication_group""
      ],
      ""business_description"": ""The total monetary value of charges recorded. This represents revenue or costs associated with circulation activities."",
      ""sql_logic"": ""SUM(charge_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [
        ""fiscal_year = 2025"",
        ""fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540)"",
        ""sales_channel_l4 = 'Subscriptions'"",
        ""publication_group = 'DT'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A critical financial metric, specifically tracking charges related to 'Subscriptions' for the 'DT' publication group within a specific range of fiscal weeks."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202533"",
        ""202534"",
        ""202535"",
        ""202536"",
        ""202537"",
        ""202538"",
        ""202539"",
        ""202540""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Subscriptions'"",
        ""'DT'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in charge_amount"",
        ""accuracy depends on correct sales_channel_l4 and gl_publication_code classification""
      ]
    },
    {
      ""metric_id"": ""publication_group"",
      ""metric_name"": ""Publication Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A derived categorization of publications based on their GL publication codes, grouping them into broader business units or brands."",
      ""sql_logic"": ""CASE WHEN gl_publication_code IN ('500', '560') THEN 'ADV' ... ELSE 'Other' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a key dimension for filtering and grouping financial and volume metrics, providing a higher-level view of performance by publication type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'500'"",
        ""'560'"",
        ""'100'"",
        ""'400'"",
        ""'402'"",
        ""'9504'"",
        ""'9505'"",
        ""'110'"",
        ""'116'"",
        ""'350'"",
        ""'670'"",
        ""'180'"",
        ""'156'"",
        ""'301'"",
        ""'303'"",
        ""'5003'"",
        ""'850'"",
        ""'852'"",
        ""'961'"",
        ""'963'"",
        ""'158'"",
        ""'Post Courier'"",
        ""'5024'"",
        ""'9514'"",
        ""'9515'"",
        ""'5053'"",
        ""'450'"",
        ""'475'"",
        ""'9560'"",
        ""'9556'"",
        ""'305'"",
        ""'ADV'"",
        ""'AUS'"",
        ""'CM'"",
        ""'Delicious'"",
        ""'Delicious Specials'"",
        ""'DT'"",
        ""'GAD'"",
        ""'GCB'"",
        ""'Group Shared Services'"",
        ""'Hobart Print Services'"",
        ""'HS'"",
        ""'MDM'"",
        ""'MERCURY'"",
        ""'NTN'"",
        ""'Perth Print Services'"",
        ""'Post Courier'"",
        ""'SC'"",
        ""'Taste'"",
        ""'TCHRN'"",
        ""'TCP'"",
        ""'TVB'"",
        ""'Vogue'"",
        ""'Vogue Living'"",
        ""'WT'"",
        ""'Other'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""reliance on hardcoded mapping, 'Other' category might hide important unmapped values""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_volume_draw_adj_returns"",
      ""related_metrics"": [
        ""total_draw_volume"",
        ""total_returns_volume""
      ],
      ""relationship_description"": ""Total Volume (Draw + Adjustment + Returns) is a direct sum of Draw Volume, Returns Volume, and Adjustment Volume. It represents the aggregate movement of units."",
      ""mathematical_formula"": ""total_volume_draw_adj_returns = SUM(Draw Volume) + SUM(Adjustment Volume) + SUM(Returns Volume)"",
      ""business_validation"": ""This relationship ensures that the overall volume metric accurately reflects the sum of its component parts, providing a comprehensive view of unit circulation."",
      ""validation_sql"": ""SELECT SUM(total_volume_draw_adj_returns) AS total_combined_volume, SUM(total_draw_volume + total_returns_volume + (SELECT SUM(CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE SAFE_CAST(LEFT(SAFE_CAST(fiscal_week_id AS STRING), 4) AS INT64) = 2025)) AS sum_of_components FROM primary_analysis_sql_output_table WHERE fiscal_week_id IN (202541, 202542, 202543, 202544, 202545) AND day_of_week = 'Sun';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_charge_amount"",
      ""related_metrics"": [
        ""publication_group"",
        ""sales_channel_l4""
      ],
      ""relationship_description"": ""The 'Total Charge Amount' metric is specifically filtered by 'sales_channel_l4' = 'Subscriptions' and 'publication_group' = 'DT'. This indicates a focused analysis on a particular segment of revenue."",
      ""mathematical_formula"": null,
      ""business_validation"": ""This relationship highlights that the dashboard is interested in subscription revenue specifically for the 'DT' publication group, implying these are key segments for financial tracking."",
      ""validation_sql"": ""SELECT SUM(total_charge_amount) FROM primary_analysis_sql_output_table WHERE sales_channel_l4 = 'Subscriptions' AND publication_group = 'DT' AND fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,2
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""bb49fa78-5abe-4e68-a9c1-8172a832e724"",
    ""dashboard_name"": ""optimization"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 8,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""masthead_group"",
      ""finance_recognition"",
      ""fy_year"",
      ""fy_month_of_year"",
      ""fy_quarter_of_year"",
      ""fy_week_of_year""
    ],
    ""date_range_detected"": ""Data spans multiple fiscal years (e.g., 2024, 2025). Metrics are calculated for specific hardcoded weeks (e.g., Week 37, Week 38) relative to a fixed base date (2024-07-03)."",
    ""hardcoded_dates_found"": [
      ""2025-03-26"",
      ""2024-07-03"",
      ""2025-03-25""
    ],
    ""hardcoded_values_found"": [
      ""2025"",
      ""2024"",
      ""'Discontinued'"",
      ""'Digital Recognition'"",
      ""1"",
      ""2"",
      ""3"",
      ""4"",
      ""5"",
      ""6"",
      ""7"",
      ""8"",
      ""9"",
      ""10"",
      ""11"",
      ""12"",
      ""13"",
      ""14"",
      ""18"",
      ""23"",
      ""27"",
      ""31"",
      ""36"",
      ""40"",
      ""44"",
      ""49"",
      ""53""
    ],
    ""governance_opportunities"": [
      ""Dates used for 'current week' calculation should be dynamic (e.g., CURRENT_DATE()) or parameterized."",
      ""The base date for week calculation ('2024-07-03') should be parameterized or derived from a configuration table."",
      ""Fiscal year and week definitions (e.g., mapping week numbers to custom periods) should be externalized to a governed lookup table."",
      ""String literals like 'Discontinued' and 'Digital Recognition' should be managed via reference tables for consistency and maintainability.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates all identified key metrics for a dynamically determined 'current week' and 'previous year same week'.\n-- The 'current week' is derived based on CURRENT_DATE() and a fixed base date (2024-07-03) as observed in the original queries.\n-- All filters and transformations are applied as per the original queries.\n\nWITH base_data AS (\n  SELECT\n    t0.BudgetEarnedAmount AS budget_earned_amount,\n    t0.ClosingBase AS closing_base,\n    t0.EarnedAmount AS earned_amount,\n    t0.ForecastBudgetEarnedAmount AS forecast_budget_earned_amount,\n    t0.NFEarnedAmount AS nf_earned_amount,\n    t0.NYBudgetEarnedAmount AS ny_budget_earned_amount,\n    t0.OpeningBase AS opening_base,\n    t0.finance_recognition AS finance_recognition,\n    t0.fy_month_of_year AS fy_month_of_year,\n    t0.fy_quarter_of_year AS fy_quarter_of_year,\n    t0.fy_week_of_year AS fy_week_of_year,\n    t0.fy_year AS fy_year,\n    t0.masthead_group AS masthead_group,\n    -- Calculate the custom week number based on CURRENT_DATE() and the observed base date\n    DATETIME_DIFF(SAFE_CAST(CURRENT_DATE() AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS calculated_custom_week_number\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\n  WHERE\n    t0.masthead_group != 'Discontinued'\n    AND t0.finance_recognition = 'Digital Recognition'\n),\n\ncurrent_week_context AS (\n  SELECT\n    MAX(calculated_custom_week_number) AS current_custom_week_number,\n    MAX(EXTRACT(YEAR FROM CURRENT_DATE())) AS current_fiscal_year_derived -- Using calendar year as proxy for fiscal year for dynamic calculation\n  FROM base_data\n)\n\nSELECT\n  'Overall' AS dashboard_scope,\n  SUM(CASE WHEN bd.fy_year = cwc.current_fiscal_year_derived AND bd.fy_week_of_year = cwc.current_custom_week_number THEN SAFE_CAST(bd.budget_earned_amount AS NUMERIC) ELSE 0 END) AS budget_earned_amount_current_week,\n  SUM(CASE WHEN bd.fy_year = cwc.current_fiscal_year_derived AND bd.fy_week_of_year = cwc.current_custom_week_number THEN SAFE_CAST(bd.closing_base AS NUMERIC) ELSE 0 END) AS closing_base_current_week,\n  SUM(CASE WHEN bd.fy_year = cwc.current_fiscal_year_derived AND bd.fy_week_of_year = cwc.current_custom_week_number THEN SAFE_CAST(bd.opening_base AS NUMERIC) ELSE 0 END) AS opening_base_current_week,\n  SUM(CASE WHEN bd.fy_year = cwc.current_fiscal_year_derived AND bd.fy_week_of_year = cwc.current_custom_week_number THEN SAFE_CAST(bd.earned_amount AS NUMERIC) ELSE 0 END) AS earned_amount_current_week,\n  SUM(CASE WHEN bd.fy_year = (cwc.current_fiscal_year_derived - 1) AND bd.fy_week_of_year = cwc.current_custom_week_number THEN SAFE_CAST(bd.closing_base AS NUMERIC) - SAFE_CAST(bd.opening_base AS NUMERIC) ELSE 0 END) AS net_base_change_previous_year_same_week,\n  'Week to Date & Budget View' AS dashboard_view_type_q3_derived -- This is hardcoded in Q3, so we derive it here.\nFROM\n  base_data AS bd\nCROSS JOIN\n  current_week_context AS cwc\nLIMIT 100;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_year AS INT64)) AS unique_fiscal_years,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_month_of_year AS INT64)) AS unique_fiscal_months,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_week_of_year AS INT64)) AS unique_fiscal_weeks,\n  COUNT(DISTINCT t0.masthead_group) AS unique_masthead_groups,\n  COUNT(DISTINCT t0.finance_recognition) AS unique_finance_recognitions,\n  MIN(SAFE_CAST(t0.fy_year AS INT64)) AS earliest_fy_year,\n  MAX(SAFE_CAST(t0.fy_year AS INT64)) AS latest_fy_year,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(t0.fy_year AS STRING), '-', SAFE_CAST(t0.fy_week_of_year AS STRING), '-', t0.masthead_group, '-', t0.finance_recognition)) AS approx_unique_grain_combinations\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Look at recent years\nLIMIT 100;\n"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.BudgetEarnedAmount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS budget_earned_amount_test,\n  CASE WHEN SUM(SAFE_CAST(t0.ClosingBase AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS closing_base_test,\n  CASE WHEN SUM(SAFE_CAST(t0.EarnedAmount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS earned_amount_test,\n  CASE WHEN COUNT(DISTINCT t0.masthead_group) > 1 THEN 'PASS' ELSE 'FAIL' END AS masthead_group_diversity_test,\n  CASE WHEN COUNT(DISTINCT t0.finance_recognition) > 0 THEN 'PASS' ELSE 'FAIL' END AS finance_recognition_test,\n  CASE WHEN MAX(SAFE_CAST(t0.fy_year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_fy_year_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Check data for current and last fiscal year\nLIMIT 1;\n"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Digital Recognition Filter' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE WHEN t0.finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END) AS records_matching_digital_recognition,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS digital_recognition_match_percentage,\n  'Masthead Group Exclusion' AS rule_name_2,\n  SUM(CASE WHEN t0.masthead_group != 'Discontinued' THEN 1 ELSE 0 END) AS records_not_discontinued,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.masthead_group != 'Discontinued' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS not_discontinued_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Validate rules on recent data\nLIMIT 1;\n"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.fy_year AS INT64) AS fy_year,\n  SAFE_CAST(t0.fy_month_of_year AS INT64) AS fy_month_of_year,\n  SAFE_CAST(t0.fy_week_of_year AS INT64) AS fy_week_of_year,\n  t0.masthead_group,\n  t0.finance_recognition,\n  SAFE_CAST(t0.BudgetEarnedAmount AS NUMERIC) AS budget_earned_amount,\n  SAFE_CAST(t0.ClosingBase AS NUMERIC) AS closing_base,\n  SAFE_CAST(t0.EarnedAmount AS NUMERIC) AS earned_amount,\n  SAFE_CAST(t0.ForecastBudgetEarnedAmount AS NUMERIC) AS forecast_budget_earned_amount,\n  SAFE_CAST(t0.NFEarnedAmount AS NUMERIC) AS nf_earned_amount,\n  SAFE_CAST(t0.NYBudgetEarnedAmount AS NUMERIC) AS ny_budget_earned_amount,\n  SAFE_CAST(t0.OpeningBase AS NUMERIC) AS opening_base\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.fy_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Get sample for recent data\n  AND t0.finance_recognition = 'Digital Recognition'\n  AND t0.masthead_group != 'Discontinued'\nORDER BY t0.fy_year DESC, t0.fy_week_of_year DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-03-26"",
          ""original_format"": ""2025-03-26 03:31:44.896010+00"",
          ""context"": ""Used as a reference date for calculating a 'current week number' in Query 1."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter to make the 'current week' dynamic."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the base date for DATETIME_DIFF calculations to determine custom week numbers in Query 1 and Query 2."",
          ""suggested_fix"": ""Parameterize this base date or derive it from a configuration table if it represents a fiscal year start or similar fixed point."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-03-25"",
          ""original_format"": ""2025-03-25 23:59:29.736172+00"",
          ""context"": ""Used as a reference date for calculating a 'current week number' in Query 2, leading to a different 'current week' than Query 1."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter, and ensure consistency across all queries for 'current week' definition."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""2025"", ""2024""],
          ""context"": ""Fiscal years are hardcoded for current and previous year comparisons."",
          ""suggested_governance"": ""Derive fiscal years dynamically from CURRENT_DATE() or a fiscal calendar table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Discontinued'""],
          ""context"": ""Used to filter out specific masthead groups."",
          ""suggested_governance"": ""Manage 'Discontinued' status in a masthead dimension table and join for filtering."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Digital Recognition'""],
          ""context"": ""Used to filter for specific finance recognition types."",
          ""suggested_governance"": ""Manage 'Digital Recognition' and other finance recognition types in a reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""1"", ""2"", ""3"", ""4"", ""5"", ""6"", ""7"", ""8"", ""9"", ""10"", ""11"", ""12"", ""13"", ""14"", ""18"", ""23"", ""27"", ""31"", ""36"", ""40"", ""44"", ""49"", ""53""],
          ""context"": ""Numbers used in complex CASE WHEN statements to map fiscal week/month/quarter to custom periods (e.g., clmn35_, clmn36_ in Q1, clmn19_, clmn20_ in Q2)."",
          ""suggested_governance"": ""Externalize these mappings to a fiscal calendar or period definition table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""display_logic"",
          ""hardcoded_values"": [""'Week to Date & Budget View'"", ""'Week to Date & Forecast View'"", ""'Week to Date & Year on Year View'"", ""'Week to Date & NY Budget View'"", ""'Month to Date & Budget View'"", ""'Month to Date & Forecast View'"", ""'Quarter to Date & Budget View'"", ""'Quarter to Date & Forecast View'"", ""'Year to Date & Budget View'"", ""'Year to Date & Forecast View'""],
          ""context"": ""Hardcoded strings defining dashboard view types in Query 3. Only 'Week to Date & Budget View' is ever returned due to `(1=1)` logic."",
          ""suggested_governance"": ""If these are meant to be dynamic, they should be driven by dashboard parameters or a configuration table. If static, document their purpose."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-03-26', '2024-07-03') with Looker Studio date parameters or BigQuery's `CURRENT_DATE()` for dynamic reporting."",
      ""Introduce parameters for fiscal year (e.g., `{{fiscal_year_param}}`) instead of hardcoding '2025' or '2024'."",
      ""Externalize business rules and lookup values (e.g., 'Discontinued', 'Digital Recognition', and the complex week/month/quarter mappings) into dedicated reference tables. This allows for easier updates and consistent application across dashboards."",
      ""Consider creating a 'fiscal calendar' table that defines fiscal years, quarters, months, and weeks, including their start/end dates and any custom period mappings, to replace the complex `DATETIME_DIFF` and `CASE WHEN` logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""budget_earned_amount_current_week"",
      ""metric_name"": ""Budget Earned Amount (Current Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total budgeted earned amount for the current fiscal week and year, based on a dynamically calculated week number relative to a fixed base date."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = [current_fiscal_year] AND fy_week_of_year = [calculated_custom_week_number] THEN BudgetEarnedAmount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'"", ""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A key financial metric indicating performance against budget for the most recent period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-26"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""Week calculation relies on hardcoded dates."", ""Fiscal year is hardcoded.""],
      ""data_quality_concerns"": [""Accuracy depends on the definition of 'current week' and 'BudgetEarnedAmount' data quality.""]
    },
    {
      ""metric_id"": ""closing_base_current_week"",
      ""metric_name"": ""Closing Base (Current Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total closing base amount for the current fiscal week and year, based on a dynamically calculated week number relative to a fixed base date."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = [current_fiscal_year] AND fy_week_of_year = [calculated_custom_week_number] THEN ClosingBase ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'"", ""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Indicates the total subscriber base or similar closing value at the end of the current week."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-26"", ""2025-03-25"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""Week calculation relies on hardcoded dates."", ""Fiscal year is hardcoded.""],
      ""data_quality_concerns"": [""Potential for discrepancies if 'current week' definition varies across queries.""]
    },
    {
      ""metric_id"": ""opening_base_current_week"",
      ""metric_name"": ""Opening Base (Current Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total opening base amount for the current fiscal week and year, based on a dynamically calculated week number relative to a fixed base date."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = [current_fiscal_year] AND fy_week_of_year = [calculated_custom_week_number] THEN OpeningBase ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'"", ""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Indicates the total subscriber base or similar opening value at the beginning of the current week."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-26"", ""2025-03-25"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""Week calculation relies on hardcoded dates."", ""Fiscal year is hardcoded.""],
      ""data_quality_concerns"": [""Potential for discrepancies if 'current week' definition varies across queries.""]
    },
    {
      ""metric_id"": ""earned_amount_current_week"",
      ""metric_name"": ""Earned Amount (Current Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total earned amount for the current fiscal week and year, based on a dynamically calculated week number relative to a fixed base date."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = [current_fiscal_year] AND fy_week_of_year = [calculated_custom_week_number] THEN EarnedAmount ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'"", ""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A core revenue metric representing actual earnings for the most recent period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-26"", ""2025-03-25"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""Week calculation relies on hardcoded dates."", ""Fiscal year is hardcoded.""],
      ""data_quality_concerns"": [""Potential for discrepancies if 'current week' definition varies across queries.""]
    },
    {
      ""metric_id"": ""net_base_change_previous_year_same_week"",
      ""metric_name"": ""Net Base Change (Previous Year, Same Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""closing_base_previous_year_same_week"", ""opening_base_previous_year_same_week""],
      ""business_description"": ""The difference between Closing Base and Opening Base for the same fiscal week in the previous year, relative to the current dynamically calculated week."",
      ""sql_logic"": ""SUM(CASE WHEN fy_year = ([current_fiscal_year] - 1) AND fy_week_of_year = [calculated_custom_week_number] THEN (ClosingBase - OpeningBase) ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'"", ""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used for year-over-year comparison of subscriber base growth or decline."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-26"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2024"", ""2025""],
      ""governance_issues"": [""Week calculation relies on hardcoded dates."", ""Fiscal years are hardcoded.""],
      ""data_quality_concerns"": [""Relies on accurate OpeningBase and ClosingBase for the previous year.""]
    },
    {
      ""metric_id"": ""dashboard_view_type"",
      ""metric_name"": ""Dashboard View Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded string indicating the specific view or context of the dashboard, which consistently resolves to 'Week to Date & Budget View' due to the underlying logic."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Week to Date & Budget View' ... ELSE NULL END"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used as a display label or filter option within the Looker Studio dashboard itself, rather than a data-driven metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Week to Date & Budget View'"", ""'Week to Date & Forecast View'"", ""'Week to Date & Year on Year View'"", ""'Week to Date & NY Budget View'"", ""'Month to Date & Budget View'"", ""'Month to Date & Forecast View'"", ""'Quarter to Date & Budget View'"", ""'Quarter to Date & Forecast View'"", ""'Year to Date & Budget View'"", ""'Year to Date & Forecast View'""],
      ""governance_issues"": [""Hardcoded display values; should be managed via configuration if dynamic behavior is intended.""],
      ""data_quality_concerns"": [""None, as it's a static derived value.""]
    },
    {
      ""metric_id"": ""masthead_group"",
      ""metric_name"": ""Masthead Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group or category of the masthead associated with the subscription."",
      ""sql_logic"": ""t0.masthead_group"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""masthead_group != 'Discontinued'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting financial metrics by different masthead categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Discontinued'""],
      ""governance_issues"": [""'Discontinued' is a hardcoded filter value.""],
      ""data_quality_concerns"": [""Potential for inconsistent naming if not governed.""]
    },
    {
      ""metric_id"": ""finance_recognition"",
      ""metric_name"": ""Finance Recognition"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of financial recognition applied to the subscription, e.g., 'Digital Recognition'."",
      ""sql_logic"": ""t0.finance_recognition"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""],
      ""filters_applied"": [""finance_recognition = 'Digital Recognition'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial filter for isolating specific types of financial data relevant to digital subscriptions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Digital Recognition'""],
      ""governance_issues"": [""'Digital Recognition' is a hardcoded filter value.""],
      ""data_quality_concerns"": [""Potential for inconsistent naming if not governed.""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""budget_earned_amount_current_week"",
      ""related_metrics"": [""masthead_group"", ""finance_recognition""],
      ""relationship_description"": ""All financial metrics are filtered by 'masthead_group != 'Discontinued'' and 'finance_recognition = 'Digital Recognition''."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that financial metrics only include relevant digital subscription data and exclude discontinued mastheads."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` WHERE masthead_group = 'Discontinued' OR finance_recognition != 'Digital Recognition';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""net_base_change_previous_year_same_week"",
      ""related_metrics"": [""closing_base_previous_year_same_week"", ""opening_base_previous_year_same_week""],
      ""relationship_description"": ""Net Base Change is calculated as Closing Base minus Opening Base for the specified period."",
      ""mathematical_formula"": ""Net Base Change = Closing Base - Opening Base"",
      ""business_validation"": ""This calculation provides insight into the net change in subscriber base over a period, crucial for growth analysis."",
      ""validation_sql"": ""SELECT SUM(ClosingBase - OpeningBase) AS calculated_net_change, SUM(ClosingBase) - SUM(OpeningBase) AS sum_of_diff_net_change FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` WHERE fy_year = (EXTRACT(YEAR FROM CURRENT_DATE()) - 1) AND fy_week_of_year = DATETIME_DIFF(SAFE_CAST(CURRENT_DATE() AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""budget_earned_amount_current_week"",
      ""related_metrics"": [""earned_amount_current_week""],
      ""relationship_description"": ""Budget Earned Amount is a target metric, while Earned Amount is the actual performance. They are often compared."",
      ""mathematical_formula"": ""N/A (comparison)"",
      ""business_validation"": ""Comparison of actual earned amount against budgeted amount for performance tracking."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) AND fy_week_of_year = DATETIME_DIFF(SAFE_CAST(CURRENT_DATE() AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) THEN SAFE_CAST(BudgetEarnedAmount AS NUMERIC) ELSE 0 END) AS current_budget, SUM(CASE WHEN fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) AND fy_week_of_year = DATETIME_DIFF(SAFE_CAST(CURRENT_DATE() AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) THEN SAFE_CAST(EarnedAmount AS NUMERIC) ELSE 0 END) AS current_earned FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` WHERE masthead_group != 'Discontinued' AND finance_recognition = 'Digital Recognition' LIMIT 1;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""inconsistency"",
      ""primary_metric"": ""closing_base_current_week"",
      ""related_metrics"": [""opening_base_current_week"", ""earned_amount_current_week""],
      ""relationship_description"": ""The 'current week' definition varies slightly between Query 1 (based on 2025-03-26) and Query 2 (based on 2025-03-25), leading to different week numbers (38 vs 37)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""This inconsistency can lead to different values for 'current week' metrics depending on which query is used, causing confusion and distrust in data."",
      ""validation_sql"": ""SELECT DATETIME_DIFF(SAFE_CAST(DATETIME '2025-03-26T00:00:00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS week_q1, DATETIME_DIFF(SAFE_CAST(DATETIME '2025-03-25T00:00:00' AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS week_q2;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,3
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e83da1de-4227-43e6-bcc6-73051c66914b"",
    ""dashboard_name"": ""Ad Events Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""fy_year_month_number"",
      ""financial_short_month"",
      ""adsize_category"",
      ""revenue_transaction_status"",
      ""booking_name"",
      ""advertiser_name"",
      ""adsize_name"",
      ""revenue_type""
    ],
    ""date_range_detected"": ""FY2024 - FY2026 (with specific filters for FY2025 Q1)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202501"",
      ""202502"",
      ""202503""
    ],
    ""hardcoded_values_found"": [
      ""'^(.*event sponsorship.*)$'"",
      ""'^(.*production.*)$'"",
      ""'Future Bradfield 2024'"",
      ""'Sydney & Brisbane Future Series'"",
      ""'Future Bradfield FY25 B1'"",
      ""'Future Sydney Bradfield 2024'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_FINANCIAL_YEAR())."",
      ""Ad size categorization rules (regex patterns) should be externalized to a lookup table."",
      ""Specific booking names should be managed via a reference table or parameter.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN --\n-- This query consolidates the core logic from the provided Looker Studio queries.\n-- It calculates total gross and net revenue, and includes the custom 'adsize_category' dimension.\n-- Hardcoded filters from the original queries are included as examples and should be parameterized for flexibility.\n\nWITH\n  base_adsales_data AS (\n    SELECT\n      advertiser_name,\n      booking_number,\n      booking_name,\n      regexp_extract(booking_name, r'^[^ _]+') AS booking_name_1st_keyword,\n      sort_caption,\n      adsize_name,\n      classification_name,\n      revenue_type,\n      revenue_group_subtype,\n      financial_year,\n      fy_year_month_number,\n      financial_short_month,\n      -- sales_segment_l_2_name_sync, -- Included in one original query, can be added if needed for broader analysis\n      -- gl_publication_name, -- Included in one original query, can be added if needed for broader analysis\n      source_unified_publication_gl_code,\n      source_unified_publication_name,\n      unified_publication_gl_code,\n      unified_publication_name,\n      revenue_transaction_status,\n      record_type_code,\n      SAFE_CAST(gross_revenue_amount AS NUMERIC) AS gross_revenue_amount, -- Cast to NUMERIC for safety\n      SAFE_CAST(net_revenue AS NUMERIC) AS net_revenue, -- Cast to NUMERIC for safety\n      relative_fy_year_offset\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\n    WHERE\n      relative_fy_year_offset IN (-1, 0, 1) -- Common filter across all original queries (Current FY, Previous FY, Next FY)\n  ),\n  enriched_adsales_data AS (\n    SELECT\n      *,\n      -- Derived dimension: Ad Size Category based on adsize_name\n      CASE\n        WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship'\n        WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production'\n        ELSE 'Media'\n      END AS adsize_category\n    FROM\n      base_adsales_data\n  )\nSELECT\n  financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  adsize_category,\n  revenue_transaction_status,\n  booking_name,\n  advertiser_name,\n  adsize_name,\n  revenue_type,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(net_revenue) AS total_net_revenue,\n  COUNT(DISTINCT booking_number) AS unique_bookings,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers\nFROM\n  enriched_adsales_data\nWHERE\n  -- Example hardcoded filters from original queries. These should ideally be parameters.\n  SAFE_CAST(financial_year AS STRING) = '2025' -- Example filter from Query 1, 2, 3\n  AND fy_year_month_number IN (202501, 202502, 202503) -- Example filter from Query 1\n  -- AND booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024') -- Example filter from Query 3\nGROUP BY\n  financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  adsize_category,\n  revenue_transaction_status,\n  booking_name,\n  advertiser_name,\n  adsize_name,\n  revenue_type\nORDER BY\n  financial_year DESC, fy_year_month_number DESC\nLIMIT 1000; -- Limit for sampling and cost optimization"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) AS unique_financial_years,\n  COUNT(DISTINCT fy_year_month_number) AS unique_fy_year_months,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT booking_number) AS unique_booking_numbers,\n  MIN(SAFE_CAST(financial_year AS STRING)) AS earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) AS latest_financial_year,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(financial_year AS STRING), '-', SAFE_CAST(fy_year_month_number AS STRING), '-', booking_number)) AS approx_unique_transaction_grain\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1) -- Focus on the relevant financial years\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS gross_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(net_revenue AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS net_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS financial_year_test,\n  CASE WHEN MAX(SAFE_CAST(financial_year AS STRING)) >= SAFE_CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS STRING) THEN 'PASS' ELSE 'FAIL' END AS freshness_test_current_fy,\n  CASE WHEN COUNT(DISTINCT revenue_transaction_status) > 1 THEN 'PASS' ELSE 'FAIL' END AS multiple_transaction_statuses_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (0) -- Check current financial year data\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nWITH ad_data AS (\n  SELECT\n    adsize_name,\n    financial_year,\n    fy_year_month_number,\n    booking_name,\n    gross_revenue_amount,\n    CASE\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship'\n      WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production'\n      ELSE 'Media'\n    END AS adsize_category\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1)\n)\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'adsize_category_distribution' AS rule_name,\n  adsize_category,\n  COUNT(*) AS records_count,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue,\n  SAFE_DIVIDE(COUNT(*), SUM(COUNT(*)) OVER()) * 100 AS percentage_of_records\nFROM\n  ad_data\nWHERE\n  SAFE_CAST(financial_year AS STRING) = '2025' -- Validate for a specific year as per original queries\nGROUP BY\n  adsize_category\nORDER BY\n  records_count DESC\nLIMIT 100;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  advertiser_name,\n  booking_name,\n  adsize_name,\n  revenue_type,\n  revenue_transaction_status,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  SAFE_CAST(net_revenue AS NUMERIC) AS net_revenue,\n  relative_fy_year_offset\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (0) -- Sample from current financial year\n  AND SAFE_CAST(gross_revenue_amount AS NUMERIC) IS NOT NULL\nORDER BY\n  gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""STRING"",
          ""context"": ""Used as a filter for financial_year in all three queries."",
          ""suggested_fix"": ""Replace with a Looker Studio date parameter or a BigQuery function like `EXTRACT(YEAR FROM CURRENT_DATE())` or a reference to a dynamic financial year table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202501, 202502, 202503"",
          ""original_format"": ""INT64"",
          ""context"": ""Used as a filter for fy_year_month_number in job_7xKhQEqBG1XaCVJdIcRXU90TdjrW."",
          ""suggested_fix"": ""Replace with Looker Studio date parameters for start/end month or dynamic calculation based on current date/financial period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'^(.*event sponsorship.*)$'"",
            ""'^(.*production.*)$'""
          ],
          ""context"": ""Regex patterns used to categorize 'adsize_name' into 'Sponsorship', 'Production', 'Media'."",
          ""suggested_governance"": ""Create a lookup table (e.g., `adsize_category_mapping`) with `adsize_pattern` and `adsize_category` columns. Join to this table or use a UDF for categorization."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Future Bradfield 2024'"",
            ""'Sydney & Brisbane Future Series'"",
            ""'Future Bradfield FY25 B1'"",
            ""'Future Sydney Bradfield 2024'""
          ],
          ""context"": ""Specific 'booking_name' values used as a filter in job_iSsMg-zvzCOtO89aVx8k3yH3IaBj."",
          ""suggested_governance"": ""Manage these specific booking names in a reference table (e.g., `special_bookings_list`) and join/filter against it, or use a Looker Studio parameter for user selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and month numbers with Looker Studio date range parameters or dynamic BigQuery date functions (e.g., `CURRENT_DATE()`, `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Externalize ad size categorization regex patterns into a governed lookup table to improve maintainability and consistency."",
      ""Manage specific booking names in a dedicated reference table or allow user selection via Looker Studio parameters instead of hardcoding.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for an advertising booking item as provided by the `v_adsales_revenue_client` view. This view itself performs an initial aggregation."",
      ""sql_logic"": ""gross_revenue_amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is the foundational revenue figure before any further aggregations or categorizations are applied by the dashboard queries."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_revenue_base"",
      ""metric_name"": ""Net Revenue (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw net revenue amount for an advertising booking item as provided by the `v_adsales_revenue_client` view. This view itself performs an initial aggregation."",
      ""sql_logic"": ""net_revenue"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is the foundational net revenue figure before any further aggregations or categorizations are applied by the dashboard queries."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""The aggregated gross revenue amount, typically filtered by financial year, month, and other dimensions like ad size category or transaction status. This is the primary revenue metric displayed on the dashboard."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year IN ('2025')"",
        ""fy_year_month_number IN (202501, 202502, 202503)"",
        ""booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This metric is crucial for understanding advertising revenue performance across different dimensions and time periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202501"",
        ""202502"",
        ""202503""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Future Bradfield 2024'"",
        ""'Sydney & Brisbane Future Series'"",
        ""'Future Bradfield FY25 B1'"",
        ""'Future Sydney Bradfield 2024'""
      ],
      ""governance_issues"": [
        ""Hardcoded dates should be parameterized."",
        ""Hardcoded booking names should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the underlying `v_adsales_revenue_client` view's data quality and aggregation logic.""
      ]
    },
    {
      ""metric_id"": ""adsize_category"",
      ""metric_name"": ""Ad Size Category"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A custom categorization of ad sizes into 'Sponsorship', 'Production', or 'Media' based on keyword matching within the `adsize_name` field."",
      ""sql_logic"": ""CASE WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship' WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production' ELSE 'Media' END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze revenue performance by different types of advertising campaigns/products."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'^(.*event sponsorship.*)$'"",
        ""'^(.*production.*)$'""
      ],
      ""governance_issues"": [
        ""Regex patterns are hardcoded; should be externalized to a lookup table for easier management and consistency.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the completeness and consistency of keywords in `adsize_name`.""
      ]
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the advertising revenue transaction."",
      ""sql_logic"": ""financial_year"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for yearly revenue analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded year '2025' should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year_month_number"",
      ""metric_name"": ""Financial Year Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year and month number (e.g., 202501 for Jan 2025) associated with the advertising revenue transaction."",
      ""sql_logic"": ""fy_year_month_number"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [
        ""fy_year_month_number IN (202501, 202502, 202503)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for monthly revenue analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202501"",
        ""202502"",
        ""202503""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded month numbers should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Jan', 'Feb') associated with the advertising revenue transaction."",
      ""sql_logic"": ""financial_short_month"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for display purposes in monthly revenue reports."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction (e.g., 'Actual', 'Forecast', 'Cancelled')."",
      ""sql_logic"": ""revenue_transaction_status"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by its current state, allowing for analysis of committed vs. projected revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_name"",
      ""metric_name"": ""Booking Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific name of the advertising booking, often indicating a campaign or project."",
      ""sql_logic"": ""booking_name"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`""
      ],
      ""filters_applied"": [
        ""booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for detailed analysis of revenue by specific campaigns or projects."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Future Bradfield 2024'"",
        ""'Sydney & Brisbane Future Series'"",
        ""'Future Bradfield FY25 B1'"",
        ""'Future Sydney Bradfield 2024'""
      ],
      ""governance_issues"": [
        ""Hardcoded booking names should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""financial_year"",
        ""fy_year_month_number"",
        ""booking_name"",
        ""revenue_transaction_status"",
        ""adsize_category""
      ],
      ""relationship_description"": ""The `total_gross_revenue` metric is consistently filtered and grouped by various dimensions across the dashboard queries. Filters on `financial_year`, `fy_year_month_number`, and `booking_name` directly restrict the data used for revenue calculation. Grouping by `adsize_category` and `revenue_transaction_status` breaks down the total revenue into meaningful segments."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [dimension_filters] GROUP BY [dimensions]"",
      ""business_validation"": ""This relationship allows users to analyze revenue performance over specific periods, for particular campaigns, or by different ad product categories and transaction statuses, providing granular insights into ad sales performance."",
      ""validation_sql"": ""-- SQL to validate filter impact on total_gross_revenue\nSELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_filtered\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (0) -- Current FY\n  AND SAFE_CAST(financial_year AS STRING) = '2025' -- Specific hardcoded filter from queries\nGROUP BY\n  financial_year\nHAVING\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) IS NOT NULL\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""adsize_category"",
      ""related_metrics"": [
        ""adsize_name""
      ],
      ""relationship_description"": ""The `adsize_category` dimension is directly derived from the `adsize_name` field using a `CASE WHEN` statement with `REGEXP_CONTAINS` logic. This means any changes or inconsistencies in `adsize_name` will directly impact the categorization."",
      ""mathematical_formula"": ""adsize_category = f(adsize_name)"",
      ""business_validation"": ""This derivation is a key business rule for segmenting ad products. Its accuracy is vital for correct reporting of 'Sponsorship', 'Production', and 'Media' revenue. Any changes to product naming conventions or categorization rules require updating this logic."",
      ""validation_sql"": ""-- SQL to validate adsize_category derivation\nSELECT\n  adsize_name,\n  CASE\n    WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship'\n    WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production'\n    ELSE 'Media'\n  END AS derived_adsize_category,\n  COUNT(*) AS record_count\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (0) -- Current FY\nGROUP BY\n  adsize_name, derived_adsize_category\nORDER BY\n  record_count DESC\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,4
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""2104a3f5-9424-4087-a928-e67fecae789a"",
    ""dashboard_name"": ""Circulation Performance Dashboard_dev_20250415"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""publication_name"",
      ""os_level_7"",
      ""fiscal_week_id"",
      ""fy_year_week_number"",
      ""day_of_week"",
      ""gl_publication_code""
    ],
    ""date_range_detected"": ""FY2025 (with specific week context around 2025-06)"",
    ""hardcoded_dates_found"": [
      ""2025-06-23 04:08:01.229999+00"",
      ""2024-07-03T00:00:00"",
      ""2025-06-04 07:28:59.451817+00""
    ],
    ""hardcoded_values_found"": [
      ""'Weekly Times'"",
      ""'Sunshine Coast'"",
      ""'Mackay'"",
      ""'All Sales Channels'"",
      ""'CIRCULATION'"",
      ""'Free News & Lifestyle'"",
      ""'Food'"",
      ""'Prestige'"",
      ""'FY2025'"",
      ""'NT News'"",
      ""'Sunday Territorian'"",
      ""'Northern Territory'"",
      ""'Others'"",
      ""'The Daily Telegraph'"",
      ""'The Sunday Telegraph'"",
      ""'The Herald Sun'"",
      ""'Herald Sun'"",
      ""'Sunday Herald Sun'"",
      ""'Mercury'"",
      ""'Sunday Tasmanian'"",
      ""'(Actual Vs Budget Vs PY)'"",
      ""'Post Courier'"",
      ""'PNG'"",
      ""'Advertiser'"",
      ""48"",
      ""'M-F'"",
      ""'SAT'"",
      ""'Sun'"",
      ""'Weekday Entry'"",
      ""'6 Day Pubs'"",
      ""'Mercury and Sunday Tas'"",
      ""'NT News & Sunday Territorian'"",
      ""'Regionals'"",
      ""'The Advertiser'"",
      ""'The Courier Mail'"",
      ""'The Australian'"",
      ""'The Sportsman'"",
      ""'Ed Media'"",
      ""'Toowoomba'"",
      ""'Townsville Bulletin'"",
      ""'Sunday Mail (SA)'"",
      ""'Sunday Mail (QLD)'"",
      ""'The Sunday Mail'"",
      ""202548""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())."",
      ""Publication names, codes, and groups should be managed in a governed lookup table (e.g., `dim_publication_hierarchy_master`)."",
      ""Sales channel names should be standardized and managed in a dimension table."",
      ""Fiscal year/week logic should be derived dynamically from a calendar dimension table rather than hardcoded values like 'FY2025' or '202548'."",
      ""Divisors (e.g., 48, 6, 7) should be derived from a configuration table or calculated dynamically based on business rules, not hardcoded.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.source_system_name,\n      os.sub_source_system_name,\n      CAST(os.fiscal_week_id AS int) AS fiscal_week_id,\n      os.gl_publication_code,\n      os.day_of_week,\n      os.state,\n      os.os_level_1,\n      os.os_level_2,\n      os.os_level_3,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_8,\n      os.os_level_9,\n      os.os_level_10,\n      os.os_level_11,\n      os.os_level_12,\n      os.Estimate,\n      os.True_Up_Adjustment,\n      os.Actual_Amount,\n      os.volume,\n      os.Last_Year_Actual_Amount,\n      os.Last_Year_volume,\n      os.Budget_Draft_Amount,\n      os.Budget_Draft_Volume,\n      os.Budget_Amount,\n      os.Budget_Volume,\n      os.Forecast_Amount,\n      os.Forecast_Volume,\n      os.Budget_Jan_Amount,\n      os.Budget_Jan_Volume,\n      os.Budget_Feb_Amount,\n      os.Budget_Feb_Volume,\n      os.Budget_Mar_Amount,\n      os.Budget_Mar_Volume,\n      os.Budget_Apr_Amount,\n      os.Budget_Apr_Volume,\n      os.Budget_May_Amount,\n      os.Budget_May_Volume,\n      os.Budget_Jun_Amount,\n      os.Budget_Jun_Volume,\n      os.Budget_Jul_Amount,\n      os.Budget_Jul_Volume,\n      os.Budget_Aug_Amount,\n      os.Budget_Aug_Volume,\n      os.Budget_Sep_Amount,\n      os.Budget_Sep_Volume,\n      os.Budget_Oct_Amount,\n      os.Budget_Oct_Volume,\n      os.Budget_Nov_Amount,\n      os.Budget_Nov_Volume,\n      os.Budget_Dec_Amount,\n      os.Budget_Dec_Volume,\n      os.Forecast_Q1F_Amount,\n      os.Forecast_Q1F_Volume,\n      os.Forecast_Q2F_Amount,\n      os.Forecast_Q2F_Volume,\n      os.Forecast_Q3F_Amount,\n      os.Forecast_Q3F_Volume,\n      os.Forecast_Q4F_Amount,\n      os.Forecast_Q4F_Volume,\n      os.Forecast_Q5F_Amount,\n      os.Forecast_Q5F_Volume,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year,\n      dep.department_code\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n),\nDerivedData AS (\n    SELECT\n        *,\n        CASE\n            WHEN publication_code = 'Post Courier' THEN 'PNG'\n            ELSE publication_name\n        END AS publication_name_adjusted,\n        CASE\n            WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'Northern Territory'\n            WHEN publication_name IN ('', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Others'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n            WHEN publication_name IN ('Sunday Tasmanian', 'Mercury') THEN 'Mercury'\n            ELSE publication_name\n        END AS publication_group_q2,\n        CASE\n            WHEN publication_name IN ('Cairns Post', 'Ed Media', 'Geelong Advertiser', 'Gold Coast Bulletin', 'Mackay', 'Mercury', 'NT News', 'Sunday Tasmanian', 'Sunday Territorian', 'Sunshine Coast', 'Toowoomba', 'Townsville Bulletin', 'PNG', 'Weekly Times') THEN '      Regionals'\n            WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN '     The Advertiser'\n            WHEN publication_name IN ('The Australian') THEN ' The Australian'\n            WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN '    The Courier Mail'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN '   The Daily Telegraph'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN '  The Herald Sun'\n            ELSE '        Other'\n        END AS publication_group_q3_display,\n        CASE\n            WHEN publication_name IN ('Sunday Herald Sun', 'Herald Sun') THEN 'The Herald Sun'\n            WHEN publication_name IN ('The Advertiser', 'Sunday Mail') THEN 'The Advertiser'\n            WHEN publication_name IN ('Courier Mail', 'The Sunday Mail') THEN 'The Courier Mail'\n            WHEN publication_name = 'The Australian' THEN 'The Australian'\n            WHEN publication_name = 'The Sportsman' THEN 'The Sportsman'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name = 'Weekly Times' THEN 'Weekly Times'\n            ELSE NULL\n        END AS publication_group_q3_type_1,\n        CASE\n            WHEN publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs'\n            WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas'\n            WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian'\n            WHEN publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other'\n            WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n            WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n            ELSE publication_name\n        END AS publication_group_q3_type_2,\n        CASE\n            WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'Northern Territory'\n            WHEN publication_name IN ('', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Others'\n            WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n            WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n            ELSE publication_name\n        END AS publication_group_q3_type_3,\n        CASE\n            WHEN day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F'\n            WHEN day_of_week = 'Sat' THEN 'SAT'\n            WHEN day_of_week = 'Sun' THEN 'Sun'\n            ELSE NULL\n        END AS day_of_week_category,\n        DATE(TIMESTAMP '2025-06-23 04:08:01.229999+00', 'Australia/Sydney') AS q1_hardcoded_date,\n        DATE(TIMESTAMP '2025-06-04 07:28:59.451817+00', 'Australia/Sydney') AS q3_hardcoded_date,\n        DATE('2024-07-03') AS baseline_date\n    FROM OSandFACT\n),\nCalculatedMetrics AS (\n    SELECT\n        *,\n        (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q1_hardcoded_date)) - 1) AS q1_day_of_week_num,\n        DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) AS q1_week_diff,\n        CASE\n            WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q1_hardcoded_date)) - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) - 1)\n            ELSE DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK)\n        END AS q1_calculated_week_part,\n        ((2025*100) + (CASE WHEN (0 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q1_hardcoded_date)) - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) END) ELSE 0 END)) AS q1_target_fy_year_week_number,\n        (fy_year_week_number = ((2025*100) + (CASE WHEN (0 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q1_hardcoded_date)) - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(q1_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) END) ELSE 0 END))) AS q1_week_match_filter,\n        (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q3_hardcoded_date)) - 1) AS q3_day_of_week_num,\n        DATETIME_DIFF(SAFE_CAST(q3_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) AS q3_week_diff,\n        CASE\n            WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q3_hardcoded_date)) - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(q3_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) - 1)\n            ELSE DATETIME_DIFF(SAFE_CAST(q3_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK)\n        END AS q3_calculated_week_part,\n        CASE WHEN (48 = 0) THEN (CASE WHEN (EXTRACT(DAYOFWEEK FROM TIMESTAMP(q3_hardcoded_date)) - 1) <= 2 THEN (DATETIME_DIFF(SAFE_CAST(q3_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) - 1) ELSE DATETIME_DIFF(SAFE_CAST(q3_hardcoded_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) END) ELSE 48 END AS q3_divisor_48,\n        CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END AS q3_month_from_48,\n        CASE\n            WHEN SAFE_CAST( (CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END) AS INT64) < 4 THEN volume\n            WHEN SAFE_CAST( (CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END) AS INT64) < 6 THEN (CASE WHEN fy_month_of_year < 4 THEN volume ELSE Forecast_Volume END)\n            WHEN SAFE_CAST( (CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END) AS INT64) = 6 THEN (CASE WHEN fy_month_of_year < 6 THEN volume ELSE Forecast_Volume END)\n            WHEN SAFE_CAST( (CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END) AS INT64) < 9 THEN (CASE WHEN fy_month_of_year < 7 THEN volume ELSE Forecast_Volume END)\n            WHEN SAFE_CAST( (CASE WHEN (48 = 0) THEN SAFE_CAST(NULL AS STRING) WHEN (48 <= 4) THEN '1' WHEN (48 <= 9) THEN '2' WHEN (48 <= 13) THEN '3' WHEN (48 <= 17) THEN '4' WHEN (48 <= 22) THEN '5' WHEN (48 <= 26) THEN '6' WHEN (48 <= 30) THEN '7' WHEN (48 <= 35) THEN '8' WHEN (48 <= 39) THEN '9' WHEN (48 <= 43) THEN '10' WHEN (48 <= 48) THEN '11' WHEN (48 <= 52) THEN '12' ELSE '12' END) AS INT64) = 9 THEN (CASE WHEN fy_month_of_year < 9 THEN volume ELSE Forecast_Volume END)\n            WHEN fy_month_of_year < 10 THEN volume\n            ELSE Forecast_Volume\n        END AS q3_base_volume_selected,\n        SAFE_DIVIDE(volume, q3_divisor_48) AS q3_volume_div_48,\n        (SAFE_DIVIDE(volume, (q3_divisor_48*5))*5) AS q3_volume_div_48_x5,\n        (SAFE_DIVIDE(volume, (q3_divisor_48*2))*5) AS q3_volume_div_48_x2_x5,\n        (SAFE_DIVIDE(volume, q3_divisor_48)*5) AS q3_volume_div_48_x5_alt,\n        CASE\n            WHEN (publication_name = 'The Australian' OR publication_name = 'The Courier Mail') THEN (CASE WHEN day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(volume, (q3_divisor_48*5))*5) ELSE SAFE_DIVIDE(volume, q3_divisor_48) END)\n            WHEN publication_group_q3_type_1 = 'The Sportsman' THEN (SAFE_DIVIDE(volume, (q3_divisor_48*2))*5)\n            WHEN publication_group_q3_type_1 = 'Weekly Times' THEN (SAFE_DIVIDE(volume, q3_divisor_48)*5)\n            WHEN publication_group_q3_type_2 = 'PNG' THEN 0\n            WHEN day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(volume, (q3_divisor_48*5))*5)\n            ELSE SAFE_DIVIDE(volume, q3_divisor_48)\n        END AS q3_clmn49_calculated_volume,\n        CASE\n            WHEN publication_group_q3_type_2 = 'PNG' THEN 0\n            WHEN publication_group_q3_type_2 = '6 Day Pubs' THEN SAFE_DIVIDE(q3_clmn49_calculated_volume, 6)\n            ELSE SAFE_DIVIDE(q3_clmn49_calculated_volume, 7)\n        END AS q3_final_volume_type_1,\n        CASE\n            WHEN (publication_name = 'The Australian' OR publication_name = 'The Courier Mail') THEN (CASE WHEN day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(q3_base_volume_selected, (q3_divisor_48*5))*5) ELSE SAFE_DIVIDE(q3_base_volume_selected, q3_divisor_48) END)\n            WHEN publication_group_q3_type_1 = 'The Sportsman' THEN (SAFE_DIVIDE(q3_base_volume_selected, (q3_divisor_48*2))*5)\n            WHEN publication_group_q3_type_1 = 'Weekly Times' THEN (SAFE_DIVIDE(q3_base_volume_selected, q3_divisor_48)*5)\n            WHEN publication_group_q3_type_2 = 'PNG' THEN 0\n            WHEN day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(q3_base_volume_selected, (q3_divisor_48*5))*5)\n            ELSE SAFE_DIVIDE(q3_base_volume_selected, q3_divisor_48)\n        END AS q3_clmn61_calculated_volume,\n        CASE\n            WHEN publication_group_q3_type_2 = '6 Day Pubs' THEN SAFE_DIVIDE(q3_clmn61_calculated_volume, 6)\n            ELSE SAFE_DIVIDE(q3_clmn61_calculated_volume, 7)\n        END AS q3_final_volume_type_2\n    FROM DerivedData\n)\nSELECT\n    'Overall Dashboard Metrics' AS dashboard_view,\n    SUM(CASE\n        WHEN T2.q1_week_match_filter = TRUE\n        AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n        AND T2.os_level_7 = 'All Sales Channels'\n        THEN T2.Actual_Amount\n        ELSE 0\n    END) AS total_actual_amount_q1,\n    SUM(CASE\n        WHEN T2.q1_week_match_filter = TRUE\n        AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n        AND T2.os_level_7 = 'All Sales Channels'\n        THEN T2.volume\n        ELSE 0\n    END) AS total_volume_q1,\n    COUNT(DISTINCT CASE\n        WHEN T2.publication_group_q2 = 'Advertiser'\n        THEN T2.publication_name\n        ELSE NULL\n    END) AS publication_count_advertiser_q2,\n    SUM(CASE\n        WHEN T2.fy_year = 2025\n        AND T2.fy_year_week_number <= 202548\n        AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n        AND T2.os_level_7 = 'All Sales Channels'\n        AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')\n        THEN T2.q3_final_volume_type_1\n        ELSE 0\n    END) AS total_calculated_volume_type_1_q3,\n    SUM(CASE\n        WHEN T2.fy_year = 2025\n        AND T2.fy_year_week_number <= 202548\n        AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n        AND T2.os_level_7 = 'All Sales Channels'\n        AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')\n        THEN T2.q3_final_volume_type_2\n        ELSE 0\n    END) AS total_calculated_volume_type_2_q3\nFROM CalculatedMetrics AS T2\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS STRING)) as unique_fiscal_weeks,\n  COUNT(DISTINCT publication_name) as unique_publications,\n  COUNT(DISTINCT os_level_7) as unique_sales_channels,\n  MIN(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as earliest_fiscal_week_start,\n  MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) as latest_fiscal_week_end,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(fiscal_week_id AS STRING), gl_publication_code, os_level_7, day_of_week)) as approx_unique_data_grain_keys\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\n  AND upper(os.os_level_6) = 'CIRCULATION'\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(SAFE_CAST(volume AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as volume_test,\n  CASE WHEN COUNT(DISTINCT os.gl_publication_code) > 0 THEN 'PASS' ELSE 'FAIL' END as publication_code_test,\n  CASE WHEN MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as circulation_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Circulation Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END) as records_passing_circulation_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END), COUNT(*)) * 100 as circulation_filter_pass_rate_percentage,\n  'FY2025 Filter' as rule_name_2,\n  SUM(CASE WHEN gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) as records_passing_fy2025_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END), COUNT(*)) * 100 as fy2025_filter_pass_rate_percentage,\n  'Publication Exclusions' as rule_name_3,\n  SUM(CASE WHEN l04_publication_code <> 'Free News & Lifestyle' AND l06_publication_code NOT IN ('Food', 'Prestige') THEN 1 ELSE 0 END) as records_passing_pub_exclusions,\n  SAFE_DIVIDE(SUM(CASE WHEN l04_publication_code <> 'Free News & Lifestyle' AND l06_publication_code NOT IN ('Food', 'Prestige') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pub_exclusions_pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\nWHERE\n  SAFE_CAST(os.fiscal_week_id AS STRING) LIKE '2025%'\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) as fiscal_week_start_date,\n  os.fiscal_week_id,\n  os.gl_publication_code,\n  pub.publication_name,\n  os.os_level_7 AS sales_channel,\n  os.day_of_week,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) as actual_amount,\n  SAFE_CAST(os.volume AS NUMERIC) as volume,\n  SAFE_CAST(os.Budget_Volume AS NUMERIC) as budget_volume,\n  SAFE_CAST(os.Forecast_Volume AS NUMERIC) as forecast_volume,\n  SAFE_CAST(os.Last_Year_volume AS NUMERIC) as last_year_volume,\n  os.gl_hierarchy_code\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND upper(os.os_level_6) = 'CIRCULATION'\nORDER BY fiscal_week_start_date DESC, publication_name\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""2025-06-23 04:08:01.229999+00"",
          ""context"": ""Used as a reference date for calculating a specific fiscal week in Query 1."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date for `DATETIME_DIFF` calculations to determine fiscal week numbers in Query 1 and Query 3."",
          ""suggested_fix"": ""Replace with a configurable fiscal year start date or derive dynamically from calendar dimension."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-04"",
          ""original_format"": ""2025-06-04 07:28:59.451817+00"",
          ""context"": ""Used as a reference date for calculating fiscal week and day of week in Query 3."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CIRCULATION'"",
            ""'Free News & Lifestyle'"",
            ""'Food'"",
            ""'Prestige'"",
            ""'FY2025'""
          ],
          ""context"": ""Core filters applied to the base `OSandFACT` CTE, defining the scope of the dashboard."",
          ""suggested_governance"": ""These should ideally be managed in a configuration table or as dashboard parameters if they are subject to change."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Weekly Times'"",
            ""'Sunshine Coast'"",
            ""'Mackay'"",
            ""'All Sales Channels'"",
            ""'NT News'"",
            ""'Sunday Territorian'"",
            ""'Advertiser'"",
            ""'Post Courier'"",
            ""'The Daily Telegraph'"",
            ""'The Sunday Telegraph'"",
            ""'Herald Sun'"",
            ""'Sunday Herald Sun'"",
            ""'Mercury'"",
            ""'Sunday Tasmanian'"",
            ""'The Sportsman'"",
            ""'The Australian'"",
            ""'Cairns Post'"",
            ""'Ed Media'"",
            ""'Geelong Advertiser'"",
            ""'Gold Coast Bulletin'"",
            ""'Toowoomba'"",
            ""'Townsville Bulletin'"",
            ""'Sunday Mail (SA)'"",
            ""'Courier Mail'"",
            ""'Sunday Mail (QLD)'"",
            ""'The Sunday Mail'""
          ],
          ""context"": ""Extensive use of hardcoded publication names and sales channels for filtering and grouping."",
          ""suggested_governance"": ""Create and join to a `dim_publication_master` and `dim_sales_channel` table for consistent naming, grouping, and hierarchy management."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""48"",
            ""6"",
            ""7"",
            ""5"",
            ""2""
          ],
          ""context"": ""The number `48` is hardcoded as a divisor and month indicator in Query 3, overriding dynamic calculations. `6` and `7` are used as divisors for daily volume calculations. `5` and `2` are used in multiplication/division factors."",
          ""suggested_governance"": ""These divisors should be dynamically calculated (e.g., days in week/month) or stored in a business rule configuration table if they represent specific business logic (e.g., 6-day vs 7-day publications). The hardcoded `48` is particularly problematic as it makes the calculation static."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'(Actual Vs Budget Vs PY)'"",
            ""'M-F'"",
            ""'SAT'"",
            ""'Sun'"",
            ""'Weekday Entry'"",
            ""'Northern Territory'"",
            ""'Others'"",
            ""'PNG'"",
            ""'6 Day Pubs'"",
            ""'Mercury and Sunday Tas'"",
            ""'NT News & Sunday Territorian'"",
            ""'Regionals'""
          ],
          ""context"": ""Hardcoded strings used for categorizing publications or day types, often for display purposes."",
          ""suggested_governance"": ""These categories should be defined in a dimension table (e.g., `dim_publication_group`, `dim_day_type`) and joined, rather than hardcoded in `CASE WHEN` statements."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with dashboard date parameters (e.g., `_DS_START_DATE`, `_DS_END_DATE`) or BigQuery's `CURRENT_DATE()` and `DATE_SUB()` functions for relative date ranges."",
      ""Implement a fiscal calendar dimension table that can dynamically provide `fy_year_week_number`, `fy_year`, and `fiscal_week_id` based on a selected date, removing the need for hardcoded fiscal year values and complex date arithmetic."",
      ""Externalize publication grouping logic into a dedicated dimension table (`dim_publication_group`) that can be joined to the fact table, allowing for flexible and centralized management of publication hierarchies and categories."",
      ""Create a configuration table for business rules (e.g., `daily_volume_divisors`) to store values like '6 Day Pubs' or '7 Day Pubs' divisors, making calculations transparent and easily modifiable without changing SQL code."",
      ""Utilize dashboard controls for filtering on `publication_name`, `os_level_7`, and `publication_group` instead of hardcoding values in `WHERE` clauses or `CASE WHEN` statements.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_actual_amount_q1"",
      ""metric_name"": ""Total Actual Amount (Q1 Filtered)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of 'Actual_Amount' for a specific fiscal week (derived from 2025-06-23 relative to 2024-07-03), excluding specific publications ('Weekly Times', 'Sunshine Coast', 'Mackay'), and limited to 'All Sales Channels'. This represents the actual revenue or financial value for a tightly defined period and scope."",
      ""sql_logic"": ""SUM(CASE WHEN T2.q1_week_match_filter = TRUE AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' THEN T2.Actual_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_year_week_number matches calculated week for 2025-06-23"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A key financial performance indicator for circulation, focused on a specific, recent reporting period and core sales channels."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'"",
        ""'All Sales Channels'"",
        ""2025""
      ],
      ""governance_issues"": [
        ""Date calculations rely on hardcoded dates, making the query static and requiring manual updates."",
        ""Publication and sales channel filters are hardcoded, limiting flexibility and maintainability.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the freshness and completeness of `Actual_Amount` data.""
      ]
    },
    {
      ""metric_id"": ""total_volume_q1"",
      ""metric_name"": ""Total Volume (Q1 Filtered)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of 'volume' for the same specific fiscal week and filters as 'Total Actual Amount (Q1 Filtered)'. This represents the total circulation units for the defined period and scope."",
      ""sql_logic"": ""SUM(CASE WHEN T2.q1_week_match_filter = TRUE AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' THEN T2.volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_year_week_number matches calculated week for 2025-06-23"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A key operational performance indicator for circulation, showing the quantity of units distributed or sold."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-23"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'"",
        ""'All Sales Channels'"",
        ""2025""
      ],
      ""governance_issues"": [
        ""Date calculations rely on hardcoded dates, making the query static and requiring manual updates."",
        ""Publication and sales channel filters are hardcoded, limiting flexibility and maintainability.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the freshness and completeness of `volume` data.""
      ]
    },
    {
      ""metric_id"": ""publication_count_advertiser_q2"",
      ""metric_name"": ""Publication Count for 'Advertiser' Group"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Counts the number of distinct publications that fall into the 'Advertiser' group based on a complex grouping logic. This metric is likely used for a specific chart or filter related to publication categories."",
      ""sql_logic"": ""COUNT(DISTINCT CASE WHEN T2.publication_group_q2 = 'Advertiser' THEN T2.publication_name ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""publication_group_q2 = 'Advertiser'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of publications within a specific market segment ('Advertiser'), useful for understanding market coverage or specific campaign targeting."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Advertiser'"",
        ""'NT News'"",
        ""'Sunday Territorian'"",
        ""'Northern Territory'"",
        ""'Others'"",
        ""'The Daily Telegraph'"",
        ""'The Sunday Telegraph'"",
        ""'Herald Sun'"",
        ""'Sunday Herald Sun'"",
        ""'Mercury'"",
        ""'Sunday Tasmanian'"",
        ""'Post Courier'""
      ],
      ""governance_issues"": [
        ""Publication grouping logic is hardcoded, making it difficult to update or reuse across dashboards."",
        ""The dimension `'(Actual Vs Budget Vs PY)'` is a hardcoded string, not a data-driven dimension.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on consistent naming of `publication_name` and `publication_code`.""
      ]
    },
    {
      ""metric_id"": ""calculated_daily_volume_type_1_q3"",
      ""metric_name"": ""Total Calculated Daily Volume Type 1 (Q3 Filtered)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A complex calculated volume, representing an average daily volume. The base volume (Actual, Forecast, Last Year, or Budget) is selected based on fiscal month, then adjusted by a hardcoded divisor (48) and further divided by 6 or 7 days depending on publication type. Filtered for FY2025 up to a specific week (202548), excluding certain publications, and limited to 'All Sales Channels' and a specific list of publication groups."",
      ""sql_logic"": ""SUM(CASE WHEN T2.fy_year = 2025 AND T2.fy_year_week_number <= 202548 AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') THEN T2.q3_final_volume_type_1 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_year = 2025"",
        ""fy_year_week_number <= 202548"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'"",
        ""publication_group_q3_type_3 IN ('Geelong Advertiser', ..., 'Weekly Times')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Provides a normalized daily volume metric, accounting for different publication schedules (6-day vs 7-day) and potentially different volume types (Actual, Forecast, etc.) based on the reporting period. Crucial for comparing performance across diverse publications."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-04"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""48"",
        ""2025"",
        ""202548"",
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'"",
        ""'All Sales Channels'"",
        ""'Geelong Advertiser'"",
        ""'Mercury'"",
        ""'Sunday Tasmanian'"",
        ""'Sunshine Coast'"",
        ""'Sydney Suburbans'"",
        ""'The Australian'"",
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'"",
        ""'Toowoomba'"",
        ""'Townsville Bulletin'"",
        ""'Weekly Times'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Extremely complex and nested `CASE WHEN` logic for volume selection and calculation, making it hard to understand and maintain."",
        ""Hardcoded divisor `48` and other numbers introduce rigidity and potential inaccuracies."",
        ""Hardcoded publication groups and exclusions are difficult to manage."",
        ""Date logic for `fy_year_week_number <= 202548` is static.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on hardcoded divisors and month numbers may lead to misrepresentation if business rules change."",
        ""Complexity increases risk of subtle calculation errors.""
      ]
    },
    {
      ""metric_id"": ""calculated_daily_volume_type_2_q3"",
      ""metric_name"": ""Total Calculated Daily Volume Type 2 (Q3 Filtered)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Another complex calculated volume, similar to Type 1, also representing an average daily volume. It shares the same filtering criteria and base logic for volume selection and adjustment by the hardcoded divisor (48), differing primarily in the final division by 6 or 7 days based on publication type."",
      ""sql_logic"": ""SUM(CASE WHEN T2.fy_year = 2025 AND T2.fy_year_week_number <= 202548 AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') THEN T2.q3_final_volume_type_2 ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_year = 2025"",
        ""fy_year_week_number <= 202548"",
        ""publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
        ""os_level_7 = 'All Sales Channels'"",
        ""publication_group_q3_type_3 IN ('Geelong Advertiser', ..., 'Weekly Times')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Similar to Type 1, this metric provides a normalized daily volume, likely representing a slightly different calculation or a comparison point for Type 1, given their similar derivation."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-04"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""48"",
        ""2025"",
        ""202548"",
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'"",
        ""'All Sales Channels'"",
        ""'Geelong Advertiser'"",
        ""'Mercury'"",
        ""'Sunday Tasmanian'"",
        ""'Sunshine Coast'"",
        ""'Sydney Suburbans'"",
        ""'The Australian'"",
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'"",
        ""'Toowoomba'"",
        ""'Townsville Bulletin'"",
        ""'Weekly Times'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Shares the same governance issues as `calculated_daily_volume_type_1_q3` due to identical underlying logic and hardcoded values.""
      ],
      ""data_quality_concerns"": [
        ""Shares the same data quality concerns as `calculated_daily_volume_type_1_q3`.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""calculated_daily_volume_type_1_q3"",
      ""related_metrics"": [
        ""calculated_daily_volume_type_2_q3"",
        ""total_volume_q1""
      ],
      ""relationship_description"": ""Both 'Total Calculated Daily Volume Type 1' and 'Type 2' are derived from base volume metrics (like `volume`, `Forecast_Volume`) by applying complex conditional logic, division by a hardcoded '48', and then further division by 6 or 7 based on publication type. They represent different ways of normalizing volume to a daily average. 'Total Volume (Q1 Filtered)' is a direct sum of raw volume for a specific period, serving as a foundational metric."",
      ""mathematical_formula"": ""Calculated_Daily_Volume = (Base_Volume / 48) / (6 or 7 days, conditionally)"",
      ""business_validation"": ""These metrics aim to provide comparable daily volume figures across different publications and reporting periods, accounting for variations in publication schedules (e.g., 6-day vs. 7-day publications). The relationship highlights the need for clear definitions of 'daily volume' in a business context."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN T2.fy_year = 2025 AND T2.fy_year_week_number <= 202548 AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') THEN T2.q3_final_volume_type_1 ELSE 0 END) AS total_calculated_volume_type_1_q3,\n  SUM(CASE WHEN T2.fy_year = 2025 AND T2.fy_year_week_number <= 202548 AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') THEN T2.q3_final_volume_type_2 ELSE 0 END) AS total_calculated_volume_type_2_q3,\n  SUM(CASE WHEN T2.q1_week_match_filter = TRUE AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' THEN T2.volume ELSE 0 END) AS total_volume_q1\nFROM CalculatedMetrics AS T2\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount_q1"",
      ""related_metrics"": [
        ""total_volume_q1"",
        ""publication_count_advertiser_q2"",
        ""calculated_daily_volume_type_1_q3"",
        ""calculated_daily_volume_type_2_q3""
      ],
      ""relationship_description"": ""All metrics share common base filters from the `OSandFACT` CTE (e.g., `os_level_6 = 'CIRCULATION'`, `gl_hierarchy_code = 'FY2025'`). However, each metric then applies additional, distinct filters (e.g., specific fiscal week, publication exclusions, sales channel, publication groups). This means that while they draw from the same underlying data, their final aggregated values are not directly comparable without understanding their specific filter contexts."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Understanding the specific filters applied to each metric is crucial for accurate interpretation and comparison. Misinterpreting the scope of each metric could lead to incorrect business decisions."",
      ""validation_sql"": ""SELECT\n  'Filter Overlap Analysis' as analysis_type,\n  SUM(CASE WHEN T2.q1_week_match_filter = TRUE AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' THEN 1 ELSE 0 END) AS q1_filtered_records,\n  SUM(CASE WHEN T2.publication_group_q2 = 'Advertiser' THEN 1 ELSE 0 END) AS q2_filtered_records,\n  SUM(CASE WHEN T2.fy_year = 2025 AND T2.fy_year_week_number <= 202548 AND T2.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay') AND T2.os_level_7 = 'All Sales Channels' AND T2.publication_group_q3_type_3 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times') THEN 1 ELSE 0 END) AS q3_filtered_records\nFROM CalculatedMetrics AS T2\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,5
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f65a9149-93b4-4aa9-aef6-d12002853222"",
    ""dashboard_name"": ""Digital Video Content Audio"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 4,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fin_adtype_name"",
      ""revenue_transaction_status"",
      ""sales_segment_l_2_name_sync"",
      ""source_publishing_division"",
      ""booking_number"",
      ""financial_year"",
      ""adsize_name""
    ],
    ""date_range_detected"": ""FY2025 to FY2026"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""2026""
    ],
    ""hardcoded_values_found"": [
      ""Booked"",
      ""Billed"",
      ""Medium Rare Content Agency"",
      ""Audio (Targeted)"",
      ""Audio (Non-Targeted)"",
      ""Events (Non-Targeted)"",
      ""Events (Targeted)"",
      ""Rich Media (Non-Targeted)"",
      ""Rich Media (Targeted)"",
      ""Social Display (Targeted)"",
      ""Social Display (Non-Targeted)"",
      ""Standard Display (Targeted)"",
      ""Standard Display (Non-Targeted)"",
      ""TTIV (Targeted)"",
      ""TTIV (Non-Targeted)"",
      ""Content Discovery (Non-Targeted)"",
      ""Content Discovery (Targeted)"",
      ""Native (Non-Targeted)"",
      ""Native (Targeted)""
    ],
    ""governance_opportunities"": [
      ""financial_year should be dynamic (e.g., derived from CURRENT_DATE() or a parameter)"",
      ""revenue_transaction_status values should be managed via a lookup table or parameter"",
      ""source_publishing_division values should be managed via a lookup table or parameter"",
      ""fin_adtype_name values should be managed via a lookup table or parameter""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.fin_adtype_name,\n    t0.revenue_transaction_status,\n    t0.sales_segment_l_2_name_sync,\n    t0.source_publishing_division,\n    t0.booking_number,\n    t0.financial_year,\n    t0.adsize_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    SAFE_CAST(t0.revenue_transaction_status AS STRING) IN ('Booked', 'Billed')\n    AND (SAFE_CAST(t0.source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND SAFE_CAST(t0.financial_year AS STRING) IN ('2025', '2026')\n    AND SAFE_CAST(t0.fin_adtype_name AS STRING) IN (\n      'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n      'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n      'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)',\n      'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n    )\n)\nSELECT\n  fin_adtype_name,\n  revenue_transaction_status,\n  sales_segment_l_2_name_sync,\n  source_publishing_division,\n  financial_year,\n  adsize_name,\n  COUNT(DISTINCT booking_number) AS distinct_booking_numbers,\n  COUNT(*) AS total_records_matching_filters\nFROM base_data\nGROUP BY\n  fin_adtype_name,\n  revenue_transaction_status,\n  sales_segment_l_2_name_sync,\n  source_publishing_division,\n  financial_year,\n  adsize_name\nORDER BY\n  financial_year DESC, distinct_booking_numbers DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(booking_number AS STRING)) as unique_booking_numbers,\n  COUNT(DISTINCT SAFE_CAST(fin_adtype_name AS STRING)) as unique_ad_types,\n  COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) as unique_sales_segments,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as records_exist_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(booking_number AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as distinct_bookings_exist_test,\n  CASE WHEN MAX(SAFE_CAST(financial_year AS STRING)) >= SAFE_CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS STRING) THEN 'PASS' ELSE 'FAIL' END as freshness_test_current_year,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'revenue_status_filter_coverage' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_matching_status_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as status_filter_match_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'medium_rare_exclusion_coverage' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL THEN 1 ELSE 0 END) as records_matching_exclusion_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(source_publishing_division AS STRING) != 'Medium Rare Content Agency' OR source_publishing_division IS NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as exclusion_filter_match_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'fin_adtype_name_filter_coverage' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IN (\n      'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n      'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n      'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)',\n      'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n    ) THEN 1 ELSE 0 END) as records_matching_adtype_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(fin_adtype_name AS STRING) IN (\n      'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n      'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n      'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)',\n      'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n    ) THEN 1 ELSE 0 END), COUNT(*)) * 100 as adtype_filter_match_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026');"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  SAFE_CAST(booking_number AS STRING) AS booking_number,\n  SAFE_CAST(fin_adtype_name AS STRING) AS fin_adtype_name,\n  SAFE_CAST(revenue_transaction_status AS STRING) AS revenue_transaction_status,\n  SAFE_CAST(sales_segment_l_2_name_sync AS STRING) AS sales_segment_l_2_name_sync,\n  SAFE_CAST(source_publishing_division AS STRING) AS source_publishing_division,\n  SAFE_CAST(adsize_name AS STRING) AS adsize_name\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2025', '2026')\n  AND SAFE_CAST(revenue_transaction_status AS STRING) IN ('Booked', 'Billed')\nORDER BY financial_year DESC, booking_number DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Used as a financial year filter in multiple queries."",
          ""suggested_fix"": ""Replace with a dynamic calculation (e.g., EXTRACT(YEAR FROM CURRENT_DATE())) or a dashboard parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2026"",
          ""original_format"": ""2026"",
          ""context"": ""Used as a financial year filter in multiple queries."",
          ""suggested_fix"": ""Replace with a dynamic calculation (e.g., EXTRACT(YEAR FROM CURRENT_DATE()) + 1) or a dashboard parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""Transaction statuses used to filter revenue records."",
          ""suggested_governance"": ""Store valid transaction statuses in a governed lookup table and join or use a parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""Specific publishing division excluded from analysis."",
          ""suggested_governance"": ""Store excluded divisions in a governed lookup table or use a parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Audio (Targeted)'"",
            ""'Audio (Non-Targeted)'"",
            ""'Events (Non-Targeted)'"",
            ""'Events (Targeted)'"",
            ""'Rich Media (Non-Targeted)'"",
            ""'Rich Media (Targeted)'"",
            ""'Social Display (Targeted)'"",
            ""'Social Display (Non-Targeted)'"",
            ""'Standard Display (Targeted)'"",
            ""'Standard Display (Non-Targeted)'"",
            ""'TTIV (Targeted)'"",
            ""'TTIV (Non-Targeted)'"",
            ""'Content Discovery (Non-Targeted)'"",
            ""'Content Discovery (Targeted)'"",
            ""'Native (Non-Targeted)'"",
            ""'Native (Targeted)'""
          ],
          ""context"": ""Specific ad type names used to filter content."",
          ""suggested_governance"": ""Store valid ad types in a governed lookup table and join or use a parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years ('2025', '2026') with dynamic date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values for `revenue_transaction_status`, `source_publishing_division`, and `fin_adtype_name` with joins to governed reference tables or dashboard parameters for flexibility and maintainability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""sales_segment_l2_name_sync"",
      ""metric_name"": ""Sales Segment Level 2 Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the synchronized name of the sales segment at level 2, used for categorizing sales."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment ad sales revenue by sales team or client segment for reporting and analysis."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""Booked"",
        ""Billed"",
        ""Medium Rare Content Agency"",
        ""Audio (Targeted)"",
        ""Audio (Non-Targeted)"",
        ""Events (Non-Targeted)"",
        ""Events (Targeted)"",
        ""Rich Media (Non-Targeted)"",
        ""Rich Media (Targeted)"",
        ""Social Display (Targeted)"",
        ""Social Display (Non-Targeted)"",
        ""Standard Display (Targeted)"",
        ""Standard Display (Non-Targeted)"",
        ""TTIV (Targeted)"",
        ""TTIV (Non-Targeted)""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for revenue_transaction_status, source_publishing_division, and fin_adtype_name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_number"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an advertising booking."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)')"",
        ""financial_year IN ('2026', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to identify specific ad sales transactions, likely for drill-down or detailed reporting."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2026"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""Content Discovery (Non-Targeted)"",
        ""Content Discovery (Targeted)"",
        ""Native (Non-Targeted)"",
        ""Native (Targeted)""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for fin_adtype_name and financial_year.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adsize_name"",
      ""metric_name"": ""Ad Size Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Describes the size or format of the advertisement."",
      ""sql_logic"": ""t0.adsize_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze ad performance or revenue by ad format."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""Booked"",
        ""Billed"",
        ""Medium Rare Content Agency"",
        ""Audio (Non-Targeted)"",
        ""Audio (Targeted)"",
        ""Events (Non-Targeted)"",
        ""Native (Non-Targeted)"",
        ""Native (Targeted)"",
        ""Rich Media (Non-Targeted)"",
        ""Rich Media (Targeted)"",
        ""Social Display (Non-Targeted)"",
        ""Social Display (Targeted)"",
        ""Standard Display (Non-Targeted)"",
        ""Standard Display (Targeted)"",
        ""TTIV (Targeted)"",
        ""TTIV (Non-Targeted)""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for revenue_transaction_status, source_publishing_division, fin_adtype_name, and financial_year.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""record_count"",
      ""metric_name"": ""Record Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The number of records matching the applied filters for a given dimension value."",
      ""sql_logic"": ""COUNT(*)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""Varies per query, as inherited from the dimensions it counts.""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides context for the frequency of specific dimension values, often used for populating dropdowns or distinct lists."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Inherits governance issues from the dimensions it counts.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""sales_segment_l2_name_sync"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""fin_adtype_name""
      ],
      ""relationship_description"": ""The values and counts of 'Sales Segment Level 2 Name Sync' are directly filtered by specific 'Revenue Transaction Status', exclusion of 'Medium Rare Content Agency' from 'Source Publishing Division', and a predefined list of 'Financial Ad Type Names'."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that sales segment analysis focuses only on booked/billed revenue, excludes specific content agencies, and targets relevant ad types."",
      ""validation_sql"": ""See business_rules_sql for filter coverage validation."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""booking_number"",
      ""related_metrics"": [
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""The distinct 'Booking Numbers' are filtered to specific 'Financial Ad Type Names' (Content Discovery, Native) and specific 'Financial Years' (2025, 2026)."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that booking number analysis is restricted to relevant ad types and recent financial periods."",
      ""validation_sql"": ""See business_rules_sql for filter coverage validation."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""adsize_name"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""The values and counts of 'Ad Size Name' are filtered by specific 'Revenue Transaction Status', exclusion of 'Medium Rare Content Agency' from 'Source Publishing Division', a predefined list of 'Financial Ad Type Names', and the 'Financial Year' 2025."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that ad size analysis focuses only on booked/billed revenue, excludes specific content agencies, targets relevant ad types, and is limited to the specified financial year."",
      ""validation_sql"": ""See business_rules_sql for filter coverage validation."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,6
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""61f1feb4-fc3e-4bee-b987-84c86cfe6425"",
    ""dashboard_name"": ""Digital - Publications and Products Monthly "",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""revenue_group_subtype"",
      ""unified_publication_name"",
      ""revenue_type""
    ],
    ""date_range_detected"": ""2024 to 2025 (hardcoded)"",
    ""hardcoded_dates_found"": [
      ""2024"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'DIGITAL'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'DIGITAL (excl.XTEND)'"",
      ""'PRINT'"",
      ""'XTEND ONLY'"",
      ""'XTEND'"",
      ""'Y'"",
      ""'digital'""
    ],
    ""governance_opportunities"": [
      ""financial_year should be parameterised or use relative date logic (e.g., CURRENT_FINANCIAL_YEAR)"",
      ""revenue_group_subtype values should be sourced from a governed lookup table"",
      ""revenue_type and xtend_flag derived logic should be defined in a central business rule catalog or view"",
      ""The filter value 'digital' should match the case of the derived dimension 'DIGITAL (excl.XTEND)' or use case-insensitive comparison.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.revenue_group_subtype,\n    t0.unified_publication_name,\n    t0.revenue_type,\n    t0.xtend_flag,\n    t0.dw_asl_load_timestamp,\n    -- Assuming a 'revenue' column exists for a finance dashboard\n    SAFE_CAST(t0.revenue AS NUMERIC) AS revenue_amount, -- Placeholder for actual revenue metric\n    -- Assuming a unique identifier for counting records/transactions\n    t0.transaction_id -- Placeholder for a transaction ID\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n),\ncalculated_dimensions AS (\n  SELECT\n    financial_year,\n    revenue_group_subtype,\n    unified_publication_name,\n    revenue_type,\n    xtend_flag,\n    dw_asl_load_timestamp,\n    revenue_amount,\n    transaction_id,\n    CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_derived,\n    MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) OVER () AS min_dw_asl_load_timestamp_overall -- Data freshness metric\n  FROM base_data\n)\nSELECT\n  financial_year,\n  revenue_group_subtype,\n  unified_publication_name,\n  revenue_type,\n  xtend_flag,\n  revenue_type_derived,\n  CASE\n    WHEN (revenue_type_derived = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)'\n    WHEN (revenue_type_derived = 'PRINT') THEN 'PRINT'\n    WHEN (revenue_type_derived = 'XTEND') THEN 'XTEND ONLY'\n    ELSE NULL\n  END AS revenue_group_type_derived,\n  min_dw_asl_load_timestamp_overall,\n  COUNT(DISTINCT transaction_id) AS total_transactions, -- Inferred metric\n  SUM(revenue_amount) AS total_revenue_amount, -- Inferred metric\n  COUNT(*) AS record_count -- Basic record count\nFROM calculated_dimensions\nWHERE\n  financial_year IN ('2024', '2025')\n  AND revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')\n  -- Note: The original query had 'digital' which might not match 'DIGITAL (excl.XTEND)'. Assuming case-insensitivity or intended match.\n  AND (CASE WHEN (revenue_type_derived = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)' WHEN (revenue_type_derived = 'PRINT') THEN 'PRINT' WHEN (revenue_type_derived = 'XTEND') THEN 'XTEND ONLY' ELSE NULL END) IN ('DIGITAL (excl.XTEND)')\nGROUP BY\n  financial_year,\n  revenue_group_subtype,\n  unified_publication_name,\n  revenue_type,\n  xtend_flag,\n  revenue_type_derived,\n  revenue_group_type_derived,\n  min_dw_asl_load_timestamp_overall\nORDER BY\n  financial_year DESC,\n  unified_publication_name ASC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) AS unique_financial_years,\n  COUNT(DISTINCT revenue_group_subtype) AS unique_revenue_group_subtypes,\n  COUNT(DISTINCT unified_publication_name) AS unique_unified_publication_names,\n  COUNT(DISTINCT revenue_type) AS unique_revenue_types,\n  COUNT(DISTINCT xtend_flag) AS unique_xtend_flags,\n  MIN(dw_asl_load_timestamp) AS earliest_load_timestamp,\n  MAX(dw_asl_load_timestamp) AS latest_load_timestamp\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS data_exists_test,\n  CASE WHEN MAX(dw_asl_load_timestamp) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 1 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(DISTINCT unified_publication_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS publication_name_test,\n  CASE WHEN COUNT(DISTINCT revenue_group_subtype) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_subtype_test,\n  CASE WHEN SUM(CASE WHEN financial_year IS NULL THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END AS financial_year_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH derived_data AS (\n  SELECT\n    financial_year,\n    revenue_group_subtype,\n    revenue_type,\n    xtend_flag,\n    CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_derived\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\n  WHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\n)\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'revenue_group_subtype_filter' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE') THEN 1 ELSE 0 END) AS records_passing_subtype_filter,\n  'revenue_type_derived_logic' AS rule_name_2,\n  SUM(CASE WHEN (xtend_flag = 'Y' AND revenue_type_derived = 'XTEND') OR (xtend_flag != 'Y' AND revenue_type_derived = revenue_type) THEN 1 ELSE 0 END) AS records_passing_revenue_type_derived_logic,\n  'revenue_group_type_derived_logic_digital_match' AS rule_name_3,\n  SUM(CASE WHEN (CASE WHEN (revenue_type_derived = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)' WHEN (revenue_type_derived = 'PRINT') THEN 'PRINT' WHEN (revenue_type_derived = 'XTEND') THEN 'XTEND ONLY' ELSE NULL END) = 'DIGITAL (excl.XTEND)' THEN 1 ELSE 0 END) AS records_matching_digital_derived_type\nFROM derived_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  revenue_group_subtype,\n  unified_publication_name,\n  revenue_type,\n  xtend_flag,\n  dw_asl_load_timestamp\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(financial_year AS STRING) IN ('2024', '2025')\nORDER BY dw_asl_load_timestamp DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024"",
          ""original_format"": ""'2024'"",
          ""context"": ""financial_year filter"",
          ""suggested_fix"": ""replace with a parameter or relative financial year calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""financial_year filter"",
          ""suggested_fix"": ""replace with a parameter or relative financial year calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DIGITAL'"",
            ""'PROGRAMMATIC EXCHANGE'"",
            ""'PROGRAMMATIC SOURCE'""
          ],
          ""context"": ""revenue_group_subtype filter"",
          ""suggested_governance"": ""join to a `revenue_group_subtype_lookup` table or use a parameter for selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'DIGITAL (excl.XTEND)'"",
            ""'PRINT'"",
            ""'XTEND ONLY'"",
            ""'XTEND'"",
            ""'Y'""
          ],
          ""context"": ""CASE statements for derived dimensions and xtend_flag comparison"",
          ""suggested_governance"": ""Define these business rules in a central configuration table or view, or use parameters for 'Y' flag."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'digital'""
          ],
          ""context"": ""Filter on derived dimension `clmn5_` (revenue_group_type_derived). This value ('digital') does not directly match the output of the CASE statement ('DIGITAL (excl.XTEND)'). This could be a case-sensitivity issue or a logical mismatch."",
          ""suggested_governance"": ""Ensure case consistency or use `LOWER()` for comparison. Ideally, filter against a governed list of derived types."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years ('2024', '2025') with date parameters or relative date functions (e.g., `_DS_FINANCIAL_YEAR_START`, `_DS_FINANCIAL_YEAR_END`)."",
      ""Replace hardcoded revenue group subtypes with parameters or a join to a lookup table."",
      ""Externalize the logic for derived dimensions (e.g., `revenue_type_derived`, `revenue_group_type_derived`) into a governed view or configuration table to avoid hardcoding in multiple queries."",
      ""Ensure consistent casing for string comparisons or use `LOWER()`/`UPPER()` functions.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the ad sales performance record."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping ad sales data by financial period."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of revenue based on its specific subtype (e.g., DIGITAL, PROGRAMMATIC EXCHANGE)."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and analyzing revenue performance by specific revenue channels."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The standardized name of the publication associated with the ad sales."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing ad sales performance across different publications."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw revenue type from the source system (e.g., DIGITAL, PRINT)."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as an input for deriving more business-friendly revenue categorizations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""xtend_flag"",
      ""metric_name"": ""XTEND Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag indicating if the revenue is associated with 'XTEND' (Y/N)."",
      ""sql_logic"": ""t0.xtend_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to differentiate XTEND revenue from other revenue types."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_derived"",
      ""metric_name"": ""Revenue Type Derived"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""business_description"": ""A derived categorization of revenue type, where 'XTEND' overrides the original revenue_type if the xtend_flag is 'Y'."",
      ""sql_logic"": ""CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Intermediate dimension used to create the final `revenue_group_type_derived` for reporting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""Business logic for derivation is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_type_derived"",
      ""metric_name"": ""Revenue Group Type Derived"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_type_derived""
      ],
      ""business_description"": ""The final business-friendly grouping of revenue types for reporting, including 'DIGITAL (excl.XTEND)', 'PRINT', and 'XTEND ONLY'."",
      ""sql_logic"": ""CASE WHEN (revenue_type_derived = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)' WHEN (revenue_type_derived = 'PRINT') THEN 'PRINT' WHEN (revenue_type_derived = 'XTEND') THEN 'XTEND ONLY' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for high-level revenue categorization in the dashboard."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'DIGITAL (excl.XTEND)'"",
        ""'PRINT'"",
        ""'XTEND'"",
        ""'XTEND ONLY'""
      ],
      ""governance_issues"": [
        ""Business logic for derivation is hardcoded."",
        ""Filter value 'digital' in query 2 might not match derived output due to case sensitivity.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dw_asl_load_timestamp"",
      ""metric_name"": ""DW ASL Load Timestamp"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp when the ad sales performance record was loaded into the data warehouse."",
      ""sql_logic"": ""t0.dw_asl_load_timestamp"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Used primarily for data freshness checks."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""min_dw_asl_load_timestamp"",
      ""metric_name"": ""Minimum DW ASL Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""overall"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""dw_asl_load_timestamp""
      ],
      ""business_description"": ""The earliest load timestamp across all records, indicating the freshness of the data in the dashboard."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Critical for monitoring data pipeline health and ensuring users are viewing up-to-date information."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Depends on the accuracy of the source system's load timestamp.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_type_derived"",
      ""related_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""relationship_description"": ""The 'Revenue Type Derived' is calculated based on the raw 'Revenue Type' and the 'XTEND Flag'. If 'XTEND Flag' is 'Y', then 'Revenue Type Derived' becomes 'XTEND', otherwise it retains the original 'Revenue Type'."",
      ""mathematical_formula"": ""revenue_type_derived = IF(xtend_flag = 'Y', 'XTEND', revenue_type)"",
      ""business_validation"": ""Ensures that XTEND revenue is consistently categorized regardless of its original revenue type, which is crucial for specific reporting needs."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (xtend_flag = 'Y' AND (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) != 'XTEND') OR (xtend_flag != 'Y' AND (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END) != revenue_type);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_group_type_derived"",
      ""related_metrics"": [
        ""revenue_type_derived""
      ],
      ""relationship_description"": ""The 'Revenue Group Type Derived' is a further categorization based on the 'Revenue Type Derived'. It maps 'DIGITAL' to 'DIGITAL (excl.XTEND)', 'PRINT' to 'PRINT', and 'XTEND' to 'XTEND ONLY'."",
      ""mathematical_formula"": ""revenue_group_type_derived = CASE WHEN revenue_type_derived = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN revenue_type_derived = 'PRINT' THEN 'PRINT' WHEN revenue_type_derived = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END"",
      ""business_validation"": ""Provides a simplified and business-specific grouping for high-level analysis, separating XTEND revenue and explicitly marking digital revenue that is not XTEND."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0 WHERE (CASE WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) IS NULL AND (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) IS NOT NULL AND (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) NOT IN ('DIGITAL', 'PRINT', 'XTEND');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""unified_publication_name"",
      ""related_metrics"": [
        ""financial_year"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""The list of 'Unified Publication Name' displayed is filtered by specific 'Financial Year' (2024, 2025) and 'Revenue Group Subtype' ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that users only see publication names relevant to the current and next financial year, and specific digital/programmatic revenue streams."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT unified_publication_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year NOT IN ('2024', '2025') OR revenue_group_subtype NOT IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""revenue_group_subtype"",
      ""related_metrics"": [
        ""financial_year"",
        ""revenue_group_type_derived""
      ],
      ""relationship_description"": ""The list of 'Revenue Group Subtype' is filtered by specific 'Financial Year' (2024, 2025) and where the 'Revenue Group Type Derived' is 'DIGITAL (excl.XTEND)' (based on the original query's 'digital' filter)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Limits the displayed revenue subtypes to those relevant for the specified financial years and digital revenue categories."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0 WHERE financial_year NOT IN ('2024', '2025') OR (CASE WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) != 'DIGITAL (excl.XTEND)';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,7
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d3bcf796-2396-4a6f-b0a3-da0b7f299a58"",
    ""dashboard_name"": ""Publisher and Product Performance Dashboard - FY25 v2"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""advertiser_group"",
      ""product_group"",
      ""fin_adtype_name"",
      ""financial_week""
    ],
    ""date_range_detected"": ""Not explicitly detected from provided queries (queries fetch distinct dimension values, not time-series data)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Commercial Content'"",
      ""'Free News & Lifestyle'"",
      ""'State & Communities'"",
      ""'The Australian & Prestige'"",
      ""'Unknown'"",
      ""'' (empty string)""
    ],
    ""governance_opportunities"": [
      ""Product group values should be managed via a lookup table instead of hardcoded in queries."",
      ""Consider standardizing 'Unknown' and empty string values for product_group.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN --\n-- Note: The provided SQL queries only extract distinct dimension values for filters.\n-- This consolidated query assumes typical 'adsales_performance' metrics (e.g., revenue, volume)\n-- and a 'report_date' column for time-based filtering, which are not explicitly in the input queries.\n-- Adjust metric and date column names if they differ in the actual table.\n\nWITH base_data AS (\n  SELECT\n    t0.advertiser_group,\n    t0.product_group,\n    t0.fin_adtype_name,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week,\n    -- Assuming these are typical metrics for 'adsales_performance'\n    SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount, -- Placeholder metric\n    SAFE_CAST(t0.ad_volume AS NUMERIC) AS ad_volume, -- Placeholder metric\n    -- Assuming a 'report_date' column exists for general date filtering\n    SAFE_CAST(t0.report_date AS DATE) AS report_date\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Filter for recent data\n    AND t0.product_group IS NOT NULL -- Exclude null product groups for general analysis\n    AND t0.product_group != 'Unknown' -- Exclude 'Unknown' product groups for general analysis\n)\nSELECT\n  financial_week,\n  advertiser_group,\n  product_group,\n  fin_adtype_name,\n  COUNT(*) AS record_count,\n  SUM(revenue_amount) AS total_revenue,\n  SUM(ad_volume) AS total_ad_volume,\n  SAFE_DIVIDE(SUM(revenue_amount), SUM(ad_volume)) AS revenue_per_ad_volume\nFROM base_data\nWHERE\n  product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige') -- Example filter from query 1\nGROUP BY\n  financial_week,\n  advertiser_group,\n  product_group,\n  fin_adtype_name\nORDER BY\n  financial_week DESC, total_revenue DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_week AS INT64)) AS unique_financial_weeks,\n  MIN(SAFE_CAST(t0.financial_week AS INT64)) AS earliest_financial_week,\n  MAX(SAFE_CAST(t0.financial_week AS INT64)) AS latest_financial_week,\n  COUNT(DISTINCT t0.advertiser_group) AS unique_advertiser_groups,\n  COUNT(DISTINCT t0.product_group) AS unique_product_groups,\n  COUNT(DISTINCT t0.fin_adtype_name) AS unique_fin_adtype_names,\n  -- Assuming a 'report_date' column for general date range\n  MIN(SAFE_CAST(t0.report_date AS DATE)) AS earliest_report_date,\n  MAX(SAFE_CAST(t0.report_date AS DATE)) AS latest_report_date\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Limit scan for recent data"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_group) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_group_test,\n  CASE WHEN COUNT(DISTINCT t0.product_group) > 0 THEN 'PASS' ELSE 'FAIL' END AS product_group_test,\n  CASE WHEN COUNT(DISTINCT t0.fin_adtype_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS fin_adtype_name_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.financial_week AS INT64)) > 0 THEN 'PASS' ELSE 'FAIL' END AS financial_week_test,\n  -- Check for presence of specific hardcoded product groups\n  SUM(CASE WHEN t0.product_group = 'Free News & Lifestyle' THEN 1 ELSE 0 END) AS free_news_lifestyle_count,\n  SUM(CASE WHEN t0.product_group = 'Unknown' THEN 1 ELSE 0 END) AS unknown_product_group_count,\n  -- Assuming a 'report_date' column for freshness\n  MAX(SAFE_CAST(t0.report_date AS DATE)) AS latest_report_date\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) -- Check recent data"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'product_group_distribution' AS rule_name,\n  t0.product_group,\n  COUNT(*) AS record_count,\n  SAFE_DIVIDE(COUNT(*), SUM(COUNT(*)) OVER()) * 100 AS percentage_of_total\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Limit scan for recent data\nGROUP BY t0.product_group\nORDER BY record_count DESC;"",
    ""sample_data_sql"": ""SELECT\n  t0.advertiser_group,\n  t0.product_group,\n  t0.fin_adtype_name,\n  SAFE_CAST(t0.financial_week AS INT64) AS financial_week,\n  -- Assuming typical metrics for 'adsales_performance'\n  SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount, -- Placeholder metric\n  SAFE_CAST(t0.ad_volume AS NUMERIC) AS ad_volume, -- Placeholder metric\n  SAFE_CAST(t0.report_date AS DATE) AS report_date -- Assuming a 'report_date' column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Get recent sample\nORDER BY SAFE_CAST(t0.report_date AS DATE) DESC, SAFE_CAST(t0.financial_week AS INT64) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Commercial Content'"",
            ""'Free News & Lifestyle'"",
            ""'State & Communities'"",
            ""'The Australian & Prestige'"",
            ""''""
          ],
          ""context"": ""Used in WHERE clause for product_group filtering in query 1 and 3."",
          ""suggested_governance"": ""These product group categories should be stored in a reference table (e.g., `dim_product_group`) and joined to the main table, or managed as parameters."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Unknown'""
          ],
          ""context"": ""Used in WHERE clause for product_group exclusion in query 2."",
          ""suggested_governance"": ""Standardize 'Unknown' values or handle them consistently via a data quality process. If 'Unknown' is a valid category, it should be part of the `dim_product_group` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded product group values with parameters in Looker Studio or join to a governed `dim_product_group` reference table."",
      ""Implement a data quality process to standardize `product_group` values, especially 'Unknown' and empty strings.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorizes advertisers into predefined groups for reporting and analysis."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used primarily for filtering and grouping ad sales performance data by advertiser segment in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Commercial Content'"",
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Associated product_group filter values are hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""Potential for inconsistent product_group values if not governed.""
      ]
    },
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Classifies products into logical groups, serving as a key segmentation dimension for ad sales."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A fundamental dimension used across multiple queries to filter and segment data, impacting the scope of other dimensions and metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Commercial Content'"",
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""'The Australian & Prestige'"",
        ""'Unknown'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Values are hardcoded across multiple queries, making maintenance difficult and prone to errors."",
        ""Inconsistent handling of 'Unknown' and empty string values.""
      ],
      ""data_quality_concerns"": [
        ""Presence of 'Unknown' or empty string values may indicate data quality issues or incomplete categorization.""
      ]
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Provides the name of the financial advertisement type, used for detailed segmentation."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group NOT IN ('Unknown') OR product_group IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping ad sales performance by specific ad type, providing granular insights."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""Associated product_group filter value 'Unknown' is hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on 'Unknown' product_group for exclusion, which might evolve.""
      ]
    },
    {
      ""metric_id"": ""financial_week"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the financial week identifier, used for time-based analysis and filtering."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Free News & Lifestyle', 'State & Communities', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A critical time dimension for analyzing trends and performance over financial weeks."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Associated product_group filter values are hardcoded."",
        ""Reliance on `SAFE_CAST` suggests potential mixed data types for `financial_week` in source.""
      ],
      ""data_quality_concerns"": [
        ""Non-numeric values in `financial_week` could lead to `NULL`s after `SAFE_CAST`.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""product_group"",
      ""related_metrics"": [
        ""advertiser_group"",
        ""fin_adtype_name"",
        ""financial_week""
      ],
      ""relationship_description"": ""The 'product_group' dimension acts as a primary filter for the values displayed for 'advertiser_group', 'fin_adtype_name', and 'financial_week'. Different selections of 'product_group' will yield different sets of values for these other dimensions."",
      ""mathematical_formula"": ""N/A (filter relationship)"",
      ""business_validation"": ""Ensures that the displayed advertiser groups, ad types, and financial weeks are relevant to the selected product categories, aligning with specific business segments."",
      ""validation_sql"": ""-- Example validation for product_group filter impact on advertiser_group\nSELECT\n  COUNT(DISTINCT t0.advertiser_group) AS total_advertiser_groups,\n  COUNT(DISTINCT CASE WHEN t0.product_group IN ('Commercial Content', 'Free News & Lifestyle') THEN t0.advertiser_group END) AS filtered_advertiser_groups\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,8
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6f1c8731-02da-464f-b146-bf2947860735"",
    ""dashboard_name"": ""Programmatic Sales_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month"",
    ""business_domain"": ""advertising|sales"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""PortfolioParentGroup"",
      ""PortfolioChildGroup"",
      ""TransactionType"",
      ""FinancialYear"",
      ""FinancialQuarter"",
      ""FinancialMonthNumber"",
      ""FinancialPeriod"",
      ""MonthStartDate""
    ],
    ""date_range_detected"": ""FY2025 Q4 (up to 2025-06-26)"",
    ""hardcoded_dates_found"": [
      ""2025-06-26""
    ],
    ""hardcoded_values_found"": [
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'Guaranteed'"",
      ""'FY2025 - Q4'"",
      ""'CONSORTIUM VIC'"",
      ""'Deal'"",
      ""'VIC CON B3'"",
      ""'VIC CON B2'"",
      ""'VIC CON B1'"",
      ""Fiscal Month Mapping (1->7, 2->8, ..., 12->6)""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE()) instead of hardcoded values."",
      ""Lookup values for Portfolio Groups, Transaction Types, and Financial Periods should be managed in governed reference tables."",
      ""The fiscal month mapping logic should be externalized into a configuration table or a UDF for easier maintenance and transparency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  base_data AS (\n    SELECT\n      t0.Advertiser,\n      t0.PortfolioParentGroup,\n      t0.PortfolioChildGroup,\n      t0.RevenueGross,\n      t0.TransactionType,\n      t0.FinancialQuarter,\n      t0.FinancialYear,\n      t0.FinancialMonthNumber\n    FROM\n      `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n  ),\n  calculated_dimensions AS (\n    SELECT\n      Advertiser,\n      PortfolioParentGroup,\n      PortfolioChildGroup,\n      SAFE_CAST(RevenueGross AS NUMERIC) AS RevenueGross,\n      TransactionType,\n      FinancialQuarter,\n      FinancialYear,\n      FinancialMonthNumber,\n      -- Calculated Dimension: Financial Period (from Query 2 & 3)\n      CONCAT('FY', SAFE_CAST(FinancialYear AS STRING), ' - ', SAFE_CAST(FinancialQuarter AS STRING)) AS FinancialPeriod,\n      -- Calculated Dimension: Adjusted Financial Month Number (from Query 3)\n      CASE\n        WHEN FinancialMonthNumber = 1 THEN 7\n        WHEN FinancialMonthNumber = 2 THEN 8\n        WHEN FinancialMonthNumber = 3 THEN 9\n        WHEN FinancialMonthNumber = 4 THEN 10\n        WHEN FinancialMonthNumber = 5 THEN 11\n        WHEN FinancialMonthNumber = 6 THEN 12\n        WHEN FinancialMonthNumber = 7 THEN 1\n        WHEN FinancialMonthNumber = 8 THEN 2\n        WHEN FinancialMonthNumber = 9 THEN 3\n        WHEN FinancialMonthNumber = 10 THEN 4\n        WHEN FinancialMonthNumber = 11 THEN 5\n        WHEN FinancialMonthNumber = 12 THEN 6\n        ELSE NULL\n      END AS AdjustedFinancialMonthNumber,\n      -- Hardcoded reference date from Query 3\n      SAFE_CAST('2025-06-26' AS DATE) AS ReferenceDate_Q3,\n      -- Calculated Date: Date from FinancialYear, AdjustedFinancialMonthNumber, Day 1 (from Query 3)\n      SAFE_CAST(DATE(FinancialYear, CASE\n        WHEN FinancialMonthNumber = 1 THEN 7\n        WHEN FinancialMonthNumber = 2 THEN 8\n        WHEN FinancialMonthNumber = 3 THEN 9\n        WHEN FinancialMonthNumber = 4 THEN 10\n        WHEN FinancialMonthNumber = 5 THEN 11\n        WHEN FinancialMonthNumber = 6 THEN 12\n        WHEN FinancialMonthNumber = 7 THEN 1\n        WHEN FinancialMonthNumber = 8 THEN 2\n        WHEN FinancialMonthNumber = 9 THEN 3\n        WHEN FinancialMonthNumber = 10 THEN 4\n        WHEN FinancialMonthNumber = 11 THEN 5\n        WHEN FinancialMonthNumber = 12 THEN 6\n        ELSE NULL\n      END, 1) AS DATETIME) AS FinancialMonthDay1_DateTime,\n      -- Calculated Dimension: Month Start Date (from Query 3)\n      SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(FinancialYear, CASE\n        WHEN FinancialMonthNumber = 1 THEN 7\n        WHEN FinancialMonthNumber = 2 THEN 8\n        WHEN FinancialMonthNumber = 3 THEN 9\n        WHEN FinancialMonthNumber = 4 THEN 10\n        WHEN FinancialMonthNumber = 5 THEN 11\n        WHEN FinancialMonthNumber = 6 THEN 12\n        WHEN FinancialMonthNumber = 7 THEN 1\n        WHEN FinancialMonthNumber = 8 THEN 2\n        WHEN FinancialMonthNumber = 9 THEN 3\n        WHEN FinancialMonthNumber = 10 THEN 4\n        WHEN FinancialMonthNumber = 11 THEN 5\n        WHEN FinancialMonthNumber = 12 THEN 6\n        ELSE NULL\n      END, 1) AS DATETIME), MONTH) AS DATE) AS MonthStartDate\n    FROM\n      base_data\n  )\nSELECT\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber,\n  FinancialPeriod,\n  AdjustedFinancialMonthNumber,\n  MonthStartDate,\n  -- Replicate the boolean filter from Query 3\n  (SAFE_CAST(FinancialMonthDay1_DateTime AS DATE) <= ReferenceDate_Q3) AS IsCurrentOrPastMonth_Q3Ref,\n  SUM(RevenueGross) AS TotalGrossRevenue\nFROM\n  calculated_dimensions\nWHERE\n  -- Example filter to limit data for analysis, focusing on recent fiscal periods\n  FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nGROUP BY\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber,\n  FinancialPeriod,\n  AdjustedFinancialMonthNumber,\n  MonthStartDate,\n  IsCurrentOrPastMonth_Q3Ref\nORDER BY\n  TotalGrossRevenue DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialQuarter AS STRING)) as unique_financial_periods,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT PortfolioParentGroup) as unique_portfolio_parent_groups,\n  COUNT(DISTINCT PortfolioChildGroup) as unique_portfolio_child_groups,\n  COUNT(DISTINCT TransactionType) as unique_transaction_types,\n  MIN(SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialQuarter AS STRING)) as earliest_financial_period,\n  MAX(SAFE_CAST(FinancialYear AS STRING) || '-' || SAFE_CAST(FinancialQuarter AS STRING)) as latest_financial_period,\n  SUM(CASE WHEN RevenueGross IS NULL THEN 1 ELSE 0 END) as null_revenue_count,\n  APPROX_COUNT_DISTINCT(CONCAT(Advertiser, PortfolioParentGroup, SAFE_CAST(FinancialYear AS STRING), SAFE_CAST(FinancialQuarter AS STRING), SAFE_CAST(FinancialMonthNumber AS STRING))) as approx_unique_rows_at_grain\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE\n  FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Look at last 2 fiscal years\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(RevenueGross AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(FinancialYear) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as data_freshness_year_test,\n  CASE WHEN COUNT(CASE WHEN TransactionType IS NULL THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END as transaction_type_not_null_test,\n  CASE WHEN COUNT(CASE WHEN FinancialMonthNumber NOT BETWEEN 1 AND 12 THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END as financial_month_valid_test\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE\n  FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n    fiscal_month_mapping_check AS (\n      SELECT\n        FinancialMonthNumber,\n        CASE\n          WHEN FinancialMonthNumber = 1 THEN 7\n          WHEN FinancialMonthNumber = 2 THEN 8\n          WHEN FinancialMonthNumber = 3 THEN 9\n          WHEN FinancialMonthNumber = 4 THEN 10\n          WHEN FinancialMonthNumber = 5 THEN 11\n          WHEN FinancialMonthNumber = 6 THEN 12\n          WHEN FinancialMonthNumber = 7 THEN 1\n          WHEN FinancialMonthNumber = 8 THEN 2\n          WHEN FinancialMonthNumber = 9 THEN 3\n          WHEN FinancialMonthNumber = 10 THEN 4\n          WHEN FinancialMonthNumber = 11 THEN 5\n          WHEN FinancialMonthNumber = 12 THEN 6\n          ELSE NULL\n        END AS ExpectedAdjustedMonth,\n        COUNT(*) AS record_count\n      FROM\n        `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\n      WHERE\n        FinancialYear = 2025 -- Focus on the year where this logic was applied in the dashboard queries\n      GROUP BY\n        FinancialMonthNumber\n    )\n  SELECT\n    'Business Rule Validation' as validation_type,\n    'Fiscal Month Adjustment Mapping' as rule_name,\n    FinancialMonthNumber,\n    ExpectedAdjustedMonth,\n    record_count,\n    CASE\n      WHEN ExpectedAdjustedMonth IS NOT NULL THEN 'PASS'\n      ELSE 'FAIL'\n    END AS mapping_status\n  FROM\n    fiscal_month_mapping_check\n  ORDER BY FinancialMonthNumber;"",
    ""sample_data_sql"": ""SELECT\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  SAFE_CAST(RevenueGross AS NUMERIC) AS RevenueGross,\n  TransactionType,\n  FinancialQuarter,\n  FinancialYear,\n  FinancialMonthNumber\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE\n  FinancialYear = 2025 AND FinancialQuarter = 4 -- Focus on the quarter seen in queries\nORDER BY\n  RevenueGross DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-26"",
          ""original_format"": ""2025-06-26 07:36:48.083696+00"",
          ""context"": ""Used as a reference date (clmn0_) to determine 'current or past' financial months (clmn13_ = clmn11_ <= clmn7_)."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter to make the 'current' period dynamic."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""1 THEN 7"",
            ""2 THEN 8"",
            ""3 THEN 9"",
            ""4 THEN 10"",
            ""5 THEN 11"",
            ""6 THEN 12"",
            ""7 THEN 1"",
            ""8 THEN 2"",
            ""9 THEN 3"",
            ""10 THEN 4"",
            ""11 THEN 5"",
            ""12 THEN 6""
          ],
          ""context"": ""Fiscal month mapping in a CASE statement to adjust month numbers for fiscal year alignment."",
          ""suggested_governance"": ""Store fiscal month mappings in a dedicated configuration table or implement as a UDF for centralized management."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'INDEPENDENT AGENCIES NSW'"",
            ""'CONSORTIUM VIC'"",
            ""'VIC CON B3'"",
            ""'VIC CON B2'"",
            ""'VIC CON B1'""
          ],
          ""context"": ""Specific PortfolioParentGroup and PortfolioChildGroup values used for filtering."",
          ""suggested_governance"": ""Use a governed dimension table for Portfolio Groups, allowing for dynamic filtering and easier updates."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Guaranteed'"",
            ""'Deal'""
          ],
          ""context"": ""Specific TransactionType values used for filtering."",
          ""suggested_governance"": ""Use a governed dimension table for Transaction Types."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'FY2025 - Q4'""
          ],
          ""context"": ""Specific Financial Period used for filtering."",
          ""suggested_governance"": ""Use a date dimension table or dashboard parameters for selecting financial periods."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Replace hardcoded lookup values (e.g., Portfolio Groups, Transaction Types) with joins to governed reference tables."",
      ""Use configuration tables for business rules like fiscal month mapping instead of hardcoded CASE statements."",
      ""Allow users to select Financial Periods (Year/Quarter) via dashboard parameters.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue generated from programmatic sales, often filtered by specific portfolio groups or transaction types."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW')"",
        ""TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for sales performance, used to track revenue generation by various dimensions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""Lookup values for PortfolioParentGroup and TransactionType are hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in RevenueGross if not handled by SAFE_CAST.""
      ]
    },
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic sales data."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Financial Period IN ('FY2025 - Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting revenue and other metrics by individual advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025 - Q4'""
      ],
      ""governance_issues"": [
        ""Financial Period filter is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_parent_group"",
      ""metric_name"": ""Portfolio Parent Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The top-level grouping for portfolios, e.g., 'INDEPENDENT AGENCIES NSW', 'CONSORTIUM VIC'."",
      ""sql_logic"": ""t0.PortfolioParentGroup"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW')"",
        ""PortfolioParentGroup IN ('CONSORTIUM VIC')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level segmentation of sales data by agency or consortium."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'CONSORTIUM VIC'""
      ],
      ""governance_issues"": [
        ""Lookup values are hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_child_group"",
      ""metric_name"": ""Portfolio Child Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sub-level grouping for portfolios, e.g., 'VIC CON B3'."",
      ""sql_logic"": ""t0.PortfolioChildGroup"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides more granular segmentation within parent portfolio groups."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VIC CON B3'"",
        ""'VIC CON B2'"",
        ""'VIC CON B1'""
      ],
      ""governance_issues"": [
        ""Lookup values are hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of transaction, e.g., 'Guaranteed', 'Deal'."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL"",
        ""TransactionType IN ('Deal')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to differentiate revenue by deal structure."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Deal'""
      ],
      ""governance_issues"": [
        ""Lookup values are hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year of the transaction."",
      ""sql_logic"": ""t0.FinancialYear"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter within the financial year."",
      ""sql_logic"": ""t0.FinancialQuarter"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Time dimension for quarterly financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_number"",
      ""metric_name"": ""Financial Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The month number within the financial year (1-12)."",
      ""sql_logic"": ""t0.FinancialMonthNumber"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Granular time dimension for monthly financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period"",
      ""metric_name"": ""Financial Period (FY - Q)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_quarter""
      ],
      ""business_description"": ""Concatenated string representing the financial year and quarter (e.g., 'FY2025 - Q4')."",
      ""sql_logic"": ""CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Financial Period IN ('FY2025 - Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping data by specific financial periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025 - Q4'""
      ],
      ""governance_issues"": [
        ""Filter value is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjusted_financial_month_number"",
      ""metric_name"": ""Adjusted Financial Month Number"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_month_number""
      ],
      ""business_description"": ""A re-mapping of standard month numbers (1-12) to align with a specific fiscal year definition (e.g., July-June fiscal year)."",
      ""sql_logic"": ""CASE WHEN FinancialMonthNumber = 1 THEN 7 WHEN FinancialMonthNumber = 2 THEN 8 ... WHEN FinancialMonthNumber = 12 THEN 6 ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for correctly constructing fiscal dates and aligning data to the business's fiscal calendar."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""Fiscal Month Mapping (1->7, 2->8, ..., 12->6)""
      ],
      ""governance_issues"": [
        ""The entire mapping logic is hardcoded in a CASE statement.""
      ],
      ""data_quality_concerns"": [
        ""Incorrect mapping could lead to misaligned fiscal periods.""
      ]
    },
    {
      ""metric_id"": ""month_start_date"",
      ""metric_name"": ""Month Start Date (Fiscal)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""adjusted_financial_month_number""
      ],
      ""business_description"": ""The first day of the month, derived from the financial year and the adjusted financial month number, truncated to the month."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(FinancialYear, AdjustedFinancialMonthNumber, 1) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""IsCurrentOrPastMonth_Q3Ref = true""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Used for time-series analysis and grouping data by fiscal month."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Depends on the hardcoded fiscal month mapping.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_current_or_past_month_q3ref"",
      ""metric_name"": ""Is Current or Past Month (Q3 Ref)"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""month_start_date""
      ],
      ""business_description"": ""A boolean flag indicating if the fiscal month's start date is less than or equal to a hardcoded reference date (2025-06-26)."",
      ""sql_logic"": ""(SAFE_CAST(DATE(FinancialYear, AdjustedFinancialMonthNumber, 1) AS DATE) <= DATE('2025-06-26'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter data to only include periods up to a specific point in time, likely for 'current' or 'historical' views."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-26""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""The reference date is hardcoded, making the 'current' period static and requiring manual updates.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""portfolio_parent_group"",
        ""transaction_type"",
        ""financial_period"",
        ""portfolio_child_group"",
        ""is_current_or_past_month_q3ref""
      ],
      ""relationship_description"": ""Total Gross Revenue is filtered by various dimensions to show specific segments of revenue. For example, Query 1 filters by 'INDEPENDENT AGENCIES NSW' and excludes 'Guaranteed' transactions. Query 3 filters by 'CONSORTIUM VIC', 'FY2025 - Q4', 'Deal' transactions, and specific child groups, and only includes months up to a hardcoded date."",
      ""mathematical_formula"": ""SUM(RevenueGross) WHERE [dimension_filter_conditions]"",
      ""business_validation"": ""Ensures that revenue figures are presented for the intended business segments and timeframes, aligning with specific reporting needs."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(RevenueGross AS NUMERIC)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW') AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""month_start_date"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_month_number"",
        ""adjusted_financial_month_number""
      ],
      ""relationship_description"": ""The 'Month Start Date' is directly calculated from 'Financial Year' and 'Adjusted Financial Month Number'. The 'Adjusted Financial Month Number' itself is a transformation of 'Financial Month Number' based on a hardcoded fiscal calendar logic."",
      ""mathematical_formula"": ""MonthStartDate = DATETIME_TRUNC(DATE(FinancialYear, AdjustedFinancialMonthNumber, 1), MONTH)"",
      ""business_validation"": ""Ensures that time-based analysis aligns with the company's specific fiscal calendar, which is critical for accurate financial reporting."",
      ""validation_sql"": ""SELECT FinancialYear, FinancialMonthNumber, (CASE WHEN FinancialMonthNumber = 1 THEN 7 WHEN FinancialMonthNumber = 2 THEN 8 WHEN FinancialMonthNumber = 3 THEN 9 WHEN FinancialMonthNumber = 4 THEN 10 WHEN FinancialMonthNumber = 5 THEN 11 WHEN FinancialMonthNumber = 6 THEN 12 WHEN FinancialMonthNumber = 7 THEN 1 WHEN FinancialMonthNumber = 8 THEN 2 WHEN FinancialMonthNumber = 9 THEN 3 WHEN FinancialMonthNumber = 10 THEN 4 WHEN FinancialMonthNumber = 11 THEN 5 WHEN FinancialMonthNumber = 12 THEN 6 ELSE NULL END) AS AdjustedMonth, SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(FinancialYear, (CASE WHEN FinancialMonthNumber = 1 THEN 7 WHEN FinancialMonthNumber = 2 THEN 8 WHEN FinancialMonthNumber = 3 THEN 9 WHEN FinancialMonthNumber = 4 THEN 10 WHEN FinancialMonthNumber = 5 THEN 11 WHEN FinancialMonthNumber = 6 THEN 12 WHEN FinancialMonthNumber = 7 THEN 1 WHEN FinancialMonthNumber = 8 THEN 2 WHEN FinancialMonthNumber = 9 THEN 3 WHEN FinancialMonthNumber = 10 THEN 4 WHEN FinancialMonthNumber = 11 THEN 5 WHEN FinancialMonthNumber = 12 THEN 6 ELSE NULL END), 1) AS DATETIME), MONTH) AS DATE) AS CalculatedMonthStartDate FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE FinancialYear = 2025 AND FinancialQuarter = 4 LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,9
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""258a722d-9b6e-45df-ba00-1b9954ec36b2"",
    ""dashboard_name"": ""Debtor to Account Mapping"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref;ncau-data-newsquery-prd.sdm_advertisingexternals.__TABLES__"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""Adpoint_Account"",
      ""Genera_Booking_Account"",
      ""Medium_Rare_Debtor_Account"",
      ""National_Debtor_Account""
    ],
    ""date_range_detected"": ""N/A"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'56694'"",
      ""'gbaba_act_xref'"",
      ""'Australia/Sydney'""
    ],
    ""governance_opportunities"": [
      ""Account IDs should be parameterized"",
      ""Table names and timezones should be configurable or derived dynamically""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- Primary Analysis SQL: Analyze the distribution and uniqueness of account mappings\nWITH AccountMappings AS (\n  SELECT\n    SAFE_CAST(Adpoint_Account AS STRING) AS Adpoint_Account,\n    SAFE_CAST(Genera_Booking_Account AS STRING) AS Genera_Booking_Account,\n    SAFE_CAST(Medium_Rare_Debtor_Account AS STRING) AS Medium_Rare_Debtor_Account,\n    SAFE_CAST(National_Debtor_Account AS STRING) AS National_Debtor_Account\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\n)\nSELECT\n  Adpoint_Account,\n  Genera_Booking_Account,\n  Medium_Rare_Debtor_Account,\n  National_Debtor_Account,\n  COUNT(*) AS mapping_count,\n  -- Identify cases where one Adpoint_Account maps to multiple Genera_Booking_Account\n  COUNT(DISTINCT Genera_Booking_Account) OVER (PARTITION BY Adpoint_Account) AS adpoint_to_genera_distinct_count,\n  COUNT(DISTINCT Medium_Rare_Debtor_Account) OVER (PARTITION BY Adpoint_Account) AS adpoint_to_mr_debtor_distinct_count,\n  COUNT(DISTINCT National_Debtor_Account) OVER (PARTITION BY Adpoint_Account) AS adpoint_to_national_debtor_distinct_count\nFROM AccountMappings\nGROUP BY\n  Adpoint_Account,\n  Genera_Booking_Account,\n  Medium_Rare_Debtor_Account,\n  National_Debtor_Account\nORDER BY\n  mapping_count DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Structure SQL: Understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis for v_asl_gbaba_act_xref' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(Adpoint_Account AS STRING)) as unique_adpoint_accounts,\n  COUNT(DISTINCT SAFE_CAST(Genera_Booking_Account AS STRING)) as unique_genera_booking_accounts,\n  COUNT(DISTINCT SAFE_CAST(Medium_Rare_Debtor_Account AS STRING)) as unique_medium_rare_debtor_accounts,\n  COUNT(DISTINCT SAFE_CAST(National_Debtor_Account AS STRING)) as unique_national_debtor_accounts,\n  -- Sample data for column types and values\n  ANY_VALUE(SAFE_CAST(Adpoint_Account AS STRING)) as sample_adpoint_account,\n  ANY_VALUE(SAFE_CAST(Genera_Booking_Account AS STRING)) as sample_genera_booking_account,\n  ANY_VALUE(SAFE_CAST(Medium_Rare_Debtor_Account AS STRING)) as sample_medium_rare_debtor_account,\n  ANY_VALUE(SAFE_CAST(National_Debtor_Account AS STRING)) as sample_national_debtor_account\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""validation_sql"": ""-- Validation SQL: Quick validation that all metric calculations work syntactically\nSELECT\n  'Validation Check for v_asl_gbaba_act_xref' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_exists_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(Adpoint_Account AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as adpoint_account_not_empty_test,\n  CASE WHEN EXISTS (\n    SELECT 1 FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\n    WHERE SAFE_CAST(Adpoint_Account AS STRING) = '56694'\n    LIMIT 1\n  ) THEN 'PASS' ELSE 'FAIL' END as hardcoded_filter_value_exists_test,\n  -- Check last update time\n  (SELECT\n    CASE WHEN DATETIME_DIFF(CURRENT_DATETIME(\""Australia/Sydney\""), DATETIME(timestamp_millis(last_modified_time), \""Australia/Sydney\""), HOUR) < 24\n    THEN 'PASS' ELSE 'FAIL' END\n  FROM `ncau-data-newsquery-prd.sdm_advertisingexternals.__TABLES__`\n  WHERE table_id = 'gbaba_act_xref'\n  LIMIT 1) AS last_update_freshness_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Business Rules SQL: Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Adpoint_Account_56694_filter_impact' as rule_name,\n  COUNT(*) as total_records_in_view,\n  SUM(CASE WHEN SAFE_CAST(Adpoint_Account AS STRING) = '56694' THEN 1 ELSE 0 END) as records_matching_hardcoded_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(Adpoint_Account AS STRING) = '56694' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_matching_filter\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`;"",
    ""sample_data_sql"": ""-- Sample Data SQL: Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(Adpoint_Account AS STRING) AS Adpoint_Account,\n  SAFE_CAST(Genera_Booking_Account AS STRING) AS Genera_Booking_Account,\n  SAFE_CAST(Medium_Rare_Debtor_Account AS STRING) AS Medium_Rare_Debtor_Account,\n  SAFE_CAST(National_Debtor_Account AS STRING) AS National_Debtor_Account\nFROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nWHERE SAFE_CAST(Adpoint_Account AS STRING) IS NOT NULL -- Ensure some data exists\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'56694'""
          ],
          ""context"": ""Adpoint_Account filter value in query job_RMTehvLY6Vh0okkfYselduWZxgCN"",
          ""suggested_governance"": ""replace with a dashboard parameter or a lookup table for valid account IDs"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""table_metadata"",
          ""hardcoded_values"": [
            ""'gbaba_act_xref'""
          ],
          ""context"": ""table_id filter in query job_kIuhjiLMpatUagGf9rwGeUEihEfV to get last update time"",
          ""suggested_governance"": ""derive table_id dynamically from the primary data source or use a configuration table"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""timezone"",
          ""hardcoded_values"": [
            ""'Australia/Sydney'""
          ],
          ""context"": ""timezone for last_update_time calculation in query job_kIuhjiLMpatUagGf9rwGeUEihEfV"",
          ""suggested_governance"": ""use a global configuration parameter for timezone or derive from user settings"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded account IDs with dashboard parameters to allow dynamic filtering."",
      ""Consider using a configuration table for table metadata (like table_id and timezone) if dynamic `INFORMATION_SCHEMA` queries are not feasible in Looker Studio.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adpoint_account"",
      ""metric_name"": ""Adpoint Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an account in the Adpoint system."",
      ""sql_logic"": ""t0.Adpoint_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A primary key or identifier used for mapping across different advertising and debtor systems."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""genera_booking_account"",
      ""metric_name"": ""Genera Booking Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an account in the Genera Booking system."",
      ""sql_logic"": ""t0.Genera_Booking_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used in conjunction with other account IDs to establish a comprehensive mapping."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""medium_rare_debtor_account"",
      ""metric_name"": ""Medium Rare Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a debtor account specific to Medium Rare."",
      ""sql_logic"": ""t0.Medium_Rare_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Part of the multi-system account mapping for financial reconciliation or reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""national_debtor_account"",
      ""metric_name"": ""National Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a national debtor account."",
      ""sql_logic"": ""t0.National_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Another key in the account mapping, likely for national-level financial tracking."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_update_time"",
      ""metric_name"": ""Last Update Time"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The last time the underlying 'gbaba_act_xref' table was modified, indicating data freshness."",
      ""sql_logic"": ""DATETIME(timestamp_millis(last_modified_time), \""Australia/Sydney\"")"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sdm_advertisingexternals.__TABLES__""
      ],
      ""filters_applied"": [
        ""table_id = 'gbaba_act_xref'""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Crucial for understanding the recency of the account mapping data. A stale update time could indicate data pipeline issues."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'gbaba_act_xref'"",
        ""'Australia/Sydney'""
      ],
      ""governance_issues"": [
        ""table_id should be dynamic or parameterized"",
        ""timezone should be configurable""
      ],
      ""data_quality_concerns"": [
        ""dependency on BigQuery's internal __TABLES__ metadata, which might have latency""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""adpoint_account"",
      ""related_metrics"": [
        ""genera_booking_account"",
        ""medium_rare_debtor_account"",
        ""national_debtor_account""
      ],
      ""relationship_description"": ""Filtering by 'Adpoint Account' (e.g., '56694') directly impacts the displayed values of Genera Booking, Medium Rare Debtor, and National Debtor Accounts, showing only mappings related to the selected Adpoint Account."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that users can drill down into specific account mappings based on a primary identifier."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` WHERE SAFE_CAST(Adpoint_Account AS STRING) = '56694';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,10
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52dd1ac1-19b5-4695-a7e6-632ef7a9dba3"",
    ""dashboard_name"": ""Consumer Finance Landing Page"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 2,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""none"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""scenario""
    ],
    ""date_range_detected"": ""N/A"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'' (empty string)""
    ],
    ""governance_opportunities"": [
      ""review purpose of hardcoded empty string dimension"",
      ""implement date parameters if underlying data contains date columns""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  scenario_counts AS (\n    SELECT\n      SAFE_CAST(t0.scenario AS STRING) AS scenario,\n      COUNT(1) AS records_by_scenario\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    GROUP BY\n      1\n  )\nSELECT\n  'Unified Metrics' AS analysis_type,\n  scenario,\n  records_by_scenario,\n  SUM(records_by_scenario) OVER () AS total_records_overall\nFROM\n  scenario_counts\nORDER BY\n  records_by_scenario DESC\nLIMIT 100; -- Sample for analysis"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(scenario AS STRING)) AS unique_scenarios,\n  APPROX_COUNT_DISTINCT(scenario) AS approx_unique_scenarios_for_large_data\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN COUNT(1) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS record_count_test,\n  CASE\n    WHEN COUNT(DISTINCT SAFE_CAST(scenario AS STRING)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS scenario_distinct_test,\n  CASE\n    WHEN COUNT(scenario) = COUNT(1) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS scenario_not_null_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Scenario Distribution' AS rule_name,\n  SAFE_CAST(scenario AS STRING) AS scenario_value,\n  COUNT(1) AS records_count,\n  ROUND(COUNT(1) * 100.0 / SUM(COUNT(1)) OVER (), 2) AS percentage_of_total\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nGROUP BY\n  1, 2\nORDER BY\n  records_count DESC\nLIMIT 10;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(scenario AS STRING) AS scenario\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nWHERE\n  scenario IS NOT NULL\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""''""
          ],
          ""context"": ""empty string used as a dimension placeholder (clmn0_) in a Looker Studio generated query"",
          ""suggested_governance"": ""review Looker Studio configuration to avoid unnecessary constant dimensions or ensure proper column selection"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Review Looker Studio dashboard configuration to understand the purpose of the hardcoded empty string dimension and potentially remove it if not serving a business purpose."",
      ""Implement date parameters for filtering if the underlying `digital_subscriptions` table contains date columns, to allow for dynamic date range selection.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""scenario_dimension"",
      ""metric_name"": ""Scenario"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents different predefined scenarios or categories within the digital subscriptions data, used for segmentation and analysis."",
      ""sql_logic"": ""t0.scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for breaking down subscription performance by different business contexts or types of subscriptions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls or inconsistent string values""
      ]
    },
    {
      ""metric_id"": ""total_records"",
      ""metric_name"": ""Total Records"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""overall"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of rows or entries in the digital subscriptions dataset."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a basic volume count, often used as a sanity check for data freshness or completeness."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""records_by_scenario"",
      ""metric_name"": ""Records by Scenario"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""scenario_dimension""
      ],
      ""business_description"": ""The count of digital subscription records, broken down by each unique scenario."",
      ""sql_logic"": ""COUNT(1) GROUP BY t0.scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the distribution of subscription types or contexts, helping to identify dominant or emerging scenarios."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for miscategorized scenarios if data entry is inconsistent""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_records"",
      ""related_metrics"": [
        ""records_by_scenario""
      ],
      ""relationship_description"": ""The total number of records is the sum of records across all individual scenarios."",
      ""mathematical_formula"": ""total_records = SUM(records_by_scenario)"",
      ""business_validation"": ""Ensures that the sum of parts equals the whole, validating data aggregation."",
      ""validation_sql"": ""SELECT\n  'Total Records Sum Validation' AS validation_test,\n  (SELECT COUNT(1) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`) AS actual_total_records,\n  (SELECT SUM(records_by_scenario) FROM (SELECT COUNT(1) AS records_by_scenario FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` GROUP BY scenario)) AS sum_of_scenario_records,\n  CASE\n    WHEN (SELECT COUNT(1) FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`) = (SELECT SUM(records_by_scenario) FROM (SELECT COUNT(1) AS records_by_scenario FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` GROUP BY scenario)) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS validation_result;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,11
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""783f341c-8660-4e90-bab8-9bc860119cf5"",
    ""dashboard_name"": ""Deals Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""reporting_month"",
      ""fiscal_period_string"",
      ""advertiser"",
      ""buyer"",
      ""source"",
      ""transaction_type_upper""
    ],
    ""date_range_detected"": ""2024-11-01 to 2025-06-01 (based on hardcoded filters)"",
    ""hardcoded_dates_found"": [
      ""2024-11-01"",
      ""2024-12-01"",
      ""2025-01-01"",
      ""2025-02-01"",
      ""2025-03-01"",
      ""2025-04-01"",
      ""2025-05-01"",
      ""2025-06-01""
    ],
    ""hardcoded_values_found"": [
      ""'AdX'"",
      ""'AppNexus'"",
      ""'DFP'"",
      ""'Index Exchange'"",
      ""'InSkin'"",
      ""'Kargo'"",
      ""'Playground XYZ'"",
      ""'PubMatic'"",
      ""'Rubicon'"",
      ""'Tremor'"",
      ""'DEAL'"",
      ""'UFR'"",
      ""'PG - CPD'"",
      ""'PG - CPM'"",
      ""'DIRECT'"",
      ""'The Smith Family *'"",
      ""'Kmart Corporation *'"",
      ""'Target Corporation *'"",
      ""'Myer *'"",
      ""'FY25 Q2'"",
      ""'FY25 Q3'"",
      ""'FY25 Q4'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative date functions"",
      ""advertiser names should join to a governed advertiser dimension table"",
      ""source names should join to a governed source dimension table"",
      ""transaction types should join to a governed transaction_type dimension table"",
      ""fiscal periods should be dynamically derived or selected from a governed fiscal calendar table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.advertiser,\n    t0.buyer,\n    t0.revenuenet,\n    t0.source,\n    UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) AS transaction_type_upper,\n    CONCAT('FY',SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2),' ',SAFE_CAST(t0.financialquarter AS STRING)) AS fiscal_period_string,\n    SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS reporting_month\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n  WHERE\n    -- Apply common filters observed across queries\n    UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')\n    AND SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) BETWEEN DATE('2024-11-01') AND DATE('2025-06-01') -- Broader date range from Q1\n    AND t0.source IN ('DFP', 'Index Exchange', 'Rubicon', 'AdX', 'AppNexus', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Tremor') -- Combined source filter\n    AND t0.advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *') -- Combined advertiser filter\n    AND CONCAT('FY',SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2),' ',SAFE_CAST(t0.financialquarter AS STRING)) IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4') -- Combined fiscal period filter\n)\nSELECT\n  reporting_month,\n  fiscal_period_string,\n  advertiser,\n  source,\n  transaction_type_upper,\n  SUM(SAFE_CAST(revenuenet AS NUMERIC)) AS total_revenue_net,\n  COUNT(DISTINCT buyer) AS distinct_buyers\nFROM base_data\nGROUP BY\n  reporting_month,\n  fiscal_period_string,\n  advertiser,\n  source,\n  transaction_type_upper\nORDER BY\n  reporting_month DESC, total_revenue_net DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financialyear AS STRING)) AS unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.financialquarter AS STRING)) AS unique_financial_quarters,\n  COUNT(DISTINCT SAFE_CAST(t0.financialmonthnumber AS STRING)) AS unique_financial_months,\n  COUNT(DISTINCT t0.advertiser) AS unique_advertisers,\n  COUNT(DISTINCT t0.buyer) AS unique_buyers,\n  COUNT(DISTINCT t0.source) AS unique_sources,\n  COUNT(DISTINCT t0.source_transactiontype) AS unique_transaction_types,\n  MIN(SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE)) AS earliest_reporting_month,\n  MAX(SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE)) AS latest_reporting_month\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 18 MONTH);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.revenuenet AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_revenue_check,\n  CASE WHEN COUNT(DISTINCT t0.advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END AS distinct_advertisers_check,\n  CASE WHEN MAX(SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_check,\n  CASE WHEN COUNT(CASE WHEN UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS transaction_type_filter_coverage_check\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'fiscal_year_adjustment_logic' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE\n    WHEN\n      SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) IS NOT NULL\n      AND SAFE_CAST(t0.financialyear AS STRING) IS NOT NULL\n      AND SAFE_CAST(t0.financialmonthnumber AS STRING) IS NOT NULL\n    THEN 1 ELSE 0 END) AS records_with_valid_date_components,\n  SUM(CASE\n    WHEN\n      SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) = DATE_TRUNC(DATE_SUB(DATE(t0.financialyear, t0.financialmonthnumber, 1), INTERVAL 6 MONTH), MONTH)\n    THEN 1 ELSE 0 END) AS records_matching_expected_fiscal_date_logic,\n  SAFE_DIVIDE(SUM(CASE\n    WHEN\n      SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) = DATE_TRUNC(DATE_SUB(DATE(t0.financialyear, t0.financialmonthnumber, 1), INTERVAL 6 MONTH), MONTH)\n    THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS reporting_month,\n  CONCAT('FY',SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2),' ',SAFE_CAST(t0.financialquarter AS STRING)) AS fiscal_period_string,\n  t0.advertiser,\n  t0.buyer,\n  t0.source,\n  UPPER(SAFE_CAST(t0.source_transactiontype AS STRING)) AS transaction_type_upper,\n  SAFE_CAST(t0.revenuenet AS NUMERIC) AS revenuenet\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\nORDER BY reporting_month DESC, revenuenet DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024-11-01"",
          ""original_format"": ""DATE '2024-11-01'"",
          ""context"": ""used as a specific start date in reporting_month filter"",
          ""suggested_fix"": ""replace with a dashboard parameter or relative date function (e.g., DATE_TRUNC(CURRENT_DATE(), MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-01"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""used as a specific end date in reporting_month filter"",
          ""suggested_fix"": ""replace with a dashboard parameter or relative date function (e.g., DATE_ADD(DATE_TRUNC(CURRENT_DATE(), MONTH), INTERVAL 1 MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-05-01"",
          ""original_format"": ""DATE '2025-05-01'"",
          ""context"": ""used as a specific reporting_month filter in buyer queries"",
          ""suggested_fix"": ""replace with a dashboard parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'AdX'"",
            ""'AppNexus'"",
            ""'DFP'"",
            ""'Index Exchange'"",
            ""'InSkin'"",
            ""'Kargo'"",
            ""'Playground XYZ'"",
            ""'PubMatic'"",
            ""'Rubicon'"",
            ""'Tremor'""
          ],
          ""context"": ""source names hardcoded in WHERE clause"",
          ""suggested_governance"": ""join to a `source_lookup` table or use a dashboard parameter for selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DEAL'"",
            ""'UFR'"",
            ""'PG - CPD'"",
            ""'PG - CPM'"",
            ""'DIRECT'""
          ],
          ""context"": ""source_transactiontype values hardcoded in WHERE clause"",
          ""suggested_governance"": ""join to a `transaction_type_lookup` table or use a dashboard parameter for selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_entities"",
          ""hardcoded_values"": [
            ""'The Smith Family *'"",
            ""'Kmart Corporation *'"",
            ""'Target Corporation *'"",
            ""'Myer *'""
          ],
          ""context"": ""advertiser names hardcoded in WHERE clause"",
          ""suggested_governance"": ""join to an `advertiser_dimension` table or use a dashboard parameter for selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""fiscal_periods"",
          ""hardcoded_values"": [
            ""'FY25 Q2'"",
            ""'FY25 Q3'"",
            ""'FY25 Q4'""
          ],
          ""context"": ""fiscal period strings hardcoded in WHERE clause"",
          ""suggested_governance"": ""derive dynamically from a fiscal calendar table or use a dashboard parameter for selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)`)."",
      ""Replace hardcoded lookup values (Source, Transaction Type) with joins to governed reference tables or multi-select dashboard parameters."",
      ""Replace hardcoded business entity names (Advertiser) with joins to a governed dimension table or multi-select dashboard parameters."",
      ""Derive fiscal periods dynamically from a governed fiscal calendar table instead of hardcoding specific 'FYxx Qx' strings.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_revenue_net"",
      ""metric_name"": ""Total Revenue Net"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net revenue generated from advertising deals, aggregated by reporting month, fiscal period, advertiser, source, and transaction type."",
      ""sql_logic"": ""SUM(t0.revenuenet)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source_transactiontype IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')"",
        ""reporting_month between 2024-11-01 and 2025-06-01"",
        ""source IN ('DFP', 'Index Exchange', 'Rubicon', 'AdX', 'AppNexus', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Tremor')"",
        ""advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *')"",
        ""fiscal_period_string IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This metric is central to understanding the financial performance of advertising deals, allowing analysis by various dimensions to identify key contributors and trends."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-11-01"",
        ""2024-12-01"",
        ""2025-01-01"",
        ""2025-02-01"",
        ""2025-03-01"",
        ""2025-04-01"",
        ""2025-05-01"",
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""'AppNexus'"",
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'InSkin'"",
        ""'Kargo'"",
        ""'Playground XYZ'"",
        ""'PubMatic'"",
        ""'Rubicon'"",
        ""'Tremor'"",
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'"",
        ""'The Smith Family *'"",
        ""'Kmart Corporation *'"",
        ""'Target Corporation *'"",
        ""'Myer *'"",
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""date filters are hardcoded"",
        ""lookup values for source, transaction type, advertiser, and fiscal period are hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in revenuenet if not handled by SAFE_CAST"",
        ""consistency of 'financialyear', 'financialmonthnumber', 'financialquarter' for date calculations""
      ]
    },
    {
      ""metric_id"": ""distinct_buyers"",
      ""metric_name"": ""Distinct Buyers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The count of unique buyers associated with the filtered advertising deals."",
      ""sql_logic"": ""COUNT(DISTINCT t0.buyer)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source_transactiontype IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')"",
        ""reporting_month between 2024-11-01 and 2025-06-01"",
        ""source IN ('DFP', 'Index Exchange', 'Rubicon', 'AdX', 'AppNexus', 'InSkin', 'Kargo', 'Playground XYZ', 'PubMatic', 'Tremor')"",
        ""advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *')"",
        ""fiscal_period_string IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides insight into the breadth of buyer engagement within the defined deal parameters. Often used for filtering or as a supporting metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""2024-11-01"",
        ""2024-12-01"",
        ""2025-01-01"",
        ""2025-02-01"",
        ""2025-03-01"",
        ""2025-04-01"",
        ""2025-05-01"",
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""'AppNexus'"",
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'InSkin'"",
        ""'Kargo'"",
        ""'Playground XYZ'"",
        ""'PubMatic'"",
        ""'Rubicon'"",
        ""'Tremor'"",
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'"",
        ""'The Smith Family *'"",
        ""'Kmart Corporation *'"",
        ""'Target Corporation *'"",
        ""'Myer *'"",
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""date filters are hardcoded"",
        ""lookup values for source, transaction type, advertiser, and fiscal period are hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in buyer column if not handled by COUNT(DISTINCT)""
      ]
    },
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the deal."",
      ""sql_logic"": ""t0.advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue and buyer data by the advertising client."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""buyer"",
      ""metric_name"": ""Buyer"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the buyer associated with the deal."",
      ""sql_logic"": ""t0.buyer"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for understanding who is purchasing the advertising space."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The platform or channel through which the advertising deal was transacted (e.g., DFP, AdX)."",
      ""sql_logic"": ""t0.source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Important for analyzing performance across different ad tech platforms."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""transaction_type_upper"",
      ""metric_name"": ""Transaction Type (Upper)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of transaction for the advertising deal, converted to uppercase for consistency (e.g., 'DEAL', 'UFR')."",
      ""sql_logic"": ""UPPER(SAFE_CAST(t0.source_transactiontype AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for categorizing deals and applying specific business rules or filters."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_period_string"",
      ""metric_name"": ""Fiscal Period String"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_concatenation"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A concatenated string representing the fiscal year and quarter (e.g., 'FY25 Q2')."",
      ""sql_logic"": ""CONCAT('FY',SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2),' ',SAFE_CAST(t0.financialquarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting and filtering data based on the company's fiscal calendar."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""reporting_month"",
      ""metric_name"": ""Reporting Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the calendar month for reporting, derived from financial year/month and adjusted by a 6-month offset."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""The primary date dimension for time-series analysis and monthly aggregations, incorporating a specific fiscal calendar adjustment."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""accuracy depends on financialyear and financialmonthnumber being valid date components""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_revenue_net"",
      ""related_metrics"": [
        ""advertiser"",
        ""source"",
        ""transaction_type_upper"",
        ""fiscal_period_string"",
        ""reporting_month""
      ],
      ""relationship_description"": ""The calculation of Total Revenue Net is directly impacted by filters applied to Advertiser, Source, Transaction Type, Fiscal Period, and Reporting Month. Changes in these filters will alter the aggregated revenue."",
      ""mathematical_formula"": ""SUM(revenuenet) WHERE [filters]"",
      ""business_validation"": ""Ensures that revenue figures are contextualized to specific business segments, periods, and deal types. Incorrect filters lead to misleading revenue reports."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(revenuenet AS NUMERIC)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` WHERE advertiser = 'The Smith Family *' AND SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(financialyear, financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) = DATE '2024-11-01';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""reporting_month"",
      ""related_metrics"": [
        ""financialyear"",
        ""financialmonthnumber""
      ],
      ""relationship_description"": ""The 'Reporting Month' dimension is derived directly from 'financialyear' and 'financialmonthnumber' with a 6-month offset and truncation. Any issues or changes in the base financial date columns will directly affect 'Reporting Month'."",
      ""mathematical_formula"": ""reporting_month = TRUNC(DATE_SUB(DATE(financialyear, financialmonthnumber, 1), INTERVAL 6 MONTH), MONTH)"",
      ""business_validation"": ""Critical for ensuring time-based reporting aligns with the company's specific fiscal calendar. Incorrect derivation would lead to misaligned time-series data."",
      ""validation_sql"": ""SELECT\n  DATE(t0.financialyear, t0.financialmonthnumber, 1) AS original_financial_date,\n  DATE_SUB(DATE(t0.financialyear, t0.financialmonthnumber, 1), INTERVAL 6 MONTH) AS six_month_offset_date,\n  DATE_TRUNC(DATE_SUB(DATE(t0.financialyear, t0.financialmonthnumber, 1), INTERVAL 6 MONTH), MONTH) AS derived_reporting_month\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE t0.financialyear = 2025 AND t0.financialmonthnumber = 1\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fiscal_period_string"",
      ""related_metrics"": [
        ""financialyear"",
        ""financialquarter""
      ],
      ""relationship_description"": ""The 'Fiscal Period String' dimension is derived directly from 'financialyear' and 'financialquarter'."",
      ""mathematical_formula"": ""fiscal_period_string = CONCAT('FY', SUBSTR(financialyear, 3, 2), ' ', financialquarter)"",
      ""business_validation"": ""Ensures consistent labeling of fiscal periods across reports. Any changes in the base financial year/quarter or the concatenation logic will affect this dimension."",
      ""validation_sql"": ""SELECT\n  t0.financialyear,\n  t0.financialquarter,\n  CONCAT('FY',SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2),' ',SAFE_CAST(t0.financialquarter AS STRING)) AS derived_fiscal_period_string\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE t0.financialyear = 2025 AND t0.financialquarter = 'Q2'\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,12
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f"",
    ""dashboard_name"": ""Pacing Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month;ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Source"",
      ""ProductType"",
      ""FinancialYear"",
      ""FinancialMonthNumber"",
      ""CurrentMonthFlag""
    ],
    ""date_range_detected"": ""N/A (relies on CurrentMonthFlag)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""Kargo"",
      ""AdX"",
      ""1""
    ],
    ""governance_opportunities"": [
      ""CurrentMonthFlag should be derived from a date dimension table or a parameter"",
      ""Source values should be managed in a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH FinMonthData AS (\n  SELECT\n    t0.CurrentMonthFlag,\n    t0.FinancialMonthNumber,\n    t0.FinancialYear,\n    t0.Source,\n    t0.StaticDays,\n    t0.NumDays,\n    -- Inferred metrics for a Pacing Dashboard, assuming these columns exist in programmatic_fin_month\n    SAFE_CAST(t0.Spend AS NUMERIC) AS spend_metric,\n    SAFE_CAST(t0.Revenue AS NUMERIC) AS revenue_metric\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n  WHERE t0.CurrentMonthFlag = 1 -- Common filter from both queries\n    AND (t0.Source = 'Kargo' OR t0.Source NOT IN ('AdX') OR t0.Source IS NULL) -- Combined source filters\n),\nProductTypeData AS (\n  SELECT\n    t0.ProductType\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\n)\nSELECT\n  -- Core Dimensions\n  SAFE_CAST(fmd.FinancialYear AS STRING) AS financial_year,\n  SAFE_CAST(fmd.FinancialMonthNumber AS STRING) AS financial_month_number,\n  fmd.Source AS source_dimension,\n  fmd.StaticDays AS static_days,\n  SAFE_CAST(fmd.NumDays AS STRING) AS num_days,\n  -- Calculated Display Dimensions\n  CONCAT(SAFE_CAST(fmd.StaticDays AS STRING), ' (', SAFE_CAST(((fmd.FinancialYear*100)+fmd.FinancialMonthNumber) AS STRING), ')') AS static_days_with_period,\n  CONCAT(SAFE_CAST(fmd.NumDays AS STRING), ' (', SAFE_CAST(((fmd.FinancialYear*100)+fmd.FinancialMonthNumber) AS STRING), ')') AS num_days_with_period,\n  -- Aggregated Inferred Metrics\n  SUM(fmd.spend_metric) AS total_spend,\n  SUM(fmd.revenue_metric) AS total_revenue,\n  -- Sample ProductType (from a separate table, no direct join key identified)\n  (SELECT STRING_AGG(ProductType, ', ') FROM ProductTypeData LIMIT 1) AS sample_product_types\nFROM FinMonthData fmd\nGROUP BY\n  financial_year,\n  financial_month_number,\n  source_dimension,\n  static_days,\n  num_days,\n  static_days_with_period,\n  num_days_with_period\nORDER BY financial_year DESC, financial_month_number DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.FinancialYear AS STRING) || LPAD(SAFE_CAST(t0.FinancialMonthNumber AS STRING), 2, '0')) as unique_financial_periods,\n  COUNT(DISTINCT t0.Source) as unique_sources,\n  COUNT(DISTINCT t0.StaticDays) as unique_static_days,\n  COUNT(DISTINCT t0.NumDays) as unique_num_days,\n  MIN(SAFE_CAST(t0.FinancialYear AS STRING) || LPAD(SAFE_CAST(t0.FinancialMonthNumber AS STRING), 2, '0')) as earliest_financial_period,\n  MAX(SAFE_CAST(t0.FinancialYear AS STRING) || LPAD(SAFE_CAST(t0.FinancialMonthNumber AS STRING), 2, '0')) as latest_financial_period,\n  SUM(CASE WHEN t0.CurrentMonthFlag = 1 THEN 1 ELSE 0 END) as records_flagged_current_month\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN SUM(CASE WHEN t0.CurrentMonthFlag = 1 THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as current_month_flag_test,\n  CASE WHEN COUNT(DISTINCT t0.Source) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_sources_test,\n  CASE WHEN SUM(CASE WHEN t0.Source = 'Kargo' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as kargo_source_test,\n  CASE WHEN SUM(CASE WHEN t0.Source NOT IN ('AdX') OR t0.Source IS NULL THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as non_adx_source_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\nWHERE t0.CurrentMonthFlag = 1\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'current_month_flag_consistency' as rule_name_current_month,\n  COUNT(*) as records_tested_current_month,\n  SUM(CASE WHEN t0.CurrentMonthFlag = 1 THEN 1 ELSE 0 END) as records_flagged_as_current,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.CurrentMonthFlag = 1 THEN 1 ELSE 0 END), COUNT(*)) * 100 as current_month_flag_percentage,\n  'source_kargo_filter_impact' as rule_name_kargo,\n  SUM(CASE WHEN t0.CurrentMonthFlag = 1 AND t0.Source = 'Kargo' THEN 1 ELSE 0 END) as records_kargo_filtered,\n  'source_non_adx_filter_impact' as rule_name_non_adx,\n  SUM(CASE WHEN t0.CurrentMonthFlag = 1 AND (t0.Source NOT IN ('AdX') OR t0.Source IS NULL) THEN 1 ELSE 0 END) as records_non_adx_filtered\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\nWHERE t0.CurrentMonthFlag = 1\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.CurrentMonthFlag,\n  t0.FinancialMonthNumber,\n  t0.FinancialYear,\n  t0.Source,\n  t0.StaticDays,\n  t0.NumDays,\n  -- Inferring potential metric columns for a pacing dashboard (example values)\n  SAFE_CAST(NULL AS NUMERIC) AS inferred_spend_example,\n  SAFE_CAST(NULL AS NUMERIC) AS inferred_revenue_example\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\nWHERE t0.CurrentMonthFlag = 1\nORDER BY t0.FinancialYear DESC, t0.FinancialMonthNumber DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""1""
          ],
          ""context"": ""CurrentMonthFlag is hardcoded to 1 to identify the current period."",
          ""suggested_governance"": ""Derive current month dynamically using a date dimension table or a Looker Studio parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Kargo'"",
            ""'AdX'""
          ],
          ""context"": ""Specific source names are hardcoded for filtering."",
          ""suggested_governance"": ""Manage source names in a reference table and join to it, or use Looker Studio parameters for filter values."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded 'CurrentMonthFlag = 1' with a dynamic date calculation or a Looker Studio date parameter."",
      ""Replace hardcoded source names ('Kargo', 'AdX') with Looker Studio filter controls or join to a governed source dimension table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the data, typically used for grouping and period identification."",
      ""sql_logic"": ""t0.FinancialYear"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key dimension for time-based analysis and financial reporting."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_number"",
      ""metric_name"": ""Financial Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month number within the financial year (e.g., 1 for July, 12 for June), used for ordering and period identification."",
      ""sql_logic"": ""t0.FinancialMonthNumber"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key dimension for time-based analysis and financial reporting."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_month_flag"",
      ""metric_name"": ""Current Month Flag"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag indicating if the financial month is the current month (1 for current, 0 for not). Crucial for filtering current period data."",
      ""sql_logic"": ""t0.CurrentMonthFlag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to isolate data for the most recent financial month, central to pacing analysis."",
      ""metric_category"": ""filter_control"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [
        ""Should be derived dynamically or from a governed date dimension to avoid manual updates.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on accurate flagging in source system.""
      ]
    },
    {
      ""metric_id"": ""source_dimension"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The advertising source or platform (e.g., 'Kargo', 'AdX'). Used for segmenting data."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of performance by different advertising channels or partners."",
      ""metric_category"": ""segmentation_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Kargo'"",
        ""'AdX'""
      ],
      ""governance_issues"": [
        ""Source values should be managed in a reference table for consistency and ease of maintenance.""
      ],
      ""data_quality_concerns"": [
        ""Potential for misspellings or variations if not governed.""
      ]
    },
    {
      ""metric_id"": ""static_days"",
      ""metric_name"": ""Static Days"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A static representation of days, possibly for display or grouping within the financial month context."",
      ""sql_logic"": ""t0.StaticDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely a display or grouping dimension for specific day-related segments within a month."",
      ""metric_category"": ""display_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""num_days"",
      ""metric_name"": ""Number of Days"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The number of days in the financial month, used in display calculations."",
      ""sql_logic"": ""t0.NumDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides context for the length of the financial period, potentially for normalizing metrics."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_type"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of product, used for filtering and segmenting data."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of performance by different product categories."",
      ""metric_category"": ""segmentation_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_period_id"",
      ""metric_name"": ""Financial Period ID"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""business_description"": ""A unique identifier for the financial month, combining year and month (e.g., 202307). Used as an intermediate step for display dimensions."",
      ""sql_logic"": ""(FinancialYear * 100) + FinancialMonthNumber"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Internal calculation to create a sortable and displayable financial period."",
      ""metric_category"": ""time_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""static_days_with_period"",
      ""metric_name"": ""Static Days (Financial Period)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""static_days"",
        ""financial_period_id""
      ],
      ""business_description"": ""A display dimension combining 'Static Days' with the 'Financial Period ID', used for filtering/grouping in the dashboard. Filtered for 'Kargo' source and current month."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING), ')')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source IN ('Kargo')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a user-friendly filter option for specific day-related segments within the current financial month for 'Kargo' source."",
      ""metric_category"": ""display_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Kargo'"",
        ""1""
      ],
      ""governance_issues"": [
        ""Hardcoded source value and current month flag.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""num_days_with_period"",
      ""metric_name"": ""Number of Days (Financial Period)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""num_days"",
        ""financial_period_id""
      ],
      ""business_description"": ""A display dimension combining 'Number of Days' with the 'Financial Period ID', used for filtering/grouping in the dashboard. Filtered for non-'AdX' sources and current month."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(((FinancialYear*100)+FinancialMonthNumber) AS STRING), ')')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source NOT IN ('AdX') OR Source IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a user-friendly filter option for day counts within the current financial month for non-'AdX' sources."",
      ""metric_category"": ""display_dimension"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""1""
      ],
      ""governance_issues"": [
        ""Hardcoded source value and current month flag.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend"",
      ""metric_name"": ""Total Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total advertising spend for the given period and dimensions. This metric is inferred as typical for a 'Pacing Dashboard' but not explicitly calculated in the provided SQL snippets."",
      ""sql_logic"": ""SUM(t0.Spend)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source filters (combined)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core KPI for tracking advertising budget consumption and pacing towards targets."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls if data is incomplete.""
      ]
    },
    {
      ""metric_id"": ""total_revenue"",
      ""metric_name"": ""Total Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total revenue generated for the given period and dimensions. This metric is inferred as typical for a 'Pacing Dashboard' but not explicitly calculated in the provided SQL snippets."",
      ""sql_logic"": ""SUM(t0.Revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source filters (combined)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core KPI for tracking advertising revenue generation and pacing towards targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls if data is incomplete.""
      ]
    }
  ],
  ""metric_interactions"": []
}
```",success,13
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""3ee20092-1897-49b7-8bcd-4157d5f816eb"",
    ""dashboard_name"": ""AdSales Data for Pacing Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 4,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_week"",
      ""revenue_group_subtype""
    ],
    ""date_range_detected"": ""Financial Years 2024, 2025"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'SUNDRY ADSALES OVERLAY'"",
      ""'2025'"",
      ""'2024'"",
      ""47, 48, 49, 50, 51, 52 (financial weeks)""
    ],
    ""governance_opportunities"": [
      ""Financial years should be dynamic (e.g., CURRENT_FINANCIAL_YEAR(), NEXT_FINANCIAL_YEAR())"",
      ""Financial week exclusions should be configurable or derived from a calendar table"",
      ""Revenue group subtypes should be managed in a governed lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_adsales_data AS (\n  SELECT\n    t0.financial_year,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week_int,\n    t0.revenue_group_subtype,\n    -- Assuming 'revenue_amount' and 'adsales_transaction_id' are key columns for a pacing report\n    -- These columns are inferred based on dashboard name 'AdSales Data for Pacing Report'\n    -- and table name 'adsales_performance'. Please replace with actual column names if different.\n    SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount,\n    t0.adsales_transaction_id\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    t0.financial_year IN ('2024', '2025') -- Hardcoded years from queries\n    AND (\n      t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY' -- Example filter from query 1\n      OR t0.revenue_group_subtype IS NOT NULL -- Or other relevant subtypes\n    )\n    AND (\n      SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) -- Hardcoded week exclusion from query 3\n      OR SAFE_CAST(t0.financial_week AS INT64) IS NULL\n    )\n    -- Add a reasonable date filter for performance, if a date column exists\n    -- For example, if 'report_date' exists:\n    -- AND SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n)\nSELECT\n  financial_year,\n  financial_week_int AS financial_week,\n  revenue_group_subtype,\n  SUM(revenue_amount) AS total_adsales_revenue,\n  COUNT(DISTINCT adsales_transaction_id) AS unique_adsales_transactions,\n  COUNT(*) AS record_count\nFROM base_adsales_data\nWHERE revenue_amount IS NOT NULL -- Ensure only valid revenue records are counted\nGROUP BY\n  financial_year,\n  financial_week_int,\n  revenue_group_subtype\nORDER BY\n  financial_year DESC,\n  financial_week_int DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_week AS STRING)) as unique_financial_weeks,\n  COUNT(DISTINCT t0.revenue_group_subtype) as unique_revenue_subtypes,\n  MIN(t0.financial_year) as earliest_financial_year,\n  MAX(t0.financial_year) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(t0.financial_year || '-' || SAFE_CAST(t0.financial_week AS STRING) || '-' || t0.revenue_group_subtype) as approx_unique_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE\n  t0.financial_year IN ('2024', '2025') -- Focus on relevant years for structure analysis\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(DISTINCT t0.financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_data_test,\n  CASE WHEN COUNT(DISTINCT t0.revenue_group_subtype) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_subtype_data_test,\n  CASE WHEN MAX(t0.financial_year) >= '2024' THEN 'PASS' ELSE 'FAIL' END as financial_year_freshness_test,\n  CASE WHEN SUM(CASE WHEN t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as sundry_adsales_overlay_presence_test,\n  CASE WHEN SUM(CASE WHEN SAFE_CAST(t0.financial_week AS INT64) IN (47, 48, 49, 50, 51, 52) THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as excluded_weeks_presence_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE t0.financial_year IN ('2024', '2025')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'financial_week_exclusion_rule' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE\n    WHEN t0.financial_year IN ('2024', '2025') AND (SAFE_CAST(t0.financial_week AS INT64) IN (47, 48, 49, 50, 51, 52) OR SAFE_CAST(t0.financial_week AS INT64) IS NULL)\n    THEN 1 ELSE 0\n  END) as records_matching_exclusion_criteria,\n  SUM(CASE\n    WHEN t0.financial_year IN ('2024', '2025') AND (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) AND SAFE_CAST(t0.financial_week AS INT64) IS NOT NULL)\n    THEN 1 ELSE 0\n  END) as records_passing_exclusion_criteria,\n  SAFE_DIVIDE(\n    SUM(CASE\n      WHEN t0.financial_year IN ('2024', '2025') AND (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) AND SAFE_CAST(t0.financial_week AS INT64) IS NOT NULL)\n      THEN 1 ELSE 0\n    END),\n    COUNT(*)\n  ) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE t0.financial_year IN ('2024', '2025');"",
    ""sample_data_sql"": ""SELECT\n  t0.financial_year,\n  SAFE_CAST(t0.financial_week AS INT64) AS financial_week,\n  t0.revenue_group_subtype,\n  -- Assuming 'revenue_amount' and 'adsales_transaction_id' are present\n  SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount,\n  t0.adsales_transaction_id\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE\n  t0.financial_year IN ('2024', '2025')\n  AND SAFE_CAST(t0.financial_week AS INT64) IS NOT NULL\n  AND t0.revenue_group_subtype IS NOT NULL\nORDER BY\n  t0.financial_year DESC,\n  SAFE_CAST(t0.financial_week AS INT64) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SUNDRY ADSALES OVERLAY'""
          ],
          ""context"": ""Specific revenue group subtype used as a filter."",
          ""suggested_governance"": ""This value should ideally be managed in a reference table for revenue group subtypes, allowing for easier updates and consistency."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'2025'"",
            ""'2024'""
          ],
          ""context"": ""Specific financial years used as filters."",
          ""suggested_governance"": ""These should be replaced with dynamic calculations (e.g., `CURRENT_FINANCIAL_YEAR()`, `NEXT_FINANCIAL_YEAR()`) or user-selectable parameters to avoid manual updates."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""47, 48, 49, 50, 51, 52""
          ],
          ""context"": ""Specific financial weeks excluded from analysis."",
          ""suggested_governance"": ""These week numbers represent a business rule (e.g., year-end blackout). This rule should be defined in a configuration table or a calendar dimension table, rather than hardcoded in queries."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with dynamic expressions or dashboard parameters."",
      ""Externalize the list of excluded financial weeks into a configuration table or a calendar dimension."",
      ""Manage 'SUNDRY ADSALES OVERLAY' and other revenue group subtypes in a governed lookup table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year for which the ad sales data is reported. Used as a primary filtering and grouping dimension."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for time-series analysis and comparing performance across different financial periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""'2024'""
      ],
      ""governance_issues"": [
        ""Hardcoded values for filtering should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""safe_cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week within the financial year. Used for granular time-series analysis and specific period exclusions."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Essential for weekly pacing reports and identifying performance trends within a year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""47, 48, 49, 50, 51, 52""
      ],
      ""governance_issues"": [
        ""Hardcoded values for exclusion should be externalized.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls or non-numeric values requiring SAFE_CAST.""
      ]
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A categorization of revenue, used for filtering and segmenting ad sales performance."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows for analysis of specific revenue streams or business segments within ad sales."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'SUNDRY ADSALES OVERLAY'""
      ],
      ""governance_issues"": [
        ""Hardcoded values for filtering should be managed in a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_adsales_revenue"",
      ""metric_name"": ""Total AdSales Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly_yearly_subtype"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_week"",
        ""revenue_group_subtype""
      ],
      ""business_description"": ""The sum of revenue generated from ad sales, aggregated by financial year, week, and revenue group subtype. This metric is inferred as the primary measure for a 'Pacing Report'."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.revenue_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2024', '2025')"",
        ""financial_week NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL"",
        ""revenue_group_subtype = 'SUNDRY ADSALES OVERLAY' (or other relevant subtypes)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The core metric for tracking ad sales performance against targets and identifying pacing trends."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""'2024'"",
        ""47, 48, 49, 50, 51, 52"",
        ""'SUNDRY ADSALES OVERLAY'""
      ],
      ""governance_issues"": [
        ""All filters are hardcoded and should be parameterized or externalized.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on accurate 'revenue_amount' data."",
        ""Potential for nulls in 'revenue_amount' requiring SAFE_CAST and null handling.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_adsales_revenue"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_week"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""The 'Total AdSales Revenue' is directly impacted by filters applied to 'Financial Year', 'Financial Week', and 'Revenue Group Subtype'. Specific financial years (2024, 2025) and an exclusion of certain financial weeks (47-52) are applied, along with filtering by specific revenue subtypes (e.g., 'SUNDRY ADSALES OVERLAY')."",
      ""mathematical_formula"": ""SUM(revenue_amount) WHERE financial_year IN (...) AND financial_week NOT IN (...) AND revenue_group_subtype IN (...)"",
      ""business_validation"": ""This interaction ensures that the reported revenue aligns with specific reporting periods and business segments, crucial for accurate pacing and performance analysis."",
      ""validation_sql"": ""SELECT\n  financial_year,\n  financial_week_int AS financial_week,\n  revenue_group_subtype,\n  SUM(revenue_amount) AS filtered_revenue\nFROM (\n  SELECT\n    t0.financial_year,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week_int,\n    t0.revenue_group_subtype,\n    SAFE_CAST(t0.revenue_amount AS NUMERIC) AS revenue_amount\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    t0.financial_year IN ('2024', '2025')\n    AND (SAFE_CAST(t0.financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR SAFE_CAST(t0.financial_week AS INT64) IS NULL)\n    AND t0.revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'\n) AS filtered_data\nGROUP BY 1, 2, 3\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,14
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b9dfd2f4-92fa-4f81-a5b1-17de880470f9"",
    ""dashboard_name"": ""Contra Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard;ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily;ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data"",
    ""business_domain"": ""finance|sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""advertiser_name"",
      ""adpoint_account_number"",
      ""financial_year"",
      ""financial_month"",
      ""portfolio_conformed_name_current"",
      ""revenue_type"",
      ""current_portfolio_conformed_owner_full"",
      ""nca_industry_pillar"",
      ""sales_segment_gm_name"",
      ""grouped_advertiser_name""
    ],
    ""date_range_detected"": ""Historical (based on financial periods)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Contra'"",
      ""'Renee Sycamore'"",
      ""'ctr'"",
      ""'Guaranteed'"",
      ""'Exchange'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'-'"",
      ""'VACANT'"",
      ""'13019'"",
      ""'52246'"",
      ""'18387'"",
      ""'ctr1'"",
      ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'"",
      ""'CTR_2023_AFL SPORT'"",
      ""'CTR_2023_GWS GIANTS'"",
      ""'CTR_2023_SYDNEY SWANS'"",
      ""'CTR_2025_Greater Western Sydney Giants'"",
      ""'CTR_2025_Raising Literacy Australia'""
    ],
    ""governance_opportunities"": [
      ""Hardcoded filter values (e.g., 'Contra', 'Renee Sycamore') should be managed via parameters or lookup tables."",
      ""Complex CASE statements for grouping advertiser names should be externalized into a mapping table."",
      ""Specific account numbers and publication names in WHERE clauses should be managed in configuration tables."",
      ""The `contra_sheet_data` lookup should be a governed reference table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates the primary revenue calculation and key dimensions for 'Contra Report'.\n-- It focuses on the most complex query (job_g0C_QrpRueq_Y03aHpxOoN1xe-AU) which calculates gross revenue.\n-- It includes derived dimensions and applies all specified business rules and filters.\n\nWITH ContraSheetAccounts AS (\n  SELECT DISTINCT\n    NMBS_T_Number\n  FROM\n    `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`\n),\nBaseRevenueData AS (\n  SELECT\n    t0.financial_year,\n    SAFE_CAST(t0.financial_month AS INT64) AS financial_month_no,\n    t0.financial_short_month,\n    t0.calendar_year_month,\n    t0.sales_segment_gm_name,\n    t0.portfolio_conformed_name_current,\n    IFNULL(t0.current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n    t0.advertiser_name,\n    t0.adpoint_account_number,\n    t0.revenue_type,\n    t0.gross_revenue_amount,\n    CASE\n      WHEN t0.adpoint_account_number IN (SELECT NMBS_T_Number FROM ContraSheetAccounts) THEN 'Y'\n      ELSE 'N'\n    END AS sheet_account_flag\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` AS t0\n  WHERE\n    LOWER(LEFT(t0.advertiser_name, 3)) = 'ctr'\n    AND NOT (t0.cost_model_type = 'Guaranteed' AND t0.revenue_group_name = 'Exchange')\n    AND UPPER(IFNULL(t0.revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n    AND UPPER(IFNULL(t0.style_name, 'XXX')) <> 'ROP COMPOSITE'\n    AND UPPER(IFNULL(t0.source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n    AND (\n      UPPER(IFNULL(t0.publication_name, 'XXX')) NOT LIKE 'SUDDENLY%'\n      OR (\n        UPPER(t0.publication_name) LIKE 'SUDDENLY%'\n        AND (\n          t0.account_number IN ('17114', '29172', '52809')\n          OR t0.adtype_name = '-'\n        )\n      )\n    )\n    -- Add a date filter for performance and relevance, assuming calendar_year_month is 'YYYY-MM'\n    AND SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH)\n)\nSELECT\n  financial_year,\n  financial_month_no,\n  financial_short_month,\n  calendar_year_month,\n  sales_segment_gm_name,\n  portfolio_conformed_name_current,\n  current_portfolio_conformed_owner_full,\n  advertiser_name,\n  adpoint_account_number,\n  revenue_type,\n  CASE\n    WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'\n    ELSE advertiser_name\n  END AS grouped_advertiser_name,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount\nFROM\n  BaseRevenueData\nGROUP BY\n  financial_year,\n  financial_month_no,\n  financial_short_month,\n  calendar_year_month,\n  sales_segment_gm_name,\n  portfolio_conformed_name_current,\n  current_portfolio_conformed_owner_full,\n  advertiser_name,\n  adpoint_account_number,\n  revenue_type,\n  grouped_advertiser_name\nORDER BY\n  calendar_year_month DESC, total_gross_revenue_amount DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'v_adsales_revenue_client_daily' AS source_table,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(calendar_year_month || '-01' AS DATE)) AS unique_months,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT adpoint_account_number) AS unique_adpoint_accounts,\n  MIN(SAFE_CAST(calendar_year_month || '-01' AS DATE)) AS earliest_month,\n  MAX(SAFE_CAST(calendar_year_month || '-01' AS DATE)) AS latest_month,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(adpoint_account_number AS STRING), '-', SAFE_CAST(calendar_year_month AS STRING), '-', revenue_type)) AS approx_unique_transactions_grain\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nUNION ALL\nSELECT\n  'details_dashboard' AS source_table,\n  COUNT(*) AS total_records,\n  NULL AS unique_months, -- Date dimensions not directly present in this query's usage\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT adpoint_account_number) AS unique_adpoint_accounts,\n  NULL AS earliest_month,\n  NULL AS latest_month,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(account_number AS STRING), '-', SAFE_CAST(adpoint_account_number AS STRING))) AS approx_unique_account_pairs\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nLIMIT 1000;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is present\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_present_test,\n  CASE WHEN MAX(SAFE_CAST(calendar_year_month || '-01' AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN LOWER(LEFT(advertiser_name, 3)) = 'ctr' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS contra_data_present_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Revenue Transaction Status' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Contra Advertiser Prefix' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN LOWER(LEFT(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN LOWER(LEFT(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1000;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) AS month_start_date,\n  financial_year,\n  financial_short_month,\n  advertiser_name,\n  adpoint_account_number,\n  revenue_type,\n  gross_revenue_amount,\n  sales_segment_gm_name,\n  portfolio_conformed_name_current,\n  current_portfolio_conformed_owner_full_name_current,\n  revenue_transaction_status,\n  cost_model_type,\n  revenue_group_name,\n  style_name,\n  source_publishing_division,\n  publication_name,\n  account_number,\n  adtype_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(calendar_year_month || '-01' AS DATE) DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Contra'"",
            ""'Renee Sycamore'""
          ],
          ""context"": ""Filtering `nca_industry_pillar` and `sales_segment_gm_name` in `details_dashboard`."",
          ""suggested_governance"": ""These values should be managed as dashboard parameters or linked to a sales hierarchy/segmentation lookup table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'ctr'"",
            ""'Guaranteed'"",
            ""'Exchange'"",
            ""'BILLED'"",
            ""'BOOKED'"",
            ""'ROP COMPOSITE'"",
            ""'MEDIUM RARE CONTENT AGENCY'"",
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'"",
            ""'-'"",
            ""'VACANT'""
          ],
          ""context"": ""Extensive filtering and data transformation logic for `gross_revenue_amount` calculation."",
          ""suggested_governance"": ""These business rules (e.g., valid transaction statuses, excluded cost models, publication rules) should be defined in a central configuration table and joined to the main data, rather than hardcoded in SQL."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'13019'"",
            ""'52246'"",
            ""'18387'""
          ],
          ""context"": ""Grouping specific `adpoint_account_number` values into a single `grouped_advertiser_name`."",
          ""suggested_governance"": ""These account groupings should be defined in a separate `advertiser_group_mapping` table, allowing for flexible updates without modifying SQL."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CTR_2023_AFL SPORT'"",
            ""'CTR_2023_GWS GIANTS'"",
            ""'CTR_2023_SYDNEY SWANS'"",
            ""'CTR_2025_Greater Western Sydney Giants'"",
            ""'CTR_2025_Raising Literacy Australia'""
          ],
          ""context"": ""Filtering `advertiser_name` for `record_count_by_account`."",
          ""suggested_governance"": ""These specific advertiser names should be managed in a lookup table for 'Contra Accounts of Interest' or similar, allowing for dynamic updates."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded filter values (e.g., 'Contra', 'Renee Sycamore') with Looker Studio parameters or dynamic filters."",
      ""Externalize complex business rules and account groupings into governed lookup/configuration tables."",
      ""Consider using a date parameter for the `calendar_year_month` filter to allow users to select reporting periods.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue generated, filtered by specific business rules and categorized as 'Contra' revenue."",
      ""sql_logic"": ""SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily"",
        ""ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data""
      ],
      ""filters_applied"": [
        ""LOWER(LEFT(advertiser_name, 3)) = 'ctr'"",
        ""NOT (cost_model_type = 'Guaranteed' AND revenue_group_name = 'Exchange')"",
        ""UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (account_number IN ('17114', '29172', '52809') OR adtype_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is the primary financial metric for the 'Contra Report', indicating the revenue contribution from specific contra agreements."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ctr'"",
        ""'Guaranteed'"",
        ""'Exchange'"",
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'"",
        ""'-'""
      ],
      ""governance_issues"": [
        ""Hardcoded business rules for exclusions and inclusions."",
        ""Reliance on a subquery for `contra_sheet_data` instead of a direct join to a governed lookup.""
      ],
      ""data_quality_concerns"": [
        ""Potential for missing `gross_revenue_amount` values if not handled by `SUM`."",
        ""Accuracy depends on the completeness and correctness of `v_adsales_revenue_client_daily` and `contra_sheet_data`.""
      ]
    },
    {
      ""metric_id"": ""grouped_advertiser_name"",
      ""metric_name"": ""Grouped Advertiser Name"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A derived dimension that groups specific advertiser accounts (e.g., AFL Sports, Sydney Swans, GWS Giants) under a single 'CTR_2023_AFL Sports...' label, otherwise uses the original advertiser name."",
      ""sql_logic"": ""CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for consolidated reporting of revenue for key contra accounts, simplifying dashboard views."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'13019'"",
        ""'52246'"",
        ""'18387'"",
        ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
      ],
      ""governance_issues"": [
        ""Hardcoded account numbers and group names; should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correct and up-to-date mapping of account numbers to group names.""
      ]
    },
    {
      ""metric_id"": ""current_portfolio_owner_full"",
      ""metric_name"": ""Current Portfolio Owner Full"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The full name of the current portfolio owner, defaulting to 'VACANT' if the name is null. Used for filtering and displaying responsible parties."",
      ""sql_logic"": ""IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""nca_industry_pillar = 'Contra'"",
        ""sales_segment_gm_name IN ('Renee Sycamore')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables filtering and analysis of contra revenue by the responsible sales portfolio owner."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'"",
        ""'Contra'"",
        ""'Renee Sycamore'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values for `nca_industry_pillar` and `sales_segment_gm_name`.""
      ],
      ""data_quality_concerns"": [
        ""Relies on the accuracy of `current_portfolio_conformed_owner_full_name_current`.""
      ]
    },
    {
      ""metric_id"": ""record_count_by_account"",
      ""metric_name"": ""Record Count by Account"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A count of records per `account_number` and `adpoint_account_number` for a specific list of 'Contra' advertisers."",
      ""sql_logic"": ""COUNT(1) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of underlying records for specific contra accounts, potentially used for data validation or detailed drill-downs."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CTR_2023_AFL SPORT'"",
        ""'CTR_2023_GWS GIANTS'"",
        ""'CTR_2023_SYDNEY SWANS'"",
        ""'CTR_2025_Greater Western Sydney Giants'"",
        ""'CTR_2025_Raising Literacy Australia'""
      ],
      ""governance_issues"": [
        ""Hardcoded list of advertiser names; should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the completeness of `details_dashboard` for these specific advertisers.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""current_portfolio_owner_full"",
        ""grouped_advertiser_name""
      ],
      ""relationship_description"": ""The filters applied to `current_portfolio_owner_full` (e.g., 'Contra' industry pillar, 'Renee Sycamore' sales segment) and the grouping logic of `grouped_advertiser_name` directly constrain and define the `total_gross_revenue_amount` being reported. These filters are likely applied at a dashboard level, affecting all related metrics."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the reported revenue is specific to the 'Contra' segment and relevant sales personnel, and can be viewed at a consolidated advertiser level."",
      ""validation_sql"": ""-- Validate that revenue is only reported for 'Contra' pillar and specific sales segment\nSELECT\n  SUM(CASE WHEN t0.nca_industry_pillar = 'Contra' AND t0.sales_segment_gm_name IN ('Renee Sycamore') THEN t0.gross_revenue_amount ELSE 0 END) AS contra_revenue_filtered,\n  SUM(t0.gross_revenue_amount) AS total_revenue_unfiltered\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  SAFE_CAST(t0.calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""grouped_advertiser_name""
      ],
      ""relationship_description"": ""The `total_gross_revenue_amount` is aggregated and presented using the `grouped_advertiser_name` dimension. This means the revenue figures are rolled up according to the custom grouping logic defined in `grouped_advertiser_name`."",
      ""mathematical_formula"": ""SUM(total_gross_revenue_amount) GROUP BY grouped_advertiser_name"",
      ""business_validation"": ""Allows business users to see consolidated revenue for key contra accounts, rather than individual advertiser accounts, simplifying high-level analysis."",
      ""validation_sql"": ""-- Validate that grouped revenue sums correctly\nWITH GroupedRevenue AS (\n  SELECT\n    CASE\n      WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'\n      ELSE advertiser_name\n    END AS grouped_advertiser_name,\n    SUM(gross_revenue_amount) AS sum_gross_revenue\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\n  WHERE\n    LOWER(LEFT(advertiser_name, 3)) = 'ctr'\n    AND SAFE_CAST(calendar_year_month || '-01' AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\n  GROUP BY\n    grouped_advertiser_name\n)\nSELECT\n  grouped_advertiser_name,\n  sum_gross_revenue\nFROM\n  GroupedRevenue\nWHERE\n  grouped_advertiser_name = 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,15
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e9d8a216-4950-4d30-b344-5011776edbdf"",
    ""dashboard_name"": ""Adex Report"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"",
    ""business_domain"": ""marketing"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""date"",
      ""Major_Category"",
      ""Media_Network"",
      ""Media_Group"",
      ""Media_Type"",
      ""is_current_period_flag""
    ],
    ""date_range_detected"": ""Dynamic (based on MIN/MAX date in adex_datasource) with hardcoded analysis periods (Aug 2023 - Jun 2024 and Aug 2022 - Jun 2023)"",
    ""hardcoded_dates_found"": [
      ""Aug 23 (2023-08-01)"",
      ""Jun 24 (2024-06-01)""
    ],
    ""hardcoded_values_found"": [
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Retail'"",
      ""'NEWS CORP'""
    ],
    ""governance_opportunities"": [
      ""Dates for current and previous periods should be parameterized or derived dynamically (e.g., based on current month/year)."",
      ""Month name to number mapping should use a standard date function or a lookup table instead of a large CASE statement."",
      ""Specific category ('Retail') and media network ('NEWS CORP') names should be managed via configuration tables or parameters if they are subject to change or require dynamic selection.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all metrics and dimensions identified from the Looker Studio dashboard SQL samples.\n-- It uses the common base data source and applies the specific date range and conditional logic.\n-- The date ranges 'Aug 23 - Jun 24' and 'Aug 22 - Jun 23' are hardcoded as per the original queries.\n\nWITH\n  -- Define hardcoded date parameters for clarity and potential future parameterization\n  date_params AS (\n    SELECT\n      PARSE_DATE('%Y-%m-%d', '2023-08-01') AS current_period_start_date,\n      PARSE_DATE('%Y-%m-%d', '2024-06-01') AS current_period_end_date\n  ),\n  adex_data AS (\n    SELECT\n      * EXCEPT(latest_date, spend_monthly_agg, calendar_month_short_name, calendar_year)\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  ),\n  adex_date_fact AS (\n    SELECT\n      Media_Type,\n      portfolio_parent_group_name,\n      date,\n      DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n      DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n    FROM\n      (\n        SELECT DISTINCT\n          Media_Type,\n          portfolio_parent_group_name\n        FROM\n          adex_data\n      )\n      CROSS JOIN\n      UNNEST(GENERATE_DATE_ARRAY((\n          SELECT\n            MIN(date)\n          FROM\n            adex_data\n        ), (\n          SELECT\n            MAX(date)\n          FROM\n            adex_data\n        ), INTERVAL 1 MONTH)) AS date\n  ),\n  adex_full_date AS (\n    SELECT\n      adf.*,\n      financial_year,\n      Major_Category,\n      Advertiser_Group___Advertiser,\n      Advertiser,\n      Media_Network,\n      Media_Group,\n      Ad_Type,\n      Brand,\n      Product,\n      Category,\n      Sub_Category,\n      account_number,\n      portfolio_group_name,\n      portfolio_conformed_name,\n      Spend,\n      sales_segment_gm_name\n    FROM\n      adex_date_fact AS adf\n      LEFT JOIN\n      adex_data\n      ON adf.date = adex_data.date AND adf.Media_Type = adex_data.Media_Type AND adf.portfolio_parent_group_name =\n        adex_data.portfolio_parent_group_name\n  ),\n  base_adex_data AS (\n    SELECT\n      afd.*,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year,\n      SUM(Spend) OVER (PARTITION BY date) AS spend_monthly_agg,\n      (SELECT MAX(date) FROM adex_full_date) AS latest_date -- Re-evaluate latest_date for the full dataset\n    FROM\n      adex_full_date AS afd\n    -- Apply a reasonable date filter for performance in primary_analysis_sql\n    WHERE afd.date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) OR afd.date IS NULL -- Include nulls from adex_date_fact if they fall in range\n  )\nSELECT\n  SAFE_CAST(t0.date AS DATE) AS report_date,\n  t0.Major_Category,\n  t0.Media_Network,\n  t0.Media_Group,\n  t0.Media_Type,\n  -- Boolean flag for current period, used as a dimension in one query\n  (t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) AS is_current_period_flag,\n  \n  -- Metrics\n  SUM(t0.Spend) AS total_spend,\n  SUM(CASE WHEN (t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) THEN t0.Spend ELSE 0 END) AS spend_current_period,\n  SUM(CASE WHEN (t0.date >= DATETIME_ADD(dp.current_period_start_date, INTERVAL -12 MONTH) AND t0.date <= DATETIME_ADD(dp.current_period_end_date, INTERVAL -12 MONTH)) THEN t0.Spend ELSE 0 END) AS spend_previous_year,\n  SUM(CASE WHEN (t0.Media_Network = 'NEWS CORP' AND t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) THEN t0.Spend ELSE 0 END) AS spend_news_corp_current_period,\n  SUM(CASE WHEN (t0.Media_Network = 'NEWS CORP' AND t0.date >= DATETIME_ADD(dp.current_period_start_date, INTERVAL -12 MONTH) AND t0.date <= DATETIME_ADD(dp.current_period_end_date, INTERVAL -12 MONTH)) THEN t0.Spend ELSE 0 END) AS spend_news_corp_previous_year,\n  SUM(CASE WHEN (t0.Major_Category = 'Retail' AND t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) THEN t0.Spend ELSE 0 END) AS spend_retail_current_period\nFROM\n  base_adex_data AS t0\nCROSS JOIN\n  date_params AS dp\nGROUP BY\n  report_date,\n  t0.Major_Category,\n  t0.Media_Network,\n  t0.Media_Group,\n  t0.Media_Type,\n  is_current_period_flag\nORDER BY\n  report_date DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(date AS DATE)) AS unique_dates_in_sample,\n  COUNT(DISTINCT Media_Type) AS unique_media_types,\n  COUNT(DISTINCT Major_Category) AS unique_major_categories,\n  COUNT(DISTINCT Media_Network) AS unique_media_networks,\n  COUNT(DISTINCT Media_Group) AS unique_media_groups,\n  MIN(SAFE_CAST(date AS DATE)) AS earliest_date_in_sample,\n  MAX(SAFE_CAST(date AS DATE)) AS latest_date_in_sample,\n  AVG(SAFE_CAST(Spend AS NUMERIC)) AS average_spend,\n  SUM(CASE WHEN Spend IS NULL THEN 1 ELSE 0 END) AS null_spend_count\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) -- Limit to recent data for sampling\nLIMIT 1000;\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and return expected types\nWITH\n  date_params AS (\n    SELECT\n      PARSE_DATE('%Y-%m-%d', '2023-08-01') AS current_period_start_date,\n      PARSE_DATE('%Y-%m-%d', '2024-06-01') AS current_period_end_date\n  ),\n  adex_data AS (\n    SELECT\n      * EXCEPT(latest_date, spend_monthly_agg, calendar_month_short_name, calendar_year)\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  ),\n  adex_date_fact AS (\n    SELECT\n      Media_Type,\n      portfolio_parent_group_name,\n      date,\n      DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n      DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n    FROM\n      (\n        SELECT DISTINCT\n          Media_Type,\n          portfolio_parent_group_name\n        FROM\n          adex_data\n      )\n      CROSS JOIN\n      UNNEST(GENERATE_DATE_ARRAY((\n          SELECT\n            MIN(date)\n          FROM\n            adex_data\n        ), (\n          SELECT\n            MAX(date)\n          FROM\n            adex_data\n        ), INTERVAL 1 MONTH)) AS date\n  ),\n  adex_full_date AS (\n    SELECT\n      adf.*,\n      financial_year,\n      Major_Category,\n      Advertiser_Group___Advertiser,\n      Advertiser,\n      Media_Network,\n      Media_Group,\n      Ad_Type,\n      Brand,\n      Product,\n      Category,\n      Sub_Category,\n      account_number,\n      portfolio_group_name,\n      portfolio_conformed_name,\n      Spend,\n      sales_segment_gm_name\n    FROM\n      adex_date_fact AS adf\n      LEFT JOIN\n      adex_data\n      ON adf.date = adex_data.date AND adf.Media_Type = adex_data.Media_Type AND adf.portfolio_parent_group_name =\n        adex_data.portfolio_parent_group_name\n  ),\n  base_adex_data AS (\n    SELECT\n      afd.*,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year,\n      SUM(Spend) OVER (PARTITION BY date) AS spend_monthly_agg,\n      (SELECT MAX(date) FROM adex_full_date) AS latest_date\n    FROM\n      adex_full_date AS afd\n    WHERE afd.date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) OR afd.date IS NULL\n  )\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.Spend AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_spend_test,\n  CASE WHEN SUM(CASE WHEN (t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) THEN t0.Spend ELSE 0 END) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS current_period_spend_test,\n  CASE WHEN SUM(CASE WHEN t0.Major_Category = 'Retail' THEN t0.Spend ELSE 0 END) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS retail_spend_test,\n  CASE WHEN MAX(SAFE_CAST(t0.date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test\nFROM\n  base_adex_data AS t0\nCROSS JOIN\n  date_params AS dp\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nWITH\n  date_params AS (\n    SELECT\n      PARSE_DATE('%Y-%m-%d', '2023-08-01') AS current_period_start_date,\n      PARSE_DATE('%Y-%m-%d', '2024-06-01') AS current_period_end_date\n  ),\n  adex_data AS (\n    SELECT\n      * EXCEPT(latest_date, spend_monthly_agg, calendar_month_short_name, calendar_year)\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  ),\n  adex_date_fact AS (\n    SELECT\n      Media_Type,\n      portfolio_parent_group_name,\n      date,\n      DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n      DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n    FROM\n      (\n        SELECT DISTINCT\n          Media_Type,\n          portfolio_parent_group_name\n        FROM\n          adex_data\n      )\n      CROSS JOIN\n      UNNEST(GENERATE_DATE_ARRAY((\n          SELECT\n            MIN(date)\n          FROM\n            adex_data\n        ), (\n          SELECT\n            MAX(date)\n          FROM\n            adex_data\n        ), INTERVAL 1 MONTH)) AS date\n  ),\n  adex_full_date AS (\n    SELECT\n      adf.*,\n      financial_year,\n      Major_Category,\n      Advertiser_Group___Advertiser,\n      Advertiser,\n      Media_Network,\n      Media_Group,\n      Ad_Type,\n      Brand,\n      Product,\n      Category,\n      Sub_Category,\n      account_number,\n      portfolio_group_name,\n      portfolio_conformed_name,\n      Spend,\n      sales_segment_gm_name\n    FROM\n      adex_date_fact AS adf\n      LEFT JOIN\n      adex_data\n      ON adf.date = adex_data.date AND adf.Media_Type = adex_data.Media_Type AND adf.portfolio_parent_group_name =\n        adex_data.portfolio_parent_group_name\n  ),\n  base_adex_data AS (\n    SELECT\n      afd.*,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year,\n      SUM(Spend) OVER (PARTITION BY date) AS spend_monthly_agg,\n      (SELECT MAX(date) FROM adex_full_date) AS latest_date\n    FROM\n      adex_full_date AS afd\n    WHERE afd.date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) OR afd.date IS NULL\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'News Corp Spend' AS rule_name,\n  COUNT(DISTINCT t0.date) AS distinct_months_with_news_corp_spend,\n  SUM(CASE WHEN t0.Media_Network = 'NEWS CORP' THEN t0.Spend ELSE 0 END) AS total_news_corp_spend,\n  SUM(CASE WHEN t0.Major_Category = 'Retail' THEN t0.Spend ELSE 0 END) AS total_retail_spend,\n  SUM(CASE WHEN t0.Spend < 0 THEN 1 ELSE 0 END) AS negative_spend_records,\n  SUM(CASE WHEN t0.Spend IS NULL THEN 1 ELSE 0 END) AS null_spend_records_in_range,\n  SUM(CASE WHEN t0.date IS NULL THEN 1 ELSE 0 END) AS null_date_records\nFROM\n  base_adex_data AS t0\nCROSS JOIN\n  date_params AS dp\nWHERE\n  (t0.date >= dp.current_period_start_date AND t0.date <= dp.current_period_end_date) OR\n  (t0.date >= DATETIME_ADD(dp.current_period_start_date, INTERVAL -12 MONTH) AND t0.date <= DATETIME_ADD(dp.current_period_end_date, INTERVAL -12 MONTH))\nLIMIT 1;\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(date AS DATE) AS date_column,\n  Media_Type,\n  portfolio_parent_group_name,\n  Major_Category,\n  Advertiser,\n  Media_Network,\n  Media_Group,\n  Ad_Type,\n  Brand,\n  Product,\n  Category,\n  Sub_Category,\n  SAFE_CAST(Spend AS NUMERIC) AS spend_metric,\n  financial_year\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH) -- Get recent data\n  AND Spend IS NOT NULL\nORDER BY\n  date_column DESC, spend_metric DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2023-08-01"",
          ""original_format"": ""'Aug 23'"",
          ""context"": ""Start date for the 'current period' calculation. Derived from 'Aug 23'."",
          ""suggested_fix"": ""Replace with a dynamic date parameter (e.g., `DATE_TRUNC(CURRENT_DATE(), MONTH)` or a user-selected date parameter)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-06-01"",
          ""original_format"": ""'Jun 24'"",
          ""context"": ""End date for the 'current period' calculation. Derived from 'Jun 24'."",
          ""suggested_fix"": ""Replace with a dynamic date parameter (e.g., `LAST_DAY(CURRENT_DATE(), MONTH)` or a user-selected date parameter)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Month names are hardcoded in a CASE statement to convert to month numbers for date parsing."",
          ""suggested_governance"": ""Use BigQuery's `EXTRACT(MONTH FROM PARSE_DATE('%b %y', month_year_string))` or `FORMAT_DATE('%m', date_column)` directly, or a small lookup table if the format is truly non-standard."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Retail'""
          ],
          ""context"": ""Specific 'Major_Category' value used for conditional spend calculation."",
          ""suggested_governance"": ""If 'Retail' is a dynamic business segment, it should be a parameter or part of a business segment lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'NEWS CORP'""
          ],
          ""context"": ""Specific 'Media_Network' value used for conditional spend calculation."",
          ""suggested_governance"": ""If 'NEWS CORP' is a dynamic media network, it should be a parameter or part of a media network lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded date strings ('Aug 23', 'Jun 24') with dashboard date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Create a small UDF or a lookup table for month name to number conversion to avoid repetitive CASE statements."",
      ""Parameterize specific category and media network filters ('Retail', 'NEWS CORP') to allow for dynamic analysis without modifying SQL.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_spend"",
      ""metric_name"": ""Total Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total advertising spend across all media types and categories, without specific date range filtering beyond the overall data availability."",
      ""sql_logic"": ""SUM(Spend)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides an overall baseline for advertising expenditure."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in Spend column.""
      ]
    },
    {
      ""metric_id"": ""spend_current_period"",
      ""metric_name"": ""Spend (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total advertising spend for the defined 'current period' (Aug 2023 - Jun 2024)."",
      ""sql_logic"": ""SUM(CASE WHEN (date >= PARSE_DATE('%Y-%m-%d', '2023-08-01') AND date <= PARSE_DATE('%Y-%m-%d', '2024-06-01')) THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date between '2023-08-01' and '2024-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for analyzing recent performance and comparing against previous periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Date range is hardcoded and should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_previous_year"",
      ""metric_name"": ""Spend (Previous Year)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_current_period""
      ],
      ""business_description"": ""The total advertising spend for the period exactly 12 months prior to the 'current period' (Aug 2022 - Jun 2023)."",
      ""sql_logic"": ""SUM(CASE WHEN (date >= DATETIME_ADD(PARSE_DATE('%Y-%m-%d', '2023-08-01'), INTERVAL -12 MONTH) AND date <= DATETIME_ADD(PARSE_DATE('%Y-%m-%d', '2024-06-01'), INTERVAL -12 MONTH)) THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date between '2022-08-01' and '2023-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparison to assess growth or decline."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Date range is hardcoded and derived from current period dates, which should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_news_corp_current_period"",
      ""metric_name"": ""Spend (News Corp, Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_current_period""
      ],
      ""business_description"": ""Advertising spend specifically for 'NEWS CORP' media network within the 'current period' (Aug 2023 - Jun 2024)."",
      ""sql_logic"": ""SUM(CASE WHEN (Media_Network = 'NEWS CORP' AND date >= PARSE_DATE('%Y-%m-%d', '2023-08-01') AND date <= PARSE_DATE('%Y-%m-%d', '2024-06-01')) THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""Media_Network = 'NEWS CORP'"",
        ""date between '2023-08-01' and '2024-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the performance of a specific key media network."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NEWS CORP'""
      ],
      ""governance_issues"": [
        ""Date range is hardcoded and should be parameterized."",
        ""Media network name is hardcoded and could benefit from a lookup table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_news_corp_previous_year"",
      ""metric_name"": ""Spend (News Corp, Previous Year)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_news_corp_current_period"",
        ""spend_previous_year""
      ],
      ""business_description"": ""Advertising spend specifically for 'NEWS CORP' media network within the previous year period (Aug 2022 - Jun 2023)."",
      ""sql_logic"": ""SUM(CASE WHEN (Media_Network = 'NEWS CORP' AND date >= DATETIME_ADD(PARSE_DATE('%Y-%m-%d', '2023-08-01'), INTERVAL -12 MONTH) AND date <= DATETIME_ADD(PARSE_DATE('%Y-%m-%d', '2024-06-01'), INTERVAL -12 MONTH)) THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""Media_Network = 'NEWS CORP'"",
        ""date between '2022-08-01' and '2023-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Enables year-over-year comparison for the 'NEWS CORP' media network."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NEWS CORP'""
      ],
      ""governance_issues"": [
        ""Date range is hardcoded and derived from current period dates, which should be parameterized."",
        ""Media network name is hardcoded and could benefit from a lookup table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_retail_current_period"",
      ""metric_name"": ""Spend (Retail, Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_current_period""
      ],
      ""business_description"": ""Advertising spend specifically for the 'Retail' major category within the 'current period' (Aug 2023 - Jun 2024)."",
      ""sql_logic"": ""SUM(CASE WHEN (Major_Category = 'Retail' AND date >= PARSE_DATE('%Y-%m-%d', '2023-08-01') AND date <= PARSE_DATE('%Y-%m-%d', '2024-06-01')) THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""Major_Category = 'Retail'"",
        ""date between '2023-08-01' and '2024-06-01'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the performance of a specific key industry category."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Retail'""
      ],
      ""governance_issues"": [
        ""Date range is hardcoded and should be parameterized."",
        ""Category name is hardcoded and could benefit from a lookup table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_current_period_flag"",
      ""metric_name"": ""Is Current Period Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A boolean flag indicating if a given date falls within the defined 'current period' (Aug 2023 - Jun 2024)."",
      ""sql_logic"": ""(date >= PARSE_DATE('%Y-%m-%d', '2023-08-01') AND date <= PARSE_DATE('%Y-%m-%d', '2024-06-01'))"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for filtering or grouping data by the current analysis period."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2023-08-01"",
        ""2024-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Date range is hardcoded and should be parameterized.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""spend_current_period"",
      ""related_metrics"": [
        ""spend_previous_year""
      ],
      ""relationship_description"": ""Year-over-year comparison of total spend. Often used to calculate percentage change (YoY Growth = (Current - Previous) / Previous)."",
      ""mathematical_formula"": ""YoY Growth = (spend_current_period - spend_previous_year) / spend_previous_year"",
      ""business_validation"": ""Ensures that the growth or decline in advertising spend is accurately measured against the prior year's performance for the same period."",
      ""validation_sql"": ""SELECT (SUM(spend_current_period) - SUM(spend_previous_year)) / NULLIF(SUM(spend_previous_year), 0) AS yoy_growth FROM ({{primary_analysis_sql}}) WHERE spend_previous_year IS NOT NULL AND spend_previous_year != 0;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""spend_current_period"",
      ""related_metrics"": [
        ""spend_news_corp_current_period"",
        ""spend_retail_current_period""
      ],
      ""relationship_description"": ""Specific category/network spend metrics are subsets of the overall current period spend."",
      ""mathematical_formula"": ""spend_news_corp_current_period <= spend_current_period AND spend_retail_current_period <= spend_current_period"",
      ""business_validation"": ""Confirms that segment-specific spend does not exceed the total spend for the same period, ensuring data integrity for breakdowns."",
      ""validation_sql"": ""SELECT SUM(spend_news_corp_current_period) <= SUM(spend_current_period) AS news_corp_subset_valid, SUM(spend_retail_current_period) <= SUM(spend_current_period) AS retail_subset_valid FROM ({{primary_analysis_sql}});"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,16
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""77c68c35-20ce-477a-b216-0c781d43a8ca"",
    ""dashboard_name"": ""Cecile - Adsales Adhoc Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""mixed"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_week"",
      ""source_system_code"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""fiscal_week_id"",
      ""os_level_5"",
      ""unified_publication_gl_code"",
      ""data_load_datetime""
    ],
    ""date_range_detected"": ""FY2025 (Ad Sales), Fiscal Weeks 202548-202551 (Finance)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202548"",
      ""202549"",
      ""202550"",
      ""202551""
    ],
    ""hardcoded_values_found"": [
      ""Booked"",
      ""Billed"",
      ""Medium Rare Content Agency"",
      ""-1"",
      ""PLUTO"",
      ""CPQ"",
      ""ADPT"",
      ""9707"",
      ""9655"",
      ""9658""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or relative"",
      ""status codes should use reference table"",
      ""source system codes should use reference table"",
      ""GL codes should use reference table"",
      ""publishing division should use reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH AdSalesData AS (\n  SELECT\n    t0.financial_year,\n    SAFE_CAST(t0.financial_week AS INT64) AS financial_week,\n    t0.source_system_code,\n    t0.gross_revenue_amount,\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.invoice_number\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND t0.invoice_number = '-1'\n    AND t0.source_system_code IN ('PLUTO', 'CPQ', 'ADPT')\n    AND t0.financial_year IN ('2025') -- Hardcoded year\n)\nSELECT\n  financial_year,\n  financial_week,\n  source_system_code,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  COUNT(1) AS record_count_adsales,\n  SUM(SAFE_CAST(financial_week AS INT64)) AS sum_of_financial_week_numbers -- As seen in original query\nFROM AdSalesData\nGROUP BY\n  financial_year,\n  financial_week,\n  source_system_code\nORDER BY\n  financial_year DESC,\n  financial_week DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_week AS STRING)) as unique_financial_weeks,\n  COUNT(DISTINCT t0.source_system_code) as unique_source_systems,\n  COUNT(DISTINCT t0.revenue_transaction_status) as unique_transaction_statuses,\n  MIN(t0.financial_year) as earliest_financial_year,\n  MAX(t0.financial_year) as latest_financial_year,\n  MIN(SAFE_CAST(t0.data_load_datetime AS DATE)) as earliest_data_load_date,\n  MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) as latest_data_load_date\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) -- Sample recent data\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as status_filter_test,\n  CASE WHEN MAX(SAFE_CAST(t0.data_load_datetime AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN t0.invoice_number = '-1' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as invoice_number_filter_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Rule' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_status_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_status,\n  'Source Publishing Division Exclusion Rule' as rule_name_2,\n  SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_division_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_division\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.data_load_datetime AS DATETIME) as data_load_datetime,\n  t0.financial_year,\n  SAFE_CAST(t0.financial_week AS INT64) as financial_week,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  t0.invoice_number,\n  t0.revenue_transaction_status,\n  t0.source_publishing_division,\n  t0.source_system_code,\n  t0.unified_publication_gl_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE SAFE_CAST(t0.data_load_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY SAFE_CAST(t0.data_load_datetime AS DATETIME) DESC, SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""string"",
          ""context"": ""financial_year filter"",
          ""suggested_fix"": ""replace with CURRENT_DATE() based year or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202548"",
          ""original_format"": ""string"",
          ""context"": ""fiscal_week_id filter"",
          ""suggested_fix"": ""replace with relative fiscal weeks or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202549"",
          ""original_format"": ""string"",
          ""context"": ""fiscal_week_id filter"",
          ""suggested_fix"": ""replace with relative fiscal weeks or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202550"",
          ""original_format"": ""string"",
          ""context"": ""fiscal_week_id filter"",
          ""suggested_fix"": ""replace with relative fiscal weeks or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202551"",
          ""original_format"": ""string"",
          ""context"": ""fiscal_week_id filter"",
          ""suggested_fix"": ""replace with relative fiscal weeks or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""revenue_transaction_status filter"",
          ""suggested_governance"": ""join to a transaction_status_lookup table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""source_publishing_division exclusion"",
          ""suggested_governance"": ""join to a publishing_division_exclusion_list table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'-1'""
          ],
          ""context"": ""invoice_number filter"",
          ""suggested_governance"": ""clarify meaning of '-1' and potentially use a lookup or parameter"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'"",
            ""'CPQ'"",
            ""'ADPT'""
          ],
          ""context"": ""source_system_code filter"",
          ""suggested_governance"": ""join to a source_system_lookup table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'9707'"",
            ""'9655'"",
            ""'9658'""
          ],
          ""context"": ""unified_publication_gl_code filter"",
          ""suggested_governance"": ""join to a GL_code_lookup table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (years, fiscal weeks) with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB`)."",
      ""Replace hardcoded lookup values (transaction statuses, source systems, GL codes, publishing divisions) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., excluded publishing divisions) instead of hardcoded logic in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_year, financial_week, source_system_code"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue amount for ad sales transactions, filtered by specific criteria."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for ad sales performance tracking, crucial for understanding sales volume and value."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""Booked"",
        ""Billed"",
        ""Medium Rare Content Agency"",
        ""-1"",
        ""PLUTO"",
        ""CPQ"",
        ""ADPT""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in gross_revenue_amount"",
        ""accuracy of invoice_number = '-1'""
      ]
    },
    {
      ""metric_id"": ""sum_of_financial_week_numbers"",
      ""metric_name"": ""Sum of Financial Week Numbers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_year, financial_week, source_system_code"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of financial week numbers, likely used for ordering or internal Looker Studio calculations rather than a direct business metric."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.financial_week AS INT64))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Internal Looker Studio sorting mechanism or aggregation artifact."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""Booked"",
        ""Billed"",
        ""Medium Rare Content Agency"",
        ""-1"",
        ""PLUTO"",
        ""CPQ"",
        ""ADPT""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for misinterpretation as a business metric""
      ]
    },
    {
      ""metric_id"": ""finance_record_count"",
      ""metric_name"": ""Finance Record Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""os_level_5"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Count of records in the finance operating statement for specific fiscal weeks."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand volume of finance data for specific periods and segments."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""governance_issues"": [
        ""fiscal week IDs should be parameterised or derived""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year_dim"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the ad sales transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for reporting and analysis of ad sales performance."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week_dim"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week number associated with the ad sales transaction."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for granular reporting and trend analysis of ad sales."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_code_dim"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The system from which the ad sales transaction originated."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by originating system, important for operational analysis and system performance."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""PLUTO"",
        ""CPQ"",
        ""ADPT""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5_dim"",
      ""metric_name"": ""Operating Statement Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific level of detail from the finance operating statement, used for financial reporting."",
      ""sql_logic"": ""t0.os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for financial reporting segmentation and analysis of operating expenses/revenue at a granular level."",
      ""metric_category"": ""financial"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""governance_issues"": [
        ""fiscal week IDs should be parameterised or derived""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""data_load_datetime_truncated"",
      ""metric_name"": ""Data Load Datetime (Truncated to Second)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""second"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The exact datetime when the data was loaded into the system, truncated to the second."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.data_load_datetime, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""unified_publication_gl_code IN ('9707', '9655', '9658')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Used for data freshness monitoring, auditing, and understanding data pipeline latency."",
      ""metric_category"": ""operational"",
      ""update_frequency"": ""real_time"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""9707"",
        ""9655"",
        ""9658""
      ],
      ""governance_issues"": [
        ""GL codes should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_gl_code_dim"",
      ""metric_name"": ""Unified Publication GL Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger code for unified publication, used for filtering and segmentation."",
      ""sql_logic"": ""t0.unified_publication_gl_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""unified_publication_gl_code IN ('9707', '9655', '9658')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter data by specific GL codes, important for financial reconciliation and reporting."",
      ""metric_category"": ""financial"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""9707"",
        ""9655"",
        ""9658""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [],
      ""relationship_description"": ""The 'Total Gross Revenue Amount' is directly impacted by filters on 'Financial Year', 'Revenue Transaction Status', 'Source Publishing Division', 'Invoice Number', and 'Source System Code'. Changes to these filters will alter the aggregated revenue."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that revenue figures reflect specific business criteria and periods, aligning with ad sales operational definitions."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""finance_record_count"",
      ""related_metrics"": [],
      ""relationship_description"": ""The 'Finance Record Count' is directly impacted by the 'Fiscal Week ID' filter. Only records within the specified fiscal weeks are counted."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the record count is specific to the intended financial reporting periods."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""data_load_datetime_truncated"",
      ""related_metrics"": [],
      ""relationship_description"": ""The displayed 'Data Load Datetime (Truncated to Second)' is filtered by 'Unified Publication GL Code'. Only load times for specific GL codes are shown."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows auditing of data freshness for specific financial publication categories."",
      ""validation_sql"": ""N/A"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,17
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f353b933-30eb-4853-9976-03d5371db7d7"",
    ""dashboard_name"": ""Month End Reporting Reconcilation"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 2,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""month_name""
    ],
    ""date_range_detected"": ""Not detectable from query (no date filters). Assumed 'All Time' or 'Current'. For analysis, a 12-month range is assumed for primary_analysis_sql."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [],
    ""governance_opportunities"": [
      ""Verify business purpose of `SUM(fy_month_num)` as it's an unusual aggregation for a month identifier."",
      ""Consider adding explicit date filters to dashboard queries for performance and relevance, especially for month-end reporting.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\n-- Note: 'report_date' is an assumed date column in the source table for filtering purposes, as no date column was present in the original query's SELECT or WHERE clause. Adjust if your table has a different date column name.\nWITH base_data AS (\n  SELECT\n    t0.fy_month_num,\n    t0.month_name,\n    t0.report_date -- Assumed date column for filtering\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\n  WHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH) -- Sample last 12 months for analysis\n)\nSELECT\n  base_data.month_name,\n  COUNT(base_data.fy_month_num) AS count_reconciliation_records,\n  SUM(SAFE_CAST(base_data.fy_month_num AS NUMERIC)) AS sum_fiscal_month_number_unusual,\n  COUNT(*) AS total_records_in_group\nFROM base_data\nGROUP BY\n  base_data.month_name\nORDER BY\n  base_data.month_name\nLIMIT 100; -- Limit for practical analysis, dashboard might pull more"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\n-- Note: 'report_date' is an assumed date column in the source table for filtering purposes. Adjust if your table has a different date column name.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.month_name AS STRING)) as unique_month_names,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_month_num AS INT64)) as unique_fiscal_month_numbers,\n  MIN(SAFE_CAST(t0.report_date AS DATE)) as earliest_report_date,\n  MAX(SAFE_CAST(t0.report_date AS DATE)) as latest_report_date,\n  APPROX_COUNT_DISTINCT(SAFE_CAST(t0.fy_month_num AS STRING) || '-' || SAFE_CAST(t0.month_name AS STRING)) as approx_unique_month_combinations\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Sample recent data\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically\n-- Note: 'report_date' is an assumed date column in the source table for filtering purposes. Adjust if your table has a different date column name.\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(t0.fy_month_num) > 0 THEN 'PASS' ELSE 'FAIL' END as fy_month_num_count_test,\n  CASE WHEN COUNT(DISTINCT t0.month_name) > 0 THEN 'PASS' ELSE 'FAIL' END as month_name_distinct_test,\n  CASE WHEN MAX(SAFE_CAST(t0.report_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) -- Check recent data\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\n-- Note: 'report_date' is an assumed date column in the source table for filtering purposes. Adjust if your table has a different date column name.\nSELECT\n  'Business Rule Validation' as validation_type,\n  'fy_month_num_range_check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN SAFE_CAST(t0.fy_month_num AS INT64) BETWEEN 1 AND 12 THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(t0.fy_month_num AS INT64) BETWEEN 1 AND 12 THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Sample recent data\nLIMIT 1;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\n-- Note: 'report_date' is an assumed date column in the source table. Adjust if your table has a different date column name.\nSELECT\n  SAFE_CAST(t0.fy_month_num AS INT64) as fiscal_month_number,\n  SAFE_CAST(t0.month_name AS STRING) as month_name,\n  SAFE_CAST(t0.report_date AS DATE) as report_date,\n  -- Add other relevant columns from the source table for a comprehensive sample\n  -- e.g., transaction_id, account_id, amount, status, etc.\n  'Add_other_relevant_columns_here_for_a_richer_sample' as placeholder_for_other_columns\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\nWHERE SAFE_CAST(t0.report_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Sample recent data\nORDER BY SAFE_CAST(t0.report_date AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": []
    },
    ""parameterisation_recommendations"": [
      ""Implement date parameters for dashboard filters to allow dynamic date range selection, improving user experience and query performance."",
      ""Verify the business purpose of `SUM(fy_month_num)` and consider if `fy_month_num` should be treated as a dimension or if a different metric is intended.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""count_reconciliation_records"",
      ""metric_name"": ""Count of Reconciliation Records per Month"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the total number of entries or records within the General Ledger Reconciliation dataset for each fiscal month. This metric is crucial for monitoring the volume of reconciliation activities."",
      ""sql_logic"": ""COUNT(t0.fy_month_num)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to track the completeness and volume of data processed for month-end reporting and reconciliation processes. A consistent count indicates stable data ingestion and processing."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for null `fy_month_num` values in the source, though COUNT() will ignore them. Ensure `fy_month_num` is consistently populated.""
      ]
    },
    {
      ""metric_id"": ""sum_fiscal_month_number"",
      ""metric_name"": ""Sum of Fiscal Month Number"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Calculates the sum of the fiscal month numbers (e.g., 1 for Jan, 2 for Feb) for all records within each month. The business utility of summing a month identifier is generally unclear and should be verified."",
      ""sql_logic"": ""SUM(t0.fy_month_num)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""This metric's direct business meaning is questionable if `fy_month_num` is purely an identifier. It might be used for internal Looker Studio calculations, as a proxy for another metric, or it could be an unintended calculation. Verification with business users is recommended."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""The `SUM(fy_month_num)` calculation is highly unusual for a month identifier. It suggests a potential misinterpretation of the `fy_month_num` column's true nature or an unintended calculation. It is critical to verify its intended business purpose."",
        ""If `fy_month_num` is meant to be a dimension, summing it provides no meaningful business insight.""
      ],
      ""data_quality_concerns"": [
        ""If `fy_month_num` is not intended to be summed, this metric will provide misleading or irrelevant information, potentially impacting dashboard credibility.""
      ]
    }
  ],
  ""metric_interactions"": []
}
```",success,18
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4bd7795c-5a94-4fb6-92e1-ed152b1cf7b3"",
    ""dashboard_name"": ""Copy of Interim Adsales Performance Dashboard for FY26"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""advertising|finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 13,
    ""date_grain"": ""fiscal_year"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""product_group"",
      ""relative_fy_year_offset"",
      ""revenue_type"",
      ""unified_publication_name"",
      ""publication_category""
    ],
    ""date_range_detected"": ""Relative to current fiscal year (0) and previous fiscal year (1)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'$'"",
      ""'$'000'"",
      ""'The Australian & Prestige'"",
      ""0"",
      ""1"",
      ""List of 35+ specific publication names (e.g., 'Admin.ADV', 'GQ Mag')"",
      ""'Sundry Pubs'"",
      ""'Non Sundry Pubs'"",
      ""'PRINT'""
    ],
    ""governance_opportunities"": [
      ""Relative fiscal year offsets (0, 1) should be mapped to actual fiscal years (e.g., FY25, FY26) or derived from a date dimension table."",
      ""Currency/scale display options ('$', '$'000') should be managed via Looker Studio parameters, not hardcoded in SQL."",
      ""Specific product group filters ('The Australian & Prestige') should be dynamic parameters."",
      ""The extensive list of 'Sundry Pubs' should be externalized into a governed reference table (e.g., `publication_master` with a `sundry_flag` column) for easier maintenance and consistency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN --\n-- This query consolidates key metrics and dimensions from the dashboard's underlying data.\n-- It calculates current and previous fiscal year gross revenue, and categorizes publications.\n-- Original dashboard queries apply specific filters (e.g., product_group='The Australian & Prestige', revenue_type='PRINT', unified_publication_name='GQ Mag').\n-- This consolidated query includes these as dimensions for broader analysis; apply filters as needed in Looker Studio.\n\nWITH base_data AS (\n  SELECT\n    t0.gross_revenue_amount,\n    t0.product_group,\n    t0.relative_fy_year_offset,\n    t0.revenue_type,\n    t0.unified_publication_name,\n    t0.dw_asl_load_timestamp\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Filter for relevant fiscal years to reduce data processed\n  WHERE SAFE_CAST(t0.relative_fy_year_offset AS INT64) IN (0, 1)\n),\ncalculated_fields AS (\n  SELECT\n    product_group,\n    revenue_type,\n    unified_publication_name,\n    relative_fy_year_offset,\n    dw_asl_load_timestamp,\n    -- Metric: Gross Revenue Current Fiscal Year\n    CASE WHEN (SAFE_CAST(relative_fy_year_offset AS INT64) = 0) THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END AS gross_revenue_current_fy,\n    -- Metric: Gross Revenue Previous Fiscal Year\n    CASE WHEN (SAFE_CAST(relative_fy_year_offset AS INT64) = 1) THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END AS gross_revenue_previous_fy,\n    -- Dimension: Publication Category (Sundry/Non-Sundry)\n    CASE\n      WHEN SAFE_CAST(unified_publication_name AS STRING) IN (\n        'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n        'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n        'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n        'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n        'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n        'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n      ) THEN 'Sundry Pubs'\n      ELSE 'Non Sundry Pubs'\n    END AS publication_category\n  FROM base_data\n)\nSELECT\n  SAFE_CAST(product_group AS STRING) AS product_group,\n  SAFE_CAST(revenue_type AS STRING) AS revenue_type,\n  SAFE_CAST(unified_publication_name AS STRING) AS unified_publication_name,\n  SAFE_CAST(publication_category AS STRING) AS publication_category,\n  -- Final aggregated metrics\n  SUM(gross_revenue_current_fy) AS total_gross_revenue_current_fy,\n  SUM(SAFE_DIVIDE(gross_revenue_current_fy, 1000)) AS total_gross_revenue_current_fy_thousands,\n  SUM(gross_revenue_previous_fy) AS total_gross_revenue_previous_fy,\n  SUM(SAFE_DIVIDE(gross_revenue_previous_fy, 1000)) AS total_gross_revenue_previous_fy_thousands,\n  -- Minimum data load timestamp for this specific grouping\n  MIN(DATETIME_TRUNC(SAFE_CAST(dw_asl_load_timestamp AS DATETIME), SECOND)) AS min_data_load_timestamp_for_group\nFROM calculated_fields\nGROUP BY\n  product_group,\n  revenue_type,\n  unified_publication_name,\n  publication_category\nORDER BY\n  product_group, revenue_type, unified_publication_name\nLIMIT 1000; -- Limit for sample analysis and cost optimization\n"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(product_group AS STRING)) as unique_product_groups,\n  COUNT(DISTINCT SAFE_CAST(revenue_type AS STRING)) as unique_revenue_types,\n  COUNT(DISTINCT SAFE_CAST(unified_publication_name AS STRING)) as unique_publication_names,\n  COUNT(DISTINCT SAFE_CAST(relative_fy_year_offset AS INT64)) as unique_fy_offsets,\n  MIN(SAFE_CAST(dw_asl_load_timestamp AS DATETIME)) as earliest_load_timestamp,\n  MAX(SAFE_CAST(dw_asl_load_timestamp AS DATETIME)) as latest_load_timestamp,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_amount_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATETIME) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS: Total Revenue > 0' ELSE 'FAIL: Total Revenue <= 0' END as revenue_positive_check,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(product_group AS STRING)) > 0 THEN 'PASS: Product Groups Exist' ELSE 'FAIL: No Product Groups' END as product_group_check,\n  CASE WHEN MAX(SAFE_CAST(dw_asl_load_timestamp AS DATETIME)) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 7 DAY) THEN 'PASS: Data Freshness (last 7 days)' ELSE 'FAIL: Data Not Fresh' END as freshness_check,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(relative_fy_year_offset AS INT64) = 0 THEN 1 END) > 0 THEN 'PASS: Current FY Data Exists' ELSE 'FAIL: No Current FY Data' END as current_fy_check\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATETIME) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Sundry Pubs Classification' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE \n    WHEN SAFE_CAST(unified_publication_name AS STRING) IN (\n      'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n      'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n      'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n      'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n      'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n      'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n    ) THEN 1 ELSE 0\n  END) as sundry_pubs_count,\n  SUM(CASE \n    WHEN SAFE_CAST(unified_publication_name AS STRING) NOT IN (\n      'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n      'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n      'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n      'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n      'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n      'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n    ) THEN 1 ELSE 0\n  END) as non_sundry_pubs_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATETIME) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(dw_asl_load_timestamp AS DATETIME) as dw_asl_load_timestamp,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(product_group AS STRING) as product_group,\n  SAFE_CAST(relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  SAFE_CAST(revenue_type AS STRING) as revenue_type,\n  SAFE_CAST(unified_publication_name AS STRING) as unified_publication_name\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(dw_asl_load_timestamp AS DATETIME) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 14 DAY)\nORDER BY dw_asl_load_timestamp DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Admin.ADV'"",
            ""'Admin.DTM'"",
            ""'Admin.HWT'"",
            ""'Admin.International'"",
            ""'Admin.Sales'"",
            ""'Admin.Sport'"",
            ""'Admin.TCM'"",
            ""'Bestrecipes.Admin'"",
            ""'Bodyandsoul.Admin'"",
            ""'CODE'"",
            ""'CodeBet'"",
            ""'Delicious.admin'"",
            ""'Escape.Admin'"",
            ""'GQ.Admin'"",
            ""'Kidspot.Admin'"",
            ""'National Sundry'"",
            ""'National Tabloid PrePrint'"",
            ""'News.Admin'"",
            ""'odds.com.au'"",
            ""'Punters.com.au'"",
            ""'Qantas Travel Insider'"",
            ""'RACENET'"",
            ""'Shortlyster Managed Service'"",
            ""'Sky News'"",
            ""'SKYNEWS.ADMIN'"",
            ""'Stellar.Admin'"",
            ""'Stockhead'"",
            ""'SUDDENLY.CW'"",
            ""'SUDDENLY.NORTH'"",
            ""'SUDDENLY.TGG'"",
            ""'Taste.Admin'"",
            ""'TAUS.ADMIN'"",
            ""'The Sunday Times'"",
            ""'TOOWOOMBACUSTOM'"",
            ""'Vogue.Admin'"",
            ""'Vogueliving.Admin'""
          ],
          ""context"": ""List of unified_publication_name values used to classify 'Sundry Pubs'."",
          ""suggested_governance"": ""Move this list to a governed reference table (e.g., `publication_master` with a `publication_category` column) and join to it."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1""
          ],
          ""context"": ""Integer values representing 'current fiscal year' and 'previous fiscal year' in `relative_fy_year_offset`."",
          ""suggested_governance"": ""Map these offsets to actual fiscal year names (e.g., FY25, FY26) using a date dimension table or a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""display_options"",
          ""hardcoded_values"": [
            ""'$'"",
            ""'$'000'""
          ],
          ""context"": ""String literals used to determine whether to display revenue in raw or thousands format."",
          ""suggested_governance"": ""These should be controlled by a Looker Studio parameter that dynamically adjusts the display format, not hardcoded in the SQL."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'The Australian & Prestige'"",
            ""'PRINT'"",
            ""'GQ Mag'""
          ],
          ""context"": ""Specific values used to filter `product_group`, `revenue_type`, and `unified_publication_name`."",
          ""suggested_governance"": ""These filters should be driven by Looker Studio controls (e.g., dropdowns, text inputs) linked to parameters, allowing users to select different values."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year offsets (0, 1) with a dynamic fiscal year parameter or a date dimension lookup."",
      ""Implement Looker Studio parameters for currency/scale display options ('$', '$'000') to allow user selection."",
      ""Convert hardcoded filter values (e.g., 'The Australian & Prestige', 'PRINT', 'GQ Mag') into Looker Studio parameters for user-driven filtering."",
      ""Externalize the 'Sundry Pubs' classification list into a BigQuery reference table, joining to it instead of hardcoding in `CASE` statements.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Raw gross revenue amount from the ad sales performance data, likely pre-aggregated at a certain grain."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric for ad sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset"",
      ""metric_name"": ""Relative Fiscal Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""fiscal_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset from the current fiscal year (0 for current FY, 1 for previous FY). Used to distinguish revenue periods."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key dimension for time-based comparisons of revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1""
      ],
      ""governance_issues"": [
        ""Should be mapped to actual fiscal year names (e.g., FY25, FY26) or use a date dimension table for clarity and flexibility.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_current_fy"",
      ""metric_name"": ""Gross Revenue Current Fiscal Year"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""fiscal_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue specifically attributed to the current fiscal year (where relative_fy_year_offset is 0)."",
      ""sql_logic"": ""CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core component for current year performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_previous_fy"",
      ""metric_name"": ""Gross Revenue Previous Fiscal Year"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""fiscal_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue specifically attributed to the previous fiscal year (where relative_fy_year_offset is 1)."",
      ""sql_logic"": ""CASE WHEN (relative_fy_year_offset = 1) THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core component for year-over-year performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_current_fy_thousands"",
      ""metric_name"": ""Gross Revenue Current FY (Thousands)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""fiscal_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_current_fy""
      ],
      ""business_description"": ""Gross revenue for the current fiscal year, divided by 1000 for display in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(gross_revenue_current_fy, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate calculation for display formatting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_previous_fy_thousands"",
      ""metric_name"": ""Gross Revenue Previous FY (Thousands)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""fiscal_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_previous_fy""
      ],
      ""business_description"": ""Gross revenue for the previous fiscal year, divided by 1000 for display in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(gross_revenue_previous_fy, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate calculation for display formatting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_gross_revenue_current_fy_display"",
      ""metric_name"": ""Sum Gross Revenue Current FY (Display)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_current_fy"",
        ""gross_revenue_current_fy_thousands""
      ],
      ""business_description"": ""Total gross revenue for the current fiscal year, aggregated and adjusted for display (either raw or in thousands) based on a dashboard parameter."",
      ""sql_logic"": ""SUM(CASE WHEN ('$\\'000' = '$') THEN gross_revenue_current_fy ELSE gross_revenue_current_fy_thousands END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group = 'The Australian & Prestige'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary KPI for current fiscal year ad sales performance, displayed on the dashboard."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'$'"",
        ""'$'000'"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Display logic ('$' vs '$'000') should be driven by a Looker Studio parameter."",
        ""Product group filter should be dynamic/parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_gross_revenue_previous_fy_display"",
      ""metric_name"": ""Sum Gross Revenue Previous FY (Display)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_previous_fy"",
        ""gross_revenue_previous_fy_thousands""
      ],
      ""business_description"": ""Total gross revenue for the previous fiscal year, aggregated and adjusted for display (either raw or in thousands) based on a dashboard parameter."",
      ""sql_logic"": ""SUM(CASE WHEN ('$\\'000' = '$') THEN gross_revenue_previous_fy ELSE gross_revenue_previous_fy_thousands END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group = 'The Australian & Prestige'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary KPI for previous fiscal year ad sales performance, used for year-over-year comparison on the dashboard."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'$'"",
        ""'$'000'"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Display logic ('$' vs '$'000') should be driven by a Looker Studio parameter."",
        ""Product group filter should be dynamic/parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The grouping or category of the product related to ad sales."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting ad sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of revenue, e.g., 'PRINT', 'DIGITAL'."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Dimension for analyzing revenue breakdown by type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The standardized name of the publication."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for detailed analysis of ad sales by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'GQ Mag'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be parameterized."",
        ""List of values used for 'Sundry Pubs' classification should be externalized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_category"",
      ""metric_name"": ""Publication Category (Sundry/Non-Sundry)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""publication"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""unified_publication_name""
      ],
      ""business_description"": ""Categorizes publications into 'Sundry Pubs' or 'Non Sundry Pubs' based on a predefined list of unified publication names."",
      ""sql_logic"": ""CASE WHEN (unified_publication_name IN ('Admin.ADV', ..., 'Vogueliving.Admin')) THEN 'Sundry Pubs' ELSE 'Non Sundry Pubs' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group = 'The Australian & Prestige'"",
        ""revenue_type = 'PRINT'"",
        ""unified_publication_name = 'GQ Mag'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level grouping and analysis of publication performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Admin.ADV'"",
        ""'Admin.DTM'"",
        ""'Admin.HWT'"",
        ""'Admin.International'"",
        ""'Admin.Sales'"",
        ""'Admin.Sport'"",
        ""'Admin.TCM'"",
        ""'Bestrecipes.Admin'"",
        ""'Bodyandsoul.Admin'"",
        ""'CODE'"",
        ""'CodeBet'"",
        ""'Delicious.admin'"",
        ""'Escape.Admin'"",
        ""'GQ.Admin'"",
        ""'Kidspot.Admin'"",
        ""'National Sundry'"",
        ""'National Tabloid PrePrint'"",
        ""'News.Admin'"",
        ""'odds.com.au'"",
        ""'Punters.com.au'"",
        ""'Qantas Travel Insider'"",
        ""'RACENET'"",
        ""'Shortlyster Managed Service'"",
        ""'Sky News'"",
        ""'SKYNEWS.ADMIN'"",
        ""'Stellar.Admin'"",
        ""'Stockhead'"",
        ""'SUDDENLY.CW'"",
        ""'SUDDENLY.NORTH'"",
        ""'SUDDENLY.TGG'"",
        ""'Taste.Admin'"",
        ""'TAUS.ADMIN'"",
        ""'The Sunday Times'"",
        ""'TOOWOOMBACUSTOM'"",
        ""'Vogue.Admin'"",
        ""'Vogueliving.Admin'"",
        ""'Sundry Pubs'"",
        ""'Non Sundry Pubs'""
      ],
      ""governance_issues"": [
        ""The extensive list of 'Sundry Pubs' should be managed in a reference table for maintainability and consistency.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""min_dw_asl_load_timestamp"",
      ""metric_name"": ""Minimum Data Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""none"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The earliest timestamp when the ad sales performance data was loaded, indicating data freshness for the entire dataset."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Used to monitor the recency and freshness of the underlying data."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""sum_gross_revenue_current_fy_display"",
      ""related_metrics"": [
        ""gross_revenue_current_fy"",
        ""gross_revenue_current_fy_thousands""
      ],
      ""relationship_description"": ""The final displayed current FY revenue is conditionally derived from either the raw current FY revenue or its thousands-scaled version, based on a dashboard parameter."",
      ""mathematical_formula"": ""SUM(IF parameter = '$' THEN gross_revenue_current_fy ELSE gross_revenue_current_fy_thousands END)"",
      ""business_validation"": ""Ensures revenue is presented in the desired scale (raw or thousands) for user readability."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN ('$\\'000' = '$') THEN gross_revenue_current_fy ELSE SAFE_DIVIDE(gross_revenue_current_fy, 1000) END) FROM (SELECT CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END AS gross_revenue_current_fy FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""sum_gross_revenue_previous_fy_display"",
      ""related_metrics"": [
        ""gross_revenue_previous_fy"",
        ""gross_revenue_previous_fy_thousands""
      ],
      ""relationship_description"": ""The final displayed previous FY revenue is conditionally derived from either the raw previous FY revenue or its thousands-scaled version, based on a dashboard parameter."",
      ""mathematical_formula"": ""SUM(IF parameter = '$' THEN gross_revenue_previous_fy ELSE gross_revenue_previous_fy_thousands END)"",
      ""business_validation"": ""Ensures previous FY revenue is presented in the desired scale for year-over-year comparison."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN ('$\\'000' = '$') THEN gross_revenue_previous_fy ELSE SAFE_DIVIDE(gross_revenue_previous_fy, 1000) END) FROM (SELECT CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END AS gross_revenue_previous_fy FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_current_fy"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Gross revenue for the current fiscal year is directly dependent on the base gross revenue amount and the fiscal year offset being 0."",
      ""mathematical_formula"": ""gross_revenue_current_fy = CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END"",
      ""business_validation"": ""Ensures correct attribution of revenue to the current reporting period."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_previous_fy"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Gross revenue for the previous fiscal year is directly dependent on the base gross revenue amount and the fiscal year offset being 1."",
      ""mathematical_formula"": ""gross_revenue_previous_fy = CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END"",
      ""business_validation"": ""Ensures correct attribution of revenue to the previous reporting period for comparative analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""sum_gross_revenue_current_fy_display"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""The calculation of current FY revenue is filtered by a specific product group ('The Australian & Prestige'). This limits the scope of the displayed metric."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures the dashboard focuses on a specific, critical product segment."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group = 'The Australian & Prestige'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""publication_category"",
      ""related_metrics"": [
        ""product_group"",
        ""revenue_type"",
        ""unified_publication_name""
      ],
      ""relationship_description"": ""The publication category dimension is calculated within a specific filtered context (product_group='The Australian & Prestige', revenue_type='PRINT', unified_publication_name='GQ Mag'). This implies the category is relevant only for this specific slice of data."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures the categorization is applied within the intended reporting context."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group = 'The Australian & Prestige' AND revenue_type = 'PRINT' AND unified_publication_name = 'GQ Mag'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,19
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a1b901e6-c4fb-44bc-955a-3a7070c15829"",
    ""dashboard_name"": ""Revenue Movement"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_date"",
      ""financial_year"",
      ""advertiser_parent"",
      ""portfolio_group_name_sync"",
      ""portfolio_parent_group_name_sync"",
      ""portfolio_conformed_name_sync"",
      ""revenue_type"",
      ""revenue_sub_type"",
      ""derived_advertiser_group"",
      ""derived_revenue_category""
    ],
    ""date_range_detected"": ""2025-05-29 to 2025-06-23 (specific queries)"",
    ""hardcoded_dates_found"": [
      ""2025-05-29"",
      ""2025-06-23""
    ],
    ""hardcoded_values_found"": [
      ""'2025'"",
      ""'CONSORTIUM SA'"",
      ""'DIRECT SA WA'"",
      ""'CONSORTIUM NSW'"",
      ""'QLD IA C2'"",
      ""'XTEND'"",
      ""'PROGRAMMATIC'"",
      ""'ADPT DIGITAL'"",
      ""'SUNDRY'"",
      ""'DIGITAL'"",
      ""'PRINT'"",
      ""'PRO'"",
      ""'DIGITAL OTHER'"",
      ""'Nah'"",
      ""'Y'""
    ],
    ""governance_opportunities"": [
      ""Dates and financial years should be parameterized or use relative date functions."",
      ""Portfolio group/parent/conformed names should be sourced from a governed lookup table."",
      ""Revenue category definitions (XTEND, PROGRAMMATIC, ADPT DIGITAL, SUNDRY) should be managed in a configuration table rather than hardcoded in SQL CASE statements."",
      ""The 'Nah' replacement for NULL advertiser_group could be standardized via a data quality rule or lookup.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.GROSS_AMOUNT_DIFF AS gross_amount_diff,\n    t0.advertiser_group AS advertiser_group,\n    t0.advertiser_parent AS advertiser_parent,\n    t0.booking_line_id AS booking_line_id,\n    t0.booking_number AS booking_number,\n    t0.financial_short_month AS financial_short_month,\n    t0.financial_year AS financial_year,\n    SAFE_CAST(t0.movement_date AS DATE) AS movement_date,\n    t0.portfolio_group_name_sync AS portfolio_group_name_sync,\n    t0.portfolio_parent_group_name_sync AS portfolio_parent_group_name_sync,\n    t0.revenue_sub_type AS revenue_sub_type,\n    t0.revenue_type AS revenue_type,\n    t0.xtend_flag AS xtend_flag,\n    t0.portfolio_conformed_name_sync AS portfolio_conformed_name_sync\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  WHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_TRUNC(CURRENT_DATE(), YEAR) -- Adjust date filter as needed, e.g., DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n),\nintermediate_data AS (\n  SELECT\n    gross_amount_diff,\n    advertiser_group,\n    advertiser_parent,\n    booking_line_id,\n    booking_number,\n    financial_short_month,\n    financial_year,\n    movement_date,\n    portfolio_group_name_sync,\n    portfolio_parent_group_name_sync,\n    revenue_sub_type,\n    revenue_type,\n    xtend_flag,\n    portfolio_conformed_name_sync,\n    CASE WHEN (advertiser_group IS NULL) THEN 'Nah' ELSE advertiser_group END AS derived_advertiser_group,\n    PARSE_DATE('%Y-%b-%d', CONCAT(SAFE_CAST(financial_year AS STRING),'-',SAFE_CAST(financial_short_month AS STRING),'-1')) AS derived_financial_date,\n    (portfolio_parent_group_name_sync = 'DIGITAL OTHER') AS is_digital_other_portfolio_parent,\n    SAFE.LEFT(revenue_sub_type, 6) AS revenue_sub_type_prefix_6,\n    SAFE.LEFT(revenue_sub_type, 3) AS revenue_sub_type_prefix_3,\n    (revenue_sub_type = 'DIGITAL') AS is_digital_revenue_sub_type,\n    CASE WHEN (revenue_type = 'DIGITAL') THEN gross_amount_diff ELSE 0 END AS digital_gross_amount_diff,\n    CASE WHEN (revenue_type = 'PRINT') THEN gross_amount_diff ELSE 0 END AS print_gross_amount_diff\n  FROM base_data\n),\nfinal_derived_data AS (\n  SELECT\n    * EXCEPT(is_digital_other_portfolio_parent, revenue_sub_type_prefix_6, revenue_sub_type_prefix_3, is_digital_revenue_sub_type),\n    (revenue_sub_type_prefix_3 = 'PRO') AS is_pro_revenue_sub_type,\n    ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL')) AS is_programmatic_flag\n  FROM intermediate_data\n)\nSELECT\n  movement_date,\n  financial_year,\n  derived_financial_date,\n  advertiser_parent,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_type,\n  revenue_sub_type,\n  derived_advertiser_group,\n  CASE\n    WHEN (xtend_flag = 'Y') THEN 'XTEND'\n    WHEN (is_pro_revenue_sub_type OR is_programmatic_flag) THEN 'PROGRAMMATIC'\n    WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n    WHEN (revenue_sub_type_prefix_6 = 'SUNDRY') THEN 'SUNDRY'\n    ELSE revenue_sub_type\n  END AS derived_revenue_category,\n  SUM(gross_amount_diff) AS total_gross_amount_diff,\n  SUM(digital_gross_amount_diff) AS sum_digital_gross_amount_diff,\n  SUM(print_gross_amount_diff) AS sum_print_gross_amount_diff\nFROM final_derived_data\nGROUP BY\n  movement_date,\n  financial_year,\n  derived_financial_date,\n  advertiser_parent,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_type,\n  revenue_sub_type,\n  derived_advertiser_group,\n  derived_revenue_category, -- Include derived_revenue_category in GROUP BY\n  is_pro_revenue_sub_type, -- Required for derived_revenue_category in outer select\n  is_programmatic_flag, -- Required for derived_revenue_category in outer select\n  revenue_sub_type_prefix_6, -- Required for derived_revenue_category in outer select\n  xtend_flag -- Required for derived_revenue_category in outer select\nORDER BY movement_date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(movement_date AS DATE)) as unique_movement_dates,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT portfolio_group_name_sync) as unique_portfolio_groups,\n  COUNT(DISTINCT portfolio_parent_group_name_sync) as unique_portfolio_parents,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT revenue_sub_type) as unique_revenue_sub_types,\n  MIN(SAFE_CAST(movement_date AS DATE)) as earliest_movement_date,\n  MAX(SAFE_CAST(movement_date AS DATE)) as latest_movement_date,\n  APPROX_COUNT_DISTINCT(booking_line_id) as approx_unique_booking_line_ids\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_amount_diff_test,\n  CASE WHEN COUNT(DISTINCT booking_line_id) > 0 THEN 'PASS' ELSE 'FAIL' END as booking_id_test,\n  CASE WHEN MAX(SAFE_CAST(movement_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN revenue_type IS NULL THEN 1 END) = 0 THEN 'PASS' ELSE 'FAIL' END as revenue_type_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    t0.GROSS_AMOUNT_DIFF AS gross_amount_diff,\n    t0.advertiser_group AS advertiser_group,\n    t0.advertiser_parent AS advertiser_parent,\n    t0.financial_year AS financial_year,\n    SAFE_CAST(t0.movement_date AS DATE) AS movement_date,\n    t0.portfolio_parent_group_name_sync AS portfolio_parent_group_name_sync,\n    t0.revenue_sub_type AS revenue_sub_type,\n    t0.revenue_type AS revenue_type,\n    t0.xtend_flag AS xtend_flag\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  WHERE SAFE_CAST(t0.movement_date AS DATE) >= DATE_TRUNC(CURRENT_DATE(), YEAR) -- Focus on current year data for rule validation\n),\nintermediate_data AS (\n  SELECT\n    *,\n    (portfolio_parent_group_name_sync = 'DIGITAL OTHER') AS is_digital_other_portfolio_parent,\n    SAFE.LEFT(revenue_sub_type, 6) AS revenue_sub_type_prefix_6,\n    SAFE.LEFT(revenue_sub_type, 3) AS revenue_sub_type_prefix_3,\n    (revenue_sub_type = 'DIGITAL') AS is_digital_revenue_sub_type\n  FROM base_data\n),\nfinal_derived_data AS (\n  SELECT\n    *,\n    (revenue_sub_type_prefix_3 = 'PRO') AS is_pro_revenue_sub_type,\n    ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL')) AS is_programmatic_flag\n  FROM intermediate_data\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'derived_revenue_category_logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN xtend_flag = 'Y' THEN 1 ELSE 0 END) as xtend_category_count,\n  SUM(CASE WHEN (is_pro_revenue_sub_type OR is_programmatic_flag) THEN 1 ELSE 0 END) as programmatic_category_count,\n  SUM(CASE WHEN revenue_sub_type = 'DIGITAL' AND NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR is_programmatic_flag)) THEN 1 ELSE 0 END) as adpt_digital_category_count,\n  SUM(CASE WHEN revenue_sub_type_prefix_6 = 'SUNDRY' AND NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR is_programmatic_flag) OR revenue_sub_type = 'DIGITAL') THEN 1 ELSE 0 END) as sundry_category_count,\n  SUM(CASE WHEN NOT (xtend_flag = 'Y' OR (is_pro_revenue_sub_type OR is_programmatic_flag) OR revenue_sub_type = 'DIGITAL' OR revenue_sub_type_prefix_6 = 'SUNDRY') THEN 1 ELSE 0 END) as other_category_count,\n  SUM(CASE WHEN (CASE\n    WHEN (xtend_flag = 'Y') THEN 'XTEND'\n    WHEN (is_pro_revenue_sub_type OR is_programmatic_flag) THEN 'PROGRAMMATIC'\n    WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n    WHEN (revenue_sub_type_prefix_6 = 'SUNDRY') THEN 'SUNDRY'\n    ELSE revenue_sub_type\n  END) IS NOT NULL THEN 1 ELSE 0 END) as total_categorized_records\nFROM final_derived_data;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(movement_date AS DATE) as movement_date,\n  financial_year,\n  advertiser_parent,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  revenue_type,\n  revenue_sub_type,\n  SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) as gross_amount_diff,\n  xtend_flag,\n  portfolio_conformed_name_sync\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND GROSS_AMOUNT_DIFF IS NOT NULL\nORDER BY SAFE_CAST(movement_date AS DATE) DESC, SAFE_CAST(GROSS_AMOUNT_DIFF AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-29"",
          ""original_format"": ""DATE '2025-05-29'"",
          ""context"": ""Used as a specific filter for movement_date in job_Aeubs62LGAhV5UGdKepwQIETSr3g."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @start_date) or relative date function (e.g., DATE_SUB(CURRENT_DATE(), INTERVAL X DAY))."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-23"",
          ""original_format"": ""DATE '2025-06-23'"",
          ""context"": ""Used as a specific filter for movement_date in job_nEDwytoaLlkbxlA4dr3aaDP_6uqo."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @start_date) or relative date function (e.g., DATE_SUB(CURRENT_DATE(), INTERVAL X DAY))."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'2025'""
          ],
          ""context"": ""Financial year filter (clmn6_ / clmn2_ IN ('2025'))."",
          ""suggested_governance"": ""Use a parameter for financial year or derive from current date if applicable."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM SA'"",
            ""'DIRECT SA WA'"",
            ""'CONSORTIUM NSW'"",
            ""'QLD IA C2'""
          ],
          ""context"": ""Portfolio parent/conformed name filters (clmn9_, clmn5_, clmn4_ IN (...))."",
          ""suggested_governance"": ""Store these categories in a governed lookup table (e.g., `dim_portfolio_groups`) and join to filter, or use parameters for dynamic selection."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'XTEND'"",
            ""'PROGRAMMATIC'"",
            ""'ADPT DIGITAL'"",
            ""'SUNDRY'"",
            ""'DIGITAL'"",
            ""'PRINT'"",
            ""'PRO'"",
            ""'DIGITAL OTHER'"",
            ""'Y'""
          ],
          ""context"": ""Logic for `derived_revenue_category` and other boolean flags (e.g., `xtend_flag = 'Y'`, `revenue_sub_type = 'DIGITAL'`)."",
          ""suggested_governance"": ""Externalize these business rules into a configuration table or a UDF, allowing for central management without modifying SQL queries."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""default_value"",
          ""hardcoded_values"": [
            ""'Nah'""
          ],
          ""context"": ""Default value for `derived_advertiser_group` when `advertiser_group` is NULL."",
          ""suggested_governance"": ""Standardize NULL handling across the data pipeline or define this default in a data dictionary."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded financial years with a parameter (e.g., `financial_year_param`)."",
      ""Replace hardcoded portfolio group/parent/conformed names with parameters or by joining to a reference table."",
      ""Externalize complex `CASE` statement logic for derived categories into a UDF or a configuration table for better maintainability and reusability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_amount_diff"",
      ""metric_name"": ""Gross Amount Difference (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""raw_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross amount difference for a booking line item, representing the core value for revenue calculations."",
      ""sql_logic"": ""t0.GROSS_AMOUNT_DIFF"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""This is the fundamental financial value from which all revenue metrics are derived."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""data freshness dependent""
      ]
    },
    {
      ""metric_id"": ""total_gross_amount_diff"",
      ""metric_name"": ""Total Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_amount_diff""
      ],
      ""business_description"": ""The aggregated sum of gross amount differences, representing total revenue movement for a given set of dimensions."",
      ""sql_logic"": ""SUM(gross_amount_diff)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date range"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""This is a primary KPI for tracking overall revenue performance and movement."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""digital_gross_amount_diff"",
      ""metric_name"": ""Digital Gross Amount Difference"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_amount_diff"",
        ""revenue_type""
      ],
      ""business_description"": ""The gross amount difference specifically attributed to 'DIGITAL' revenue types."",
      ""sql_logic"": ""CASE WHEN (revenue_type = 'DIGITAL') THEN gross_amount_diff ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to segment revenue by digital channels, crucial for digital performance analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'DIGITAL' value should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_digital_gross_amount_diff"",
      ""metric_name"": ""Sum of Digital Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""digital_gross_amount_diff""
      ],
      ""business_description"": ""The aggregated sum of digital gross amount differences, providing total digital revenue movement."",
      ""sql_logic"": ""SUM(digital_gross_amount_diff)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date range"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A key KPI for digital revenue performance, often compared against print revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""print_gross_amount_diff"",
      ""metric_name"": ""Print Gross Amount Difference"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_amount_diff"",
        ""revenue_type""
      ],
      ""business_description"": ""The gross amount difference specifically attributed to 'PRINT' revenue types."",
      ""sql_logic"": ""CASE WHEN (revenue_type = 'PRINT') THEN gross_amount_diff ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to segment revenue by print channels, crucial for traditional media performance analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'PRINT' value should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sum_print_gross_amount_diff"",
      ""metric_name"": ""Sum of Print Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""print_gross_amount_diff""
      ],
      ""business_description"": ""The aggregated sum of print gross amount differences, providing total print revenue movement."",
      ""sql_logic"": ""SUM(print_gross_amount_diff)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date range"",
        ""financial_year"",
        ""portfolio_parent_group_name_sync"",
        ""portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""A key KPI for print revenue performance, often compared against digital revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""derived_advertiser_group"",
      ""metric_name"": ""Derived Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""advertiser_group""
      ],
      ""business_description"": ""Advertiser group, with NULL values replaced by 'Nah'."",
      ""sql_logic"": ""CASE WHEN (advertiser_group IS NULL) THEN 'Nah' ELSE advertiser_group END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and filtering revenue data by advertiser, ensuring no nulls in this dimension."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Nah'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'Nah' value for NULLs; consider standardizing NULL handling or using a proper 'Unknown' category.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""derived_revenue_category"",
      ""metric_name"": ""Derived Revenue Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""business_description"": ""A categorized view of revenue based on a complex set of business rules, including XTEND, PROGRAMMATIC, ADPT DIGITAL, SUNDRY, and other revenue sub-types."",
      ""sql_logic"": ""CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' WHEN (is_pro_revenue_sub_type OR is_programmatic_flag) THEN 'PROGRAMMATIC' WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL' WHEN (revenue_sub_type_prefix_6 = 'SUNDRY') THEN 'SUNDRY' ELSE revenue_sub_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for high-level revenue segmentation and strategic reporting, consolidating various revenue streams into defined categories."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'XTEND'"",
        ""'PROGRAMMATIC'"",
        ""'ADPT DIGITAL'"",
        ""'SUNDRY'"",
        ""'DIGITAL'"",
        ""'PRO'"",
        ""'DIGITAL OTHER'"",
        ""'Y'""
      ],
      ""governance_issues"": [
        ""Business rules are hardcoded in SQL; should be externalized to a configuration table or UDF for easier maintenance and transparency.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_gross_amount_diff"",
      ""related_metrics"": [
        ""sum_digital_gross_amount_diff"",
        ""sum_print_gross_amount_diff""
      ],
      ""relationship_description"": ""The total gross amount difference is the sum of digital and print gross amount differences, plus any other revenue types not explicitly categorized as digital or print."",
      ""mathematical_formula"": ""total_gross_amount_diff = sum_digital_gross_amount_diff + sum_print_gross_amount_diff + SUM(other_revenue_types)"",
      ""business_validation"": ""Ensures that the sum of segmented revenue (digital, print) reconciles with the overall total revenue, allowing for detailed breakdown while maintaining overall accuracy."",
      ""validation_sql"": ""SELECT\n  SUM(gross_amount_diff) AS total_revenue,\n  SUM(CASE WHEN revenue_type = 'DIGITAL' THEN gross_amount_diff ELSE 0 END) AS digital_revenue,\n  SUM(CASE WHEN revenue_type = 'PRINT' THEN gross_amount_diff ELSE 0 END) AS print_revenue,\n  SUM(CASE WHEN revenue_type NOT IN ('DIGITAL', 'PRINT') THEN gross_amount_diff ELSE 0 END) AS other_revenue,\n  (SUM(CASE WHEN revenue_type = 'DIGITAL' THEN gross_amount_diff ELSE 0 END) + SUM(CASE WHEN revenue_type = 'PRINT' THEN gross_amount_diff ELSE 0 END) + SUM(CASE WHEN revenue_type NOT IN ('DIGITAL', 'PRINT') THEN gross_amount_diff ELSE 0 END)) AS sum_of_parts\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_TRUNC(CURRENT_DATE(), YEAR)\nHAVING total_revenue = sum_of_parts;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""derived_revenue_category"",
      ""related_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""relationship_description"": ""The 'Derived Revenue Category' is a complex dimension calculated based on multiple underlying flags and revenue attributes, following a specific hierarchical logic."",
      ""mathematical_formula"": ""N/A (conditional logic)"",
      ""business_validation"": ""This relationship defines how raw data attributes are transformed into a business-friendly categorization, critical for high-level reporting and strategic decision-making."",
      ""validation_sql"": ""SELECT\n  revenue_sub_type,\n  xtend_flag,\n  portfolio_parent_group_name_sync,\n  CASE\n    WHEN (xtend_flag = 'Y') THEN 'XTEND'\n    WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO') OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'\n    WHEN (revenue_sub_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n    WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') THEN 'SUNDRY'\n    ELSE revenue_sub_type\n  END AS calculated_category,\n  COUNT(*) as record_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE SAFE_CAST(movement_date AS DATE) >= DATE_TRUNC(CURRENT_DATE(), YEAR)\nGROUP BY 1,2,3,4\nORDER BY record_count DESC\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,20
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""fed70b12-c274-4cde-9920-592ca4c4dab0"",
    ""dashboard_name"": ""Independent Agency Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_dcp.ia;ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""agency_parent"",
      ""revenue_group_subtype"",
      ""financial_year"",
      ""financial_quarter"",
      ""financial_month"",
      ""movement_date"",
      ""account_number""
    ],
    ""date_range_detected"": ""Current FY and Previous FY (relative to hardcoded dates)"",
    ""hardcoded_dates_found"": [
      ""2025-05-23"",
      ""2025-06-22""
    ],
    ""hardcoded_values_found"": [
      ""'FY'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""-1"",
      ""0"",
      ""-12"",
      ""1"",
      ""2"",
      ""3"",
      ""4"",
      ""5"",
      ""6"",
      ""7"",
      ""8"",
      ""9"",
      ""10"",
      ""11"",
      ""12"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""'Current Week'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterised or use CURRENT_DATE()"",
      ""Relative date offsets (e.g., -365 days, -1, 0, -12) should be dynamic or configurable parameters"",
      ""Financial year/calendar year preference ('FY' = 'FY') should be a parameter"",
      ""Revenue group subtypes (e.g., 'PROGRAMMATIC EXCHANGE') should use a governed lookup table"",
      ""Month and quarter mappings (e.g., 'Jan' to 1, 1-3 to 'Q1') should be handled by a date dimension table or a governed lookup"",
      ""Week definitions (min_week, max_week) should be clearly defined and potentially governed""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  base_ia_data AS (\n    SELECT\n      t0.agency_parent,\n      t0.booking_line_created_date,\n      SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n      t0.relative_fy_month_offset,\n      t0.relative_fy_year_offset,\n      t0.financial_month,\n      t0.financial_quarter,\n      t0.revenue_group_subtype\n    FROM\n      `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\n    WHERE\n      (t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL)\n      -- Filter for relevant financial years, e.g., current and previous FY\n      AND t0.relative_fy_year_offset IN (0, -1)\n  ),\n  calculated_metrics AS (\n    SELECT\n      agency_parent,\n      financial_month,\n      financial_quarter,\n      -- Current FY Gross Revenue\n      CASE\n        WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount\n        ELSE 0\n      END AS current_fy_gross_revenue,\n      -- Previous FY Gross Revenue\n      CASE\n        WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount\n        ELSE 0\n      END AS previous_fy_gross_revenue,\n      -- Previous FY YoY Gross Revenue (adjusted for date)\n      CASE\n        WHEN relative_fy_year_offset = -1\n        AND SAFE_CAST(booking_line_created_date AS DATE) <= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) THEN gross_revenue_amount\n        ELSE 0\n      END AS previous_fy_yoy_gross_revenue,\n      relative_fy_month_offset\n    FROM\n      base_ia_data\n  )\nSELECT\n  agency_parent,\n  financial_month,\n  financial_quarter,\n  SUM(current_fy_gross_revenue) AS total_current_fy_gross_revenue,\n  SUM(previous_fy_gross_revenue) AS total_previous_fy_gross_revenue,\n  -- Prior Period Comparison Revenue\n  SUM(\n    CASE\n      WHEN relative_fy_month_offset < -12 THEN previous_fy_gross_revenue\n      ELSE previous_fy_yoy_gross_revenue\n    END\n  ) AS total_prior_period_comparison_revenue\nFROM\n  calculated_metrics\nGROUP BY\n  agency_parent,\n  financial_month,\n  financial_quarter\nORDER BY\n  agency_parent,\n  financial_month,\n  financial_quarter\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis for sbx_dcp.ia' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.agency_parent) AS unique_agency_parents,\n  COUNT(DISTINCT SAFE_CAST(t0.booking_line_created_date AS DATE)) AS unique_booking_dates,\n  COUNT(DISTINCT t0.revenue_group_subtype) AS unique_revenue_subtypes,\n  MIN(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) AS latest_booking_date,\n  AVG(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS avg_gross_revenue_amount,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_count,\n  SUM(CASE WHEN t0.revenue_group_subtype IS NULL THEN 1 ELSE 0 END) AS null_revenue_subtype_count\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE\n  SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Last 2 years for context\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check for sbx_dcp.ia' AS test_type,\n  CASE\n    WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS gross_revenue_positive_test,\n  CASE\n    WHEN COUNT(DISTINCT t0.agency_parent) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS agency_parent_exists_test,\n  CASE\n    WHEN MAX(SAFE_CAST(t0.booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS data_freshness_test,\n  CASE\n    WHEN COUNT(CASE WHEN t0.revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 END) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS programmatic_exchange_data_exists_test\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE\n  SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation for sbx_dcp.ia' AS validation_type,\n  'Programmatic Exchange Exclusion' AS rule_name,\n  COUNT(*) AS total_records_in_scope,\n  SUM(CASE WHEN t0.revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END) AS programmatic_exchange_records,\n  SUM(CASE WHEN (t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL) THEN 1 ELSE 0 END) AS non_programmatic_exchange_records,\n  SAFE_DIVIDE(SUM(CASE WHEN (t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 AS non_programmatic_exchange_percentage,\n  'Financial Year Offset Distribution' AS rule_name_2,\n  COUNT(DISTINCT t0.relative_fy_year_offset) AS distinct_fy_offsets,\n  ARRAY_AGG(DISTINCT t0.relative_fy_year_offset ORDER BY t0.relative_fy_year_offset) AS detected_fy_offsets\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE\n  SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Last 2 years for context\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.booking_line_created_date AS DATE) AS booking_date,\n  t0.agency_parent,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  t0.revenue_group_subtype,\n  t0.relative_fy_year_offset,\n  t0.relative_fy_month_offset,\n  t0.financial_month,\n  t0.financial_quarter\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\nWHERE\n  SAFE_CAST(t0.booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(t0.booking_line_created_date AS DATE) DESC,\n  t0.agency_parent\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-23"",
          ""original_format"": ""DATE(TIMESTAMP '2025-05-23 01:19:32.916346+00', 'Australia/Sydney')"",
          ""context"": ""Used as a proxy for current date in Query 1 for calculating relative dates and YoY comparisons."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-06-22"",
          ""original_format"": ""DATE(TIMESTAMP '2025-06-22 22:46:58.786738+00', 'Australia/Sydney')"",
          ""context"": ""Used as a proxy for current date in Query 2 for calculating relative dates and YoY comparisons."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY'""
          ],
          ""context"": ""Used to consistently select financial year metrics over calendar year metrics. While consistent, it's hardcoded."",
          ""suggested_governance"": ""Parameterize 'Reporting Period Type' (e.g., 'Financial Year', 'Calendar Year') to allow flexibility."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PROGRAMMATIC EXCHANGE'""
          ],
          ""context"": ""Excludes a specific revenue group subtype from all calculations."",
          ""suggested_governance"": ""Use a governed lookup table for revenue group subtypes or a configuration parameter for exclusions."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""-1"",
            ""0"",
            ""-12""
          ],
          ""context"": ""Used for relative financial year offsets (-1 for previous FY, 0 for current FY) and month offsets (-12 for more than a year ago)."",
          ""suggested_governance"": ""Define these offsets as configurable parameters or derive dynamically based on current period."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Mapping short month names to numeric month values."",
          ""suggested_governance"": ""Use a date dimension table that contains month names and their numeric equivalents."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""1"",
            ""2"",
            ""3"",
            ""4"",
            ""5"",
            ""6"",
            ""7"",
            ""8"",
            ""9"",
            ""10"",
            ""11"",
            ""12""
          ],
          ""context"": ""Mapping numeric months to quarter strings ('Q1', 'Q2', 'Q3', 'Q4')."",
          ""suggested_governance"": ""Use a date dimension table that contains quarter mappings or a governed lookup for financial quarters."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Current Week'""
          ],
          ""context"": ""Literal string used to label the current week period."",
          ""suggested_governance"": ""Define standard labels for current/prior periods in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., CURRENT_DATE()) to ensure data freshness and dynamic reporting."",
      ""Replace hardcoded lookup values (e.g., 'PROGRAMMATIC EXCHANGE', month names, quarter ranges) with joins to governed reference tables or configuration parameters to improve maintainability and data consistency."",
      ""Use configuration tables for business rules (e.g., financial year start/end, week definitions, period offsets) instead of hardcoded logic to centralize and manage business logic."",
      ""Parameterize relative period offsets (e.g., current year, previous year, specific month offsets) for flexible reporting and 'what-if' analysis.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount from booking lines."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_year"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Total gross revenue for the current financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-23"",
        ""2025-06-22""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'FY'"",
        ""'PROGRAMMATIC EXCHANGE'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""relative year offset should be dynamic"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_year"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Total gross revenue for the previous financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons and trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-23"",
        ""2025-06-22""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'FY'"",
        ""'PROGRAMMATIC EXCHANGE'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""relative year offset should be dynamic"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_yoy_gross_revenue"",
      ""metric_name"": ""Previous FY YoY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""booking_line_created_date""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, limited to bookings created up to 365 days prior to the current hardcoded date. Used for like-for-like YoY comparison."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND PARSE_DATE('%Y-%m-%d', booking_line_created_date) <= DATETIME_ADD(CURRENT_DATE_PROXY, INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a fair comparison point for current year performance against the previous year's equivalent period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-23"",
        ""2025-06-22""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""-365 DAY"",
        ""'FY'"",
        ""'PROGRAMMATIC EXCHANGE'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""relative year offset should be dynamic"",
        ""YoY interval should be dynamic"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prior_period_comparison_revenue"",
      ""metric_name"": ""Prior Period Comparison Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""financial_month|financial_year"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""previous_fy_gross_revenue"",
        ""previous_fy_yoy_gross_revenue"",
        ""relative_fy_month_offset""
      ],
      ""business_description"": ""A dynamic prior period revenue metric. If the financial month offset is more than 12 months ago, it uses the full previous FY gross revenue; otherwise, it uses the YoY adjusted previous FY gross revenue."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_month_offset < -12) THEN previous_fy_gross_revenue_calc ELSE previous_fy_yoy_gross_revenue_calc END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a flexible prior period comparison, adapting based on the time window being analyzed."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-05-23"",
        ""2025-06-22""
      ],
      ""hardcoded_values_in_metric"": [
        ""-12"",
        ""'FY'"",
        ""'PROGRAMMATIC EXCHANGE'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""relative month offset threshold should be dynamic"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_amount_diff"",
      ""metric_name"": ""Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The difference in gross amounts, likely representing financial adjustments or movements."",
      ""sql_logic"": ""SUM(t0.GROSS_AMOUNT_DIFF)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""Excludes 'min_week' (first week of period)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track financial adjustments and reconcile revenue figures."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""week exclusion logic should be clear and potentially configurable""
      ],
      ""data_quality_concerns"": [
        ""potential for negative values if adjustments are refunds/deductions""
      ]
    },
    {
      ""metric_id"": ""agency_parent"",
      ""metric_name"": ""Agency Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent agency associated with the booking or financial movement."",
      ""sql_logic"": ""t0.agency_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary grouping dimension for agency-level reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for inconsistent naming if not governed by a master data management system""
      ]
    },
    {
      ""metric_id"": ""financial_quarter_string"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_month_numeric""
      ],
      ""business_description"": ""The financial quarter (Q1, Q2, Q3, Q4) derived from the financial month."",
      ""sql_logic"": ""CASE WHEN (financial_month IN (1, 2, 3)) THEN 'Q1' WHEN (financial_month IN (4, 5, 6)) THEN 'Q2' WHEN (financial_month IN (7, 8, 9)) THEN 'Q3' WHEN (financial_month IN (10, 11, 12)) THEN 'Q4' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for quarterly financial reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""2"",
        ""3"",
        ""4"",
        ""5"",
        ""6"",
        ""7"",
        ""8"",
        ""9"",
        ""10"",
        ""11"",
        ""12"",
        ""'Q1'"",
        ""'Q2'"",
        ""'Q3'"",
        ""'Q4'""
      ],
      ""governance_issues"": [
        ""quarter mappings should be in a date dimension table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_numeric"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The numeric representation of the financial month."",
      ""sql_logic"": ""t0.financial_month (or derived from calendar_month_short_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for monthly financial reporting and as a basis for quarter derivation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jan'"",
        ""'Feb'"",
        ""'Mar'"",
        ""'Apr'"",
        ""'May'"",
        ""'Jun'"",
        ""'Jul'"",
        ""'Aug'"",
        ""'Sep'"",
        ""'Oct'"",
        ""'Nov'"",
        ""'Dec'""
      ],
      ""governance_issues"": [
        ""month name to number mapping should be in a date dimension table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year_numeric"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The numeric representation of the financial year."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for yearly financial reporting and trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""week_period_label"",
      ""metric_name"": ""Week Period Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional|string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""movement_financial_week"",
        ""max_week"",
        ""min_week""
      ],
      ""business_description"": ""A label indicating the financial week, or 'Current Week' if it matches the maximum week."",
      ""sql_logic"": ""CASE WHEN (movement_financial_week = max_week) THEN 'Current Week' ELSE CONCAT(' Week ',SAFE_CAST(movement_financial_week AS STRING)) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""Excludes 'min_week' (first week of period)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a user-friendly label for financial week periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Current Week'""
      ],
      ""governance_issues"": [
        ""'Current Week' label should be configurable"",
        ""week definitions (max_week, min_week) should be governed""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""prior_period_comparison_revenue"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue"",
        ""previous_fy_yoy_gross_revenue""
      ],
      ""relationship_description"": ""Prior Period Comparison Revenue dynamically selects between full previous FY revenue and YoY adjusted previous FY revenue based on the relative financial month offset."",
      ""mathematical_formula"": ""IF (relative_fy_month_offset < -12, previous_fy_gross_revenue, previous_fy_yoy_gross_revenue)"",
      ""business_validation"": ""Ensures the most appropriate prior period comparison is used depending on the historical depth of the analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_month_offset < -12 THEN previous_fy_gross_revenue ELSE previous_fy_yoy_gross_revenue END) AS calculated_prior_period_revenue FROM (SELECT *, SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) OVER() AS previous_fy_gross_revenue, SUM(CASE WHEN relative_fy_year_offset = -1 AND SAFE_CAST(booking_line_created_date AS DATE) <= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY) THEN gross_revenue_amount ELSE 0 END) OVER() AS previous_fy_yoy_gross_revenue FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE revenue_group_subtype != 'PROGRAMMATIC EXCHANGE') WHERE relative_fy_month_offset IS NOT NULL LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue""
      ],
      ""relationship_description"": ""These metrics are used together to calculate Year-over-Year (YoY) growth or decline in gross revenue."",
      ""mathematical_formula"": ""((current_fy_gross_revenue - previous_fy_gross_revenue) / previous_fy_gross_revenue) * 100"",
      ""business_validation"": ""YoY growth is a critical indicator of business performance and trend."",
      ""validation_sql"": ""SELECT (SUM(current_fy_gross_revenue) - SUM(previous_fy_gross_revenue)) / NULLIF(SUM(previous_fy_gross_revenue), 0) * 100 AS yoy_growth_percentage FROM (SELECT CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue, CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END AS previous_fy_gross_revenue FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE revenue_group_subtype != 'PROGRAMMATIC EXCHANGE') LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,21
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26"",
    ""dashboard_name"": ""Optimizing Digital Subscriptions Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 8,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""subscription_date"",
      ""masthead_category"",
      ""recognition_type"",
      ""masthead_name_derived"",
      ""gl_publication_code"",
      ""masthead_code"",
      ""delivery_medium_type"",
      ""classification_level_1_description""
    ],
    ""date_range_detected"": ""Fiscal Year 2025 (starting July 2024)"",
    ""hardcoded_dates_found"": [
      ""2025-03-23 04:54:02.058726+00"",
      ""2024-07-03T00:00:00""
    ],
    ""hardcoded_values_found"": [
      ""'2025'"",
      ""'All Mastheads'"",
      ""'FCT'"",
      ""'Gross Cancellations'"",
      ""'Gross Acquisitions'"",
      ""numerous gl_publication_code values (e.g., '100', '402', '301')"",
      ""numerous masthead_code values (e.g., 'TA', 'CM', 'DT')""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE(), DATE_SUB())."",
      ""Masthead and publication codes should be managed in a governed reference table and joined, rather than hardcoded in CASE statements."",
      ""Complex business rules for masthead categorization should be externalized (e.g., in a configuration table or UDF) for easier maintenance and auditing."",
      ""The redundant 'a' = 'a' and 'All Mastheads' = 'All Mastheads' conditions should be removed.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates the identified dimensions and infers common business metrics for a Digital Subscriptions Report.\n-- It assumes the existence of 'subscription_date', 'subscription_id', and 'revenue_amount' columns in the base table.\n-- The masthead categorization logic is complex and has been re-created based on the provided SQL samples.\nWITH\n  base_data AS (\n    SELECT\n      t0.classification_level_1_description,\n      t0.classification_level_2_description,\n      t0.delivery_medium_type,\n      t0.gl_publication_code,\n      t0.masthead_code,\n      t0.subscriber_has_email_flag,\n      -- Placeholder for the actual date column in the base table. Assuming 'subscription_date'.\n      SAFE_CAST(t0.subscription_date AS DATE) AS subscription_date,\n      -- Placeholder for a unique subscription/subscriber identifier. Assuming 'subscription_id'.\n      t0.subscription_id,\n      -- Placeholder for a revenue amount. Assuming 'revenue_amount'.\n      t0.revenue_amount\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    -- Filter for a relevant date range to ensure performance and current data\n    WHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\n  ),\n  intermediate_flags AS (\n    SELECT\n      subscription_date,\n      subscription_id,\n      revenue_amount,\n      classification_level_1_description,\n      classification_level_2_description,\n      delivery_medium_type,\n      gl_publication_code,\n      masthead_code,\n      subscriber_has_email_flag,\n      -- Derived subscriber_has_email_flag_derived (clmn85_ in Q1, clmn82_ in Q2, clmn84_ in Q3)\n      CASE\n        WHEN subscriber_has_email_flag = 'subsnapfact' THEN 'Y'\n        WHEN (classification_level_1_description = 'Standard Paid' AND delivery_medium_type = 'Bundle') THEN subscriber_has_email_flag\n        ELSE 'Y'\n      END AS subscriber_has_email_flag_derived,\n      -- Derived Masthead Name (clmn86_ in Q1, clmn83_ in Q2, clmn85_ in Q3)\n      CASE\n        WHEN (gl_publication_code IN ('100', '101') OR masthead_code = 'TA') THEN 'The Australian'\n        WHEN (gl_publication_code IN ('400', '401', '402') OR masthead_code = 'CM') THEN 'Courier Mail'\n        WHEN (gl_publication_code IN ('110', '111', '116') OR masthead_code = 'DT') THEN 'Daily Telegraph'\n        WHEN (gl_publication_code IN ('301', '302', '303') OR masthead_code = 'HS') THEN 'Herald Sun'\n        WHEN (gl_publication_code IN ('500', '501', '560') OR masthead_code = 'AA') THEN 'The Advertiser'\n        WHEN (gl_publication_code IN ('450', '460') OR masthead_code = 'CP') THEN 'Cairns Post'\n        WHEN (gl_publication_code IN ('350', '351') OR masthead_code = 'GA') THEN 'Geelong'\n        WHEN (gl_publication_code IN ('670', '685') OR masthead_code = 'GC') THEN 'Gold Coast'\n        WHEN (gl_publication_code IN ('961', '962', '963') OR masthead_code = 'NT') THEN 'NT News'\n        WHEN (gl_publication_code IN ('850', '851', '852') OR masthead_code = 'TM') THEN 'The Mercury'\n        WHEN (gl_publication_code IN ('5053', '5253') OR masthead_code = 'TC') THEN 'Toowoomba'\n        WHEN (gl_publication_code IN ('475', '490') OR masthead_code = 'TB') THEN 'Townsville'\n        WHEN (gl_publication_code IN ('305', '307') OR masthead_code = 'WT') THEN 'Weekly Times'\n        WHEN (gl_publication_code IN ('9001', '9002') OR masthead_code = 'CS') THEN 'Code'\n        WHEN (gl_publication_code IN ('8821', '8822') OR masthead_code = 'PU') THEN 'Punters'\n        WHEN (gl_publication_code IN ('8822') OR masthead_code = 'RN') THEN 'Racenet'\n        WHEN (gl_publication_code IN ('9653', '9600') OR masthead_code = 'SC') THEN 'Supercoach Plus'\n        WHEN (gl_publication_code IN ('9600', '9603') OR masthead_code = 'TS') THEN 'Taste Online'\n        WHEN (gl_publication_code = '9003' OR masthead_code = 'AP') THEN 'Apple Podcast: Crime X'\n        WHEN (gl_publication_code = '103' OR masthead_code = 'The Oz') THEN 'The Oz'\n        WHEN (gl_publication_code = '9000' OR masthead_code = 'NW') THEN 'news.com.au'\n        WHEN (gl_publication_code = '121') THEN 'Others'\n        WHEN (gl_publication_code = '9002' OR masthead_code = 'BG') THEN 'Brain Games'\n        WHEN (gl_publication_code IN ('9504', '9558', '9556', '9623', '9603', '9514', '121')) THEN 'Others'\n        WHEN (gl_publication_code = '9644') THEN 'Suddenly'\n        WHEN (gl_publication_code = '9903') THEN 'News Corporate'\n        WHEN (gl_publication_code = 'Group Newspaper Management - Digital') THEN 'Group Newspaper Management - Digital'\n        ELSE 'Discontinued' -- Default for unknown mastheads\n      END AS masthead_name_derived\n    FROM\n      base_data\n  )\nSELECT\n  FORMAT_DATE('%Y-%m-%d', subscription_date) AS report_date,\n  -- Recognition Type (clmn88_ in Q1, clmn84_ in Q2, clmn86_ in Q3)\n  CASE\n    WHEN delivery_medium_type = 'Print' THEN 'Print Recognition'\n    WHEN subscriber_has_email_flag_derived = 'N' THEN 'Print Recognition'\n    ELSE 'Digital Recognition'\n  END AS recognition_type,\n  -- Masthead Category (clmn127_ in Q1, clmn103_ in Q2, clmn105_ in Q3)\n  CASE\n    WHEN masthead_name_derived = 'The Australian' THEN 'The Australian'\n    WHEN (masthead_name_derived IN ('Daily Telegraph', 'The Advertiser', 'Herald Sun', 'Courier Mail')) THEN 'Metros'\n    WHEN (masthead_name_derived IN ('Cairns Post', 'Gold Coast', 'Geelong', 'NT News', 'The Mercury', 'Townsville', 'Toowoomba')) THEN 'Regionals'\n    WHEN masthead_name_derived = 'Weekly Times' THEN 'Others'\n    WHEN (masthead_name_derived IN ('Supercoach Plus', 'Racenet', 'Punters', 'Code', 'Apple Podcast: Crime X', 'Taste Online', 'Others')) THEN 'Deep Niche Publications'\n    ELSE 'Discontinued'\n  END AS masthead_category,\n  masthead_name_derived AS masthead_name,\n  COUNT(DISTINCT subscription_id) AS total_digital_subscriptions,\n  SUM(SAFE_CAST(revenue_amount AS NUMERIC)) AS total_digital_revenue\nFROM\n  intermediate_flags\nWHERE\n  (CASE\n    WHEN delivery_medium_type = 'Print' THEN 'Print Recognition'\n    WHEN subscriber_has_email_flag_derived = 'N' THEN 'Print Recognition'\n    ELSE 'Digital Recognition'\n  END) = 'Digital Recognition'\n  AND (CASE\n    WHEN masthead_name_derived = 'The Australian' THEN 'The Australian'\n    WHEN (masthead_name_derived IN ('Daily Telegraph', 'The Advertiser', 'Herald Sun', 'Courier Mail')) THEN 'Metros'\n    WHEN (masthead_name_derived IN ('Cairns Post', 'Gold Coast', 'Geelong', 'NT News', 'The Mercury', 'Townsville', 'Toowoomba')) THEN 'Regionals'\n    WHEN masthead_name_derived = 'Weekly Times' THEN 'Others'\n    WHEN (masthead_name_derived IN ('Supercoach Plus', 'Racenet', 'Punters', 'Code', 'Apple Podcast: Crime X', 'Taste Online', 'Others')) THEN 'Deep Niche Publications'\n    ELSE 'Discontinued'\n  END) != 'Discontinued'\nGROUP BY\n  report_date,\n  masthead_category,\n  recognition_type,\n  masthead_name\nORDER BY\n  report_date DESC, total_digital_subscriptions DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.subscription_date AS DATE)) as unique_dates, -- Assuming 'subscription_date' is the date column\n  COUNT(DISTINCT t0.subscription_id) as unique_subscriptions, -- Assuming 'subscription_id' is the unique ID\n  COUNT(DISTINCT t0.gl_publication_code) as unique_gl_publication_codes,\n  COUNT(DISTINCT t0.masthead_code) as unique_masthead_codes,\n  MIN(SAFE_CAST(t0.subscription_date AS DATE)) as earliest_date,\n  MAX(SAFE_CAST(t0.subscription_date AS DATE)) as latest_date\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN COUNT(DISTINCT t0.subscription_id) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_id_test,\n  CASE WHEN MAX(SAFE_CAST(t0.subscription_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN t0.delivery_medium_type IS NULL THEN 1 END) = 0 THEN 'PASS' ELSE 'FAIL' END as delivery_medium_type_not_null_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Digital Recognition Filter Adherence' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (CASE WHEN t0.delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN (CASE WHEN t0.subscriber_has_email_flag = 'subsnapfact' THEN 'Y' WHEN (t0.classification_level_1_description = 'Standard Paid' AND t0.delivery_medium_type = 'Bundle') THEN t0.subscriber_has_email_flag ELSE 'Y' END) = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (CASE WHEN t0.delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN (CASE WHEN t0.subscriber_has_email_flag = 'subsnapfact' THEN 'Y' WHEN (t0.classification_level_1_description = 'Standard Paid' AND t0.delivery_medium_type = 'Bundle') THEN t0.subscriber_has_email_flag ELSE 'Y' END) = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.subscription_date AS DATE) as subscription_date,\n  t0.classification_level_1_description,\n  t0.delivery_medium_type,\n  t0.gl_publication_code,\n  t0.masthead_code,\n  t0.subscriber_has_email_flag,\n  t0.subscription_id,\n  SAFE_CAST(t0.revenue_amount AS NUMERIC) as revenue_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY\n  SAFE_CAST(t0.subscription_date AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-03-23"",
          ""original_format"": ""2025-03-23 04:54:02.058726+00"",
          ""context"": ""Used as a fixed date for clmn0_ in the innermost subquery of Q1, which then influences fiscal week/month calculations. This effectively makes the entire query static for a specific point in time."",
          ""suggested_fix"": ""Replace with a dynamic date (e.g., CURRENT_DATE()) or a parameter that can be selected by the user."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the baseline date for calculating fiscal week differences (DATETIME_DIFF) in Q1. This likely represents the start of a fiscal year."",
          ""suggested_fix"": ""Replace with a parameter for fiscal year start date, or derive dynamically from a fiscal calendar table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'100'"",
            ""'402'"",
            ""'301'"",
            ""..."",
            ""'TA'"",
            ""'CM'"",
            ""'DT'"",
            ""...""
          ],
          ""context"": ""Extensive list of `gl_publication_code` and `masthead_code` values used in complex CASE statements to derive `masthead_name_derived` and `masthead_category`. This makes the logic difficult to maintain and update."",
          ""suggested_governance"": ""Create a `masthead_lookup` reference table with `gl_publication_code`, `masthead_code`, `masthead_name`, and `masthead_category` columns. Join to this table instead of using hardcoded CASE statements."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'2025'"",
            ""'All Mastheads'"",
            ""'FCT'"",
            ""'Gross Cancellations'"",
            ""'Gross Acquisitions'""
          ],
          ""context"": ""The year '2025' is hardcoded in the fiscal period label. Report type labels ('FCT', 'Gross Cancellations', 'Gross Acquisitions') are hardcoded strings returned by queries, likely for filter options or report titles."",
          ""suggested_governance"": ""Parameterize the fiscal year. Manage report labels/types in a configuration table or use Looker Studio's built-in parameter/control features."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values for mastheads and publication codes with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., fiscal year start, masthead groupings) instead of embedding complex logic directly in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fiscal_period_label"",
      ""metric_name"": ""Fiscal Period Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function|date_function|case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A concatenated string representing the Fiscal Year, Fiscal Week, and Fiscal Month. Used primarily for filtering or displaying time periods in the dashboard."",
      ""sql_logic"": ""CONCAT('FY ','2025',' Week ',SAFE_CAST(fiscal_week_number AS STRING),' (',SAFE_CAST(fiscal_month_name AS STRING),')')\n  where fiscal_week_number is derived from DATETIME_DIFF(subscription_date, '2024-07-03T00:00:00', WEEK) and fiscal_month_name is derived from fiscal_week_number via a complex CASE statement."",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a granular fiscal time dimension for analyzing subscription trends."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-03-23"",
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded fiscal year and baseline date should be parameterized."",
        ""Fiscal week to month mapping is hardcoded and complex.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""recognition_type"",
      ""metric_name"": ""Recognition Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorizes subscriptions into 'Print Recognition' or 'Digital Recognition' based on delivery medium and subscriber email flag. Crucial for segmenting digital vs. print performance."",
      ""sql_logic"": ""CASE\n  WHEN delivery_medium_type = 'Print' THEN 'Print Recognition'\n  WHEN (CASE WHEN subscriber_has_email_flag = 'subsnapfact' THEN 'Y' WHEN (classification_level_1_description = 'Standard Paid' AND delivery_medium_type = 'Bundle') THEN subscriber_has_email_flag ELSE 'Y' END) = 'N' THEN 'Print Recognition'\n  ELSE 'Digital Recognition'\nEND"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""='Digital Recognition'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary filter for focusing on digital subscription performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Print'"",
        ""'Y'"",
        ""'N'"",
        ""'Standard Paid'"",
        ""'Bundle'"",
        ""'subsnapfact'""
      ],
      ""governance_issues"": [
        ""Business logic for 'Digital Recognition' is embedded in SQL, could be externalized.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on 'subscriber_has_email_flag' and 'delivery_medium_type' for accurate categorization.""
      ]
    },
    {
      ""metric_id"": ""masthead_category"",
      ""metric_name"": ""Masthead Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""masthead_name_derived""
      ],
      ""business_description"": ""Groups individual mastheads into broader categories like 'Metros', 'Regionals', 'Deep Niche Publications', etc. for high-level analysis."",
      ""sql_logic"": ""CASE\n  WHEN masthead_name_derived = 'The Australian' THEN 'The Australian'\n  WHEN (masthead_name_derived IN ('Daily Telegraph', 'The Advertiser', 'Herald Sun', 'Courier Mail')) THEN 'Metros'\n  WHEN (masthead_name_derived IN ('Cairns Post', 'Gold Coast', 'Geelong', 'NT News', 'The Mercury', 'Townsville', 'Toowoomba')) THEN 'Regionals'\n  WHEN masthead_name_derived = 'Weekly Times' THEN 'Others'\n  WHEN (masthead_name_derived IN ('Supercoach Plus', 'Racenet', 'Punters', 'Code', 'Apple Podcast: Crime X', 'Taste Online', 'Others')) THEN 'Deep Niche Publications'\n  ELSE 'Discontinued'\nEND"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""!='Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables aggregated reporting across masthead groups, providing a strategic view of performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian'"",
        ""'Metros'"",
        ""'Regionals'"",
        ""'Others'"",
        ""'Deep Niche Publications'"",
        ""'Discontinued'"",
        ""many specific masthead names""
      ],
      ""governance_issues"": [
        ""Hardcoded mapping of masthead names to categories; should be driven by a reference table."",
        ""The underlying `masthead_name_derived` is also hardcoded and complex.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correctness and completeness of the `masthead_name_derived` logic.""
      ]
    },
    {
      ""metric_id"": ""report_type_fct_label"",
      ""metric_name"": ""Report Type FCT Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'FCT', likely used to identify a specific report type or view within the dashboard."",
      ""sql_logic"": ""CASE WHEN (2 = 2) THEN 'FCT' ELSE NULL END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Acts as a static identifier for a particular dashboard view or filter option."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FCT'""
      ],
      ""governance_issues"": [
        ""Hardcoded string; should be managed as a parameter or configuration value if dynamic.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""report_type_cancellations_label"",
      ""metric_name"": ""Report Type Cancellations Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'Gross Cancellations', likely used to identify a specific report type or view within the dashboard."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Gross Cancellations' ELSE NULL END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Acts as a static identifier for a particular dashboard view or filter option related to cancellations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Gross Cancellations'""
      ],
      ""governance_issues"": [
        ""Hardcoded string; should be managed as a parameter or configuration value if dynamic.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""report_type_acquisitions_label"",
      ""metric_name"": ""Report Type Acquisitions Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'Gross Acquisitions', likely used to identify a specific report type or view within the dashboard."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Gross Acquisitions' ELSE NULL END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Acts as a static identifier for a particular dashboard view or filter option related to acquisitions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Gross Acquisitions'""
      ],
      ""governance_issues"": [
        ""Hardcoded string; should be managed as a parameter or configuration value if dynamic.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_digital_subscriptions"",
      ""metric_name"": ""Total Digital Subscriptions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""daily|masthead|category"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""recognition_type"",
        ""masthead_category""
      ],
      ""business_description"": ""The total count of unique digital subscriptions, aggregated by date and masthead categories, after applying relevant filters."",
      ""sql_logic"": ""COUNT(DISTINCT t0.subscription_id) -- Assuming 'subscription_id' is the unique identifier for a subscription"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Core KPI for tracking the overall volume and growth of the digital subscription base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the uniqueness and completeness of 'subscription_id' and the correctness of recognition/masthead categorization.""
      ]
    },
    {
      ""metric_id"": ""total_digital_revenue"",
      ""metric_name"": ""Total Digital Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""daily|masthead|category"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""recognition_type"",
        ""masthead_category""
      ],
      ""business_description"": ""The total revenue generated from digital subscriptions, aggregated by date and masthead categories, after applying relevant filters."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.revenue_amount AS NUMERIC)) -- Assuming 'revenue_amount' is the revenue column"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`""
      ],
      ""filters_applied"": [
        ""Recognition Type = 'Digital Recognition'"",
        ""Masthead Category != 'Discontinued'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core KPI for tracking the financial performance of the digital subscription business."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correctness of 'revenue_amount' data and the applied filters.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_digital_subscriptions"",
      ""related_metrics"": [
        ""recognition_type"",
        ""masthead_category"",
        ""fiscal_period_label"",
        ""report_type_fct_label"",
        ""report_type_cancellations_label"",
        ""report_type_acquisitions_label""
      ],
      ""relationship_description"": ""The quantitative metrics (Total Digital Subscriptions, Total Digital Revenue) are directly filtered and segmented by the 'Recognition Type' and 'Masthead Category' dimensions. The 'Fiscal Period Label' and 'Report Type Labels' likely serve as interactive filters or display labels within the dashboard, allowing users to slice the quantitative metrics."",
      ""mathematical_formula"": ""N/A (filtering relationship)"",
      ""business_validation"": ""Ensures that subscription and revenue data is analyzed within the correct digital context and across relevant masthead groupings, as defined by business rules."",
      ""validation_sql"": ""SELECT\n  (SUM(CASE WHEN (CASE WHEN t0.delivery_medium_type = 'Print' THEN 'Print Recognition' WHEN (CASE WHEN t0.subscriber_has_email_flag = 'subsnapfact' THEN 'Y' WHEN (t0.classification_level_1_description = 'Standard Paid' AND t0.delivery_medium_type = 'Bundle') THEN t0.subscriber_has_email_flag ELSE 'Y' END) = 'N' THEN 'Print Recognition' ELSE 'Digital Recognition' END) = 'Digital Recognition' THEN 1 ELSE 0 END) = COUNT(*)) AS digital_recognition_filter_works,\n  (SUM(CASE WHEN (CASE WHEN t0.masthead_code = 'The Australian' THEN 'The Australian' WHEN (t0.masthead_code IN ('Daily Telegraph', 'The Advertiser', 'Herald Sun', 'Courier Mail')) THEN 'Metros' ELSE 'Discontinued' END) != 'Discontinued' THEN 1 ELSE 0 END) = COUNT(*)) AS masthead_category_filter_works\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE SAFE_CAST(t0.subscription_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_digital_revenue"",
      ""related_metrics"": [
        ""recognition_type"",
        ""masthead_category"",
        ""fiscal_period_label"",
        ""report_type_fct_label"",
        ""report_type_cancellations_label"",
        ""report_type_acquisitions_label""
      ],
      ""relationship_description"": ""Similar to Total Digital Subscriptions, Total Digital Revenue is filtered and segmented by 'Recognition Type' and 'Masthead Category'. The labels serve as interactive controls."",
      ""mathematical_formula"": ""N/A (filtering relationship)"",
      ""business_validation"": ""Ensures that revenue data is analyzed within the correct digital context and across relevant masthead groupings."",
      ""validation_sql"": ""See validation_sql for total_digital_subscriptions, as the filters are identical."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,22
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b1c5901f-a535-42eb-870d-05cc025f7c27"",
    ""dashboard_name"": ""OS extract for month end rec"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_week_of_year"",
      ""fiscal_year"",
      ""gl_hierarchy_code"",
      ""is_print_digital_flag"",
      ""l03_publication_code"",
      ""l12_publication_code"",
      ""os_level_4"",
      ""os_level_5"",
      ""os_level_6"",
      ""os_level_7"",
      ""os_level_9"",
      ""publication_name""
    ],
    ""date_range_detected"": ""Fiscal Year 2025, Fiscal Week 40"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'FY2025'"",
      ""40"",
      ""'Total Revenue'"",
      ""'Total Expenses'"",
      ""'News Media Publishing'"",
      ""'Circulation'"",
      ""'Subscription'"",
      ""'Content Licensing'"",
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""Fiscal year and week should be parameterized or derived from a central date/period control table."",
      ""Business categories (e.g., 'Total Revenue', 'Circulation') should be managed in dimension tables or configuration tables."",
      ""The 'calender_table' CTE is unused and should be removed."",
      ""The 'v_asl_DIM_gl_department' join is present but its columns are not used, indicating potential dead code."",
      ""Redundant '1=1' filter in calendar subquery.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.Actual_Amount,\n      os.Budget_Amount,\n      os.Forecast_Amount,\n      calendar.fy_week_of_year,\n      calendar.fy_year,\n      os.gl_hierarchy_code,\n      os.is_print_digital_flag,\n      pub.l03_publication_code,\n      pub.l12_publication_code,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_9,\n      pub.publication_name,\n      os.fiscal_week_id\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n          SAFE_CAST(c.fy_year AS INT64) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n      ON os.os_level_12 = dep.department_code\n)\nSELECT\n  SAFE_CAST(fy_week_of_year AS INT64) AS fiscal_week_of_year,\n  SAFE_CAST(fy_year AS INT64) AS fiscal_year,\n  SAFE_CAST(gl_hierarchy_code AS STRING) AS gl_hierarchy_code,\n  SAFE_CAST(is_print_digital_flag AS STRING) AS is_print_digital_flag,\n  SAFE_CAST(l03_publication_code AS STRING) AS l03_publication_code,\n  SAFE_CAST(l12_publication_code AS STRING) AS l12_publication_code,\n  SAFE_CAST(os_level_4 AS STRING) AS os_level_4,\n  SAFE_CAST(os_level_5 AS STRING) AS os_level_5,\n  SAFE_CAST(os_level_6 AS STRING) AS os_level_6,\n  SAFE_CAST(os_level_7 AS STRING) AS os_level_7,\n  SAFE_CAST(os_level_9 AS STRING) AS os_level_9,\n  SAFE_CAST(publication_name AS STRING) AS publication_name,\n  SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) AS total_actual_amount,\n  SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS total_budget_amount,\n  SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS total_forecast_amount\nFROM\n  OSandFACT\nWHERE\n  SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025'\n  AND SAFE_CAST(fy_week_of_year AS INT64) = 40\n  AND SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses')\n  AND SAFE_CAST(l03_publication_code AS STRING) = 'News Media Publishing'\n  AND SAFE_CAST(os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing')\nGROUP BY\n  fiscal_week_of_year,\n  fiscal_year,\n  gl_hierarchy_code,\n  is_print_digital_flag,\n  l03_publication_code,\n  l12_publication_code,\n  os_level_4,\n  os_level_5,\n  os_level_6,\n  os_level_7,\n  os_level_9,\n  publication_name\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(os.fiscal_week_id AS INT64)) as unique_fiscal_week_ids,\n  COUNT(DISTINCT SAFE_CAST(os.gl_publication_code AS STRING)) as unique_gl_publication_codes,\n  COUNT(DISTINCT SAFE_CAST(os.os_level_4 AS STRING)) as unique_os_level_4_categories,\n  MIN(SAFE_CAST(calendar.fy_year AS INT64)) as earliest_fiscal_year,\n  MAX(SAFE_CAST(calendar.fy_year AS INT64)) as latest_fiscal_year,\n  MIN(SAFE_CAST(calendar.fy_week_of_year AS INT64)) as earliest_fiscal_week_of_year,\n  MAX(SAFE_CAST(calendar.fy_week_of_year AS INT64)) as latest_fiscal_week_of_year,\n  SUM(CASE WHEN os.Actual_Amount IS NULL THEN 1 ELSE 0 END) as null_actual_amount_count,\n  SUM(CASE WHEN os.Budget_Amount IS NULL THEN 1 ELSE 0 END) as null_budget_amount_count,\n  SUM(CASE WHEN os.Forecast_Amount IS NULL THEN 1 ELSE 0 END) as null_forecast_amount_count\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN\n  (\n    SELECT DISTINCT\n      SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n      SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n      SAFE_CAST(c.fy_year AS INT64) AS fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n      JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n      ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n  ) AS calendar\n  ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  SAFE_CAST(calendar.fy_year AS INT64) >= SAFE_CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 2 AS INT64)\nLIMIT 1;"",
    ""validation_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.Actual_Amount,\n      os.Budget_Amount,\n      os.Forecast_Amount,\n      calendar.fy_week_of_year,\n      calendar.fy_year,\n      os.gl_hierarchy_code,\n      os.os_level_4,\n      pub.l03_publication_code,\n      os.os_level_6\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n          SAFE_CAST(c.fy_year AS INT64) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n)\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_amount_test,\n  CASE WHEN SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as forecast_amount_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(gl_hierarchy_code AS STRING)) = 1 AND MAX(SAFE_CAST(gl_hierarchy_code AS STRING)) = 'FY2025' THEN 'PASS' ELSE 'FAIL' END as fiscal_year_filter_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(fy_week_of_year AS INT64)) = 1 AND MAX(SAFE_CAST(fy_week_of_year AS INT64)) = 40 THEN 'PASS' ELSE 'FAIL' END as fiscal_week_filter_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(os_level_4 AS STRING)) >= 1 AND SUM(CASE WHEN SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as os_level_4_filter_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(l03_publication_code AS STRING)) >= 1 AND SUM(CASE WHEN SAFE_CAST(l03_publication_code AS STRING) = 'News Media Publishing' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as l03_pub_filter_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(os_level_6 AS STRING)) >= 1 AND SUM(CASE WHEN SAFE_CAST(os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing') THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as os_level_6_filter_test\nFROM\n  OSandFACT\nWHERE\n  SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025'\n  AND SAFE_CAST(fy_week_of_year AS INT64) = 40\n  AND SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses')\n  AND SAFE_CAST(l03_publication_code AS STRING) = 'News Media Publishing'\n  AND SAFE_CAST(os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing')\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH OSandFACT AS (\n    SELECT\n      calendar.fy_week_of_year,\n      os.gl_hierarchy_code,\n      os.os_level_4,\n      pub.l03_publication_code,\n      os.os_level_6,\n      control.period_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN\n      (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n          control.period_name\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON control.source_week_number = c.fy_year_week_number\n      ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Fiscal Year Filter' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nWHERE SAFE_CAST(fy_week_of_year AS INT64) = 40\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Fiscal Week Filter' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(fy_week_of_year AS INT64) = 40 THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nWHERE SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025'\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'OS Level 4 Filter (Revenue/Expenses)' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nWHERE SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fy_week_of_year AS INT64) = 40\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'L03 Publication Filter (News Media Publishing)' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(l03_publication_code AS STRING) = 'News Media Publishing' THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(l03_publication_code AS STRING) = 'News Media Publishing' THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nWHERE SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fy_week_of_year AS INT64) = 40\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'OS Level 6 Filter (Revenue Types)' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing') THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing') THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nWHERE SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fy_week_of_year AS INT64) = 40\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Period Control Filter (CP/PY)' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN SAFE_CAST(period_name AS STRING) IN ('CP', 'PY') THEN 1 ELSE 0 END) as records_matching_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(period_name AS STRING) IN ('CP', 'PY') THEN 1 ELSE 0 END), COUNT(*)) * 100 as compliance_percentage\nFROM OSandFACT\nLIMIT 5;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n  SAFE_CAST(calendar.fy_week_of_year AS INT64) AS fiscal_week_of_year,\n  SAFE_CAST(calendar.fy_year AS INT64) AS fiscal_year,\n  SAFE_CAST(os.gl_hierarchy_code AS STRING) AS gl_hierarchy_code,\n  SAFE_CAST(os.is_print_digital_flag AS STRING) AS is_print_digital_flag,\n  SAFE_CAST(pub.l03_publication_code AS STRING) AS l03_publication_code,\n  SAFE_CAST(pub.l12_publication_code AS STRING) AS l12_publication_code,\n  SAFE_CAST(os.os_level_4 AS STRING) AS os_level_4,\n  SAFE_CAST(os.os_level_5 AS STRING) AS os_level_5,\n  SAFE_CAST(os.os_level_6 AS STRING) AS os_level_6,\n  SAFE_CAST(os.os_level_7 AS STRING) AS os_level_7,\n  SAFE_CAST(os.os_level_9 AS STRING) AS os_level_9,\n  SAFE_CAST(pub.publication_name AS STRING) AS publication_name,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) AS actual_amount,\n  SAFE_CAST(os.Budget_Amount AS NUMERIC) AS budget_amount,\n  SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS forecast_amount\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN\n  `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n  ON os.gl_publication_code = pub.publication_code\n  LEFT JOIN\n  (\n    SELECT DISTINCT\n      SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n      SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n      SAFE_CAST(c.fy_year AS INT64) AS fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n      JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n      ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n  ) AS calendar\n  ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN\n  `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n  ON os.os_level_12 = dep.department_code\nWHERE\n  SAFE_CAST(calendar.fy_year AS INT64) = SAFE_CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS INT64)\n  AND SAFE_CAST(calendar.fy_week_of_year AS INT64) <= SAFE_CAST(EXTRACT(WEEK FROM CURRENT_DATE()) AS INT64)\n  AND os.Actual_Amount IS NOT NULL\nORDER BY\n  fiscal_year DESC, fiscal_week_of_year DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""fiscal_period"",
          ""hardcoded_values"": [
            ""'FY2025'"",
            ""40""
          ],
          ""context"": ""Fiscal year and week are hardcoded in WHERE clauses."",
          ""suggested_governance"": ""Use date parameters or derive from a central fiscal calendar table based on CURRENT_DATE()."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_categories"",
          ""hardcoded_values"": [
            ""'Total Revenue'"",
            ""'Total Expenses'"",
            ""'News Media Publishing'"",
            ""'Circulation'"",
            ""'Subscription'"",
            ""'Content Licensing'""
          ],
          ""context"": ""Specific business categories for OS levels and publication codes are hardcoded in WHERE clauses."",
          ""suggested_governance"": ""Store these categories in a dimension or lookup table and join to it, or use a configuration table for dynamic filtering."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""period_control_flags"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""Period control flags ('CP' for Current Period, 'PY' for Prior Year) are hardcoded in the calendar join."",
          ""suggested_governance"": ""These flags are likely managed in the `v_asl_DIM_period_control` table. Ensure this table is properly governed and its values are consistent."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal years (e.g., 'FY2025') with a dashboard parameter or a dynamic calculation based on the current date and fiscal calendar logic."",
      ""Replace hardcoded fiscal weeks (e.g., 40) with a dashboard parameter or a dynamic calculation."",
      ""Replace hardcoded business category values (e.g., 'Total Revenue', 'News Media Publishing') with multi-select dashboard parameters that pull options from their respective dimension tables, or use joins to governed reference tables.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""dim_fy_week_of_year"",
      ""metric_name"": ""Fiscal Week of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year, derived from the calendar dimension."",
      ""sql_logic"": ""calendar.fy_week_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""IN (40)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for time-based slicing and filtering of financial data."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""40""
      ],
      ""governance_issues"": [
        ""Hardcoded week number should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_is_print_digital_flag"",
      ""metric_name"": ""Print/Digital Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Indicates if the financial amount relates to print or digital activities."",
      ""sql_logic"": ""os.is_print_digital_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to differentiate revenue/expense streams by media type."",
      ""metric_category"": ""segmentation"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_l12_publication_code"",
      ""metric_name"": ""L12 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific publication code at level 12 in the publication hierarchy."",
      ""sql_logic"": ""pub.l12_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for granular reporting by publication."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_os_level_5"",
      ""metric_name"": ""OS Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Organizational Structure Level 5, a hierarchical dimension for financial reporting."",
      ""sql_logic"": ""os.os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for hierarchical financial analysis."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_os_level_9"",
      ""metric_name"": ""OS Level 9"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Organizational Structure Level 9, a hierarchical dimension for financial reporting."",
      ""sql_logic"": ""os.os_level_9"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for hierarchical financial analysis."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The human-readable name of the publication, derived from the publication code."",
      ""sql_logic"": ""pub.publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a user-friendly name for publications in reports."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_gl_hierarchy_code"",
      ""metric_name"": ""GL Hierarchy Code / Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger Hierarchy Code, used here to filter by Fiscal Year (e.g., 'FY2025')."",
      ""sql_logic"": ""os.gl_hierarchy_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""= 'FY2025'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for filtering financial data by fiscal year."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""yearly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded fiscal year should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_os_level_4"",
      ""metric_name"": ""OS Level 4 (Revenue/Expense Category)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Organizational Structure Level 4, used to categorize financial entries as 'Total Revenue' or 'Total Expenses'."",
      ""sql_logic"": ""os.os_level_4"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""IN ('Total Revenue', 'Total Expenses')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Fundamental for distinguishing between revenue and expense line items."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Total Revenue'"",
        ""'Total Expenses'""
      ],
      ""governance_issues"": [
        ""Hardcoded business categories should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_l03_publication_code"",
      ""metric_name"": ""L03 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A specific publication code at level 3 in the hierarchy, e.g., 'News Media Publishing'."",
      ""sql_logic"": ""pub.l03_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [
        ""= 'News Media Publishing'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting at a broader publication group level."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'News Media Publishing'""
      ],
      ""governance_issues"": [
        ""Hardcoded business categories should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_os_level_6"",
      ""metric_name"": ""OS Level 6 (Revenue Type)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Organizational Structure Level 6, used to categorize revenue types like 'Circulation', 'Subscription', 'Content Licensing'."",
      ""sql_logic"": ""os.os_level_6"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for detailed revenue stream analysis."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""Hardcoded business categories should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_os_level_7"",
      ""metric_name"": ""OS Level 7"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Organizational Structure Level 7, a hierarchical dimension for financial reporting."",
      ""sql_logic"": ""os.os_level_7"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for hierarchical financial analysis."",
      ""metric_category"": ""hierarchy"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dim_fy_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year number, derived from the calendar dimension."",
      ""sql_logic"": ""calendar.fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""fy_week_of_year IN (40)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for yearly financial reporting and trend analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""yearly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual financial amount recorded for a given period and dimension combination."",
      ""sql_logic"": ""SUM(os.Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing'"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core metric for financial performance tracking and reconciliation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'"",
        ""'News Media Publishing'"",
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""Filters use hardcoded values; should be parameterized or use lookup tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in source data.""
      ]
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The budgeted financial amount for a given period and dimension combination."",
      ""sql_logic"": ""SUM(os.Budget_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing'"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for comparing actual performance against planned financial targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'"",
        ""'News Media Publishing'"",
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""Filters use hardcoded values; should be parameterized or use lookup tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in source data.""
      ]
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The forecasted financial amount for a given period and dimension combination."",
      ""sql_logic"": ""SUM(os.Forecast_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing'"",
        ""os_level_6 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for comparing actual performance against short-term financial predictions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'"",
        ""'News Media Publishing'"",
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""Filters use hardcoded values; should be parameterized or use lookup tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls in source data.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""budget_amount"",
        ""forecast_amount""
      ],
      ""relationship_description"": ""Actual Amount is compared against Budget Amount and Forecast Amount to determine variances."",
      ""mathematical_formula"": ""Actual vs. Budget Variance = actual_amount - budget_amount; Actual vs. Forecast Variance = actual_amount - forecast_amount"",
      ""business_validation"": ""These variances are critical for financial performance analysis, identifying deviations from plan and forecast."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Budget_Amount AS NUMERIC)) AS actual_vs_budget_variance, SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) - SUM(SAFE_CAST(Forecast_Amount AS NUMERIC)) AS actual_vs_forecast_variance FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE SAFE_CAST(gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(fiscal_week_id AS INT64) = 40 LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""dim_gl_hierarchy_code"",
        ""dim_fy_week_of_year"",
        ""dim_os_level_4"",
        ""dim_l03_publication_code"",
        ""dim_os_level_6""
      ],
      ""relationship_description"": ""All financial metrics (Actual, Budget, Forecast) are heavily filtered by specific fiscal year, week, OS levels, and publication codes."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""The dashboard focuses on a very specific slice of financial data, likely for month-end reconciliation for a particular period and business segment."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number WHERE SAFE_CAST(os.gl_hierarchy_code AS STRING) = 'FY2025' AND SAFE_CAST(calendar.fy_week_of_year AS INT64) = 40 AND SAFE_CAST(os.os_level_4 AS STRING) IN ('Total Revenue', 'Total Expenses') AND SAFE_CAST(os.l03_publication_code AS STRING) = 'News Media Publishing' AND SAFE_CAST(os.os_level_6 AS STRING) IN ('Circulation', 'Subscription', 'Content Licensing') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,23
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c560ed20-040d-4c6a-9c3f-ec8bce27d132"",
    ""dashboard_name"": ""Xtend Details"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 13,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""calendar_year"",
      ""calendar_month"",
      ""publication_name"",
      ""advertiser_name"",
      ""source_publishing_division"",
      ""revenue_transaction_status"",
      ""revenue_group_subtype"",
      ""gross_revenue_amount""
    ],
    ""date_range_detected"": ""Financial Year '202', Calendar Years 2022 (excluded), 2024, 2025. Implies data from at least 2022 to 2025."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""financial_year: '202'"",
      ""calendar_year: '2022', '2024', '2025'"",
      ""revenue_group_subtype: 'Digital', 'Print'"",
      ""advertiser_name: 'INTERNAL PUIG Oceania', 'PUIG Oceania', 'Greyhound Racing Victoria'"",
      ""source_publishing_division: 'Medium Rare Content Agency'"",
      ""revenue_transaction_status: 'Billed', 'Booked'""
    ],
    ""governance_opportunities"": [
      ""Financial year '202' should be clarified or parameterized."",
      ""Calendar year filters should use relative dates or parameters for flexibility."",
      ""Advertiser names should be parameterized or linked to a client dimension table."",
      ""Categorical values (revenue_group_subtype, revenue_transaction_status, source_publishing_division) should be managed via governed reference tables.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates key dimensions and the primary revenue metric from the dashboard's underlying queries.\n-- It applies common filters and aggregates data to provide a unified view.\nWITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.publication_name,\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.advertiser_name,\n    t0.calendar_month,\n    t0.calendar_year,\n    t0.revenue_group_subtype,\n    t0.advertiser_group,\n    t0.booking_number,\n    t0.gross_revenue_amount,\n    t0.revenue_type,\n    t0.source_unified_publication_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.source_publishing_division != 'Medium Rare Content Agency'\n    AND t0.revenue_transaction_status IN ('Billed', 'Booked')\n    AND SAFE_CAST(t0.calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3 -- Filter for recent years to ensure data presence\n    AND t0.financial_year IS NOT NULL\n)\nSELECT\n  financial_year,\n  SAFE_CAST(calendar_year AS STRING) AS calendar_year,\n  SAFE_CAST(calendar_month AS STRING) AS calendar_month,\n  publication_name,\n  advertiser_name,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division,\n  advertiser_group,\n  revenue_type,\n  source_unified_publication_name,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  COUNT(DISTINCT booking_number) AS distinct_bookings,\n  COUNT(*) AS record_count\nFROM base_data\nGROUP BY\n  financial_year,\n  calendar_year,\n  calendar_month,\n  publication_name,\n  advertiser_name,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division,\n  advertiser_group,\n  revenue_type,\n  source_unified_publication_name\nORDER BY\n  financial_year DESC, calendar_year DESC, calendar_month DESC\nLIMIT 100;"",
    ""structure_sql"": ""-- This query helps understand the data structure, unique values, and date ranges within the primary data source.\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(calendar_year AS STRING)) as unique_calendar_years,\n  COUNT(DISTINCT SAFE_CAST(calendar_month AS STRING)) as unique_calendar_months,\n  COUNT(DISTINCT publication_name) as unique_publication_names,\n  COUNT(DISTINCT advertiser_name) as unique_advertiser_names,\n  COUNT(DISTINCT revenue_group_subtype) as unique_revenue_subtypes,\n  COUNT(DISTINCT revenue_transaction_status) as unique_transaction_statuses,\n  COUNT(DISTINCT source_publishing_division) as unique_publishing_divisions,\n  MIN(SAFE_CAST(calendar_year AS STRING)) as earliest_calendar_year,\n  MAX(SAFE_CAST(calendar_year AS STRING)) as latest_calendar_year,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_amount_count\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3 -- Sample recent data\nLIMIT 1;"",
    ""validation_sql"": ""-- This query performs quick validation checks for data presence, freshness, and common filter values.\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_count_test,\n  CASE WHEN MAX(SAFE_CAST(calendar_year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as freshness_test_calendar_year,\n  CASE WHEN COUNT(CASE WHEN revenue_transaction_status IN ('Billed', 'Booked') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Check recent data\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This query validates the key business rules and filters identified from the dashboard's SQL queries.\nSELECT\n  'Business Rule Validation' as validation_type,\n  'source_publishing_division_exclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3 -- Sample recent data\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'revenue_transaction_status_inclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3 -- Sample recent data\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'revenue_group_subtype_inclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_group_subtype IN ('Digital', 'Print') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_group_subtype IN ('Digital', 'Print') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3; -- Sample recent data"",
    ""sample_data_sql"": ""-- This query retrieves a representative sample of raw data for further analysis.\nSELECT\n  SAFE_CAST(financial_year AS STRING) AS financial_year,\n  SAFE_CAST(calendar_year AS STRING) AS calendar_year,\n  SAFE_CAST(calendar_month AS STRING) AS calendar_month,\n  publication_name,\n  advertiser_name,\n  booking_number,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  revenue_type,\n  source_publishing_division,\n  source_unified_publication_name\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(calendar_year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Sample recent data\n  AND gross_revenue_amount IS NOT NULL\nORDER BY SAFE_CAST(calendar_year AS STRING) DESC, SAFE_CAST(calendar_month AS STRING) DESC, SAFE_CAST(gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'202'""
          ],
          ""context"": ""financial_year filter in Query 1"",
          ""suggested_governance"": ""Clarify meaning of '202' (e.g., specific financial period code) and manage via a configuration table or parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'2022'"",
            ""'2024'"",
            ""'2025'""
          ],
          ""context"": ""calendar_year filters in Query 2 and 3"",
          ""suggested_governance"": ""Replace with relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`) or dashboard parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Digital'"",
            ""'Print'""
          ],
          ""context"": ""revenue_group_subtype filter in Query 2 and 3"",
          ""suggested_governance"": ""Manage allowed revenue group subtypes in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'INTERNAL PUIG Oceania'"",
            ""'PUIG Oceania'"",
            ""'Greyhound Racing Victoria'""
          ],
          ""context"": ""advertiser_name filter in Query 2 and 3"",
          ""suggested_governance"": ""Manage specific advertiser lists via a configuration table or dashboard parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""source_publishing_division exclusion in all queries"",
          ""suggested_governance"": ""Manage excluded publishing divisions in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Billed'"",
            ""'Booked'""
          ],
          ""context"": ""revenue_transaction_status filter in all queries"",
          ""suggested_governance"": ""Manage allowed transaction statuses in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded year values (e.g., '2022', '2024', '2025') with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values for dimensions like `revenue_group_subtype`, `revenue_transaction_status`, `source_publishing_division` with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables for specific business rules like included/excluded `advertiser_name` or `financial_year` codes instead of hardcoded logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the publication associated with the advertising revenue."",
      ""sql_logic"": ""t0.publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""financial_year IN ('202')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by the originating publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'202'""
      ],
      ""governance_issues"": [
        ""Hardcoded financial year '202' should be parameterized or clarified.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year of the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""financial_year IN ('202')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'202'""
      ],
      ""governance_issues"": [
        ""Hardcoded financial year '202' should be parameterized or clarified.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Status of the revenue transaction (e.g., Billed, Booked)."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter for active or confirmed revenue transactions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""Hardcoded transaction statuses should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""source_publishing_division != 'Medium Rare Content Agency'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to exclude specific divisions from analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""Hardcoded division exclusion should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the advertiser."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""advertiser_name IN ('INTERNAL PUIG Oceania', 'PUIG Oceania')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter and group revenue by specific advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INTERNAL PUIG Oceania'"",
        ""'PUIG Oceania'"",
        ""'Greyhound Racing Victoria'""
      ],
      ""governance_issues"": [
        ""Hardcoded advertiser names should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_month"",
      ""metric_name"": ""Calendar Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""safe_cast"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar month of the transaction, often cast to a numeric type for sorting or calculations."",
      ""sql_logic"": ""SAFE_CAST(t0.calendar_month AS FLOAT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year NOT IN ('2022') OR calendar_year IS NULL"",
        ""calendar_year IN ('2024', '2025')""
      ],
      ""expected_data_type"": ""float"",
      ""business_context"": ""Used for time-series analysis and grouping by month."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2022'"",
        ""'2024'"",
        ""'2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded calendar years should be parameterized or use relative date functions.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_year"",
      ""metric_name"": ""Calendar Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar year of the transaction."",
      ""sql_logic"": ""t0.calendar_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""calendar_year NOT IN ('2022') OR calendar_year IS NULL"",
        ""calendar_year IN ('2024', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for calendar-based reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'2022'"",
        ""'2024'"",
        ""'2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded calendar years should be parameterized or use relative date functions.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Subtype of revenue group (e.g., Digital, Print)."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype IN ('Digital', 'Print')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue by its type (e.g., digital vs. print)."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital'"",
        ""'Print'""
      ],
      ""governance_issues"": [
        ""Hardcoded revenue group subtypes should be managed via a reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount for advertising transactions."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Primary financial metric for advertising sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital'"",
        ""'Print'"",
        ""'2024'"",
        ""'2025'"",
        ""'Greyhound Racing Victoria'""
      ],
      ""governance_issues"": [
        ""Hardcoded values in filters should be parameterized or use reference tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls if `gross_revenue_amount` is not always populated.""
      ]
    },
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group to which the advertiser belongs."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for higher-level grouping of advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_number"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for the advertising booking."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to identify individual transactions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific type of revenue (e.g., Ad Sales, Subscription)."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides further categorization of revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_unified_publication_name"",
      ""metric_name"": ""Source Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unified name of the source publication, potentially a standardized version of publication_name."",
      ""sql_logic"": ""t0.source_unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a consistent name for publications across different sources."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""financial_year"",
        ""calendar_year"",
        ""calendar_month"",
        ""publication_name"",
        ""advertiser_name"",
        ""revenue_group_subtype"",
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""advertiser_group"",
        ""booking_number"",
        ""revenue_type"",
        ""source_unified_publication_name""
      ],
      ""relationship_description"": ""All listed dimensions act as filters or grouping keys for the 'Gross Revenue Amount' metric. Specific hardcoded values in these dimensions' filters directly impact the calculated revenue."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [dimension_filter_conditions]"",
      ""business_validation"": ""Ensuring that the filters applied to these dimensions align with the desired business scope for revenue reporting (e.g., only billed/booked revenue, specific years, specific advertisers)."",
      ""validation_sql"": ""See `business_rules_sql` for validation of key filter conditions."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,24
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""1a5f7b4e-ea3a-46e4-8b77-b428f4178510"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""Sales_Group"",
      ""advertiser_parent"",
      ""revenue_type"",
      ""fin_adtype_name"",
      ""sales_segment_gm_name_sync"",
      ""GSD""
    ],
    ""date_range_detected"": ""Last, Current, Next Financial Year (relative to current date)"",
    ""hardcoded_dates_found"": [
      ""2025-01-02""
    ],
    ""hardcoded_values_found"": [
      ""'Client'"",
      ""'DOUBLECLICK'"",
      ""'XTEND'"",
      ""'MRCA'"",
      ""'Ian Paterson'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'$'"",
      ""'$\\'000'"",
      ""-1"",
      ""0"",
      ""1"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""'CONSORTIUM NSW'"",
      ""'KEY ACCOUNTS NSW RETAIL'"",
      ""'DIRECT NSW'"",
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'PRESTIGE'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""business rules (e.g., 'XTEND', 'MRCA', 'Ian Paterson', transaction statuses, style names, publishing divisions, publication names, account numbers) should be managed via configuration tables or governed lookups"",
      ""unit conversion ('/1000') should be handled consistently or via a parameter""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN\nWITH SFCE_USER AS (\n    SELECT\n      TEMP1.network_user_name AS login_name,\n      TEMP1.user_name AS full_name\n    FROM\n      (\n        SELECT\n          UPPER(network_user_name) AS network_user_name,\n          UPPER(user_name) AS user_name,\n          ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n        FROM\n          `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n        WHERE\n          dw_source_system_code = 'SFCE'\n      ) AS TEMP1\n    WHERE\n      TEMP1.RN = 1\n  ),\n  CTE2 AS (\n    SELECT\n      unified_publication_name,\n      unified_publication_gl_code,\n      fy_year_month_number,\n      financial_year,\n      financial_quarter,\n      financial_month,\n      financial_short_month,\n      financial_week,\n      revenue_transaction_status,\n      is_print_digital_flag,\n      current_financial_month,\n      current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE()) AS DOW_Today,\n      sales_segment_l_1_name,\n      sales_segment_l_2_name,\n      sales_segment_l_1_name_sync,\n      sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      advertiser_group,\n      advertiser_parent,\n      SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n      sales_segment_gm_name,\n      CASE\n        WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW',\n          'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n        ELSE sales_segment_gm_name_sync\n      END AS sales_segment_gm_name_sync,\n      revenue_group_level_1_name,\n      revenue_group_level_2_name,\n      SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n      SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n      SUM(IFNULL(pipeline, 0)) AS pipeline,\n      SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n      UPPER(revenue_type) AS revenue_type,\n      UPPER(revenue_group_subtype) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      portfolio_group_name_sync,\n      portfolio_group_name_current,\n      portfolio_parent_group_name_sync,\n      nca_industry_pillar,\n      publishing_division_group,\n      publishing_division_parent,\n      is_future_period_flag,\n      ly_is_future_period_flag,\n      ny_is_future_period_flag,\n      cost_model_type,\n      CASE\n        WHEN source_system_code = 'PLUTO' THEN NULL\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      portfolio_conformed_name_sync,\n      publishing_division,\n      booking_line_created_week,\n      booking_line_created_month,\n      booking_line_created_short_month,\n      booking_line_created_quarter,\n      booking_line_created_year,\n      agency_parent,\n      agency_group,\n      agency_name,\n      agency_number,\n      calendar_month_name,\n      calendar_year,\n      classification_name,\n      SUM(IFNULL(target, 0)) AS target,\n      IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD,\n      account_number,\n      publication_name\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN\n      ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n    WHERE\n      relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED',\n        'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division,\n          'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n      (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n    GROUP BY ALL\n  ),\n  final_data AS (\n    SELECT\n      *,\n      MIN(\n        CASE\n          WHEN advertiser_parent = \""DOUBLECLICK\"" THEN SAFE_CAST(booking_line_created_date AS DATE)\n        END) OVER (PARTITION BY financial_year) AS fix_date_lod_calculated,\n      CASE WHEN fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE revenue_type END AS Ad_Type_Grouping\n    FROM CTE2\n  )\nSELECT\n  financial_year,\n  Sales_Group,\n  advertiser_parent,\n  Ad_Type_Grouping,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  GSD,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  SUM(SAFE_CAST(adjustment_amount AS NUMERIC)) AS total_adjustment_amount,\n  SUM(SAFE_CAST(pub_lgb AS NUMERIC)) AS total_pub_lgb,\n  SUM(SAFE_CAST(ss_lgb AS NUMERIC)) AS total_ss_lgb,\n  SUM(SAFE_CAST(pipeline AS NUMERIC)) AS total_pipeline,\n  SUM(SAFE_CAST(target AS NUMERIC)) AS total_target,\n  SUM(CASE WHEN relative_fy_year_offset = -1 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS ly_gross_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS cy_gross_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod_calculated ELSE SAFE_CAST(booking_line_created_date AS DATE) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-02 01:26:03.721975+00', 'UTC') AS DATETIME), INTERVAL -365 DAY)) THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS ly_gross_revenue_conditional_date,\n  MAX(CASE WHEN relative_fy_year_offset = -1 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS ly_gross_revenue_max\nFROM final_data\nWHERE SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) -- Filter for last 2 years of data for performance\nGROUP BY\n  financial_year,\n  Sales_Group,\n  advertiser_parent,\n  Ad_Type_Grouping,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  GSD\nORDER BY financial_year DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(relative_fy_year_offset AS STRING)) as unique_fy_offsets,\n  COUNT(DISTINCT SAFE_CAST(advertiser_parent AS STRING)) as unique_advertiser_parents,\n  COUNT(DISTINCT SAFE_CAST(revenue_type AS STRING)) as unique_revenue_types,\n  COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) as unique_sales_segments,\n  MIN(SAFE_CAST(booking_line_created_date AS DATE)) as earliest_booking_date,\n  MAX(SAFE_CAST(booking_line_created_date AS DATE)) as latest_booking_date,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_count,\n  SUM(CASE WHEN revenue_transaction_status IS NULL THEN 1 ELSE 0 END) as null_revenue_status_count,\n  APPROX_COUNT_DISTINCT(unified_publication_name) as approx_unique_publications\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY) \nLIMIT 1000;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) >= 2 THEN 'PASS' ELSE 'FAIL' END as multi_year_data_test,\n  CASE WHEN SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test,\n  CASE WHEN MAX(SAFE_CAST(booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'relative_fy_year_offset_distribution' as rule_name,\n  SAFE_CAST(relative_fy_year_offset AS STRING) as relative_fy_year_offset_value,\n  COUNT(*) as records_count,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) as total_gross_revenue\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 730 DAY)\nGROUP BY\n  relative_fy_year_offset_value\nORDER BY\n  relative_fy_year_offset_value;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(financial_year AS INT64) as financial_year,\n  SAFE_CAST(financial_month AS STRING) as financial_month,\n  SAFE_CAST(booking_line_created_date AS DATE) as booking_line_created_date,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  SAFE_CAST(advertiser_parent AS STRING) as advertiser_parent,\n  SAFE_CAST(revenue_type AS STRING) as revenue_type,\n  SAFE_CAST(fin_adtype_name AS STRING) as fin_adtype_name,\n  SAFE_CAST(sales_segment_l_2_name_sync AS STRING) as sales_segment_l_2_name_sync,\n  SAFE_CAST(revenue_transaction_status AS STRING) as revenue_transaction_status,\n  SAFE_CAST(style_name AS STRING) as style_name,\n  SAFE_CAST(source_system_code AS STRING) as source_system_code,\n  SAFE_CAST(current_portfolio_group_owner_sync AS STRING) as current_portfolio_group_owner_sync,\n  SAFE_CAST(account_number AS STRING) as account_number,\n  SAFE_CAST(publication_name AS STRING) as publication_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  SAFE_CAST(booking_line_created_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  SAFE_CAST(booking_line_created_date AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-01-02"",
          ""original_format"": ""DATE(TIMESTAMP '2025-01-02 01:26:03.721975+00', 'UTC')"",
          ""context"": ""used as a reference date in a conditional gross revenue calculation (LY_Gross_Revenue_Conditional_Date)"",
          ""suggested_fix"": ""replace with CURRENT_DATE() or a dashboard parameter for dynamic date analysis"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Client'"",
            ""'DOUBLECLICK'"",
            ""'XTEND'"",
            ""'MRCA'"",
            ""'Ian Paterson'"",
            ""'BILLED'"",
            ""'BOOKED'"",
            ""'ROP COMPOSITE'"",
            ""'MEDIUM RARE CONTENT AGENCY'"",
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'"",
            ""-1"",
            ""0"",
            ""1"",
            ""'DIGITAL'"",
            ""'Digital Other'"",
            ""'CONSORTIUM NSW'"",
            ""'KEY ACCOUNTS NSW RETAIL'"",
            ""'DIRECT NSW'"",
            ""'INDEPENDENT AGENCIES NSW'"",
            ""'PRESTIGE'""
          ],
          ""context"": ""various filters and CASE statements for sales groups, advertiser types, revenue statuses, style names, publishing divisions, and financial year offsets."",
          ""suggested_governance"": ""externalize these values into governed lookup tables or configuration tables to allow for easier updates and consistent application across dashboards."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL N DAY)`)."",
      ""Replace hardcoded lookup values (e.g., 'XTEND', 'MRCA', 'BILLED') with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables for complex business rules (e.g., sales segment mappings to 'Ian Paterson', publication name exclusions) instead of hardcoded logic within queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount before any specific year or conditional filtering, as aggregated in the base CTE."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue"",
      ""metric_name"": ""Last Year Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Gross revenue for the previous financial year (relative_fy_year_offset = -1). This metric appears in both raw and thousands formats in the dashboard."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for year-over-year revenue comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_gross_revenue"",
      ""metric_name"": ""Current Year Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Gross revenue for the current financial year (relative_fy_year_offset = 0). This metric appears in both raw and thousands formats in the dashboard."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary indicator of current sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue_conditional_date"",
      ""metric_name"": ""Last Year Gross Revenue (Conditional Date)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base"",
        ""fix_date_lod""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, filtered by a complex date condition involving 'DOUBLECLICK' advertiser_parent, specific revenue types/subtypes/sales segments, and a hardcoded reference date."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE SAFE_CAST(booking_line_created_date AS DATE) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-02 01:26:03.721975+00', 'UTC') AS DATETIME), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters"",
        ""relative_fy_year_offset = -1"",
        ""Complex date condition""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific revenue calculation likely used for a particular segment or historical comparison with a fixed reference point."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-01-02""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue_max"",
      ""metric_name"": ""Max Last Year Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Maximum single gross revenue amount recorded for the previous financial year (relative_fy_year_offset = -1)."",
      ""sql_logic"": ""MAX(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to identify peak revenue transactions in the previous year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_gross_revenue_thousands"",
      ""metric_name"": ""Last Year Gross Revenue (Thousands)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""ly_gross_revenue""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, expressed in thousands. Derived from `ly_gross_revenue`."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Alternative display unit for `ly_gross_revenue` for readability in dashboards."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cy_gross_revenue_thousands"",
      ""metric_name"": ""Current Year Gross Revenue (Thousands)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""cy_gross_revenue""
      ],
      ""business_description"": ""Gross revenue for the current financial year, expressed in thousands. Derived from `cy_gross_revenue`."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Alternative display unit for `cy_gross_revenue` for readability in dashboards."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ad_type_grouping"",
      ""metric_name"": ""Ad Type Grouping"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of ad types, prioritizing 'XTEND' if `fin_adtype_name` is 'XTEND', otherwise using `revenue_type`."",
      ""sql_logic"": ""CASE WHEN fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting revenue by custom ad type categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_group"",
      ""metric_name"": ""Sales Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of sales segments into 'MRCA' or 'Client' based on `sales_segment_l_2_name_sync`."",
      ""sql_logic"": ""CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary grouping for sales performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'MRCA'"",
        ""'Client'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_gm_name_sync_adjusted"",
      ""metric_name"": ""Sales Segment GM Name Sync (Adjusted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Adjusted Sales Segment GM Name, mapping specific NSW sales segments to 'Ian Paterson', otherwise using the original `sales_segment_gm_name_sync`."",
      ""sql_logic"": ""CASE WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson' ELSE sales_segment_gm_name_sync END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting sales performance by adjusted General Manager names."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CONSORTIUM NSW'"",
        ""'KEY ACCOUNTS NSW RETAIL'"",
        ""'DIRECT NSW'"",
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'PRESTIGE'"",
        ""'Ian Paterson'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fix_date_lod"",
      ""metric_name"": ""Fix Date LOD"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""min"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""financial_year"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Minimum booking line created date for 'DOUBLECLICK' advertiser_parent, calculated as an analytic function partitioned by financial year. Used in `ly_gross_revenue_conditional_date`."",
      ""sql_logic"": ""MIN(CASE WHEN advertiser_parent = \""DOUBLECLICK\"" THEN CAST(booking_line_created_date AS DATE) END) OVER (PARTITION BY financial_year)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""An intermediate calculation for specific date-based revenue filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjustment_amount"",
      ""metric_name"": ""Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of adjustment amounts, directly from the base data source."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents financial adjustments to revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""pub_lgb"",
      ""metric_name"": ""Pub LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of 'pub_lgb' values, directly from the base data source. Likely a specific revenue or booking metric."",
      ""sql_logic"": ""SUM(IFNULL(pub_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific internal metric related to publication-level bookings."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ss_lgb"",
      ""metric_name"": ""SS LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of 'ss_lgb' values, directly from the base data source. Likely a specific revenue or booking metric."",
      ""sql_logic"": ""SUM(IFNULL(ss_lgb, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific internal metric related to sales segment-level bookings."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""pipeline"",
      ""metric_name"": ""Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of pipeline values, representing potential future revenue."",
      ""sql_logic"": ""SUM(IFNULL(pipeline, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Forecast of future sales, crucial for business planning."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""target"",
      ""metric_name"": ""Target"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of target values, representing sales goals."",
      ""sql_logic"": ""SUM(IFNULL(target, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Benchmark for sales performance, used to measure achievement against goals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gsd"",
      ""metric_name"": ""GSD"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""lookup"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The full name of the Group Sales Director (GSD) associated with the portfolio group owner, derived from joining with the SFCE_USER dimension table. Defaults to 'VACANT' if no match."",
      ""sql_logic"": ""IFNULL(GSD_JOIN.full_name, 'VACANT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly"",
        ""ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for attributing sales performance to specific GSDs."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_parent"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent company or group of the advertiser."",
      ""sql_logic"": ""advertiser_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""All base CTE filters""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing revenue by top-level advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""ly_gross_revenue_thousands"",
      ""related_metrics"": [
        ""ly_gross_revenue""
      ],
      ""relationship_description"": ""Last Year Gross Revenue (Thousands) is derived by dividing Last Year Gross Revenue by 1000."",
      ""mathematical_formula"": ""ly_gross_revenue_thousands = ly_gross_revenue / 1000"",
      ""business_validation"": ""Ensures consistency in reporting units across different dashboard components."",
      ""validation_sql"": ""SELECT SUM(ly_gross_revenue_thousands * 1000) = SUM(ly_gross_revenue) FROM ( /* primary_analysis_sql CTEs */ )"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""cy_gross_revenue_thousands"",
      ""related_metrics"": [
        ""cy_gross_revenue""
      ],
      ""relationship_description"": ""Current Year Gross Revenue (Thousands) is derived by dividing Current Year Gross Revenue by 1000."",
      ""mathematical_formula"": ""cy_gross_revenue_thousands = cy_gross_revenue / 1000"",
      ""business_validation"": ""Ensures consistency in reporting units across different dashboard components."",
      ""validation_sql"": ""SELECT SUM(cy_gross_revenue_thousands * 1000) = SUM(cy_gross_revenue) FROM ( /* primary_analysis_sql CTEs */ )"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""ly_gross_revenue_conditional_date"",
      ""related_metrics"": [
        ""ly_gross_revenue"",
        ""fix_date_lod""
      ],
      ""relationship_description"": ""LY Gross Revenue (Conditional Date) is a subset of LY Gross Revenue, further filtered by specific conditions related to advertiser_parent, revenue types, sales segments, and a hardcoded date reference. It depends on the `fix_date_lod` calculation."",
      ""mathematical_formula"": ""ly_gross_revenue_conditional_date <= ly_gross_revenue"",
      ""business_validation"": ""This metric provides a more granular view of LY revenue for specific business cases, highlighting the impact of the complex date and segment filters."",
      ""validation_sql"": ""SELECT SUM(ly_gross_revenue_conditional_date) <= SUM(ly_gross_revenue) FROM ( /* primary_analysis_sql CTEs */ )"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""sales_group"",
      ""related_metrics"": [
        ""ly_gross_revenue"",
        ""cy_gross_revenue"",
        ""pipeline"",
        ""target""
      ],
      ""relationship_description"": ""Sales Group ('MRCA' or 'Client') is a primary dimension by which all revenue and sales-related metrics are aggregated and analyzed."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows for performance comparison between different sales segments."",
      ""validation_sql"": ""SELECT Sales_Group, SUM(ly_gross_revenue), SUM(cy_gross_revenue) FROM ( /* primary_analysis_sql CTEs */ ) GROUP BY Sales_Group"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""advertiser_parent"",
      ""related_metrics"": [
        ""ly_gross_revenue"",
        ""cy_gross_revenue""
      ],
      ""relationship_description"": ""Advertiser Parent is another key dimension used for aggregating and analyzing gross revenue metrics."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Enables analysis of revenue contribution by major advertiser groups."",
      ""validation_sql"": ""SELECT advertiser_parent, SUM(ly_gross_revenue), SUM(cy_gross_revenue) FROM ( /* primary_analysis_sql CTEs */ ) GROUP BY advertiser_parent"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,25
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""155c4518-72bf-4309-a0e9-240dd564f421"",
    ""dashboard_name"": ""Portfolio Performance Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""GSD"",
      ""advertiser_group"",
      ""portfolio_conformed_name_sync"",
      ""product_group"",
      ""revenue_type"",
      ""fin_adtype_name"",
      ""sales_segment_gm_name_sync"",
      ""relative_fy_year_offset"",
      ""relative_fy_quarter_offset"",
      ""relative_fy_month_offset"",
      ""financial_month"",
      ""financial_quarter"",
      ""financial_date""
    ],
    ""date_range_detected"": ""Relative to current fiscal year (using offsets)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'DESIREE DURRANT'"",
      ""'CHRIS JEFFS'"",
      ""'PRINT'"",
      ""'XTEND'"",
      ""'The Australian & Prestige'"",
      ""'State & Communities'"",
      ""'Free News & Lifestyle'"",
      ""'Client'"",
      ""'Commercial Content'"",
      ""'Group Functions'"",
      ""'Others'"",
      ""'Unknown'"",
      ""0.01"",
      ""1""
    ],
    ""governance_opportunities"": [
      ""GSD names should be managed in a reference table"",
      ""Product group names should be managed in a reference table"",
      ""Revenue type and ad type names should be managed in a reference table"",
      ""Thresholds (0.01 for portfolio flag, 1 for customer status) should be configurable parameters or governed values"",
      ""Looker Studio parameters (@reporting_mth, @customer_retention_type) should be clearly documented and potentially managed centrally""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  params AS (\n    SELECT\n      0 AS reporting_mth, -- Default to 0 for relative month logic\n      '0' AS customer_retention_type_param -- Default to '0' for detailed customer status\n  ),\n  CTE AS (\n    SELECT\n      t.*,\n      CASE\n        WHEN (SELECT reporting_mth FROM params) = 0 THEN\n          CASE\n            WHEN relative_fy_month_offset = 0 OR relative_fy_month_offset = -12 THEN CAST(financial_month AS INT)\n          END\n        ELSE (SELECT reporting_mth FROM params)\n      END AS filter_reporting_month,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ly_lgr,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance AS t\n    WHERE\n      -- Apply a reasonable date filter for performance and cost optimization\n      SAFE_CAST(t.financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n  ),\n  CalculatedFields AS (\n    SELECT\n      *,\n      MAX(\n        CASE\n          WHEN filter_reporting_month = CAST(financial_month AS INT) THEN financial_quarter\n          WHEN (SELECT reporting_mth FROM params) = 0 THEN IF(relative_fy_quarter_offset = 0, financial_quarter, null)\n          ELSE NULL\n        END) OVER (PARTITION BY filter_reporting_month) AS report_quarter,\n      CASE\n        WHEN (SELECT customer_retention_type_param FROM params) = '1' THEN 'All'\n        ELSE\n        CASE\n          WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS'\n          WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED'\n          WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE'\n          WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED'\n          ELSE 'Other'\n        END\n      END AS customer_status_full,\n      -- Always divide by 1000 based on original query logic ('$\\'000' = '$' is always false)\n      SAFE_DIVIDE(gross_revenue_amount, 1000) AS gross_revenue_amount_k,\n      SAFE_DIVIDE(target, 1000) AS target_k,\n      -- blank_portfolio_flag calculation\n      CASE\n        WHEN SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) OVER (PARTITION BY portfolio_conformed_name_sync) > 0.01\n          OR SUM(SAFE_DIVIDE(gross_revenue_amount, 1000)) OVER (PARTITION BY portfolio_conformed_name_sync) < -0.01\n          OR SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) != 0 THEN 'include'\n        ELSE 'exclude'\n      END AS blank_portfolio_flag,\n      -- Derived revenue_type_adjusted for consistency\n      CASE WHEN fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE revenue_type END AS revenue_type_adjusted\n    FROM\n      CTE\n  )\nSELECT\n  GSD,\n  product_group,\n  customer_status_full,\n  SUM(CASE WHEN relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0 THEN gross_revenue_amount_k ELSE NULL END) AS current_year_q1_revenue_k,\n  SUM(CASE WHEN relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4 THEN gross_revenue_amount_k ELSE NULL END) AS previous_year_q4_revenue_k,\n  SUM(CASE WHEN relative_fy_quarter_offset = 0 THEN target_k ELSE NULL END) AS current_year_target_k,\n  COUNT(CASE WHEN product_group IS NOT NULL THEN 1 ELSE NULL END) AS product_group_record_count,\n  SUM(CASE WHEN product_group = 'The Australian & Prestige' THEN 1\n           WHEN product_group = 'State & Communities' THEN 2\n           WHEN product_group = 'Free News & Lifestyle' THEN 3\n           WHEN product_group = 'Client' THEN 4\n           WHEN product_group = 'Commercial Content' THEN 5\n           WHEN product_group = 'Group Functions' THEN 6\n           WHEN product_group = 'Others' THEN 7\n           WHEN product_group = 'Unknown' THEN 8 ELSE 9 END) AS product_group_mapped_sum\nFROM\n  CalculatedFields\nWHERE\n  blank_portfolio_flag = 'include'\n  AND GSD IN ('DESIREE DURRANT', 'CHRIS JEFFS')\n  AND (revenue_type_adjusted NOT IN ('PRINT') OR revenue_type_adjusted IS NULL)\nGROUP BY\n  GSD,\n  product_group,\n  customer_status_full\nORDER BY\n  GSD, product_group\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_date AS DATE)) as unique_financial_dates,\n  COUNT(DISTINCT advertiser_group) as unique_advertiser_groups,\n  COUNT(DISTINCT portfolio_conformed_name_sync) as unique_portfolios,\n  COUNT(DISTINCT GSD) as unique_gsds,\n  MIN(SAFE_CAST(financial_date AS DATE)) as earliest_financial_date,\n  MAX(SAFE_CAST(financial_date AS DATE)) as latest_financial_date,\n  APPROX_COUNT_DISTINCT(advertiser_group || '-' || SAFE_CAST(financial_date AS STRING)) as approx_unique_daily_advertiser_records,\n  SUM(CASE WHEN gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_amount_count,\n  SUM(CASE WHEN target IS NULL THEN 1 ELSE 0 END) AS null_target_count\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(target AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as target_test,\n  CASE WHEN COUNT(DISTINCT GSD) > 1 THEN 'PASS' ELSE 'FAIL' END as gsd_diversity_test,\n  CASE WHEN MAX(SAFE_CAST(financial_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  params AS (\n    SELECT\n      0 AS reporting_mth,\n      '0' AS customer_retention_type_param\n  ),\n  CTE AS (\n    SELECT\n      t.*,\n      CASE\n        WHEN (SELECT reporting_mth FROM params) = 0 THEN\n          CASE\n            WHEN relative_fy_month_offset = 0 OR relative_fy_month_offset = -12 THEN CAST(financial_month AS INT)\n          END\n        ELSE (SELECT reporting_mth FROM params)\n      END AS filter_reporting_month,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ly_lgr,\n      SUM(\n        CASE\n          WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount\n          ELSE 0\n        END) OVER (PARTITION BY advertiser_group) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance AS t\n    WHERE\n      SAFE_CAST(t.financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\n  ),\n  CalculatedFields AS (\n    SELECT\n      *,\n      CASE\n        WHEN (SELECT customer_retention_type_param FROM params) = '1' THEN 'All'\n        ELSE\n        CASE\n          WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS'\n          WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED'\n          WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE'\n          WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED'\n          ELSE 'Other'\n        END\n      END AS customer_status_full\n    FROM\n      CTE\n  )\nSELECT\n  'Business Rule Validation' as validation_type,\n  'customer_status_logic' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN customer_status_full = 'NEW BUSINESS' AND fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END) as new_business_matches,\n  SUM(CASE WHEN customer_status_full = 'RETAINED' AND fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END) as retained_matches,\n  SUM(CASE WHEN customer_status_full = 'INACTIVE' AND fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END) as inactive_matches,\n  SUM(CASE WHEN customer_status_full = 'LAPSED' AND fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END) as lapsed_matches,\n  SUM(CASE WHEN customer_status_full = 'Other' AND NOT (\n    (fix_ly_lgr <= 1 AND fix_ty_lgr > 1) OR\n    (fix_ly_lgr > 1 AND fix_ty_lgr > 1) OR\n    (fix_ly_lgr > 1 AND fix_ty_lgr <= 1) OR\n    (fix_ly_lgr <= 1 AND fix_ty_lgr <= 1)\n  ) THEN 1 ELSE 0 END) as other_matches,\n  SUM(CASE WHEN customer_status_full = 'All' AND (SELECT customer_retention_type_param FROM params) = '1' THEN 1 ELSE 0 END) as all_status_matches\nFROM\n  CalculatedFields\nWHERE\n  -- Filter to a reasonable subset for validation\n  SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_date AS DATE) as financial_date,\n  GSD,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  product_group,\n  revenue_type,\n  fin_adtype_name,\n  gross_revenue_amount,\n  target,\n  relative_fy_year_offset,\n  relative_fy_quarter_offset,\n  relative_fy_month_offset,\n  financial_month,\n  financial_quarter,\n  sales_segment_gm_name_sync\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nORDER BY\n  SAFE_CAST(financial_date AS DATE) DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0.01""
          ],
          ""context"": ""Threshold for blank_portfolio_flag to include/exclude portfolios with negligible revenue/target."",
          ""suggested_governance"": ""Define as a configurable parameter or in a business rules table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""1""
          ],
          ""context"": ""Threshold for gross revenue amount (fix_ly_lgr, fix_ty_lgr) to classify customer status (NEW BUSINESS, RETAINED, INACTIVE, LAPSED)."",
          ""suggested_governance"": ""Define as a configurable parameter or in a business rules table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DESIREE DURRANT'"",
            ""'CHRIS JEFFS'""
          ],
          ""context"": ""Specific General Sales Director (GSD) names used as filters."",
          ""suggested_governance"": ""Join to a `gsd_master` or `employee_dim` table, or use a parameter for selection."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PRINT'"",
            ""'XTEND'""
          ],
          ""context"": ""Specific revenue type and ad type names used in conditional logic and filters."",
          ""suggested_governance"": ""Join to `revenue_type_dim` or `ad_type_dim` tables."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Australian & Prestige'"",
            ""'State & Communities'"",
            ""'Free News & Lifestyle'"",
            ""'Client'"",
            ""'Commercial Content'"",
            ""'Group Functions'"",
            ""'Others'"",
            ""'Unknown'""
          ],
          ""context"": ""Product group names hardcoded in a CASE statement for mapping to integer values."",
          ""suggested_governance"": ""Create a `product_group_dim` table with a mapping column."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded GSD names with a multi-select parameter or a join to a GSD dimension table."",
      ""Replace hardcoded product group names, revenue types, and ad types with joins to governed reference tables."",
      ""Externalize business thresholds (e.g., 0.01 for portfolio flag, 1 for customer status) into configuration tables or dashboard parameters."",
      ""Document and standardize the usage of Looker Studio parameters like `@reporting_mth` and `@customer_retention_type`.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for an ad sale."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Fundamental building block for all revenue-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy of source data""
      ]
    },
    {
      ""metric_id"": ""target_base"",
      ""metric_name"": ""Target (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw target amount for an ad sale."",
      ""sql_logic"": ""t0.target"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Fundamental building block for all target-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy of source data""
      ]
    },
    {
      ""metric_id"": ""current_year_q1_revenue_k"",
      ""metric_name"": ""Current Year Q1 Revenue (K)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Gross revenue for the current fiscal year's first quarter, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_quarter_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_year_q4_revenue_k"",
      ""metric_name"": ""Previous Year Q4 Revenue (K)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Gross revenue for the previous fiscal year's fourth quarter, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""relative_fy_quarter_offset = -4""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons and understanding prior period performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""-4"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_year_target_k"",
      ""metric_name"": ""Current Year Target (K)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""target_base""
      ],
      ""business_description"": ""Target amount for the current fiscal year, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(target, 1000) ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_quarter_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for target attainment."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1000""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_lgr"",
      ""metric_name"": ""Last Year's Gross Revenue (Advertiser Group)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser_group"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Sum of gross revenue for the previous fiscal year, partitioned by advertiser group. Used for customer status classification."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate metric for customer retention analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""this_year_lgr"",
      ""metric_name"": ""This Year's Gross Revenue (Advertiser Group)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser_group"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""Sum of gross revenue for the current fiscal year, partitioned by advertiser group. Used for customer status classification."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate metric for customer retention analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""customer_status_full"",
      ""metric_name"": ""Customer Status Full"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""advertiser_group"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""last_year_lgr"",
        ""this_year_lgr""
      ],
      ""business_description"": ""Categorizes customers into 'NEW BUSINESS', 'RETAINED', 'INACTIVE', 'LAPSED', or 'Other' based on their gross revenue performance over the last two fiscal years. Can be 'All' if a specific parameter is set."",
      ""sql_logic"": ""CASE WHEN @customer_retention_type = '1' THEN 'All' ELSE CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS' WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED' WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE' WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED' ELSE 'Other' END END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for understanding customer lifecycle and retention strategies."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""'NEW BUSINESS'"",
        ""'RETAINED'"",
        ""'INACTIVE'"",
        ""'LAPSED'"",
        ""'Other'"",
        ""'All'""
      ],
      ""governance_issues"": [
        ""`@customer_retention_type` parameter should be governed"",
        ""threshold '1' could be configurable""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""blank_portfolio_flag"",
      ""metric_name"": ""Blank Portfolio Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""portfolio_conformed_name_sync"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base"",
        ""target_base""
      ],
      ""business_description"": ""Flags portfolios as 'include' or 'exclude' based on whether their summed gross revenue (in thousands) or target (current FY) is significant (abs value > 0.01)."",
      ""sql_logic"": ""CASE WHEN SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) > 0.01 OR SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) < -0.01 OR SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) != 0 THEN 'include' ELSE 'exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter out portfolios with negligible activity, improving dashboard relevance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0.01"",
        ""1000"",
        ""0""
      ],
      ""governance_issues"": [
        ""threshold '0.01' could be configurable""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group_record_count"",
      ""metric_name"": ""Product Group Record Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product_group"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Count of records associated with each product group."",
      ""sql_logic"": ""COUNT(CASE WHEN product_group IS NOT NULL THEN 1 ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""GSD IN ('CHRIS JEFFS')"",
        ""revenue_type_adjusted NOT IN ('PRINT')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a volume metric per product group."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian & Prestige'"",
        ""'State & Communities'"",
        ""'Free News & Lifestyle'"",
        ""'Client'"",
        ""'Commercial Content'"",
        ""'Group Functions'"",
        ""'Others'"",
        ""'Unknown'"",
        ""'PRINT'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""product group names should be governed"",
        ""revenue type names should be governed""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group_mapped_sum"",
      ""metric_name"": ""Product Group Mapped Sum"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product_group"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of integer values assigned to product groups. Its business utility is unclear unless integers represent a score or order."",
      ""sql_logic"": ""SUM(CASE WHEN product_group = 'The Australian & Prestige' THEN 1 WHEN product_group = 'State & Communities' THEN 2 WHEN product_group = 'Free News & Lifestyle' THEN 3 WHEN product_group = 'Client' THEN 4 WHEN product_group = 'Commercial Content' THEN 5 WHEN product_group = 'Group Functions' THEN 6 WHEN product_group = 'Others' THEN 7 WHEN product_group = 'Unknown' THEN 8 ELSE 9 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""GSD IN ('CHRIS JEFFS')"",
        ""revenue_type_adjusted NOT IN ('PRINT')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely an internal Looker Studio artifact or a poorly defined metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian & Prestige'"",
        ""'State & Communities'"",
        ""'Free News & Lifestyle'"",
        ""'Client'"",
        ""'Commercial Content'"",
        ""'Group Functions'"",
        ""'Others'"",
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""product group names should be governed""
      ],
      ""data_quality_concerns"": [
        ""business utility unclear""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""customer_status_full"",
      ""related_metrics"": [
        ""last_year_lgr"",
        ""this_year_lgr""
      ],
      ""relationship_description"": ""Customer Status Full is derived directly from Last Year's Gross Revenue (LGR) and This Year's Gross Revenue (LGR) for each advertiser group, based on predefined thresholds."",
      ""mathematical_formula"": ""IF (@customer_retention_type = '1', 'All', CASE WHEN LY_LGR <= 1 AND TY_LGR > 1 THEN 'NEW BUSINESS' ... END)"",
      ""business_validation"": ""This relationship is critical for segmenting customers based on their revenue performance over time, enabling targeted retention and acquisition strategies."",
      ""validation_sql"": ""See `dataset_analysis.business_rules_sql` for validation of this logic."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""blank_portfolio_flag"",
      ""related_metrics"": [
        ""gross_revenue_amount_base"",
        ""target_base""
      ],
      ""relationship_description"": ""The Blank Portfolio Flag is calculated based on the summed gross revenue and target for a portfolio. It is then used as a filter to 'include' or 'exclude' portfolios from the dashboard, effectively removing those with negligible activity."",
      ""mathematical_formula"": ""IF (SUM(gross_revenue_amount / 1000) > 0.01 OR SUM(gross_revenue_amount / 1000) < -0.01 OR SUM(IF(relative_fy_year_offset = 0, target, null)) != 0, 'include', 'exclude')"",
      ""business_validation"": ""Ensures that the dashboard focuses on relevant portfolios, improving data signal-to-noise ratio for analysis."",
      ""validation_sql"": ""SELECT blank_portfolio_flag, COUNT(*) FROM (/* primary_analysis_sql CTEs up to CalculatedFields */) GROUP BY blank_portfolio_flag;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_year_q1_revenue_k"",
      ""related_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""relationship_description"": ""Current Year Q1 Revenue (K) is a filtered sum of the base gross revenue amount, divided by 1000, specifically for the current fiscal year's first quarter."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount_base / 1000) WHERE relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0"",
      ""business_validation"": ""Provides a standardized view of revenue in thousands for a specific period, facilitating comparisons."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""previous_year_q4_revenue_k"",
      ""related_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""relationship_description"": ""Previous Year Q4 Revenue (K) is a filtered sum of the base gross revenue amount, divided by 1000, specifically for the previous fiscal year's fourth quarter."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount_base / 1000) WHERE relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4"",
      ""business_validation"": ""Enables direct comparison of revenue performance against the prior year's closing quarter."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4 THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END) FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_year_target_k"",
      ""related_metrics"": [
        ""target_base""
      ],
      ""relationship_description"": ""Current Year Target (K) is a filtered sum of the base target amount, divided by 1000, specifically for the current fiscal year's first quarter."",
      ""mathematical_formula"": ""SUM(target_base / 1000) WHERE relative_fy_quarter_offset = 0"",
      ""business_validation"": ""Provides a standardized view of target in thousands for the current period, facilitating attainment analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_quarter_offset = 0 THEN SAFE_DIVIDE(target, 1000) ELSE NULL END) FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance WHERE SAFE_CAST(financial_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,26
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6e8b534b-485a-48dd-842d-13dc6bebb01a"",
    ""dashboard_name"": ""SuperCoach Subscriptions"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement"",
    ""business_domain"": ""consumer"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_datetime"",
      ""masthead"",
      ""subscription_movement_count_type"",
      ""subscriber_id_src"",
      ""subscription_id_src"",
      ""sold_in_rate_plan_code"",
      ""sold_in_source_code""
    ],
    ""date_range_detected"": ""2024-07-01 to 2024-08-19"",
    ""hardcoded_dates_found"": [
      ""2024-07-01"",
      ""2024-08-19""
    ],
    ""hardcoded_values_found"": [
      ""'SC'"",
      ""'acquisition'"",
      ""'SC_SDO_AP24AM12'"",
      ""'SC_SDO_AP20AM12'"",
      ""2452260"",
      ""'CS'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""masthead and movement types should use reference tables"",
      ""rate plan codes should use reference tables"",
      ""subscriber ID should be a parameter/filter"",
      ""source masthead codes should use reference tables""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_acquisitions AS (\n  SELECT\n    SAFE_CAST(DATETIME_TRUNC(movement_datetime, SECOND) AS DATE) AS acquisition_date,\n    subscription_id_src,\n    subscriber_id_src,\n    masthead,\n    subscription_movement_count_type,\n    sold_in_rate_plan_code,\n    SUBSTR(sold_in_source_code, 1, 2) AS source_masthead_code\n  FROM\n    `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\n  WHERE\n    masthead = 'SC'\n    AND subscription_movement_count_type = 'acquisition'\n    AND movement_datetime >= DATE '2024-07-01'\n    AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\n),\ngrouped_metrics AS (\n  SELECT\n    acquisition_date,\n    source_masthead_code,\n    COUNT(DISTINCT subscription_id_src) AS unique_acquisitions_by_source_daily,\n    COUNT(DISTINCT subscriber_id_src) AS unique_subscribers_by_source_daily\n  FROM\n    base_acquisitions\n  GROUP BY\n    acquisition_date,\n    source_masthead_code\n)\nSELECT\n  'Overall' AS aggregation_level,\n  NULL AS acquisition_date,\n  NULL AS source_masthead_code,\n  COUNT(DISTINCT t1.subscription_id_src) AS total_unique_acquisitions_overall,\n  COUNT(DISTINCT t1.subscriber_id_src) AS total_unique_subscribers_overall,\n  NULL AS unique_acquisitions_by_source_daily,\n  NULL AS unique_subscribers_by_source_daily\nFROM\n  base_acquisitions AS t1\nUNION ALL\nSELECT\n  'Daily by Source' AS aggregation_level,\n  acquisition_date,\n  source_masthead_code,\n  NULL AS total_unique_acquisitions_overall,\n  NULL AS total_unique_subscribers_overall,\n  unique_acquisitions_by_source_daily,\n  unique_subscribers_by_source_daily\nFROM\n  grouped_metrics\nORDER BY\n  aggregation_level DESC, acquisition_date DESC, unique_acquisitions_by_source_daily DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(movement_datetime AS DATE)) as unique_movement_dates,\n  COUNT(DISTINCT subscriber_id_src) as unique_subscribers,\n  COUNT(DISTINCT subscription_id_src) as unique_subscriptions,\n  COUNT(DISTINCT masthead) as unique_mastheads,\n  COUNT(DISTINCT subscription_movement_count_type) as unique_movement_types,\n  COUNT(DISTINCT sold_in_rate_plan_code) as unique_rate_plans,\n  MIN(SAFE_CAST(movement_datetime AS DATE)) as earliest_movement_date,\n  MAX(SAFE_CAST(movement_datetime AS DATE)) as latest_movement_date\nFROM \n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN COUNT(DISTINCT subscription_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as acquisitions_exist_test,\n  CASE WHEN MAX(SAFE_CAST(movement_datetime AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(DISTINCT subscriber_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as subscribers_exist_test,\n  CASE WHEN COUNT(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as sc_acquisition_data_test\nFROM \n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'SuperCoach Acquisition Data' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage,\n  COUNT(DISTINCT subscription_id_src) as distinct_subscriptions_in_scope\nFROM \n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  SAFE_CAST(movement_datetime AS DATE) >= DATE '2024-07-01' AND SAFE_CAST(movement_datetime AS DATE) < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(movement_datetime AS DATE) as movement_date,\n  subscriber_id_src,\n  subscription_id_src,\n  masthead,\n  subscription_movement_count_type,\n  sold_in_rate_plan_code,\n  sold_in_source_code,\n  is_paying_flag\nFROM \n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  SAFE_CAST(movement_datetime AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND masthead = 'SC'\nORDER BY\n  movement_datetime DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024-07-01"",
          ""original_format"": ""DATE '2024-07-01'"",
          ""context"": ""start date for movement_datetime filter"",
          ""suggested_fix"": ""replace with dashboard date parameter or relative date function (e.g., DATE_SUB(CURRENT_DATE(), INTERVAL X DAY))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-08-19"",
          ""original_format"": ""DATE '2024-08-19'"",
          ""context"": ""end date for movement_datetime filter (used with DATETIME_ADD)"",
          ""suggested_fix"": ""replace with dashboard date parameter or relative date function (e.g., CURRENT_DATE())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'SC'""
          ],
          ""context"": ""masthead filter for 'SuperCoach'"",
          ""suggested_governance"": ""replace with a parameter or join to a masthead lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'acquisition'""
          ],
          ""context"": ""subscription_movement_count_type filter"",
          ""suggested_governance"": ""replace with a parameter or join to a movement type lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SC_SDO_AP24AM12'"",
            ""'SC_SDO_AP20AM12'""
          ],
          ""context"": ""sold_in_rate_plan_code filter"",
          ""suggested_governance"": ""replace with a parameter or join to a rate plan lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""2452260""
          ],
          ""context"": ""specific subscriber_id_src filter"",
          ""suggested_governance"": ""replace with a dashboard filter control or parameter for subscriber ID"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CS'""
          ],
          ""context"": ""SUBSTR(sold_in_source_code, 1, 2) filter"",
          ""suggested_governance"": ""replace with a parameter or join to a source code lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., CURRENT_DATE(), DATE_SUB)"",
      ""Replace hardcoded lookup values (masthead, movement type, rate plan codes, source codes) with joins to governed reference tables or dashboard parameters"",
      ""Replace hardcoded subscriber IDs with dashboard filter controls or parameters to allow dynamic selection""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_unique_acquisitions"",
      ""metric_name"": ""Total Unique Subscriptions Acquired"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Counts the number of unique subscription IDs that represent an 'acquisition' movement for the 'SuperCoach' masthead within the specified date range. This is a key indicator of new customer growth."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""movement_datetime BETWEEN '2024-07-01' AND '2024-08-19'"",
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A core metric for understanding new customer growth for SuperCoach, often displayed as a headline number."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-01"",
        ""2024-08-19""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for duplicate subscription_id_src if not handled by underlying view"",
        ""data freshness dependent on v_subscription_movement updates""
      ]
    },
    {
      ""metric_id"": ""unique_acquisitions_by_source_masthead"",
      ""metric_name"": ""Unique Subscriptions Acquired by Source Masthead"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Counts unique subscription IDs for 'acquisition' movements for 'SuperCoach' masthead, grouped by the derived source masthead code (first 2 characters of sold_in_source_code). The original query included highly specific filters (rate plans, specific subscriber, specific source code 'CS') which are noted as hardcoded values."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src) GROUP BY SUBSTR(sold_in_source_code, 1, 2)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""movement_datetime BETWEEN '2024-07-01' AND '2024-08-19'"",
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'"",
        ""sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12')"",
        ""subscriber_id_src = 2452260"",
        ""SUBSTR(sold_in_source_code, 1, 2) IN ('CS')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides insight into acquisition performance from specific marketing channels or source codes for SuperCoach. The highly specific filters suggest this is used for a detailed, targeted analysis or drill-down."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-01"",
        ""2024-08-19""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'SC_SDO_AP24AM12'"",
        ""'SC_SDO_AP20AM12'"",
        ""'acquisition'"",
        ""2452260"",
        ""'CS'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table"",
        ""subscriber ID should be a parameter""
      ],
      ""data_quality_concerns"": [
        ""highly specific filters might lead to sparse data"",
        ""reliance on accurate sold_in_source_code and sold_in_rate_plan_code""
      ]
    },
    {
      ""metric_id"": ""unique_subscribers"",
      ""metric_name"": ""Unique Subscribers"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Lists all distinct subscriber IDs available in the v_subscription_movement table. Primarily used as a filter or selector in the dashboard to enable drill-down on specific subscribers."",
      ""sql_logic"": ""SELECT DISTINCT subscriber_id_src"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Enables drill-down or specific subscriber analysis within the dashboard, allowing users to focus on individual customer journeys or attributes."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for large number of distinct values impacting dashboard performance if not properly indexed or cached""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""unique_subscribers"",
      ""related_metrics"": [
        ""total_unique_acquisitions"",
        ""unique_acquisitions_by_source_masthead""
      ],
      ""relationship_description"": ""The 'Unique Subscribers' dimension acts as a filter for the acquisition metrics, allowing the dashboard user to narrow down the analysis to specific subscribers. The original query for 'unique_acquisitions_by_source_masthead' shows a hardcoded subscriber ID, indicating this filtering capability."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""Ensures that acquisition metrics can be analyzed for specific customer segments or individual customers, which is crucial for targeted marketing or customer service insights."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT subscription_id_src) FROM `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement` WHERE subscriber_id_src = 2452260 AND masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_unique_acquisitions"",
      ""related_metrics"": [
        ""unique_acquisitions_by_source_masthead""
      ],
      ""relationship_description"": ""The 'Unique Subscriptions Acquired by Source Masthead' metric represents a breakdown of the 'Total Unique Subscriptions Acquired' by a specific dimension (source masthead code) and with additional, more granular filters (rate plan, specific subscriber). It's a subset analysis."",
      ""mathematical_formula"": ""SUM(unique_acquisitions_by_source_masthead) <= total_unique_acquisitions (equality holds if all filters are removed from the breakdown metric)"",
      ""business_validation"": ""Allows for understanding the contribution of different acquisition channels/sources to the overall acquisition numbers. The specific filters in the original query suggest a deep dive into particular campaigns or customer segments."",
      ""validation_sql"": ""WITH all_acq AS (SELECT COUNT(DISTINCT subscription_id_src) AS total FROM `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement` WHERE masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)), specific_acq AS (SELECT COUNT(DISTINCT subscription_id_src) AS specific FROM `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement` WHERE masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY) AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) IN ('CS')) SELECT (SELECT total FROM all_acq) AS overall_acquisitions, (SELECT specific FROM specific_acq) AS specific_filtered_acquisitions;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,27
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""87651b69-c43e-471f-9c4b-98df1208a844"",
    ""dashboard_name"": ""Programmatic Sales Patches"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 9,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""Source"",
      ""TransactionType"",
      ""CalendarMonth_Truncated""
    ],
    ""date_range_detected"": ""Specific month: June 2025 (hardcoded)"",
    ""hardcoded_dates_found"": [
      ""2025-06-01""
    ],
    ""hardcoded_values_found"": [
      ""'Guaranteed'"",
      ""'Chemist Warehouse *'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE(), DATE_SUB)"",
      ""Advertiser names should be managed via a lookup table or parameter"",
      ""Transaction types should be managed via a lookup table or parameter""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.Source AS Source,\n    t0.Advertiser AS Advertiser,\n    SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS CalendarMonth_Truncated,\n    t0.PaidImpressions AS PaidImpressions,\n    t0.RevenueGross AS RevenueGross,\n    t0.TransactionType AS TransactionType\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\n  WHERE\n    SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 36 MONTH) -- Sample recent 3 years of monthly data\n)\nSELECT\n  CalendarMonth_Truncated,\n  Advertiser,\n  Source,\n  TransactionType,\n  SUM(SAFE_CAST(PaidImpressions AS NUMERIC)) AS total_paid_impressions,\n  SUM(SAFE_CAST(RevenueGross AS NUMERIC)) AS total_gross_revenue\nFROM base_data\nWHERE\n  TransactionType = 'Guaranteed'\n  AND Advertiser = 'Chemist Warehouse *'\n  AND CalendarMonth_Truncated = DATE '2025-06-01' -- Specific hardcoded filter from original query\nGROUP BY\n  CalendarMonth_Truncated,\n  Advertiser,\n  Source,\n  TransactionType\nORDER BY\n  CalendarMonth_Truncated DESC, Advertiser, Source, TransactionType\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.Advertiser) as unique_advertisers,\n  COUNT(DISTINCT t0.Source) as unique_sources,\n  COUNT(DISTINCT t0.TransactionType) as unique_transaction_types,\n  MIN(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE)) as earliest_calendar_date,\n  MAX(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE)) as latest_calendar_date,\n  SUM(CASE WHEN t0.PaidImpressions IS NULL THEN 1 ELSE 0 END) as null_paid_impressions_count,\n  SUM(CASE WHEN t0.RevenueGross IS NULL THEN 1 ELSE 0 END) as null_revenue_gross_count\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 36 MONTH) -- Sample recent 3 years\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.RevenueGross AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN SUM(SAFE_CAST(t0.PaidImpressions AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as impressions_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertisers_exist_test,\n  CASE WHEN COUNT(DISTINCT t0.TransactionType) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_types_exist_test,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_exists_for_filters_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE\n  t0.TransactionType = 'Guaranteed'\n  AND t0.Advertiser = 'Chemist Warehouse *'\n  AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'TransactionType Distribution' as rule_name,\n  t0.TransactionType,\n  COUNT(*) as records_count,\n  SUM(SAFE_CAST(t0.RevenueGross AS NUMERIC)) as total_revenue_for_type\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 36 MONTH) -- Sample recent 3 years\nGROUP BY t0.TransactionType\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Advertiser Distribution' as rule_name,\n  t0.Advertiser,\n  COUNT(*) as records_count,\n  SUM(SAFE_CAST(t0.RevenueGross AS NUMERIC)) as total_revenue_for_advertiser\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 36 MONTH) -- Sample recent 3 years\nGROUP BY t0.Advertiser\nORDER BY records_count DESC\nLIMIT 10;"",
    ""sample_data_sql"": ""SELECT\n  t0.Source,\n  t0.Advertiser,\n  t0.CalendarMonth,\n  t0.CalendarYear,\n  t0.PaidImpressions,\n  t0.RevenueGross,\n  t0.TransactionType,\n  SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS CalendarMonth_Truncated\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH) -- Sample last 12 months\nORDER BY SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-01"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""Filter for CalendarMonth_Truncated in the main programmatic sales query."",
          ""suggested_fix"": ""replace with a date parameter (e.g., `_DS_START_DATE`) or relative date (e.g., `DATE_TRUNC(CURRENT_DATE(), MONTH)`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Guaranteed'""
          ],
          ""context"": ""Filter for TransactionType in the main programmatic sales query."",
          ""suggested_governance"": ""use a parameter or join to a transaction_type_lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Chemist Warehouse *'""
          ],
          ""context"": ""Filter for Advertiser in the main programmatic sales query."",
          ""suggested_governance"": ""use a parameter or join to an advertiser_master table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `_DS_START_DATE`, `_DS_END_DATE` in Looker Studio)"",
      ""Replace hardcoded lookup values (Advertiser, TransactionType) with parameters or joins to governed reference tables""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""source_dimension"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The origin or source of the programmatic sales data."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment sales data by its origin."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_dimension"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic sales."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""Advertiser = 'Chemist Warehouse *'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing sales performance by client."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table or parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_month_truncated_dimension"",
      ""metric_name"": ""Calendar Month (Truncated)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the calendar month for which the data is reported, derived from CalendarMonth and CalendarYear."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""CalendarMonth_Truncated = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for monthly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""paid_impressions_sum"",
      ""metric_name"": ""Total Paid Impressions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of paid impressions delivered for programmatic sales."",
      ""sql_logic"": ""SUM(t0.PaidImpressions)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'"",
        ""Advertiser = 'Chemist Warehouse *'"",
        ""CalendarMonth_Truncated = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key volume metric for programmatic advertising campaigns."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table or parameter""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in source data""
      ]
    },
    {
      ""metric_id"": ""revenue_gross_sum"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue generated from programmatic sales."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'"",
        ""Advertiser = 'Chemist Warehouse *'"",
        ""CalendarMonth_Truncated = DATE '2025-06-01'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""The primary financial metric for programmatic advertising campaigns."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table or parameter""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in source data""
      ]
    },
    {
      ""metric_id"": ""transaction_type_dimension"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of transaction for the programmatic sale (e.g., Guaranteed, Non-Guaranteed)."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = 'Guaranteed'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment sales data by transaction model."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table or parameter""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""paid_impressions_sum"",
      ""related_metrics"": [
        ""revenue_gross_sum"",
        ""advertiser_dimension"",
        ""transaction_type_dimension"",
        ""calendar_month_truncated_dimension""
      ],
      ""relationship_description"": ""Paid Impressions and Gross Revenue are filtered by specific Advertiser, Transaction Type, and Calendar Month. This defines the scope of the reported metrics."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that the reported impressions and revenue pertain only to 'Guaranteed' transactions for 'Chemist Warehouse *' in June 2025."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""revenue_gross_sum"",
      ""related_metrics"": [
        ""paid_impressions_sum""
      ],
      ""relationship_description"": ""Gross Revenue and Paid Impressions are often used together to calculate efficiency metrics like eCPM (effective Cost Per Mille/Thousand Impressions)."",
      ""mathematical_formula"": ""eCPM = (RevenueGross_Sum / PaidImpressions_Sum) * 1000"",
      ""business_validation"": ""eCPM provides insight into the revenue generated per thousand impressions, indicating campaign efficiency."",
      ""validation_sql"": ""SELECT SAFE_DIVIDE(SUM(SAFE_CAST(RevenueGross AS NUMERIC)), SUM(SAFE_CAST(PaidImpressions AS NUMERIC))) * 1000 AS eCPM FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,28
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6a26c78f-0070-4fb3-88b8-691ee4a4485a"",
    ""dashboard_name"": ""Circ Budget Revenue Weekly Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 9,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_quarter"",
      ""publication_state_group"",
      ""standardized_publication_name"",
      ""channel_group"",
      ""day_of_week_group"",
      ""fiscal_month_of_year"",
      ""fiscal_week_of_year"",
      ""fiscal_year_week_number"",
      ""relative_fiscal_week_number"",
      ""relative_fiscal_year_number"",
      ""os_level_8"",
      ""os_level_10"",
      ""os_level_7""
    ],
    ""date_range_detected"": ""FY2025"",
    ""hardcoded_dates_found"": [
      ""2025-04-15"",
      ""2024-07-03""
    ],
    ""hardcoded_values_found"": [
      ""FY2025"",
      ""CIRCULATION"",
      ""Free News & Lifestyle"",
      ""Food"",
      ""Prestige"",
      ""DTI Free Copies"",
      ""Retail"",
      ""PNG"",
      ""The Daily Telegraph"",
      ""The Herald Sun"",
      ""The Advertiser"",
      ""Courier Mail"",
      ""Weekly Times"",
      ""GCB"",
      ""Cairns Post"",
      ""Sunshine Coast"",
      ""Northern Territory News"",
      ""Mercury"",
      ""Geelong Advertiser"",
      ""The Chronicle"",
      ""Daily Mercury"",
      ""The Australian"",
      ""The Sportsman"",
      ""6 Day Pubs"",
      ""Mercury and Sunday Tas"",
      ""NT News & Sunday Territorian"",
      ""Other"",
      ""YTD"",
      ""Mon"",
      ""Tue"",
      ""Wed"",
      ""Thu"",
      ""Fri"",
      ""Weekday Entry"",
      ""Sat"",
      ""Sun"",
      ""Airlines"",
      ""Hotels"",
      ""Other Alternate"",
      ""Other Alternate Channels"",
      ""Petrol and Convenience"",
      ""Agent & Dist"",
      ""Home Delivery"",
      ""Roadside Delivery"",
      ""Unspecified Print Sub"",
      ""Supermarkets"",
      ""Unspec Channel"",
      ""ALL SALES CHANNELS"",
      ""26"",
      ""40"",
      ""4"",
      ""6"",
      ""9"",
      ""10"",
      ""12"",
      ""13"",
      ""14"",
      ""15"",
      ""17"",
      ""22"",
      ""30"",
      ""35"",
      ""39"",
      ""43"",
      ""48"",
      ""52""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Fiscal year 'FY2025' should be a parameter"",
      ""Publication name and group mappings should be externalized into a dedicated dimension table (e.g., `dim_publication_mapping`) and joined, instead of hardcoded CASE statements."",
      ""Channel groupings should be externalized into a dimension table (e.g., `dim_channel_mapping`)."",
      ""Day of week groupings should be externalized or handled by standard date functions."",
      ""Magic numbers (e.g., 26, 40, 4, 6, 9 for week/month logic) should be defined as parameters or in a configuration table."",
      ""Looker Studio internal parameter placeholders like `('1' = '1')` should be reviewed and potentially replaced with actual parameter references if they represent dynamic selections.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT_Base AS (\n  SELECT\n    os.Actual_Amount,\n    os.Budget_Amount,\n    os.Budget_Volume,\n    os.Forecast_Amount,\n    os.Forecast_Volume,\n    os.Last_Year_Actual_Amount,\n    os.Last_Year_volume,\n    os.volume,\n    os.day_of_week,\n    calendar.fy_first_day_of_week,\n    calendar.fy_last_day_of_week,\n    calendar.fy_month_of_year,\n    calendar.fy_week_of_year,\n    calendar.fy_year_week_number,\n    os.os_level_10,\n    os.os_level_7,\n    os.gl_publication_code AS publication_code,\n    pub.publication_name,\n    os.relative_fisc_week_number,\n    calendar.relative_fisc_year_number,\n    calendar.fy_quarter_of_year,\n    os.os_level_8\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\n    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control ON control.source_week_number = calendar.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n  WHERE\n    upper(os.os_level_6) = 'CIRCULATION'\n    AND pub.l04_publication_code <> 'Free News & Lifestyle'\n    AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n    AND os.gl_hierarchy_code = 'FY2025'\n),\nDerived_Columns AS (\n  SELECT\n    Actual_Amount,\n    Budget_Amount,\n    Budget_Volume,\n    Forecast_Amount,\n    Forecast_Volume,\n    Last_Year_Actual_Amount,\n    Last_Year_volume,\n    volume,\n    day_of_week,\n    fy_first_day_of_week,\n    fy_last_day_of_week,\n    fy_month_of_year,\n    fy_week_of_year,\n    fy_year_week_number,\n    os_level_10,\n    os_level_7,\n    publication_code,\n    publication_name,\n    relative_fisc_week_number,\n    relative_fisc_year_number,\n    fy_quarter_of_year,\n    os_level_8,\n\n    -- Derived columns from Query 1\n    CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END AS publication_name_adjusted_q1,\n    CASE\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Daily Telegraph') THEN ' NSW'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times')) THEN '  VIC'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Advertiser') THEN '   SA'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast')) THEN '     QLD'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Northern Territory News') THEN '      NT'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Mercury') THEN '    TAS'\n      ELSE NULL\n    END AS publication_state_group_q1,\n    CASE\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Weekly Times')) THEN 'Weekly Times'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Toowoomba') THEN 'The Chronicle'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Townsville Bulletin') THEN 'Townsville Bulletin'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Gold Coast Bulletin') THEN 'GCB'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Geelong Advertiser') THEN 'Geelong Advertiser'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Cairns Post') THEN 'Cairns Post'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Sunshine Coast') THEN 'Sunshine Coast'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'Courier Mail'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Sunday Territorian', 'NT News')) THEN 'Northern Territory News'\n      WHEN (CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Mackay') THEN 'Daily Mercury'\n      ELSE NULL\n    END AS standardized_publication_name_q1,\n    CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END AS past_budget_volume_q1,\n\n    -- Derived columns from Query 2\n    (EXTRACT(DAYOFWEEK FROM SAFE_CAST(fy_first_day_of_week AS TIMESTAMP)) - 1) AS day_of_week_num_q2,\n    DATETIME_DIFF(SAFE_CAST(fy_first_day_of_week AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS weeks_diff_from_fixed_date_q2,\n    DATETIME_SUB(SAFE_CAST(fy_first_day_of_week AS DATETIME), INTERVAL -7 DAY) AS date_plus_7_days_q2,\n    DATETIME_SUB(SAFE_CAST(fy_first_day_of_week AS DATETIME), INTERVAL 7 DAY) AS date_minus_7_days_q2,\n    CASE WHEN (day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry')) THEN 'M-F' WHEN (day_of_week = 'Sat') THEN 'SAT' WHEN (day_of_week = 'Sun') THEN 'Sun' ELSE NULL END AS day_of_week_group_q2,\n    SAFE_CAST(fy_month_of_year AS STRING) AS fy_month_of_year_str_q2,\n    CASE WHEN (os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels')) THEN 'Alternative Channels' WHEN (os_level_10 IN ('Petrol and Convenience')) THEN 'Convenience Stores / Service Stations' WHEN (os_level_10 IN ('Agent & Dist')) THEN 'Newsagencies' WHEN (os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub')) THEN 'Subscriptions' WHEN (os_level_10 IN ('Supermarkets')) THEN 'Supermarkets' ELSE 'Unspec Channel' END AS channel_group_q2,\n    UPPER(SAFE_CAST(os_level_7 AS STRING)) AS os_level_7_upper_q2,\n    CASE WHEN (publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END AS publication_name_adjusted_q2,\n    CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Amount ELSE 0 END AS budget_amount_if_past_week_q2,\n    CASE WHEN (relative_fisc_year_number = 0) THEN Budget_Amount ELSE 0 END AS budget_amount_if_current_year_q2,\n    CASE WHEN (relative_fisc_week_number < 0) THEN volume ELSE 0 END AS volume_if_past_week_q2,\n    CASE WHEN (relative_fisc_year_number = 0) THEN volume ELSE 0 END AS volume_if_current_year_q2,\n    Forecast_Amount AS forecast_amount_lt_6_q2, -- Simplified\n    Forecast_Amount AS forecast_amount_lt_9_q2, -- Simplified\n    Forecast_Amount AS forecast_amount_lt_4_q2, -- Simplified\n    Forecast_Amount AS forecast_amount_lt_7_q2, -- Simplified\n    Forecast_Volume AS forecast_volume_lt_6_q2, -- Simplified\n    Forecast_Volume AS forecast_volume_lt_9_q2, -- Simplified\n    Forecast_Volume AS forecast_volume_lt_4_q2, -- Simplified\n    Forecast_Volume AS forecast_volume_lt_7_q2, -- Simplified\n    CASE\n      WHEN (publication_name_adjusted_q2 IN ('Sunday Herald Sun', 'Herald Sun')) THEN 'The Herald Sun'\n      WHEN (publication_name_adjusted_q2 IN ('The Advertiser', 'Sunday Mail')) THEN 'The Advertiser'\n      WHEN (publication_name_adjusted_q2 IN ('Courier Mail', 'The Sunday Mail')) THEN 'The Courier Mail'\n      WHEN (publication_name_adjusted_q2 = 'The Australian') THEN 'The Australian'\n      WHEN (publication_name_adjusted_q2 = 'The Sportsman') THEN 'The Sportsman'\n      WHEN (publication_name_adjusted_q2 IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (publication_name_adjusted_q2 = 'Weekly Times') THEN 'Weekly Times'\n      ELSE NULL\n    END AS standardized_publication_name_v2_q2,\n    CASE\n      WHEN (publication_name_adjusted_q2 IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser'\n      WHEN (publication_name_adjusted_q2 IN ('Weekly Times')) THEN 'Weekly Times'\n      WHEN (publication_name_adjusted_q2 IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun'\n      WHEN (publication_name_adjusted_q2 IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (publication_name_adjusted_q2 = 'Toowoomba') THEN 'The Chronicle'\n      WHEN (publication_name_adjusted_q2 = 'Townsville Bulletin') THEN 'Townsville Bulletin'\n      WHEN (publication_name_adjusted_q2 = 'Gold Coast Bulletin') THEN 'GCB'\n      WHEN (publication_name_adjusted_q2 = 'Geelong Advertiser') THEN 'Geelong Advertiser'\n      WHEN (publication_name_adjusted_q2 = 'Cairns Post') THEN 'Cairns Post'\n      WHEN (publication_name_adjusted_q2 = 'Sunshine Coast') THEN 'Sunshine Coast'\n      WHEN (publication_name_adjusted_q2 IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'Courier Mail'\n      WHEN (publication_name_adjusted_q2 IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury'\n      WHEN (publication_name_adjusted_q2 IN ('Sunday Territorian', 'NT News')) THEN 'Northern Territory News'\n      WHEN (publication_name_adjusted_q2 = 'Mackay') THEN 'Daily Mercury'\n      ELSE NULL\n    END AS publication_state_group_v2_q2,\n    CASE\n      WHEN (publication_name_adjusted_q2 IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin')) THEN '6 Day Pubs'\n      WHEN (publication_name_adjusted_q2 IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury and Sunday Tas'\n      WHEN (publication_name_adjusted_q2 IN ('NT News', 'Sunday Territorian')) THEN 'NT News & Sunday Territorian'\n      WHEN (publication_name_adjusted_q2 IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital')) THEN 'Other'\n      WHEN (publication_name_adjusted_q2 IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser'\n      WHEN (publication_name_adjusted_q2 IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'The Courier Mail'\n      WHEN (publication_name_adjusted_q2 IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (publication_name_adjusted_q2 IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun'\n      ELSE publication_name_adjusted_q2\n    END AS publication_group_q2,\n    'YTD' AS time_period_label_q2,\n    (weeks_diff_from_fixed_date_q2 - 1) AS adjusted_weeks_diff_q2,\n    (day_of_week_num_q2 <= 2) AS day_of_week_le_2_q2,\n    (weeks_diff_from_fixed_date_q2 = 26) AS weeks_diff_eq_26_q2,\n    (weeks_diff_from_fixed_date_q2 = 40) AS weeks_diff_eq_40_q2,\n    (weeks_diff_from_fixed_date_q2 = fy_week_of_year) AS weeks_diff_eq_fy_week_q2,\n    CASE WHEN (weeks_diff_from_fixed_date_q2 <= fy_year_week_number) THEN Actual_Amount ELSE 0 END AS actual_amount_ytd_conditional_q2,\n    weeks_diff_from_fixed_date_q2 AS adjusted_week_diff_final_q2, -- Simplified from (0=0) conditional\n    SAFE_CAST(fy_month_of_year AS STRING) AS fy_month_of_year_string_q2,\n    (standardized_publication_name_v2_q2 = 'The Courier Mail') AS is_courier_mail_q2,\n    (standardized_publication_name_v2_q2 = 'The Australian') AS is_australian_q2,\n    (weeks_diff_eq_26_q2 OR weeks_diff_eq_40_q2) AS weeks_26_or_40_flag_q2,\n    (is_australian_q2 OR is_courier_mail_q2) AS is_aus_or_cm_flag_q2,\n    ((2025*100)+adjusted_week_diff_final_q2) AS year_week_concat_q2,\n    SAFE_CAST(fy_month_of_year_string_q2 AS INT64) AS month_selection_int_q2, -- Simplified from (0=0) conditional\n    TRUE AS year_week_match_flag_q2, -- Simplified from (year_week_concat_q2 = year_week_concat_q2)\n    FALSE AS param_2_is_1_q2, -- Simplified from ('2' = '1')\n    TRUE AS param_2_is_2_q2, -- Simplified from ('2' = '2')\n    TRUE AS param_1_is_1_q2, -- Simplified from ('1' = '1')\n    FALSE AS param_1_is_2_q2, -- Simplified from ('1' = '2')\n    FALSE AS param_1_is_3_q2, -- Simplified from ('1' = '3')\n    FALSE AS param_2_is_3_q2, -- Simplified from ('2' = '3')\n    (budget_amount_if_past_week_q2 IS NOT NULL AND budget_amount_if_past_week_q2 != 0) AS budget_amount_past_week_exists_q2\n\n),\nFinal_Metrics AS (\n  SELECT\n    fy_quarter_of_year AS fiscal_quarter,\n    publication_state_group_q1 AS publication_state_group,\n    standardized_publication_name_q1 AS standardized_publication_name,\n    os_level_8,\n    channel_group_q2 AS channel_group,\n    publication_state_group_v2_q2 AS publication_state_group_v2,\n    time_period_label_q2 AS time_period_label,\n    publication_name_adjusted_q2 AS standardized_publication_name_v3_q2, -- Using publication_name_adjusted_q2 as it's the source for clmn51_\n\n    -- Query 1 Metrics\n    SUM(past_budget_volume_q1) AS budget_volume_past_weeks,\n    SUM(volume - past_budget_volume_q1) AS net_volume_actual_vs_budget_past_weeks,\n    SUM(volume) AS actual_volume,\n\n    -- Query 2 Metrics\n    SUM(Actual_Amount) AS actual_amount,\n    SUM(Budget_Volume) AS budget_volume_q2,\n    SUM(Last_Year_Actual_Amount) AS last_year_actual_amount,\n    SUM(Last_Year_volume) AS last_year_volume,\n    SUM(Forecast_Amount) AS forecast_amount,\n    SUM(Forecast_Volume) AS forecast_volume,\n\n    -- Complex YTD/Conditional Metrics from Query 2\n    SUM(CASE WHEN (param_2_is_2_q2) THEN actual_amount_ytd_conditional_q2 ELSE 0 END) AS ytd_actual_amount_conditional,\n    SUM(CASE WHEN (param_2_is_2_q2) THEN budget_amount_if_past_week_q2 ELSE 0 END) AS ytd_budget_amount_conditional,\n    SUM(CASE WHEN (param_1_is_1_q2) THEN Budget_Amount ELSE 0 END) AS selected_amount_metric, -- Simplified based on param_1_is_1_q2 being true\n    SUM(CASE WHEN (param_1_is_1_q2) THEN Budget_Volume ELSE 0 END) AS selected_volume_metric, -- Simplified based on param_1_is_1_q2 being true\n    SUM(CASE WHEN (os_level_7_upper_q2 = 'ALL SALES CHANNELS') THEN (CASE WHEN (param_1_is_1_q2) THEN (CASE WHEN (param_2_is_2_q2) THEN budget_amount_if_past_week_q2 ELSE 0 END) ELSE 0 END) ELSE 0 END) AS all_sales_channels_amount,\n    SUM(CASE\n      WHEN (weeks_26_or_40_flag_q2 AND is_aus_or_cm_flag_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, 4)*5 ELSE Budget_Volume END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, 2)*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (Budget_Volume*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      ELSE Budget_Volume\n    END) AS volume_daily_avg_adjusted_numerator,\n    SUM(CASE\n      WHEN (is_australian_q2 OR is_courier_mail_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5 ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*2))*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      WHEN (day_of_week_group_q2 = 'M-F') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5)\n      ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)\n    END) AS volume_daily_avg_adjusted_denominator,\n    SUM(CASE WHEN (publication_group_q2 = 'PNG') THEN 0 WHEN (publication_group_q2 = '6 Day Pubs') THEN SAFE_DIVIDE(CASE\n      WHEN (weeks_26_or_40_flag_q2 AND is_aus_or_cm_flag_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, 4)*5 ELSE Budget_Volume END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, 2)*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (Budget_Volume*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      ELSE Budget_Volume\n    END, 6) ELSE SAFE_DIVIDE(CASE\n      WHEN (weeks_26_or_40_flag_q2 AND is_aus_or_cm_flag_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, 4)*5 ELSE Budget_Volume END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, 2)*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (Budget_Volume*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      ELSE Budget_Volume\n    END, 7) END) AS final_volume_metric_1,\n    SUM(CASE WHEN (publication_group_q2 = '6 Day Pubs') THEN SAFE_DIVIDE(CASE\n      WHEN (is_australian_q2 OR is_courier_mail_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5 ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*2))*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      WHEN (day_of_week_group_q2 = 'M-F') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5)\n      ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)\n    END, 6) ELSE SAFE_DIVIDE(CASE\n      WHEN (is_australian_q2 OR is_courier_mail_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5 ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END)\n      WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*2))*5)\n      WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)*5)\n      WHEN (publication_group_q2 = 'PNG') THEN 0\n      WHEN (day_of_week_group_q2 = 'M-F') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5)\n      ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)\n    END, 7) END) AS final_volume_metric_2\n\n  FROM Derived_Columns\n  WHERE\n    os_level_8 != 'DTI Free Copies' AND standardized_publication_name_q1 IS NOT NULL -- Query 1 filters\n    AND channel_group_q2 = 'Retail' AND publication_name_adjusted_q2 IS NOT NULL -- Query 2 filters (clmn51_ is publication_name_adjusted_q2)\n  GROUP BY\n    fiscal_quarter,\n    publication_state_group,\n    standardized_publication_name,\n    os_level_8,\n    channel_group,\n    publication_state_group_v2_q2,\n    time_period_label,\n    publication_name_adjusted_q2\n  ORDER BY fiscal_quarter DESC\n  LIMIT 1000\n)\nSELECT *\nFROM Final_Metrics;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as unique_fiscal_week_start_dates,\n  COUNT(DISTINCT os.gl_publication_code) as unique_publication_codes,\n  COUNT(DISTINCT os.os_level_8) as unique_os_level_8s,\n  COUNT(DISTINCT os.os_level_10) as unique_os_level_10s,\n  MIN(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as earliest_fiscal_week_start_date,\n  MAX(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) as latest_fiscal_week_start_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(os.fiscal_week_id AS STRING), os.gl_publication_code, os.os_level_8, os.os_level_10, os.os_level_7)) as approx_unique_record_grain\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\n  AND SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(os.Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(SAFE_CAST(os.Budget_Volume AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_volume_test,\n  CASE WHEN COUNT(DISTINCT os.gl_publication_code) > 0 THEN 'PASS' ELSE 'FAIL' END as publication_code_test,\n  CASE WHEN MAX(SAFE_CAST(calendar.fy_first_day_of_week AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN os.gl_hierarchy_code = 'FY2025' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as fy2025_data_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\n  AND SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Circulation_Filter_Check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END) as records_passing_circulation_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN upper(os.os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END), COUNT(*)) * 100 as circulation_filter_pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\nWHERE\n  os.gl_hierarchy_code = 'FY2025'\n  AND SAFE_CAST(os.fiscal_week_id AS STRING) LIKE '2025%'\nLIMIT 100;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) as fiscal_week_start_date,\n  os.gl_publication_code as publication_code,\n  pub.publication_name as publication_name,\n  os.os_level_8 as os_level_8_dimension,\n  os.os_level_10 as os_level_10_dimension,\n  os.os_level_7 as os_level_7_dimension,\n  os.day_of_week as day_of_week,\n  os.relative_fisc_week_number as relative_fiscal_week_number,\n  os.Actual_Amount as actual_amount,\n  os.Budget_Amount as budget_amount,\n  os.volume as actual_volume,\n  os.Budget_Volume as budget_volume,\n  os.Forecast_Amount as forecast_amount,\n  os.Forecast_Volume as forecast_volume,\n  os.Last_Year_Actual_Amount as last_year_actual_amount,\n  os.Last_Year_volume as last_year_volume\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\n  AND SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nORDER BY SAFE_CAST(calendar.fy_first_day_of_week AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-04-15"",
          ""original_format"": ""2025-04-15 04:14:20.297382+00"",
          ""context"": ""Used as a fixed date for `clmn4_` and `clmn5_` in Query 2, which are then used in `DATETIME_DIFF` and `DATETIME_SUB` calculations. This date is likely the 'current' date at the time the Looker Studio report was configured."",
          ""suggested_fix"": ""Replace with `CURRENT_TIMESTAMP()` or a Looker Studio date parameter to ensure calculations are always relative to the current date."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date in `DATETIME_DIFF` calculation (`clmn25_`) in Query 2. This creates a fixed reference point for week numbering."",
          ""suggested_fix"": ""If this is meant to be the start of a fiscal year or a fixed reporting period, it should be parameterized or derived from a calendar dimension table. If it's meant to be dynamic, it should be relative to `CURRENT_DATE()`."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY2025'""
          ],
          ""context"": ""Fiscal year filter `gl_hierarchy_code = 'FY2025'` applied to all base queries."",
          ""suggested_governance"": ""Parameterize the fiscal year (e.g., `_fiscal_year_param`) or derive from a period control table to allow dynamic reporting across fiscal years."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CIRCULATION'"",
            ""'Free News & Lifestyle'"",
            ""'Food'"",
            ""'Prestige'"",
            ""'DTI Free Copies'""
          ],
          ""context"": ""Filters on `os_level_6`, `l04_publication_code`, `l06_publication_code`, `os_level_8` are hardcoded strings."",
          ""suggested_governance"": ""These values should be managed in a configuration table or a dimension table for `os_level_6`, `l04_publication_code`, `l06_publication_code`, `os_level_8` to allow for easier updates and consistency."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Daily Telegraph'"",
            ""'The Herald Sun'"",
            ""'The Advertiser'"",
            ""'Courier Mail'"",
            ""'Weekly Times'"",
            ""'GCB'"",
            ""'Cairns Post'"",
            ""'Sunshine Coast'"",
            ""'Northern Territory News'"",
            ""'Mercury'"",
            ""'Geelong Advertiser'"",
            ""'The Chronicle'"",
            ""'Daily Mercury'"",
            ""'The Australian'"",
            ""'The Sportsman'"",
            ""'PNG'"",
            ""'6 Day Pubs'"",
            ""'Mercury and Sunday Tas'"",
            ""'NT News & Sunday Territorian'"",
            ""'Other'""
          ],
          ""context"": ""Extensive `CASE` statements for mapping `publication_name` to various standardized names, state groups, and publication groups."",
          ""suggested_governance"": ""Create a `dim_publication_mapping` table with `publication_name`, `standardized_name`, `state_group`, `publication_group`, etc., and join to this table instead of hardcoding logic."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Retail'"",
            ""'Alternative Channels'"",
            ""'Convenience Stores / Service Stations'"",
            ""'Newsagencies'"",
            ""'Subscriptions'"",
            ""'Supermarkets'"",
            ""'Unspec Channel'""
          ],
          ""context"": ""Mapping `os_level_10` to `channel_group` using `CASE` statements."",
          ""suggested_governance"": ""Create a `dim_channel_mapping` table and join to it."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1"",
            ""2"",
            ""4"",
            ""5"",
            ""6"",
            ""7"",
            ""9"",
            ""10"",
            ""12"",
            ""13"",
            ""14"",
            ""15"",
            ""17"",
            ""22"",
            ""26"",
            ""30"",
            ""35"",
            ""39"",
            ""40"",
            ""43"",
            ""48"",
            ""52"",
            ""2025""
          ],
          ""context"": ""Various numeric literals used in conditional logic (e.g., `relative_fisc_week_number < 0`, `weeks_diff_from_fixed_date_q2 = 26`, `fy_month_of_year < 4`, `(2025*100)`). Some of these appear to be Looker Studio internal parameter placeholders that resolve to fixed values (e.g., `('1' = '1')` or `(0 = 0)`)."",
          ""suggested_governance"": ""Identify the business meaning of these numbers (e.g., specific fiscal weeks, month thresholds) and define them as configurable parameters or in a dedicated `dim_business_rules` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-04-15', '2024-07-03') with Looker Studio date parameters or `CURRENT_DATE()`/`CURRENT_TIMESTAMP()` for dynamic reporting."",
      ""Parameterize the fiscal year ('FY2025') to allow users to select different reporting periods."",
      ""Externalize publication name, state, and group mappings into a dedicated dimension table. This table can then be joined to the fact table, making the logic more maintainable and auditable."",
      ""Externalize channel groupings into a dimension table."",
      ""Review and replace Looker Studio internal parameter placeholders (e.g., `('1' = '1')`, `(0 = 0)`) with actual Looker Studio parameters if they are intended to be dynamic user selections."",
      ""Define key numeric thresholds and multipliers (e.g., for daily averages, specific week/month numbers) as configurable parameters or in a business rules table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""budget_volume_past_weeks"",
      ""metric_name"": ""Budget Volume (Past Weeks)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""Budget_Volume"",
        ""relative_fisc_week_number""
      ],
      ""business_description"": ""The sum of Budget Volume for weeks where the relative fiscal week number is less than 0 (i.e., past weeks). Used for historical budget comparison."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""standardized_publication_name_q1 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a view of budget performance for completed periods, often used in variance analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""The threshold '0' for relative_fisc_week_number could be parameterized if dynamic period definitions are needed.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate 'relative_fisc_week_number' from calendar dimension.""
      ]
    },
    {
      ""metric_id"": ""net_volume_actual_vs_budget_past_weeks"",
      ""metric_name"": ""Net Volume (Actual vs. Budget Past Weeks)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume"",
        ""budget_volume_past_weeks""
      ],
      ""business_description"": ""The difference between Actual Volume and Budget Volume for past weeks. Represents the variance from budget."",
      ""sql_logic"": ""SUM(volume - (CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""standardized_publication_name_q1 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for budget adherence and operational efficiency."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""Same as 'budget_volume_past_weeks' regarding the '0' threshold.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on both actual and budget volume data quality.""
      ]
    },
    {
      ""metric_id"": ""actual_volume"",
      ""metric_name"": ""Actual Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume""
      ],
      ""business_description"": ""The sum of actual circulation volume."",
      ""sql_logic"": ""SUM(volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""os_level_8 != 'DTI Free Copies'"",
        ""standardized_publication_name_q1 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Fundamental metric for understanding current circulation performance."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls or incorrect values in source 'volume' column.""
      ]
    },
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""Actual_Amount""
      ],
      ""business_description"": ""The sum of actual revenue amount."",
      ""sql_logic"": ""SUM(Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for circulation, indicating financial performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls or incorrect values in source 'Actual_Amount' column.""
      ]
    },
    {
      ""metric_id"": ""budget_volume_q2"",
      ""metric_name"": ""Budget Volume (Query 2 Context)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""Budget_Volume""
      ],
      ""business_description"": ""The sum of Budget Volume, specifically as calculated in the context of Query 2's complex logic, which often serves as a base for other volume calculations."",
      ""sql_logic"": ""SUM(Budget_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the planned circulation volume, crucial for budget vs. actual comparisons."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Budget_Volume' data.""
      ]
    },
    {
      ""metric_id"": ""last_year_actual_amount"",
      ""metric_name"": ""Last Year Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""Last_Year_Actual_Amount""
      ],
      ""business_description"": ""The sum of actual revenue amount from the previous fiscal year."",
      ""sql_logic"": ""SUM(Last_Year_Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Last_Year_Actual_Amount' data.""
      ]
    },
    {
      ""metric_id"": ""last_year_volume"",
      ""metric_name"": ""Last Year Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""Last_Year_volume""
      ],
      ""business_description"": ""The sum of actual circulation volume from the previous fiscal year."",
      ""sql_logic"": ""SUM(Last_Year_volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year performance comparison of circulation volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Last_Year_volume' data.""
      ]
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""Forecast_Amount""
      ],
      ""business_description"": ""The sum of forecasted revenue amount."",
      ""sql_logic"": ""SUM(Forecast_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into future revenue expectations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Forecast_Amount' data.""
      ]
    },
    {
      ""metric_id"": ""forecast_volume"",
      ""metric_name"": ""Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""Forecast_Volume""
      ],
      ""business_description"": ""The sum of forecasted circulation volume."",
      ""sql_logic"": ""SUM(Forecast_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into future circulation volume expectations."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Forecast_Volume' data.""
      ]
    },
    {
      ""metric_id"": ""ytd_actual_amount_conditional"",
      ""metric_name"": ""YTD Actual Amount (Conditional)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""Actual_Amount"",
        ""fy_year_week_number"",
        ""weeks_diff_from_fixed_date_q2""
      ],
      ""business_description"": ""Year-to-date actual amount, conditionally calculated based on week differences and internal Looker Studio parameter logic. This metric appears to be a YTD Actual Amount based on whether the 'adjusted week difference' is less than or equal to the 'fiscal year week number'. The parameter logic `('2' = '2')` makes it always true, so it's `SUM(Actual_Amount)` up to a certain week."",
      ""sql_logic"": ""SUM(CASE WHEN (weeks_diff_from_fixed_date_q2 <= fy_year_week_number) THEN Actual_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key YTD metric for tracking cumulative actual revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2024-07-03""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'2' = '2'""
      ],
      ""governance_issues"": [
        ""The fixed date '2024-07-03' for week difference calculation should be parameterized. The `('2' = '2')` logic is a Looker Studio internal placeholder and should be reviewed.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate date and week number calculations.""
      ]
    },
    {
      ""metric_id"": ""ytd_budget_amount_conditional"",
      ""metric_name"": ""YTD Budget Amount (Conditional)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""Budget_Amount"",
        ""relative_fisc_week_number"",
        ""relative_fisc_year_number""
      ],
      ""business_description"": ""Year-to-date budget amount, conditionally calculated. Based on the `('2' = '2')` condition being true, it sums `Budget_Amount` for past weeks (`relative_fisc_week_number < 0`)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key YTD metric for tracking cumulative budget revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'2' = '2'""
      ],
      ""governance_issues"": [
        ""The `('2' = '2')` logic is a Looker Studio internal placeholder and should be reviewed. The `relative_fisc_week_number < 0` threshold could be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate 'Budget_Amount' and fiscal week data.""
      ]
    },
    {
      ""metric_id"": ""all_sales_channels_amount"",
      ""metric_name"": ""All Sales Channels Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""selected_amount_metric"",
        ""os_level_7""
      ],
      ""business_description"": ""The sum of the 'Selected Amount Metric' only for records where `os_level_7` is 'ALL SALES CHANNELS'. This metric is essentially a filtered version of `ytd_budget_amount_conditional` (due to `param_1_is_1_q2` being true and `param_2_is_2_q2` being true)."",
      ""sql_logic"": ""SUM(CASE WHEN (os_level_7_upper_q2 = 'ALL SALES CHANNELS') THEN (CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Amount ELSE 0 END) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a specific view of revenue across all sales channels, likely for a specific reporting context."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ALL SALES CHANNELS'"",
        ""0""
      ],
      ""governance_issues"": [
        ""The string 'ALL SALES CHANNELS' should be managed in a dimension table. The underlying conditional logic is complex and relies on Looker Studio internal parameter placeholders.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate 'os_level_7' categorization.""
      ]
    },
    {
      ""metric_id"": ""final_volume_metric_1"",
      ""metric_name"": ""Final Volume Metric 1"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""selected_volume_metric"",
        ""publication_group_q2"",
        ""weeks_26_or_40_flag_q2"",
        ""is_aus_or_cm_flag_q2"",
        ""day_of_week_group_q2"",
        ""standardized_publication_name_v2_q2""
      ],
      ""business_description"": ""A highly complex calculated volume metric, involving divisions by 6 or 7 days, and conditional logic based on publication groups, specific weeks (26 or 40), publication names (Courier Mail, Australian, Sportsman, Weekly Times), and day of week groups (M-F). This likely represents an adjusted daily or weekly average volume."",
      ""sql_logic"": ""SUM(CASE WHEN (publication_group_q2 = 'PNG') THEN 0 WHEN (publication_group_q2 = '6 Day Pubs') THEN SAFE_DIVIDE(CASE WHEN (weeks_26_or_40_flag_q2 AND is_aus_or_cm_flag_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, 4)*5 ELSE Budget_Volume END) WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, 2)*5) WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (Budget_Volume*5) WHEN (publication_group_q2 = 'PNG') THEN 0 ELSE Budget_Volume END, 6) ELSE SAFE_DIVIDE(CASE WHEN (weeks_26_or_40_flag_q2 AND is_aus_or_cm_flag_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, 4)*5 ELSE Budget_Volume END) WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, 2)*5) WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (Budget_Volume*5) WHEN (publication_group_q2 = 'PNG') THEN 0 ELSE Budget_Volume END, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A highly specific and critical volume metric, likely used for detailed performance analysis or forecasting, potentially representing average daily sales for different publication types."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""0"",
        ""6"",
        ""7"",
        ""4"",
        ""5"",
        ""2"",
        ""'The Sportsman'"",
        ""'Weekly Times'"",
        ""'M-F'""
      ],
      ""governance_issues"": [
        ""Extensive hardcoded values and complex nested logic make this metric difficult to understand, maintain, and audit. All hardcoded strings and numbers should be externalized to dimension/configuration tables.""
      ],
      ""data_quality_concerns"": [
        ""High complexity increases risk of misinterpretation or calculation errors. Division by zero is handled by SAFE_DIVIDE, but underlying data quality for volume and week numbers is critical.""
      ]
    },
    {
      ""metric_id"": ""final_volume_metric_2"",
      ""metric_name"": ""Final Volume Metric 2"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""selected_volume_metric"",
        ""publication_group_q2"",
        ""is_australian_q2"",
        ""is_courier_mail_q2"",
        ""day_of_week_group_q2"",
        ""standardized_publication_name_v2_q2"",
        ""adjusted_week_diff_final_q2""
      ],
      ""business_description"": ""Another highly complex calculated volume metric, similar to Final Volume Metric 1 but with slightly different conditional logic and division factors. It also involves divisions by 6 or 7 days, and conditional logic based on publication groups, specific publication names (Courier Mail, Australian, Sportsman, Weekly Times), and day of week groups (M-F)."",
      ""sql_logic"": ""SUM(CASE WHEN (publication_group_q2 = '6 Day Pubs') THEN SAFE_DIVIDE(CASE WHEN (is_australian_q2 OR is_courier_mail_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5 ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END) WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*2))*5) WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)*5) WHEN (publication_group_q2 = 'PNG') THEN 0 WHEN (day_of_week_group_q2 = 'M-F') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5) ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END, 6) ELSE SAFE_DIVIDE(CASE WHEN (is_australian_q2 OR is_courier_mail_q2) THEN (CASE WHEN (day_of_week_group_q2 = 'M-F') THEN SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5 ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END) WHEN (standardized_publication_name_v2_q2 = 'The Sportsman') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*2))*5) WHEN (standardized_publication_name_v2_q2 = 'Weekly Times') THEN (SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2)*5) WHEN (publication_group_q2 = 'PNG') THEN 0 WHEN (day_of_week_group_q2 = 'M-F') THEN (SAFE_DIVIDE(Budget_Volume, (adjusted_week_diff_final_q2*5))*5) ELSE SAFE_DIVIDE(Budget_Volume, adjusted_week_diff_final_q2) END, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_6 = 'CIRCULATION'"",
        ""l04_publication_code <> 'Free News & Lifestyle'"",
        ""l06_publication_code NOT IN ('Food', 'Prestige')"",
        ""gl_hierarchy_code = 'FY2025'"",
        ""channel_group_q2 = 'Retail'"",
        ""standardized_publication_name_v3_q2 IS NOT NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Another highly specific and critical volume metric, likely complementing Final Volume Metric 1 for detailed performance analysis or forecasting, potentially representing average daily sales for different publication types."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""0"",
        ""6"",
        ""7"",
        ""4"",
        ""5"",
        ""2"",
        ""'The Sportsman'"",
        ""'Weekly Times'"",
        ""'M-F'""
      ],
      ""governance_issues"": [
        ""Extensive hardcoded values and complex nested logic make this metric difficult to understand, maintain, and audit. All hardcoded strings and numbers should be externalized to dimension/configuration tables.""
      ],
      ""data_quality_concerns"": [
        ""High complexity increases risk of misinterpretation or calculation errors. Division by zero is handled by SAFE_DIVIDE, but underlying data quality for volume and week numbers is critical.""
      ]
    },
    {
      ""metric_id"": ""fiscal_quarter"",
      ""metric_name"": ""Fiscal Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""fy_quarter_of_year""
      ],
      ""business_description"": ""The fiscal quarter of the year."",
      ""sql_logic"": ""fy_quarter_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping and analyzing financial data by fiscal quarter."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_state_group"",
      ""metric_name"": ""Publication State Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""region"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""publication_name_adjusted_q1""
      ],
      ""business_description"": ""Categorizes publications into Australian states/territories (e.g., NSW, VIC, SA, QLD, NT, TAS) based on their standardized name."",
      ""sql_logic"": ""CASE WHEN (publication_name_adjusted_q1 = 'The Daily Telegraph') THEN ' NSW' WHEN (publication_name_adjusted_q1 IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times')) THEN '  VIC' WHEN (publication_name_adjusted_q1 = 'The Advertiser') THEN '   SA' WHEN (publication_name_adjusted_q1 IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast')) THEN '     QLD' WHEN (publication_name_adjusted_q1 = 'Northern Territory News') THEN '      NT' WHEN (publication_name_adjusted_q1 = 'Mercury') THEN '    TAS' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables regional analysis of circulation budget and revenue."",
      ""metric_category"": ""geography"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""' NSW'"",
        ""'  VIC'"",
        ""'   SA'"",
        ""'     QLD'"",
        ""'      NT'"",
        ""'    TAS'"",
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'"",
        ""'Geelong Advertiser'"",
        ""'Weekly Times'"",
        ""'The Advertiser'"",
        ""'Courier Mail'"",
        ""'Cairns Post'"",
        ""'GCB'"",
        ""'Townsville Bulletin'"",
        ""'The Chronicle'"",
        ""'Daily Mercury'"",
        ""'Sunshine Coast'"",
        ""'Northern Territory News'"",
        ""'Mercury'""
      ],
      ""governance_issues"": [
        ""Hardcoded state mappings should be moved to a dimension table for easier maintenance and consistency.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate publication name standardization.""
      ]
    },
    {
      ""metric_id"": ""standardized_publication_name"",
      ""metric_name"": ""Standardized Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""publication"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""publication_name_adjusted_q1""
      ],
      ""business_description"": ""A standardized name for publications, consolidating variations (e.g., 'Herald Sun' and 'Sunday Herald Sun' become 'The Herald Sun')."",
      ""sql_logic"": ""CASE WHEN (publication_name_adjusted_q1 IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser' WHEN (publication_name_adjusted_q1 IN ('Weekly Times')) THEN 'Weekly Times' WHEN (publication_name_adjusted_q1 IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun' WHEN (publication_name_adjusted_q1 IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph' WHEN (publication_name_adjusted_q1 = 'Toowoomba') THEN 'The Chronicle' WHEN (publication_name_adjusted_q1 = 'Townsville Bulletin') THEN 'Townsville Bulletin' WHEN (publication_name_adjusted_q1 = 'Gold Coast Bulletin') THEN 'GCB' WHEN (publication_name_adjusted_q1 = 'Geelong Advertiser') THEN 'Geelong Advertiser' WHEN (publication_name_adjusted_q1 = 'Cairns Post') THEN 'Cairns Post' WHEN (publication_name_adjusted_q1 = 'Sunshine Coast') THEN 'Sunshine Coast' WHEN (publication_name_adjusted_q1 IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'Courier Mail' WHEN (publication_name_adjusted_q1 IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury' WHEN (publication_name_adjusted_q1 IN ('Sunday Territorian', 'NT News')) THEN 'Northern Territory News' WHEN (publication_name_adjusted_q1 = 'Mackay') THEN 'Daily Mercury' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for consistent reporting and aggregation across different publication titles."",
      ""metric_category"": ""product"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Advertiser'"",
        ""'Weekly Times'"",
        ""'The Herald Sun'"",
        ""'The Daily Telegraph'"",
        ""'The Chronicle'"",
        ""'Townsville Bulletin'"",
        ""'GCB'"",
        ""'Geelong Advertiser'"",
        ""'Cairns Post'"",
        ""'Sunshine Coast'"",
        ""'Courier Mail'"",
        ""'Mercury'"",
        ""'Northern Territory News'"",
        ""'Daily Mercury'"",
        ""'Advertiser'"",
        ""'Sunday Mail (SA)'"",
        ""'Herald Sun'"",
        ""'Sunday Herald Sun'"",
        ""'The Daily Telegraph'"",
        ""'The Sunday Telegraph'"",
        ""'Toowoomba'"",
        ""'Gold Coast Bulletin'"",
        ""'Courier Mail'"",
        ""'Sunday Mail (QLD)'"",
        ""'Sunday Tasmanian'"",
        ""'Sunday Territorian'"",
        ""'NT News'"",
        ""'Mackay'""
      ],
      ""governance_issues"": [
        ""Hardcoded publication name mappings should be moved to a dimension table.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate source publication names.""
      ]
    },
    {
      ""metric_id"": ""os_level_8"",
      ""metric_name"": ""OS Level 8"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""os_level_8""
      ],
      ""business_description"": ""An organizational hierarchy level, likely representing a specific business unit or category within circulation."",
      ""sql_logic"": ""os_level_8"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_8 != 'DTI Free Copies'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for granular analysis and filtering of circulation data."",
      ""metric_category"": ""organizational"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DTI Free Copies'""
      ],
      ""governance_issues"": [
        ""The exclusion filter 'DTI Free Copies' is hardcoded and should be managed externally.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""channel_group"",
      ""metric_name"": ""Channel Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""channel"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""os_level_10""
      ],
      ""business_description"": ""Categorizes sales channels into broader groups like 'Retail', 'Subscriptions', 'Newsagencies', etc."",
      ""sql_logic"": ""CASE WHEN (os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels')) THEN 'Alternative Channels' WHEN (os_level_10 IN ('Petrol and Convenience')) THEN 'Convenience Stores / Service Stations' WHEN (os_level_10 IN ('Agent & Dist')) THEN 'Newsagencies' WHEN (os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub')) THEN 'Subscriptions' WHEN (os_level_10 IN ('Supermarkets')) THEN 'Supermarkets' ELSE 'Unspec Channel' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""channel_group_q2 = 'Retail'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of circulation performance by sales channel."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Retail'"",
        ""'Alternative Channels'"",
        ""'Convenience Stores / Service Stations'"",
        ""'Newsagencies'"",
        ""'Subscriptions'"",
        ""'Supermarkets'"",
        ""'Unspec Channel'"",
        ""'Airlines'"",
        ""'Hotels'"",
        ""'Other Alternate'"",
        ""'Other Alternate Channels'"",
        ""'Petrol and Convenience'"",
        ""'Agent & Dist'"",
        ""'Home Delivery'"",
        ""'Roadside Delivery'"",
        ""'Unspecified Print Sub'""
      ],
      ""governance_issues"": [
        ""Hardcoded channel mappings should be moved to a dimension table.""
      ],
      ""data_quality_concerns"": [
        ""Relies on accurate source 'os_level_10' values.""
      ]
    },
    {
      ""metric_id"": ""time_period_label"",
      ""metric_name"": ""Time Period Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""hardcoded_value"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'YTD' indicating the time period context for the metrics in Query 2."",
      ""sql_logic"": ""'YTD'"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Serves as a label for the data, indicating that the metrics are calculated on a Year-To-Date basis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""static"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'YTD'""
      ],
      ""governance_issues"": [
        ""Hardcoded label 'YTD' should be dynamic based on actual date filters or a parameter.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""net_volume_actual_vs_budget_past_weeks"",
      ""related_metrics"": [
        ""actual_volume"",
        ""budget_volume_past_weeks""
      ],
      ""relationship_description"": ""Net Volume is calculated as Actual Volume minus Budget Volume for past weeks."",
      ""mathematical_formula"": ""net_volume_actual_vs_budget_past_weeks = actual_volume - budget_volume_past_weeks"",
      ""business_validation"": ""This relationship quantifies the variance from the budget, indicating over or under performance."",
      ""validation_sql"": ""SELECT SUM(volume - (CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END)) = SUM(volume) - SUM(CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE upper(os_level_6) = 'CIRCULATION' AND gl_hierarchy_code = 'FY2025' AND SAFE_CAST(fiscal_week_id AS STRING) LIKE '2025%'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""channel_group"",
        ""standardized_publication_name_v3_q2""
      ],
      ""relationship_description"": ""Actual Amount (and other Query 2 metrics) are filtered specifically for 'Retail' channel group and non-null standardized publication names."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""This ensures that the reported financial metrics are specific to the retail channel, which is a critical business segment."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub ON os.gl_publication_code = pub.publication_code WHERE (CASE WHEN (os.os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels')) THEN 'Alternative Channels' WHEN (os.os_level_10 IN ('Petrol and Convenience')) THEN 'Convenience Stores / Service Stations' WHEN (os.os_level_10 IN ('Agent & Dist')) THEN 'Newsagencies' WHEN (os.os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub')) THEN 'Subscriptions' WHEN (os.os_level_10 IN ('Supermarkets')) THEN 'Supermarkets' ELSE 'Unspec Channel' END) = 'Retail' AND (CASE WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Weekly Times')) THEN 'Weekly Times' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Toowoomba') THEN 'The Chronicle' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Townsville Bulletin') THEN 'Townsville Bulletin' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Gold Coast Bulletin') THEN 'GCB' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Geelong Advertiser') THEN 'Geelong Advertiser' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Cairns Post') THEN 'Cairns Post' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Sunshine Coast') THEN 'Sunshine Coast' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'Courier Mail' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END IN ('Sunday Territorian', 'NT News')) THEN 'Northern Territory News' WHEN (CASE WHEN (os.gl_publication_code = 'Post Courier') THEN 'PNG' ELSE pub.publication_name END = 'Mackay') THEN 'Daily Mercury' ELSE NULL END) IS NOT NULL LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""publication_state_group"",
      ""related_metrics"": [
        ""standardized_publication_name""
      ],
      ""relationship_description"": ""Standardized Publication Name rolls up into Publication State Group."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""This hierarchy allows for analysis from individual publication level up to state/regional level."",
      ""validation_sql"": ""SELECT DISTINCT standardized_publication_name_q1, publication_state_group_q1 FROM Derived_Columns WHERE standardized_publication_name_q1 IS NOT NULL AND publication_state_group_q1 IS NOT NULL LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""final_volume_metric_1"",
      ""related_metrics"": [
        ""selected_volume_metric"",
        ""publication_group_q2"",
        ""weeks_26_or_40_flag_q2"",
        ""is_aus_or_cm_flag_q2"",
        ""day_of_week_group_q2"",
        ""standardized_publication_name_v2_q2""
      ],
      ""relationship_description"": ""Final Volume Metric 1 is a complex calculation that depends on multiple flags, publication types, and day-of-week groupings, applying different division factors (6 or 7) and multipliers (5) based on these conditions."",
      ""mathematical_formula"": ""Complex conditional logic involving SAFE_DIVIDE and multiplication, as detailed in the metric's SQL logic."",
      ""business_validation"": ""This metric provides a highly tailored view of volume, likely reflecting specific business rules for different publication categories and reporting periods (e.g., 6-day vs 7-day publications, special calculations for Sportsman/Weekly Times)."",
      ""validation_sql"": ""SELECT SUM(final_volume_metric_1) FROM Final_Metrics WHERE final_volume_metric_1 IS NOT NULL LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""final_volume_metric_2"",
      ""related_metrics"": [
        ""selected_volume_metric"",
        ""publication_group_q2"",
        ""is_australian_q2"",
        ""is_courier_mail_q2"",
        ""day_of_week_group_q2"",
        ""standardized_publication_name_v2_q2"",
        ""adjusted_week_diff_final_q2""
      ],
      ""relationship_description"": ""Final Volume Metric 2 is another complex calculation, similar to Final Volume Metric 1 but with variations in its conditional logic and division factors, also depending on publication types, day-of-week, and an adjusted week difference."",
      ""mathematical_formula"": ""Complex conditional logic involving SAFE_DIVIDE and multiplication, as detailed in the metric's SQL logic."",
      ""business_validation"": ""This metric likely serves a similar purpose to Final Volume Metric 1 but for a slightly different set of business rules or reporting requirements, providing another tailored view of volume."",
      ""validation_sql"": ""SELECT SUM(final_volume_metric_2) FROM Final_Metrics WHERE final_volume_metric_2 IS NOT NULL LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,29
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""80ca81f3-0671-40ef-a0a9-825a1580ca1b"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 2,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_name"",
      ""portfolio_conformed_name_sync"",
      ""sales_segment_l_2_name_sync""
    ],
    ""date_range_detected"": ""Not explicitly detected in provided queries, but assumed for a sales dashboard."",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'GAD RAM A1'"",
      ""'HBT RAM A1'"",
      ""'VIC DIRECT A7'"",
      ""'VIC DIRECT A8'"",
      ""'VIC DIRECT A9'""
    ],
    ""governance_opportunities"": [
      ""Hardcoded portfolio names should be replaced with a join to a governed lookup table or parameterized.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.advertiser_name,\n    t0.portfolio_conformed_name_sync,\n    t0.sales_segment_l_2_name_sync,\n    -- Assuming a date column and a revenue column for a sales performance dashboard\n    SAFE_CAST(t0.date_column AS DATE) AS date_column,\n    SAFE_CAST(t0.revenue_column AS NUMERIC) AS revenue_column\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE SAFE_CAST(t0.date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Common date filter for performance dashboards\n)\nSELECT\n  date_column,\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync,\n  COUNT(*) AS record_count,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT portfolio_conformed_name_sync) AS unique_portfolios,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) AS unique_sales_segments,\n  SUM(revenue_column) AS total_revenue_90_days -- Example metric\nFROM base_data\nGROUP BY\n  date_column,\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync\nORDER BY\n  date_column DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(date_column AS DATE)) AS unique_dates,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT portfolio_conformed_name_sync) AS unique_portfolio_names,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) AS unique_sales_segments,\n  MIN(SAFE_CAST(date_column AS DATE)) AS earliest_date,\n  MAX(SAFE_CAST(date_column AS DATE)) AS latest_date,\n  APPROX_COUNT_DISTINCT(advertiser_name || portfolio_conformed_name_sync || sales_segment_l_2_name_sync || SAFE_CAST(date_column AS STRING)) AS approx_unique_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS data_exists_test,\n  CASE WHEN COUNT(DISTINCT advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_data_test,\n  CASE WHEN COUNT(DISTINCT portfolio_conformed_name_sync) > 0 THEN 'PASS' ELSE 'FAIL' END AS portfolio_data_test,\n  CASE WHEN COUNT(DISTINCT sales_segment_l_2_name_sync) > 0 THEN 'PASS' ELSE 'FAIL' END AS sales_segment_data_test,\n  CASE WHEN MAX(SAFE_CAST(date_column AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN SUM(SAFE_CAST(revenue_column AS NUMERIC)) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS revenue_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Hardcoded Portfolio Values Check' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9') THEN 1 ELSE 0 END) AS records_matching_hardcoded_list,\n  SAFE_DIVIDE(SUM(CASE WHEN portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS match_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(date_column AS DATE) AS date_column,\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync,\n  SAFE_CAST(revenue_column AS NUMERIC) AS revenue_column -- Assuming a revenue column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE SAFE_CAST(date_column AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nORDER BY SAFE_CAST(date_column AS DATE) DESC, advertiser_name ASC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'GAD RAM A1'"",
            ""'HBT RAM A1'"",
            ""'VIC DIRECT A7'"",
            ""'VIC DIRECT A8'"",
            ""'VIC DIRECT A9'""
          ],
          ""context"": ""Used to filter `portfolio_conformed_name_sync` for a specific list of portfolios."",
          ""suggested_governance"": ""These values should ideally be stored in a reference table (e.g., `adsales_portfolio_lookup`) and joined to, or managed as a parameter in Looker Studio."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded portfolio names with a dynamic parameter in Looker Studio or a join to a governed reference table."",
      ""Implement date parameters for dashboard date ranges instead of hardcoding date filters in underlying queries (if any were present).""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the sales performance record. Used primarily for filtering and grouping."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows users to filter sales performance data by specific advertisers or view performance per advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for variations in naming conventions if not standardized.""
      ]
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A standardized name for the sales portfolio. Used for filtering advertiser names in one of the queries."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables filtering of advertisers based on specific portfolio groupings, which might represent different sales teams or product categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'GAD RAM A1'"",
        ""'HBT RAM A1'"",
        ""'VIC DIRECT A7'"",
        ""'VIC DIRECT A8'"",
        ""'VIC DIRECT A9'""
      ],
      ""governance_issues"": [
        ""Hardcoded values should be externalized to a lookup table or parameter.""
      ],
      ""data_quality_concerns"": [
        ""Consistency of 'conformed' names needs to be maintained upstream.""
      ]
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment L2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_selection"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the second-level sales segment. Used for filtering and grouping sales performance data."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of sales performance broken down by different sales segments, providing insights into segment-specific trends."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Ensuring consistent and accurate segmentation names.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_name"",
      ""related_metrics"": [
        ""portfolio_conformed_name_sync""
      ],
      ""relationship_description"": ""The list of `advertiser_name` values displayed in a filter/dropdown is constrained by the selected `portfolio_conformed_name_sync` values. Specifically, only advertisers belonging to the hardcoded list of portfolios are shown."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""This interaction ensures that users can narrow down the list of advertisers to those relevant to specific, pre-defined portfolios."",
      ""validation_sql"": ""SELECT\n  COUNT(DISTINCT t0.advertiser_name) AS filtered_advertiser_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE t0.portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1', 'VIC DIRECT A7', 'VIC DIRECT A8', 'VIC DIRECT A9');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,30
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""8956e94b-f6d1-46a3-9c7f-87a91fbe98b5"",
    ""dashboard_name"": ""LODs"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 9,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_month"",
      ""financial_quarter"",
      ""sales_segment_l_2_name_sync"",
      ""portfolio_group_name_sync"",
      ""GSD"",
      ""revenue_type"",
      ""xtend_flag""
    ],
    ""date_range_detected"": ""Current FY, Previous FY, Next FY (relative to current date)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""relative_fy_year_offset IN (-1, 0, 1)"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'MRCA'"",
      ""'CONSORTIUM NSW'"",
      ""'KEY ACCOUNTS NSW RETAIL'"",
      ""'DIRECT NSW'"",
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'PRESTIGE'"",
      ""'Ian Paterson'"",
      ""'VACANT'"",
      ""'SFCE'"",
      ""'PLUTO'"",
      ""'Y'""
    ],
    ""governance_opportunities"": [
      ""Relative year offsets should be parameterized for flexible reporting periods."",
      ""Transaction statuses ('BILLED', 'BOOKED') should be managed in a lookup table."",
      ""Style names ('ROP COMPOSITE') should be managed in a lookup table."",
      ""Publishing division names ('MEDIUM RARE CONTENT AGENCY') should be managed in a lookup table."",
      ""Publication name and account number specific rules should be externalized to a configuration table or UDF."",
      ""Sales segment names ('MRCA', NSW segments) should be managed in a lookup table."",
      ""Specific personnel names ('Ian Paterson') should be derived from a managed user/role dimension."",
      ""Source system codes ('SFCE', 'PLUTO') should be managed in a lookup table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH SFCE_USER AS (\n    SELECT\n      TEMP1.network_user_name AS login_name,\n      TEMP1.user_name AS full_name\n    FROM\n      (\n        SELECT\n          UPPER(network_user_name) AS network_user_name,\n          UPPER(user_name) AS user_name,\n          ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n        FROM\n          `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n        WHERE\n          dw_source_system_code = 'SFCE'\n      ) AS TEMP1\n    WHERE\n      TEMP1.RN = 1\n  ),\n  base_adsales_data AS (\n    SELECT\n      unified_publication_name,\n      unified_publication_gl_code,\n      fy_year_month_number,\n      financial_year,\n      financial_quarter,\n      financial_month,\n      financial_short_month,\n      financial_week,\n      revenue_transaction_status,\n      is_print_digital_flag,\n      current_financial_month,\n      current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM `CURRENT_DATE`()) AS DOW_Today,\n      sales_segment_l_1_name,\n      nca_industry_anzsic_pillar_group,\n      sales_segment_l_2_name,\n      sales_segment_l_1_name_sync,\n      sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      advertiser_group,\n      advertiser_parent,\n      SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n      sales_segment_gm_name,\n      CASE\n        WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW',\n          'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n        ELSE sales_segment_gm_name_sync\n      END AS sales_segment_gm_name_sync,\n      revenue_group_level_1_name,\n      revenue_group_level_2_name,\n      SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n      SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n      SUM(IFNULL(pipeline, 0)) AS pipeline,\n      SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n      UPPER(revenue_type) AS revenue_type,\n      UPPER(revenue_group_subtype) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      portfolio_group_name_sync,\n      portfolio_group_name_current,\n      portfolio_parent_group_name_sync,\n      nca_industry_pillar,\n      publishing_division_group,\n      publishing_division_parent,\n      is_future_period_flag,\n      ly_is_future_period_flag,\n      xtend_flag,\n      ny_is_future_period_flag,\n      cost_model_type,\n      CASE\n        WHEN source_system_code = 'PLUTO' THEN NULL\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      portfolio_conformed_name_sync,\n      publishing_division,\n      booking_line_created_week,\n      booking_line_created_month,\n      booking_line_created_short_month,\n      booking_line_created_quarter,\n      booking_line_created_year,\n      agency_parent,\n      agency_group,\n      agency_name,\n      agency_number,\n      calendar_month_name,\n      calendar_year,\n      classification_name,\n      product_group,\n      SUM(IFNULL(target, 0)) AS target,\n      IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD,\n      current_portfolio_conformed_owner_current,\n      current_portfolio_group_owner_current,\n      IFNULL(GSD_JOIN_CURR.full_name, 'VACANT') AS current_portfolio_group_owner_full,\n      IFNULL(GSD_JOIN_CONFORM.full_name, 'VACANT') AS current_portfolio_conformed_owner_full\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN\n      ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN_CURR\n      ON UPPER(current_portfolio_group_owner_current) = GSD_JOIN_CURR.login_name\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN_CONFORM\n      ON UPPER(current_portfolio_conformed_owner_current) = GSD_JOIN_CONFORM.login_name\n    WHERE\n      relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED',\n        'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division,\n          'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n      (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n    GROUP BY ALL\n  )\nSELECT\n  -- Dimensions\n  financial_year,\n  financial_month,\n  SAFE_CAST(financial_quarter AS STRING) AS financial_quarter_str,\n  financial_short_month,\n  portfolio_group_name_sync,\n  sales_segment_l_2_name_sync,\n  GSD,\n  revenue_type,\n  xtend_flag,\n  -- Metrics\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  SUM(SAFE_CAST(pipeline AS NUMERIC)) AS total_pipeline_amount,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS current_fy_gross_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(pipeline AS NUMERIC) ELSE 0 END) AS current_fy_pipeline,\n  MAX(CASE WHEN sales_segment_l_2_name_sync = 'Digital Other' THEN TRUE ELSE FALSE END) AS is_digital_other_sales_segment_present,\n  SAFE_CAST(financial_quarter AS FLOAT64) AS financial_quarter_float, -- For t0_qt_i8wzniajkd\n  CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END AS xtend_revenue_type_derived\nFROM\n  base_adsales_data\nGROUP BY\n  financial_year,\n  financial_month,\n  financial_quarter_str,\n  financial_short_month,\n  portfolio_group_name_sync,\n  sales_segment_l_2_name_sync,\n  GSD,\n  revenue_type,\n  xtend_flag\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(financial_month AS STRING)) as unique_financial_months,\n  COUNT(DISTINCT SAFE_CAST(sales_segment_l_2_name_sync AS STRING)) as unique_sales_segments,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(unified_publication_name) as approx_unique_publications\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset IN (-1, 0, 1) \n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1000;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(pipeline AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as pipeline_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_test,\n  CASE WHEN COUNT(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset = 0 \n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'revenue_transaction_status_filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset IN (-1, 0, 1)\nLIMIT 1000;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(financial_month AS STRING) as financial_month,\n  SAFE_CAST(financial_quarter AS STRING) as financial_quarter,\n  SAFE_CAST(sales_segment_l_2_name_sync AS STRING) as sales_segment_l_2_name_sync,\n  SAFE_CAST(portfolio_group_name_sync AS STRING) as portfolio_group_name_sync,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(pipeline AS NUMERIC) as pipeline,\n  SAFE_CAST(relative_fy_year_offset AS INT64) as relative_fy_year_offset,\n  SAFE_CAST(revenue_type AS STRING) as revenue_type,\n  SAFE_CAST(xtend_flag AS STRING) as xtend_flag,\n  SAFE_CAST(revenue_transaction_status AS STRING) as revenue_transaction_status,\n  SAFE_CAST(style_name AS STRING) as style_name,\n  SAFE_CAST(source_publishing_division AS STRING) as source_publishing_division,\n  SAFE_CAST(publication_name AS STRING) as publication_name,\n  SAFE_CAST(account_number AS STRING) as account_number\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset = 0 \n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nORDER BY \n  financial_year DESC, financial_month DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""-1"",
            ""0"",
            ""1""
          ],
          ""context"": ""relative financial year offsets used for filtering data range"",
          ""suggested_governance"": ""replace with parameters or a configuration table for dynamic range selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'BILLED'"",
            ""'BOOKED'""
          ],
          ""context"": ""revenue transaction statuses used in WHERE clause"",
          ""suggested_governance"": ""join to a `dim_revenue_transaction_status` lookup table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'ROP COMPOSITE'""
          ],
          ""context"": ""style name excluded in WHERE clause"",
          ""suggested_governance"": ""join to a `dim_style_name` lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'MEDIUM RARE CONTENT AGENCY'""
          ],
          ""context"": ""source publishing division excluded in WHERE clause"",
          ""suggested_governance"": ""join to a `dim_publishing_division` lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'""
          ],
          ""context"": ""specific publication name and account number logic in WHERE clause"",
          ""suggested_governance"": ""externalize these rules into a configuration table or a UDF for easier management and auditing"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'MRCA'"",
            ""'CONSORTIUM NSW'"",
            ""'KEY ACCOUNTS NSW RETAIL'"",
            ""'DIRECT NSW'"",
            ""'INDEPENDENT AGENCIES NSW'"",
            ""'PRESTIGE'""
          ],
          ""context"": ""sales segment names used in CASE statements for Sales_Group and sales_segment_gm_name_sync"",
          ""suggested_governance"": ""manage these categories in a `dim_sales_segment` lookup table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Ian Paterson'""
          ],
          ""context"": ""specific name hardcoded as a sales segment GM"",
          ""suggested_governance"": ""derive from a `dim_employee` or `dim_user` table based on roles/segments"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""default_values"",
          ""hardcoded_values"": [
            ""'VACANT'""
          ],
          ""context"": ""default value for GSD if no join match"",
          ""suggested_governance"": ""acceptable as a default, but ensure 'VACANT' is a recognized business term"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SFCE'"",
            ""'PLUTO'""
          ],
          ""context"": ""source system codes used in filters and CASE statements"",
          ""suggested_governance"": ""manage in a `dim_source_system` lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""flags"",
          ""hardcoded_values"": [
            ""'Y'""
          ],
          ""context"": ""xtend_flag value used in CASE statement"",
          ""suggested_governance"": ""define as a boolean or enum in a data dictionary, or map to a lookup table if more values are expected"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded relative year offsets with dashboard parameters (e.g., `start_fy_offset`, `end_fy_offset`)."",
      ""Replace hardcoded lookup values (transaction statuses, style names, division names, sales segments, source systems) with joins to governed reference tables."",
      ""Externalize complex business rules (e.g., publication/account number logic, sales GM assignments) into configuration tables or user-defined functions for better maintainability and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the revenue transaction."",
      ""sql_logic"": ""t0c0d1.financial_year / t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for financial reporting and trend analysis."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month associated with the revenue transaction."",
      ""sql_logic"": ""t0c0d1.financial_month / t0.financial_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for monthly financial reporting."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter associated with the revenue transaction."",
      ""sql_logic"": ""t0.financial_quarter (SAFE_CAST to FLOAT64 in query 2)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for quarterly financial reporting and comparisons."",
      ""metric_category"": ""time"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment L2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The synchronized Level 2 sales segment name for the transaction."",
      ""sql_logic"": ""t0c0d1.sales_segment_l_2_name_sync / t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for analyzing sales performance by segment."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'"",
        ""'MRCA'"",
        ""'CONSORTIUM NSW'"",
        ""'KEY ACCOUNTS NSW RETAIL'"",
        ""'DIRECT NSW'"",
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'PRESTIGE'""
      ],
      ""governance_issues"": [
        ""Sales segment names are hardcoded in various CASE statements and filters; should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_group_name_sync"",
      ""metric_name"": ""Portfolio Group Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The synchronized portfolio group name associated with the transaction."",
      ""sql_logic"": ""t0.portfolio_group_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting revenue by portfolio groups."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gsd"",
      ""metric_name"": ""GSD (Group Sales Director)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""lookup"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""current_portfolio_group_owner_sync""
      ],
      ""business_description"": ""The full name of the Group Sales Director (GSD) associated with the portfolio group owner, derived from the SFCE_USER dimension. Defaults to 'VACANT' if not found."",
      ""sql_logic"": ""IFNULL(GSD_JOIN.full_name, 'VACANT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly"",
        ""ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for sales team performance analysis."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'""
      ],
      ""governance_issues"": [
        ""The default 'VACANT' is hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""Dependency on `v_user_dim` for accurate GSD mapping.""
      ]
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of revenue (e.g., Digital, Print)."",
      ""sql_logic"": ""UPPER(revenue_type)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Categorizes revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""xtend_flag"",
      ""metric_name"": ""XTEND Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag indicating if the revenue is associated with 'XTEND'."",
      ""sql_logic"": ""xtend_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for specific revenue categorization related to 'XTEND'."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'""
      ],
      ""governance_issues"": [
        ""The 'Y' value is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""The sum of all gross revenue amounts for the selected period and dimensions."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""UPPER(revenue_transaction_status) IN ('BILLED', 'BOOKED')"",
        ""UPPER(style_name) <> 'ROP COMPOSITE'"",
        ""UPPER(source_publishing_division) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core metric for overall revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in `gross_revenue_amount` handled by `IFNULL(..., 0)` in base CTE.""
      ]
    },
    {
      ""metric_id"": ""total_pipeline_amount"",
      ""metric_name"": ""Total Pipeline Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""pipeline""
      ],
      ""business_description"": ""The sum of all pipeline amounts for the selected period and dimensions."",
      ""sql_logic"": ""SUM(pipeline)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""UPPER(revenue_transaction_status) IN ('BILLED', 'BOOKED')"",
        ""UPPER(style_name) <> 'ROP COMPOSITE'"",
        ""UPPER(source_publishing_division) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core metric for future revenue potential and sales forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls in `pipeline` handled by `IFNULL(..., 0)` in base CTE.""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of gross revenue amounts specifically for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) (outer filter, but inner logic focuses on 0)"",
        ""UPPER(revenue_transaction_status) IN ('BILLED', 'BOOKED')"",
        ""UPPER(style_name) <> 'ROP COMPOSITE'"",
        ""UPPER(source_publishing_division) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for current period performance tracking and comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""The '0' for current FY offset is hardcoded; could be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_pipeline"",
      ""metric_name"": ""Current FY Pipeline"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""pipeline"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""The sum of pipeline amounts specifically for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) (outer filter, but inner logic focuses on 0)"",
        ""UPPER(revenue_transaction_status) IN ('BILLED', 'BOOKED')"",
        ""UPPER(style_name) <> 'ROP COMPOSITE'"",
        ""UPPER(source_publishing_division) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name specific logic""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for current period sales forecasting and pipeline health."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""The '0' for current FY offset is hardcoded; could be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment_present"",
      ""metric_name"": ""Is Digital Other Sales Segment Present"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_max"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""A flag indicating if 'Digital Other' sales segment is present within the grouped data."",
      ""sql_logic"": ""MAX(CASE WHEN sales_segment_l_2_name_sync = 'Digital Other' THEN TRUE ELSE FALSE END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for filtering or highlighting data related to 'Digital Other' sales."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""The 'Digital Other' string is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""xtend_revenue_type_derived"",
      ""metric_name"": ""XTEND Revenue Type Derived"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_string"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_type""
      ],
      ""business_description"": ""Categorizes revenue as 'XTEND' if the xtend_flag is 'Y', otherwise uses the original revenue_type."",
      ""sql_logic"": ""CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a consolidated view of revenue types, highlighting 'XTEND' revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""The 'Y' and 'XTEND' strings are hardcoded.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current FY Gross Revenue is a conditional sum of gross_revenue_amount, filtered by relative_fy_year_offset being 0 (current financial year)."",
      ""mathematical_formula"": ""Current_FY_Gross_Revenue = SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))"",
      ""business_validation"": ""Ensures that only revenue from the current financial year contributes to this metric, allowing for accurate year-to-date performance tracking."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS current_fy_gross_revenue_check,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_for_fy0_check\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset = 0 \n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_pipeline"",
      ""related_metrics"": [
        ""pipeline"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current FY Pipeline is a conditional sum of pipeline, filtered by relative_fy_year_offset being 0 (current financial year)."",
      ""mathematical_formula"": ""Current_FY_Pipeline = SUM(IF(relative_fy_year_offset = 0, pipeline, 0))"",
      ""business_validation"": ""Ensures that only pipeline from the current financial year contributes to this metric, allowing for accurate current year forecasting."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN SAFE_CAST(pipeline AS NUMERIC) ELSE 0 END) AS current_fy_pipeline_check,\n  SUM(SAFE_CAST(pipeline AS NUMERIC)) AS total_pipeline_for_fy0_check\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE \n  relative_fy_year_offset = 0 \n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""total_pipeline_amount"",
        ""current_fy_gross_revenue"",
        ""current_fy_pipeline""
      ],
      ""relationship_description"": ""All primary revenue and pipeline metrics are subject to a common set of filters on financial year offset, transaction status, style name, publishing division, and specific publication rules."",
      ""mathematical_formula"": ""N/A (filter application)"",
      ""business_validation"": ""These filters define the scope of 'valid' revenue and pipeline data for reporting, ensuring consistency across all related metrics."",
      ""validation_sql"": ""SELECT \n  COUNT(*) as total_records_filtered,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) as filtered_gross_revenue,\n  SUM(SAFE_CAST(pipeline AS NUMERIC)) as filtered_pipeline\nFROM \n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED',\n    'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division,\n      'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n  (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,31
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""601ed0d2-e944-4189-8170-d593c8e72026"",
    ""dashboard_name"": ""Adex"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource;ncau-data-newsquery-prd.sbx_dcp.adex_datasource_test"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""date"",
      ""Advertiser"",
      ""Media_Network"",
      ""Major_Category"",
      ""Category"",
      ""Sub_Category"",
      ""portfolio_parent_group_name"",
      ""calendar_year"",
      ""financial_year""
    ],
    ""date_range_detected"": ""Dynamic based on 'latest_date' and 'max_fin_year' from data, typically rolling 12-24 months or specific calendar/financial years."",
    ""hardcoded_dates_found"": [
      ""Dynamic year starts (e.g., YYYY-01-01, YYYY-07-01) derived from 'latest_date' and 'max_fin_year'""
    ],
    ""hardcoded_values_found"": [
      ""'Rolling 12 months'"",
      ""'Calendar Year'"",
      ""'Financial Year'"",
      ""'NEWS CORP'"",
      ""'youtube'"",
      ""'facebook'"",
      ""'KEY ACCOUNTS TRAVEL'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""Specific list of 'NT Dept Of...' Advertisers""
    ],
    ""governance_opportunities"": [
      ""Time period selection (Rolling 12 months, Calendar Year, Financial Year) should be parameterized."",
      ""Financial Year start logic is inconsistent across queries and should be standardized."",
      ""Specific Advertiser lists and Portfolio Parent Group names should be managed via governed lookup tables."",
      ""Quarter definitions are hardcoded and could be part of a date dimension table."",
      ""Currency formatting logic (e.g., '$\\'000' vs '$') appears redundant or unused in final metric calculations and should be reviewed.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query combines the core logic from the provided SQL samples to calculate key metrics.\n-- It assumes 'Rolling 12 months' as the default time period for demonstration.\n-- Replace `@time_period_param` with actual Looker Studio parameter value (e.g., 'Rolling 12 months', 'Calendar Year', 'Financial Year').\n-- Note: Financial Year logic inconsistency is resolved by using Query 1's logic (current FY vs previous FY).\n\nWITH\n  base_adex_data AS (\n    SELECT\n      *,\n      -- Derive calendar month short name and calendar year\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource -- Using adex_datasource as primary, note adex_datasource_test also used.\n    WHERE\n      date IS NOT NULL AND Spend IS NOT NULL -- Basic data quality filter\n  ),\n  time_context AS (\n    SELECT\n      MAX(date) AS latest_date,\n      MAX(financial_year) AS max_fin_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource -- Use the same source for context dates\n  ),\n  temp_data_with_ty_ly AS (\n    SELECT\n      t1.*,\n      CASE @time_period_param -- Placeholder for Looker Studio parameter\n        WHEN 'Rolling 12 months' THEN\n          CASE\n            WHEN DATE_DIFF(tc.latest_date, t1.date, MONTH) <= 11 THEN 'ty'\n            WHEN DATE_DIFF(tc.latest_date, t1.date, MONTH) BETWEEN 12 AND 23 THEN 'ly'\n            ELSE NULL\n          END\n        WHEN 'Calendar Year' THEN\n          CASE\n            WHEN t1.date <= tc.latest_date AND t1.date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM tc.latest_date) AS STRING),'-01-01')) THEN 'ty'\n            WHEN t1.date <= DATETIME_ADD(tc.latest_date, INTERVAL -1 YEAR) AND t1.date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM tc.latest_date) - 1 AS STRING), '-01-01')) THEN 'ly'\n            ELSE NULL\n          END\n        WHEN 'Financial Year' THEN\n          CASE\n            -- Using Query 1's Financial Year logic: current FY vs previous FY\n            WHEN t1.date <= tc.latest_date AND t1.date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year AS STRING), '-07-01')) THEN 'ty'\n            WHEN t1.date <= tc.latest_date AND t1.date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year - 1 AS STRING), '-07-01')) THEN 'ly'\n            ELSE NULL\n          END\n        ELSE NULL\n      END AS ty_ly_embed\n    FROM\n      base_adex_data AS t1\n    CROSS JOIN\n      time_context AS tc\n  ),\n  calculated_metrics AS (\n    SELECT\n      *,\n      SAFE_DIVIDE(Spend, 1000) AS Spend_K,\n      -- Calculate Quarter based on calendar_month_short_name\n      CASE\n        WHEN calendar_month_short_name IN ('Jan', 'Feb', 'Mar') THEN 'Q1'\n        WHEN calendar_month_short_name IN ('Apr', 'May', 'Jun') THEN 'Q2'\n        WHEN calendar_month_short_name IN ('Jul', 'Aug', 'Sep') THEN 'Q3'\n        WHEN calendar_month_short_name IN ('Oct', 'Nov', 'Dec') THEN 'Q4'\n        ELSE NULL\n      END AS Calendar_Quarter,\n      -- Calculate YearMonth for sorting\n      (calendar_year * 100 + CASE\n        WHEN calendar_month_short_name = 'Jan' THEN 1\n        WHEN calendar_month_short_name = 'Feb' THEN 2\n        WHEN calendar_month_short_name = 'Mar' THEN 3\n        WHEN calendar_month_short_name = 'Apr' THEN 4\n        WHEN calendar_month_short_name = 'May' THEN 5\n        WHEN calendar_month_short_name = 'Jun' THEN 6\n        WHEN calendar_month_short_name = 'Jul' THEN 7\n        WHEN calendar_month_short_name = 'Aug' THEN 8\n        WHEN calendar_month_short_name = 'Sep' THEN 9\n        WHEN calendar_month_short_name = 'Oct' THEN 10\n        WHEN calendar_month_short_name = 'Nov' THEN 11\n        WHEN calendar_month_short_name = 'Dec' THEN 12\n        ELSE NULL\n      END) AS YearMonth\n    FROM\n      temp_data_with_ty_ly\n  ),\n  final_data AS (\n    SELECT\n      date,\n      Advertiser,\n      Major_Category,\n      Media_Network,\n      Category,\n      Sub_Category,\n      portfolio_parent_group_name,\n      calendar_year,\n      financial_year,\n      calendar_month_short_name,\n      Calendar_Quarter,\n      YearMonth,\n      ty_ly_embed,\n      Spend_K,\n      -- TY and LY Spend_K\n      SUM(CASE WHEN ty_ly_embed = 'ty' THEN Spend_K ELSE 0 END) AS TY_Spend_K,\n      SUM(CASE WHEN ty_ly_embed = 'ly' THEN Spend_K ELSE 0 END) AS LY_Spend_K,\n      -- Advertiser-level TY Spend metrics (window functions)\n      SUM(CASE WHEN Media_Network = 'NEWS CORP' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) AS NEWS_CORP_TY_Spend_Raw,\n      SUM(CASE WHEN Media_Network = 'youtube' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) AS Youtube_TY_Spend_Raw,\n      SUM(CASE WHEN Media_Network = 'facebook' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) AS Facebook_TY_Spend_Raw,\n      SUM(CASE WHEN ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) AS Total_Advertiser_TY_Spend_Raw,\n      -- Source Count (window function)\n      COUNT(DISTINCT source) OVER (PARTITION BY account_number, ty_ly_embed) AS Source_Count\n    FROM\n      calculated_metrics\n    GROUP BY\n      date,\n      Advertiser,\n      Major_Category,\n      Media_Network,\n      Category,\n      Sub_Category,\n      portfolio_parent_group_name,\n      calendar_year,\n      financial_year,\n      calendar_month_short_name,\n      Calendar_Quarter,\n      YearMonth,\n      ty_ly_embed,\n      Spend_K, -- Include Spend_K in GROUP BY because it's selected directly and not aggregated in this subquery\n      account_number, -- Required for Source_Count partition\n      source -- Required for Source_Count distinct count\n  )\nSELECT\n  date,\n  Advertiser,\n  Major_Category,\n  Media_Network,\n  Category,\n  Sub_Category,\n  portfolio_parent_group_name,\n  calendar_year,\n  financial_year,\n  calendar_month_short_name,\n  Calendar_Quarter,\n  YearMonth,\n  ty_ly_embed,\n  TY_Spend_K,\n  LY_Spend_K,\n  SAFE_DIVIDE(NEWS_CORP_TY_Spend_Raw, 1000) AS NEWS_CORP_TY_Spend_K,\n  SAFE_DIVIDE(Youtube_TY_Spend_Raw, 1000) AS Youtube_TY_Spend_K,\n  SAFE_DIVIDE(Facebook_TY_Spend_Raw, 1000) AS Facebook_TY_Spend_K,\n  SAFE_DIVIDE(Total_Advertiser_TY_Spend_Raw, 1000) AS Total_Advertiser_TY_Spend_K,\n  Source_Count,\n  -- Add total fixed counts (these are constant per query, so can be cross-joined or derived once)\n  (SELECT COUNT(DISTINCT portfolio_parent_group_name) FROM base_adex_data) AS Fixed_PPG_Count,\n  (SELECT COUNT(DISTINCT sales_segment_gm_name) FROM base_adex_data) AS Fixed_GM_Count,\n  (SELECT COUNT(DISTINCT portfolio_group_name) FROM base_adex_data) AS Fixed_PG_Count,\n  (SELECT COUNT(DISTINCT portfolio_conformed_name) FROM base_adex_data) AS Fixed_Portfolio_Count,\n  (SELECT COUNT(DISTINCT media_network) FROM base_adex_data) AS Fixed_Publisher_Count\nFROM\n  final_data\nWHERE\n  -- Apply filters from original queries (example, combine with OR if multiple filters are possible)\n  (portfolio_parent_group_name = 'KEY ACCOUNTS TRAVEL' AND Calendar_Quarter = 'Q2')\n  OR\n  (Advertiser IN (\n    'NT Dept Of Trade Business & Innovation', 'NT Dept Of Chief Minister', 'NT Dept Of Infrastructure Planning & Logistics',\n    'NT Dept Of Industry Tourism & Trade', 'NT Dept Of Education Employment & Training', 'NT Dept Of Tourism & Culture',\n    'NT Dept Of Transport', 'NT Dept Of Attorney-General & Justice', 'NT Dept Of Environment & Natural Resources',\n    'NT Dept Of Lands Planning & The Environment', 'NT Dept Of Health', 'NT Dept Of Police Fire & Emergency Services',\n    'NT Dept Of Business', 'NT Dept Of Territory Families, Housing & Communities', 'NT Dept Of Primary Industry & Resources',\n    'NT Dept Of Environment Parks & Water Security', 'NT Dept Of Corporate & Information Services'\n  ))\n  AND date >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH) -- Example date filter for cost optimization\nORDER BY\n  date DESC, Advertiser, Media_Network\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(date AS DATE)) AS unique_dates,\n  COUNT(DISTINCT Advertiser) AS unique_advertisers,\n  COUNT(DISTINCT Media_Network) AS unique_media_networks,\n  COUNT(DISTINCT Major_Category) AS unique_major_categories,\n  MIN(SAFE_CAST(date AS DATE)) AS earliest_date,\n  MAX(SAFE_CAST(date AS DATE)) AS latest_date,\n  AVG(SAFE_CAST(Spend AS NUMERIC)) AS average_spend,\n  SUM(CASE WHEN Spend IS NULL THEN 1 ELSE 0 END) AS null_spend_count,\n  SUM(CASE WHEN date IS NULL THEN 1 ELSE 0 END) AS null_date_count\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(Spend AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_spend_positive_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END AS unique_advertisers_exist_test,\n  CASE WHEN MAX(SAFE_CAST(date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(DISTINCT CASE WHEN Media_Network = 'NEWS CORP' THEN Media_Network END) > 0 THEN 'PASS' ELSE 'FAIL' END AS news_corp_data_exists_test,\n  CASE WHEN COUNT(DISTINCT CASE WHEN financial_year IS NOT NULL THEN financial_year END) > 0 THEN 'PASS' ELSE 'FAIL' END AS financial_year_data_exists_test\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This query validates the financial year logic inconsistency detected.\n-- It compares the 'ty' start date for 'Financial Year' based on Query 1's logic vs. Queries 2/3's logic.\n-- A 'FAIL' indicates a discrepancy in how 'This Year' is defined for Financial Year across different dashboard components.\n\nWITH\n  time_context AS (\n    SELECT\n      MAX(date) AS latest_date,\n      MAX(financial_year) AS max_fin_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Financial Year TY Logic Consistency' AS rule_name,\n  CASE\n    WHEN PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year AS STRING), '-07-01')) = PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year - 1 AS STRING), '-07-01')) THEN 'FAIL: TY start dates are identical, indicating a logic error or misinterpretation.'\n    WHEN PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year AS STRING), '-07-01')) IS NULL OR PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year - 1 AS STRING), '-07-01')) IS NULL THEN 'FAIL: max_fin_year or derived dates are NULL.'\n    ELSE 'PASS: TY start dates for Financial Year are distinct based on the two observed patterns.'\n  END AS consistency_check_result,\n  SAFE_CAST(PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year AS STRING), '-07-01')) AS STRING) AS query1_ty_fy_start_date,\n  SAFE_CAST(PARSE_DATE('%Y-%m-%d', CONCAT(CAST(tc.max_fin_year - 1 AS STRING), '-07-01')) AS STRING) AS query2_3_ty_fy_start_date,\n  SAFE_CAST(tc.max_fin_year AS STRING) AS detected_max_financial_year\nFROM\n  time_context AS tc\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(date AS DATE) AS date,\n  Advertiser,\n  Media_Network,\n  Major_Category,\n  Category,\n  Sub_Category,\n  portfolio_parent_group_name,\n  SAFE_CAST(Spend AS NUMERIC) AS Spend,\n  financial_year,\n  calendar_year,\n  account_number,\n  sales_segment_gm_name,\n  portfolio_group_name,\n  portfolio_conformed_name,\n  source\nFROM\n  `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE\n  SAFE_CAST(date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH) -- Sample recent data\n  AND Spend IS NOT NULL\nORDER BY\n  date DESC, Spend DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""YYYY-01-01"",
          ""original_format"": ""CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')"",
          ""context"": ""Used to define the start of Calendar Year periods ('ty' and 'ly')."",
          ""suggested_fix"": ""Use `DATE_TRUNC(latest_date, YEAR)` for current year and `DATE_SUB(DATE_TRUNC(latest_date, YEAR), INTERVAL 1 YEAR)` for previous year. This makes it more robust and readable."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""YYYY-07-01"",
          ""original_format"": ""CONCAT(CAST(max_fin_year AS STRING), '-7-1')"",
          ""context"": ""Used to define the start of Financial Year periods ('ty' and 'ly'). Inconsistent logic across queries (max_fin_year vs max_fin_year-1 for 'ty')."",
          ""suggested_fix"": ""Standardize financial year start logic across all queries. Define financial year start as a parameter or a governed function/table. E.g., `DATE(max_fin_year, 7, 1)` if `max_fin_year` is the start year."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Rolling 12 months'"",
            ""'Calendar Year'"",
            ""'Financial Year'""
          ],
          ""context"": ""These strings define the time period selection logic. They are likely Looker Studio parameters but are hardcoded in the SQL logic."",
          ""suggested_governance"": ""Ensure these are passed as parameters from the dashboard UI rather than embedded directly in the SQL, or use a configuration table if the logic itself needs to be dynamic."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'NEWS CORP'"",
            ""'youtube'"",
            ""'facebook'""
          ],
          ""context"": ""Specific media networks are hardcoded for calculating spend metrics (e.g., `NEWS_CORP_TY_Spend_K`)."",
          ""suggested_governance"": ""If these are subject to change or need to be dynamic, consider a lookup table for `Media_Network` categories."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'KEY ACCOUNTS TRAVEL'""
          ],
          ""context"": ""A specific `portfolio_parent_group_name` is hardcoded as a filter."",
          ""suggested_governance"": ""Manage this filter value via a dashboard parameter or a governed reference table for `portfolio_parent_group_name`."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""'Q2'""
          ],
          ""context"": ""A specific quarter ('Q2') is hardcoded as a filter."",
          ""suggested_governance"": ""Manage this filter value via a dashboard parameter. Quarter definitions should ideally come from a date dimension table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""filter_values"",
          ""hardcoded_values"": [
            ""List of 'NT Dept Of...' Advertisers""
          ],
          ""context"": ""A long, specific list of `Advertiser` names is hardcoded as a filter."",
          ""suggested_governance"": ""This list should be managed in a governed lookup table (e.g., `advertiser_groups`) and joined or filtered dynamically."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'ty'"",
            ""'ly'""
          ],
          ""context"": ""These strings represent 'This Year' and 'Last Year' periods."",
          ""suggested_governance"": ""Standard and acceptable, but their definition relies on the hardcoded date logic."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""currency_format_flags"",
          ""hardcoded_values"": [
            ""'$\\'000'"",
            ""'$'""
          ],
          ""context"": ""Boolean flags (`clmn0_`, `clmn1_`) are set based on these strings, potentially for currency formatting logic, but the final spend metrics are consistently divided by 1000."",
          ""suggested_governance"": ""Review if these flags are still necessary or if the currency conversion should be handled purely by the `SAFE_DIVIDE(Spend, 1000)` operation. If different currency displays are needed, parameterize the conversion factor."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded time period strings ('Rolling 12 months', 'Calendar Year', 'Financial Year') with a Looker Studio parameter."",
      ""Standardize and parameterize the financial year start date logic to ensure consistency across all dashboard components."",
      ""Externalize specific filter lists (e.g., 'NT Dept Of...' Advertisers, 'KEY ACCOUNTS TRAVEL' portfolio group) into governed lookup tables or dashboard parameters."",
      ""Use `DATE_TRUNC` and `DATE_SUB` for relative date calculations instead of `CONCAT` and `PARSE_DATE` with hardcoded month/day strings."",
      ""Consider a dedicated date dimension table that pre-calculates fiscal periods, quarters, and TY/LY flags based on a single, governed definition.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""raw_spend"",
      ""metric_name"": ""Raw Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw advertising spend value as recorded in the source system."",
      ""sql_logic"": ""t0.Spend"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all spend-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential NULLs handled by `CASE WHEN (clmnX IS NULL) THEN 0 ELSE clmnX END`.""
      ]
    },
    {
      ""metric_id"": ""spend_k"",
      ""metric_name"": ""Spend ('000)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""raw_spend""
      ],
      ""business_description"": ""Advertising spend expressed in thousands (Spend / 1000)."",
      ""sql_logic"": ""SAFE_DIVIDE(Spend, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for display purposes to simplify large spend figures."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ty_ly_embed"",
      ""metric_name"": ""This Year/Last Year Period"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""date"",
        ""latest_date"",
        ""max_fin_year""
      ],
      ""business_description"": ""Categorizes each transaction as 'ty' (This Year) or 'ly' (Last Year) based on a selected time period (Rolling 12 months, Calendar Year, Financial Year)."",
      ""sql_logic"": ""CASE @time_period_param WHEN 'Rolling 12 months' THEN ... WHEN 'Calendar Year' THEN ... WHEN 'Financial Year' THEN ... END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for time-series comparisons and calculating year-over-year growth."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""YYYY-01-01"",
        ""YYYY-07-01""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Rolling 12 months'"",
        ""'Calendar Year'"",
        ""'Financial Year'"",
        ""'ty'"",
        ""'ly'""
      ],
      ""governance_issues"": [
        ""Hardcoded time period strings should be parameterized."",
        ""Inconsistent financial year logic across queries.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ty_spend_k"",
      ""metric_name"": ""This Year Spend ('000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_k"",
        ""ty_ly_embed""
      ],
      ""business_description"": ""Total advertising spend in thousands for the 'This Year' period, based on the selected time comparison."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' THEN Spend_K ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for current period performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ly_spend_k"",
      ""metric_name"": ""Last Year Spend ('000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_k"",
        ""ty_ly_embed""
      ],
      ""business_description"": ""Total advertising spend in thousands for the 'Last Year' period, based on the selected time comparison."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ly' THEN Spend_K ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for historical performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""news_corp_ty_spend_k"",
      ""metric_name"": ""NEWS CORP TY Spend ('000)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum_window"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""raw_spend"",
        ""ty_ly_embed"",
        ""media_network""
      ],
      ""business_description"": ""Total advertising spend in thousands for 'NEWS CORP' media network in the 'This Year' period, calculated per Advertiser."",
      ""sql_logic"": ""SUM(CASE WHEN Media_Network = 'NEWS CORP' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific performance of a key media network for each advertiser."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'NEWS CORP'""
      ],
      ""governance_issues"": [
        ""Hardcoded media network name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""youtube_ty_spend_k"",
      ""metric_name"": ""Youtube TY Spend ('000)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum_window"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""raw_spend"",
        ""ty_ly_embed"",
        ""media_network""
      ],
      ""business_description"": ""Total advertising spend in thousands for 'youtube' media network in the 'This Year' period, calculated per Advertiser."",
      ""sql_logic"": ""SUM(CASE WHEN Media_Network = 'youtube' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific performance of a key media network for each advertiser."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'youtube'""
      ],
      ""governance_issues"": [
        ""Hardcoded media network name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""facebook_ty_spend_k"",
      ""metric_name"": ""Facebook TY Spend ('000)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum_window"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""raw_spend"",
        ""ty_ly_embed"",
        ""media_network""
      ],
      ""business_description"": ""Total advertising spend in thousands for 'facebook' media network in the 'This Year' period, calculated per Advertiser."",
      ""sql_logic"": ""SUM(CASE WHEN Media_Network = 'facebook' AND ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific performance of a key media network for each advertiser."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'facebook'""
      ],
      ""governance_issues"": [
        ""Hardcoded media network name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_advertiser_ty_spend_k"",
      ""metric_name"": ""Total Advertiser TY Spend ('000)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum_window"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""raw_spend"",
        ""ty_ly_embed""
      ],
      ""business_description"": ""Total advertising spend in thousands for the 'This Year' period, calculated per Advertiser across all media networks."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' THEN Spend ELSE 0 END) OVER (PARTITION BY Advertiser) / 1000"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall performance of each advertiser in the current period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_count"",
      ""metric_name"": ""Source Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct_window"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""account_number_and_period"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""source"",
        ""account_number"",
        ""ty_ly_embed""
      ],
      ""business_description"": ""Count of distinct data sources for a given account number and time period (ty/ly). (Always 'Adex' in provided queries, so likely always 1)."",
      ""sql_logic"": ""COUNT(DISTINCT source) OVER (PARTITION BY account_number, ty_ly_embed)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates how many data sources contribute to an account's data for a given period. Appears to be a data quality/integrity check."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_publisher_count"",
      ""metric_name"": ""Fixed Publisher Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""total_dataset"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""media_network""
      ],
      ""business_description"": ""Total count of distinct media networks across the entire dataset."",
      ""sql_logic"": ""COUNT(DISTINCT media_network)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of all unique publishers available in the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_ppg_count"",
      ""metric_name"": ""Fixed Portfolio Parent Group Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""total_dataset"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""portfolio_parent_group_name""
      ],
      ""business_description"": ""Total count of distinct portfolio parent group names across the entire dataset."",
      ""sql_logic"": ""COUNT(DISTINCT portfolio_parent_group_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of all unique portfolio parent groups available in the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_gm_count"",
      ""metric_name"": ""Fixed Sales Segment GM Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""total_dataset"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""sales_segment_gm_name""
      ],
      ""business_description"": ""Total count of distinct sales segment GM names across the entire dataset."",
      ""sql_logic"": ""COUNT(DISTINCT sales_segment_gm_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of all unique sales segment GMs available in the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_pg_count"",
      ""metric_name"": ""Fixed Portfolio Group Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""total_dataset"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""portfolio_group_name""
      ],
      ""business_description"": ""Total count of distinct portfolio group names across the entire dataset."",
      ""sql_logic"": ""COUNT(DISTINCT portfolio_group_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of all unique portfolio groups available in the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fixed_portfolio_count"",
      ""metric_name"": ""Fixed Portfolio Conformed Name Count"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""total_dataset"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""portfolio_conformed_name""
      ],
      ""business_description"": ""Total count of distinct portfolio conformed names across the entire dataset."",
      ""sql_logic"": ""COUNT(DISTINCT portfolio_conformed_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of all unique portfolio conformed names available in the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_quarter"",
      ""metric_name"": ""Calendar Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""calendar_month_short_name""
      ],
      ""business_description"": ""The calendar quarter (Q1-Q4) derived from the transaction's month."",
      ""sql_logic"": ""CASE WHEN calendar_month_short_name IN ('Jan', 'Feb', 'Mar') THEN 'Q1' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for quarterly reporting and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jan'"",
        ""'Feb'"",
        ""'Mar'"",
        ""'Apr'"",
        ""'May'"",
        ""'Jun'"",
        ""'Jul'"",
        ""'Aug'"",
        ""'Sep'"",
        ""'Oct'"",
        ""'Nov'"",
        ""'Dec'"",
        ""'Q1'"",
        ""'Q2'"",
        ""'Q3'"",
        ""'Q4'""
      ],
      ""governance_issues"": [
        ""Hardcoded month names and quarter labels. Could be derived from a date dimension table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""year_month"",
      ""metric_name"": ""Year Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""calendar_year"",
        ""calendar_month_short_name""
      ],
      ""business_description"": ""A numeric representation of the year and month (YYYYMM) for sorting and grouping."",
      ""sql_logic"": ""(calendar_year * 100 + month_number)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primarily for ordering and grouping data chronologically."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""ty_spend_k"",
      ""related_metrics"": [
        ""spend_k"",
        ""ty_ly_embed""
      ],
      ""relationship_description"": ""TY Spend ('000) is calculated by summing Spend ('000) only for records identified as 'This Year' by the `ty_ly_embed` logic."",
      ""mathematical_formula"": ""TY_Spend_K = SUM(Spend_K WHERE ty_ly_embed = 'ty')"",
      ""business_validation"": ""Ensures that current period performance is accurately aggregated based on the chosen time comparison method."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN ty_ly_embed = 'ty' THEN Spend_K ELSE 0 END) AS calculated_ty_spend_k FROM primary_analysis_sql_cte_output;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""ly_spend_k"",
      ""related_metrics"": [
        ""spend_k"",
        ""ty_ly_embed""
      ],
      ""relationship_description"": ""LY Spend ('000) is calculated by summing Spend ('000) only for records identified as 'Last Year' by the `ty_ly_embed` logic."",
      ""mathematical_formula"": ""LY_Spend_K = SUM(Spend_K WHERE ty_ly_embed = 'ly')"",
      ""business_validation"": ""Ensures that historical period performance is accurately aggregated for comparison."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN ty_ly_embed = 'ly' THEN Spend_K ELSE 0 END) AS calculated_ly_spend_k FROM primary_analysis_sql_cte_output;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""ty_spend_k"",
      ""related_metrics"": [
        ""portfolio_parent_group_name"",
        ""calendar_quarter"",
        ""advertiser""
      ],
      ""relationship_description"": ""The `TY_Spend_K` (and other spend metrics) are filtered by specific values of `portfolio_parent_group_name`, `Calendar_Quarter`, and a long list of `Advertiser` names. These filters significantly narrow down the dataset for analysis."",
      ""mathematical_formula"": ""N/A (filtering)"",
      ""business_validation"": ""These filters define the specific segments of advertising spend being analyzed (e.g., 'KEY ACCOUNTS TRAVEL' in Q2, or specific government advertisers)."",
      ""validation_sql"": ""SELECT COUNT(*) FROM primary_analysis_sql_cte_output WHERE portfolio_parent_group_name = 'KEY ACCOUNTS TRAVEL' AND Calendar_Quarter = 'Q2';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_advertiser_ty_spend_k"",
      ""related_metrics"": [
        ""news_corp_ty_spend_k"",
        ""youtube_ty_spend_k"",
        ""facebook_ty_spend_k""
      ],
      ""relationship_description"": ""The `Total_Advertiser_TY_Spend_K` represents the sum of all `TY_Spend_K` for a given Advertiser, which includes contributions from specific media networks like 'NEWS CORP', 'youtube', and 'facebook'. These are calculated using window functions partitioned by Advertiser."",
      ""mathematical_formula"": ""Total_Advertiser_TY_Spend_K = SUM(NEWS_CORP_TY_Spend_K + Youtube_TY_Spend_K + Facebook_TY_Spend_K + Other_Media_Networks_TY_Spend_K) OVER (PARTITION BY Advertiser)"",
      ""business_validation"": ""Allows for a breakdown of an advertiser's total spend by media network, providing insights into channel allocation."",
      ""validation_sql"": ""SELECT Advertiser, SUM(NEWS_CORP_TY_Spend_K + Youtube_TY_Spend_K + Facebook_TY_Spend_K) AS sum_specific_networks, Total_Advertiser_TY_Spend_K FROM primary_analysis_sql_cte_output GROUP BY Advertiser, Total_Advertiser_TY_Spend_K HAVING sum_specific_networks <= Total_Advertiser_TY_Spend_K;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""inconsistency"",
      ""primary_metric"": ""ty_ly_embed"",
      ""related_metrics"": [
        ""max_fin_year""
      ],
      ""relationship_description"": ""The definition of 'ty' and 'ly' for 'Financial Year' differs between Query 1 and Queries 2/3. Query 1 defines 'ty' as the current financial year and 'ly' as the previous financial year. Queries 2/3 define 'ty' as the previous financial year and 'ly' as the financial year before that."",
      ""mathematical_formula"": ""N/A (logic inconsistency)"",
      ""business_validation"": ""This inconsistency can lead to different results for 'This Year' and 'Last Year' spend when comparing different dashboard components, causing confusion and distrust in data."",
      ""validation_sql"": ""See `business_rules_sql` for validation."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,32
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b15d856f-e3ce-4991-bf2a-92395390524f"",
    ""dashboard_name"": ""Programmatic Rolling 60 Day Overview_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 5,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""ProductType"",
      ""TransactionType"",
      ""TransactionTypeCategory""
    ],
    ""date_range_detected"": ""Rolling 60 days from current date"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Deal'"",
      ""'pmp'"",
      ""'PG - CPM'"",
      ""'AG'"",
      ""'PMP_DEAL'"",
      ""'RTB'"",
      ""'PG - CPD'"",
      ""'Open Auction'"",
      ""'Unknown'"",
      ""'UFR'"",
      ""'Guaranteed'"",
      ""'Deal'"",
      ""'Open Auction'""
    ],
    ""governance_opportunities"": [
      ""TransactionType categorization should be driven by a reference table instead of hardcoded CASE statements.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\n-- Note: Assumes 'transaction_date' column exists in the base table for date filtering. Adjust if the date column has a different name or if partitioning is used (e.g., _PARTITIONTIME).\nWITH base_data AS (\n  SELECT\n    t0.ProductType,\n    SAFE_CAST(t0.RevenueNet AS NUMERIC) AS RevenueNet,\n    SAFE_CAST(t0.TransactionType AS STRING) AS TransactionType,\n    SAFE_CAST(t0.transaction_date AS DATE) as transaction_date_parsed\n  FROM\n    `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\n  WHERE\n    SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY)\n),\ncategorized_data AS (\n  SELECT\n    ProductType,\n    RevenueNet,\n    TransactionType,\n    transaction_date_parsed,\n    CASE\n      WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n      WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n      WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction'\n      ELSE TransactionType\n    END AS TransactionTypeCategory\n  FROM\n    base_data\n)\n-- Aggregation by ProductType\nSELECT\n  'ProductType' AS aggregation_type,\n  ProductType AS dimension_value,\n  NULL AS transaction_type_category_value, -- To align columns for UNION ALL\n  SUM(RevenueNet) AS total_revenue_net\nFROM\n  categorized_data\nGROUP BY\n  ProductType\n\nUNION ALL\n\n-- Aggregation by TransactionTypeCategory\nSELECT\n  'TransactionTypeCategory' AS aggregation_type,\n  NULL AS dimension_value, -- To align columns for UNION ALL\n  TransactionTypeCategory AS transaction_type_category_value,\n  SUM(RevenueNet) AS total_revenue_net\nFROM\n  categorized_data\nGROUP BY\n  TransactionTypeCategory\nORDER BY\n  aggregation_type, total_revenue_net DESC\nLIMIT 200;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.transaction_date AS DATE)) as unique_dates,\n  COUNT(DISTINCT SAFE_CAST(t0.ProductType AS STRING)) as unique_product_types,\n  COUNT(DISTINCT SAFE_CAST(t0.TransactionType AS STRING)) as unique_transaction_types,\n  MIN(SAFE_CAST(t0.transaction_date AS DATE)) as earliest_transaction_date,\n  MAX(SAFE_CAST(t0.transaction_date AS DATE)) as latest_transaction_date,\n  SUM(CASE WHEN t0.RevenueNet IS NULL THEN 1 ELSE 0 END) as null_revenue_net_count,\n  SUM(CASE WHEN t0.ProductType IS NULL THEN 1 ELSE 0 END) as null_product_type_count,\n  SUM(CASE WHEN t0.TransactionType IS NULL THEN 1 ELSE 0 END) as null_transaction_type_count\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\nWHERE\n  SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.RevenueNet AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.ProductType AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as product_type_present_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.TransactionType AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_type_present_test,\n  CASE WHEN MAX(SAFE_CAST(t0.transaction_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_present_test\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\nWHERE\n  SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH categorized_data AS (\n  SELECT\n    SAFE_CAST(t0.TransactionType AS STRING) AS TransactionType,\n    CASE\n      WHEN (SAFE_CAST(t0.TransactionType AS STRING) = 'AG' OR SAFE_CAST(t0.TransactionType AS STRING) = 'PG - CPM' OR SAFE_CAST(t0.TransactionType AS STRING) = 'PG - CPD') THEN 'Guaranteed'\n      WHEN (SAFE_CAST(t0.TransactionType AS STRING) = 'Deal' OR SAFE_CAST(t0.TransactionType AS STRING) = 'pmp' OR SAFE_CAST(t0.TransactionType AS STRING) = 'PMP_DEAL' OR SAFE_CAST(t0.TransactionType AS STRING) = 'UFR') THEN 'Deal'\n      WHEN (SAFE_CAST(t0.TransactionType AS STRING) = 'Open Auction' OR SAFE_CAST(t0.TransactionType AS STRING) = 'RTB' OR SAFE_CAST(t0.TransactionType AS STRING) = 'Unknown') THEN 'Open Auction'\n      ELSE SAFE_CAST(t0.TransactionType AS STRING)\n    END AS TransactionTypeCategory\n  FROM\n    `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\n  WHERE\n    SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Transaction Type Categorization Coverage' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN TransactionTypeCategory IN ('Guaranteed', 'Deal', 'Open Auction') THEN 1 ELSE 0 END) as records_categorized,\n  SUM(CASE WHEN TransactionTypeCategory = TransactionType THEN 1 ELSE 0 END) as records_falling_to_else_clause,\n  SAFE_DIVIDE(SUM(CASE WHEN TransactionTypeCategory IN ('Guaranteed', 'Deal', 'Open Auction') THEN 1 ELSE 0 END), COUNT(*)) * 100 as categorization_coverage_percentage,\n  ARRAY_AGG(DISTINCT TransactionType IGNORE NULLS ORDER BY TransactionType LIMIT 10) as sample_uncategorized_types\nFROM\n  categorized_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(t0.transaction_date AS DATE) as transaction_date,\n  SAFE_CAST(t0.ProductType AS STRING) as product_type,\n  SAFE_CAST(t0.TransactionType AS STRING) as transaction_type,\n  SAFE_CAST(t0.RevenueNet AS NUMERIC) as revenue_net\nFROM\n  `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\nWHERE\n  SAFE_CAST(t0.transaction_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND t0.RevenueNet IS NOT NULL\nORDER BY\n  SAFE_CAST(t0.transaction_date AS DATE) DESC,\n  SAFE_CAST(t0.RevenueNet AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Deal'"",
            ""'pmp'"",
            ""'PG - CPM'"",
            ""'AG'"",
            ""'PMP_DEAL'"",
            ""'RTB'"",
            ""'PG - CPD'"",
            ""'Open Auction'"",
            ""'Unknown'"",
            ""'UFR'"",
            ""'Guaranteed'"",
            ""'Deal'"",
            ""'Open Auction'""
          ],
          ""context"": ""Transaction type values and their mapped categories are hardcoded in a CASE statement."",
          ""suggested_governance"": ""Create a `transaction_type_category_lookup` table with columns like `transaction_type`, `category_name`."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded transaction type categories with joins to a governed reference table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""revenue_net"",
      ""metric_name"": ""Revenue Net"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""base_field"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw net revenue amount for a given transaction."",
      ""sql_logic"": ""t0.RevenueNet"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Fundamental financial metric representing the income generated before any deductions or categorizations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""product_type"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""base_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of product associated with a revenue transaction."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by different product offerings."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""transaction_type"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""base_field"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific type of transaction (e.g., 'Deal', 'RTB', 'AG')."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides granular detail on how a transaction was executed, used for categorization."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""total_revenue_net_by_product_type"",
      ""metric_name"": ""Total Revenue Net by Product Type"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""ProductType"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_net"",
        ""product_type""
      ],
      ""business_description"": ""Represents the total net revenue generated, broken down by the type of product sold."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [
        ""Rolling 60 days (implied by table name and applied in primary_analysis_sql)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for understanding product line performance and revenue contribution."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueNet""
      ]
    },
    {
      ""metric_id"": ""transaction_type_category"",
      ""metric_name"": ""Transaction Type Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""transaction_type""
      ],
      ""business_description"": ""Categorizes raw transaction types into broader business-defined categories (Guaranteed, Deal, Open Auction) for high-level analysis."",
      ""sql_logic"": ""CASE WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal' WHEN (TransactionType = 'Open Auction' OR TransactionType = 'RTB' OR TransactionType = 'Unknown') THEN 'Open Auction' ELSE TransactionType END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Simplifies complex transaction types into actionable categories for strategic reporting and performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Deal'"",
        ""'pmp'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PMP_DEAL'"",
        ""'RTB'"",
        ""'PG - CPD'"",
        ""'Open Auction'"",
        ""'Unknown'"",
        ""'UFR'"",
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'""
      ],
      ""governance_issues"": [
        ""hardcoded values should be replaced with a lookup table""
      ],
      ""data_quality_concerns"": [
        ""'Unknown' category indicates potential data quality issues or missing mappings""
      ]
    },
    {
      ""metric_id"": ""total_revenue_net_by_transaction_type_category"",
      ""metric_name"": ""Total Revenue Net by Transaction Type Category"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction_type_category"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_net"",
        ""transaction_type_category""
      ],
      ""business_description"": ""Represents the total net revenue generated, broken down by the categorized transaction type, providing insight into revenue streams by deal type."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY transaction_type_category"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [
        ""Rolling 60 days (implied by table name and applied in primary_analysis_sql)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for analyzing the performance of different programmatic deal types (e.g., guaranteed vs. open auction)."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Deal'"",
        ""'pmp'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PMP_DEAL'"",
        ""'RTB'"",
        ""'PG - CPD'"",
        ""'Open Auction'"",
        ""'Unknown'"",
        ""'UFR'"",
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'""
      ],
      ""governance_issues"": [
        ""hardcoded values in underlying dimension should be replaced with a lookup table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueNet"",
        ""'Unknown' category in underlying dimension""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_revenue_net_by_product_type"",
      ""related_metrics"": [
        ""revenue_net"",
        ""product_type""
      ],
      ""relationship_description"": ""Total Revenue Net by Product Type is an aggregation of Revenue Net, grouped by Product Type."",
      ""mathematical_formula"": ""SUM(revenue_net) GROUP BY product_type"",
      ""business_validation"": ""Ensures that revenue is correctly attributed to specific product lines."",
      ""validation_sql"": ""SELECT ProductType, SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` GROUP BY ProductType LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""transaction_type_category"",
      ""related_metrics"": [
        ""transaction_type""
      ],
      ""relationship_description"": ""Transaction Type Category is a derived dimension based on the raw Transaction Type, applying specific business rules."",
      ""mathematical_formula"": ""CASE WHEN (TransactionType IN ('AG', 'PG - CPM', 'PG - CPD')) THEN 'Guaranteed' ... ELSE TransactionType END"",
      ""business_validation"": ""Validates that raw transaction types are correctly mapped to their higher-level business categories."",
      ""validation_sql"": ""SELECT TransactionType, CASE WHEN (SAFE_CAST(TransactionType AS STRING) = 'AG' OR SAFE_CAST(TransactionType AS STRING) = 'PG - CPM' OR SAFE_CAST(TransactionType AS STRING) = 'PG - CPD') THEN 'Guaranteed' WHEN (SAFE_CAST(TransactionType AS STRING) = 'Deal' OR SAFE_CAST(TransactionType AS STRING) = 'pmp' OR SAFE_CAST(TransactionType AS STRING) = 'PMP_DEAL' OR SAFE_CAST(TransactionType AS STRING) = 'UFR') THEN 'Deal' WHEN (SAFE_CAST(TransactionType AS STRING) = 'Open Auction' OR SAFE_CAST(TransactionType AS STRING) = 'RTB' OR SAFE_CAST(TransactionType AS STRING) = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(TransactionType AS STRING) END AS TransactionTypeCategory FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_revenue_net_by_transaction_type_category"",
      ""related_metrics"": [
        ""revenue_net"",
        ""transaction_type_category""
      ],
      ""relationship_description"": ""Total Revenue Net by Transaction Type Category is an aggregation of Revenue Net, grouped by the derived Transaction Type Category."",
      ""mathematical_formula"": ""SUM(revenue_net) GROUP BY transaction_type_category"",
      ""business_validation"": ""Ensures that revenue is correctly attributed to different programmatic deal types (e.g., Guaranteed, Deal, Open Auction)."",
      ""validation_sql"": ""WITH categorized_data AS (SELECT SAFE_CAST(RevenueNet AS NUMERIC) AS RevenueNet, CASE WHEN (SAFE_CAST(TransactionType AS STRING) = 'AG' OR SAFE_CAST(TransactionType AS STRING) = 'PG - CPM' OR SAFE_CAST(TransactionType AS STRING) = 'PG - CPD') THEN 'Guaranteed' WHEN (SAFE_CAST(TransactionType AS STRING) = 'Deal' OR SAFE_CAST(TransactionType AS STRING) = 'pmp' OR SAFE_CAST(TransactionType AS STRING) = 'PMP_DEAL' OR SAFE_CAST(TransactionType AS STRING) = 'UFR') THEN 'Deal' WHEN (SAFE_CAST(TransactionType AS STRING) = 'Open Auction' OR SAFE_CAST(TransactionType AS STRING) = 'RTB' OR SAFE_CAST(TransactionType AS STRING) = 'Unknown') THEN 'Open Auction' ELSE SAFE_CAST(TransactionType AS STRING) END AS TransactionTypeCategory FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`) SELECT TransactionTypeCategory, SUM(RevenueNet) FROM categorized_data GROUP BY TransactionTypeCategory LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,33
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5491badf-5ec0-4b4f-a427-b12a3a3395dd"",
    ""dashboard_name"": ""Programmatic / Tubi Performance FY25"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 28,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_month"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""relative_fy_year_offset"",
      ""relative_fy_month_offset"",
      ""cost_model_type"",
      ""revenue_group_subtype"",
      ""unified_publication_name"",
      ""reporting_date"",
      ""channel_type""
    ],
    ""date_range_detected"": ""Current FY (relative_fy_year_offset = 0) and Previous FY (relative_fy_year_offset = -1), with a specific cut-off date of 2025-06-18 for some metrics."",
    ""hardcoded_dates_found"": [
      ""2025-06-18""
    ],
    ""hardcoded_values_found"": [
      ""'PMP'"",
      ""'TUBI'"",
      ""'PERFORMANCE'"",
      ""'PG'"",
      ""'OMP'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'Run of Audience Extension'"",
      ""0"",
      ""-1"",
      ""2"",
      ""'Y'"",
      ""'N'"",
      ""'GUARANTEED'"",
      ""'NON-GUARANTEED'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE(), DATE_TRUNC())."",
      ""Lookup values for 'Channel Type', 'Cost Model Type', 'Revenue Group Subtype', and 'Unified Publication Name' should be managed in governed reference tables and joined, rather than hardcoded in CASE statements."",
      ""Business rules for deriving 'Channel Type' and 'Is Audience Extension' should be externalized or documented clearly.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Consolidates key metrics from both queries\nWITH\n  base_data AS (\n    SELECT\n      t0.cost_model_type,\n      SAFE_CAST(t0.financial_month AS INT64) AS financial_month,\n      SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n      t0.financial_short_month,\n      SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n      SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n      SAFE_CAST(t0.relative_fy_month_offset AS INT64) AS relative_fy_month_offset,\n      UPPER(SAFE_CAST(t0.revenue_group_subtype AS STRING)) AS revenue_group_subtype,\n      t0.unified_publication_name,\n      t0.reporting_date,\n      -- Derived fields common to both queries\n      CASE\n        WHEN t0.unified_publication_name = 'Run of Audience Extension' THEN 'Y'\n        ELSE 'N'\n      END AS is_audience_extension_flag,\n      CASE\n        WHEN t0.unified_publication_name = 'TUBI' THEN 'TUBI'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'GUARANTEED' THEN 'PG'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'NON-GUARANTEED' THEN 'OMP'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'PMP' THEN 'PMP'\n        WHEN (CASE WHEN t0.unified_publication_name = 'Run of Audience Extension' THEN 'Y' ELSE 'N' END) = 'Y' THEN 'PERFORMANCE'\n        ELSE NULL\n      END AS channel_type,\n      UPPER(SAFE_CAST(t0.revenue_group_subtype AS STRING)) = 'PROGRAMMATIC SOURCE' AS is_programmatic_source,\n      DATE(TIMESTAMP '2025-06-18 03:06:41.434326+00', 'Australia/Sydney') AS hardcoded_q2_date\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n    WHERE\n      -- Apply a reasonable date filter for performance, as original queries don't have a broad one\n      t0.reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) -- Example: last 2 years of data\n  )\nSELECT\n  financial_short_month,\n  financial_quarter,\n  financial_month,\n  relative_fy_month_offset,\n  channel_type,\n  cost_model_type,\n  -- Total Gross Revenue (across all filters)\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  -- Query 1 related metrics (filtered by financial_quarter = 2)\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = -1\n      AND financial_quarter = 2 THEN CASE\n        WHEN channel_type = 'PERFORMANCE'\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS prev_fy_performance_or_programmatic_revenue_q2,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND financial_quarter = 2 THEN CASE\n        WHEN channel_type = 'PMP'\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_pmp_revenue_q2,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND financial_quarter = 2 THEN CASE\n        WHEN channel_type = 'PERFORMANCE'\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_performance_or_programmatic_revenue_q2,\n  -- Query 2 related metrics (filtered by relative_fy_year_offset = 0)\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0 THEN CASE\n        WHEN channel_type IN ('TUBI', 'PERFORMANCE')\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_tubi_performance_programmatic_revenue,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND reporting_date < hardcoded_q2_date THEN CASE\n        WHEN channel_type IN ('TUBI', 'PERFORMANCE')\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_tubi_performance_programmatic_revenue_before_hardcoded_date,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND reporting_date < hardcoded_q2_date\n      AND UPPER(cost_model_type) = 'GUARANTEED' THEN CASE\n        WHEN channel_type IN ('TUBI', 'PERFORMANCE')\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_guaranteed_revenue_before_hardcoded_date,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND reporting_date < hardcoded_q2_date\n      AND UPPER(cost_model_type) = 'PMP' THEN CASE\n        WHEN channel_type IN ('TUBI', 'PERFORMANCE')\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_pmp_revenue_before_hardcoded_date,\n  SUM(\n    CASE\n      WHEN relative_fy_year_offset = 0\n      AND reporting_date < hardcoded_q2_date\n      AND UPPER(cost_model_type) = 'NON-GUARANTEED' THEN CASE\n        WHEN channel_type IN ('TUBI', 'PERFORMANCE')\n        OR is_programmatic_source THEN gross_revenue_amount\n        ELSE NULL\n      END\n      ELSE NULL\n    END\n  ) AS current_fy_nonguaranteed_revenue_before_hardcoded_date\nFROM\n  base_data\nGROUP BY\n  financial_short_month,\n  financial_quarter,\n  financial_month,\n  relative_fy_month_offset,\n  channel_type,\n  cost_model_type\nORDER BY\n  financial_quarter ASC, financial_month ASC\nLIMIT\n  10000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.reporting_date) AS unique_reporting_dates,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_month AS INT64)) AS unique_financial_months,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_quarter AS INT64)) AS unique_financial_quarters,\n  COUNT(DISTINCT t0.cost_model_type) AS unique_cost_model_types,\n  COUNT(DISTINCT t0.revenue_group_subtype) AS unique_revenue_group_subtypes,\n  COUNT(DISTINCT t0.unified_publication_name) AS unique_unified_publication_names,\n  MIN(t0.reporting_date) AS earliest_reporting_date,\n  MAX(t0.reporting_date) AS latest_reporting_date,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_count\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS total_revenue_positive_test,\n  CASE\n    WHEN COUNT(DISTINCT t0.reporting_date) > 0\n    AND MAX(t0.reporting_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS data_freshness_test,\n  CASE\n    WHEN COUNT(DISTINCT CASE WHEN t0.relative_fy_year_offset = 0 THEN t0.reporting_date ELSE NULL END) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS current_fy_data_exists_test,\n  CASE\n    WHEN COUNT(DISTINCT CASE WHEN t0.unified_publication_name = 'TUBI' THEN t0.reporting_date ELSE NULL END) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS tubi_data_exists_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  derived_data AS (\n    SELECT\n      t0.unified_publication_name,\n      UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) AS cost_model_type_upper,\n      CASE\n        WHEN t0.unified_publication_name = 'Run of Audience Extension' THEN 'Y'\n        ELSE 'N'\n      END AS is_audience_extension_flag,\n      CASE\n        WHEN t0.unified_publication_name = 'TUBI' THEN 'TUBI'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'GUARANTEED' THEN 'PG'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'NON-GUARANTEED' THEN 'OMP'\n        WHEN UPPER(SAFE_CAST(t0.cost_model_type AS STRING)) = 'PMP' THEN 'PMP'\n        WHEN (CASE WHEN t0.unified_publication_name = 'Run of Audience Extension' THEN 'Y' ELSE 'N' END) = 'Y' THEN 'PERFORMANCE'\n        ELSE NULL\n      END AS derived_channel_type\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n    WHERE\n      t0.reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Channel Type Derivation' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(\n    CASE\n      WHEN derived_channel_type IS NOT NULL THEN 1\n      ELSE 0\n    END\n  ) AS records_with_channel_type,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN derived_channel_type IS NOT NULL THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS channel_type_assignment_rate_percentage,\n  COUNT(DISTINCT derived_channel_type) AS distinct_channel_types_derived,\n  ARRAY_AGG(DISTINCT derived_channel_type IGNORE NULLS) AS derived_channel_type_values,\n  ARRAY_AGG(DISTINCT unified_publication_name IGNORE NULLS) AS source_unified_publication_names,\n  ARRAY_AGG(DISTINCT cost_model_type_upper IGNORE NULLS) AS source_cost_model_types\nFROM\n  derived_data\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.reporting_date,\n  t0.financial_short_month,\n  SAFE_CAST(t0.financial_quarter AS INT64) AS financial_quarter,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  SAFE_CAST(t0.relative_fy_year_offset AS INT64) AS relative_fy_year_offset,\n  t0.cost_model_type,\n  t0.revenue_group_subtype,\n  t0.unified_publication_name\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY\n  t0.reporting_date DESC, t0.gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-06-18"",
          ""original_format"": ""DATE(TIMESTAMP '2025-06-18 03:06:41.434326+00', 'Australia/Sydney')"",
          ""context"": ""Used as a cut-off date for 'before hardcoded date' revenue calculations in Query 2, likely representing a specific reporting period or forecast end date."",
          ""suggested_fix"": ""Replace with a Looker Studio date parameter (e.g., `{{_DS_END_DATE}}` or a custom parameter) or a relative date function like `CURRENT_DATE()` if it's meant to be dynamic."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'TUBI'"",
            ""'PG'"",
            ""'OMP'"",
            ""'PMP'"",
            ""'PERFORMANCE'""
          ],
          ""context"": ""Used in CASE statements to derive 'Channel Type' based on `unified_publication_name` and `cost_model_type`."",
          ""suggested_governance"": ""Create a `dim_channel_type` reference table with `unified_publication_name`, `cost_model_type`, `is_audience_extension_flag` and the corresponding `channel_type`. Join to this dimension table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PROGRAMMATIC SOURCE'""
          ],
          ""context"": ""Used to identify programmatic revenue based on `revenue_group_subtype`."",
          ""suggested_governance"": ""Manage `revenue_group_subtype` values in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""-1""
          ],
          ""context"": ""Used to identify 'Current FY' (`relative_fy_year_offset = 0`) and 'Previous FY' (`relative_fy_year_offset = -1`)."",
          ""suggested_governance"": ""While common, these could be defined as named constants or derived in a `dim_fiscal_period` table for clarity and consistency."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""2""
          ],
          ""context"": ""Used to filter for a specific `financial_quarter` (Q2) in Query 1."",
          ""suggested_governance"": ""If this quarter changes, it should be a parameter or derived from a fiscal calendar table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-06-18') with Looker Studio date range parameters or custom date parameters to allow dynamic reporting periods."",
      ""Replace hardcoded lookup values (e.g., 'TUBI', 'PMP', 'PROGRAMMATIC SOURCE') with joins to governed reference tables for maintainability and data consistency."",
      ""Consider externalizing complex business logic (like 'Channel Type' derivation) into a dedicated view or a configuration table if it's subject to frequent changes.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount from the financial details table."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""channel_type"",
      ""metric_name"": ""Channel Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""unified_publication_name"",
        ""cost_model_type"",
        ""is_audience_extension_flag""
      ],
      ""business_description"": ""Categorization of revenue based on publication name, cost model, or audience extension status (e.g., TUBI, PG, OMP, PMP, PERFORMANCE)."",
      ""sql_logic"": ""CASE WHEN unified_publication_name = 'TUBI' THEN 'TUBI' WHEN UPPER(cost_model_type) = 'GUARANTEED' THEN 'PG' WHEN UPPER(cost_model_type) = 'NON-GUARANTEED' THEN 'OMP' WHEN UPPER(cost_model_type) = 'PMP' THEN 'PMP' WHEN is_audience_extension_flag = 'Y' THEN 'PERFORMANCE' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue performance by channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'PG'"",
        ""'OMP'"",
        ""'PMP'"",
        ""'PERFORMANCE'"",
        ""'GUARANTEED'"",
        ""'NON-GUARANTEED'"",
        ""'Y'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls if no match""
      ]
    },
    {
      ""metric_id"": ""is_programmatic_source"",
      ""metric_name"": ""Is Programmatic Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""revenue_group_subtype""
      ],
      ""business_description"": ""Flag indicating if the revenue source is 'PROGRAMMATIC SOURCE'."",
      ""sql_logic"": ""UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to differentiate programmatic revenue from other types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_performance_or_programmatic"",
      ""metric_name"": ""Gross Revenue (Performance or Programmatic)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""channel_type"",
        ""is_programmatic_source""
      ],
      ""business_description"": ""Gross revenue specifically for 'PERFORMANCE' channel or 'PROGRAMMATIC SOURCE'."",
      ""sql_logic"": ""CASE WHEN channel_type = 'PERFORMANCE' THEN gross_revenue_amount ELSE (CASE WHEN is_programmatic_source THEN gross_revenue_amount ELSE NULL END) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate metric used for various aggregated revenue figures in Query 1."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_tubi_performance_or_programmatic"",
      ""metric_name"": ""Gross Revenue (Tubi, Performance or Programmatic)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""channel_type"",
        ""is_programmatic_source""
      ],
      ""business_description"": ""Gross revenue specifically for 'TUBI' or 'PERFORMANCE' channels or 'PROGRAMMATIC SOURCE'."",
      ""sql_logic"": ""CASE WHEN channel_type IN ('TUBI', 'PERFORMANCE') THEN gross_revenue_amount ELSE (CASE WHEN is_programmatic_source THEN gross_revenue_amount ELSE NULL END) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate metric used for various aggregated revenue figures in Query 2."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prev_fy_performance_or_programmatic_revenue_q2"",
      ""metric_name"": ""Previous FY Performance/Programmatic Revenue (Q2)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""financial_quarter""
      ],
      ""business_description"": ""Sum of gross revenue from Performance channel or Programmatic Source for the previous financial year, specifically for financial quarter 2."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = -1 AND financial_quarter = 2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""financial_quarter = 2""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparison of specific revenue streams in Q2."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""2""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_pmp_revenue_q2"",
      ""metric_name"": ""Current FY PMP Revenue (Q2)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""financial_quarter"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from PMP channel for the current financial year, specifically for financial quarter 2."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND financial_quarter = 2 AND channel_type = 'PMP'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""financial_quarter = 2"",
        ""channel_type = 'PMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks current year PMP performance in Q2."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""2"",
        ""'PMP'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_performance_or_programmatic_revenue_q2"",
      ""metric_name"": ""Current FY Performance/Programmatic Revenue (Q2)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""financial_quarter""
      ],
      ""business_description"": ""Sum of gross revenue from Performance channel or Programmatic Source for the current financial year, specifically for financial quarter 2."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND financial_quarter = 2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""financial_quarter = 2""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall current year performance for key revenue streams in Q2."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""2""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_tubi_performance_programmatic_revenue"",
      ""metric_name"": ""Current FY Tubi/Performance/Programmatic Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_tubi_performance_or_programmatic"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Sum of gross revenue from Tubi, Performance channels or Programmatic Source for the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for overall current FY performance of Tubi, Performance, and Programmatic revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_tubi_performance_programmatic_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY Tubi/Performance/Programmatic Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_tubi_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date""
      ],
      ""business_description"": ""Sum of gross revenue from Tubi, Performance channels or Programmatic Source for the current financial year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for specific period analysis or forecasting against a fixed point in the current FY."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_guaranteed_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY Guaranteed Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_tubi_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date"",
        ""cost_model_type""
      ],
      ""business_description"": ""Sum of gross revenue from Tubi, Performance channels or Programmatic Source for the current financial year, up to 2025-06-18, specifically for 'GUARANTEED' cost model type."",
      ""sql_logic"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18' AND UPPER(cost_model_type) = 'GUARANTEED'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'GUARANTEED'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Detailed breakdown of current FY revenue by cost model type for a specific period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'GUARANTEED'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_pmp_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY PMP Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_tubi_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date"",
        ""cost_model_type""
      ],
      ""business_description"": ""Sum of gross revenue from Tubi, Performance channels or Programmatic Source for the current financial year, up to 2025-06-18, specifically for 'PMP' cost model type."",
      ""sql_logic"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18' AND UPPER(cost_model_type) = 'PMP'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'PMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Detailed breakdown of current FY revenue by cost model type for a specific period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'PMP'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_nonguaranteed_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY Non-Guaranteed Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_tubi_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date"",
        ""cost_model_type""
      ],
      ""business_description"": ""Sum of gross revenue from Tubi, Performance channels or Programmatic Source for the current financial year, up to 2025-06-18, specifically for 'NON-GUARANTEED' cost model type."",
      ""sql_logic"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18' AND UPPER(cost_model_type) = 'NON-GUARANTEED'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'NON-GUARANTEED'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Detailed breakdown of current FY revenue by cost model type for a specific period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'NON-GUARANTEED'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Short name of the financial month (e.g., 'Jan', 'Feb')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for monthly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Numeric representation of the financial quarter (e.g., 1, 2, 3, 4)."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Time dimension for quarterly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Numeric representation of the financial month (e.g., 1, 2, ..., 12)."",
      ""sql_logic"": ""t0.financial_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Detailed time dimension for monthly reporting, often used for ordering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_month_offset"",
      ""metric_name"": ""Relative FY Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial month relative to the current financial year's start month."",
      ""sql_logic"": ""t0.relative_fy_month_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for relative period comparisons within a financial year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount""
      ],
      ""business_description"": ""The sum of all gross revenue amounts."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_tubi_revenue"",
      ""metric_name"": ""Current FY Tubi Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue for 'TUBI' channel in the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_amount) WHERE relative_fy_year_offset = 0 AND channel_type = 'TUBI'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""channel_type = 'TUBI'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific revenue performance for the Tubi channel in the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'TUBI'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_performance_revenue"",
      ""metric_name"": ""Current FY Performance Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue for 'PERFORMANCE' channel in the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_amount) WHERE relative_fy_year_offset = 0 AND channel_type = 'PERFORMANCE'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""channel_type = 'PERFORMANCE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific revenue performance for the Performance channel in the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_tubi_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY Tubi Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue for 'TUBI' channel in the current financial year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(gross_revenue_amount) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18' AND channel_type = 'TUBI'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""channel_type = 'TUBI'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific Tubi revenue performance for a fixed period in the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'TUBI'""
      ],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_performance_revenue_before_hardcoded_date"",
      ""metric_name"": ""Current FY Performance Revenue (Before 2025-06-18)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""reporting_date"",
        ""hardcoded_q2_date"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue for 'PERFORMANCE' channel in the current financial year, up to the hardcoded date of 2025-06-18."",
      ""sql_logic"": ""SUM(gross_revenue_amount) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18' AND channel_type = 'PERFORMANCE'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""channel_type = 'PERFORMANCE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific Performance revenue performance for a fixed period in the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025-06-18""
      ],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'PERFORMANCE'""
      ],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prev_fy_total_revenue"",
      ""metric_name"": ""Previous FY Total Revenue (Performance/Programmatic)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue from Performance channel or Programmatic Source for the previous financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = -1"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall previous year performance for key revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_total_revenue"",
      ""metric_name"": ""Current FY Total Revenue (Performance/Programmatic)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Total gross revenue from Performance channel or Programmatic Source for the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = 0"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall current year performance for key revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prev_fy_omp_revenue"",
      ""metric_name"": ""Previous FY OMP Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from OMP channel for the previous financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = -1 AND channel_type = 'OMP'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""channel_type = 'OMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks previous year OMP performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'OMP'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_omp_revenue"",
      ""metric_name"": ""Current FY OMP Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from OMP channel for the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND channel_type = 'OMP'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""channel_type = 'OMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks current year OMP performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'OMP'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prev_fy_pg_revenue"",
      ""metric_name"": ""Previous FY PG Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from PG channel for the previous financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = -1 AND channel_type = 'PG'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""channel_type = 'PG'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks previous year PG performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'PG'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_pg_revenue"",
      ""metric_name"": ""Current FY PG Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from PG channel for the current financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND channel_type = 'PG'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""channel_type = 'PG'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks current year PG performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""'PG'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prev_fy_pmp_revenue"",
      ""metric_name"": ""Previous FY PMP Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_performance_or_programmatic"",
        ""relative_fy_year_offset"",
        ""channel_type""
      ],
      ""business_description"": ""Sum of gross revenue from PMP channel for the previous financial year."",
      ""sql_logic"": ""SUM(gross_revenue_performance_or_programmatic) WHERE relative_fy_year_offset = -1 AND channel_type = 'PMP'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""channel_type = 'PMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks previous year PMP performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1"",
        ""'PMP'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_performance_or_programmatic"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""channel_type"",
        ""is_programmatic_source""
      ],
      ""relationship_description"": ""This metric is a conditional selection of `gross_revenue_amount` based on whether the `channel_type` is 'PERFORMANCE' or if it's identified as a 'PROGRAMMATIC SOURCE'."",
      ""mathematical_formula"": ""IF channel_type = 'PERFORMANCE' THEN gross_revenue_amount ELSE (IF is_programmatic_source THEN gross_revenue_amount ELSE NULL)"",
      ""business_validation"": ""Ensures that only relevant revenue streams are included for programmatic and performance reporting."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN channel_type = 'PERFORMANCE' THEN gross_revenue_amount ELSE (CASE WHEN is_programmatic_source THEN gross_revenue_amount ELSE NULL END) END) FROM base_data WHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_tubi_performance_or_programmatic"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""channel_type"",
        ""is_programmatic_source""
      ],
      ""relationship_description"": ""This metric is a conditional selection of `gross_revenue_amount` based on whether the `channel_type` is 'TUBI' or 'PERFORMANCE' or if it's identified as a 'PROGRAMMATIC SOURCE'."",
      ""mathematical_formula"": ""IF channel_type IN ('TUBI', 'PERFORMANCE') THEN gross_revenue_amount ELSE (IF is_programmatic_source THEN gross_revenue_amount ELSE NULL)"",
      ""business_validation"": ""Ensures that revenue from Tubi, Performance, and Programmatic sources are grouped for specific reporting needs."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN channel_type IN ('TUBI', 'PERFORMANCE') THEN gross_revenue_amount ELSE (CASE WHEN is_programmatic_source THEN gross_revenue_amount ELSE NULL END) END) FROM base_data WHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_tubi_performance_programmatic_revenue_before_hardcoded_date"",
      ""related_metrics"": [
        ""current_fy_tubi_performance_programmatic_revenue""
      ],
      ""relationship_description"": ""This metric is a subset of `current_fy_tubi_performance_programmatic_revenue`, further filtered by a hardcoded date (`reporting_date < '2025-06-18'`). This suggests a specific reporting cut-off or a comparison against a fixed target date."",
      ""mathematical_formula"": ""SUM(gross_revenue_tubi_performance_or_programmatic) WHERE relative_fy_year_offset = 0 AND reporting_date < '2025-06-18'"",
      ""business_validation"": ""Highlights the importance of the hardcoded date for specific period analysis. This relationship should be dynamic (parameterized date) for future use."",
      ""validation_sql"": ""SELECT SUM(current_fy_tubi_performance_programmatic_revenue_before_hardcoded_date) <= SUM(current_fy_tubi_performance_programmatic_revenue) FROM primary_analysis_sql_output"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""current_fy_total_revenue"",
        ""prev_fy_total_revenue"",
        ""current_fy_tubi_revenue"",
        ""current_fy_performance_revenue"",
        ""current_fy_pmp_revenue"",
        ""current_fy_pg_revenue"",
        ""current_fy_omp_revenue""
      ],
      ""relationship_description"": ""Total Gross Revenue is the highest-level aggregation. Other revenue metrics represent subsets or specific segments (e.g., current/previous FY, specific channels) of this total."",
      ""mathematical_formula"": ""total_gross_revenue = SUM(all segments)"",
      ""business_validation"": ""Ensures that segmented revenue figures roll up correctly to the overall total, providing a consistent view of financial performance."",
      ""validation_sql"": ""SELECT SUM(total_gross_revenue) FROM primary_analysis_sql_output"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,34
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52c11c9c-052a-4e45-9cda-8fecd87d7964"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)(with Pluto Reporting Date)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily;ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_month"",
      ""ad_type_grouping_dimension"",
      ""revenue_type"",
      ""advertiser_parent"",
      ""sales_segment_l_2_name_sync"",
      ""unified_publication_name"",
      ""cost_model_type"",
      ""publishing_division"",
      ""GSD""
    ],
    ""date_range_detected"": ""Current FY, Previous FY, Next FY (financial); Current CY, Previous CY (calendar)"",
    ""hardcoded_dates_found"": [
      ""2025-05-08""
    ],
    ""hardcoded_values_found"": [
      ""'$'000' = '$'"",
      ""relative_fy_year_offset IN (-1, 0, 1)"",
      ""relative_cal_year_offset IN (-1, 0)"",
      ""revenue_transaction_status_code IN ('BILLED', 'BOOKED')"",
      ""style_name <> 'ROP COMPOSITE'"",
      ""source_publishing_division_name <> 'MEDIUM RARE CONTENT AGENCY'"",
      ""publication_name LIKE 'SUDDENLY%'"",
      ""advertiser_id_src IN ('17114', '29172', '52809')"",
      ""ad_type_name = '-'"",
      ""advertiser_parent = 'DOUBLECLICK'"",
      ""dw_source_system_code = 'PLUTO'"",
      ""ad_type_name = 'XTEND'"",
      ""portfolio_parent_group_name_sync = 'DIGITAL OTHER'"",
      ""revenue_group_subtype = 'DIGITAL'"",
      ""revenue_group_subtype = 'PROGRAMMATIC SOURCE'"",
      ""cost_model_type_code IN ('GUA', 'NON', 'PMP')"",
      ""revenue_type_code = 'DIGITAL'"",
      ""sales_segment_l2_name = 'Digital Other'"",
      ""unified_publication_name IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')"",
      ""sync_sales_segment_l2_name = 'MRCA'"",
      ""owner_names = 'VACANT'"",
      ""revenue_type_code = 'PRINT'"",
      ""revenue_type_code = 'XTEND'"",
      ""1000 (division factor)""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use CURRENT_DATE() for dynamic reporting periods."",
      ""Lookup values for ad types, revenue types, publication names, and advertiser IDs should be managed in governed reference tables."",
      ""Business rules for revenue classification (e.g., Programmatic, Sundry) should be externalized or documented clearly."",
      ""The '$'000' display preference should be a dashboard parameter, not hardcoded in SQL.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\nWITH\n  base_data_cte AS (\n    SELECT\n      ad_type_name AS adtype_name,\n      is_xtend_flag AS xtend_flag,\n      unified_publication_name,\n      unified_publication_gl_code,\n      CASE\n        WHEN unified_publication_name IN ('Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales',\n          'Admin.Sport', 'Admin.TCM', 'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin',\n          'Escape.Admin', 'GQ.Admin', 'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin',\n          'odds.com.au', 'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n          'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin',\n          'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin') THEN 'Sundry Pubs'\n        ELSE 'Non Sundry Pubs'\n      END AS Sundry_Pubs_Flag,\n      fy_year_month_number,\n      CAST(RIGHT(CAST(fy_year_month_number AS STRING), 2) AS INT64) AS fiscal_month_number,\n      fy_year AS financial_year,\n      fy_quarter_of_year AS financial_quarter,\n      fy_month_of_year AS financial_month,\n      fy_month_short_name AS financial_short_month,\n      fy_week_of_year AS financial_week,\n      revenue_transaction_status_code AS revenue_transaction_status,\n      is_print_digital_flag,\n      current_fy_month_of_year AS current_financial_month,\n      current_fy_week_of_year AS current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(ASL.fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sync_sales_segment_l2_name = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE('Australia/Sydney')) AS DOW_Today,\n      sales_segment_l1_name AS sales_segment_l_1_name,\n      sales_segment_l2_name AS sales_segment_l_2_name,\n      sync_sales_segment_l1_name AS sales_segment_l_1_name_sync,\n      sync_sales_segment_l2_name AS sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      customer_group_name AS advertiser_group,\n      customer_group_parent_name AS advertiser_parent,\n      IFNULL(adjustment_amount, 0) AS adjustment_amount,\n      curr_sales_segment_gm_name AS sales_segment_gm_name,\n      sync_sales_segment_gm_name AS sales_segment_gm_name_sync,\n      revenue_group_level1_name AS revenue_group_level_1_name,\n      revenue_group_level2_name AS revenue_group_level_2_name,\n      IFNULL(lgb_pub_amount, 0) AS pub_lgb,\n      IFNULL(lgb_ss_amount, 0) AS ss_lgb,\n      IFNULL(pipeline_amount, 0) AS pipeline,\n      IFNULL(gross_revenue_amount, 0) AS gross_revenue_amount,\n      UPPER(revenue_group_type_code) AS revenue_type,\n      UPPER(revenue_type_level2_code) AS revenue_type_Level2,\n      UPPER(ASL.revenue_group_sub_type_code) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      sync_portfolio_group_name AS portfolio_group_name_sync,\n      current_portfolio_group_name AS portfolio_group_name_current,\n      sync_portfolio_parent_group_name AS portfolio_parent_group_name_sync,\n      industry_level1_name AS aszsic_industry_level_1_name,\n      industry_level1_code AS anzsic_industry_level_1_code,\n      industry_level2_code AS anzsic_industry_level_2_code,\n      industry_level2_name AS aszsic_industry_level_2_name,\n      industry_level3_code AS anzsic_industry_level_3_code,\n      industry_level3_name AS anzsic_industry_level_3_name,\n      industry_level4_code AS anzsic_industry_level_4_code,\n      industry_level4_name AS anzsic_industry_level_4_name,\n      industry_pillar_name AS nca_industry_pillar,\n      industry_pillar_group_name AS nca_industry_anzsic_pillar_group,\n      ASL.product_group_name AS product_group,\n      division_group_name AS publishing_division_group,\n      division_parent_group_name AS publishing_division_parent,\n      CASE\n        WHEN client_reporting_date >= CURRENT_DATE('Australia/Sydney') THEN 'Y'\n        ELSE 'N'\n      END AS is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ly_is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ny_is_future_period_flag,\n      cost_model_type_code AS cost_model_type,\n      CASE\n        WHEN dw_source_system_code = 'PLUTO' THEN SAFE_CAST(client_reporting_date AS STRING)\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      sync_portfolio_conformed_name AS portfolio_conformed_name_sync,\n      publishing_division_name AS publishing_division,\n      booking_line_created_week_of_year AS booking_line_created_week,\n      booking_line_created_month_of_year AS booking_line_created_month,\n      booking_line_created_month_short_name AS booking_line_created_short_month,\n      booking_line_created_quarter_of_year AS booking_line_created_quarter,\n      booking_line_created_year,\n      agency_group_parent_name AS agency_parent,\n      agency_group_name AS agency_group,\n      agency_name,\n      agency_id_src AS agency_number,\n      cal_month_name AS calendar_month_name,\n      cal_year AS calendar_year,\n      section_l5_name AS classification_name,\n      IFNULL(target_amount, 0) AS target,\n      IFNULL(current_portfolio_group_owner_full_name_sync, 'VACANT') AS GSD,\n      IFNULL(current_portfolio_group_owner_full_name_current, 'VACANT') AS current_portfolio_group_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS portfolio_full_name_sync,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS sync_portfolio_conformed_owner_full,\n      current_portfolio_conformed_owner_current,\n      current_portfolio_group_owner_current,\n      adtype_l1,\n      adtype_l2,\n      legacy_growth_flag,\n      relative_cal_year_offset,\n      cal_quarter_of_year_name AS calendar_quarter_of_year,\n      cal_year_week_number AS calendar_week\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\n    WHERE\n      (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0))\n      AND UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')\n      AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'\n      AND UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n      AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))\n  ),\n  final_data AS (\n    SELECT\n      *,\n      MIN(\n        CASE\n          WHEN advertiser_parent = 'DOUBLECLICK' THEN SAFE_CAST(booking_line_created_date AS DATE)\n        END) OVER (PARTITION BY financial_year) AS fix_date_lod,\n      DATETIME(TIMESTAMP(CURRENT_TIMESTAMP()), 'Australia/Sydney') AS dw_asl_load_timestamp,\n      -- Derived Ad Type Grouping Dimension (unified logic)\n      CASE\n        WHEN fin_adtype_name = 'XTEND' THEN 'XTEND'\n        WHEN portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL' THEN 'PROGRAMMATIC - DIGITAL OTHER'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'GUA' THEN 'PROGRAMMATIC - GUARANTEED'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'NON' THEN 'PROGRAMMATIC - OPEN EXCHANGE'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'PMP' THEN 'PROGRAMMATIC - PMP'\n        WHEN revenue_group_subtype = 'DIGITAL' THEN 'ADPT DIGITAL'\n        WHEN SAFE.LEFT(revenue_group_subtype, 6) = 'SUNDRY' THEN 'SUNDRY'\n        ELSE revenue_group_subtype\n      END AS ad_type_grouping_dimension,\n      -- Derived Revenue Type ID for Ad Type Count/Sum (Q2 logic)\n      CASE\n        WHEN (FALSE = TRUE) THEN NULL -- This condition is always false, so programmatic_type_id is never used here\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PRINT' THEN 1\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'DIGITAL' THEN 2\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC' THEN 3\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC EXCHANGE' THEN 4\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC SOURCE' THEN 5\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'SUNDRY ADSALES OVERLAY' THEN 6\n        ELSE NULL\n      END AS ad_type_id_q2_logic,\n      -- Conditional Gross Revenue (raw) for Q2/Q3 logic\n      CASE\n        WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE'))\n          OR (relative_fy_year_offset = 0 AND SAFE_CAST(booking_line_created_date AS DATETIME) <= DATETIME_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) AND UPPER(advertiser_parent) = 'DOUBLECLICK')\n        THEN gross_revenue_amount\n        ELSE 0\n      END AS conditional_gross_revenue_raw\n    FROM\n      base_data_cte\n  )\nSELECT\n  ad_type_grouping_dimension,\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_short_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_quarter_of_year,\n  calendar_week,\n  revenue_transaction_status,\n  is_print_digital_flag,\n  fin_adtype_name,\n  Sales_Group,\n  sales_segment_l_1_name,\n  sales_segment_l_2_name,\n  advertiser_group,\n  advertiser_parent,\n  revenue_type,\n  revenue_type_Level2,\n  revenue_group_subtype,\n  cost_model_type,\n  publishing_division,\n  GSD,\n  Sundry_Pubs_Flag,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(adjustment_amount) AS total_adjustment_amount,\n  SUM(pub_lgb) AS total_pub_lgb,\n  SUM(ss_lgb) AS total_ss_lgb,\n  SUM(pipeline) AS total_pipeline,\n  SUM(target) AS total_target,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue_raw,\n  SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) AS previous_fy_gross_revenue_raw,\n  SAFE_DIVIDE(SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END), 1000) AS current_fy_gross_revenue_k,\n  SAFE_DIVIDE(SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END), 1000) AS previous_fy_gross_revenue_k,\n  SAFE_DIVIDE(SUM(conditional_gross_revenue_raw), 1000) AS conditional_gross_revenue_k,\n  COUNT(ad_type_id_q2_logic) AS ad_type_id_count,\n  SUM(ad_type_id_q2_logic) AS ad_type_id_sum\nFROM\n  final_data\nWHERE\n  -- Apply a reasonable date filter for performance, e.g., last 2 years\n  financial_year >= EXTRACT(YEAR FROM CURRENT_DATE('Australia/Sydney')) - 1\nGROUP BY\n  ad_type_grouping_dimension,\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_short_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_quarter_of_year,\n  calendar_week,\n  revenue_transaction_status,\n  is_print_digital_flag,\n  fin_adtype_name,\n  Sales_Group,\n  sales_segment_l_1_name,\n  sales_segment_l_2_name,\n  advertiser_group,\n  advertiser_parent,\n  revenue_type,\n  revenue_type_Level2,\n  revenue_group_subtype,\n  cost_model_type,\n  publishing_division,\n  GSD,\n  Sundry_Pubs_Flag\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 10000"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(ASL.client_reporting_date AS DATE)) AS unique_client_reporting_dates,\n  COUNT(DISTINCT ASL.advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT ASL.unified_publication_name) AS unique_publications,\n  COUNT(DISTINCT ASL.fin_adtype_name) AS unique_fin_adtypes,\n  MIN(SAFE_CAST(ASL.client_reporting_date AS DATE)) AS earliest_client_reporting_date,\n  MAX(SAFE_CAST(ASL.client_reporting_date AS DATE)) AS latest_client_reporting_date,\n  MIN(SAFE_CAST(ASL.booking_line_created_date AS DATE)) AS earliest_booking_date,\n  MAX(SAFE_CAST(ASL.booking_line_created_date AS DATE)) AS latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(ASL.client_reporting_date AS STRING), ASL.advertiser_id_src, SAFE_CAST(ASL.booking_line_id_src AS STRING))) AS approx_unique_transaction_keys\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\nWHERE\n  SAFE_CAST(ASL.client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 * 2 DAY) -- Sample last 2 years\nLIMIT 100000"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and provide reasonable values\nWITH\n  base_data_cte AS (\n    SELECT\n      ad_type_name AS adtype_name,\n      is_xtend_flag AS xtend_flag,\n      unified_publication_name,\n      unified_publication_gl_code,\n      CASE\n        WHEN unified_publication_name IN ('Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales',\n          'Admin.Sport', 'Admin.TCM', 'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin',\n          'Escape.Admin', 'GQ.Admin', 'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin',\n          'odds.com.au', 'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n          'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin',\n          'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin') THEN 'Sundry Pubs'\n        ELSE 'Non Sundry Pubs'\n      END AS Sundry_Pubs_Flag,\n      fy_year_month_number,\n      CAST(RIGHT(CAST(fy_year_month_number AS STRING), 2) AS INT64) AS fiscal_month_number,\n      fy_year AS financial_year,\n      fy_quarter_of_year AS financial_quarter,\n      fy_month_of_year AS financial_month,\n      fy_month_short_name AS financial_short_month,\n      fy_week_of_year AS financial_week,\n      revenue_transaction_status_code AS revenue_transaction_status,\n      is_print_digital_flag,\n      current_fy_month_of_year AS current_financial_month,\n      current_fy_week_of_year AS current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(ASL.fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sync_sales_segment_l2_name = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE('Australia/Sydney')) AS DOW_Today,\n      sales_segment_l1_name AS sales_segment_l_1_name,\n      sales_segment_l2_name AS sales_segment_l_2_name,\n      sync_sales_segment_l1_name AS sales_segment_l_1_name_sync,\n      sync_sales_segment_l2_name AS sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      customer_group_name AS advertiser_group,\n      customer_group_parent_name AS advertiser_parent,\n      IFNULL(adjustment_amount, 0) AS adjustment_amount,\n      curr_sales_segment_gm_name AS sales_segment_gm_name,\n      sync_sales_segment_gm_name AS sales_segment_gm_name_sync,\n      revenue_group_level1_name AS revenue_group_level_1_name,\n      revenue_group_level2_name AS revenue_group_level_2_name,\n      IFNULL(lgb_pub_amount, 0) AS pub_lgb,\n      IFNULL(lgb_ss_amount, 0) AS ss_lgb,\n      IFNULL(pipeline_amount, 0) AS pipeline,\n      IFNULL(gross_revenue_amount, 0) AS gross_revenue_amount,\n      UPPER(revenue_group_type_code) AS revenue_type,\n      UPPER(revenue_type_level2_code) AS revenue_type_Level2,\n      UPPER(ASL.revenue_group_sub_type_code) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      sync_portfolio_group_name AS portfolio_group_name_sync,\n      current_portfolio_group_name AS portfolio_group_name_current,\n      sync_portfolio_parent_group_name AS portfolio_parent_group_name_sync,\n      industry_level1_name AS aszsic_industry_level_1_name,\n      industry_level1_code AS anzsic_industry_level_1_code,\n      industry_level2_code AS anzsic_industry_level_2_code,\n      industry_level2_name AS aszsic_industry_level_2_name,\n      industry_level3_code AS anzsic_industry_level_3_code,\n      industry_level3_name AS anzsic_industry_level_3_name,\n      industry_level4_code AS anzsic_industry_level_4_code,\n      industry_level4_name AS anzsic_industry_level_4_name,\n      industry_pillar_name AS nca_industry_pillar,\n      industry_pillar_group_name AS nca_industry_anzsic_pillar_group,\n      ASL.product_group_name AS product_group,\n      division_group_name AS publishing_division_group,\n      division_parent_group_name AS publishing_division_parent,\n      CASE\n        WHEN client_reporting_date >= CURRENT_DATE('Australia/Sydney') THEN 'Y'\n        ELSE 'N'\n      END AS is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ly_is_future_period_flag,\n      CASE\n        WHEN client_reporting_date >= DATE_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL 365 DAY) THEN 'Y'\n        ELSE 'N'\n      END AS ny_is_future_period_flag,\n      cost_model_type_code AS cost_model_type,\n      CASE\n        WHEN dw_source_system_code = 'PLUTO' THEN SAFE_CAST(client_reporting_date AS STRING)\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      sync_portfolio_conformed_name AS portfolio_conformed_name_sync,\n      publishing_division_name AS publishing_division,\n      booking_line_created_week_of_year AS booking_line_created_week,\n      booking_line_created_month_of_year AS booking_line_created_month,\n      booking_line_created_month_short_name AS booking_line_created_short_month,\n      booking_line_created_quarter_of_year AS booking_line_created_quarter,\n      booking_line_created_year,\n      agency_group_parent_name AS agency_parent,\n      agency_group_name AS agency_group,\n      agency_name,\n      agency_id_src AS agency_number,\n      cal_month_name AS calendar_month_name,\n      cal_year AS calendar_year,\n      section_l5_name AS classification_name,\n      IFNULL(target_amount, 0) AS target,\n      IFNULL(current_portfolio_group_owner_full_name_sync, 'VACANT') AS GSD,\n      IFNULL(current_portfolio_group_owner_full_name_current, 'VACANT') AS current_portfolio_group_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS portfolio_full_name_sync,\n      IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS sync_portfolio_conformed_owner_full,\n      current_portfolio_conformed_owner_current,\n      current_portfolio_group_owner_current,\n      adtype_l1,\n      adtype_l2,\n      legacy_growth_flag,\n      relative_cal_year_offset,\n      cal_quarter_of_year_name AS calendar_quarter_of_year,\n      cal_year_week_number AS calendar_week\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\n    WHERE\n      (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0))\n      AND UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')\n      AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'\n      AND UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n      AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))\n      AND SAFE_CAST(client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 30 DAY) -- Sample recent data\n  ),\n  final_data AS (\n    SELECT\n      *,\n      MIN(\n        CASE\n          WHEN advertiser_parent = 'DOUBLECLICK' THEN SAFE_CAST(booking_line_created_date AS DATE)\n        END) OVER (PARTITION BY financial_year) AS fix_date_lod,\n      DATETIME(TIMESTAMP(CURRENT_TIMESTAMP()), 'Australia/Sydney') AS dw_asl_load_timestamp,\n      CASE\n        WHEN fin_adtype_name = 'XTEND' THEN 'XTEND'\n        WHEN portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL' THEN 'PROGRAMMATIC - DIGITAL OTHER'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'GUA' THEN 'PROGRAMMATIC - GUARANTEED'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'NON' THEN 'PROGRAMMATIC - OPEN EXCHANGE'\n        WHEN revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(cost_model_type), 3) = 'PMP' THEN 'PROGRAMMATIC - PMP'\n        WHEN revenue_group_subtype = 'DIGITAL' THEN 'ADPT DIGITAL'\n        WHEN SAFE.LEFT(revenue_group_subtype, 6) = 'SUNDRY' THEN 'SUNDRY'\n        ELSE revenue_group_subtype\n      END AS ad_type_grouping_dimension,\n      CASE\n        WHEN (FALSE = TRUE) THEN NULL\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PRINT' THEN 1\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'DIGITAL' THEN 2\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC' THEN 3\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC EXCHANGE' THEN 4\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC SOURCE' THEN 5\n        WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'SUNDRY ADSALES OVERLAY' THEN 6\n        ELSE NULL\n      END AS ad_type_id_q2_logic,\n      CASE\n        WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE'))\n          OR (relative_fy_year_offset = 0 AND SAFE_CAST(booking_line_created_date AS DATETIME) <= DATETIME_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) AND UPPER(advertiser_parent) = 'DOUBLECLICK')\n        THEN gross_revenue_amount\n        ELSE 0\n      END AS conditional_gross_revenue_raw\n    FROM\n      base_data_cte\n  )\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_revenue_test,\n  CASE WHEN SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS current_fy_revenue_test,\n  CASE WHEN SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS previous_fy_revenue_test,\n  CASE WHEN MAX(SAFE_CAST(booking_line_created_date AS DATE)) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(DISTINCT ad_type_grouping_dimension) > 1 THEN 'PASS' ELSE 'FAIL' END AS ad_type_grouping_diversity_test,\n  CASE WHEN COUNT(DISTINCT revenue_transaction_status) = 2 THEN 'PASS' ELSE 'FAIL' END AS transaction_status_filter_test -- Expecting 'BILLED', 'BOOKED'\nFROM\n  final_data\nLIMIT 1"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Revenue Transaction Status Filter' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\nWHERE\n  SAFE_CAST(ASL.client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 90 DAY) -- Sample recent data for rule validation\n\nUNION ALL\n\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Publication Name SUDDENLY% Rule' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-'))) THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-'))) THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\nWHERE\n  SAFE_CAST(ASL.client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 90 DAY) -- Sample recent data for rule validation\n\nUNION ALL\n\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Ad Type Grouping Dimension Logic (Sample)' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE\n        WHEN ASL.fin_adtype_name = 'XTEND' THEN 1\n        WHEN ASL.sync_portfolio_parent_group_name = 'DIGITAL OTHER' AND ASL.revenue_group_subtype = 'DIGITAL' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'GUA' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'NON' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'PMP' THEN 1\n        WHEN ASL.revenue_group_subtype = 'DIGITAL' THEN 1\n        WHEN SAFE.LEFT(ASL.revenue_group_subtype, 6) = 'SUNDRY' THEN 1\n        ELSE 0\n      END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE\n        WHEN ASL.fin_adtype_name = 'XTEND' THEN 1\n        WHEN ASL.sync_portfolio_parent_group_name = 'DIGITAL OTHER' AND ASL.revenue_group_subtype = 'DIGITAL' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'GUA' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'NON' THEN 1\n        WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'PMP' THEN 1\n        WHEN ASL.revenue_group_subtype = 'DIGITAL' THEN 1\n        WHEN SAFE.LEFT(ASL.revenue_group_subtype, 6) = 'SUNDRY' THEN 1\n        ELSE 0\n      END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\nWHERE\n  SAFE_CAST(ASL.client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 90 DAY)"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  SAFE_CAST(ASL.client_reporting_date AS DATE) AS client_reporting_date,\n  ASL.financial_year,\n  ASL.financial_month,\n  ASL.advertiser_name,\n  ASL.advertiser_parent,\n  ASL.unified_publication_name,\n  ASL.fin_adtype_name,\n  ASL.revenue_group_subtype,\n  ASL.revenue_type,\n  ASL.cost_model_type_code,\n  ASL.relative_fy_year_offset,\n  ASL.gross_revenue_amount,\n  ASL.target_amount,\n  ASL.pipeline_amount,\n  ASL.revenue_transaction_status_code,\n  ASL.dw_source_system_code,\n  ASL.style_name,\n  ASL.source_publishing_division_name,\n  ASL.advertiser_id_src,\n  ASL.ad_type_name,\n  ASL.sync_portfolio_parent_group_name,\n  ASL.sales_segment_l2_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\nWHERE\n  SAFE_CAST(ASL.client_reporting_date AS DATE) >= DATE_SUB(CURRENT_DATE('Australia/Sydney'), INTERVAL 30 DAY)\n  AND ASL.gross_revenue_amount IS NOT NULL\nORDER BY\n  ASL.client_reporting_date DESC, ASL.gross_revenue_amount DESC\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-05-08"",
          ""original_format"": ""DATE(TIMESTAMP '2025-05-08 01:48:02.510465+00', 'Australia/Sydney')"",
          ""context"": ""Used as a fixed 'current date' for calculating relative dates (e.g., previous year date) and fix_date_lod. This will cause data to become stale and incorrect over time."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE('Australia/Sydney')` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""display_format"",
          ""hardcoded_values"": [""'$'000' = '$'""],
          ""context"": ""Controls whether certain revenue metrics are divided by 1000 for display. Currently hardcoded to always divide by 1000."",
          ""suggested_governance"": ""Implement as a Looker Studio parameter (e.g., 'Display_Unit') that can be selected by the user."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'BILLED'"", ""'BOOKED'"", ""'ROP COMPOSITE'"", ""'MEDIUM RARE CONTENT AGENCY'"", ""'SUDDENLY%'"", ""'17114'"", ""'29172'"", ""'52809'"", ""'-'"", ""'DOUBLECLICK'"", ""'PLUTO'"", ""'XTEND'"", ""'DIGITAL OTHER'"", ""'DIGITAL'"", ""'PROGRAMMATIC SOURCE'"", ""'GUA'"", ""'NON'"", ""'PMP'"", ""'PRINT'"", ""'PROGRAMMATIC'"", ""'PROGRAMMATIC EXCHANGE'"", ""'SUNDRY ADSALES OVERLAY'"", ""'OUTSTREAM'"", ""'EDMEDIA'"", ""'ECOMMERCE'"", ""'MRCA'"", ""'VACANT'""],
          ""context"": ""Various filters, classifications, and default values are hardcoded within CASE statements and WHERE clauses."",
          ""suggested_governance"": ""Migrate these values to a dedicated configuration table or lookup tables (e.g., `dim_revenue_status`, `dim_ad_type_classification`, `dim_publication_rules`, `dim_advertiser_segments`). This allows for easier updates and better data governance."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""relative_periods"",
          ""hardcoded_values"": [""-1"", ""0"", ""1""],
          ""context"": ""Filters data to current, previous, and next financial/calendar years."",
          ""suggested_governance"": ""While common, consider if these offsets should be configurable via dashboard parameters for more flexible reporting periods."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or `CURRENT_DATE('Australia/Sydney')` for dynamic reporting periods."",
      ""Replace hardcoded lookup values (e.g., ad types, publication names, advertiser IDs, status codes) with joins to governed reference tables or Looker Studio parameters for user selection."",
      ""Externalize complex business rules (e.g., programmatic classification, sundry publication logic) into a configuration table or a dedicated UDF/view for maintainability and transparency."",
      ""Introduce a 'Display Unit' parameter (e.g., 'Raw', 'Thousands') to control the division by 1000 for revenue metrics.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount from the source system before any specific period filtering or conditional logic."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"", ""revenue_transaction_status_code IN ('BILLED', 'BOOKED')"", ""style_name <> 'ROP COMPOSITE'"", ""source_publishing_division_name <> 'MEDIUM RARE CONTENT AGENCY'"", ""publication_name filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_raw"",
      ""metric_name"": ""Current FY Gross Revenue (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_base""],
      ""business_description"": ""Gross revenue amount for the current financial year. This is the raw value, not divided by 1000."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""relative_fy_year_offset = 0"", ""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""relative_fy_year_offset = 0""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_raw"",
      ""metric_name"": ""Previous FY Gross Revenue (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_base""],
      ""business_description"": ""Gross revenue amount for the previous financial year. This is the raw value, not divided by 1000."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""relative_fy_year_offset = 1"", ""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons and growth analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""relative_fy_year_offset = 1""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k"",
      ""metric_name"": ""Current FY Gross Revenue ('000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""current_fy_gross_revenue_raw""],
      ""business_description"": ""Gross revenue amount for the current financial year, displayed in thousands. This metric is derived by dividing the raw value by 1000."",
      ""sql_logic"": ""SAFE_DIVIDE(current_fy_gross_revenue_raw, 1000)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Commonly used for high-level reporting and dashboards to improve readability of large numbers."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1000 (division factor)""],
      ""governance_issues"": [""Hardcoded division factor should be parameterized.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k"",
      ""metric_name"": ""Previous FY Gross Revenue ('000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""previous_fy_gross_revenue_raw""],
      ""business_description"": ""Gross revenue amount for the previous financial year, displayed in thousands. This metric is derived by dividing the raw value by 1000."",
      ""sql_logic"": ""SAFE_DIVIDE(previous_fy_gross_revenue_raw, 1000)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons in a more readable format."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1000 (division factor)""],
      ""governance_issues"": [""Hardcoded division factor should be parameterized.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""conditional_gross_revenue_k"",
      ""metric_name"": ""Conditional Gross Revenue ('000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional_sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""gross_revenue_amount_base"", ""fix_date_lod"", ""unified_publication_name"", ""advertiser_parent""],
      ""business_description"": ""Gross revenue amount conditional on specific criteria (current FY, certain publication names, or specific date conditions related to Doubleclick and previous year). Displayed in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) OR (relative_fy_year_offset = 0 AND SAFE_CAST(booking_line_created_date AS DATETIME) <= DATETIME_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) AND UPPER(advertiser_parent) = 'DOUBLECLICK') THEN gross_revenue_amount ELSE 0 END, 1000)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely represents a specific segment of revenue (e.g., programmatic or specific digital channels) that requires complex filtering."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""CURRENT_DATE('Australia/Sydney') (derived from original hardcoded date)""],
      ""hardcoded_values_in_metric"": [""relative_fy_year_offset = 0"", ""'OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE'"", ""'DOUBLECLICK'"", ""1000 (division factor)""],
      ""governance_issues"": [""Hardcoded values for publication names and advertiser parent. Hardcoded division factor. The date logic is complex and depends on a hardcoded 'current date' in the original query.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ad_type_id_count"",
      ""metric_name"": ""Ad Type Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""ad_type_grouping_dimension""],
      ""business_description"": ""Counts the number of records based on a derived ad type classification. The integer values (1-6) are assigned based on ad type categories."",
      ""sql_logic"": ""COUNT(CASE WHEN (FALSE = TRUE) THEN NULL WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PRINT' THEN 1 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'DIGITAL' THEN 2 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC' THEN 3 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC EXCHANGE' THEN 4 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC SOURCE' THEN 5 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'SUNDRY ADSALES OVERLAY' THEN 6 ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to count occurrences of different ad types, potentially for volume analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'PRINT'"", ""'DIGITAL'"", ""'PROGRAMMATIC'"", ""'PROGRAMMATIC EXCHANGE'"", ""'PROGRAMMATIC SOURCE'"", ""'SUNDRY ADSALES OVERLAY'"", ""1, 2, 3, 4, 5, 6 (assigned IDs)""],
      ""governance_issues"": [""Hardcoded ad type categories and their assigned integer IDs.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ad_type_id_sum"",
      ""metric_name"": ""Ad Type Sum"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""ad_type_grouping_dimension""],
      ""business_description"": ""Sums the integer IDs assigned to derived ad type classifications. This might be used for internal weighting or simply as a non-standard count."",
      ""sql_logic"": ""SUM(CASE WHEN (FALSE = TRUE) THEN NULL WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PRINT' THEN 1 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'DIGITAL' THEN 2 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC' THEN 3 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC EXCHANGE' THEN 4 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'PROGRAMMATIC SOURCE' THEN 5 WHEN (CASE WHEN (portfolio_parent_group_name_sync = 'DIGITAL OTHER' AND revenue_group_subtype = 'DIGITAL') THEN 'PROGRAMMATIC' ELSE revenue_group_subtype END) = 'SUNDRY ADSALES OVERLAY' THEN 6 ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily"", ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Unclear business context for summing IDs, potentially for internal weighting or a proxy for volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'PRINT'"", ""'DIGITAL'"", ""'PROGRAMMATIC'"", ""'PROGRAMMATIC EXCHANGE'"", ""'PROGRAMMATIC SOURCE'"", ""'SUNDRY ADSALES OVERLAY'"", ""1, 2, 3, 4, 5, 6 (assigned IDs)""],
      ""governance_issues"": [""Hardcoded ad type categories and their assigned integer IDs.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ad_type_grouping_dimension"",
      ""metric_name"": ""Ad Type Grouping Dimension"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""fin_adtype_name"", ""revenue_group_subtype"", ""portfolio_parent_group_name_sync"", ""cost_model_type"", ""revenue_type""],
      ""business_description"": ""A unified ad type grouping dimension, combining logic from both original queries. Prioritizes the more detailed Q2 logic, falling back to Q3 logic if needed, or a default."",
      ""sql_logic"": ""CASE \n    WHEN ASL.fin_adtype_name = 'XTEND' THEN 'XTEND' \n    WHEN ASL.sync_portfolio_parent_group_name = 'DIGITAL OTHER' AND ASL.revenue_group_subtype = 'DIGITAL' THEN 'PROGRAMMATIC - DIGITAL OTHER' \n    WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'GUA' THEN 'PROGRAMMATIC - GUARANTEED' \n    WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'NON' THEN 'PROGRAMMATIC - OPEN EXCHANGE' \n    WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'PMP' THEN 'PROGRAMMATIC - PMP' \n    WHEN ASL.revenue_group_subtype = 'DIGITAL' THEN 'ADPT DIGITAL' \n    WHEN SAFE.LEFT(ASL.revenue_group_subtype, 6) = 'SUNDRY' THEN 'SUNDRY' \n    ELSE ASL.revenue_group_subtype \nEND"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Centralized dimension for consistent ad type analysis across the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'XTEND'"", ""'DIGITAL OTHER'"", ""'DIGITAL'"", ""'PROGRAMMATIC SOURCE'"", ""'GUA'"", ""'NON'"", ""'PMP'"", ""'ADPT DIGITAL'"", ""'SUNDRY'""],
      ""governance_issues"": [""Hardcoded business rules for classification. Should be externalized to a lookup table.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adtype_l1"",
      ""metric_name"": ""Ad Type Level 1"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first level of ad type classification, directly from the source table."",
      ""sql_logic"": ""adtype_l1"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and high-level segmentation of ad types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjustment_amount"",
      ""metric_name"": ""Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of adjustments applied to revenue."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track revenue adjustments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""pub_lgb"",
      ""metric_name"": ""LGB Publication Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The 'Look Good Booked' amount specific to publications."",
      ""sql_logic"": ""SUM(IFNULL(lgb_pub_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for tracking booked revenue related to publications."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""ss_lgb"",
      ""metric_name"": ""LGB Sales Segment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The 'Look Good Booked' amount specific to sales segments."",
      ""sql_logic"": ""SUM(IFNULL(lgb_ss_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Internal metric for tracking booked revenue related to sales segments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""pipeline"",
      ""metric_name"": ""Pipeline Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount in the sales pipeline."",
      ""sql_logic"": ""SUM(IFNULL(pipeline_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to forecast future revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""target"",
      ""metric_name"": ""Target Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The target revenue amount."",
      ""sql_logic"": ""SUM(IFNULL(target_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""],
      ""filters_applied"": [""dashboard_level_filters""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for sales goal tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_k"",
      ""related_metrics"": [""current_fy_gross_revenue_raw""],
      ""relationship_description"": ""Current FY Gross Revenue ('000) is derived by dividing Current FY Gross Revenue (Raw) by 1000 for display purposes."",
      ""mathematical_formula"": ""current_fy_gross_revenue_k = current_fy_gross_revenue_raw / 1000"",
      ""business_validation"": ""Ensures large revenue figures are presented in a more readable format for high-level analysis."",
      ""validation_sql"": ""SELECT SUM(current_fy_gross_revenue_k * 1000) - SUM(current_fy_gross_revenue_raw) AS difference FROM your_unified_data_source WHERE financial_year = (SELECT MAX(financial_year) FROM your_unified_data_source WHERE relative_fy_year_offset = 0)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""previous_fy_gross_revenue_k"",
      ""related_metrics"": [""previous_fy_gross_revenue_raw""],
      ""relationship_description"": ""Previous FY Gross Revenue ('000) is derived by dividing Previous FY Gross Revenue (Raw) by 1000 for display purposes."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_k = previous_fy_gross_revenue_raw / 1000"",
      ""business_validation"": ""Ensures large revenue figures are presented in a more readable format for year-over-year comparisons."",
      ""validation_sql"": ""SELECT SUM(previous_fy_gross_revenue_k * 1000) - SUM(previous_fy_gross_revenue_raw) AS difference FROM your_unified_data_source WHERE financial_year = (SELECT MAX(financial_year) FROM your_unified_data_source WHERE relative_fy_year_offset = 1)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_gross_revenue_raw"",
      ""related_metrics"": [""gross_revenue_amount_base""],
      ""relationship_description"": ""Current FY Gross Revenue (Raw) is a subset of the base gross revenue, specifically filtered for the current financial year."",
      ""mathematical_formula"": ""SUM(current_fy_gross_revenue_raw) = SUM(gross_revenue_amount_base WHERE relative_fy_year_offset = 0)"",
      ""business_validation"": ""Ensures that current period performance is accurately isolated for analysis."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_sum, SUM(gross_revenue_amount) AS total_sum FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 0"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""previous_fy_gross_revenue_raw"",
      ""related_metrics"": [""gross_revenue_amount_base""],
      ""relationship_description"": ""Previous FY Gross Revenue (Raw) is a subset of the base gross revenue, specifically filtered for the previous financial year."",
      ""mathematical_formula"": ""SUM(previous_fy_gross_revenue_raw) = SUM(gross_revenue_amount_base WHERE relative_fy_year_offset = 1)"",
      ""business_validation"": ""Ensures that prior period performance is accurately isolated for historical comparison."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) AS previous_fy_sum, SUM(gross_revenue_amount) AS total_sum FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE relative_fy_year_offset = 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""conditional_logic"",
      ""primary_metric"": ""conditional_gross_revenue_k"",
      ""related_metrics"": [""gross_revenue_amount_base"", ""unified_publication_name"", ""advertiser_parent"", ""booking_line_created_date"", ""relative_fy_year_offset""],
      ""relationship_description"": ""This metric applies complex conditional logic to the base gross revenue, filtering by current FY, specific publication names, or a combination of advertiser parent ('DOUBLECLICK') and a specific date condition."",
      ""mathematical_formula"": ""conditional_gross_revenue_k = SUM(gross_revenue_amount_base WHERE (relative_fy_year_offset = 0 AND unified_publication_name IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) OR (relative_fy_year_offset = 0 AND SAFE_CAST(booking_line_created_date AS DATETIME) <= DATETIME_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) AND advertiser_parent = 'DOUBLECLICK')) / 1000"",
      ""business_validation"": ""Identifies a specific segment of revenue that requires detailed tracking, potentially for programmatic or specific digital channels."",
      ""validation_sql"": ""SELECT SUM(conditional_gross_revenue_k * 1000) AS calculated_conditional_revenue, SUM(CASE WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) OR (relative_fy_year_offset = 0 AND SAFE_CAST(booking_line_created_date AS DATETIME) <= DATETIME_ADD(CURRENT_DATE('Australia/Sydney'), INTERVAL -365 DAY) AND UPPER(advertiser_parent) = 'DOUBLECLICK') THEN gross_revenue_amount ELSE 0 END) AS direct_conditional_revenue FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""ad_type_grouping_dimension"",
      ""related_metrics"": [""adtype_l1"", ""fin_adtype_name"", ""revenue_group_subtype"", ""revenue_type""],
      ""relationship_description"": ""The 'Ad Type Grouping Dimension' is a derived, higher-level classification of ad types, built upon more granular ad type fields from the source data. It consolidates different classification logics found in the original queries."",
      ""mathematical_formula"": ""N/A (categorical derivation)"",
      ""business_validation"": ""Provides a consistent and simplified view of ad types for reporting, abstracting away complex underlying logic."",
      ""validation_sql"": ""SELECT ad_type_grouping_dimension, COUNT(*) FROM (SELECT CASE WHEN ASL.fin_adtype_name = 'XTEND' THEN 'XTEND' WHEN ASL.sync_portfolio_parent_group_name = 'DIGITAL OTHER' AND ASL.revenue_group_subtype = 'DIGITAL' THEN 'PROGRAMMATIC - DIGITAL OTHER' WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'GUA' THEN 'PROGRAMMATIC - GUARANTEED' WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'NON' THEN 'PROGRAMMATIC - OPEN EXCHANGE' WHEN ASL.revenue_group_subtype = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(UPPER(ASL.cost_model_type_code), 3) = 'PMP' THEN 'PROGRAMMATIC - PMP' WHEN ASL.revenue_group_subtype = 'DIGITAL' THEN 'ADPT DIGITAL' WHEN SAFE.LEFT(ASL.revenue_group_subtype, 6) = 'SUNDRY' THEN 'SUNDRY' ELSE ASL.revenue_group_subtype END AS ad_type_grouping_dimension FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL WHERE (ASL.relative_fy_year_offset IN (-1, 0, 1) OR ASL.relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(ASL.revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')) GROUP BY ad_type_grouping_dimension"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,35
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""23c8b213-a9f0-4158-b8fa-bff14425abb5"",
    ""dashboard_name"": ""TM1 NewsQuery Tables"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions;ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 3,
    ""consolidation_score"": 2,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""gl_publication_code"",
      ""category_name"",
      ""channel"",
      ""state""
    ],
    ""date_range_detected"": ""Specific Fiscal Week (202535) and recent weeks for general analysis"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""202535""
    ],
    ""governance_opportunities"": [
      ""fiscal_week_id should be parameterized or derived dynamically based on current period logic"",
      ""Consider a lookup table for fiscal week to date mapping if needed""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH SubscriptionsData AS (\n  SELECT\n    SAFE_CAST(fiscal_week_id AS INT64) AS fiscal_week_id,\n    SAFE_CAST(gl_publication_code AS STRING) AS gl_publication_code,\n    SAFE_CAST(category_name AS STRING) AS category_name,\n    SAFE_CAST(add_volume AS NUMERIC) AS add_volume,\n    SAFE_CAST(closing_base AS NUMERIC) AS closing_base,\n    SAFE_CAST(earned_amount AS NUMERIC) AS earned_amount,\n    SAFE_CAST(opening_base AS NUMERIC) AS opening_base,\n    SAFE_CAST(red_volume AS NUMERIC) AS red_volume,\n    SAFE_CAST(transfer_in AS NUMERIC) AS transfer_in,\n    SAFE_CAST(transfer_out AS NUMERIC) AS transfer_out\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\n  -- Filter for a recent fiscal week range, assuming fiscal_week_id is YYYYWW format\n  WHERE SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) - 5 FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)\n)\nSELECT\n  fiscal_week_id,\n  gl_publication_code,\n  category_name,\n  SUM(add_volume) AS total_add_volume,\n  SUM(closing_base) AS total_closing_base,\n  SUM(earned_amount) AS total_earned_amount,\n  SUM(opening_base) AS total_opening_base,\n  SUM(red_volume) AS total_red_volume,\n  SUM(transfer_in) AS total_transfer_in,\n  SUM(transfer_out) AS total_transfer_out,\n  -- Example of a derived metric: Net Transfer\n  SUM(transfer_in) - SUM(transfer_out) AS net_transfer_volume,\n  -- Example of a derived metric: Net Volume Change\n  SUM(add_volume) - SUM(red_volume) AS net_volume_change\nFROM SubscriptionsData\nGROUP BY\n  fiscal_week_id,\n  gl_publication_code,\n  category_name\nORDER BY\n  fiscal_week_id DESC, gl_publication_code, category_name\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis - Subscriptions' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS INT64)) as unique_fiscal_weeks,\n  COUNT(DISTINCT SAFE_CAST(gl_publication_code AS STRING)) as unique_publications,\n  COUNT(DISTINCT SAFE_CAST(category_name AS STRING)) as unique_categories,\n  MIN(SAFE_CAST(fiscal_week_id AS INT64)) as earliest_fiscal_week,\n  MAX(SAFE_CAST(fiscal_week_id AS INT64)) as latest_fiscal_week,\n  SUM(CASE WHEN add_volume IS NULL THEN 1 ELSE 0 END) AS null_add_volume_count,\n  SUM(CASE WHEN earned_amount IS NULL THEN 1 ELSE 0 END) AS null_earned_amount_count\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) - 10 FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check - Subscriptions' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN MAX(SAFE_CAST(fiscal_week_id AS INT64)) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) - 2 FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN SUM(SAFE_CAST(earned_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as earned_amount_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(gl_publication_code AS STRING)) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_publications_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) = (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation - Hardcoded Fiscal Week' as validation_type,\n  'Hardcoded Fiscal Week 202535' as rule_name,\n  COUNT(*) as records_in_hardcoded_week,\n  SUM(SAFE_CAST(earned_amount AS NUMERIC)) as earned_amount_in_hardcoded_week,\n  (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`) as total_records_in_table,\n  SAFE_DIVIDE(COUNT(*), (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)) * 100 as percentage_of_total_records_for_week\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) = 202535\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(fiscal_week_id AS INT64) AS fiscal_week_id,\n  SAFE_CAST(gl_publication_code AS STRING) AS gl_publication_code,\n  SAFE_CAST(category_name AS STRING) AS category_name,\n  SAFE_CAST(add_volume AS NUMERIC) AS add_volume,\n  SAFE_CAST(closing_base AS NUMERIC) AS closing_base,\n  SAFE_CAST(earned_amount AS NUMERIC) AS earned_amount,\n  SAFE_CAST(opening_base AS NUMERIC) AS opening_base,\n  SAFE_CAST(red_volume AS NUMERIC) AS red_volume,\n  SAFE_CAST(transfer_in AS NUMERIC) AS transfer_in,\n  SAFE_CAST(transfer_out AS NUMERIC) AS transfer_out\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) >= (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) - 2 FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)\nORDER BY SAFE_CAST(fiscal_week_id AS INT64) DESC, SAFE_CAST(earned_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""fiscal_period_id"",
          ""hardcoded_values"": [
            ""202535""
          ],
          ""context"": ""Used as a specific fiscal week filter in the subscriptions query."",
          ""suggested_governance"": ""Replace with a dynamic fiscal week parameter (e.g., current fiscal week, previous fiscal week) or a fiscal calendar lookup table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal week IDs with dynamic parameters (e.g., `_FISCAL_WEEK_ID_` or `CURRENT_FISCAL_WEEK()`)"",
      ""Implement a fiscal calendar dimension table to map fiscal week IDs to actual dates for flexible date range filtering.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""add_volume"",
      ""metric_name"": ""Add Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the volume of new subscriptions added within a fiscal week."",
      ""sql_logic"": ""t0.add_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key metric for subscription growth and performance tracking."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""outliers expected""
      ]
    },
    {
      ""metric_id"": ""category_name"",
      ""metric_name"": ""Category Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of the subscription or product, used for segmentation."",
      ""sql_logic"": ""t0.category_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of subscription performance by different product or service categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming""
      ]
    },
    {
      ""metric_id"": ""closing_base"",
      ""metric_name"": ""Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of active subscriptions at the end of a fiscal week."",
      ""sql_logic"": ""t0.closing_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Fundamental metric for understanding the total subscriber base and its evolution."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy dependent on other base movements""
      ]
    },
    {
      ""metric_id"": ""earned_amount"",
      ""metric_name"": ""Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The revenue earned from subscriptions within a fiscal week."",
      ""sql_logic"": ""t0.earned_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Core financial metric for subscription revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy dependent on billing data""
      ]
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""filter"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a fiscal week, typically in YYYYWW format."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for financial reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""202535""
      ],
      ""governance_issues"": [
        ""hardcoded value should be parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger code representing a specific publication or masthead."",
      ""sql_logic"": ""t0.gl_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting financial data by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies if not from a master list""
      ]
    },
    {
      ""metric_id"": ""opening_base"",
      ""metric_name"": ""Opening Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of active subscriptions at the beginning of a fiscal week."",
      ""sql_logic"": ""t0.opening_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Fundamental metric for understanding the total subscriber base and its evolution."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy dependent on previous period's closing base""
      ]
    },
    {
      ""metric_id"": ""red_volume"",
      ""metric_name"": ""Red Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the volume of subscriptions lost (reductions) within a fiscal week."",
      ""sql_logic"": ""t0.red_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key metric for understanding churn and subscription base erosion."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""outliers expected""
      ]
    },
    {
      ""metric_id"": ""transfer_in"",
      ""metric_name"": ""Transfer In"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of subscriptions transferred into a specific category or publication within a fiscal week."",
      ""sql_logic"": ""t0.transfer_in"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to track internal movements of subscriptions between different segments."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""transfer_out"",
      ""metric_name"": ""Transfer Out"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of subscriptions transferred out of a specific category or publication within a fiscal week."",
      ""sql_logic"": ""t0.transfer_out"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN (202535)""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Used to track internal movements of subscriptions between different segments."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""channel"",
      ""metric_name"": ""Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The distribution channel for circulation (e.g., home delivery, retail)."",
      ""sql_logic"": ""t0.channel"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of circulation performance by distribution method."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming""
      ]
    },
    {
      ""metric_id"": ""home_del_charge"",
      ""metric_name"": ""Home Delivery Charge"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The revenue or charge associated with home delivery circulation."",
      ""sql_logic"": ""t0.home_del_charge"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Key revenue component for circulation, specifically for home delivery services."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""returns_credit_amount"",
      ""metric_name"": ""Returns Credit Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The credit amount issued for returned circulation units, impacting net revenue."",
      ""sql_logic"": ""t0.returns_credit_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Important for calculating net circulation revenue and understanding waste/returns."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""rev_adjust"",
      ""metric_name"": ""Revenue Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General adjustments made to circulation revenue."",
      ""sql_logic"": ""t0.rev_adjust"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""Crucial for accurate net circulation revenue reporting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""state"",
      ""metric_name"": ""State"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The geographical state where circulation occurred."",
      ""sql_logic"": ""t0.state"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables regional analysis of circulation performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""closing_base"",
      ""related_metrics"": [
        ""opening_base"",
        ""add_volume"",
        ""red_volume"",
        ""transfer_in"",
        ""transfer_out""
      ],
      ""relationship_description"": ""The closing base is typically calculated from the opening base, adjusted by additions, reductions, and transfers."",
      ""mathematical_formula"": ""closing_base = opening_base + add_volume - red_volume + transfer_in - transfer_out"",
      ""business_validation"": ""This formula represents the fundamental flow of subscriptions and is critical for base reconciliation and forecasting."",
      ""validation_sql"": ""SELECT\n  fiscal_week_id,\n  gl_publication_code,\n  category_name,\n  SUM(opening_base) + SUM(add_volume) - SUM(red_volume) + SUM(transfer_in) - SUM(transfer_out) AS calculated_closing_base,\n  SUM(closing_base) AS actual_closing_base,\n  ABS(SUM(closing_base) - (SUM(opening_base) + SUM(add_volume) - SUM(red_volume) + SUM(transfer_in) - SUM(transfer_out))) AS difference\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) = (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`)\nGROUP BY fiscal_week_id, gl_publication_code, category_name\nHAVING ABS(SUM(closing_base) - (SUM(opening_base) + SUM(add_volume) - SUM(red_volume) + SUM(transfer_in) - SUM(transfer_out))) > 0.01 -- Check for small discrepancies\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""fiscal_week_id"",
      ""related_metrics"": [
        ""add_volume"",
        ""earned_amount"",
        ""closing_base"",
        ""opening_base"",
        ""red_volume"",
        ""transfer_in"",
        ""transfer_out""
      ],
      ""relationship_description"": ""The 'fiscal_week_id' acts as a primary filter, constraining all subscription-related metrics to a specific reporting period."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that all reported subscription metrics are consistent for the selected fiscal week, crucial for period-over-period analysis."",
      ""validation_sql"": ""SELECT\n  'Filter Impact Check' as test_type,\n  COUNT(*) as records_for_hardcoded_week,\n  SUM(SAFE_CAST(earned_amount AS NUMERIC)) as earned_amount_for_hardcoded_week\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE SAFE_CAST(fiscal_week_id AS INT64) = 202535\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""net_circulation_revenue"",
      ""related_metrics"": [
        ""home_del_charge"",
        ""returns_credit_amount"",
        ""rev_adjust""
      ],
      ""relationship_description"": ""Net circulation revenue is derived from home delivery charges, adjusted by returns credits and other revenue adjustments."",
      ""mathematical_formula"": ""net_circulation_revenue = home_del_charge - returns_credit_amount + rev_adjust"",
      ""business_validation"": ""This calculation provides the true revenue from circulation after accounting for all deductions and adjustments."",
      ""validation_sql"": ""SELECT\n  channel,\n  state,\n  SUM(SAFE_CAST(home_del_charge AS NUMERIC)) - SUM(SAFE_CAST(returns_credit_amount AS NUMERIC)) + SUM(SAFE_CAST(rev_adjust AS NUMERIC)) AS calculated_net_rev,\n  SUM(SAFE_CAST(home_del_charge AS NUMERIC)) AS total_home_del_charge\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`\nGROUP BY channel, state\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,36
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a17622e2-ad43-49cc-b3c5-19c95036fd14"",
    ""dashboard_name"": ""Advertising Rebates Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_month"",
      ""account_number"",
      ""advertiser_name"",
      ""revenue_type"",
      ""revenue_group_subtype"",
      ""source_publishing_division"",
      ""revenue_transaction_status"",
      ""invoice_number"",
      ""advertiser_parent"",
      ""source_system_code"",
      ""unified_publication_name""
    ],
    ""date_range_detected"": ""Financial Year 2025, Financial Month 10 (October)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""10""
    ],
    ""hardcoded_values_found"": [
      ""'2025'"",
      ""10.000000"",
      ""'Booked'"",
      ""'Billed'"",
      ""'Medium Rare Content Agency'"",
      ""'Print'"",
      ""'Digital'"",
      ""'Programmatic Source'"",
      ""'4039072'"",
      ""0.000000""
    ],
    ""governance_opportunities"": [
      ""financial_year and financial_month should be parameters or derived from a date dimension table."",
      ""revenue_transaction_status, source_publishing_division, revenue_type, revenue_group_subtype should use governed reference tables."",
      ""account_number should be a parameter or selected from a governed list."",
      ""The 'rebate_3_amount != 0.000000' filter should be clearly documented or parameterized if it's a business rule.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.account_number,\n    t0.adjustment_amount,\n    t0.advertiser_name,\n    t0.advertiser_parent,\n    t0.financial_month,\n    t0.financial_year,\n    t0.gross_revenue_amount,\n    t0.gross_revenue_ex_adj_amount,\n    t0.invoice_number,\n    t0.rebate_3_amount,\n    t0.revenue_group_subtype,\n    t0.revenue_transaction_status,\n    t0.revenue_type,\n    t0.source_publishing_division,\n    t0.source_system_code,\n    t0.unified_publication_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND t0.financial_year IS NOT NULL\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND t0.revenue_type IN ('Print', 'Digital')\n    AND t0.revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')\n    -- Specific filters found in individual dashboard queries (can be parameterized or commented out for broader analysis):\n    AND t0.financial_year = '2025' -- Found in job_6OfcD4WHqJA-ESGEQCj4CPSLZKO5, job_CTaZGv49EYpbUo_X2FpjLxWFyeoo\n    -- AND SAFE_CAST(t0.financial_month AS FLOAT64) = 10.000000 -- Found in job_6OfcD4WHqJA-ESGEQCj4CPSLZKO5\n    -- AND t0.rebate_3_amount != 0.000000 -- Found in job_6OfcD4WHqJA-ESGEQCj4CPSLZKO5, job_CTaZGv49EYpbUo_X2FpjLxWFyeoo\n    -- AND t0.account_number = '4039072' -- Found in job_jRFECZJY2Avu1bRUy6CfH4Qxn7pQ\n)\nSELECT\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  financial_month,\n  financial_year,\n  invoice_number,\n  revenue_type,\n  source_system_code,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division,\n  SUM(SAFE_CAST(gross_revenue_ex_adj_amount AS NUMERIC)) AS total_gross_revenue_ex_adj_amount,\n  SUM(SAFE_CAST(rebate_3_amount AS NUMERIC)) AS total_rebate_3_amount,\n  SUM(SAFE_CAST(adjustment_amount AS NUMERIC)) AS total_adjustment_amount,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount\nFROM base_data\nGROUP BY\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  financial_month,\n  financial_year,\n  invoice_number,\n  revenue_type,\n  source_system_code,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division\nORDER BY\n  financial_year DESC, financial_month DESC, advertiser_name ASC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT SAFE_CAST(financial_month AS STRING)) as unique_financial_months,\n  COUNT(DISTINCT account_number) as unique_accounts,\n  COUNT(DISTINCT advertiser_name) as unique_advertisers,\n  MIN(SAFE_CAST(financial_year AS STRING)) as earliest_financial_year,\n  MAX(SAFE_CAST(financial_year AS STRING)) as latest_financial_year,\n  APPROX_COUNT_DISTINCT(CONCAT(account_number, '-', invoice_number)) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE SAFE_CAST(financial_year AS STRING) = '2025' -- Limiting to the year found in queries for relevance\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN SUM(SAFE_CAST(rebate_3_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as rebate_amount_test,\n  CASE WHEN COUNT(DISTINCT account_number) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_accounts_test,\n  CASE WHEN MAX(SAFE_CAST(financial_year AS STRING)) = '2025' THEN 'PASS' ELSE 'FAIL' END as financial_year_freshness_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'revenue_transaction_status_filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Limiting to the year found in queries for relevance\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'source_publishing_division_exclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Limiting to the year found in queries for relevance\nLIMIT 100;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(financial_year AS STRING) as financial_year,\n  SAFE_CAST(financial_month AS STRING) as financial_month,\n  account_number,\n  advertiser_name,\n  revenue_type,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division,\n  SAFE_CAST(gross_revenue_amount AS NUMERIC) as gross_revenue_amount,\n  SAFE_CAST(gross_revenue_ex_adj_amount AS NUMERIC) as gross_revenue_ex_adj_amount,\n  SAFE_CAST(rebate_3_amount AS NUMERIC) as rebate_3_amount,\n  SAFE_CAST(adjustment_amount AS NUMERIC) as adjustment_amount\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  financial_year = '2025' -- Limiting to the year found in queries for relevance\n  AND revenue_transaction_status IN ('Booked', 'Billed')\nORDER BY\n  financial_year DESC, financial_month DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""financial_year filter in multiple queries"",
          ""suggested_fix"": ""replace with a parameter or relative year (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""10"",
          ""original_format"": ""10.000000"",
          ""context"": ""financial_month filter in job_6OfcD4WHqJA-ESGEQCj4CPSLZKO5, after SAFE_CAST to FLOAT64"",
          ""suggested_fix"": ""replace with a parameter or relative month (e.g., EXTRACT(MONTH FROM CURRENT_DATE()))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""revenue_transaction_status filter"",
          ""suggested_governance"": ""use a lookup table for transaction statuses"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""source_publishing_division exclusion filter"",
          ""suggested_governance"": ""use a lookup table for publishing divisions or a configuration table for exclusions"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Print'"",
            ""'Digital'""
          ],
          ""context"": ""revenue_type filter"",
          ""suggested_governance"": ""use a lookup table for revenue types"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Programmatic Source'"",
            ""'Print'"",
            ""'Digital'""
          ],
          ""context"": ""revenue_group_subtype filter"",
          ""suggested_governance"": ""use a lookup table for revenue group subtypes"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'4039072'""
          ],
          ""context"": ""account_number filter in job_jRFECZJY2Avu1bRUy6CfH4Qxn7pQ"",
          ""suggested_governance"": ""replace with a parameter or join to a client/account master table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""0.000000""
          ],
          ""context"": ""rebate_3_amount != 0.000000 filter in multiple queries"",
          ""suggested_governance"": ""document this business rule or parameterize the threshold if it can change"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and months with date parameters (e.g., @financial_year, @financial_month) or relative date functions (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))."",
      ""Replace hardcoded lookup values for 'revenue_transaction_status', 'source_publishing_division', 'revenue_type', 'revenue_group_subtype' with joins to governed reference tables."",
      ""Replace hardcoded 'account_number' with a parameter (e.g., @account_number) or a selection from a governed client list."",
      ""Consider externalizing business rules like 'rebate_3_amount != 0.000000' into a configuration table if the threshold is subject to change.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""account_number"",
      ""metric_name"": ""Account Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for the client account."",
      ""sql_logic"": ""t0.account_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""account_number = '4039072' (specific query filter)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment advertising data by specific client accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Hardcoded value should be parameterized or sourced from a master data table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the revenue."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for reporting and analyzing revenue by specific advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_parent"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent company or group of the advertiser."",
      ""sql_logic"": ""t0.advertiser_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for hierarchical reporting of advertising revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month of the revenue transaction."",
      ""sql_logic"": ""t0.financial_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""SAFE_CAST(financial_month AS FLOAT64) = 10.000000 (specific query filter)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for time-series analysis and monthly reporting of advertising rebates."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""10""
      ],
      ""hardcoded_values_in_metric"": [
        ""10.000000""
      ],
      ""governance_issues"": [
        ""Hardcoded month value should be parameterized."",
        ""Casting to FLOAT64 for comparison is unusual; consider casting to INT64 or comparing as string.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year of the revenue transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for annual reporting and trend analysis of advertising rebates."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'""
      ],
      ""governance_issues"": [
        ""Hardcoded year value should be parameterized.""
      ],
      ""data_quality_concerns"": [
        ""Checked for NULLs in original query, indicating potential data quality issue.""
      ]
    },
    {
      ""metric_id"": ""invoice_number"",
      ""metric_name"": ""Invoice Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for the invoice."",
      ""sql_logic"": ""t0.invoice_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides transactional detail for auditing and reconciliation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A more granular classification of revenue, e.g., 'Programmatic Source', 'Print', 'Digital'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue by specific advertising channels or types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Programmatic Source'"",
        ""'Print'"",
        ""'Digital'""
      ],
      ""governance_issues"": [
        ""Hardcoded values should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction, e.g., 'Booked', 'Billed'."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Critical filter to ensure only relevant (booked or billed) revenue is included in analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'""
      ],
      ""governance_issues"": [
        ""Hardcoded values should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Broad classification of revenue, e.g., 'Print', 'Digital'."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_type IN ('Print', 'Digital')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to differentiate revenue streams by media type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Print'"",
        ""'Digital'""
      ],
      ""governance_issues"": [
        ""Hardcoded values should be sourced from a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by internal publishing entities, with a specific exclusion rule."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion value should be sourced from a configuration table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_code"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Code indicating the source system of the revenue data."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Useful for data lineage and understanding data origin."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Standardized name of the publication."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides context on which publication generated the revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_ex_adj_amount"",
      ""metric_name"": ""Total Gross Revenue Excl. Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue excluding any adjustment amounts. This is a key revenue metric."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.gross_revenue_ex_adj_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""SAFE_CAST(financial_month AS FLOAT64) = 10.000000 (specific query filter)"",
        ""rebate_3_amount != 0.000000 (specific query filter)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary indicator of advertising sales performance before considering rebates or other adjustments. Used in multiple dashboard components."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""10.000000"",
        ""0.000000""
      ],
      ""governance_issues"": [
        ""Hardcoded date and filter values.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULLs requiring SAFE_CAST.""
      ]
    },
    {
      ""metric_id"": ""total_rebate_3_amount"",
      ""metric_name"": ""Total Rebate 3 Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the third type of rebate amount applied to advertising revenue."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.rebate_3_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""SAFE_CAST(financial_month AS FLOAT64) = 10.000000 (specific query filter)"",
        ""rebate_3_amount != 0.000000""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A critical metric for understanding the impact of rebates on net revenue. Directly related to the dashboard's purpose."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""10.000000"",
        ""0.000000""
      ],
      ""governance_issues"": [
        ""Hardcoded date and filter values.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULLs requiring SAFE_CAST.""
      ]
    },
    {
      ""metric_id"": ""total_adjustment_amount"",
      ""metric_name"": ""Total Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all adjustment amounts applied to advertising revenue."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.adjustment_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""SAFE_CAST(financial_month AS FLOAT64) = 10.000000 (specific query filter)"",
        ""rebate_3_amount != 0.000000 (specific query filter)"",
        ""account_number = '4039072' (specific query filter)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into the total value of adjustments made to revenue, which can include corrections or other deductions/additions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""10.000000"",
        ""0.000000"",
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Hardcoded date, account number, and filter values.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULLs requiring SAFE_CAST.""
      ]
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the total gross revenue before any adjustments or rebates."",
      ""sql_logic"": ""SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""SAFE_CAST(financial_month AS FLOAT64) = 10.000000 (specific query filter)"",
        ""rebate_3_amount != 0.000000 (specific query filter)"",
        ""account_number = '4039072' (specific query filter)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the raw advertising revenue generated. Used in multiple dashboard components."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""10""
      ],
      ""hardcoded_values_in_metric"": [
        ""'2025'"",
        ""10.000000"",
        ""0.000000"",
        ""'4039072'""
      ],
      ""governance_issues"": [
        ""Hardcoded date, account number, and filter values.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULLs requiring SAFE_CAST.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""total_gross_revenue_ex_adj_amount"",
        ""total_adjustment_amount""
      ],
      ""relationship_description"": ""Gross Revenue Amount is likely related to Gross Revenue Excl. Adjustment Amount and Adjustment Amount. It's common for Gross Revenue to be (Gross Revenue Excl. Adjustment) + Adjustment, or similar."",
      ""mathematical_formula"": ""total_gross_revenue_amount = total_gross_revenue_ex_adj_amount + total_adjustment_amount (Hypothesized)"",
      ""business_validation"": ""This relationship defines how adjustments impact the overall gross revenue. Validating this ensures the financial calculations are consistent."",
      ""validation_sql"": ""SELECT\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue,\n  SUM(SAFE_CAST(gross_revenue_ex_adj_amount AS NUMERIC)) AS total_gross_revenue_ex_adj,\n  SUM(SAFE_CAST(adjustment_amount AS NUMERIC)) AS total_adjustment,\n  CASE\n    WHEN SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) = SUM(SAFE_CAST(gross_revenue_ex_adj_amount AS NUMERIC)) + SUM(SAFE_CAST(adjustment_amount AS NUMERIC))\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS validation_status\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_rebate_3_amount"",
      ""related_metrics"": [
        ""total_gross_revenue_ex_adj_amount"",
        ""total_gross_revenue_amount""
      ],
      ""relationship_description"": ""The filter `rebate_3_amount != 0.000000` directly impacts the data included for all metrics in queries where it's applied, not just the rebate amount itself."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Understanding that filtering on a specific metric (rebate amount) can affect the totals of other metrics (gross revenue) is crucial for accurate interpretation of the dashboard."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN rebate_3_amount != 0.000000 THEN SAFE_CAST(gross_revenue_amount AS NUMERIC) ELSE 0 END) AS gross_revenue_with_rebate_filter,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_without_rebate_filter\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,37
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6de90f2a-b3f3-46fe-a4fe-13474b2d6618"",
    ""dashboard_name"": ""PACMAN AND EXCLUDE LOD"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4;ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Fiscal_Year"",
      ""Margin_Level"",
      ""Product_L1"",
      ""Product_L2"",
      ""Product_L3"",
      ""Product_L4"",
      ""Product_Name"",
      ""Category""
    ],
    ""date_range_detected"": ""2025 (hardcoded)"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'Category'"",
      ""'Product_Name'"",
      ""'Product_L1'"",
      ""'Product_L2'"",
      ""'Product_L3'"",
      ""'Product_L4'""
    ],
    ""governance_opportunities"": [
      ""Fiscal year should be a parameter"",
      ""Dynamic dimension selection should use a parameter or a lookup table for category names""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\n-- Assumption: Both tables contain a 'Fiscal_Year' column for joining purposes. If 'dv_exclude_product_l3_and_l4' does not have 'Fiscal_Year', this join will result in NULLs for 'exclude_data' metrics when grouped by year.\nWITH\n  exclude_data AS (\n    SELECT\n      SAFE_CAST(t0.Fiscal_Year AS INT64) AS fiscal_year, -- Assuming Fiscal_Year exists in this table\n      SAFE_CAST(t0.Product_L3 AS STRING) AS product_l3, -- Using Product_L3 as the common dimension for joining\n      SAFE_CAST(t0.Margin_Level AS STRING) AS margin_level,\n      SUM(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) AS total_product_revenue_from_exclude,\n      SUM(SAFE_CAST(t0.Product_Revenue_Merged_OneRow AS NUMERIC)) AS total_product_revenue_merged_from_exclude\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\n    WHERE\n      SAFE_CAST(t0.Fiscal_Year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Filter for recent data, e.g., last 3 years\n    GROUP BY\n      1, 2, 3\n  ),\n  pacman_data AS (\n    SELECT\n      SAFE_CAST(t0.Fiscal_Year AS INT64) AS fiscal_year,\n      SAFE_CAST(t0.Product_L3 AS STRING) AS product_l3,\n      SUM(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) AS pacman_total_product_revenue,\n      SUM(SAFE_CAST(t0.Fiscal_Year AS INT64)) AS pacman_sum_of_fiscal_years -- This is the unusual metric, summing the year itself\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\n    WHERE\n      SAFE_CAST(t0.Fiscal_Year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Filter for recent data, e.g., last 3 years\n    GROUP BY\n      1, 2\n  )\nSELECT\n  COALESCE(ed.fiscal_year, pd.fiscal_year) AS fiscal_year,\n  COALESCE(ed.product_l3, pd.product_l3) AS product_l3,\n  ed.margin_level,\n  ed.total_product_revenue_from_exclude,\n  ed.total_product_revenue_merged_from_exclude,\n  pd.pacman_total_product_revenue,\n  pd.pacman_sum_of_fiscal_years,\n  -- Specific metric for Fiscal Year 2025 from PACMAN data\n  CASE WHEN COALESCE(ed.fiscal_year, pd.fiscal_year) = 2025 THEN pd.pacman_total_product_revenue ELSE NULL END AS pacman_2025_product_revenue\nFROM\n  exclude_data AS ed\nFULL OUTER JOIN\n  pacman_data AS pd\nON\n  ed.fiscal_year = pd.fiscal_year AND ed.product_l3 = pd.product_l3\nWHERE\n  COALESCE(ed.fiscal_year, pd.fiscal_year) IS NOT NULL -- Ensure at least one year is present\nORDER BY\n  fiscal_year DESC, product_l3\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.Fiscal_Year AS INT64)) as unique_fiscal_years,\n  COUNT(DISTINCT SAFE_CAST(t0.Product_L3 AS STRING)) as unique_product_l3s,\n  MIN(SAFE_CAST(t0.Fiscal_Year AS INT64)) as earliest_fiscal_year,\n  MAX(SAFE_CAST(t0.Fiscal_Year AS INT64)) as latest_fiscal_year,\n  APPROX_COUNT_DISTINCT(CONCAT(SAFE_CAST(t0.Fiscal_Year AS STRING), '-', SAFE_CAST(t0.Product_L3 AS STRING))) as approx_unique_year_l3_combinations\nFROM \n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\nWHERE \n  SAFE_CAST(t0.Fiscal_Year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 5 -- Last 5 fiscal years for structure analysis\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.Product_Revenue AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as product_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.Fiscal_Year AS INT64)) > 0 THEN 'PASS' ELSE 'FAIL' END as fiscal_year_test,\n  CASE WHEN MAX(SAFE_CAST(t0.Fiscal_Year AS INT64)) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as freshness_test_fiscal_year,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.Product_L3 AS STRING) IS NOT NULL THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as product_l3_not_null_test\nFROM \n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\nWHERE \n  SAFE_CAST(t0.Fiscal_Year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Last 2 fiscal years for validation\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'fiscal_year_2025_revenue_check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN SAFE_CAST(t0.Fiscal_Year AS INT64) = 2025 AND SAFE_CAST(t0.Product_Revenue AS NUMERIC) > 0 THEN 1 ELSE 0 END) as records_matching_2025_revenue,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE_CAST(t0.Fiscal_Year AS INT64) = 2025 AND SAFE_CAST(t0.Product_Revenue AS NUMERIC) > 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_of_records_in_2025_with_revenue\nFROM \n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\nWHERE \n  SAFE_CAST(t0.Fiscal_Year AS INT64) = 2025 -- Focus on the hardcoded year for validation\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(t0.Fiscal_Year AS INT64) AS fiscal_year,\n  SAFE_CAST(t0.Product_L3 AS STRING) AS product_l3,\n  SAFE_CAST(t0.Product_Revenue AS NUMERIC) AS product_revenue,\n  -- Add other relevant columns from dv_pacman_running_expense if available and useful for sampling\n  -- e.g., SAFE_CAST(t0.SomeOtherDimension AS STRING) AS some_other_dimension\nFROM \n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\nWHERE \n  SAFE_CAST(t0.Fiscal_Year AS INT64) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Last fiscal year for sample\n  AND SAFE_CAST(t0.Product_Revenue AS NUMERIC) IS NOT NULL\nORDER BY \n  fiscal_year DESC, product_revenue DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Used as a filter for Fiscal_Year in a revenue calculation."",
          ""suggested_fix"": ""Replace with a Looker Studio parameter (e.g., @fiscal_year) or relative year logic (e.g., EXTRACT(YEAR FROM CURRENT_DATE()) + 1 for next fiscal year)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Category'"",
            ""'Product_Name'"",
            ""'Product_L1'"",
            ""'Product_L2'"",
            ""'Product_L3'"",
            ""'Product_L4'""
          ],
          ""context"": ""Used in a CASE statement to dynamically select a product hierarchy dimension based on a hardcoded string comparison. This typically indicates a Looker Studio parameter is being used, but the parameter's value is hardcoded in the SQL."",
          ""suggested_governance"": ""Ensure the Looker Studio parameter is correctly configured and passed, or if this is meant to be static, consider a more robust way to define the dimension selection. Ideally, these category names should come from a governed lookup table if they represent business categories."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year '2025' with a Looker Studio parameter (e.g., `_fiscal_year_param`) to allow dynamic selection of the reporting year."",
      ""Replace hardcoded dimension selection strings (e.g., 'Category', 'Product_Name') with a Looker Studio parameter that maps to the desired column name, allowing users to switch dimensions without modifying SQL."",
      ""Consider creating a configuration table for dynamic dimension mapping if the logic becomes more complex.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""product_revenue_merged_one_row_sum"",
      ""metric_name"": ""Sum of Product Revenue (Merged One Row)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue, potentially pre-aggregated or merged to a single row per product/category for specific reporting needs. This metric comes from the 'exclude LOD' dataset."",
      ""sql_logic"": ""SUM(t0.Product_Revenue_Merged_OneRow)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for analysis by margin level and various product hierarchies, often used for consolidated views."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for double counting if not correctly merged upstream"",
        ""Nulls in revenue column""
      ]
    },
    {
      ""metric_id"": ""product_revenue_sum"",
      ""metric_name"": ""Sum of Product Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue, likely the raw or base revenue figure before any specific merging. This metric comes from the 'exclude LOD' dataset."",
      ""sql_logic"": ""SUM(t0.Product_Revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for analysis by margin level and various product hierarchies, representing the un-merged revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Nulls in revenue column""
      ]
    },
    {
      ""metric_id"": ""margin_level"",
      ""metric_name"": ""Margin Level"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of products based on their profit margin."",
      ""sql_logic"": ""t0.Margin_Level"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue and product performance by profitability."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Inconsistent naming conventions"",
        ""Missing values""
      ]
    },
    {
      ""metric_id"": ""dynamic_product_category"",
      ""metric_name"": ""Dynamic Product Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flexible dimension that can represent different product hierarchy levels (Category, Product Name, L1-L4) based on user selection in the dashboard. The selection is driven by a Looker Studio parameter."",
      ""sql_logic"": ""CASE WHEN ('Category' = 'Category') THEN t0.Category WHEN ('Category' = 'Product_Name') THEN t0.Product_Name WHEN ('Category' = 'Product_L1') THEN t0.Product_L1 WHEN ('Category' = 'Product_L2') THEN t0.Product_L2 WHEN ('Category' = 'Product_L3') THEN t0.Product_L3 WHEN ('Category' = 'Product_L4') THEN t0.Product_L4 ELSE t0.Category END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows users to drill down or aggregate product data at various levels of granularity for the 'exclude LOD' analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Category'"",
        ""'Product_Name'"",
        ""'Product_L1'"",
        ""'Product_L2'"",
        ""'Product_L3'"",
        ""'Product_L4'""
      ],
      ""governance_issues"": [
        ""Hardcoded strings for dimension selection; should be replaced by a Looker Studio parameter or a lookup table for category types.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if underlying product hierarchy data is incomplete.""
      ]
    },
    {
      ""metric_id"": ""fiscal_year_2025_product_revenue_sum"",
      ""metric_name"": ""Sum of Product Revenue for Fiscal Year 2025"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total product revenue specifically for the fiscal year 2025, likely representing a target or forecast from the PACMAN running expense dataset."",
      ""sql_logic"": ""SUM(t0.Product_Revenue) WHERE t0.Fiscal_Year = 2025"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [
        ""Fiscal_Year = 2025""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track performance against a specific fiscal year's revenue target or forecast within the PACMAN context."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded fiscal year; should be replaced by a Looker Studio parameter or relative date logic.""
      ],
      ""data_quality_concerns"": [
        ""Nulls in revenue column"",
        ""Accuracy of 2025 data if it's a forecast.""
      ]
    },
    {
      ""metric_id"": ""sum_of_fiscal_years_by_product_l3"",
      ""metric_name"": ""Sum of Fiscal Years by Product L3"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of fiscal year values grouped by Product L3. This is an unusual metric. It might represent a count of years associated with a product, or a weighted sum, or potentially a misinterpretation of the original intent (e.g., `Fiscal_Year` was meant to be a count of records per year, not summed directly). This metric comes from the PACMAN running expense dataset."",
      ""sql_logic"": ""SUM(t0.Fiscal_Year)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Potentially used to understand which Product L3 categories have data across more fiscal years or have higher 'fiscal year values' associated with them. Requires clarification on business meaning."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Unclear business meaning for summing `Fiscal_Year`.""
      ],
      ""data_quality_concerns"": [
        ""Misinterpretation of `Fiscal_Year` as a summable metric.""
      ]
    },
    {
      ""metric_id"": ""product_l3"",
      ""metric_name"": ""Product L3"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The third level of product hierarchy, common across both datasets."",
      ""sql_logic"": ""t0.Product_L3"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense"",
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to group and analyze metrics at a specific product hierarchy level across different financial views."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Missing values"",
        ""Inconsistent naming conventions.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fiscal_year_2025_product_revenue_sum"",
      ""related_metrics"": [
        ""product_revenue_sum"",
        ""fiscal_year""
      ],
      ""relationship_description"": ""This metric is a specific slice of 'Product Revenue Sum' filtered for the hardcoded Fiscal Year 2025."",
      ""mathematical_formula"": ""SUM(Product_Revenue) WHERE Fiscal_Year = 2025"",
      ""business_validation"": ""Ensures that the 2025 revenue target/forecast is correctly isolated from the overall product revenue."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(Product_Revenue AS NUMERIC)) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` WHERE SAFE_CAST(Fiscal_Year AS INT64) = 2025;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""dynamic_product_category"",
      ""related_metrics"": [
        ""product_l3"",
        ""product_l4"",
        ""product_l1"",
        ""product_l2"",
        ""product_name"",
        ""category""
      ],
      ""relationship_description"": ""The 'Dynamic Product Category' dimension allows users to switch between different levels of product hierarchy (L1, L2, L3, L4, Product Name, or a general Category) for analysis."",
      ""mathematical_formula"": ""CASE WHEN parameter = 'Product_L3' THEN Product_L3 ... END"",
      ""business_validation"": ""Provides flexible reporting on product performance at various aggregation levels."",
      ""validation_sql"": ""SELECT DISTINCT SAFE_CAST(Product_L3 AS STRING) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""comparison"",
      ""primary_metric"": ""product_revenue_sum"",
      ""related_metrics"": [
        ""product_revenue_merged_one_row_sum""
      ],
      ""relationship_description"": ""These two metrics represent product revenue, but 'Merged One Row' suggests a specific aggregation or de-duplication logic applied upstream. Comparing them can reveal the impact of this merging process."",
      ""mathematical_formula"": ""N/A (comparison)"",
      ""business_validation"": ""Understanding the difference between raw and merged revenue is crucial for data accuracy and consistency in reporting."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(Product_Revenue AS NUMERIC)) AS raw_revenue, SUM(SAFE_CAST(Product_Revenue_Merged_OneRow AS NUMERIC)) AS merged_revenue FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` WHERE SAFE_CAST(Fiscal_Year AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,38
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d7412673-0af1-4efe-8374-ca475b001fb6"",
    ""dashboard_name"": ""Finance OS datasource template report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 36,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year"",
      ""source_system_name"",
      ""gl_publication_code"",
      ""fiscal_week_id"",
      ""os_level_1"",
      ""os_level_2"",
      ""os_level_3"",
      ""os_level_4"",
      ""os_level_5"",
      ""os_level_6"",
      ""os_level_7"",
      ""os_level_8"",
      ""os_level_9"",
      ""os_level_10"",
      ""os_level_11"",
      ""os_level_12"",
      ""state"",
      ""day_of_week""
    ],
    ""date_range_detected"": ""Relative to Current Period (CP) and Prior Year (PY) based on fiscal week"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""period_name filter ('CP', 'PY') should be parameterized or driven by a configuration table"",
      ""The 'calender_table' CTE is defined but not used in the provided queries, indicating potential dead code or incomplete development.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates the logic from the provided Looker Studio queries to extract key metrics and dimensions.\n-- It aggregates Actual_Amount and counts records, grouped by fiscal year and source system name.\n-- It also includes other key measures for a comprehensive view.\n\nWITH\n  OSandFACT AS (\n    SELECT\n      os.source_system_name,\n      os.sub_source_system_name,\n      SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n      os.gl_publication_code,\n      os.day_of_week,\n      os.state,\n      os.os_level_1,\n      os.os_level_2,\n      os.os_level_3,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_8,\n      os.os_level_9,\n      os.os_level_10,\n      os.os_level_11,\n      os.os_level_12,\n      SAFE_CAST(os.Estimate AS NUMERIC) AS Estimate,\n      SAFE_CAST(os.True_Up_Adjustment AS NUMERIC) AS True_Up_Adjustment,\n      SAFE_CAST(os.Actual_Amount AS NUMERIC) AS Actual_Amount,\n      SAFE_CAST(os.volume AS NUMERIC) AS volume,\n      SAFE_CAST(os.Last_Year_Actual_Amount AS NUMERIC) AS Last_Year_Actual_Amount,\n      SAFE_CAST(os.Last_Year_volume AS NUMERIC) AS Last_Year_volume,\n      SAFE_CAST(os.Budget_Draft_Amount AS NUMERIC) AS Budget_Draft_Amount,\n      SAFE_CAST(os.Budget_Draft_Volume AS NUMERIC) AS Budget_Draft_Volume,\n      SAFE_CAST(os.Budget_Amount AS NUMERIC) AS Budget_Amount,\n      SAFE_CAST(os.Budget_Volume AS NUMERIC) AS Budget_Volume,\n      SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS Forecast_Amount,\n      SAFE_CAST(os.Forecast_Volume AS NUMERIC) AS Forecast_Volume,\n      SAFE_CAST(os.Budget_Jan_Amount AS NUMERIC) AS Budget_Jan_Amount,\n      SAFE_CAST(os.Budget_Jan_Volume AS NUMERIC) AS Budget_Jan_Volume,\n      SAFE_CAST(os.Budget_Feb_Amount AS NUMERIC) AS Budget_Feb_Amount,\n      SAFE_CAST(os.Budget_Feb_Volume AS NUMERIC) AS Budget_Feb_Volume,\n      SAFE_CAST(os.Budget_Mar_Amount AS NUMERIC) AS Budget_Mar_Amount,\n      SAFE_CAST(os.Budget_Mar_Volume AS NUMERIC) AS Budget_Mar_Volume,\n      SAFE_CAST(os.Budget_Apr_Amount AS NUMERIC) AS Budget_Apr_Amount,\n      SAFE_CAST(os.Budget_Apr_Volume AS NUMERIC) AS Budget_Apr_Volume,\n      SAFE_CAST(os.Budget_May_Amount AS NUMERIC) AS Budget_May_Amount,\n      SAFE_CAST(os.Budget_May_Volume AS NUMERIC) AS Budget_May_Volume,\n      SAFE_CAST(os.Budget_Jun_Amount AS NUMERIC) AS Budget_Jun_Amount,\n      SAFE_CAST(os.Budget_Jun_Volume AS NUMERIC) AS Budget_Jun_Volume,\n      SAFE_CAST(os.Budget_Jul_Amount AS NUMERIC) AS Budget_Jul_Amount,\n      SAFE_CAST(os.Budget_Jul_Volume AS NUMERIC) AS Budget_Jul_Volume,\n      SAFE_CAST(os.Budget_Aug_Amount AS NUMERIC) AS Budget_Aug_Amount,\n      SAFE_CAST(os.Budget_Aug_Volume AS NUMERIC) AS Budget_Aug_Volume,\n      SAFE_CAST(os.Budget_Sep_Amount AS NUMERIC) AS Budget_Sep_Amount,\n      SAFE_CAST(os.Budget_Sep_Volume AS NUMERIC) AS Budget_Sep_Volume,\n      SAFE_CAST(os.Budget_Oct_Amount AS NUMERIC) AS Budget_Oct_Amount,\n      SAFE_CAST(os.Budget_Oct_Volume AS NUMERIC) AS Budget_Oct_Volume,\n      SAFE_CAST(os.Budget_Nov_Amount AS NUMERIC) AS Budget_Nov_Amount,\n      SAFE_CAST(os.Budget_Nov_Volume AS NUMERIC) AS Budget_Nov_Volume,\n      SAFE_CAST(os.Budget_Dec_Amount AS NUMERIC) AS Budget_Dec_Amount,\n      SAFE_CAST(os.Budget_Dec_Volume AS NUMERIC) AS Budget_Dec_Volume,\n      SAFE_CAST(os.Forecast_Q1F_Amount AS NUMERIC) AS Forecast_Q1F_Amount,\n      SAFE_CAST(os.Forecast_Q1F_Volume AS NUMERIC) AS Forecast_Q1F_Volume,\n      SAFE_CAST(os.Forecast_Q2F_Amount AS NUMERIC) AS Forecast_Q2F_Amount,\n      SAFE_CAST(os.Forecast_Q2F_Volume AS NUMERIC) AS Forecast_Q2F_Volume,\n      SAFE_CAST(os.Forecast_Q3F_Amount AS NUMERIC) AS Forecast_Q3F_Amount,\n      SAFE_CAST(os.Forecast_Q3F_Volume AS NUMERIC) AS Forecast_Q3F_Volume,\n      SAFE_CAST(os.Forecast_Q4F_Amount AS NUMERIC) AS Forecast_Q4F_Amount,\n      SAFE_CAST(os.Forecast_Q4F_Volume AS NUMERIC) AS Forecast_Q4F_Volume,\n      SAFE_CAST(os.Forecast_Q5F_Amount AS NUMERIC) AS Forecast_Q5F_Amount,\n      SAFE_CAST(os.Forecast_Q5F_Volume AS NUMERIC) AS Forecast_Q5F_Volume,\n      SAFE_CAST(calendar.fy_year AS INT64) AS fy_year,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      SAFE_CAST(calendar.fy_year_week_number AS INT64) AS fy_year_week_number,\n      SAFE_CAST(calendar.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n      SAFE_CAST(calendar.fy_last_day_of_week AS DATE) AS fy_last_day_of_week\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          SAFE_CAST(c.fy_week_of_year AS INT64) AS fy_week_of_year,\n          SAFE_CAST(c.fy_year_week_number AS INT64) AS fy_year_week_number,\n          SAFE_CAST(c.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n          SAFE_CAST(c.fy_last_day_of_week AS DATE) AS fy_last_day_of_week,\n          SAFE_CAST(c.fy_month_of_year AS INT64) AS fy_month_of_year,\n          SAFE_CAST(c.fy_year_month_number AS INT64) AS fy_year_month_number,\n          SAFE_CAST(c.relative_fisc_year_number AS INT64) AS relative_fisc_year_number,\n          SAFE_CAST(c.relative_fisc_week_number AS INT64) AS relative_fisc_week_number,\n          c.fy_month_of_year_short_name,\n          CASE\n            WHEN SAFE_CAST(c.fy_last_day_of_week AS DATE) = SAFE_CAST(c.fy_last_day_of_month AS DATE) THEN 'Y'\n            ELSE 'N'\n          END AS month_end_flag,\n          SAFE_CAST(c.fy_quarter_of_year AS INT64) AS fy_quarter_of_year,\n          SAFE_CAST(c.fy_year AS INT64) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n            ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64)\n            AND control.period_name IN ('CP', 'PY') -- Hardcoded values identified\n        WHERE\n          1 = 1\n      ) AS calendar\n        ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department` AS dep\n        ON os.os_level_12 = dep.department_code\n  )\nSELECT\n  fy_year,\n  source_system_name,\n  gl_publication_code,\n  fiscal_week_id,\n  fy_first_day_of_week,\n  fy_last_day_of_week,\n  month_end_flag,\n  SUM(Actual_Amount) AS total_actual_amount,\n  SUM(Estimate) AS total_estimate,\n  SUM(True_Up_Adjustment) AS total_true_up_adjustment,\n  SUM(volume) AS total_volume,\n  SUM(Last_Year_Actual_Amount) AS total_last_year_actual_amount,\n  SUM(Budget_Amount) AS total_budget_amount,\n  SUM(Forecast_Amount) AS total_forecast_amount,\n  COUNT(1) AS record_count\nFROM\n  OSandFACT\nWHERE\n  fy_first_day_of_week >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) -- Example date filter for recent data\nGROUP BY\n  fy_year,\n  source_system_name,\n  gl_publication_code,\n  fiscal_week_id,\n  fy_first_day_of_week,\n  fy_last_day_of_week,\n  month_end_flag\nORDER BY\n  fy_year DESC, fiscal_week_id DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""-- Query to understand the data structure, grain, and key dimensions of the primary fact table.\n-- Focuses on recent data to give a relevant snapshot.\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(fiscal_week_id AS INT64)) AS unique_fiscal_weeks_in_sample,\n  COUNT(DISTINCT source_system_name) AS unique_source_systems,\n  COUNT(DISTINCT gl_publication_code) AS unique_publication_codes,\n  MIN(SAFE_CAST(fiscal_week_id AS INT64)) AS earliest_fiscal_week_id_in_sample,\n  MAX(SAFE_CAST(fiscal_week_id AS INT64)) AS latest_fiscal_week_id_in_sample,\n  MIN(SAFE_CAST(Actual_Amount AS NUMERIC)) AS min_actual_amount,\n  MAX(SAFE_CAST(Actual_Amount AS NUMERIC)) AS max_actual_amount,\n  APPROX_COUNT_DISTINCT(CONCAT(source_system_name, '-', SAFE_CAST(fiscal_week_id AS STRING), '-', gl_publication_code)) AS approx_unique_grain_combinations\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  SAFE_CAST(fiscal_week_id AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)) AS INT64) -- Filter for recent fiscal weeks\nLIMIT 1;\n"",
    ""validation_sql"": ""-- Quick validation query to check data freshness, presence of key metrics, and filter effectiveness.\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.Actual_Amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS actual_amount_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.source_system_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS source_system_present_test,\n  CASE WHEN MAX(SAFE_CAST(calendar.fy_last_day_of_week AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test,\n  CASE WHEN COUNT(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS period_control_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON SAFE_CAST(t0.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n    ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(calendar.fy_last_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) -- Limit to recent data for validation\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate the business rule applied in the calendar join condition: `period_name IN ('CP', 'PY')`.\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Period Control Filter' AS rule_name,\n  COUNT(DISTINCT SAFE_CAST(c.fy_year_week_number AS INT64)) AS total_unique_weeks_in_calendar,\n  COUNT(DISTINCT CASE WHEN control.period_name IN ('CP', 'PY') THEN SAFE_CAST(c.fy_year_week_number AS INT64) END) AS unique_weeks_passing_period_filter,\n  SAFE_DIVIDE(\n    COUNT(DISTINCT CASE WHEN control.period_name IN ('CP', 'PY') THEN SAFE_CAST(c.fy_year_week_number AS INT64) END),\n    COUNT(DISTINCT SAFE_CAST(c.fy_year_week_number AS INT64))\n  ) * 100 AS percentage_weeks_passing_filter\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n  JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n    ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(c.fy_year_week_number AS INT64)\nWHERE\n  SAFE_CAST(c.fy_year AS INT64) >= SAFE_CAST(FORMAT_DATE('%Y', DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)) AS INT64) -- Filter for recent years\nLIMIT 1;\n"",
    ""sample_data_sql"": ""-- Query to retrieve a representative sample of data, including key dimensions and measures.\n-- Useful for understanding the raw data structure and values.\nSELECT\n  SAFE_CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) AS fy_first_day_of_week,\n  SAFE_CAST(calendar.fy_year AS INT64) AS fy_year,\n  os.source_system_name,\n  os.gl_publication_code,\n  os.os_level_1,\n  os.os_level_12,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) AS actual_amount,\n  SAFE_CAST(os.Budget_Amount AS NUMERIC) AS budget_amount,\n  SAFE_CAST(os.Forecast_Amount AS NUMERIC) AS forecast_amount,\n  SAFE_CAST(os.volume AS NUMERIC) AS volume\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control\n    ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64)\n    AND control.period_name IN ('CP', 'PY')\nWHERE\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Sample from recent data\n  AND os.Actual_Amount IS NOT NULL\nORDER BY\n  SAFE_CAST(calendar.fy_first_day_of_week AS DATE) DESC,\n  SAFE_CAST(os.Actual_Amount AS NUMERIC) DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""period_name filter in the calendar join condition"",
          ""suggested_governance"": ""Replace with a parameter or join to a configuration table that defines active periods."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded period names ('CP', 'PY') with a parameter or a dynamic lookup from a control table to allow for flexible period selection without modifying the query."",
      ""Introduce date parameters for filtering the overall data range, enabling users to select specific fiscal years or weeks.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""source_system_name"",
      ""metric_name"": ""Source System Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the source system from which the financial data originated."",
      ""sql_logic"": ""t0.source_system_name"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting financial data by its origin."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year associated with the financial data."",
      ""sql_logic"": ""CAST(c.fy_year AS int)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for financial reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual financial amount recorded for a given period/transaction."",
      ""sql_logic"": ""t0.Actual_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric representing realized revenue or expenditure."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls if data is missing for certain periods/dimensions.""
      ]
    },
    {
      ""metric_id"": ""total_actual_amount"",
      ""metric_name"": ""Total Actual Amount"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""actual_amount""
      ],
      ""business_description"": ""The sum of Actual Amounts, typically aggregated by fiscal year and source system."",
      ""sql_logic"": ""SUM(t0.Actual_Amount)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [
        ""period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for overall financial performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_count"",
      ""metric_name"": ""Source System Count"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""source_system_name""
      ],
      ""business_description"": ""The count of records, grouped by source system name."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [
        ""period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the distribution of data across different source systems."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a fiscal week, used for joining with calendar dimensions."",
      ""sql_logic"": ""CAST(fiscal_week_id AS int)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for weekly financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger publication code, used to link to publication hierarchy."",
      ""sql_logic"": ""gl_publication_code"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting financial data by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""month_end_flag"",
      ""metric_name"": ""Month End Flag"",
      ""metric_type"": ""derived_dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Indicates if the fiscal week's last day is also the last day of the fiscal month ('Y' or 'N')."",
      ""sql_logic"": ""CASE WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y' ELSE 'N' END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Useful for filtering or grouping data to analyze month-end performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""estimate"",
      ""metric_name"": ""Estimate Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Estimated financial amount."",
      ""sql_logic"": ""Estimate"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for comparison against actuals and budgets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""true_up_adjustment"",
      ""metric_name"": ""True Up Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Adjustment amount for true-up purposes."",
      ""sql_logic"": ""True_Up_Adjustment"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to reconcile financial figures."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""volume"",
      ""metric_name"": ""Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume associated with financial transactions."",
      ""sql_logic"": ""volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to understand the scale of operations alongside financial amounts."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_actual_amount"",
      ""metric_name"": ""Last Year Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Actual financial amount from the previous fiscal year."",
      ""sql_logic"": ""Last_Year_Actual_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_volume"",
      ""metric_name"": ""Last Year Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume from the previous fiscal year."",
      ""sql_logic"": ""Last_Year_volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year volume comparisons."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_draft_amount"",
      ""metric_name"": ""Budget Draft Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Draft budget amount."",
      ""sql_logic"": ""Budget_Draft_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Initial budget figures for planning."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_draft_volume"",
      ""metric_name"": ""Budget Draft Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Draft budget volume."",
      ""sql_logic"": ""Budget_Draft_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Initial budget volume figures for planning."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Approved budget amount."",
      ""sql_logic"": ""Budget_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key financial target for comparison against actuals."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_volume"",
      ""metric_name"": ""Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Approved budget volume."",
      ""sql_logic"": ""Budget_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key volume target for comparison against actuals."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecasted financial amount."",
      ""sql_logic"": ""Forecast_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for re-forecasting and understanding expected performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_volume"",
      ""metric_name"": ""Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecasted volume."",
      ""sql_logic"": ""Forecast_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for re-forecasting and understanding expected volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jan_amount"",
      ""metric_name"": ""Budget January Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for January."",
      ""sql_logic"": ""Budget_Jan_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jan_volume"",
      ""metric_name"": ""Budget January Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for January."",
      ""sql_logic"": ""Budget_Jan_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_feb_amount"",
      ""metric_name"": ""Budget February Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for February."",
      ""sql_logic"": ""Budget_Feb_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_feb_volume"",
      ""metric_name"": ""Budget February Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for February."",
      ""sql_logic"": ""Budget_Feb_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_mar_amount"",
      ""metric_name"": ""Budget March Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for March."",
      ""sql_logic"": ""Budget_Mar_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_mar_volume"",
      ""metric_name"": ""Budget March Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for March."",
      ""sql_logic"": ""Budget_Mar_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_apr_amount"",
      ""metric_name"": ""Budget April Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for April."",
      ""sql_logic"": ""Budget_Apr_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_apr_volume"",
      ""metric_name"": ""Budget April Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for April."",
      ""sql_logic"": ""Budget_Apr_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_may_amount"",
      ""metric_name"": ""Budget May Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for May."",
      ""sql_logic"": ""Budget_May_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_may_volume"",
      ""metric_name"": ""Budget May Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for May."",
      ""sql_logic"": ""Budget_May_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jun_amount"",
      ""metric_name"": ""Budget June Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for June."",
      ""sql_logic"": ""Budget_Jun_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jun_volume"",
      ""metric_name"": ""Budget June Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for June."",
      ""sql_logic"": ""Budget_Jun_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jul_amount"",
      ""metric_name"": ""Budget July Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for July."",
      ""sql_logic"": ""Budget_Jul_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_jul_volume"",
      ""metric_name"": ""Budget July Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for July."",
      ""sql_logic"": ""Budget_Jul_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_aug_amount"",
      ""metric_name"": ""Budget August Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for August."",
      ""sql_logic"": ""Budget_Aug_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_aug_volume"",
      ""metric_name"": ""Budget August Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for August."",
      ""sql_logic"": ""Budget_Aug_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_sep_amount"",
      ""metric_name"": ""Budget September Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for September."",
      ""sql_logic"": ""Budget_Sep_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_sep_volume"",
      ""metric_name"": ""Budget September Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for September."",
      ""sql_logic"": ""Budget_Sep_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_oct_amount"",
      ""metric_name"": ""Budget October Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for October."",
      ""sql_logic"": ""Budget_Oct_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_oct_volume"",
      ""metric_name"": ""Budget October Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for October."",
      ""sql_logic"": ""Budget_Oct_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_nov_amount"",
      ""metric_name"": ""Budget November Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for November."",
      ""sql_logic"": ""Budget_Nov_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_nov_volume"",
      ""metric_name"": ""Budget November Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for November."",
      ""sql_logic"": ""Budget_Nov_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_dec_amount"",
      ""metric_name"": ""Budget December Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget amount for December."",
      ""sql_logic"": ""Budget_Dec_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_dec_volume"",
      ""metric_name"": ""Budget December Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budget volume for December."",
      ""sql_logic"": ""Budget_Dec_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monthly budget breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q1f_amount"",
      ""metric_name"": ""Forecast Q1F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast amount for Fiscal Quarter 1."",
      ""sql_logic"": ""Forecast_Q1F_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q1f_volume"",
      ""metric_name"": ""Forecast Q1F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast volume for Fiscal Quarter 1."",
      ""sql_logic"": ""Forecast_Q1F_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q2f_amount"",
      ""metric_name"": ""Forecast Q2F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast amount for Fiscal Quarter 2."",
      ""sql_logic"": ""Forecast_Q2F_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q2f_volume"",
      ""metric_name"": ""Forecast Q2F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast volume for Fiscal Quarter 2."",
      ""sql_logic"": ""Forecast_Q2F_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q3f_amount"",
      ""metric_name"": ""Forecast Q3F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast amount for Fiscal Quarter 3."",
      ""sql_logic"": ""Forecast_Q3F_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q3f_volume"",
      ""metric_name"": ""Forecast Q3F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast volume for Fiscal Quarter 3."",
      ""sql_logic"": ""Forecast_Q3F_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q4f_amount"",
      ""metric_name"": ""Forecast Q4F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast amount for Fiscal Quarter 4."",
      ""sql_logic"": ""Forecast_Q4F_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q4f_volume"",
      ""metric_name"": ""Forecast Q4F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast volume for Fiscal Quarter 4."",
      ""sql_logic"": ""Forecast_Q4F_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q5f_amount"",
      ""metric_name"": ""Forecast Q5F Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast amount for Fiscal Quarter 5 (if applicable)."",
      ""sql_logic"": ""Forecast_Q5F_Amount"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_q5f_volume"",
      ""metric_name"": ""Forecast Q5F Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecast volume for Fiscal Quarter 5 (if applicable)."",
      ""sql_logic"": ""Forecast_Q5F_Volume"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Quarterly forecast breakdown for detailed analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""actual_amount""
      ],
      ""relationship_description"": ""Total Actual Amount is the sum of individual Actual Amounts."",
      ""mathematical_formula"": ""SUM(Actual_Amount)"",
      ""business_validation"": ""Ensures that the aggregated actuals accurately reflect the sum of underlying transactions."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(Actual_Amount AS NUMERIC)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE SAFE_CAST(fiscal_week_id AS INT64) = (SELECT MAX(SAFE_CAST(fiscal_week_id AS INT64)) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` LIMIT 1);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""fy_year"",
        ""source_system_name""
      ],
      ""relationship_description"": ""Total Actual Amount is calculated after filtering by period control and grouped by Fiscal Year and Source System Name."",
      ""mathematical_formula"": ""SUM(Actual_Amount) GROUP BY fy_year, source_system_name"",
      ""business_validation"": ""Ensures that financial totals are presented within the correct fiscal periods and organizational segments."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(calendar.fy_year AS INT64)), COUNT(DISTINCT os.source_system_name) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON SAFE_CAST(os.fiscal_week_id AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64) JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control` AS control ON SAFE_CAST(control.source_week_number AS INT64) = SAFE_CAST(calendar.fy_year_week_number AS INT64) WHERE control.period_name IN ('CP', 'PY') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""comparison"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""budget_amount"",
        ""forecast_amount"",
        ""last_year_actual_amount""
      ],
      ""relationship_description"": ""Actual Amount is frequently compared against Budget, Forecast, and Last Year's Actuals to assess performance."",
      ""mathematical_formula"": ""Actual vs. Budget (Actual - Budget), Actual vs. Forecast (Actual - Forecast), YoY Growth ((Actual - Last_Year_Actual) / Last_Year_Actual)"",
      ""business_validation"": ""These comparisons are fundamental for financial performance analysis, variance reporting, and strategic planning."",
      ""validation_sql"": ""SELECT SAFE_CAST(Actual_Amount AS NUMERIC) - SAFE_CAST(Budget_Amount AS NUMERIC) AS actual_vs_budget_variance FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE Actual_Amount IS NOT NULL AND Budget_Amount IS NOT NULL LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,39
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""57d87efe-c112-4d42-be1b-045f0c8ca73e"",
    ""dashboard_name"": ""Commercial Finance Scorecards"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 76,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [""fy_year"", ""fy_week_of_year"", ""masthead""],
    ""date_range_detected"": ""Fiscal Year 2025 (from July 2024) with focus on weeks around Feb-March 2025"",
    ""hardcoded_dates_found"": [""2025-03-30"", ""2024-07-03"", ""2025-02-10""],
    ""hardcoded_values_found"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52"", ""'TA'"", ""'DT'"", ""'HS'"", ""'WT'"", ""'GA'"", ""'CM'"", ""'CP'"", ""'TB'"", ""'TC'"", ""'GC'"", ""'TM'"", ""'NT'"", ""'AA'"", ""'States and Community'"", ""'The Australian and Prestige'"", ""'Metro'"", ""'Regionals'"", ""'All Mastheads'""],
    ""governance_opportunities"": [""dates should be parameterised or use relative functions"", ""masthead codes should join to a masthead_lookup table"", ""fiscal year/week logic should be externalized or parameterized""]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together for the latest available fiscal week\nWITH\n  base_data AS (\n    SELECT\n      t0.*, -- Select all columns from the source table\n      -- Derived masthead dimensions for grouping and filtering\n      CASE\n        WHEN t0.masthead = 'TA' THEN 'The Australian'\n        WHEN t0.masthead = 'DT' THEN 'Daily Telegraph'\n        WHEN t0.masthead = 'HS' THEN 'Herald Sun'\n        WHEN t0.masthead = 'WT' THEN 'Weekly Times'\n        WHEN t0.masthead = 'GA' THEN 'Geelong Advertiser'\n        WHEN t0.masthead = 'CM' THEN 'Courier Mail'\n        WHEN t0.masthead = 'CP' THEN 'Cairns Post'\n        WHEN t0.masthead = 'TB' THEN 'Townsville Bulletin'\n        WHEN t0.masthead = 'TC' THEN 'Toowoomba Chronicles'\n        WHEN t0.masthead = 'GC' THEN 'Gold Coast'\n        WHEN t0.masthead = 'TM' THEN 'The Mercury'\n        WHEN t0.masthead = 'NT' THEN 'NT News'\n        WHEN t0.masthead = 'AA' THEN 'The Advertiser'\n        ELSE NULL\n      END AS masthead_name,\n      CASE\n        WHEN t0.masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT') THEN 'States and Community'\n        WHEN t0.masthead = 'TA' THEN 'The Australian and Prestige'\n        ELSE NULL\n      END AS masthead_group_states_community,\n      CASE\n        WHEN t0.masthead IN ('CM', 'DT', 'HS', 'AA') THEN 'Metro'\n        WHEN t0.masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT') THEN 'Regionals'\n        ELSE NULL\n      END AS masthead_group_metro_regionals\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` AS t0\n    WHERE\n      -- Filter for recent data to optimize query cost and relevance\n      t0.fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Data from current and previous calendar year\n  ),\n  latest_fiscal_period AS (\n    SELECT\n      MAX(fy_year) AS latest_fy_year,\n      MAX(fy_week_of_year) AS latest_fy_week\n    FROM\n      base_data\n    WHERE\n      fy_year = (SELECT MAX(fy_year) FROM base_data) -- Get latest week for the latest year\n  )\nSELECT\n  bd.fy_year,\n  bd.fy_week_of_year,\n  bd.masthead,\n  bd.masthead_name,\n  bd.masthead_group_states_community,\n  bd.masthead_group_metro_regionals,\n  -- Current Period Metrics (from _V and base columns)\n  SUM(SAFE_CAST(bd.Always_on_Digital_Sales_V AS NUMERIC)) AS Always_on_Digital_Sales_V,\n  SUM(SAFE_CAST(bd.Breach_Sales_V AS NUMERIC)) AS Breach_Sales_V,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_V AS NUMERIC)) AS Closing_Base_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Essentials_V AS NUMERIC)) AS Essentials_V,\n  SUM(SAFE_CAST(bd.General_Offer_Sales_V AS NUMERIC)) AS General_Offer_Sales_V,\n  SUM(SAFE_CAST(bd.Net_Cancels_V AS NUMERIC)) AS Net_Cancels_V,\n  SUM(SAFE_CAST(bd.Net_Growth_3rd_Party_V AS NUMERIC)) AS Net_Growth_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Net_Growth_Consumer_V AS NUMERIC)) AS Net_Growth_Consumer_V,\n  SUM(SAFE_CAST(bd.Net_Growth_incl_3rd_Party_V AS NUMERIC)) AS Net_Growth_incl_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Other_Sales_V AS NUMERIC)) AS Other_Sales_V,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_V AS NUMERIC)) AS Revenue_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Revenue_Campus_V AS NUMERIC)) AS Revenue_Campus_V,\n  SUM(SAFE_CAST(bd.Revenue_Consumer_V AS NUMERIC)) AS Revenue_Consumer_V,\n  SUM(SAFE_CAST(bd.Revenue_Corp_V AS NUMERIC)) AS Revenue_Corp_V,\n  SUM(SAFE_CAST(bd.Revenue_Other_V AS NUMERIC)) AS Revenue_Other_V,\n  SUM(SAFE_CAST(bd.Switches_V AS NUMERIC)) AS Switches_V,\n  SUM(SAFE_CAST(bd.Total_Cancels_excluding_3rd_Party_V AS NUMERIC)) AS Total_Cancels_excluding_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Total_Cancels_including_3rd_Party_V AS NUMERIC)) AS Total_Cancels_including_3rd_Party_V,\n  SUM(SAFE_CAST(bd.Total_Closing_Base_V AS NUMERIC)) AS Total_Closing_Base_V,\n  SUM(SAFE_CAST(bd.Total_Revenue_V AS NUMERIC)) AS Total_Revenue_V,\n  SUM(SAFE_CAST(bd.Total_Weekly_Sales_V AS NUMERIC)) AS Total_Weekly_Sales_V,\n  SUM(SAFE_CAST(bd.Always_on_Digital_Sales AS NUMERIC)) AS Always_on_Digital_Sales,\n  SUM(SAFE_CAST(bd.Breach_Sales AS NUMERIC)) AS Breach_Sales,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party AS NUMERIC)) AS Closing_Base_3rd_Party,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_APLS AS NUMERIC)) AS Closing_Base_3rd_Party_APLS,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_GPLA AS NUMERIC)) AS Closing_Base_3rd_Party_GPLA,\n  SUM(SAFE_CAST(bd.Closing_Base_Consumer AS NUMERIC)) AS Closing_Base_Consumer,\n  SUM(SAFE_CAST(bd.Essentials AS NUMERIC)) AS Essentials,\n  SUM(SAFE_CAST(bd.Failed_Payment_Volume AS NUMERIC)) AS Failed_Payment_Volume,\n  SUM(SAFE_CAST(bd.General_Offer_Sales AS NUMERIC)) AS General_Offer_Sales,\n  SUM(SAFE_CAST(bd.Net_Cancels AS NUMERIC)) AS Net_Cancels,\n  SUM(SAFE_CAST(bd.Net_Growth_3rd_Party AS NUMERIC)) AS Net_Growth_3rd_Party,\n  SUM(SAFE_CAST(bd.Net_Growth_3rd_Party_APLS AS NUMERIC)) AS Net_Growth_3rd_Party_APLS,\n  SUM(SAFE_CAST(bd.Net_Growth_3rd_Party_GPLA AS NUMERIC)) AS Net_Growth_3rd_Party_GPLA,\n  SUM(SAFE_CAST(bd.Net_Growth_Consumer AS NUMERIC)) AS Net_Growth_Consumer,\n  SUM(SAFE_CAST(bd.Net_Growth_incl_3rd_Party AS NUMERIC)) AS Net_Growth_incl_3rd_Party,\n  SUM(SAFE_CAST(bd.Other_Sales AS NUMERIC)) AS Other_Sales,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party AS NUMERIC)) AS Revenue_3rd_Party,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_APLS AS NUMERIC)) AS Revenue_3rd_Party_APLS,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_GPLA AS NUMERIC)) AS Revenue_3rd_Party_GPLA,\n  SUM(SAFE_CAST(bd.Revenue_Campus AS NUMERIC)) AS Revenue_Campus,\n  SUM(SAFE_CAST(bd.Revenue_Consumer AS NUMERIC)) AS Revenue_Consumer,\n  SUM(SAFE_CAST(bd.Revenue_Corp AS NUMERIC)) AS Revenue_Corp,\n  SUM(SAFE_CAST(bd.Revenue_Other AS NUMERIC)) AS Revenue_Other,\n  SUM(SAFE_CAST(bd.Switches AS NUMERIC)) AS Switches,\n  SUM(SAFE_CAST(bd.Total_Cancels_excluding_3rd_Party AS NUMERIC)) AS Total_Cancels_excluding_3rd_Party,\n  SUM(SAFE_CAST(bd.Total_Cancels_including_3rd_Party AS NUMERIC)) AS Total_Cancels_including_3rd_Party,\n  SUM(SAFE_CAST(bd.Total_Closing_Base AS NUMERIC)) AS Total_Closing_Base,\n  SUM(SAFE_CAST(bd.Total_Revenue AS NUMERIC)) AS Total_Revenue,\n  SUM(SAFE_CAST(bd.Total_Weekly_Sales AS NUMERIC)) AS Total_Weekly_Sales,\n  -- 6-Week Rolling Metrics (from _6W columns)\n  SUM(SAFE_CAST(bd.Always_on_Digital_Sales_6W AS NUMERIC)) AS Always_on_Digital_Sales_6W,\n  SUM(SAFE_CAST(bd.Breach_Sales_6W AS NUMERIC)) AS Breach_Sales_6W,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_6W AS NUMERIC)) AS Closing_Base_3rd_Party_6W,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_APLS_6W AS NUMERIC)) AS Closing_Base_3rd_Party_APLS_6W,\n  SUM(SAFE_CAST(bd.Closing_Base_3rd_Party_GPLA_6W AS NUMERIC)) AS Closing_Base_3rd_Party_GPLA_6W,\n  SUM(SAFE_CAST(bd.Essentials_6W AS NUMERIC)) AS Essentials_6W,\n  SUM(SAFE_CAST(bd.Failed_Payment_Volume_6W AS NUMERIC)) AS Failed_Payment_Volume_6W,\n  SUM(SAFE_CAST(bd.General_Offer_Sales_6W AS NUMERIC)) AS General_Offer_Sales_6W,\n  SUM(SAFE_CAST(bd.Net_Cancels_6W AS NUMERIC)) AS Net_Cancels_6W,\n  SUM(SAFE_CAST(bd.Net_Growth_3rd_Party_6W AS NUMERIC)) AS Net_Growth_3rd_Party_6W,\n  SUM(SAFE_CAST(bd.Net_Growth_Consumer_6W AS NUMERIC)) AS Net_Growth_Consumer_6W,\n  SUM(SAFE_CAST(bd.Net_Growth_incl_3rd_party_6W AS NUMERIC)) AS Net_Growth_incl_3rd_party_6W,\n  SUM(SAFE_CAST(bd.Other_Sales_6W AS NUMERIC)) AS Other_Sales_6W,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_6W AS NUMERIC)) AS Revenue_3rd_Party_6W,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_APLS_6W AS NUMERIC)) AS Revenue_3rd_Party_APLS_6W,\n  SUM(SAFE_CAST(bd.Revenue_3rd_Party_GPLA_6W AS NUMERIC)) AS Revenue_3rd_Party_GPLA_6W,\n  SUM(SAFE_CAST(bd.Revenue_Campus_6W AS NUMERIC)) AS Revenue_Campus_6W,\n  SUM(SAFE_CAST(bd.Revenue_Consumer_6W AS NUMERIC)) AS Revenue_Consumer_6W,\n  SUM(SAFE_CAST(bd.Revenue_Corp_6W AS NUMERIC)) AS Revenue_Corp_6W,\n  SUM(SAFE_CAST(bd.Revenue_Other_6W AS NUMERIC)) AS Revenue_Other_6W,\n  SUM(SAFE_CAST(bd.Switches_6W AS NUMERIC)) AS Switches_6W,\n  SUM(SAFE_CAST(bd.Total_Cancels_excluding_3rd_Party_6W AS NUMERIC)) AS Total_Cancels_excluding_3rd_Party_6W,\n  SUM(SAFE_CAST(bd.Total_Cancels_including_3rd_Party_6W AS NUMERIC)) AS Total_Cancels_including_3rd_Party_6W,\n  SUM(SAFE_CAST(bd.Total_Closing_Base_6W AS NUMERIC)) AS Total_Closing_Base_6W,\n  SUM(SAFE_CAST(bd.Total_Revenue_6W AS NUMERIC)) AS Total_Revenue_6W,\n  SUM(SAFE_CAST(bd.Total_Weekly_Sales_6W AS NUMERIC)) AS Total_Weekly_Sales_6W\nFROM\n  base_data bd, latest_fiscal_period lfp\nWHERE\n  bd.fy_year = lfp.latest_fy_year\n  AND bd.fy_week_of_year = lfp.latest_fy_week\nGROUP BY\n  bd.fy_year,\n  bd.fy_week_of_year,\n  bd.masthead,\n  bd.masthead_name,\n  bd.masthead_group_states_community,\n  bd.masthead_group_metro_regionals\nORDER BY\n  bd.fy_year DESC, bd.fy_week_of_year DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(fy_year AS STRING) || '-' || LPAD(SAFE_CAST(fy_week_of_year AS STRING), 2, '0')) as unique_fiscal_weeks,\n  COUNT(DISTINCT SAFE_CAST(masthead AS STRING)) as unique_mastheads,\n  MIN(SAFE_CAST(fy_year AS STRING) || '-' || LPAD(SAFE_CAST(fy_week_of_year AS STRING), 2, '0')) as earliest_fiscal_week,\n  MAX(SAFE_CAST(fy_year AS STRING) || '-' || LPAD(SAFE_CAST(fy_week_of_year AS STRING), 2, '0')) as latest_fiscal_week\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` \nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Look at last 2 fiscal years for structure"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(Total_Revenue AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(masthead AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END as masthead_test,\n  CASE WHEN MAX(fy_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN SUM(SAFE_CAST(Total_Weekly_Sales AS NUMERIC)) >= 0 THEN 'PASS' ELSE 'FAIL' END as total_weekly_sales_non_negative_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year = (SELECT MAX(fy_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`)\nLIMIT 1"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Masthead Mapping Consistency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE \n        WHEN masthead = 'TA' AND masthead_name = 'The Australian' THEN 1 \n        WHEN masthead = 'DT' AND masthead_name = 'Daily Telegraph' THEN 1\n        -- Add more specific masthead checks as needed\n        ELSE 0 END) as records_passing_masthead_name_rule,\n  SUM(CASE \n        WHEN masthead IN ('CM', 'DT', 'HS', 'AA') AND masthead_group_metro_regionals = 'Metro' THEN 1 \n        WHEN masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT') AND masthead_group_metro_regionals = 'Regionals' THEN 1\n        ELSE 0 END) as records_passing_metro_regional_rule\nFROM (\n    SELECT\n      t0.masthead,\n      CASE\n        WHEN t0.masthead = 'TA' THEN 'The Australian'\n        WHEN t0.masthead = 'DT' THEN 'Daily Telegraph'\n        WHEN t0.masthead = 'HS' THEN 'Herald Sun'\n        WHEN t0.masthead = 'WT' THEN 'Weekly Times'\n        WHEN t0.masthead = 'GA' THEN 'Geelong Advertiser'\n        WHEN t0.masthead = 'CM' THEN 'Courier Mail'\n        WHEN t0.masthead = 'CP' THEN 'Cairns Post'\n        WHEN t0.masthead = 'TB' THEN 'Townsville Bulletin'\n        WHEN t0.masthead = 'TC' THEN 'Toowoomba Chronicles'\n        WHEN t0.masthead = 'GC' THEN 'Gold Coast'\n        WHEN t0.masthead = 'TM' THEN 'The Mercury'\n        WHEN t0.masthead = 'NT' THEN 'NT News'\n        WHEN t0.masthead = 'AA' THEN 'The Advertiser'\n        ELSE NULL\n      END AS masthead_name,\n      CASE\n        WHEN t0.masthead IN ('CM', 'DT', 'HS', 'AA') THEN 'Metro'\n        WHEN t0.masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT') THEN 'Regionals'\n        ELSE NULL\n      END AS masthead_group_metro_regionals\n    FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` AS t0\n    WHERE t0.fy_year = (SELECT MAX(fy_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`)\n)\nLIMIT 100000"",
    ""sample_data_sql"": ""SELECT \n  SAFE_CAST(fy_year AS INT64) as fiscal_year,\n  SAFE_CAST(fy_week_of_year AS INT64) as fiscal_week_of_year,\n  SAFE_CAST(masthead AS STRING) as masthead,\n  SAFE_CAST(Total_Revenue AS NUMERIC) as total_revenue,\n  SAFE_CAST(Total_Weekly_Sales AS NUMERIC) as total_weekly_sales,\n  SAFE_CAST(Net_Growth_Consumer AS NUMERIC) as net_growth_consumer,\n  SAFE_CAST(Revenue_Consumer AS NUMERIC) as revenue_consumer,\n  SAFE_CAST(Total_Closing_Base AS NUMERIC) as total_closing_base\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year = (SELECT MAX(fy_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`)\nORDER BY fy_week_of_year DESC\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025-03-30"",
          ""original_format"": ""2025-03-30T00:00:00"",
          ""context"": ""Used as a 'current date' for week calculations in Query 1 and 2."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024-07-03"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the fiscal year start reference date for `DATETIME_DIFF` week calculations across all queries."",
          ""suggested_fix"": ""Parameterize as `fiscal_year_start_date` or derive dynamically from a fiscal calendar table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025-02-10"",
          ""original_format"": ""2025-02-10T00:00:00"",
          ""context"": ""Used as a 'current date' for week calculations in Query 3 (6-week rolling metrics)."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` or a dashboard date parameter, ensuring consistency with other date parameters."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'TA'"", ""'DT'"", ""'HS'"", ""'WT'"", ""'GA'"", ""'CM'"", ""'CP'"", ""'TB'"", ""'TC'"", ""'GC'"", ""'TM'"", ""'NT'"", ""'AA'""],
          ""context"": ""Masthead codes are hardcoded in `CASE` statements for mapping to full names and groups."",
          ""suggested_governance"": ""Join to a `masthead_lookup` reference table for maintainability and consistency."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'States and Community'"", ""'The Australian and Prestige'"", ""'Metro'"", ""'Regionals'"", ""'All Mastheads'""],
          ""context"": ""Masthead group names are hardcoded in `CASE` statements and filter logic."",
          ""suggested_governance"": ""Manage these groupings in a reference table or configuration layer."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [""48"", ""49"", ""50"", ""51"", ""52""],
          ""context"": ""Specific fiscal week numbers (48-52) are hardcoded for filtering in Query 3, likely for end-of-year or specific period analysis."",
          ""suggested_governance"": ""Parameterize these week numbers or derive from a fiscal calendar table based on reporting period."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""2025"", ""2024""],
          ""context"": ""Fiscal years are hardcoded for filtering (`fy_year = 2025` or `fy_year = 2024`)."",
          ""suggested_governance"": ""Use a fiscal year parameter or derive from `CURRENT_DATE()` and fiscal calendar logic."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""placeholders"",
          ""hardcoded_values"": [""0 = 1"", ""0 = 2"", ""0 = 3"", ""0 = 4"", ""0 = 5""],
          ""context"": ""Boolean conditions that always evaluate to false, likely remnants of Looker Studio's query generation for unused comparison periods."",
          ""suggested_governance"": ""Review and remove dead code or ensure proper parameterization if intended for future use."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with dashboard date parameters (e.g., `_DS_START_DATE`, `_DS_END_DATE`) or relative date functions (`CURRENT_DATE()`, `DATE_SUB`)."",
      ""Externalize masthead mappings and groupings into a dedicated lookup table, joining to it instead of using `CASE` statements."",
      ""Parameterize fiscal year and specific fiscal week thresholds to allow dynamic reporting periods."",
      ""Consider a configuration table for complex business rules like the fiscal week calculation logic (day of week adjustment, base date for week diff).""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""always_on_digital_sales_v"",
      ""metric_name"": ""Always On Digital Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Always On Digital' campaigns for the current reporting period (likely current fiscal week)."",
      ""sql_logic"": ""SUM(Always_on_Digital_Sales_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key sales performance indicator for digital subscriptions/products."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""breach_sales_v"",
      ""metric_name"": ""Breach Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales identified as 'Breach Sales' for the current reporting period."",
      ""sql_logic"": ""SUM(Breach_Sales_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monitors sales that might be outside standard processes or terms."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_v"",
      ""metric_name"": ""Closing Base 3rd Party (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total closing customer base attributed to 3rd party channels for the current reporting period."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Indicates the size of the customer base acquired via third-party partnerships."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""essentials_v"",
      ""metric_name"": ""Essentials Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Essentials' product offerings for the current reporting period."",
      ""sql_logic"": ""SUM(Essentials_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks performance of core/essential product sales."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""general_offer_sales_v"",
      ""metric_name"": ""General Offer Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general promotional offers for the current reporting period."",
      ""sql_logic"": ""SUM(General_Offer_Sales_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures the effectiveness of broad marketing campaigns."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_cancels_v"",
      ""metric_name"": ""Net Cancels (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party_V"", ""Total_Cancels_including_3rd_Party_V""],
      ""business_description"": ""Net cancellations for the current reporting period (likely Total Cancels - New Sales, or similar)."",
      ""sql_logic"": ""SUM(Net_Cancels_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical for understanding customer churn and retention."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_3rd_party_v"",
      ""metric_name"": ""Net Growth 3rd Party (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from 3rd party channels for the current reporting period."",
      ""sql_logic"": ""SUM(Net_Growth_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures the effectiveness of third-party acquisition strategies."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_consumer_v"",
      ""metric_name"": ""Net Growth Consumer (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from direct consumer channels for the current reporting period."",
      ""sql_logic"": ""SUM(Net_Growth_Consumer_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator of direct customer acquisition and retention success."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_incl_3rd_party_v"",
      ""metric_name"": ""Net Growth (incl. 3rd Party) (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Net_Growth_Consumer_V"", ""Net_Growth_3rd_Party_V""],
      ""business_description"": ""Overall net customer growth including both direct consumer and 3rd party channels for the current reporting period."",
      ""sql_logic"": ""SUM(Net_Growth_incl_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary measure of overall customer base expansion."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""other_sales_v"",
      ""metric_name"": ""Other Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from categories not covered by other specific sales metrics for the current reporting period."",
      ""sql_logic"": ""SUM(Other_Sales_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Captures miscellaneous sales revenue."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_v"",
      ""metric_name"": ""Revenue 3rd Party (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party channels for the current reporting period."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key revenue stream from partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_campus_v"",
      ""metric_name"": ""Revenue Campus (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related sales/subscriptions for the current reporting period."",
      ""sql_logic"": ""SUM(Revenue_Campus_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks revenue from educational or campus-specific initiatives."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_consumer_v"",
      ""metric_name"": ""Revenue Consumer (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers for the current reporting period."",
      ""sql_logic"": ""SUM(Revenue_Consumer_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue stream from direct customer relationships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_corp_v"",
      ""metric_name"": ""Revenue Corp (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate accounts/sales for the current reporting period."",
      ""sql_logic"": ""SUM(Revenue_Corp_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks revenue from B2B or corporate partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_other_v"",
      ""metric_name"": ""Revenue Other (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or unclassified sources for the current reporting period."",
      ""sql_logic"": ""SUM(Revenue_Other_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Captures residual revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""switches_v"",
      ""metric_name"": ""Switches (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of customer 'switches' (e.g., plan changes, masthead changes) for the current reporting period."",
      ""sql_logic"": ""SUM(Switches_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monitors customer migration between products or services."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_excluding_3rd_party_v"",
      ""metric_name"": ""Total Cancels (excluding 3rd Party) (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer cancellations, excluding those from 3rd party channels, for the current reporting period."",
      ""sql_logic"": ""SUM(Total_Cancels_excluding_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures direct customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_including_3rd_party_v"",
      ""metric_name"": ""Total Cancels (including 3rd Party) (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party_V""],
      ""business_description"": ""Total customer cancellations, including those from 3rd party channels, for the current reporting period."",
      ""sql_logic"": ""SUM(Total_Cancels_including_3rd_Party_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall measure of customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_closing_base_v"",
      ""metric_name"": ""Total Closing Base (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party_V""],
      ""business_description"": ""Total customer base at the end of the current reporting period, across all channels."",
      ""sql_logic"": ""SUM(Total_Closing_Base_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall size of the active customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_revenue_v"",
      ""metric_name"": ""Total Revenue (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Revenue_3rd_Party_V"", ""Revenue_Campus_V"", ""Revenue_Consumer_V"", ""Revenue_Corp_V"", ""Revenue_Other_V""],
      ""business_description"": ""Total revenue from all sources for the current reporting period."",
      ""sql_logic"": ""SUM(Total_Revenue_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary financial performance indicator."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_weekly_sales_v"",
      ""metric_name"": ""Total Weekly Sales (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Always_on_Digital_Sales_V"", ""Breach_Sales_V"", ""Essentials_V"", ""General_Offer_Sales_V"", ""Other_Sales_V""],
      ""business_description"": ""Total sales volume for the current reporting week."",
      ""sql_logic"": ""SUM(Total_Weekly_Sales_V)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator of weekly sales performance."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""always_on_digital_sales"",
      ""metric_name"": ""Always On Digital Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Always On Digital' campaigns (base metric, likely for current period)."",
      ""sql_logic"": ""SUM(Always_on_Digital_Sales)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core sales metric for digital products."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""breach_sales"",
      ""metric_name"": ""Breach Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales identified as 'Breach Sales' (base metric)."",
      ""sql_logic"": ""SUM(Breach_Sales)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monitors sales that might be outside standard processes or terms."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party"",
      ""metric_name"": ""Closing Base 3rd Party (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total closing customer base attributed to 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Indicates the size of the customer base acquired via third-party partnerships."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_apls"",
      ""metric_name"": ""Closing Base 3rd Party APLS (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party""],
      ""business_description"": ""Total closing customer base from 3rd party APLS (Apple) channels."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_APLS)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_gpla"",
      ""metric_name"": ""Closing Base 3rd Party GPLA (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party""],
      ""business_description"": ""Total closing customer base from 3rd party GPLA (Google) channels."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_GPLA)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_consumer"",
      ""metric_name"": ""Closing Base Consumer (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total closing customer base from direct consumer channels (base metric)."",
      ""sql_logic"": ""SUM(Closing_Base_Consumer)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Indicates the size of the direct customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""essentials"",
      ""metric_name"": ""Essentials Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Essentials' product offerings (base metric)."",
      ""sql_logic"": ""SUM(Essentials)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks performance of core/essential product sales."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""failed_payment_volume"",
      ""metric_name"": ""Failed Payment Volume (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total volume of failed payments (base metric)."",
      ""sql_logic"": ""SUM(Failed_Payment_Volume)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical for revenue assurance and customer retention efforts."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""general_offer_sales"",
      ""metric_name"": ""General Offer Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general promotional offers (base metric)."",
      ""sql_logic"": ""SUM(General_Offer_Sales)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures the effectiveness of broad marketing campaigns."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_cancels"",
      ""metric_name"": ""Net Cancels (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party"", ""Total_Cancels_including_3rd_Party""],
      ""business_description"": ""Net cancellations (base metric)."",
      ""sql_logic"": ""SUM(Net_Cancels)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical for understanding customer churn and retention."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_3rd_party"",
      ""metric_name"": ""Net Growth 3rd Party (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Net_Growth_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures the effectiveness of third-party acquisition strategies."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_3rd_party_apls"",
      ""metric_name"": ""Net Growth 3rd Party APLS (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Net_Growth_3rd_Party""],
      ""business_description"": ""Net customer growth from 3rd party APLS (Apple) channels."",
      ""sql_logic"": ""SUM(Net_Growth_3rd_Party_APLS)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party growth."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_3rd_party_gpla"",
      ""metric_name"": ""Net Growth 3rd Party GPLA (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Net_Growth_3rd_Party""],
      ""business_description"": ""Net customer growth from 3rd party GPLA (Google) channels."",
      ""sql_logic"": ""SUM(Net_Growth_3rd_Party_GPLA)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party growth."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_consumer"",
      ""metric_name"": ""Net Growth Consumer (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from direct consumer channels (base metric)."",
      ""sql_logic"": ""SUM(Net_Growth_Consumer)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator of direct customer acquisition and retention success."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_incl_3rd_party"",
      ""metric_name"": ""Net Growth (incl. 3rd Party) (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Net_Growth_Consumer"", ""Net_Growth_3rd_Party""],
      ""business_description"": ""Overall net customer growth including both direct consumer and 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Net_Growth_incl_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary measure of overall customer base expansion."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""other_sales"",
      ""metric_name"": ""Other Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from categories not covered by other specific sales metrics (base metric)."",
      ""sql_logic"": ""SUM(Other_Sales)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Captures miscellaneous sales revenue."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party"",
      ""metric_name"": ""Revenue 3rd Party (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key revenue stream from partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_apls"",
      ""metric_name"": ""Revenue 3rd Party APLS (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Revenue_3rd_Party""],
      ""business_description"": ""Total revenue generated from 3rd party APLS (Apple) channels."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_APLS)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_gpla"",
      ""metric_name"": ""Revenue 3rd Party GPLA (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Revenue_3rd_Party""],
      ""business_description"": ""Total revenue generated from 3rd party GPLA (Google) channels."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_GPLA)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific breakdown of 3rd party revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_campus"",
      ""metric_name"": ""Revenue Campus (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related sales/subscriptions (base metric)."",
      ""sql_logic"": ""SUM(Revenue_Campus)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks revenue from educational or campus-specific initiatives."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_consumer"",
      ""metric_name"": ""Revenue Consumer (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers (base metric)."",
      ""sql_logic"": ""SUM(Revenue_Consumer)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue stream from direct customer relationships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_corp"",
      ""metric_name"": ""Revenue Corp (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate accounts/sales (base metric)."",
      ""sql_logic"": ""SUM(Revenue_Corp)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks revenue from B2B or corporate partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_other"",
      ""metric_name"": ""Revenue Other (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or unclassified sources (base metric)."",
      ""sql_logic"": ""SUM(Revenue_Other)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Captures residual revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""switches"",
      ""metric_name"": ""Switches (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of customer 'switches' (e.g., plan changes, masthead changes) (base metric)."",
      ""sql_logic"": ""SUM(Switches)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monitors customer migration between products or services."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_excluding_3rd_party"",
      ""metric_name"": ""Total Cancels (excluding 3rd Party) (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer cancellations, excluding those from 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Total_Cancels_excluding_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures direct customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_including_3rd_party"",
      ""metric_name"": ""Total Cancels (including 3rd Party) (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party""],
      ""business_description"": ""Total customer cancellations, including those from 3rd party channels (base metric)."",
      ""sql_logic"": ""SUM(Total_Cancels_including_3rd_Party)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall measure of customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_closing_base"",
      ""metric_name"": ""Total Closing Base (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party"", ""Closing_Base_Consumer""],
      ""business_description"": ""Total customer base at the end of the reporting period, across all channels (base metric)."",
      ""sql_logic"": ""SUM(Total_Closing_Base)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall size of the active customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_revenue"",
      ""metric_name"": ""Total Revenue (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Revenue_3rd_Party"", ""Revenue_Campus"", ""Revenue_Consumer"", ""Revenue_Corp"", ""Revenue_Other""],
      ""business_description"": ""Total revenue from all sources (base metric)."",
      ""sql_logic"": ""SUM(Total_Revenue)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The primary financial performance indicator."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_weekly_sales"",
      ""metric_name"": ""Total Weekly Sales (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Always_on_Digital_Sales"", ""Breach_Sales"", ""Essentials"", ""General_Offer_Sales"", ""Other_Sales""],
      ""business_description"": ""Total sales volume for the reporting week (base metric)."",
      ""sql_logic"": ""SUM(Total_Weekly_Sales)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week = calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator of weekly sales performance."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-03-30"", ""2024-07-03""],
      ""hardcoded_values_in_metric"": [""2025""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""always_on_digital_sales_6w"",
      ""metric_name"": ""Always On Digital Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Always On Digital' campaigns over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Always_on_Digital_Sales_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed sales trend for digital products, reducing weekly volatility."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""breach_sales_6w"",
      ""metric_name"": ""Breach Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales identified as 'Breach Sales' over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Breach_Sales_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Monitors trends in sales outside standard processes."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_6w"",
      ""metric_name"": ""Closing Base 3rd Party (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total closing customer base attributed to 3rd party channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of customer base acquired via third-party partnerships."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_apls_6w"",
      ""metric_name"": ""Closing Base 3rd Party APLS (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party_6W""],
      ""business_description"": ""Total closing customer base from 3rd party APLS (Apple) channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_APLS_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of specific 3rd party customer base breakdown."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""closing_base_3rd_party_gpla_6w"",
      ""metric_name"": ""Closing Base 3rd Party GPLA (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party_6W""],
      ""business_description"": ""Total closing customer base from 3rd party GPLA (Google) channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Closing_Base_3rd_Party_GPLA_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of specific 3rd party customer base breakdown."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""essentials_6w"",
      ""metric_name"": ""Essentials Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from 'Essentials' product offerings over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Essentials_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed performance trend of core/essential product sales."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""failed_payment_volume_6w"",
      ""metric_name"": ""Failed Payment Volume (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total volume of failed payments over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Failed_Payment_Volume_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend for revenue assurance and customer retention efforts."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""general_offer_sales_6w"",
      ""metric_name"": ""General Offer Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general promotional offers over a 6-week rolling period."",
      ""sql_logic"": ""SUM(General_Offer_Sales_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed effectiveness of broad marketing campaigns."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_cancels_6w"",
      ""metric_name"": ""Net Cancels (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party_6W"", ""Total_Cancels_including_3rd_Party_6W""],
      ""business_description"": ""Net cancellations over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Net_Cancels_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend for customer churn and retention."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_3rd_party_6w"",
      ""metric_name"": ""Net Growth 3rd Party (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from 3rd party channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Net_Growth_3rd_Party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed effectiveness of third-party acquisition strategies."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_consumer_6w"",
      ""metric_name"": ""Net Growth Consumer (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net customer growth from direct consumer channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Net_Growth_Consumer_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed indicator of direct customer acquisition and retention success."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""net_growth_incl_3rd_party_6w"",
      ""metric_name"": ""Net Growth (incl. 3rd Party) (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Net_Growth_Consumer_6W"", ""Net_Growth_3rd_Party_6W""],
      ""business_description"": ""Overall net customer growth including both direct consumer and 3rd party channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Net_Growth_incl_3rd_party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed primary measure of overall customer base expansion."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""other_sales_6w"",
      ""metric_name"": ""Other Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from categories not covered by other specific sales metrics over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Other_Sales_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed miscellaneous sales revenue."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_6w"",
      ""metric_name"": ""Revenue 3rd Party (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed key revenue stream from partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_apls_6w"",
      ""metric_name"": ""Revenue 3rd Party APLS (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Revenue_3rd_Party_6W""],
      ""business_description"": ""Total revenue generated from 3rd party APLS (Apple) channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_APLS_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed specific breakdown of 3rd party revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_3rd_party_gpla_6w"",
      ""metric_name"": ""Revenue 3rd Party GPLA (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""Revenue_3rd_Party_6W""],
      ""business_description"": ""Total revenue generated from 3rd party GPLA (Google) channels over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_3rd_Party_GPLA_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed specific breakdown of 3rd party revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_campus_6w"",
      ""metric_name"": ""Revenue Campus (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related sales/subscriptions over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_Campus_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of revenue from educational or campus-specific initiatives."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_consumer_6w"",
      ""metric_name"": ""Revenue Consumer (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_Consumer_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed core revenue stream from direct customer relationships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_corp_6w"",
      ""metric_name"": ""Revenue Corp (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate accounts/sales over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_Corp_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of revenue from B2B or corporate partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_other_6w"",
      ""metric_name"": ""Revenue Other (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or unclassified sources over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Revenue_Other_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed residual revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""switches_6w"",
      ""metric_name"": ""Switches (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of customer 'switches' (e.g., plan changes, masthead changes) over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Switches_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed trend of customer migration between products or services."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_excluding_3rd_party_6w"",
      ""metric_name"": ""Total Cancels (excluding 3rd Party) (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer cancellations, excluding those from 3rd party channels, over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Total_Cancels_excluding_3rd_Party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed measure of direct customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_cancels_including_3rd_party_6w"",
      ""metric_name"": ""Total Cancels (including 3rd Party) (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Total_Cancels_excluding_3rd_Party_6W""],
      ""business_description"": ""Total customer cancellations, including those from 3rd party channels, over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Total_Cancels_including_3rd_Party_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed overall measure of customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_closing_base_6w"",
      ""metric_name"": ""Total Closing Base (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Closing_Base_3rd_Party_6W""],
      ""business_description"": ""Total customer base at the end of the 6-week rolling period, across all channels."",
      ""sql_logic"": ""SUM(Total_Closing_Base_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed overall size of the active customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_revenue_6w"",
      ""metric_name"": ""Total Revenue (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Revenue_3rd_Party_6W"", ""Revenue_Campus_6W"", ""Revenue_Consumer_6W"", ""Revenue_Corp_6W"", ""Revenue_Other_6W""],
      ""business_description"": ""Total revenue from all sources over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Total_Revenue_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed primary financial performance indicator."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_weekly_sales_6w"",
      ""metric_name"": ""Total Weekly Sales (6-Week Rolling)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""Always_on_Digital_Sales_6W"", ""Breach_Sales_6W"", ""Essentials_6W"", ""General_Offer_Sales_6W"", ""Other_Sales_6W""],
      ""business_description"": ""Total sales volume over a 6-week rolling period."",
      ""sql_logic"": ""SUM(Total_Weekly_Sales_6W)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""],
      ""filters_applied"": [""Fiscal Year = 2025"", ""Fiscal Week between calculated_current_week-5 and calculated_current_week"", ""Masthead filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Smoothed indicator of weekly sales performance."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025-02-10"", ""2024-07-03"", ""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""hardcoded_values_in_metric"": [""2025"", ""2024"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""date should be parameterised"", ""fiscal year/week range should be parameterized""],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_revenue_v"",
      ""related_metrics"": [""revenue_3rd_party_v"", ""revenue_campus_v"", ""revenue_consumer_v"", ""revenue_corp_v"", ""revenue_other_v""],
      ""relationship_description"": ""Total Revenue (Current Period) is the sum of various revenue streams for the current period."",
      ""mathematical_formula"": ""Total_Revenue_V = Revenue_3rd_Party_V + Revenue_Campus_V + Revenue_Consumer_V + Revenue_Corp_V + Revenue_Other_V"",
      ""business_validation"": ""Ensures all revenue sources are accounted for in the overall total."",
      ""validation_sql"": ""SELECT SUM(Total_Revenue_V) - SUM(Revenue_3rd_Party_V + Revenue_Campus_V + Revenue_Consumer_V + Revenue_Corp_V + Revenue_Other_V) AS revenue_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_revenue"",
      ""related_metrics"": [""revenue_3rd_party"", ""revenue_campus"", ""revenue_consumer"", ""revenue_corp"", ""revenue_other""],
      ""relationship_description"": ""Total Revenue (Base) is the sum of various revenue streams."",
      ""mathematical_formula"": ""Total_Revenue = Revenue_3rd_Party + Revenue_Campus + Revenue_Consumer + Revenue_Corp + Revenue_Other"",
      ""business_validation"": ""Ensures all revenue sources are accounted for in the overall total."",
      ""validation_sql"": ""SELECT SUM(Total_Revenue) - SUM(Revenue_3rd_Party + Revenue_Campus + Revenue_Consumer + Revenue_Corp + Revenue_Other) AS revenue_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_revenue_6w"",
      ""related_metrics"": [""revenue_3rd_party_6w"", ""revenue_campus_6w"", ""revenue_consumer_6w"", ""revenue_corp_6w"", ""revenue_other_6w""],
      ""relationship_description"": ""Total Revenue (6-Week Rolling) is the sum of various revenue streams over the 6-week period."",
      ""mathematical_formula"": ""Total_Revenue_6W = Revenue_3rd_Party_6W + Revenue_Campus_6W + Revenue_Consumer_6W + Revenue_Corp_6W + Revenue_Other_6W"",
      ""business_validation"": ""Ensures all revenue sources are accounted for in the overall 6-week total."",
      ""validation_sql"": ""SELECT SUM(Total_Revenue_6W) - SUM(Revenue_3rd_Party_6W + Revenue_Campus_6W + Revenue_Consumer_6W + Revenue_Corp_6W + Revenue_Other_6W) AS revenue_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year BETWEEN (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025) - 5 AND (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""net_growth_incl_3rd_party_v"",
      ""related_metrics"": [""net_growth_consumer_v"", ""net_growth_3rd_party_v""],
      ""relationship_description"": ""Net Growth (incl. 3rd Party) is expected to be the sum of Net Growth Consumer and Net Growth 3rd Party."",
      ""mathematical_formula"": ""Net_Growth_incl_3rd_Party_V = Net_Growth_Consumer_V + Net_Growth_3rd_Party_V"",
      ""business_validation"": ""Confirms the overall growth metric correctly aggregates its components."",
      ""validation_sql"": ""SELECT SUM(Net_Growth_incl_3rd_Party_V) - SUM(Net_Growth_Consumer_V + Net_Growth_3rd_Party_V) AS growth_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""net_growth_incl_3rd_party"",
      ""related_metrics"": [""net_growth_consumer"", ""net_growth_3rd_party""],
      ""relationship_description"": ""Net Growth (incl. 3rd Party) is expected to be the sum of Net Growth Consumer and Net Growth 3rd Party (base metrics)."",
      ""mathematical_formula"": ""Net_Growth_incl_3rd_Party = Net_Growth_Consumer + Net_Growth_3rd_Party"",
      ""business_validation"": ""Confirms the overall growth metric correctly aggregates its components."",
      ""validation_sql"": ""SELECT SUM(Net_Growth_incl_3rd_Party) - SUM(Net_Growth_Consumer + Net_Growth_3rd_Party) AS growth_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""net_growth_incl_3rd_party_6w"",
      ""related_metrics"": [""net_growth_consumer_6w"", ""net_growth_3rd_party_6w""],
      ""relationship_description"": ""Net Growth (incl. 3rd Party) (6-Week Rolling) is expected to be the sum of Net Growth Consumer and Net Growth 3rd Party over the 6-week period."",
      ""mathematical_formula"": ""Net_Growth_incl_3rd_party_6W = Net_Growth_Consumer_6W + Net_Growth_3rd_Party_6W"",
      ""business_validation"": ""Confirms the overall 6-week growth metric correctly aggregates its components."",
      ""validation_sql"": ""SELECT SUM(Net_Growth_incl_3rd_party_6W) - SUM(Net_Growth_Consumer_6W + Net_Growth_3rd_Party_6W) AS growth_variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year BETWEEN (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025) - 5 AND (SELECT MAX(fy_week_of_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""masthead"",
      ""related_metrics"": [""masthead_name"", ""masthead_group_states_community"", ""masthead_group_metro_regionals""],
      ""relationship_description"": ""Masthead codes are grouped into human-readable names and broader categories (States/Community, Metro/Regionals)."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures consistent and accurate categorization of mastheads for reporting."",
      ""validation_sql"": ""SELECT masthead, masthead_name, masthead_group_states_community, masthead_group_metro_regionals FROM (\n    SELECT\n      t0.masthead,\n      CASE WHEN t0.masthead = 'TA' THEN 'The Australian' ELSE NULL END AS masthead_name,\n      CASE WHEN t0.masthead IN ('CM', 'DT', 'HS', 'AA') THEN 'Metro' ELSE NULL END AS masthead_group_metro_regionals,\n      CASE WHEN t0.masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT') THEN 'States and Community' ELSE NULL END AS masthead_group_states_community\n    FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` AS t0\n) GROUP BY 1,2,3,4 LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""fy_year"",
      ""related_metrics"": [""fy_week_of_year""],
      ""relationship_description"": ""Metrics are filtered by specific fiscal year and week combinations, often hardcoded to a 'current' fiscal year (2025) and a calculated week based on a fixed date."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures the dashboard displays data for the intended reporting period, but hardcoding limits flexibility."",
      ""validation_sql"": ""SELECT fy_year, fy_week_of_year, SUM(Total_Revenue) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = (SELECT DATETIME_DIFF(SAFE_CAST(DATE('2025-03-30') AS DATETIME), SAFE_CAST(DATE('2024-07-03') AS DATETIME), WEEK) - 1) GROUP BY 1,2"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,40
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f7a9efeb-df3c-45c9-899d-0bcada701572"",
    ""dashboard_name"": ""Salaries & Wages Dashboard UAT Version"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement;ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year_week_number"",
      ""revenue_type""
    ],
    ""date_range_detected"": ""mixed/historical"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'03'"",
      ""'Circulation'"",
      ""'Estimate'"",
      ""'RCTI'"",
      ""'THINK'"",
      ""'DTI'"",
      ""'Australia/Sydney'""
    ],
    ""governance_opportunities"": [
      ""revenue_type prefix '03' should be mapped to a descriptive name from a reference table"",
      ""source system names, scenario, and sub_source_system_name values should be managed via reference tables or parameters"",
      ""timezone 'Australia/Sydney' should be a parameter""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN for financial metrics, grouped by fiscal week.\n-- Note: The 'Earliest Snapshot Load Time' metric is from a different data grain and source, and is not meaningfully combinable into this query.\nWITH base_data AS (\n  SELECT\n    t0.amount AS amount,\n    t0.fy_year_week_number AS fy_year_week_number,\n    t0.revenue_type AS revenue_type,\n    t0.volume AS volume\n  FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\n  -- Filter by a recent range of fiscal year-week numbers for cost optimization\n  -- Assuming fy_year_week_number is in 'YYYYWW' format (e.g., '202352')\n  WHERE SAFE_CAST(t0.fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY))\n)\nSELECT\n  fy_year_week_number,\n  SUM(SAFE_CAST(amount AS NUMERIC)) AS total_amount,\n  SUM(SAFE_CAST(volume AS NUMERIC)) AS total_volume,\n  SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN SAFE_CAST(amount AS NUMERIC) ELSE 0 END) AS amount_rev_type_03,\n  SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN SAFE_CAST(volume AS NUMERIC) ELSE 0 END) AS volume_rev_type_03\nFROM base_data\nGROUP BY fy_year_week_number\nORDER BY fy_year_week_number DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_year_week_number AS STRING)) AS unique_fy_year_weeks,\n  COUNT(DISTINCT SAFE_CAST(SAFE.LEFT(t0.revenue_type, 2) AS STRING)) AS unique_revenue_type_prefixes,\n  MIN(SAFE_CAST(t0.fy_year_week_number AS STRING)) AS earliest_fy_year_week,\n  MAX(SAFE_CAST(t0.fy_year_week_number AS STRING)) AS latest_fy_year_week,\n  SUM(CASE WHEN t0.amount IS NULL THEN 1 ELSE 0 END) AS null_amount_count,\n  SUM(CASE WHEN t0.volume IS NULL THEN 1 ELSE 0 END) AS null_volume_count,\n  SUM(CASE WHEN t0.revenue_type IS NULL THEN 1 ELSE 0 END) AS null_revenue_type_count\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\nWHERE SAFE_CAST(t0.fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY))\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END AS total_amount_positive_test,\n  CASE WHEN SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(t0.revenue_type AS STRING), 2) = '03' THEN SAFE_CAST(t0.amount AS NUMERIC) ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS amount_rev_type_03_positive_test,\n  CASE WHEN COUNT(DISTINCT SAFE_CAST(t0.fy_year_week_number AS STRING)) > 0 THEN 'PASS' ELSE 'FAIL' END AS fy_year_week_data_exists_test,\n  CASE WHEN MAX(SAFE_CAST(t0.fy_year_week_number AS STRING)) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\nWHERE SAFE_CAST(t0.fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY))\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'revenue_type_03_logic' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(t0.revenue_type AS STRING), 2) = '03' THEN 1 ELSE 0 END) AS records_matching_03_prefix,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(t0.revenue_type AS STRING), 2) = '03' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS percentage_matching_03_prefix\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\nWHERE SAFE_CAST(t0.fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY))\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.amount AS NUMERIC) AS amount,\n  SAFE_CAST(t0.fy_year_week_number AS STRING) AS fy_year_week_number,\n  SAFE_CAST(t0.revenue_type AS STRING) AS revenue_type,\n  SAFE_CAST(t0.volume AS NUMERIC) AS volume\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\nWHERE SAFE_CAST(t0.fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY))\nORDER BY SAFE_CAST(t0.fy_year_week_number AS STRING) DESC, SAFE_CAST(t0.amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'03'""
          ],
          ""context"": ""Revenue type prefix used in CASE statement to filter amount and volume."",
          ""suggested_governance"": ""Join to a `revenue_type_master` or `chart_of_accounts` table to get descriptive names and manage categories centrally."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Circulation'"",
            ""'Estimate'"",
            ""'RCTI'"",
            ""'THINK'"",
            ""'DTI'""
          ],
          ""context"": ""Source system names, scenario, and sub-source system names used in WHERE clause for snapshot load time."",
          ""suggested_governance"": ""Manage these values in a `system_config` or `source_system_master` table and join/parameterize."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""timezone"",
          ""hardcoded_values"": [
            ""'Australia/Sydney'""
          ],
          ""context"": ""Timezone hardcoded in DATETIME function for snapshot load time."",
          ""suggested_governance"": ""Parameterize the timezone or use a global configuration variable."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded date range filters (e.g., `FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY))`) with dashboard date parameters."",
      ""Replace hardcoded lookup values (e.g., '03', 'Circulation') with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables for business rules (like revenue type categorization) instead of hardcoded logic within queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_amount"",
      ""metric_name"": ""Total Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the 'amount' column from the circulation data, representing total financial value (e.g., revenue or expense)."",
      ""sql_logic"": ""SUM(t0.amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core financial metric used to track overall financial performance or expenditure related to circulation."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in amount column""
      ]
    },
    {
      ""metric_id"": ""total_volume"",
      ""metric_name"": ""Total Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the 'volume' column from the circulation data, representing total units or quantity associated with financial transactions."",
      ""sql_logic"": ""SUM(t0.volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to track non-financial quantity metrics, providing context to financial amounts (e.g., number of subscriptions, units sold)."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in volume column""
      ]
    },
    {
      ""metric_id"": ""amount_rev_type_03"",
      ""metric_name"": ""Amount for Revenue Type '03'"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional, sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_amount""
      ],
      ""business_description"": ""The sum of 'amount' specifically for records where the first two characters of 'revenue_type' are '03'. This likely represents a specific, critical category of revenue or expense."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [
        ""LEFT(revenue_type, 2) = '03'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical for analyzing specific, segmented revenue or expense streams, potentially related to salaries or wages given the dashboard name."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'03'""
      ],
      ""governance_issues"": [
        ""The hardcoded value '03' should be mapped to a descriptive name from a reference table for better readability and maintainability.""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in amount or revenue_type columns""
      ]
    },
    {
      ""metric_id"": ""volume_rev_type_03"",
      ""metric_name"": ""Volume for Revenue Type '03'"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional, sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_volume""
      ],
      ""business_description"": ""The sum of 'volume' specifically for records where the first two characters of 'revenue_type' are '03'."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.volume ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""
      ],
      ""filters_applied"": [
        ""LEFT(revenue_type, 2) = '03'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides volume context for the specific '03' revenue/expense type, complementing the financial amount."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'03'""
      ],
      ""governance_issues"": [
        ""The hardcoded value '03' should be mapped to a descriptive name from a reference table.""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in volume or revenue_type columns""
      ]
    },
    {
      ""metric_id"": ""earliest_snapshot_load_time"",
      ""metric_name"": ""Earliest Snapshot Load Time"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min, datetime_function"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""none"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The earliest of the maximum load timestamps from two different finance tables, converted to 'Australia/Sydney' timezone and truncated to the second. This metric indicates the freshness of the underlying data snapshots."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(datetime(MAX(dw_prstn_load_timestamp) or MAX(dw_bdm_load_timestamp), 'Australia/Sydney'), SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"",
        ""ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct""
      ],
      ""filters_applied"": [
        ""source_system_name = 'Circulation'"",
        ""scenario = 'Estimate'"",
        ""sub_source_system_name IN ('RCTI', 'THINK', 'DTI')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Essential for data governance and ensuring users are viewing up-to-date information. A critical indicator of data freshness for the dashboard."",
      ""metric_category"": ""operations"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Circulation'"",
        ""'Estimate'"",
        ""'RCTI'"",
        ""'THINK'"",
        ""'DTI'"",
        ""'Australia/Sydney'""
      ],
      ""governance_issues"": [
        ""Source system names, scenario, and sub-source system names should be managed via reference tables or parameters."",
        ""The timezone 'Australia/Sydney' should be a parameter for flexibility.""
      ],
      ""data_quality_concerns"": [
        ""Dependency on upstream data load processes; delays in these processes will directly impact data freshness.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""amount_rev_type_03"",
      ""related_metrics"": [
        ""total_amount""
      ],
      ""relationship_description"": ""Amount for Revenue Type '03' is a conditional subset of Total Amount, representing the portion of total financial value attributed to a specific revenue type ('03')."",
      ""mathematical_formula"": ""amount_rev_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END)"",
      ""business_validation"": ""Ensures that the specific revenue type amount is correctly calculated as a component of the overall total. The sum of all such segmented amounts should ideally reconcile to the total amount."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN SAFE_CAST(amount AS NUMERIC) ELSE 0 END) AS amount_03, SUM(SAFE_CAST(amount AS NUMERIC)) AS total_amount FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY))"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""volume_rev_type_03"",
      ""related_metrics"": [
        ""total_volume""
      ],
      ""relationship_description"": ""Volume for Revenue Type '03' is a conditional subset of Total Volume, representing the portion of total units/quantity attributed to a specific revenue type ('03')."",
      ""mathematical_formula"": ""volume_rev_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN volume ELSE 0 END)"",
      ""business_validation"": ""Ensures that the specific revenue type volume is correctly calculated as a component of the overall total volume."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(SAFE_CAST(revenue_type AS STRING), 2) = '03' THEN SAFE_CAST(volume AS NUMERIC) ELSE 0 END) AS volume_03, SUM(SAFE_CAST(volume AS NUMERIC)) AS total_volume FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE SAFE_CAST(fy_year_week_number AS STRING) >= FORMAT_DATE('%Y%W', DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY))"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,41
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d22b4c2-4bb3-49db-a0c1-4d46d4fba101"",
    ""dashboard_name"": ""Copy of Acquisitions - Extracts"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 21,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fy_year"",
      ""fy_week_of_year"",
      ""masthead"",
      ""sold_in_source_code"",
      ""delivery_medium_type"",
      ""classification_level_2"",
      ""offer_category_group_name"",
      ""offer_category_name"",
      ""subscriber_has_email_flag"",
      ""table_nm"",
      ""acquisition_channel"",
      ""masthead_group"",
      ""masthead_category"",
      ""subscription_type"",
      ""customer_type_b2c_b2b""
    ],
    ""date_range_detected"": ""Fiscal Year 2025"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'Not Available'"",
      ""'TA'"",
      ""'CM'"",
      ""'Digital Subscriptions'"",
      ""'op'"",
      ""'The Australian and Prestige'"",
      ""'B2C'"",
      ""''""
    ],
    ""governance_opportunities"": [
      ""Fiscal year should be parameterized or derived dynamically."",
      ""Lookup values for 'masthead', 'sold_in_source_code', 'delivery_medium_type', 'classification_level_2', 'table_nm' should be managed in governed reference tables instead of hardcoded CASE statements.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2,\n    t0.offer_category_group_name,\n    t0.offer_category_name\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n  WHERE t0.fy_year = 2025 -- Hardcoded year from queries\n  LIMIT 1000000 -- Limit for sampling in primary_analysis_sql\n),\nderived_dimensions_step1 AS (\n  SELECT\n    fy_year,\n    fy_week_of_year,\n    masthead,\n    sold_in_source_code,\n    subscriber_has_email_flag,\n    table_nm,\n    classification_level_2,\n    offer_category_group_name,\n    offer_category_name,\n    -- Derived: Delivery Type\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_type,\n    -- Derived: Masthead Group\n    CASE\n      WHEN (masthead = 'TA') THEN 'The Australian'\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n      WHEN (masthead = 'WT') THEN 'Other Publications'\n      WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n      WHEN (masthead IS NULL) THEN 'check'\n      ELSE 'Exclude'\n    END AS masthead_group,\n    -- Derived: Masthead Category\n    CASE\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n      WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n      WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n      WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n      ELSE 'Exclude'\n    END AS masthead_category,\n    -- Derived: Source Code String (cleaned)\n    LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))) AS sold_in_source_code_cleaned,\n    -- Derived: Source Code Suffix (3-char)\n    SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3) AS source_code_suffix_3char,\n    -- Derived: Source Code Suffix (4-char)\n    SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4) AS source_code_suffix_4char,\n    -- Derived: Delivery Medium Email Flag Combo\n    CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) AS delivery_email_flag_combo,\n    -- Derived: Classification Level 2 Group (from classification_level_2)\n    CASE\n      WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n      WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n      WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n      WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n      WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n      WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n      ELSE NULL\n    END AS classification_level_2_group\n  FROM base_data\n),\nderived_dimensions_step2 AS (\n  SELECT\n    *,\n    -- Derived: Subscription Type\n    CASE\n      WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n      ELSE 'Print Subscriptions'\n    END AS subscription_type,\n    -- Derived: Customer Type (B2C/B2B)\n    CASE\n      WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n      WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n      ELSE 'Others'\n    END AS customer_type_b2c_b2b,\n    -- Derived: Acquisition Channel (complex logic)\n    CASE\n      WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold'\n      WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook'\n      WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form'\n      WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder'\n      WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist'\n      WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines'\n      WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz'\n      WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe'\n      WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor'\n      WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP'\n      WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au'\n      WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter'\n      WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts'\n      WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports'\n      WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus'\n      WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals'\n      WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter'\n      WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget'\n      WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n      ELSE NULL\n    END AS acquisition_channel\n  FROM derived_dimensions_step1\n)\nSELECT\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  offer_category_group_name,\n  offer_category_name,\n  delivery_type,\n  masthead_group,\n  masthead_category,\n  subscription_type,\n  customer_type_b2c_b2b,\n  acquisition_channel,\n  COUNT(1) AS acquisitions_count\nFROM derived_dimensions_step2\nWHERE\n  masthead_group != 'Exclude'\n  AND subscription_type = 'Digital Subscriptions'\n  AND table_nm != 'op'\n  AND acquisition_channel IS NOT NULL\n  AND masthead_category = 'The Australian and Prestige'\n  AND fy_year = 2025\n  AND customer_type_b2c_b2b IN ('B2C', '') -- This filter is present in Q2 and Q3\nGROUP BY\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  offer_category_group_name,\n  offer_category_name,\n  delivery_type,\n  masthead_group,\n  masthead_category,\n  subscription_type,\n  customer_type_b2c_b2b,\n  acquisition_channel\nORDER BY\n  fy_year DESC, fy_week_of_year DESC, acquisitions_count DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_year AS INT64)) as unique_fiscal_years,\n  COUNT(DISTINCT SAFE_CAST(t0.fy_week_of_year AS INT64)) as unique_fiscal_weeks_of_year,\n  COUNT(DISTINCT SAFE_CAST(t0.masthead AS STRING)) as unique_mastheads,\n  COUNT(DISTINCT SAFE_CAST(t0.sold_in_source_code AS STRING)) as unique_sold_in_source_codes,\n  COUNT(DISTINCT SAFE_CAST(t0.delivery_medium_type AS STRING)) as unique_delivery_medium_types,\n  COUNT(DISTINCT SAFE_CAST(t0.classification_level_2 AS STRING)) as unique_classification_level_2,\n  COUNT(DISTINCT SAFE_CAST(t0.offer_category_group_name AS STRING)) as unique_offer_category_groups,\n  COUNT(DISTINCT SAFE_CAST(t0.offer_category_name AS STRING)) as unique_offer_category_names,\n  COUNT(DISTINCT SAFE_CAST(t0.table_nm AS STRING)) as unique_table_names,\n  MIN(SAFE_CAST(t0.fy_year AS INT64)) as earliest_fy_year,\n  MAX(SAFE_CAST(t0.fy_year AS INT64)) as latest_fy_year\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\nWHERE t0.fy_year >= 2020 -- Look at a broader range for structure analysis\nLIMIT 10000;"",
    ""validation_sql"": ""WITH base_data AS (\n  SELECT\n    t0.fy_year,\n    t0.masthead,\n    t0.sold_in_source_code,\n    t0.delivery_medium_type,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n  WHERE t0.fy_year = 2025 -- Focus on the year of interest\n  LIMIT 100000 -- Sample for validation\n),\nderived_dims AS (\n  SELECT\n    *,\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_type,\n    CASE\n      WHEN (masthead = 'TA') THEN 'The Australian'\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n      WHEN (masthead = 'WT') THEN 'Other Publications'\n      WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n      WHEN (masthead IS NULL) THEN 'check'\n      ELSE 'Exclude'\n    END AS masthead_group,\n    CASE\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n      WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n      WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n      WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n      ELSE 'Exclude'\n    END AS masthead_category,\n    CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) AS delivery_email_flag_combo,\n    SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3) AS source_code_suffix_3char,\n    SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4) AS source_code_suffix_4char,\n    CASE\n      WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n      WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n      WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n      WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n      WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n      WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n      ELSE NULL\n    END AS classification_level_2_group\n  FROM base_data\n),\nfinal_dims AS (\n  SELECT\n    *,\n    CASE\n      WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n      ELSE 'Print Subscriptions'\n    END AS subscription_type,\n    CASE\n      WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n      WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n      ELSE 'Others'\n    END AS customer_type_b2c_b2b,\n    CASE\n      WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold'\n      WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook'\n      WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form'\n      WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder'\n      WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist'\n      WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines'\n      WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz'\n      WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe'\n      WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor'\n      WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP'\n      WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au'\n      WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter'\n      WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts'\n      WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports'\n      WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus'\n      WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals'\n      WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter'\n      WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget'\n      WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n      ELSE NULL\n    END AS acquisition_channel\n  FROM derived_dims\n)\nSELECT\n  'Validation Check' as test_type,\n  COUNT(*) as total_records_processed,\n  SUM(CASE WHEN masthead_group != 'Exclude' THEN 1 ELSE 0 END) as records_not_excluded_by_masthead,\n  SUM(CASE WHEN subscription_type = 'Digital Subscriptions' THEN 1 ELSE 0 END) as records_digital_subscriptions,\n  SUM(CASE WHEN table_nm != 'op' THEN 1 ELSE 0 END) as records_not_op,\n  SUM(CASE WHEN acquisition_channel IS NOT NULL THEN 1 ELSE 0 END) as records_with_channel,\n  SUM(CASE WHEN masthead_category = 'The Australian and Prestige' THEN 1 ELSE 0 END) as records_the_australian_prestige,\n  SUM(CASE WHEN fy_year = 2025 THEN 1 ELSE 0 END) as records_fy2025,\n  SUM(CASE WHEN customer_type_b2c_b2b IN ('B2C', '') THEN 1 ELSE 0 END) as records_b2c_customer_type,\n  COUNT(CASE WHEN masthead_group = 'Exclude' THEN 1 END) as excluded_masthead_count,\n  COUNT(CASE WHEN acquisition_channel IS NULL THEN 1 END) as null_acquisition_channel_count\nFROM final_dims\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    t0.masthead,\n    t0.sold_in_source_code,\n    t0.delivery_medium_type,\n    t0.subscriber_has_email_flag,\n    t0.classification_level_2\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n  WHERE t0.fy_year = 2025 -- Focus on the year of interest\n  LIMIT 100000 -- Sample for business rules validation\n),\nderived_dims AS (\n  SELECT\n    *,\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_type,\n    CASE\n      WHEN (masthead = 'TA') THEN 'The Australian'\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n      WHEN (masthead = 'WT') THEN 'Other Publications'\n      WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n      WHEN (masthead IS NULL) THEN 'check'\n      ELSE 'Exclude'\n    END AS masthead_group,\n    CASE\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n      WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n      WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n      WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n      ELSE 'Exclude'\n    END AS masthead_category,\n    CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) AS delivery_email_flag_combo,\n    LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))) AS sold_in_source_code_cleaned,\n    SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3) AS source_code_suffix_3char,\n    SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4) AS source_code_suffix_4char,\n    CASE\n      WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n      WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n      WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n      WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n      WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n      WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n      ELSE NULL\n    END AS classification_level_2_group\n),\nfinal_dims AS (\n  SELECT\n    *,\n    CASE\n      WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n      ELSE 'Print Subscriptions'\n    END AS subscription_type,\n    CASE\n      WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n      WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n      ELSE 'Others'\n    END AS customer_type_b2c_b2b,\n    CASE\n      WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold'\n      WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook'\n      WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form'\n      WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder'\n      WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist'\n      WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines'\n      WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz'\n      WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe'\n      WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor'\n      WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP'\n      WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au'\n      WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter'\n      WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts'\n      WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports'\n      WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus'\n      WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals'\n      WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter'\n      WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget'\n      WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n      ELSE NULL\n    END AS acquisition_channel\n  FROM derived_dims\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Acquisition Channel Mapping' as rule_name,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT acquisition_channel) as distinct_channels_identified,\n  COUNT(CASE WHEN acquisition_channel IS NULL THEN 1 END) as null_channels_count,\n  ARRAY_AGG(DISTINCT acquisition_channel IGNORE NULLS ORDER BY acquisition_channel LIMIT 10) as sample_channels,\n  ARRAY_AGG(DISTINCT masthead_group IGNORE NULLS ORDER BY masthead_group LIMIT 10) as sample_masthead_groups,\n  ARRAY_AGG(DISTINCT masthead_category IGNORE NULLS ORDER BY masthead_category LIMIT 10) as sample_masthead_categories,\n  ARRAY_AGG(DISTINCT subscription_type IGNORE NULLS ORDER BY subscription_type LIMIT 10) as sample_subscription_types,\n  ARRAY_AGG(DISTINCT customer_type_b2c_b2b IGNORE NULLS ORDER BY customer_type_b2c_b2b LIMIT 10) as sample_customer_types\nFROM final_dims\nLIMIT 1;"",
    ""sample_data_sql"": ""WITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2,\n    t0.offer_category_group_name,\n    t0.offer_category_name\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n  WHERE t0.fy_year = 2025 -- Focus on the year of interest\n  LIMIT 5000 -- Larger sample for data exploration\n),\nderived_dims AS (\n  SELECT\n    *,\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_type,\n    CASE\n      WHEN (masthead = 'TA') THEN 'The Australian'\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n      WHEN (masthead = 'WT') THEN 'Other Publications'\n      WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n      WHEN (masthead IS NULL) THEN 'check'\n      ELSE 'Exclude'\n    END AS masthead_group,\n    CASE\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n      WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n      WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n      WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n      ELSE 'Exclude'\n    END AS masthead_category,\n    CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) AS delivery_email_flag_combo,\n    LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))) AS sold_in_source_code_cleaned,\n    SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3) AS source_code_suffix_3char,\n    SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4) AS source_code_suffix_4char,\n    CASE\n      WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n      WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n      WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n      WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n      WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n      WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n      ELSE NULL\n    END AS classification_level_2_group\n),\nfinal_dims AS (\n  SELECT\n    *,\n    CASE\n      WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n      ELSE 'Print Subscriptions'\n    END AS subscription_type,\n    CASE\n      WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n      WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n      ELSE 'Others'\n    END AS customer_type_b2c_b2b,\n    CASE\n      WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold'\n      WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook'\n      WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form'\n      WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder'\n      WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles'\n      WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist'\n      WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed'\n      WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge'\n      WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines'\n      WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz'\n      WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe'\n      WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor'\n      WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP'\n      WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au'\n      WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter'\n      WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts'\n      WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports'\n      WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus'\n      WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals'\n      WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus'\n      WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter'\n      WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget'\n      WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n      ELSE NULL\n    END AS acquisition_channel\n  FROM derived_dims\n)\nSELECT\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  sold_in_source_code,\n  delivery_medium_type,\n  subscriber_has_email_flag,\n  table_nm,\n  classification_level_2,\n  offer_category_group_name,\n  offer_category_name,\n  delivery_type,\n  masthead_group,\n  masthead_category,\n  subscription_type,\n  customer_type_b2c_b2b,\n  acquisition_channel\nFROM final_dims\nWHERE\n  masthead_group != 'Exclude'\n  AND subscription_type = 'Digital Subscriptions'\n  AND table_nm != 'op'\n  AND acquisition_channel IS NOT NULL\n  AND masthead_category = 'The Australian and Prestige'\n  AND fy_year = 2025\n  AND customer_type_b2c_b2b IN ('B2C', '')\nORDER BY fy_year DESC, fy_week_of_year DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Fiscal year filter in all queries"",
          ""suggested_fix"": ""replace with a parameter or a dynamic fiscal year calculation (e.g., based on CURRENT_DATE())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Not Available'"",
            ""'TA'"",
            ""'CM'"",
            ""'Digital Subscriptions'"",
            ""'Print Subscriptions'"",
            ""'B2C'"",
            ""'B2B'"",
            ""'Consumer'"",
            ""'Campus'"",
            ""'Corporate'"",
            ""'Free Staff'"",
            ""'IP Access'"",
            ""'Education'"",
            ""'Above the Fold'"",
            ""'Facebook'"",
            ""'Google'"",
            ""'Instagram'"",
            ""'Linked In'"",
            ""'Reddit'"",
            ""'Twitter'"",
            ""'op'""
          ],
          ""context"": ""Used extensively in CASE statements for deriving dimensions (Delivery Type, Masthead Group, Masthead Category, Subscription Type, Customer Type, Acquisition Channel) and in WHERE clauses."",
          ""suggested_governance"": ""Create and join to dedicated lookup tables for masthead codes, source codes, classification levels, and delivery medium types. This centralizes business logic and simplifies maintenance."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year (2025) with a dashboard parameter or a dynamic calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or a custom fiscal year function)."",
      ""Externalize all hardcoded lookup values (e.g., masthead codes, source code prefixes/suffixes, classification levels, delivery medium types) into dedicated BigQuery lookup tables. Queries should then join to these tables to derive descriptive names and categories."",
      ""Consider creating a configuration table for the `table_nm != 'op'` filter if 'op' is a business-defined exclusion that might change.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""delivery_medium_type"",
      ""metric_name"": ""Delivery Medium Type (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw delivery medium type as recorded in the source system."",
      ""sql_logic"": ""t0.delivery_medium_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to derive 'Delivery Type' and 'Subscription Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year"",
      ""metric_name"": ""Fiscal Year (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year of the acquisition/cancellation/movement record."",
      ""sql_logic"": ""t0.fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""fy_year = 2025""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""yearly"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Year is hardcoded, should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_week_of_year"",
      ""metric_name"": ""Fiscal Week of Year (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year."",
      ""sql_logic"": ""t0.fy_week_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for weekly granularity in reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""weekly"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead"",
      ""metric_name"": ""Masthead (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw masthead code associated with the record."",
      ""sql_logic"": ""t0.masthead"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting acquisitions by publication. Used to derive 'Masthead Group' and 'Masthead Category'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sold_in_source_code"",
      ""metric_name"": ""Sold In Source Code (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw source code indicating where the subscription was sold."",
      ""sql_logic"": ""t0.sold_in_source_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for deriving 'Acquisition Channel'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscriber_has_email_flag"",
      ""metric_name"": ""Subscriber Has Email Flag (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Flag indicating if the subscriber has an email address."",
      ""sql_logic"": ""t0.subscriber_has_email_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used in combination with 'delivery_medium_type' to derive 'Subscription Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""table_nm"",
      ""metric_name"": ""Table Name (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the table or source system from which the record originated."",
      ""sql_logic"": ""t0.table_nm"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""table_nm != 'op'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a filter to exclude certain records (e.g., 'op' for offer page)."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'op'""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion value.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""classification_level_2"",
      ""metric_name"": ""Classification Level 2 (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw classification level 2 of the subscriber or acquisition."",
      ""sql_logic"": ""t0.classification_level_2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to derive 'Classification Level 2 Group' and 'Customer Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""offer_category_group_name"",
      ""metric_name"": ""Offer Category Group Name (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw name of the offer category group."",
      ""sql_logic"": ""t0.offer_category_group_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides context about the type of offer used for acquisition."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""offer_category_name"",
      ""metric_name"": ""Offer Category Name (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw name of the specific offer category."",
      ""sql_logic"": ""t0.offer_category_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides more granular context about the type of offer used for acquisition."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""delivery_type"",
      ""metric_name"": ""Delivery Type"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""delivery_medium_type""
      ],
      ""business_description"": ""Categorizes delivery medium type, mapping 'Not Available' to 'Digital'."",
      ""sql_logic"": ""CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Standardizes delivery type for consistent reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Not Available'"",
        ""'Digital'""
      ],
      ""governance_issues"": [
        ""Hardcoded string values.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_group"",
      ""metric_name"": ""Masthead Group"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""masthead""
      ],
      ""business_description"": ""Groups individual mastheads into broader categories like 'The Australian', 'Metro', 'Regionals', etc."",
      ""sql_logic"": ""CASE WHEN (masthead = 'TA') THEN 'The Australian' WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro' WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals' WHEN (masthead = 'WT') THEN 'Other Publications' WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications' WHEN (masthead IS NULL) THEN 'check' ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Exclude'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a higher-level view of masthead performance. Used for filtering out irrelevant mastheads."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TA'"",
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'SC'"",
        ""'CS'"",
        ""'TS'"",
        ""'AP'"",
        ""'RN'"",
        ""'PU'"",
        ""'The Australian'"",
        ""'Metro'"",
        ""'Regionals'"",
        ""'Other Publications'"",
        ""'Deep Niche Publications'"",
        ""'check'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""Hardcoded masthead codes and group names. Should use a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Null mastheads are mapped to 'check'.""
      ]
    },
    {
      ""metric_id"": ""masthead_category"",
      ""metric_name"": ""Masthead Category"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""masthead""
      ],
      ""business_description"": ""Further categorizes mastheads into strategic groups like 'States and Community' or 'The Australian and Prestige'."",
      ""sql_logic"": ""CASE WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community' WHEN (masthead = 'TA') THEN 'The Australian and Prestige' WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content' WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle' ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""masthead_category = 'The Australian and Prestige'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for strategic reporting, especially for 'The Australian and Prestige' publications."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'CS'"",
        ""'AP'"",
        ""'SC'"",
        ""'TA'"",
        ""'PU'"",
        ""'RN'"",
        ""'TS'"",
        ""'States and Community'"",
        ""'The Australian and Prestige'"",
        ""'Commercial Content'"",
        ""'Free & Lifestyle'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""Hardcoded masthead codes and category names. Should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_code_suffix_3char"",
      ""metric_name"": ""Source Code Suffix (3-char)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sold_in_source_code""
      ],
      ""business_description"": ""Extracts the last 3 characters of the cleaned 'sold_in_source_code'."",
      ""sql_logic"": ""SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a key component in deriving 'Acquisition Channel'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_code_suffix_4char"",
      ""metric_name"": ""Source Code Suffix (4-char)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sold_in_source_code""
      ],
      ""business_description"": ""Extracts the last 4 characters of the 'sold_in_source_code'."",
      ""sql_logic"": ""SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a key component in deriving 'Acquisition Channel'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""delivery_email_flag_combo"",
      ""metric_name"": ""Delivery Medium & Email Flag Combination"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""delivery_medium_type"",
        ""subscriber_has_email_flag""
      ],
      ""business_description"": ""Concatenates delivery medium type and subscriber email flag."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Intermediate step for deriving 'Subscription Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""subscription_type"",
      ""metric_name"": ""Subscription Type"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""delivery_email_flag_combo""
      ],
      ""business_description"": ""Classifies subscriptions as 'Digital Subscriptions' or 'Print Subscriptions' based on delivery and email flag."",
      ""sql_logic"": ""CASE WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""subscription_type = 'Digital Subscriptions'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial filter for focusing on digital acquisitions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Y'"",
        ""'Digital N'"",
        ""'Bundle Y'"",
        ""'Not Available Y'"",
        ""'Digital Subscriptions'"",
        ""'Print Subscriptions'""
      ],
      ""governance_issues"": [
        ""Hardcoded subscription type strings. Should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""classification_level_2_group"",
      ""metric_name"": ""Classification Level 2 Group"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""classification_level_2""
      ],
      ""business_description"": ""Groups raw classification level 2 values into broader categories like 'Consumer', 'Campus', 'Corporate excluding IP', 'Staff', 'Corporate IP', 'Education'."",
      ""sql_logic"": ""CASE WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer' WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus' WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP' WHEN (classification_level_2 = 'Free Staff') THEN 'Staff' WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP' WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a higher-level grouping of subscriber classifications, used to derive 'Customer Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'App Subscribers'"",
        ""'Bundles'"",
        ""'Digital'"",
        ""'DPE only'"",
        ""'Essentials'"",
        ""'Gift Bundles Activation'"",
        ""'Gift Digital Activation'"",
        ""'Mind Games'"",
        ""'Press Reader'"",
        ""'Print-only'"",
        ""'Wine Club'"",
        ""'Campus Activation'"",
        ""'Campus Sub'"",
        ""'Corp Volume Print'"",
        ""'Corporate Activation'"",
        ""'Corporate Enterprise Sub'"",
        ""'Corporate Enterprise Activation'"",
        ""'Corporate Enterprise Activation - Amex'"",
        ""'Corporate Enterprise Activation - Qantas'"",
        ""'Corporate Sub'"",
        ""'Corporate Volume Activation'"",
        ""'Corporate Volume Sub'"",
        ""'SMB Activation'"",
        ""'SMB Digital'"",
        ""'Free Staff'"",
        ""'IP Access'"",
        ""'Teachers Bundle'"",
        ""'Teachers Digital'"",
        ""'Teachers Print'"",
        ""'University Bundle'"",
        ""'University Digital'"",
        ""'Consumer'"",
        ""'Campus'"",
        ""'Corporate excluding IP'"",
        ""'Staff'"",
        ""'Corporate IP'"",
        ""'Education'""
      ],
      ""governance_issues"": [
        ""Extensive hardcoded classification values. Should use a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""customer_type_b2c_b2b"",
      ""metric_name"": ""Customer Type (B2C/B2B)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""classification_level_2_group""
      ],
      ""business_description"": ""Classifies customers as Business-to-Consumer (B2C), Business-to-Business (B2B), or 'Others'."",
      ""sql_logic"": ""CASE WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C' WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B' ELSE 'Others' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""customer_type_b2c_b2b IN ('B2C', '')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting acquisitions by customer type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Consumer'"",
        ""'Gift Receiver'"",
        ""'Campus'"",
        ""'Corporate'"",
        ""'Corporate excluding IP'"",
        ""'Corporate IP'"",
        ""'IP Access'"",
        ""'SMB'"",
        ""'B2C'"",
        ""'B2B'"",
        ""'Others'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Hardcoded customer type strings. Should use a lookup table. The empty string filter is unusual and should be investigated.""
      ],
      ""data_quality_concerns"": [
        ""The empty string in the filter `IN ('B2C', '')` suggests potential data quality issues or an undocumented business rule.""
      ]
    },
    {
      ""metric_id"": ""acquisition_channel"",
      ""metric_name"": ""Acquisition Channel"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""source_code_suffix_3char"",
        ""source_code_suffix_4char"",
        ""sold_in_source_code""
      ],
      ""business_description"": ""Categorizes the source of acquisition based on patterns in the 'sold_in_source_code'."",
      ""sql_logic"": ""CASE WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold' WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook' WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form' WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed' WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles' WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder' WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles' WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus' WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge' WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist' WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed' WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge' WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines' WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz' WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe' WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor' WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP' WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook' WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot' WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google' WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News' WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In' WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au' WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter' WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts' WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports' WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit' WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus' WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals' WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus' WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place' WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus' WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter' WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget' WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook' WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google' WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In' WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit' WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""acquisition_channel IS NOT NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for analyzing acquisition performance by marketing channel."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'_AB'"",
        ""'_BB'"",
        ""'_CF'"",
        ""'_CS'"",
        ""'_FA'"",
        ""'_FF'"",
        ""'_NA'"",
        ""'_PC'"",
        ""'_PE'"",
        ""'_SL'"",
        ""'_SS'"",
        ""'_TE'"",
        ""'_TH'"",
        ""'_TO'"",
        ""'_WS'"",
        ""'PRED'"",
        ""'AMP'"",
        ""'FBK'"",
        ""'FMB'"",
        ""'GGL'"",
        ""'GGN'"",
        ""'INS'"",
        ""'LIN'"",
        ""'NEW'"",
        ""'NWL'"",
        ""'POD'"",
        ""'POR'"",
        ""'RED'"",
        ""'SCP'"",
        ""'SEC'"",
        ""'TCA'"",
        ""'TMP'"",
        ""'TWA'"",
        ""'TWT'"",
        ""'WID'"",
        ""'_FBK'"",
        ""'_GGL'"",
        ""'_LIN'"",
        ""'_RED'"",
        ""'_TWT'"",
        ""'Above the Fold'"",
        ""'Blackbook'"",
        ""'Community Form'"",
        ""'Closing Speed'"",
        ""'Free Articles'"",
        ""'Form Finder'"",
        ""'News Articles'"",
        ""'True Crime Aus'"",
        ""'Punters Edge'"",
        ""'Shortlist'"",
        ""'Setting Speed'"",
        ""'Tippers Edge'"",
        ""'Todays Headlines'"",
        ""'The Oz'"",
        ""'Why Subscribe'"",
        ""'Predictor'"",
        ""'Google AMP'"",
        ""'Facebook'"",
        ""'Facebook Messenger Bot'"",
        ""'Google'"",
        ""'Google News'"",
        ""'Instagram'"",
        ""'Linked In'"",
        ""'news.com.au'"",
        ""'Newsletter'"",
        ""'Podcasts'"",
        ""'Newsletter Sports'"",
        ""'Reddit'"",
        ""'Supercoach Plus'"",
        ""'Sectionals'"",
        ""'Tips Mrket Place'"",
        ""'The Weekend Aus'"",
        ""'Twitter'"",
        ""'Widget'""
      ],
      ""governance_issues"": [
        ""Extremely complex and extensive hardcoded logic. This should be externalized to a comprehensive lookup table or a UDF for maintainability and accuracy. Duplicate 'INS' check is present.""
      ],
      ""data_quality_concerns"": [
        ""The order of WHEN clauses is critical and could lead to miscategorization if not carefully managed. Null values are explicitly filtered out.""
      ]
    },
    {
      ""metric_id"": ""acquisitions_count"",
      ""metric_name"": ""Acquisitions Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of acquisition records matching the applied filters and dimensions."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Exclude'"",
        ""subscription_type = 'Digital Subscriptions'"",
        ""table_nm != 'op'"",
        ""acquisition_channel IS NOT NULL"",
        ""masthead_category = 'The Australian and Prestige'"",
        ""fy_year = 2025"",
        ""customer_type_b2c_b2b IN ('B2C', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Core metric for tracking digital subscriber acquisitions for specific mastheads and customer types."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""acquisitions_count"",
      ""related_metrics"": [
        ""fy_year"",
        ""fy_week_of_year"",
        ""masthead"",
        ""offer_category_group_name"",
        ""offer_category_name"",
        ""delivery_type"",
        ""masthead_group"",
        ""masthead_category"",
        ""subscription_type"",
        ""customer_type_b2c_b2b"",
        ""acquisition_channel""
      ],
      ""relationship_description"": ""The 'Acquisitions Count' is an aggregation (COUNT(1)) of records, grouped by and filtered on all the listed dimensions. Changes to the definition or filters of any of these dimensions will directly impact the 'Acquisitions Count'."",
      ""mathematical_formula"": ""COUNT(records) GROUP BY [dimensions] WHERE [filters]"",
      ""business_validation"": ""This relationship ensures that the acquisition count is always presented within the context of its defining attributes (time, masthead, channel, customer type, etc.), allowing for segmented analysis of acquisition performance."",
      ""validation_sql"": ""SELECT\n  'Metric Interaction Validation' as test_type,\n  COUNT(*) as total_records_after_filters,\n  SUM(CASE WHEN acquisition_channel IS NOT NULL THEN 1 ELSE 0 END) as records_with_channel_for_count,\n  SUM(CASE WHEN subscription_type = 'Digital Subscriptions' THEN 1 ELSE 0 END) as records_digital_subs_for_count\nFROM (\n  -- Re-use the final CTE from primary_analysis_sql to ensure consistent filtering\n  WITH base_data AS (\n    SELECT\n      t0.delivery_medium_type,\n      t0.fy_year,\n      t0.fy_week_of_year,\n      t0.masthead,\n      t0.sold_in_source_code,\n      t0.subscriber_has_email_flag,\n      t0.table_nm,\n      t0.classification_level_2,\n      t0.offer_category_group_name,\n      t0.offer_category_name\n    FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n    WHERE t0.fy_year = 2025\n    LIMIT 1000000\n  ),\n  derived_dimensions_step1 AS (\n    SELECT\n      fy_year,\n      fy_week_of_year,\n      masthead,\n      sold_in_source_code,\n      subscriber_has_email_flag,\n      table_nm,\n      classification_level_2,\n      offer_category_group_name,\n      offer_category_name,\n      CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_type,\n      CASE\n        WHEN (masthead = 'TA') THEN 'The Australian'\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n        WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n        WHEN (masthead = 'WT') THEN 'Other Publications'\n        WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n        WHEN (masthead IS NULL) THEN 'check'\n        ELSE 'Exclude'\n      END AS masthead_group,\n      CASE\n        WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n        WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n        WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n        WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n        ELSE 'Exclude'\n      END AS masthead_category,\n      LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))) AS sold_in_source_code_cleaned,\n      SAFE.RIGHT(LTRIM(RTRIM(SAFE_CAST(sold_in_source_code AS STRING))), 3) AS source_code_suffix_3char,\n      SAFE.RIGHT(SAFE_CAST(sold_in_source_code AS STRING), 4) AS source_code_suffix_4char,\n      CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) AS delivery_email_flag_combo,\n      CASE\n        WHEN (classification_level_2 IN ('App Subscribers', 'Bundles', 'Digital', 'DPE only', 'Essentials', 'Gift Bundles Activation', 'Gift Digital Activation', 'Mind Games', 'Press Reader', 'Print-only', 'Wine Club')) THEN 'Consumer'\n        WHEN (classification_level_2 IN ('Campus Activation', 'Campus Sub')) THEN 'Campus'\n        WHEN (classification_level_2 IN ('Corp Volume Print', 'Corporate Activation', 'Corporate Enterprise Sub', 'Corporate Enterprise Activation', 'Corporate Enterprise Activation - Amex', 'Corporate Enterprise Activation - Qantas', 'Corporate Sub', 'Corporate Volume Activation', 'Corporate Volume Sub', 'SMB Activation', 'SMB Digital')) THEN 'Corporate excluding IP'\n        WHEN (classification_level_2 = 'Free Staff') THEN 'Staff'\n        WHEN (classification_level_2 = 'IP Access') THEN 'Corporate IP'\n        WHEN (classification_level_2 IN ('Teachers Bundle', 'Teachers Digital', 'Teachers Print', 'University Bundle', 'University Digital')) THEN 'Education'\n        ELSE NULL\n      END AS classification_level_2_group\n    FROM base_data\n  ),\n  final_dims AS (\n    SELECT\n      *,\n      CASE\n        WHEN (delivery_email_flag_combo IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n        ELSE 'Print Subscriptions'\n      END AS subscription_type,\n      CASE\n        WHEN (classification_level_2_group IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n        WHEN (classification_level_2_group IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n        ELSE 'Others'\n      END AS customer_type_b2c_b2b,\n      CASE\n        WHEN (STRPOS(source_code_suffix_3char, '_AB') > 0) THEN 'Above the Fold'\n        WHEN (STRPOS(source_code_suffix_3char, '_BB') > 0) THEN 'Blackbook'\n        WHEN (STRPOS(source_code_suffix_3char, '_CF') > 0) THEN 'Community Form'\n        WHEN (STRPOS(source_code_suffix_3char, '_CS') > 0) THEN 'Closing Speed'\n        WHEN (STRPOS(source_code_suffix_3char, '_FA') > 0) THEN 'Free Articles'\n        WHEN (STRPOS(source_code_suffix_3char, '_FF') > 0) THEN 'Form Finder'\n        WHEN (STRPOS(source_code_suffix_3char, '_NA') > 0) THEN 'News Articles'\n        WHEN (STRPOS(source_code_suffix_3char, '_PC') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(source_code_suffix_3char, '_PE') > 0) THEN 'Punters Edge'\n        WHEN (STRPOS(source_code_suffix_3char, '_SL') > 0) THEN 'Shortlist'\n        WHEN (STRPOS(source_code_suffix_3char, '_SS') > 0) THEN 'Setting Speed'\n        WHEN (STRPOS(source_code_suffix_3char, '_TE') > 0) THEN 'Tippers Edge'\n        WHEN (STRPOS(source_code_suffix_3char, '_TH') > 0) THEN 'Todays Headlines'\n        WHEN (STRPOS(source_code_suffix_3char, '_TO') > 0) THEN 'The Oz'\n        WHEN (STRPOS(source_code_suffix_3char, '_WS') > 0) THEN 'Why Subscribe'\n        WHEN (STRPOS(source_code_suffix_4char, 'PRED') > 0) THEN 'Predictor'\n        WHEN (STRPOS(source_code_suffix_3char, 'AMP') > 0) THEN 'Google AMP'\n        WHEN (STRPOS(source_code_suffix_3char, 'FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(source_code_suffix_3char, 'FMB') > 0) THEN 'Facebook Messenger Bot'\n        WHEN (STRPOS(source_code_suffix_3char, 'GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(source_code_suffix_3char, 'GGN') > 0) THEN 'Google News'\n        WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(source_code_suffix_3char, 'LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(source_code_suffix_3char, 'NEW') > 0) THEN 'news.com.au'\n        WHEN (STRPOS(source_code_suffix_3char, 'NWL') > 0) THEN 'Newsletter'\n        WHEN (STRPOS(source_code_suffix_3char, 'POD') > 0) THEN 'Podcasts'\n        WHEN (STRPOS(source_code_suffix_3char, 'POR') > 0) THEN 'Newsletter Sports'\n        WHEN (STRPOS(source_code_suffix_3char, 'RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(source_code_suffix_3char, 'SCP') > 0) THEN 'Supercoach Plus'\n        WHEN (STRPOS(source_code_suffix_3char, 'SEC') > 0) THEN 'Sectionals'\n        WHEN (STRPOS(source_code_suffix_3char, 'TCA') > 0) THEN 'True Crime Aus'\n        WHEN (STRPOS(source_code_suffix_3char, 'TMP') > 0) THEN 'Tips Mrket Place'\n        WHEN (STRPOS(source_code_suffix_3char, 'TWA') > 0) THEN 'The Weekend Aus'\n        WHEN (STRPOS(source_code_suffix_3char, 'TWT') > 0) THEN 'Twitter'\n        WHEN (STRPOS(source_code_suffix_3char, 'WID') > 0) THEN 'Widget'\n        WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n        WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n        WHEN (STRPOS(source_code_suffix_3char, 'INS') > 0) THEN 'Instagram'\n        WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n        WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n        WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n        ELSE NULL\n      END AS acquisition_channel\n    FROM derived_dimensions_step1\n  )\n  SELECT *\n  FROM final_dims\n  WHERE\n    masthead_group != 'Exclude'\n    AND subscription_type = 'Digital Subscriptions'\n    AND table_nm != 'op'\n    AND acquisition_channel IS NOT NULL\n    AND masthead_category = 'The Australian and Prestige'\n    AND fy_year = 2025\n    AND customer_type_b2c_b2b IN ('B2C', '')\n) AS filtered_data\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,42
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""705edcb5-737a-4600-b1a7-11870177f97a"",
    ""dashboard_name"": ""Programmatic Impact Reporting"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_short_month"",
      ""source_publishing_division"",
      ""revenue_transaction_status"",
      ""advertiser_name"",
      ""revenue_type_level2"",
      ""revenue_group_subtype"",
      ""source_system_code"",
      ""cost_model_type"",
      ""data_load_datetime""
    ],
    ""date_range_detected"": ""Financial Year 2025 (specifically October for some queries)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""Oct""
    ],
    ""hardcoded_values_found"": [
      ""Medium Rare Content Agency"",
      ""Billed"",
      ""Booked"",
      ""Programmatic"",
      ""Programmatic Source"",
      ""Digital"",
      ""Foxtel Management Pty Ltd"",
      ""PLUTO""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""transaction statuses should use a lookup table"",
      ""business unit/advertiser names should use a master data table"",
      ""revenue types/subtypes should use a lookup table"",
      ""source system codes should use a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.data_load_datetime,\n    t0.financial_short_month,\n    SAFE_CAST(t0.financial_year AS STRING) AS financial_year_str, -- Cast for consistent comparison with string literals\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.cost_model_type,\n    t0.advertiser_name,\n    t0.gross_revenue_amount,\n    t0.revenue_group_subtype,\n    t0.revenue_type_level2,\n    t0.source_system_code\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    SAFE_CAST(t0.financial_year AS STRING) = '2025' -- Common hardcoded year\n    AND t0.source_publishing_division != 'Medium Rare Content Agency' -- Common exclusion\n    AND t0.revenue_transaction_status IN ('Billed', 'Booked') -- Common status filter\n    AND t0.financial_year IS NOT NULL -- Explicitly check for non-null financial year\n)\nSELECT\n  DATETIME_TRUNC(data_load_datetime, SECOND) AS data_load_datetime_truncated,\n  financial_short_month,\n  financial_year_str AS financial_year,\n  revenue_transaction_status,\n  source_publishing_division,\n  cost_model_type,\n  advertiser_name,\n  revenue_group_subtype,\n  revenue_type_level2,\n  source_system_code,\n  SUM(SAFE_CAST(gross_revenue_amount AS NUMERIC)) AS total_gross_revenue_amount,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT source_system_code) AS unique_source_systems\nFROM base_data\nGROUP BY\n  data_load_datetime_truncated,\n  financial_short_month,\n  financial_year,\n  revenue_transaction_status,\n  source_publishing_division,\n  cost_model_type,\n  advertiser_name,\n  revenue_group_subtype,\n  revenue_type_level2,\n  source_system_code\nORDER BY\n  data_load_datetime_truncated DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS STRING)) as unique_financial_years,\n  COUNT(DISTINCT t0.financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT t0.source_publishing_division) as unique_publishing_divisions,\n  COUNT(DISTINCT t0.revenue_transaction_status) as unique_transaction_statuses,\n  COUNT(DISTINCT t0.cost_model_type) as unique_cost_models,\n  COUNT(DISTINCT t0.advertiser_name) as unique_advertisers,\n  COUNT(DISTINCT t0.revenue_group_subtype) as unique_revenue_subtypes,\n  COUNT(DISTINCT t0.revenue_type_level2) as unique_revenue_level2_types,\n  COUNT(DISTINCT t0.source_system_code) as unique_source_system_codes,\n  MIN(t0.data_load_datetime) as earliest_data_load_datetime,\n  MAX(t0.data_load_datetime) as latest_data_load_datetime,\n  AVG(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) as avg_gross_revenue_amount,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) as null_gross_revenue_amount_count\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025' -- Focus on the year of interest\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY) -- Add a recent data filter for structure analysis\nLIMIT 1000;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(t0.data_load_datetime) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_status_test,\n  CASE WHEN COUNT(CASE WHEN SAFE_CAST(t0.financial_year AS STRING) = '2025' THEN 1 END) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_2025_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025' -- Focus on the year of interest\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY) -- Recent data for validation\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'source_publishing_division_exclusion' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) as records_passing_exclusion,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_exclusion\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY)\n\nUNION ALL\n\nSELECT\n  'Business Rule Validation' as validation_type,\n  'revenue_transaction_status_inclusion' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END) as records_passing_inclusion,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_inclusion\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY)\n\nUNION ALL\n\nSELECT\n  'Business Rule Validation' as validation_type,\n  'programmatic_revenue_filters' as rule_name,\n  COUNT(*) as total_records_evaluated,\n  SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic'\n            AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital')\n            AND t0.advertiser_name = 'Foxtel Management Pty Ltd'\n            AND t0.source_system_code = 'PLUTO' THEN 1 ELSE 0 END) as records_passing_programmatic_filters,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic'\n            AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital')\n            AND t0.advertiser_name = 'Foxtel Management Pty Ltd'\n            AND t0.source_system_code = 'PLUTO' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_programmatic_filters\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY);"",
    ""sample_data_sql"": ""SELECT\n  t0.data_load_datetime,\n  t0.financial_short_month,\n  SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n  t0.revenue_transaction_status,\n  t0.source_publishing_division,\n  t0.cost_model_type,\n  t0.advertiser_name,\n  SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) AS gross_revenue_amount,\n  t0.revenue_group_subtype,\n  t0.revenue_type_level2,\n  t0.source_system_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND t0.data_load_datetime >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 30 DAY) -- Get recent data\n  AND t0.gross_revenue_amount IS NOT NULL -- Ensure meaningful samples\nORDER BY\n  t0.data_load_datetime DESC, SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter in all queries"",
          ""suggested_fix"": ""replace with a parameter or relative date logic (e.g., CURRENT_DATE() for current financial year)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""Oct"",
          ""original_format"": ""Oct"",
          ""context"": ""financial_short_month filter in query 1"",
          ""suggested_fix"": ""replace with a parameter or relative month logic"",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""exclusion for source_publishing_division in all queries"",
          ""suggested_governance"": ""use a governed exclusion list or parameter"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Billed'"",
            ""'Booked'""
          ],
          ""context"": ""inclusion for revenue_transaction_status in all queries"",
          ""suggested_governance"": ""use a governed lookup table for transaction statuses"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic'""
          ],
          ""context"": ""inclusion for revenue_type_level2 in query 3"",
          ""suggested_governance"": ""use a governed lookup table for revenue types"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic Source'"",
            ""'Digital'""
          ],
          ""context"": ""inclusion for revenue_group_subtype in query 3"",
          ""suggested_governance"": ""use a governed lookup table for revenue group subtypes"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Foxtel Management Pty Ltd'""
          ],
          ""context"": ""inclusion for advertiser_name in query 3"",
          ""suggested_governance"": ""use a governed advertiser master data table"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'""
          ],
          ""context"": ""inclusion for source_system_code in query 3"",
          ""suggested_governance"": ""use a governed lookup table for source system codes"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and months with date parameters or relative date functions (e.g., `_DS_FINANCIAL_YEAR`, `_DS_FINANCIAL_MONTH`)."",
      ""Replace hardcoded lookup values (e.g., transaction statuses, revenue types, source systems) with joins to governed reference tables or parameters."",
      ""Use configuration tables for business rules (e.g., `Medium Rare Content Agency` exclusion) instead of hardcoded logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""data_load_datetime_truncated"",
      ""metric_name"": ""Data Load Datetime (Truncated to Second)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""datetime"",
      ""aggregation_level"": ""second"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp when the data record was loaded, truncated to the second, used for time-series analysis."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.data_load_datetime, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""financial_short_month = 'Oct'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Provides granular time-based insights into data availability or transaction timing."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""Oct""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Oct')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for monthly breakdowns of revenue and other metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for annual reporting and comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction (e.g., 'Billed', 'Booked')."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for filtering to only include recognized revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""!= 'Medium Rare Content Agency'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by internal business units, with a specific exclusion."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""exclusion value should be governed""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""cost_model_type"",
      ""metric_name"": ""Cost Model Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of cost model associated with the advertising campaign (e.g., CPM, CPC)."",
      ""sql_logic"": ""t0.cost_model_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a breakdown of revenue by pricing model."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the revenue."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""= 'Foxtel Management Pty Ltd'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for client-specific reporting, often filtered to specific clients."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Foxtel Management Pty Ltd'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A more granular classification of revenue, such as 'Programmatic Source' or 'Digital'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Programmatic Source', 'Digital')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue streams, especially for programmatic reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Programmatic Source'"",
        ""'Digital'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_level2"",
      ""metric_name"": ""Revenue Type Level 2"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A second level classification of revenue type, specifically 'Programmatic' in this context."",
      ""sql_logic"": ""t0.revenue_type_level2"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""= 'Programmatic'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for isolating programmatic revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Programmatic'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_code"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The code identifying the source system where the revenue transaction originated (e.g., 'PLUTO')."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""= 'PLUTO'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter revenue by the system it was recorded in."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue amounts, representing the total revenue generated."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""numeric"",
      ""business_context"": ""The primary financial metric for programmatic impact reporting, indicating the total value of billed/booked programmatic ad sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'"",
        ""'Billed'"",
        ""'Booked'"",
        ""'Programmatic'"",
        ""'Programmatic Source'"",
        ""'Digital'"",
        ""'Foxtel Management Pty Ltd'"",
        ""'PLUTO'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in gross_revenue_amount"",
        ""data freshness dependent on underlying ETL""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_short_month"",
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""revenue_type_level2"",
        ""revenue_group_subtype"",
        ""advertiser_name"",
        ""source_system_code""
      ],
      ""relationship_description"": ""The 'Total Gross Revenue Amount' is heavily filtered by specific values of various dimensions, indicating a highly specific scope for this dashboard's reporting. Changes to these filter values will directly impact the reported revenue."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [dimension_filters_apply]"",
      ""business_validation"": ""Ensures that only revenue meeting specific criteria (e.g., billed/booked, programmatic, for a specific client/system) is included in the total, aligning with the 'Programmatic Impact Reporting' focus."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital') AND t0.advertiser_name = 'Foxtel Management Pty Ltd' AND t0.source_system_code = 'PLUTO' THEN SAFE_CAST(t0.gross_revenue_amount AS NUMERIC) ELSE 0 END) AS programmatic_foxtel_pluto_revenue,\n  SUM(SAFE_CAST(t0.gross_revenue_amount AS NUMERIC)) AS total_revenue_billed_booked\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  SAFE_CAST(t0.financial_year AS STRING) = '2025'\n  AND t0.source_publishing_division != 'Medium Rare Content Agency'\n  AND t0.revenue_transaction_status IN ('Billed', 'Booked')\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,43
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d4d68a71-2b12-4caf-bc6b-96fc2d18a025"",
    ""dashboard_name"": ""Adsales Details Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 16,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_name"",
      ""employee_name"",
      ""agency_group"",
      ""unified_publication_name"",
      ""portfolio_conformed_name_current"",
      ""portfolio_conformed_name_sync"",
      ""publication_date"",
      ""dow"",
      ""calendar_month_short_name"",
      ""calendar_year"",
      ""financial_short_month"",
      ""financial_year""
    ],
    ""date_range_detected"": ""mixed, includes 2024, 2025, and other years based on filters"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""2024"",
      ""Feb"",
      ""Mar"",
      ""Apr"",
      ""May"",
      ""Jun"",
      ""Jul"",
      ""Aug"",
      ""Sep""
    ],
    ""hardcoded_values_found"": [
      ""NSW IA C3"",
      ""Marley-Kale Kentia"",
      ""Australian Meat Processor Corporation"",
      ""Australian Pork"",
      ""CMC Markets"",
      ""Coco Republic"",
      ""Dry July Limited"",
      ""Fred Hollows Foundation"",
      ""LGT Crestone"",
      ""Vogue Australia"",
      ""Monday"",
      ""Tuesday"",
      ""Wednesday"",
      ""Thursday"",
      ""Friday"",
      ""Saturday"",
      ""Sunday""
    ],
    ""governance_opportunities"": [
      ""Dates (years, months) should be parameterized or use relative date functions."",
      ""Portfolio names, employee names, advertiser names, and publication names should be sourced from governed reference tables."",
      ""Day of week formatting could be handled by a UDF or a lookup table for consistency.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  base_data AS (\n    SELECT\n      SAFE_CAST(t0.publication_date AS DATE) AS publication_date,\n      SAFE_CAST(t0.advertiser_name AS STRING) AS advertiser_name,\n      SAFE_CAST(t0.employee_name AS STRING) AS employee_name,\n      SAFE_CAST(t0.agency_group AS STRING) AS agency_group,\n      SAFE_CAST(t0.unified_publication_name AS STRING) AS unified_publication_name,\n      SAFE_CAST(t0.dow AS STRING) AS dow_raw,\n      CASE\n        WHEN (t0.dow = 'Monday') THEN 'Monday'\n        WHEN (t0.dow = 'Tuesday') THEN ' Tuesday'\n        WHEN (t0.dow = 'Wednesday') THEN '  Wednesday'\n        WHEN (t0.dow = 'Thursday') THEN '   Thursday'\n        WHEN (t0.dow = 'Friday') THEN '    Friday'\n        WHEN (t0.dow = 'Saturday') THEN '     Saturday'\n        WHEN (t0.dow = 'Sunday') THEN '      Sunday'\n        ELSE NULL\n      END AS day_of_week_formatted,\n      CASE\n        WHEN ('Fin' = 'Fin') THEN SAFE_CAST(t0.financial_short_month AS STRING)\n        ELSE SAFE_CAST(t0.calendar_month_short_name AS STRING)\n      END AS selected_financial_period_month,\n      CASE\n        WHEN ('Fin' = 'Fin') THEN SAFE_CAST(t0.financial_year AS STRING)\n        ELSE SAFE_CAST(t0.calendar_year AS STRING)\n      END AS selected_financial_period_year,\n      CASE\n        WHEN ('Curr' = 'Curr') THEN SAFE_CAST(t0.portfolio_conformed_name_current AS STRING)\n        ELSE SAFE_CAST(t0.portfolio_conformed_name_sync AS STRING)\n      END AS selected_portfolio_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n    WHERE\n      SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  )\nSELECT\n  publication_date,\n  advertiser_name,\n  employee_name,\n  agency_group,\n  unified_publication_name,\n  day_of_week_formatted,\n  selected_financial_period_month,\n  selected_financial_period_year,\n  selected_portfolio_name,\n  COUNT(*) AS record_count\nFROM\n  base_data\nGROUP BY\n  publication_date,\n  advertiser_name,\n  employee_name,\n  agency_group,\n  unified_publication_name,\n  day_of_week_formatted,\n  selected_financial_period_month,\n  selected_financial_period_year,\n  selected_portfolio_name\nORDER BY\n  publication_date DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT SAFE_CAST(t0.publication_date AS DATE)) AS unique_publication_dates,\n  COUNT(DISTINCT SAFE_CAST(t0.advertiser_name AS STRING)) AS unique_advertisers,\n  COUNT(DISTINCT SAFE_CAST(t0.employee_name AS STRING)) AS unique_employees,\n  COUNT(DISTINCT SAFE_CAST(t0.agency_group AS STRING)) AS unique_agency_groups,\n  COUNT(DISTINCT SAFE_CAST(t0.unified_publication_name AS STRING)) AS unique_publications,\n  COUNT(DISTINCT SAFE_CAST(t0.financial_year AS STRING)) AS unique_financial_years,\n  MIN(SAFE_CAST(t0.publication_date AS DATE)) AS earliest_publication_date,\n  MAX(SAFE_CAST(t0.publication_date AS DATE)) AS latest_publication_date\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN COUNT(*) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS data_presence_test,\n  CASE\n    WHEN MAX(SAFE_CAST(t0.publication_date AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS'\n    ELSE 'FAIL'\n  END AS freshness_test,\n  CASE\n    WHEN COUNT(DISTINCT SAFE_CAST(t0.advertiser_name AS STRING)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS advertiser_data_test,\n  CASE\n    WHEN COUNT(DISTINCT SAFE_CAST(t0.employee_name AS STRING)) > 0 THEN 'PASS'\n    ELSE 'FAIL'\n  END AS employee_data_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  base_data AS (\n    SELECT\n      SAFE_CAST(t0.dow AS STRING) AS dow_raw,\n      CASE\n        WHEN (t0.dow = 'Monday') THEN 'Monday'\n        WHEN (t0.dow = 'Tuesday') THEN ' Tuesday'\n        WHEN (t0.dow = 'Wednesday') THEN '  Wednesday'\n        WHEN (t0.dow = 'Thursday') THEN '   Thursday'\n        WHEN (t0.dow = 'Friday') THEN '    Friday'\n        WHEN (t0.dow = 'Saturday') THEN '     Saturday'\n        WHEN (t0.dow = 'Sunday') THEN '      Sunday'\n        ELSE NULL\n      END AS day_of_week_formatted,\n      SAFE_CAST(t0.financial_short_month AS STRING) AS financial_month,\n      SAFE_CAST(t0.calendar_month_short_name AS STRING) AS calendar_month,\n      SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n      SAFE_CAST(t0.calendar_year AS STRING) AS calendar_year,\n      SAFE_CAST(t0.portfolio_conformed_name_current AS STRING) AS portfolio_current,\n      SAFE_CAST(t0.portfolio_conformed_name_sync AS STRING) AS portfolio_sync\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n    WHERE\n      SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'day_of_week_formatting_check' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(\n    CASE\n      WHEN dow_raw = 'Monday'\n      AND day_of_week_formatted = 'Monday' THEN 1\n      WHEN dow_raw = 'Tuesday'\n      AND day_of_week_formatted = ' Tuesday' THEN 1\n      WHEN dow_raw = 'Wednesday'\n      AND day_of_week_formatted = '  Wednesday' THEN 1\n      WHEN dow_raw = 'Thursday'\n      AND day_of_week_formatted = '   Thursday' THEN 1\n      WHEN dow_raw = 'Friday'\n      AND day_of_week_formatted = '    Friday' THEN 1\n      WHEN dow_raw = 'Saturday'\n      AND day_of_week_formatted = '     Saturday' THEN 1\n      WHEN dow_raw = 'Sunday'\n      AND day_of_week_formatted = '      Sunday' THEN 1\n      ELSE 0\n    END\n  ) AS records_passing_dow_format,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN dow_raw = 'Monday'\n        AND day_of_week_formatted = 'Monday' THEN 1\n        WHEN dow_raw = 'Tuesday'\n        AND day_of_week_formatted = ' Tuesday' THEN 1\n        WHEN dow_raw = 'Wednesday'\n        AND day_of_week_formatted = '  Wednesday' THEN 1\n        WHEN dow_raw = 'Thursday'\n        AND day_of_week_formatted = '   Thursday' THEN 1\n        WHEN dow_raw = 'Friday'\n        AND day_of_week_formatted = '    Friday' THEN 1\n        WHEN dow_raw = 'Saturday'\n        AND day_of_week_formatted = '     Saturday' THEN 1\n        WHEN dow_raw = 'Sunday'\n        AND day_of_week_formatted = '      Sunday' THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS dow_format_pass_rate_percentage,\n  'financial_vs_calendar_selection_check' AS rule_name_2,\n  SUM(\n    CASE\n      WHEN financial_month IS NOT NULL\n      AND financial_year IS NOT NULL\n      AND portfolio_current IS NOT NULL THEN 1\n      ELSE 0\n    END\n  ) AS records_with_financial_selection,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN financial_month IS NOT NULL\n        AND financial_year IS NOT NULL\n        AND portfolio_current IS NOT NULL THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS financial_selection_rate_percentage\nFROM\n  base_data;"",
    ""sample_data_sql"": ""SELECT\n  SAFE_CAST(t0.publication_date AS DATE) AS publication_date,\n  SAFE_CAST(t0.advertiser_name AS STRING) AS advertiser_name,\n  SAFE_CAST(t0.employee_name AS STRING) AS employee_name,\n  SAFE_CAST(t0.agency_group AS STRING) AS agency_group,\n  SAFE_CAST(t0.unified_publication_name AS STRING) AS unified_publication_name,\n  SAFE_CAST(t0.dow AS STRING) AS dow,\n  SAFE_CAST(t0.calendar_month_short_name AS STRING) AS calendar_month_short_name,\n  SAFE_CAST(t0.calendar_year AS STRING) AS calendar_year,\n  SAFE_CAST(t0.financial_short_month AS STRING) AS financial_short_month,\n  SAFE_CAST(t0.financial_year AS STRING) AS financial_year,\n  SAFE_CAST(t0.portfolio_conformed_name_current AS STRING) AS portfolio_conformed_name_current,\n  SAFE_CAST(t0.portfolio_conformed_name_sync AS STRING) AS portfolio_conformed_name_sync\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  SAFE_CAST(t0.publication_date AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY\n  SAFE_CAST(t0.publication_date AS DATE) DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""string"",
          ""context"": ""Used as a filter for financial year in Query 2 (clmn10_ IN ('2025'))"",
          ""suggested_fix"": ""Replace with a parameter or relative year (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) + 1`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024"",
          ""original_format"": ""string"",
          ""context"": ""Used as an exclusion filter for financial year in Query 3 (clmn7_ NOT IN ('2024'))"",
          ""suggested_fix"": ""Replace with a parameter or relative year (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""Feb, Mar, Apr, May, Jun"",
          ""original_format"": ""string list"",
          ""context"": ""Used as a filter for financial month in Query 2 (clmn9_ IN (...))"",
          ""suggested_fix"": ""Replace with a parameter or derive from a date dimension table for dynamic period selection."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""Jul, Aug, Sep"",
          ""original_format"": ""string list"",
          ""context"": ""Used as a filter for financial month in Query 3 (clmn6_ IN (...))"",
          ""suggested_fix"": ""Replace with a parameter or derive from a date dimension table for dynamic period selection."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Fin' = 'Fin'"",
            ""'Curr' = 'Curr'""
          ],
          ""context"": ""These conditions are always true, forcing the selection of financial month/year and current portfolio name. While not strictly 'hardcoded variables' in the sense of needing a lookup, they represent fixed business logic that could be made explicit or configurable if the logic ever needed to change."",
          ""suggested_governance"": ""Document this fixed logic. If flexibility is ever needed, introduce a parameter or configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'NSW IA C3'""
          ],
          ""context"": ""Portfolio name hardcoded in filter in Query 2 (clmn11_ IN ('NSW IA C3'))"",
          ""suggested_governance"": ""Join to a `portfolio_master` or `portfolio_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Marley-Kale Kentia'""
          ],
          ""context"": ""Employee name hardcoded in filter in Query 2 (clmn3_ IN ('Marley-Kale Kentia'))"",
          ""suggested_governance"": ""Join to an `employee_master` or `employee_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Australian Meat Processor Corporation'"",
            ""'Australian Pork'"",
            ""'CMC Markets'"",
            ""'Coco Republic'"",
            ""'Dry July Limited'"",
            ""'Fred Hollows Foundation'"",
            ""'LGT Crestone'""
          ],
          ""context"": ""Advertiser names hardcoded in filter in Query 2 (clmn0_ IN (...))"",
          ""suggested_governance"": ""Join to an `advertiser_master` or `advertiser_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Vogue Australia'""
          ],
          ""context"": ""Publication name hardcoded in filter in Query 3 (clmn5_ IN ('Vogue Australia'))"",
          ""suggested_governance"": ""Join to a `publication_master` or `publication_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Monday'"",
            ""' Tuesday'"",
            ""'  Wednesday'"",
            ""'   Thursday'"",
            ""'    Friday'"",
            ""'     Saturday'"",
            ""'      Sunday'""
          ],
          ""context"": ""Day of week strings used for formatting and ordering in Query 1."",
          ""suggested_governance"": ""Use a UDF for consistent formatting or a small lookup table for display values if the ordering logic is complex."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded years and months with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values (e.g., portfolio names, employee names, advertiser names, publication names) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., specific month ranges for reports) instead of hardcoded logic.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""day_of_week_raw"",
      ""metric_name"": ""Day of Week (Raw)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw day of the week from the source data (e.g., 'Monday')."",
      ""sql_logic"": ""t0.dow"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a base for formatted day of week."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""day_of_week_formatted"",
      ""metric_name"": ""Day of Week (Formatted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""day_of_week_raw""
      ],
      ""business_description"": ""Day of the week formatted with leading spaces for specific sorting/display in Looker Studio (e.g., ' Monday', '  Tuesday')."",
      ""sql_logic"": ""CASE WHEN (dow = 'Monday') THEN 'Monday' WHEN (dow = 'Tuesday') THEN ' Tuesday' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a custom sorted list of days of the week for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Monday'"",
        ""' Tuesday'"",
        ""'  Wednesday'"",
        ""'   Thursday'"",
        ""'    Friday'"",
        ""'     Saturday'"",
        ""'      Sunday'""
      ],
      ""governance_issues"": [
        ""Formatting logic is hardcoded; consider a UDF or a lookup table for consistent application.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the ad sales record."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('Australian Meat Processor Corporation', 'Australian Pork', 'CMC Markets', 'Coco Republic', 'Dry July Limited', 'Fred Hollows Foundation', 'LGT Crestone')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing ad sales performance by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Australian Meat Processor Corporation'"",
        ""'Australian Pork'"",
        ""'CMC Markets'"",
        ""'Coco Republic'"",
        ""'Dry July Limited'"",
        ""'Fred Hollows Foundation'"",
        ""'LGT Crestone'""
      ],
      ""governance_issues"": [
        ""Advertiser names are hardcoded in filters; should use a governed reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""employee_name"",
      ""metric_name"": ""Employee Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the employee responsible for the ad sales record."",
      ""sql_logic"": ""t0.employee_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('Marley-Kale Kentia')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing ad sales performance by employee."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Marley-Kale Kentia'""
      ],
      ""governance_issues"": [
        ""Employee names are hardcoded in filters; should use a governed reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_date"",
      ""metric_name"": ""Publication Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date on which the advertisement was published."",
      ""sql_logic"": ""t0.publication_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary date dimension for time-series analysis of ad sales."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_month_short_name"",
      ""metric_name"": ""Calendar Month Short Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the calendar month (e.g., 'Jan', 'Feb')."",
      ""sql_logic"": ""t0.calendar_month_short_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Alternative month dimension, used if financial period is not selected."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""calendar_year"",
      ""metric_name"": ""Calendar Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar year."",
      ""sql_logic"": ""t0.calendar_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative year dimension, used if financial period is not selected."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Month Short Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Jul', 'Aug')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary month dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary year dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_conformed_name_current"",
      ""metric_name"": ""Portfolio Conformed Name (Current)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The current conformed name of the portfolio."",
      ""sql_logic"": ""t0.portfolio_conformed_name_current"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as the primary portfolio name if 'Curr' logic is applied."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name (Sync)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The synchronized conformed name of the portfolio."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Alternative portfolio name, used if 'Curr' logic is not applied."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""selected_financial_period_month"",
      ""metric_name"": ""Selected Financial Period Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_short_month"",
        ""calendar_month_short_name""
      ],
      ""business_description"": ""The month selected for financial reporting, which is always the financial short month based on the 'Fin'='Fin' logic."",
      ""sql_logic"": ""CASE WHEN ('Fin' = 'Fin') THEN financial_short_month ELSE calendar_month_short_name END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('Feb', 'Mar', 'Apr', 'May', 'Jun')"",
        ""IN ('Jul', 'Aug', 'Sep')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for filtering and grouping data by financial month."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""Feb"",
        ""Mar"",
        ""Apr"",
        ""May"",
        ""Jun"",
        ""Jul"",
        ""Aug"",
        ""Sep""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Month lists are hardcoded; should be parameterized or sourced from a date dimension table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""selected_financial_period_year"",
      ""metric_name"": ""Selected Financial Period Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""calendar_year""
      ],
      ""business_description"": ""The year selected for financial reporting, which is always the financial year based on the 'Fin'='Fin' logic."",
      ""sql_logic"": ""CASE WHEN ('Fin' = 'Fin') THEN financial_year ELSE calendar_year END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('2025')"",
        ""NOT IN ('2024') OR IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for filtering and grouping data by financial year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""2024""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Years are hardcoded; should be parameterized or use relative date functions.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""selected_portfolio_name"",
      ""metric_name"": ""Selected Portfolio Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""portfolio_conformed_name_current"",
        ""portfolio_conformed_name_sync""
      ],
      ""business_description"": ""The portfolio name selected for reporting, which is always the current conformed name based on the 'Curr'='Curr' logic."",
      ""sql_logic"": ""CASE WHEN ('Curr' = 'Curr') THEN portfolio_conformed_name_current ELSE portfolio_conformed_name_sync END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('NSW IA C3')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for filtering and grouping data by portfolio."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'NSW IA C3'""
      ],
      ""governance_issues"": [
        ""Portfolio name is hardcoded; should use a governed reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""agency_group"",
      ""metric_name"": ""Agency Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group to which an advertising agency belongs."",
      ""sql_logic"": ""t0.agency_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Dimension for analyzing ad sales by agency group."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_column"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unified name of the publication where the ad appeared."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""IN ('Vogue Australia')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Dimension for analyzing ad sales by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Vogue Australia'""
      ],
      ""governance_issues"": [
        ""Publication name is hardcoded; should use a governed reference table.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""publication_date"",
      ""related_metrics"": [
        ""advertiser_name"",
        ""employee_name"",
        ""selected_financial_period_month"",
        ""selected_financial_period_year"",
        ""selected_portfolio_name"",
        ""agency_group"",
        ""unified_publication_name""
      ],
      ""relationship_description"": ""Filters applied to various dimensions (e.g., specific years, months, advertisers, employees, portfolios, publications) directly impact the set of 'publication_date' values retrieved, and vice-versa."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that the displayed publication dates correspond to the selected dimensional filters, providing context for the ad sales data."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(t0.publication_date AS DATE)) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0 WHERE SAFE_CAST(t0.financial_year AS STRING) = '2025' AND SAFE_CAST(t0.portfolio_conformed_name_current AS STRING) = 'NSW IA C3';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,45
