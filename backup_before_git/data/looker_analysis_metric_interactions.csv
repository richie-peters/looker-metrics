interaction_type,primary_metric,related_metrics,relationship_description,mathematical_formula,business_validation,validation_sql,relationship_strength,business_impact,response_id,dashboard_id,related_metrics_count,related_metrics_text
filter_impact,total_actual_amount,"['source_system_count', 'fiscal_year', 'source_system_name_dim']","All identified metrics and dimensions are filtered by the same period control logic, specifically including data for 'Current Period' (CP) and 'Prior Year' (PY) as defined in the `v_asl_DIM_period_control` table.",N/A,Ensures that all displayed financial data and its associated dimensions are consistently aligned to the defined 'Current Period' and 'Prior Year' for comparative analysis.,"SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c ON os.fiscal_week_id = c.fy_year_week_number JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control ON c.fy_year_week_number = control.source_week_number WHERE control.period_name IN ('CP', 'PY') LIMIT 1;",strong,high,0,d7412673-0af1-4efe-8374-ca475b001fb6,3,"source_system_count, fiscal_year, source_system_name_dim"
filter_impact,revenue_gross_sum,"['portfolio_parent_group', 'transaction_type']",Total Gross Revenue is filtered by specific Portfolio Parent Groups ('INDEPENDENT AGENCIES NSW') and excludes 'Guaranteed' Transaction Types.,SUM(RevenueGross) WHERE PortfolioParentGroup = 'INDEPENDENT AGENCIES NSW' AND TransactionType != 'Guaranteed',"Ensures that the revenue reported is specific to a particular agency type and excludes certain transaction models, reflecting a specific business segment's performance.",SELECT SUM(RevenueGross) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE PortfolioParentGroup = 'INDEPENDENT AGENCIES NSW' AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) LIMIT 1;,strong,high,1,6f1c8731-02da-464f-b146-bf2947860735,2,"portfolio_parent_group, transaction_type"
filter_impact,advertiser,['financial_period_derived'],The list of Advertisers is filtered to those active within a specific Financial Period ('FY2025 - Q4').,"DISTINCT Advertiser WHERE CONCAT('FY',FinancialYear,' - ',FinancialQuarter) = 'FY2025 - Q4'","Identifies advertisers relevant to a specific financial reporting quarter, useful for quarterly reviews or planning.","SELECT COUNT(DISTINCT Advertiser) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) = 'FY2025 - Q4' LIMIT 1;",strong,medium,1,6f1c8731-02da-464f-b146-bf2947860735,1,financial_period_derived
filter_impact,derived_date_complex,"['portfolio_parent_group', 'financial_period_derived', 'transaction_type', 'portfolio_child_group']","The derived date is filtered by multiple dimensions: specific Portfolio Parent Group ('CONSORTIUM VIC'), Financial Period ('FY2025 - Q4'), Transaction Type ('Deal'), and specific Portfolio Child Groups ('VIC CON B3', 'VIC CON B2', 'VIC CON B1'), in addition to a complex date comparison.","DerivedDate WHERE PortfolioParentGroup = 'CONSORTIUM VIC' AND FinancialPeriod = 'FY2025 - Q4' AND TransactionType = 'Deal' AND PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1') AND ConstructedDate <= '2025-06-26'","This combination of filters suggests a highly specific analysis of dates related to 'Deal' transactions within a particular consortium and financial quarter, likely for detailed operational or regional performance review.","SELECT COUNT(DISTINCT SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 WHEN (t0.FinancialMonthNumber = 2) THEN 8 WHEN (t0.FinancialMonthNumber = 3) THEN 9 WHEN (t0.FinancialMonthNumber = 4) THEN 10 WHEN (t0.FinancialMonthNumber = 5) THEN 11 WHEN (t0.FinancialMonthNumber = 6) THEN 12 WHEN (t0.FinancialMonthNumber = 7) THEN 1 WHEN (t0.FinancialMonthNumber = 8) THEN 2 WHEN (t0.FinancialMonthNumber = 9) THEN 3 WHEN (t0.FinancialMonthNumber = 10) THEN 4 WHEN (t0.FinancialMonthNumber = 11) THEN 5 WHEN (t0.FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) AS DATETIME), MONTH) AS DATE)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0 WHERE (DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 WHEN (t0.FinancialMonthNumber = 2) THEN 8 WHEN (t0.FinancialMonthNumber = 3) THEN 9 WHEN (t0.FinancialMonthNumber = 4) THEN 10 WHEN (t0.FinancialMonthNumber = 5) THEN 11 WHEN (t0.FinancialMonthNumber = 6) THEN 12 WHEN (t0.FinancialMonthNumber = 7) THEN 1 WHEN (t0.FinancialMonthNumber = 8) THEN 2 WHEN (t0.FinancialMonthNumber = 9) THEN 3 WHEN (t0.FinancialMonthNumber = 10) THEN 4 WHEN (t0.FinancialMonthNumber = 11) THEN 5 WHEN (t0.FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) <= DATE('2025-06-26')) AND t0.PortfolioParentGroup IN ('CONSORTIUM VIC') AND CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING)) IN ('FY2025 - Q4') AND t0.TransactionType IN ('Deal') AND t0.PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1') LIMIT 1;",strong,high,1,6f1c8731-02da-464f-b146-bf2947860735,4,"portfolio_parent_group, financial_period_derived, transaction_type, portfolio_child_group"
mathematical_relationship,gross_revenue_current_fy_k,['gross_revenue_current_fy'],"Gross Revenue (Current FY, '000) is derived by dividing Gross Revenue (Current FY) by 1000.",gross_revenue_current_fy_k = gross_revenue_current_fy / 1000,"This relationship ensures that the metric is presented in thousands for readability, assuming the base currency is in units.",SELECT SUM(gross_revenue_current_fy_k * 1000) = SUM(gross_revenue_current_fy) FROM primary_analysis_sql_output;,strong,medium,2,52c11c9c-052a-4e45-9cda-8fecd87d7964,1,gross_revenue_current_fy
mathematical_relationship,gross_revenue_next_fy_k,['gross_revenue_next_fy'],"Gross Revenue (Next FY, '000) is derived by dividing Gross Revenue (Next FY) by 1000.",gross_revenue_next_fy_k = gross_revenue_next_fy / 1000,"This relationship ensures that the metric is presented in thousands for readability, assuming the base currency is in units.",SELECT SUM(gross_revenue_next_fy_k * 1000) = SUM(gross_revenue_next_fy) FROM primary_analysis_sql_output;,strong,medium,2,52c11c9c-052a-4e45-9cda-8fecd87d7964,1,gross_revenue_next_fy
dependency,gross_revenue_conditional_k,"['total_gross_revenue', 'relative_fy_year_offset', 'unified_publication_name', 'revenue_type', 'revenue_group_subtype', 'sales_segment_l_2_name_sync', 'advertiser_parent', 'booking_line_created_date', 'fix_date_lod']","This metric's calculation is highly conditional, depending on multiple dimensions and a complex date logic involving `fix_date_lod` and `booking_line_created_date` relative to a hardcoded date and `advertiser_parent`.",Conditional sum of gross_revenue_amount / 1000 based on publication type OR a complex date comparison involving DoubleClick and booking dates.,"This indicates a specific business rule for a particular revenue stream (e.g., programmatic or digital revenue) that needs careful validation and understanding of its purpose.","SELECT SUM(gross_revenue_conditional_k) FROM primary_analysis_sql_output WHERE unified_publication_name IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') AND relative_fy_year_offset = 0;",strong,high,2,52c11c9c-052a-4e45-9cda-8fecd87d7964,9,"total_gross_revenue, relative_fy_year_offset, unified_publication_name, revenue_type, revenue_group_subtype, sales_segment_l_2_name_sync, advertiser_parent, booking_line_created_date, fix_date_lod"
filter_impact,total_gross_revenue,"['revenue_transaction_status', 'style_name', 'source_publishing_division_name', 'publication_name', 'advertiser_id_src', 'ad_type_name']","All gross revenue metrics are filtered by specific transaction statuses ('BILLED', 'BOOKED'), exclusion of 'ROP COMPOSITE' style, exclusion of 'MEDIUM RARE CONTENT AGENCY' division, and a complex rule for 'SUDDENLY' publications.",N/A,"These filters define the scope of 'reportable' revenue, ensuring only relevant transactions are included in performance metrics. Any changes to these filters will directly impact reported revenue figures.","SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) NOT IN ('BILLED', 'BOOKED'); -- Should return 0 or very few records if filter is effective",strong,high,2,52c11c9c-052a-4e45-9cda-8fecd87d7964,6,"revenue_transaction_status, style_name, source_publishing_division_name, publication_name, advertiser_id_src, ad_type_name"
mathematical_relationship,gross_amount_diff_total,"['digital_revenue', 'print_revenue']","Digital Revenue and Print Revenue are components of the Total Gross Amount Difference, specifically for records where revenue_type is 'DIGITAL' or 'PRINT' respectively.",gross_amount_diff_total = SUM(digital_revenue) + SUM(print_revenue) + SUM(other_revenue_types),"Ensures that the sum of specific revenue types (Digital, Print) contributes correctly to the overall gross amount difference, allowing for breakdown analysis.","SELECT
  SUM(gross_amount_diff_total) AS total_gross_amount,
  SUM(digital_revenue) AS total_digital_revenue,
  SUM(print_revenue) AS total_print_revenue,
  SUM(gross_amount_diff_total) - SUM(digital_revenue) - SUM(print_revenue) AS total_other_revenue
FROM (
  SELECT
    GROSS_AMOUNT_DIFF AS gross_amount_diff_total,
    CASE WHEN revenue_type = 'DIGITAL' THEN GROSS_AMOUNT_DIFF ELSE 0 END AS digital_revenue,
    CASE WHEN revenue_type = 'PRINT' THEN GROSS_AMOUNT_DIFF ELSE 0 END AS print_revenue
  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`
  WHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
) subquery;",strong,high,3,a1b901e6-c4fb-44bc-955a-3a7070c15829,2,"digital_revenue, print_revenue"
dependency,revenue_category,"['xtend_flag', 'revenue_sub_type', 'portfolio_parent_group_name_sync']","The 'Revenue Category' dimension is a derived field whose value depends on the values of 'xtend_flag', 'revenue_sub_type', and 'portfolio_parent_group_name_sync' through a complex CASE statement.",N/A (conditional logic),"This relationship defines how raw data attributes are transformed into a higher-level business classification, critical for aggregated reporting and strategic insights.","SELECT
  xtend_flag,
  revenue_sub_type,
  portfolio_parent_group_name_sync,
  CASE
    WHEN xtend_flag = 'Y' THEN 'XTEND'
    WHEN (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'
    WHEN revenue_sub_type = 'DIGITAL' THEN 'ADPT DIGITAL'
    WHEN SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' THEN 'SUNDRY'
    ELSE revenue_sub_type
  END AS calculated_revenue_category,
  COUNT(*) as record_count
FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`
WHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
GROUP BY 1, 2, 3, 4
LIMIT 100;",strong,high,3,a1b901e6-c4fb-44bc-955a-3a7070c15829,3,"xtend_flag, revenue_sub_type, portfolio_parent_group_name_sync"
dependency,total_gross_revenue,['gross_revenue_amount_base'],Total Gross Revenue is the sum of the base Gross Revenue Amount.,Total Gross Revenue = SUM(Gross Revenue Amount (Base)),Ensures that the aggregated revenue correctly reflects the sum of individual revenue entries.,"SELECT SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE relative_fy_year_offset IN (-1, 0, 1)",strong,high,4,e83da1de-4227-43e6-bcc6-73051c66914b,1,gross_revenue_amount_base
dependency,ad_size_category,['adsize_name'],Ad Size Category is a derived dimension based on pattern matching within the adsize_name.,N/A (conditional logic),"Categorizes ad bookings for high-level analysis, ensuring consistent grouping of ad types.","SELECT adsize_name, CASE WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$') THEN 'Sponsorship' WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$') THEN 'Production' ELSE 'Media' END AS derived_category FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` LIMIT 100",strong,medium,4,e83da1de-4227-43e6-bcc6-73051c66914b,1,adsize_name
filter_impact,total_gross_revenue,"['financial_year', 'fy_year_month_number', 'revenue_transaction_status', 'booking_name', 'ad_size_category']",Total Gross Revenue is frequently filtered and grouped by these dimensions to provide specific business insights.,N/A,"Allows slicing and dicing of revenue data by time, status, specific campaigns, and ad types.","SELECT financial_year, SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE financial_year = '2025' GROUP BY 1",strong,high,4,e83da1de-4227-43e6-bcc6-73051c66914b,5,"financial_year, fy_year_month_number, revenue_transaction_status, booking_name, ad_size_category"
hierarchical,total_records,['count_by_scenario'],The sum of 'Count by Scenario' across all distinct scenarios should equal the 'Total Records' in the dataset.,SUM(count_by_scenario) = total_records,Ensures data consistency and that all records are correctly categorized and accounted for within the scenario breakdown.,"WITH
  scenario_sum AS (
    SELECT
      SUM(count_by_scenario) AS sum_of_scenario_counts
    FROM (
      SELECT
        COUNT(1) AS count_by_scenario
      FROM
        `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`
      GROUP BY
        scenario
    )
  ),
  total_records_cte AS (
    SELECT
      COUNT(1) AS total_records
    FROM
      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`
  )
SELECT
  'Consistency Check: Sum of Scenarios vs. Total Records' AS check_name,
  ss.sum_of_scenario_counts,
  tr.total_records,
  CASE
    WHEN ss.sum_of_scenario_counts = tr.total_records THEN 'PASS'
    ELSE 'FAIL'
  END AS consistency_status
FROM
  scenario_sum ss,
  total_records_cte tr;",strong,high,5,52dd1ac1-19b5-4695-a7e6-632ef7a9dba3,1,count_by_scenario
mathematical_relationship,total_spend_ty_k,['total_spend_ly_k'],Calculates the percentage change in total spend from the last period to the current period.,((total_spend_ty_k - total_spend_ly_k) / total_spend_ly_k) * 100,This relationship is crucial for understanding growth or decline in overall advertising spend.,"WITH
  adex_data AS (
    SELECT
      *,
      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,
      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year
    FROM
      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource
    WHERE
      source = 'Adex'
  ),
  TEMP1 AS (
    SELECT
      *,
      (SELECT MAX(date) FROM adex_data) AS latest_date,
      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year
    FROM
      adex_data
  ),
  pre_aggregated_data AS (
    SELECT
      *,
      CASE 'Rolling 12 months'
        WHEN 'Rolling 12 months' THEN
        CASE
          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'
          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'
          ELSE NULL
        END
        WHEN 'Calendar Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'
          ELSE NULL
        END
        WHEN 'Financial Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'
          ELSE NULL
        END
        ELSE NULL
      END AS ty_ly_embed,
      SAFE_DIVIDE(Spend, 1000) AS spend_k
    FROM
      TEMP1
  )
SELECT 
  SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) AS total_spend_ty_k,
  SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END) AS total_spend_ly_k,
  SAFE_DIVIDE(SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) - SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END), SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END)) * 100 AS spend_growth_percentage
FROM pre_aggregated_data
WHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);",strong,high,6,601ed0d2-e944-4189-8170-d593c8e72026,1,total_spend_ly_k
mathematical_relationship,news_corp_spend_ty_k,['news_corp_spend_ly_k'],Calculates the percentage change in News Corp spend from the last period to the current period.,((news_corp_spend_ty_k - news_corp_spend_ly_k) / news_corp_spend_ly_k) * 100,This relationship is vital for assessing the performance of the 'NEWS CORP' media network over time.,"WITH
  adex_data AS (
    SELECT
      *,
      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,
      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year
    FROM
      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource
    WHERE
      source = 'Adex'
  ),
  TEMP1 AS (
    SELECT
      *,
      (SELECT MAX(date) FROM adex_data) AS latest_date,
      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year
    FROM
      adex_data
  ),
  pre_aggregated_data AS (
    SELECT
      *,
      CASE 'Rolling 12 months'
        WHEN 'Rolling 12 months' THEN
        CASE
          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'
          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'
          ELSE NULL
        END
        WHEN 'Calendar Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'
          ELSE NULL
        END
        WHEN 'Financial Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'
          ELSE NULL
        END
        ELSE NULL
      END AS ty_ly_embed,
      SAFE_DIVIDE(Spend, 1000) AS spend_k
    FROM
      TEMP1
  )
SELECT 
  SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) AS news_corp_spend_ty_k,
  SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) AS news_corp_spend_ly_k,
  SAFE_DIVIDE(SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) - SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END), SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END)) * 100 AS news_corp_spend_growth_percentage
FROM pre_aggregated_data
WHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);",strong,high,6,601ed0d2-e944-4189-8170-d593c8e72026,1,news_corp_spend_ly_k
filter_impact,total_spend_ty_k,"['Advertiser', 'portfolio_parent_group_name', 'quarter_period']",The total spend metrics are filtered by specific Advertiser lists and Portfolio Parent Group names combined with Quarter periods in the original dashboard queries. These filters are applied at the dashboard level on top of the unified dataset.,N/A,"These filters narrow down the scope of spend analysis to specific client segments or timeframes, allowing for targeted performance reviews.","WITH
  adex_data AS (
    SELECT
      *,
      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,
      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year
    FROM
      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource
    WHERE
      source = 'Adex'
  ),
  TEMP1 AS (
    SELECT
      *,
      (SELECT MAX(date) FROM adex_data) AS latest_date,
      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year
    FROM
      adex_data
  ),
  pre_aggregated_data AS (
    SELECT
      *,
      CASE 'Rolling 12 months'
        WHEN 'Rolling 12 months' THEN
        CASE
          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'
          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'
          ELSE NULL
        END
        WHEN 'Calendar Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'
          ELSE NULL
        END
        WHEN 'Financial Year' THEN
        CASE
          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'
          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'
          ELSE NULL
        END
        ELSE NULL
      END AS ty_ly_embed,
      SAFE_DIVIDE(Spend, 1000) AS spend_k,
      CASE
        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Jan', 'Feb', 'Mar') THEN 'Q1'
        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Apr', 'May', 'Jun') THEN 'Q2'
        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Jul', 'Aug', 'Sep') THEN 'Q3'
        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Oct', 'Nov', 'Dec') THEN 'Q4'
        ELSE NULL
      END AS calendar_quarter
    FROM
      TEMP1
  )
SELECT 
  Advertiser,
  portfolio_parent_group_name,
  calendar_quarter AS quarter_period,
  SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) AS total_spend_ty_k_filtered
FROM pre_aggregated_data
WHERE 
  (portfolio_parent_group_name IN ('KEY ACCOUNTS TRAVEL') AND calendar_quarter IN ('Q2'))
  OR
  (Advertiser IN ('NT Dept Of Trade Business & Innovation', 'NT Dept Of Chief Minister', 'NT Dept Of Infrastructure Planning & Logistics', 'NT Dept Of Industry Tourism & Trade', 'NT Dept Of Education Employment & Training', 'NT Dept Of Tourism & Culture', 'NT Dept Of Transport', 'NT Dept Of Attorney-General & Justice', 'NT Dept Of Environment & Natural Resources', 'NT Dept Of Lands Planning & The Environment', 'NT Dept Of Health', 'NT Dept Of Police Fire & Emergency Services', 'NT Dept Of Business', 'NT Dept Of Territory Families, Housing & Communities', 'NT Dept Of Primary Industry & Resources', 'NT Dept Of Environment Parks & Water Security', 'NT Dept Of Corporate & Information Services'))
GROUP BY 1, 2, 3
LIMIT 100;",strong,high,6,601ed0d2-e944-4189-8170-d593c8e72026,3,"Advertiser, portfolio_parent_group_name, quarter_period"
filter_impact,total_revenue_net,"['source', 'source_transaction_type_upper', 'advertiser', 'financial_period_label', 'month_start_date']","Total Revenue Net is filtered by specific values of Source, Source Transaction Type, Advertiser, Financial Period Label, and Month Start Date. Different combinations of these filters are applied across various dashboard components.",SUM(revenuenet) WHERE [dimension] IN (...) AND [date_dimension] IN (...),"Ensures that revenue figures are specific to the selected advertising platforms, deal types, clients, and time periods.","SELECT SUM(revenuenet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` WHERE UPPER(SAFE_CAST(source_transaction_type AS STRING)) IN ('DEAL', 'UFR') AND advertiser IN ('The Smith Family *');",strong,high,7,783f341c-8660-4e90-bab8-9bc860119cf5,5,"source, source_transaction_type_upper, advertiser, financial_period_label, month_start_date"
dependency,month_start_date,['financial_period_label'],"The 'month_start_date' is derived from the 'financialyear' and 'financialmonthnumber' columns, which are also used to construct the 'financial_period_label'. Both are time-related dimensions, but 'month_start_date' is adjusted by a 6-month offset.","month_start_date = TRUNC(DATE(financialyear, financialmonthnumber, 1) - 6 MONTH, MONTH)","Ensures consistent time-based analysis, allowing for reporting by both calendar month (adjusted) and financial quarter.","SELECT DISTINCT month_start_date, financial_period_label FROM (
  SELECT
    t0.financialyear,
    t0.financialmonthnumber,
    t0.financialquarter,
    CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS financial_period_label,
    SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS month_start_date
  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0
) WHERE month_start_date IS NOT NULL AND financial_period_label IS NOT NULL LIMIT 100;",strong,medium,7,783f341c-8660-4e90-bab8-9bc860119cf5,1,financial_period_label
filter_impact,buyer,['advertiser'],"The 'buyer' dimension is retrieved in queries that filter on specific 'advertiser' values, implying that certain buyers are associated with particular advertisers.",SELECT buyer WHERE advertiser IN (...),"Allows for analysis of buyers specific to certain key advertisers, which is important for account management and sales strategy.","SELECT DISTINCT buyer, advertiser FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` WHERE advertiser IN ('Kmart Corporation *', 'Target Corporation *') LIMIT 100;",medium,medium,7,783f341c-8660-4e90-bab8-9bc860119cf5,1,advertiser
filter_impact,current_month_flag,"['kargo_static_days_current_month', 'non_adx_num_days_current_month', 'financial_month_display_kargo', 'financial_month_display_non_adx']","The 'Current Month Flag' acts as a primary filter, ensuring that all related metrics and display strings reflect data only for the current financial month.",N/A,Ensures that pacing metrics are always relevant to the ongoing reporting period.,SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1;,strong,high,8,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,4,"kargo_static_days_current_month, non_adx_num_days_current_month, financial_month_display_kargo, financial_month_display_non_adx"
filter_impact,source_dimension,"['kargo_static_days_current_month', 'non_adx_num_days_current_month', 'financial_month_display_kargo', 'financial_month_display_non_adx']","The 'Source' dimension is used to conditionally calculate and display 'Static Days' for 'Kargo' and 'Num Days' for 'Non-AdX' sources, ensuring metrics are specific to their respective platforms.",N/A,"Allows for platform-specific pacing analysis, which is critical for managing advertising campaigns.","SELECT SUM(CASE WHEN Source = 'Kargo' THEN StaticDays ELSE 0 END) AS KargoDays, SUM(CASE WHEN Source NOT IN ('AdX') OR Source IS NULL THEN NumDays ELSE 0 END) AS NonAdXDays FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1;",strong,high,8,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,4,"kargo_static_days_current_month, non_adx_num_days_current_month, financial_month_display_kargo, financial_month_display_non_adx"
mathematical_relationship,financial_month_id,"['financial_year', 'financial_month_number']","The 'Financial Month ID' is a derived metric, mathematically combining 'Financial Year' and 'Financial Month Number' to create a unique, sortable identifier for each financial month.",Financial_Month_ID = (FinancialYear * 100) + FinancialMonthNumber,"Ensures consistent and correct chronological ordering of financial periods, regardless of the financial year start date.","SELECT FinancialYear, FinancialMonthNumber, ((FinancialYear * 100) + FinancialMonthNumber) AS CalculatedID FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` LIMIT 10;",strong,medium,8,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"financial_year, financial_month_number"
dependency,financial_month_display_kargo,"['static_days', 'financial_month_id']",The 'Financial Month Display (Kargo)' is a display-oriented string that directly depends on the 'Static Days' metric and the 'Financial Month ID' for its content.,"Display String = CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )')",Provides a user-friendly representation of the key pacing metric for Kargo within its relevant financial period.,"SELECT StaticDays, Financial_Month_ID, CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )') AS DisplayString FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND Source = 'Kargo' LIMIT 10;",strong,medium,8,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"static_days, financial_month_id"
dependency,financial_month_display_non_adx,"['num_days', 'financial_month_id']",The 'Financial Month Display (Non-AdX)' is a display-oriented string that directly depends on the 'Num Days' metric and the 'Financial Month ID' for its content.,"Display String = CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )')",Provides a user-friendly representation of the key pacing metric for Non-AdX sources within its relevant financial period.,"SELECT NumDays, Financial_Month_ID, CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )') AS DisplayString FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) LIMIT 10;",strong,medium,8,a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f,2,"num_days, financial_month_id"
dependency,fiscal_week_month_string,"['week_number_adjusted', 'custom_fiscal_month_number']",The fiscal week and month string is formatted using the calculated adjusted week number and custom fiscal month number.,N/A (string concatenation),Ensures the time dimension is correctly presented according to the defined fiscal calendar.,"SELECT fiscal_week_month_string, week_number_adjusted, custom_fiscal_month_number FROM primary_analysis_sql LIMIT 10",strong,high,9,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"week_number_adjusted, custom_fiscal_month_number"
dependency,recognition_type,"['delivery_medium_type', 'email_bundle_flag']",The recognition type (Digital/Print) is determined by the delivery medium and an internal email/bundle flag.,N/A (conditional logic),Ensures subscriptions are correctly classified for digital vs. print analysis.,"SELECT delivery_medium_type, subscriber_has_email_flag, recognition_type FROM primary_analysis_sql LIMIT 10",strong,high,9,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"delivery_medium_type, email_bundle_flag"
dependency,masthead_group_broad,['masthead_group_detailed'],"The broad masthead grouping is derived from the detailed masthead grouping, consolidating specific mastheads into larger categories.",N/A (conditional grouping),"Provides a summarized view of masthead performance, essential for high-level reporting.","SELECT masthead_group_detailed, masthead_group_broad FROM primary_analysis_sql LIMIT 10",strong,high,9,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,1,masthead_group_detailed
filter_impact,digital_subscription_count,"['recognition_type', 'masthead_group_broad']","The digital subscription count is directly filtered by 'Digital Recognition' and excludes 'Discontinued' mastheads, ensuring only relevant digital subscriptions are counted.",COUNT(DISTINCT subscription_id) WHERE recognition_type = 'Digital Recognition' AND masthead_group_broad != 'Discontinued',Ensures the core metric aligns with the dashboard's focus on 'Optimizing Digital Subscriptions'.,SELECT COUNT(DISTINCT subscription_id_placeholder) FROM primary_analysis_sql WHERE recognition_type = 'Digital Recognition' AND masthead_group_broad != 'Discontinued',strong,high,9,5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26,2,"recognition_type, masthead_group_broad"
mathematical_relationship,current_fy_gross_revenue_k_minus_current_fy_lgb_k,"['current_fy_gross_revenue_k', 'current_fy_lgb_k']",This metric is the difference between 'Current FY Gross Revenue (K)' and 'Current FY LGB (K)'.,Current FY Gross Revenue (K) - Current FY LGB (K),"Measures the variance between actual/non-future revenue and the forecasted LGB for the current financial year. A positive value indicates revenue exceeding LGB, while a negative value indicates LGB exceeding revenue.","SELECT
  SUM(current_fy_gross_revenue_k) - SUM(current_fy_lgb_k) AS calculated_difference,
  SUM(current_fy_gross_revenue_k_minus_current_fy_lgb_k) AS reported_difference
FROM (
  -- Insert the primary_analysis_sql here, or a CTE that calculates these metrics
  -- For brevity, assuming a pre-calculated table or CTE 'metrics_data'
  SELECT
    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (gross_revenue_amount / 1000) ELSE 0 END) AS current_fy_gross_revenue_k,
    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (ss_lgb / 1000) ELSE 0 END) AS current_fy_lgb_k,
    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (gross_revenue_amount / 1000) ELSE 0 END - CASE WHEN (relative_fy_year_offset = 0) THEN (ss_lgb / 1000) ELSE 0 END) AS current_fy_gross_revenue_k_minus_current_fy_lgb_k
  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`
  WHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)
) AS metrics_data
LIMIT 1;",strong,high,10,4d8074b2-17a8-48ba-babe-c536359b1f64,2,"current_fy_gross_revenue_k, current_fy_lgb_k"
dependency,current_fy_non_future_gross_revenue_k,"['current_fy_gross_revenue', 'is_future_period_flag']",This metric is derived from 'Current FY Gross Revenue' by excluding records where 'is_future_period_flag' is not 'N' and then dividing by 1000.,"SUM(IF(relative_fy_year_offset = 0 AND is_future_period_flag = 'N', gross_revenue_amount, 0)) / 1000","Ensures that revenue figures for the current FY only include actualized or non-future bookings, providing a more conservative and reliable revenue measure.","SELECT
  SUM(CASE WHEN relative_fy_year_offset = 0 AND is_future_period_flag = 'N' THEN gross_revenue_amount ELSE 0 END) / 1000 AS calculated_k,
  SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = 0 AND is_future_period_flag = 'N') THEN gross_revenue_amount ELSE 0 END, 1000)) AS reported_k
FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`
WHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)
LIMIT 1;",strong,high,10,4d8074b2-17a8-48ba-babe-c536359b1f64,2,"current_fy_gross_revenue, is_future_period_flag"
dependency,previous_fy_gross_revenue_lod_date_le_1_year_ago,"['previous_fy_gross_revenue', 'fix_date_lod', 'booking_line_created_date', 'date_one_year_ago']","This metric is a subset of 'Previous FY Gross Revenue', filtered by a specific date condition on the 'effective_lod_date' relative to a hardcoded 'one year ago' date.","SUM(IF(relative_fy_year_offset = -1 AND effective_lod_date <= date_one_year_ago, gross_revenue_amount, 0))","Provides a specific historical comparison point, useful for analyzing performance against a fixed prior period baseline. The hardcoded date makes this less dynamic.","SELECT
  SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS calculated_value,
  SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS reported_value
FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`
WHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)
LIMIT 1;",strong,medium,10,4d8074b2-17a8-48ba-babe-c536359b1f64,4,"previous_fy_gross_revenue, fix_date_lod, booking_line_created_date, date_one_year_ago"
dependency,last_fy_gross_revenue,['gross_revenue_amount_base'],Last FY Gross Revenue is a conditional sum of the base gross revenue amount.,SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END),Ensures that only revenue from the previous financial year is included for comparison.,SELECT SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS last_fy_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE financial_year = (SELECT financial_year FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 LIMIT 1) - 1,strong,high,11,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,1,gross_revenue_amount_base
dependency,current_fy_gross_revenue,['gross_revenue_amount_base'],Current FY Gross Revenue is a conditional sum of the base gross revenue amount.,SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END),Ensures that only revenue from the current financial year is included for tracking.,SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE financial_year = (SELECT financial_year FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 LIMIT 1),strong,high,11,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,1,gross_revenue_amount_base
filter_impact,last_fy_digital_revenue_conditional,"['gross_revenue_amount_base', 'revenue_type_dim', 'revenue_group_subtype_dim', 'sales_segment_l_2_name_sync_dim', 'advertiser_parent_dim', 'fix_date_lod_dim', 'booking_line_created_date_dim']","This metric is a highly specific subset of last FY gross revenue, filtered by multiple digital-related dimensions and a hardcoded date cutoff.",SUM(gross_revenue_amount) WHERE relative_fy_year_offset = -1 AND (digital_conditions AND date_condition),"Used for specific digital revenue analysis, but its complexity and hardcoded date make it prone to misinterpretation or staleness.","SELECT SUM(CASE WHEN relative_fy_year_offset = -1 AND (CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END <= DATE_ADD(DATE '2025-01-02', INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS conditional_digital_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = -1 LIMIT 100",strong,medium,11,1a5f7b4e-ea3a-46e4-8b77-b428f4178510,7,"gross_revenue_amount_base, revenue_type_dim, revenue_group_subtype_dim, sales_segment_l_2_name_sync_dim, advertiser_parent_dim, fix_date_lod_dim, booking_line_created_date_dim"
filter_impact,total_gross_revenue_amount,"['publication_name', 'financial_year', 'calendar_year', 'calendar_month_float', 'advertiser_name', 'advertiser_group', 'booking_number', 'revenue_type', 'source_unified_publication_name', 'revenue_transaction_status', 'source_publishing_division', 'revenue_group_subtype']","All identified dimensions and filters directly impact the aggregated 'Total Gross Revenue Amount' by defining the scope of transactions included in the sum. Specific filters from the original queries (e.g., specific advertiser names, calendar years) narrow down the revenue calculation significantly.",SUM(gross_revenue_amount) WHERE [filters] GROUP BY [dimensions],"Revenue figures are highly dependent on the selected time periods, transaction statuses, publishing divisions, revenue subtypes, and advertisers. Changes in these filters will directly alter the reported revenue.","SELECT SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE source_publishing_division != 'Medium Rare Content Agency' AND revenue_transaction_status IN ('Billed', 'Booked') AND calendar_year IN ('2024', '2025') AND advertiser_name IN ('Greyhound Racing Victoria') LIMIT 1;",strong,high,12,c560ed20-040d-4c6a-9c3f-ec8bce27d132,12,"publication_name, financial_year, calendar_year, calendar_month_float, advertiser_name, advertiser_group, booking_number, revenue_type, source_unified_publication_name, revenue_transaction_status, source_publishing_division, revenue_group_subtype"
dependency,budget_earned_amount_current_fy_week,"['earned_amount_current_fy_week', 'closing_base_current_fy_week', 'opening_base_current_fy_week']","All 'Current Fiscal Year & Week' metrics (Budget Earned Amount, Earned Amount, Closing Base, Opening Base) are calculated using the same underlying logic for determining the 'current' fiscal year and week. This means they are inherently linked by the date context.",N/A,Ensuring the 'current' fiscal period calculation is accurate and consistent is critical for the validity of all these financial metrics. Any change to the date logic affects all of them.,"SELECT 
  (EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-26', 'Australia/Sydney'))) - 1) AS day_of_week_q1,
  DATETIME_DIFF(SAFE_CAST(DATE('2025-03-26', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS weeks_diff_q1,
  (EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-25', 'Australia/Sydney'))) - 1) AS day_of_week_q2,
  DATETIME_DIFF(SAFE_CAST(DATE('2025-03-25', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS weeks_diff_q2
-- Verify that the derived 'current_fy_week_calculated' is consistent across queries if the intent is for them to show the same week.",strong,high,13,bb49fa78-5abe-4e68-a9c1-8172a832e724,3,"earned_amount_current_fy_week, closing_base_current_fy_week, opening_base_current_fy_week"
dependency,distinct_view_type_count,['view_type_dimension'],"The 'Distinct View Type Count' metric directly depends on the 'View Type' dimension. Since the 'View Type' dimension is hardcoded to a single value ('Week to Date & Budget View'), the distinct count will always be 1.",COUNT(DISTINCT view_type_dimension),"This interaction confirms that the distinct count is not a meaningful business metric for variability, but rather a technical artifact of the dashboard's design.",SELECT COUNT(DISTINCT (CASE WHEN (1 = 1) THEN 'Week to Date & Budget View' ELSE NULL END)) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` LIMIT 1;,strong,low,13,bb49fa78-5abe-4e68-a9c1-8172a832e724,1,view_type_dimension
hierarchical,total_revenue_by_product_type,['total_revenue_by_transaction_category'],"Both metrics represent different aggregations (slices) of the same underlying `RevenueNet` measure. The sum of `total_revenue_by_product_type` across all product types should equal the sum of `total_revenue_by_transaction_category` across all transaction categories, assuming the same underlying data and filters.",SUM(total_revenue_by_product_type) = SUM(total_revenue_by_transaction_category),Ensures consistency in total revenue reporting across different analytical views and provides confidence in the data's integrity.,"SELECT
  (SELECT SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`) AS total_revenue_from_source,
  (SELECT SUM(t0_qt_qrna4jodrd) FROM (SELECT clmn0_, SUM(clmn1_) AS t0_qt_qrna4jodrd FROM (SELECT t0.ProductType AS clmn0_, t0.RevenueNet AS clmn1_ FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0) GROUP BY clmn0_)) AS total_revenue_from_product_type_agg,
  (SELECT SUM(t0_qt_ac6k8jodrd) FROM (SELECT clmn13_ AS t0_qt_0v7k8jodrd, SUM(clmn0_) AS t0_qt_ac6k8jodrd FROM (SELECT CASE WHEN (clmn6_ OR clmn5_ OR clmn9_) THEN 'Guaranteed' WHEN (clmn3_ OR clmn4_ OR clmn7_ OR clmn12_) THEN 'Deal' WHEN (clmn10_ OR clmn8_ OR clmn11_) THEN 'Open Auction' ELSE clmn2_ END AS clmn13_, clmn0_ FROM (SELECT SAFE_CAST(clmn1_ AS STRING) AS clmn2_, (clmn1_ = 'Deal') AS clmn3_, (clmn1_ = 'pmp') AS clmn4_, (clmn1_ = 'PG - CPM') AS clmn5_, (clmn1_ = 'AG') AS clmn6_, (clmn1_ = 'PMP_DEAL') AS clmn7_, (clmn1_ = 'RTB') AS clmn8_, (clmn1_ = 'PG - CPD') AS clmn9_, (clmn1_ = 'Open Auction') AS clmn10_, (clmn1_ = 'Unknown') AS clmn11_, (clmn1_ = 'UFR') AS clmn12_, clmn0_ FROM (SELECT t0.RevenueNet AS clmn0_, t0.TransactionType AS clmn1_ FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0)))) GROUP BY t0_qt_0v7k8jodrd)) AS total_revenue_from_transaction_category_agg",strong,high,14,b15d856f-e3ce-4991-bf2a-92395390524f,1,total_revenue_by_transaction_category
filter_impact,product_group,"['advertiser_group', 'fin_adtype_name', 'financial_week']","The 'product_group' dimension is used as a filter for retrieving distinct values of 'advertiser_group', 'fin_adtype_name', and 'financial_week'. This implies that the selection of product groups directly influences the available options for these other dimensions in the dashboard's filters.",N/A (filter relationship),"Ensures that users can filter other dimensions based on specific product categories, providing contextual filtering capabilities. However, the hardcoded nature of these filters limits flexibility.","SELECT DISTINCT product_group FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Free News & Lifestyle', 'State & Communities', '');",strong,high,15,d3bcf796-2396-4a6f-b0a3-da0b7f299a58,3,"advertiser_group, fin_adtype_name, financial_week"
filter_impact,gross_revenue_amount_sum,"['financial_year_dimension', 'financial_week_dimension', 'source_system_code_dimension']","The 'Total Gross Revenue Amount' is heavily filtered and grouped by 'Financial Year', 'Financial Week', and 'Source System Code', along with specific transaction statuses, publishing divisions, and invoice numbers. Changes to these filters directly impact the calculated revenue.",SUM(gross_revenue_amount) WHERE [filters],"Ensures that revenue is reported only for specific, defined business criteria, allowing for focused analysis of ad sales performance.",See 'business_rules_sql' for validation of individual filter impacts.,strong,high,17,77c68c35-20ce-477a-b216-0c781d43a8ca,3,"financial_year_dimension, financial_week_dimension, source_system_code_dimension"
dependency,financial_week_int_sum,['financial_week_dimension'],The 'Sum of Financial Week (as INT64)' is a direct numerical transformation and aggregation of the 'Financial Week' dimension. It's likely used for internal sorting or calculation within the dashboard rather than a direct business interpretation.,SUM(SAFE_CAST(financial_week AS INT64)),"This metric's business validation is primarily in its utility for dashboard presentation (e.g., sorting) rather than a direct business insight.",SELECT SUM(SAFE_CAST(financial_week AS INT64)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE financial_year = '2025' LIMIT 1;,strong,low,17,77c68c35-20ce-477a-b216-0c781d43a8ca,1,financial_week_dimension
filter_impact,data_load_datetime_truncated,[],The 'Data Load Datetime (Truncated to Second)' is filtered by specific 'Unified Publication GL Codes'. This suggests that the data freshness or audit analysis is focused on particular GL segments.,"DATETIME_TRUNC(data_load_datetime, SECOND) WHERE unified_publication_gl_code IN (...)","Ensures that data load timestamps are analyzed for specific publication GL codes, which is important for data quality and operational monitoring for those segments.","SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE unified_publication_gl_code IN ('9707', '9655', '9658') LIMIT 1;",medium,medium,17,77c68c35-20ce-477a-b216-0c781d43a8ca,0,
filter_impact,record_count_finance_os,['os_level_5_dimension'],The 'Record Count (Finance Operating Statement)' is filtered by specific 'Fiscal Week IDs' and grouped by 'Operating Statement Level 5'. This indicates a focus on volume analysis within defined financial periods and organizational structures.,COUNT(1) WHERE fiscal_week_id IN (...) GROUP BY os_level_5,"Provides a count of financial records for specific fiscal weeks and operating levels, useful for data volume assessment and financial reporting integrity.","SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement` WHERE fiscal_week_id IN ('202548', '202549', '202550', '202551') LIMIT 1;",strong,medium,17,77c68c35-20ce-477a-b216-0c781d43a8ca,1,os_level_5_dimension
mathematical_relationship,volume_vs_budget_variance,"['total_actual_volume', 'total_budget_volume_past_weeks']",Volume vs. Budget Variance is calculated as Total Actual Volume minus Total Budget Volume (Past Weeks).,volume_vs_budget_variance = total_actual_volume - total_budget_volume_past_weeks,"This relationship is fundamental for assessing performance against budget. A positive variance indicates exceeding budget, while a negative variance indicates falling short.","SELECT SUM(volume) - SUM(CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END) AS calculated_variance, SUM(volume - (CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END)) AS direct_variance FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number WHERE upper(os.os_level_6) = 'CIRCULATION' AND os.gl_hierarchy_code = 'FY2025';",strong,high,18,6a26c78f-0070-4fb3-88b8-691ee4a4485a,2,"total_actual_volume, total_budget_volume_past_weeks"
dependency,total_calculated_daily_avg_volume,"['total_actual_volume', 'publication_group']","Total Calculated Daily Average Volume depends on Total Actual Volume and the Publication Group, which determines the divisor (6 or 7 days).",total_calculated_daily_avg_volume = SUM(volume / (CASE WHEN publication_group = '6 Day Pubs' THEN 6 ELSE 7 END)),This relationship normalizes volume data for daily comparison across different publication schedules. It's crucial for understanding daily run rates.,"SELECT SUM(volume) AS total_volume, SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(volume, 6) ELSE SAFE_DIVIDE(volume, 7) END) AS daily_avg_volume FROM transformed_data WHERE publication_group IS NOT NULL;",strong,medium,18,6a26c78f-0070-4fb3-88b8-691ee4a4485a,2,"total_actual_volume, publication_group"
dependency,total_calculated_daily_avg_volume_forecast_budget,"['total_budget_volume_q2', 'publication_group']","Total Calculated Daily Average Volume (Forecast/Budget) depends on Total Budget Volume and the Publication Group, which determines the divisor (6 or 7 days).",total_calculated_daily_avg_volume_forecast_budget = SUM(Budget_Volume / (CASE WHEN publication_group = '6 Day Pubs' THEN 6 ELSE 7 END)),"This relationship normalizes budget/forecast volume data for daily comparison across different publication schedules, allowing for daily target tracking.","SELECT SUM(Budget_Volume) AS total_budget_volume, SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(Budget_Volume, 6) ELSE SAFE_DIVIDE(Budget_Volume, 7) END) AS daily_avg_budget_volume FROM transformed_data WHERE publication_group IS NOT NULL;",strong,medium,18,6a26c78f-0070-4fb3-88b8-691ee4a4485a,2,"total_budget_volume_q2, publication_group"
filter_impact,total_actual_amount_all_sales_channels,"['total_actual_amount_q2', 'os_level_7']","Total Actual Amount (All Sales Channels) is a subset of Total Actual Amount, filtered specifically for records where os_level_7 is 'ALL SALES CHANNELS'.",total_actual_amount_all_sales_channels = SUM(Actual_Amount WHERE os_level_7 = 'ALL SALES CHANNELS'),"This highlights the revenue contribution from a specific, consolidated sales channel category, allowing for focused analysis.","SELECT SUM(Actual_Amount) AS total_actual, SUM(CASE WHEN os_level_7 = 'ALL SALES CHANNELS' THEN Actual_Amount ELSE 0 END) AS all_channels_actual FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE upper(os_level_6) = 'CIRCULATION' AND gl_hierarchy_code = 'FY2025';",strong,medium,18,6a26c78f-0070-4fb3-88b8-691ee4a4485a,2,"total_actual_amount_q2, os_level_7"
filter_impact,total_ytd_actual_amount,"['total_actual_amount_q2', 'fy_week_of_year', 'fy_year_week_number']",Total YTD Actual Amount is a cumulative sum of Actual Amount from the start of the fiscal year up to the current fiscal week.,total_ytd_actual_amount = SUM(Actual_Amount WHERE fy_week_of_year <= current_fiscal_week),"This metric provides a running total of actual revenue for the fiscal year, essential for tracking progress towards annual goals.","SELECT SUM(Actual_Amount) AS total_actual, SUM(CASE WHEN fy_week_of_year <= (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1) THEN Actual_Amount ELSE 0 END) AS ytd_actual FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number WHERE upper(os.os_level_6) = 'CIRCULATION' AND os.gl_hierarchy_code = 'FY2025';",strong,high,18,6a26c78f-0070-4fb3-88b8-691ee4a4485a,3,"total_actual_amount_q2, fy_week_of_year, fy_year_week_number"
filter_impact,total_actual_amount_sum,['total_volume_sum'],"Both Total Actual Amount and Total Volume are filtered by the same complex fiscal week logic and publication/sales channel exclusions, ensuring consistent reporting for the selected period and scope.",N/A,"Ensures that revenue and volume metrics are always reported for the same underlying data subset, preventing discrepancies.",SELECT COUNT(*) FROM (SELECT SUM(clmn0_) FROM (...) WHERE (clmn12_ = true AND clmn4_ != 'Weekly Times' AND clmn4_ != 'Sunshine Coast' AND clmn4_ != 'Mackay' AND clmn3_ = 'All Sales Channels')) AS q1 JOIN (SELECT SUM(clmn5_) FROM (...) WHERE (clmn12_ = true AND clmn4_ != 'Weekly Times' AND clmn4_ != 'Sunshine Coast' AND clmn4_ != 'Mackay' AND clmn3_ = 'All Sales Channels')) AS q2 ON 1=1 WHERE q1.sum_clmn0_ IS NOT NULL AND q2.sum_clmn5_ IS NOT NULL;,strong,high,19,2104a3f5-9424-4087-a928-e67fecae789a,1,total_volume_sum
mathematical_relationship,adjusted_actual_volume,"['volume', 'publication_type', 'day_of_week', 'fy_month_of_year']","Adjusted Actual Volume is derived from raw volume, normalized by publication type (6-day vs 7-day) and further adjusted based on day of week and fiscal month, reflecting an 'average daily/weekly volume'.","Adjusted_Volume = (Volume / (Fiscal_Month_Number * X)) / Y, where X and Y vary based on publication type and day of week.","This calculation aims to provide a comparable volume metric across different publication types and reporting periods, essential for fair performance evaluation.","SELECT publication_name, fy_year_week_number, volume, adjusted_actual_volume FROM primary_analysis_sql WHERE volume > 0 LIMIT 100;",strong,high,19,2104a3f5-9424-4087-a928-e67fecae789a,4,"volume, publication_type, day_of_week, fy_month_of_year"
mathematical_relationship,adjusted_target_forecast_py_volume,"['volume', 'budget_volume', 'forecast_volume', 'last_year_volume', 'publication_type', 'day_of_week', 'fy_month_of_year', 'fy_year_week_number']","Adjusted Target/Forecast/PY Volume dynamically selects a base volume (Actual, Budget, Forecast, or Last Year) based on fiscal week/month, then applies the same normalization and adjustment logic as Adjusted Actual Volume.","Adjusted_Target_Volume = (Selected_Base_Volume / (Fiscal_Month_Number * X)) / Y, where Selected_Base_Volume is chosen conditionally.","This metric provides a dynamic benchmark for comparison against Adjusted Actual Volume, allowing for 'actual vs. target' or 'actual vs. forecast' analysis within a single metric depending on the reporting period.","SELECT publication_name, fy_year_week_number, volume, forecast_volume, adjusted_target_forecast_py_volume FROM primary_analysis_sql WHERE volume > 0 LIMIT 100;",strong,high,19,2104a3f5-9424-4087-a928-e67fecae789a,8,"volume, budget_volume, forecast_volume, last_year_volume, publication_type, day_of_week, fy_month_of_year, fy_year_week_number"
hierarchical,publication_name,"['publication_category_level_1', 'publication_type']","Individual publication names roll up into broader publication categories and types, enabling aggregated reporting and specific calculation logic.",N/A,"Provides flexibility in reporting granularity and applies specific business rules (e.g., 6-day vs 7-day pubs) at the appropriate level.","SELECT DISTINCT publication_name, publication_category_level_1, publication_type FROM primary_analysis_sql LIMIT 100;",strong,medium,19,2104a3f5-9424-4087-a928-e67fecae789a,2,"publication_category_level_1, publication_type"
dependency,customer_status_full,"['fix_ly_lgr', 'fix_ty_lgr']","Customer retention status is determined by comparing current and previous fiscal year gross revenue for an advertiser group. The logic uses hardcoded thresholds (<=1, >1) for `fix_ly_lgr` and `fix_ty_lgr`.","Based on thresholds (<=1, >1) for fix_ly_lgr and fix_ty_lgr.","Ensures accurate categorization of customer lifecycle stages (New, Retained, Inactive, Lapsed).","SELECT customer_status_full, fix_ly_lgr, fix_ty_lgr, COUNT(*) FROM CTE GROUP BY 1,2,3 LIMIT 100",strong,high,20,155c4518-72bf-4309-a0e9-240dd564f421,2,"fix_ly_lgr, fix_ty_lgr"
mathematical_relationship,gross_revenue_amount_000s,['gross_revenue_amount'],Gross Revenue Amount ('000s) is derived by dividing Gross Revenue Amount by 1000 for display purposes.,gross_revenue_amount_000s = gross_revenue_amount / 1000,Ensures consistent scaling of revenue figures for reporting.,"SELECT gross_revenue_amount, gross_revenue_amount_000s, gross_revenue_amount / 1000 AS calculated_000s FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance` WHERE gross_revenue_amount IS NOT NULL LIMIT 100",strong,medium,20,155c4518-72bf-4309-a0e9-240dd564f421,1,gross_revenue_amount
filter_impact,blank_portfolio_flag,"['gross_revenue_amount_000s', 'target_amount_000s', 'relative_fy_year_offset', 'portfolio_conformed_name_sync']",The 'blank_portfolio_flag' determines whether a portfolio is included ('include') or excluded ('exclude') from analysis based on its aggregated revenue and target values. It filters out portfolios with negligible activity.,IF (SUM(revenue_000s) OVER (PARTITION BY portfolio) > 0.01 OR SUM(revenue_000s) OVER (PARTITION BY portfolio) < -0.01 OR SUM(target_current_fy) OVER (PARTITION BY portfolio) != 0) THEN 'include' ELSE 'exclude',"Ensures that only portfolios with meaningful activity are considered in reports, reducing noise and focusing analysis on relevant data.","SELECT blank_portfolio_flag, SUM(gross_revenue_amount / 1000) as total_rev_000s, SUM(IF(relative_fy_year_offset = 0, target, null)) as total_target_current_fy FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance` GROUP BY blank_portfolio_flag LIMIT 100",strong,high,20,155c4518-72bf-4309-a0e9-240dd564f421,4,"gross_revenue_amount_000s, target_amount_000s, relative_fy_year_offset, portfolio_conformed_name_sync"
filter_impact,programmatic_gross_revenue,"['financial_year_dimension', 'financial_short_month_dimension', 'cost_model_type_dimension', 'data_load_datetime_dimension']","The 'Programmatic Gross Revenue' metric is heavily influenced by a specific set of filters applied to various dimensions, including financial year, transaction status, revenue type, revenue group subtype, advertiser, and source system. Changes to these filters directly impact the calculated revenue.","SUM(gross_revenue_amount) WHERE (financial_year = '2025' AND source_publishing_division != 'Medium Rare Content Agency' AND revenue_transaction_status IN ('Billed', 'Booked') AND revenue_type_level2 = 'Programmatic' AND revenue_group_subtype IN ('Programmatic Source', 'Digital') AND advertiser_name = 'Foxtel Management Pty Ltd' AND source_system_code = 'PLUTO')",Ensuring these filters are correctly applied is critical for accurate programmatic revenue reporting. Any deviation from these business rules would misrepresent programmatic performance.,"SELECT 
  SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital') AND t0.advertiser_name = 'Foxtel Management Pty Ltd' AND t0.source_system_code = 'PLUTO' THEN t0.gross_revenue_amount ELSE 0 END) AS programmatic_revenue_filtered,
  SUM(t0.gross_revenue_amount) AS total_revenue_unfiltered
FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0
WHERE t0.financial_year = '2025' AND t0.source_publishing_division != 'Medium Rare Content Agency' AND t0.revenue_transaction_status IN ('Billed', 'Booked');",strong,high,22,705edcb5-737a-4600-b1a7-11870177f97a,4,"financial_year_dimension, financial_short_month_dimension, cost_model_type_dimension, data_load_datetime_dimension"
dependency,calculated_revenue_type,['derived_revenue_type_intermediate'],The 'Calculated Revenue Type' is directly derived from the 'Derived Revenue Type (Intermediate)' based on a series of CASE WHEN conditions.,calculated_revenue_type = CASE WHEN derived_revenue_type_intermediate = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ... END,Ensures that the final revenue categorization correctly reflects the intermediate derived type.,SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (CASE WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ELSE NULL END) IS NOT NULL;,strong,high,23,61f1feb4-fc3e-4bee-b987-84c86cfe6425,1,derived_revenue_type_intermediate
dependency,derived_revenue_type_intermediate,"['revenue_type', 'xtend_flag']","The 'Derived Revenue Type (Intermediate)' is determined by the 'XTEND Flag'; if 'Y', it's 'XTEND', otherwise it's the original 'Revenue Type'.",derived_revenue_type_intermediate = CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END,Confirms that the XTEND logic is correctly applied before further categorization.,SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (xtend_flag = 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND') OR (xtend_flag != 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = revenue_type);,strong,high,23,61f1feb4-fc3e-4bee-b987-84c86cfe6425,2,"revenue_type, xtend_flag"
filter_impact,unified_publication_name,"['financial_year', 'revenue_group_subtype']",The list of 'Unified Publication Names' displayed is filtered by specific 'Financial Years' and 'Revenue Group Subtypes'.,N/A,Ensures that publication lists are relevant to the selected financial period and revenue categories.,"SELECT COUNT(DISTINCT unified_publication_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025') AND revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE');",strong,medium,23,61f1feb4-fc3e-4bee-b987-84c86cfe6425,2,"financial_year, revenue_group_subtype"
filter_impact,revenue_group_subtype_output,"['financial_year', 'calculated_revenue_type']",The list of 'Revenue Group Subtypes' displayed is filtered by specific 'Financial Years' and the 'Calculated Revenue Type' (specifically 'digital').,N/A,Ensures that revenue subtype lists are relevant to the selected financial period and digital revenue categories.,"SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025') AND (CASE WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) IN ('digital');",strong,medium,23,61f1feb4-fc3e-4bee-b987-84c86cfe6425,2,"financial_year, calculated_revenue_type"
dependency,min_load_timestamp,"['truncated_load_timestamp', 'dw_asl_load_timestamp']","The 'Minimum Load Timestamp' is an aggregation (MIN) of the 'Truncated Load Timestamp', which itself is derived from the raw 'Data Warehouse Load Timestamp'.","min_load_timestamp = MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND))",Confirms that the data freshness metric accurately reflects the earliest load time.,"SELECT MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`;",strong,low,23,61f1feb4-fc3e-4bee-b987-84c86cfe6425,2,"truncated_load_timestamp, dw_asl_load_timestamp"
mathematical_relationship,current_fy_gross_revenue_k_aud,['current_fy_gross_revenue_raw'],Current FY Gross Revenue (k AUD) is derived by dividing Current FY Gross Revenue (Raw) by 1000.,current_fy_gross_revenue_k_aud = current_fy_gross_revenue_raw / 1000,Ensures revenue is presented in a readable 'thousands' format for financial reporting.,SELECT SUM(current_fy_gross_revenue_k_aud * 1000) = SUM(current_fy_gross_revenue_raw) FROM your_table_or_cte;,strong,high,25,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,current_fy_gross_revenue_raw
mathematical_relationship,previous_fy_gross_revenue_k_aud,['previous_fy_gross_revenue_raw'],Previous FY Gross Revenue (k AUD) is derived by dividing Previous FY Gross Revenue (Raw) by 1000.,previous_fy_gross_revenue_k_aud = previous_fy_gross_revenue_raw / 1000,Ensures previous FY revenue is presented in a readable 'thousands' format for financial reporting and year-over-year comparison.,SELECT SUM(previous_fy_gross_revenue_k_aud * 1000) = SUM(previous_fy_gross_revenue_raw) FROM your_table_or_cte;,strong,high,25,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,previous_fy_gross_revenue_raw
dependency,publication_category,['unified_publication_name'],"Publication Category is a classification of unified_publication_name, grouping specific publications into 'Sundry Pubs' or 'Non Sundry Pubs'.",,"Provides a higher-level grouping for analysis, enabling aggregated views of revenue and other metrics across publication types.","SELECT unified_publication_name, publication_category FROM your_table_or_cte GROUP BY 1,2 LIMIT 100;",strong,medium,25,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,unified_publication_name
filter_impact,current_fy_gross_revenue_k_aud,['product_group'],Current FY Gross Revenue (k AUD) is specifically filtered for 'The Australian & Prestige' product group.,,"Ensures the metric reflects performance for a specific, high-priority product group.","SELECT product_group, SUM(current_fy_gross_revenue_k_aud) FROM your_table_or_cte GROUP BY 1 HAVING product_group != 'The Australian & Prestige';",strong,high,25,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,product_group
filter_impact,previous_fy_gross_revenue_k_aud,['product_group'],Previous FY Gross Revenue (k AUD) is specifically filtered for 'The Australian & Prestige' product group.,,"Ensures the metric reflects performance for a specific, high-priority product group, allowing for consistent year-over-year comparison.","SELECT product_group, SUM(previous_fy_gross_revenue_k_aud) FROM your_table_or_cte GROUP BY 1 HAVING product_group != 'The Australian & Prestige';",strong,high,25,4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3,1,product_group
filter_impact,paid_impressions,"['transaction_type', 'advertiser', 'month_start_date']","Paid Impressions are filtered by specific Transaction Type, Advertiser, and Month Start Date.",,Ensures that the impressions reported are specific to 'Guaranteed' transactions for 'Chemist Warehouse *' in June 2025.,"SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01';",strong,high,26,87651b69-c43e-471f-9c4b-98df1208a844,3,"transaction_type, advertiser, month_start_date"
filter_impact,gross_revenue,"['transaction_type', 'advertiser', 'month_start_date']","Gross Revenue is filtered by specific Transaction Type, Advertiser, and Month Start Date.",,Ensures that the revenue reported is specific to 'Guaranteed' transactions for 'Chemist Warehouse *' in June 2025.,"SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01';",strong,high,26,87651b69-c43e-471f-9c4b-98df1208a844,3,"transaction_type, advertiser, month_start_date"
mathematical_relationship,gross_revenue,['paid_impressions'],Gross Revenue and Paid Impressions are key performance indicators often analyzed together to derive metrics like Revenue Per Impression (RPM) or Cost Per Mille (CPM).,Revenue Per Impression = total_gross_revenue / total_paid_impressions,These metrics are fundamental for evaluating the efficiency and profitability of programmatic campaigns.,"SELECT SUM(RevenueGross) / SUM(PaidImpressions) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH);",strong,high,26,87651b69-c43e-471f-9c4b-98df1208a844,1,paid_impressions
dependency,spend_current_period,"['spend_base', 'is_current_period_flag']","Spend (Current Period) is a conditional sum of Base Spend, filtered by the Is Current Period Flag.",SUM(Spend) WHERE Is_Current_Period_Flag = TRUE,Ensures that only spend within the designated current timeframe is included for analysis.,SELECT SUM(Spend) FROM adex_full_date WHERE date >= '2023-08-01' AND date <= '2024-06-01',strong,high,27,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_base, is_current_period_flag"
dependency,spend_previous_year_period,"['spend_base', 'is_previous_year_period_flag']","Spend (Previous Year Period) is a conditional sum of Base Spend, filtered by the Is Previous Year Period Flag.",SUM(Spend) WHERE Is_Previous_Year_Period_Flag = TRUE,Ensures that only spend within the designated previous year timeframe is included for year-over-year comparison.,SELECT SUM(Spend) FROM adex_full_date WHERE date >= '2022-08-01' AND date <= '2023-06-01',strong,high,27,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_base, is_previous_year_period_flag"
mathematical_relationship,spend_current_period,['spend_previous_year_period'],These two metrics are used for year-over-year growth calculations.,(spend_current_period - spend_previous_year_period) / spend_previous_year_period,Provides insight into the growth or decline of advertising spend compared to the prior year.,SELECT (SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) - SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN Spend ELSE 0 END)) / SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN Spend ELSE 0 END) AS YOY_Growth FROM adex_full_date,strong,high,27,e9d8a216-4950-4d30-b344-5011776edbdf,1,spend_previous_year_period
filter_impact,news_corp_spend_current_period,"['spend_current_period', 'media_network']","News Corp Spend (Current Period) is a subset of Spend (Current Period), filtered specifically for 'NEWS CORP' media network.",SUM(Spend) WHERE Is_Current_Period_Flag = TRUE AND Media_Network = 'NEWS CORP',Allows for granular analysis of spend attributed to a specific media network within the current period.,"SELECT SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END) AS NewsCorp_Spend, SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) AS Total_Spend FROM adex_full_date",strong,medium,27,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_current_period, media_network"
filter_impact,retail_spend_current_period,"['spend_current_period', 'major_category']","Retail Spend (Current Period) is a subset of Spend (Current Period), filtered specifically for 'Retail' major category.",SUM(Spend) WHERE Is_Current_Period_Flag = TRUE AND Major_Category = 'Retail',Allows for granular analysis of spend attributed to a specific major category within the current period.,"SELECT SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Major_Category = 'Retail' THEN Spend ELSE 0 END) AS Retail_Spend, SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) AS Total_Spend FROM adex_full_date",strong,medium,27,e9d8a216-4950-4d30-b344-5011776edbdf,2,"spend_current_period, major_category"
mathematical_relationship,actual_amount,"['budget_amount', 'forecast_amount']",Actual Amount is compared against Budget Amount and Forecast Amount to determine variance and performance.,Variance to Budget = Actual_Amount - Budget_Amount; Variance to Forecast = Actual_Amount - Forecast_Amount,"These comparisons are fundamental for financial performance analysis, identifying deviations from plans and projections.","SELECT
  SUM(Actual_Amount) AS total_actual,
  SUM(Budget_Amount) AS total_budget,
  SUM(Forecast_Amount) AS total_forecast,
  SUM(Actual_Amount) - SUM(Budget_Amount) AS variance_to_budget,
  SUM(Actual_Amount) - SUM(Forecast_Amount) AS variance_to_forecast
FROM (
  SELECT
    os.Actual_Amount,
    os.Budget_Amount,
    os.Forecast_Amount
  FROM
    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os
    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar
      ON os.fiscal_week_id = calendar.fy_year_week_number
    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control
      ON control.source_week_number = calendar.fy_year_week_number AND control.period_name IN ('CP', 'PY')
  WHERE
    os.gl_hierarchy_code = 'FY2025' AND calendar.fy_week_of_year = 40
) AS sub;",strong,high,28,b1c5901f-a535-42eb-870d-05cc025f7c27,2,"budget_amount, forecast_amount"
filter_impact,actual_amount,"['budget_amount', 'forecast_amount', 'fy_week_of_year', 'gl_hierarchy_code', 'os_level_4', 'l03_publication_code', 'os_level_9']","All financial metrics (Actual, Budget, Forecast) are directly impacted by the filters applied to fiscal year, fiscal week, OS levels, and publication codes. The hardcoded nature of these filters means the dashboard only shows a very specific slice of data.",N/A,"Understanding the impact of these filters is critical for interpreting the dashboard's scope. Any analysis outside 'FY2025', 'Week 40', or the specified OS levels/publications will not be reflected.","SELECT
  'Filter Impact Analysis' AS analysis_type,
  COUNT(*) AS total_records_before_filters,
  SUM(CASE WHEN gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) AS records_fy2025,
  SUM(CASE WHEN fy_week_of_year = 40 THEN 1 ELSE 0 END) AS records_week40,
  SUM(CASE WHEN os_level_4 IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) AS records_os_level_4_filtered,
  SUM(CASE WHEN l03_publication_code = 'News Media Publishing' THEN 1 ELSE 0 END) AS records_l03_filtered,
  SUM(CASE WHEN os_level_9 IN ('Circulation', 'Subscription', 'Content Licensing') THEN 1 ELSE 0 END) AS records_os_level_9_filtered
FROM (
  SELECT
    os.gl_hierarchy_code,
    calendar.fy_week_of_year,
    os.os_level_4,
    pub.l03_publication_code,
    os.os_level_9
  FROM
    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os
    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub
      ON os.gl_publication_code = pub.publication_code
    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar
      ON os.fiscal_week_id = calendar.fy_year_week_number
) AS sub
LIMIT 1;",strong,high,28,b1c5901f-a535-42eb-870d-05cc025f7c27,7,"budget_amount, forecast_amount, fy_week_of_year, gl_hierarchy_code, os_level_4, l03_publication_code, os_level_9"
dependency,advertiser_name_categorized,['adpoint_account_number_categorized'],"The categorization of 'Advertiser Name' depends on the categorization of 'Adpoint Account Number'. If 'Adpoint Account Number' is categorized as 'ctr1', then 'Advertiser Name' is assigned a specific long string.",IF adpoint_account_number_categorized = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE original_advertiser_name,Ensures consistent grouping and naming for specific contra accounts across reports.,"SELECT adpoint_account_number_categorized, advertiser_name_categorized, COUNT(*) FROM (SELECT CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1' ELSE adpoint_account_number END AS adpoint_account_number_categorized, CASE WHEN (CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1' ELSE adpoint_account_number END) = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END AS advertiser_name_categorized FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE adpoint_account_number IN ('13019', '52246', '18387')) GROUP BY 1, 2;",strong,high,29,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,1,adpoint_account_number_categorized
filter_impact,gross_revenue_amount,"['advertiser_name', 'cost_model_type', 'revenue_group_name', 'revenue_transaction_status', 'style_name', 'source_publishing_division', 'publication_name', 'account_number', 'adtype_name']","Gross Revenue Amount is heavily filtered by multiple conditions on various dimensions, ensuring only specific 'contra-related' and valid revenue transactions are included.",SUM(gross_revenue_amount) WHERE [multiple conditions],"These filters define the specific scope of 'Contra' revenue being reported, excluding certain types of revenue or publications.","SELECT COUNT(*) AS total_records, SUM(CASE WHEN lower(left(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END) AS ctr_records, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS billed_booked_records FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE financial_year = EXTRACT(YEAR FROM CURRENT_DATE());",strong,high,29,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,9,"advertiser_name, cost_model_type, revenue_group_name, revenue_transaction_status, style_name, source_publishing_division, publication_name, account_number, adtype_name"
filter_impact,record_count,['advertiser_name'],"Record Count is specifically filtered to include only certain 'CTR' named advertisers, indicating a focus on specific contra accounts.","COUNT(1) WHERE advertiser_name IN ('CTR_2023_AFL SPORT', ...)","This filter ensures the count reflects only the specified contra advertisers, which are likely key accounts for the report.","SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia');",strong,medium,29,b9dfd2f4-92fa-4f81-a5b1-17de880470f9,1,advertiser_name
filter_impact,total_acquisitions_movements,"['fy_year', 'table_nm', 'publication_type', 'publication_group', 'subscription_type', 'source_channel', 'business_type']","The 'Total Acquisitions/Movements' metric is directly filtered by specific values of several dimensions, narrowing down the scope of the count.",COUNT(1) WHERE [dimension_filter_conditions],"Ensures that the acquisition count is specific to Digital Subscriptions for The Australian and Prestige mastheads, from identified B2C sources, for FY2025.","SELECT COUNT(1) FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` WHERE fy_year = 2025 AND table_nm != 'op' AND (CASE WHEN (masthead = 'TA') THEN 'The Australian' WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro' WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals' WHEN (masthead = 'WT') THEN 'Other Publications' WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications' WHEN (masthead IS NULL) THEN 'check' ELSE 'Exclude' END) != 'Exclude' AND (CASE WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community' WHEN (masthead = 'TA') THEN 'The Australian and Prestige' WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content' WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle' ELSE 'Exclude' END) = 'The Australian and Prestige' AND (CASE WHEN (CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END) = 'Digital Subscriptions' AND (CASE WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_AB') > 0) THEN 'Above the Fold' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_BB') > 0) THEN 'Blackbook' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CF') > 0) THEN 'Community Form' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CS') > 0) THEN 'Closing Speed' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FA') > 0) THEN 'Free Articles' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FF') > 0) THEN 'Form Finder' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_NA') > 0) THEN 'News Articles' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PC') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PE') > 0) THEN 'Punters Edge' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SL') > 0) THEN 'Shortlist' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SS') > 0) THEN 'Setting Speed' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TE') > 0) THEN 'Tippers Edge' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TH') > 0) THEN 'Todays Headlines' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TO') > 0) THEN 'The Oz' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_WS') > 0) THEN 'Why Subscribe' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 4), 'PRED') > 0) THEN 'Predictor' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'AMP') > 0) THEN 'Google AMP' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FBK') > 0) THEN 'Facebook' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FMB') > 0) THEN 'Facebook Messenger Bot' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGL') > 0) THEN 'Google' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGN') > 0) THEN 'Google News' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'LIN') > 0) THEN 'Linked In' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NEW') > 0) THEN 'news.com.au' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NWL') > 0) THEN 'Newsletter' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POD') > 0) THEN 'Podcasts' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POR') > 0) THEN 'Newsletter Sports' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'RED') > 0) THEN 'Reddit' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SCP') > 0) THEN 'Supercoach Plus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SEC') > 0) THEN 'Sectionals' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TCA') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TMP') > 0) THEN 'Tips Mrket Place' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWA') > 0) THEN 'The Weekend Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWT') > 0) THEN 'Twitter' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'WID') > 0) THEN 'Widget' WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook' WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google' WHEN (STRPOS(sold_in_source_code, 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In' WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit' WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter' ELSE NULL END) IS NOT NULL AND (CASE WHEN (classification_level_2 IN ('Consumer', 'Gift Receiver')) THEN 'B2C' WHEN (classification_level_2 IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B' ELSE 'Others' END) IN ('B2C', '') LIMIT 100;",strong,high,30,4d22b4c2-4bb3-49db-a0c1-4d46d4fba101,7,"fy_year, table_nm, publication_type, publication_group, subscription_type, source_channel, business_type"
filter_impact,current_fy_tubi_performance_programmatic_revenue_total,"['pmp_current_fy_revenue_total', 'non_guaranteed_current_fy_revenue_total', 'guaranteed_current_fy_revenue_total']","The 'current_fy_tubi_performance_programmatic_revenue_total' represents the total revenue for specific categories in the current FY. The PMP, Non-Guaranteed, and Guaranteed current FY revenue totals are subsets of this total, filtered by their respective 'cost_model_type'.",current_fy_tubi_performance_programmatic_revenue_total = SUM(pmp_current_fy_revenue_total + non_guaranteed_current_fy_revenue_total + guaranteed_current_fy_revenue_total + other_cost_model_types_revenue),Ensures that the sum of revenue by cost model type for the specified categories equals the overall total for those categories.,"SELECT SUM(pmp_current_fy_revenue_total) + SUM(non_guaranteed_current_fy_revenue_total) + SUM(guaranteed_current_fy_revenue_total) AS sum_of_cost_model_types, SUM(current_fy_tubi_performance_programmatic_revenue_total) AS overall_total FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;",strong,high,31,5491badf-5ec0-4b4f-a427-b12a3a3395dd,3,"pmp_current_fy_revenue_total, non_guaranteed_current_fy_revenue_total, guaranteed_current_fy_revenue_total"
filter_impact,current_fy_tubi_performance_programmatic_revenue_total,['current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total'],"The 'past dashboard date' metrics are a subset of their 'current FY' counterparts, specifically filtered to include only data reported before the hardcoded dashboard snapshot date (18/06/2025).",current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total <= current_fy_tubi_performance_programmatic_revenue_total,Verifies that the 'past dashboard date' metrics accurately reflect a historical snapshot of the 'current FY' metrics.,"SELECT SUM(current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total) AS past_dashboard_total, SUM(current_fy_tubi_performance_programmatic_revenue_total) AS current_fy_total FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;",strong,high,31,5491badf-5ec0-4b4f-a427-b12a3a3395dd,1,current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total
filter_impact,tubi_current_fy_revenue_total,['tubi_current_fy_past_dashboard_date_revenue_total'],"The 'tubi_current_fy_past_dashboard_date_revenue_total' is a subset of 'tubi_current_fy_revenue_total', filtered by the reporting date being before the dashboard snapshot date.",tubi_current_fy_past_dashboard_date_revenue_total <= tubi_current_fy_revenue_total,Confirms the correct application of the historical date filter for Tubi revenue.,"SELECT SUM(tubi_current_fy_past_dashboard_date_revenue_total) AS tubi_past_dashboard, SUM(tubi_current_fy_revenue_total) AS tubi_current_fy FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;",strong,medium,31,5491badf-5ec0-4b4f-a427-b12a3a3395dd,1,tubi_current_fy_past_dashboard_date_revenue_total
filter_impact,performance_current_fy_revenue_total,['performance_current_fy_past_dashboard_date_revenue_total'],"The 'performance_current_fy_past_dashboard_date_revenue_total' is a subset of 'performance_current_fy_revenue_total', filtered by the reporting date being before the dashboard snapshot date.",performance_current_fy_past_dashboard_date_revenue_total <= performance_current_fy_revenue_total,Confirms the correct application of the historical date filter for Performance revenue.,"SELECT SUM(performance_current_fy_past_dashboard_date_revenue_total) AS perf_past_dashboard, SUM(performance_current_fy_revenue_total) AS perf_current_fy FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;",strong,medium,31,5491badf-5ec0-4b4f-a427-b12a3a3395dd,1,performance_current_fy_past_dashboard_date_revenue_total
dependency,current_fy_gross_revenue,"['gross_revenue_amount', 'relative_fy_year_offset']","Current FY Gross Revenue is a conditional sum of Gross Revenue Amount, filtered by relative_fy_year_offset = 0.","SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))",Ensures that only revenue from the current fiscal year contributes to this metric.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 100",strong,high,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,2,"gross_revenue_amount, relative_fy_year_offset"
dependency,current_fy_pipeline,"['pipeline_amount', 'relative_fy_year_offset']","Current FY Pipeline is a conditional sum of Pipeline Amount, filtered by relative_fy_year_offset = 0.","SUM(IF(relative_fy_year_offset = 0, pipeline, 0))",Ensures that only pipeline from the current fiscal year contributes to this metric.,"SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS current_fy_pipeline_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 100",strong,high,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,2,"pipeline_amount, relative_fy_year_offset"
dependency,is_digital_other_sales_segment_flag,['sales_segment_l_2_name_sync'],Flag is true if sales_segment_l_2_name_sync is 'Digital Other'.,MAX(sales_segment_l_2_name_sync = 'Digital Other'),Identifies records belonging to the 'Digital Other' sales segment for specific analysis.,SELECT MAX(sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE sales_segment_l_2_name_sync = 'Digital Other' LIMIT 1,strong,medium,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,1,sales_segment_l_2_name_sync
dependency,revenue_type_or_xtend,"['xtend_flag', 'revenue_type']",Derives a unified revenue type based on xtend_flag.,CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END,"Provides a consolidated view of revenue types, highlighting XTEND revenue.",SELECT DISTINCT CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END AS revenue_type_or_xtend_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` LIMIT 100,strong,medium,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,2,"xtend_flag, revenue_type"
dependency,gsd_name,"['current_portfolio_group_owner_sync', 'v_user_dim']","GSD name is looked up from a user dimension table based on the portfolio owner, defaulting to 'VACANT'.","IFNULL(GSD_JOIN.full_name, 'VACANT')","Ensures GSD names are always present for reporting, even if the lookup fails.","WITH SFCE_USER AS (SELECT UPPER(network_user_name) AS login_name, UPPER(user_name) AS full_name FROM `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim WHERE dw_source_system_code = 'SFCE' QUALIFY ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) = 1) SELECT T1.current_portfolio_group_owner_sync, IFNULL(T2.full_name, 'VACANT') AS gsd_name_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` AS T1 LEFT JOIN SFCE_USER AS T2 ON UPPER(T1.current_portfolio_group_owner_sync) = T2.login_name LIMIT 100",strong,medium,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,2,"current_portfolio_group_owner_sync, v_user_dim"
filter_impact,gross_revenue_amount,"['pipeline_amount', 'current_fy_gross_revenue', 'current_fy_pipeline']","All revenue and pipeline metrics are filtered by specific fiscal years, transaction statuses, style names, publishing divisions, and publication names.",N/A,"Ensures that only relevant and valid revenue data is included in the analysis, excluding certain types of transactions or publications.","SELECT COUNT(*) AS total_records, SUM(CASE WHEN relative_fy_year_offset IN (-1, 0, 1) THEN 1 ELSE 0 END) AS records_in_fy_range, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_billed_booked FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` LIMIT 1",strong,high,32,8956e94b-f6d1-46a3-9c7f-87a91fbe98b5,3,"pipeline_amount, current_fy_gross_revenue, current_fy_pipeline"
dependency,total_product_revenue_exclude_lod,"['margin_level_dimension', 'selected_category_dimension']",Total Product Revenue (Exclude LOD) is aggregated by Margin Level and a dynamically selected category/product dimension.,"SUM(Product_Revenue) GROUP BY Margin_Level, Selected_Category_Dimension",This relationship allows analysis of revenue performance across different margin tiers and product groupings.,"SELECT Margin_Level, selected_category_dimension, SUM(total_product_revenue_exclude_lod) FROM primary_analysis_sql GROUP BY 1,2",strong,high,33,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,2,"margin_level_dimension, selected_category_dimension"
dependency,total_merged_product_revenue_exclude_lod,"['margin_level_dimension', 'selected_category_dimension']",Total Merged Product Revenue (Exclude LOD) is aggregated by Margin Level and a dynamically selected category/product dimension.,"SUM(Product_Revenue_Merged_OneRow) GROUP BY Margin_Level, Selected_Category_Dimension","Similar to standard revenue, but for a 'merged' revenue stream, allowing comparison and specific analysis of consolidated revenue figures.","SELECT Margin_Level, selected_category_dimension, SUM(total_merged_product_revenue_exclude_lod) FROM primary_analysis_sql GROUP BY 1,2",strong,medium,33,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,2,"margin_level_dimension, selected_category_dimension"
filter_impact,total_pacman_product_revenue,['fiscal_year_dimension'],"Total PACMAN Product Revenue is strictly filtered to Fiscal Year 2025, limiting its scope to a specific period.",SUM(Product_Revenue) WHERE Fiscal_Year = 2025,"This filter ensures that the PACMAN revenue metric is always reported for the specified fiscal year, which is critical for period-specific financial tracking.",SELECT SUM(total_pacman_product_revenue) FROM primary_analysis_sql WHERE fiscal_year = 2025,strong,high,33,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,1,fiscal_year_dimension
dependency,total_fiscal_year_volume_pacman,"['product_l3_dimension', 'fiscal_year_dimension']",Total Fiscal Year Volume (PACMAN) is aggregated by Product Level 3 and Fiscal Year. The calculation itself (SUM of Fiscal_Year) is unusual and may indicate a misinterpretation or proxy for record count.,"SUM(Fiscal_Year) GROUP BY Product_L3, Fiscal_Year","If interpreted as a proxy for record count, this relationship helps understand the volume of data points or transactions associated with each product level 3 within a given fiscal year.","SELECT product_l3, fiscal_year, SUM(total_fiscal_year_volume_pacman) FROM primary_analysis_sql GROUP BY 1,2",medium,low,33,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,2,"product_l3_dimension, fiscal_year_dimension"
hierarchical,product_l3_dimension,"['product_l1_dimension', 'product_l2_dimension', 'product_l4_dimension', 'product_name_dimension', 'selected_category_dimension']","Product_L3 is part of a broader product hierarchy (L1, L2, L3, L4, Product_Name, Category). The 'selected_category_dimension' can dynamically represent any of these levels.",N/A (hierarchical relationship),Understanding the product hierarchy is crucial for granular analysis and roll-up reporting of financial metrics.,"SELECT DISTINCT Product_L1, Product_L2, Product_L3, Product_L4, Product_Name FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` LIMIT 100",strong,high,33,6de90f2a-b3f3-46fe-a4fe-13474b2d6618,5,"product_l1_dimension, product_l2_dimension, product_l4_dimension, product_name_dimension, selected_category_dimension"
filter_impact,sales_segment_l_2_name_sync_dimension,"['revenue_transaction_status', 'source_publishing_division', 'fin_adtype_name']","The distinct values of 'Sales Segment (L2) Name' are directly filtered by specific 'Revenue Transaction Status', 'Source Publishing Division' exclusions, and a predefined list of 'Financial Ad Type Names'.",N/A,Ensures that sales segment analysis focuses only on confirmed revenue from specific ad types and excludes certain publishing divisions.,"SELECT COUNT(DISTINCT sales_segment_l_2_name_sync) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)');",strong,high,34,f65a9149-93b4-4aa9-aef6-d12002853222,3,"revenue_transaction_status, source_publishing_division, fin_adtype_name"
filter_impact,booking_number_dimension,"['fin_adtype_name', 'financial_year']",The distinct values of 'Booking Number' are filtered by a specific set of 'Financial Ad Type Names' and 'Financial Years'.,N/A,Ensures that booking number analysis is constrained to specific ad content types and relevant financial periods.,"SELECT COUNT(DISTINCT booking_number) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND financial_year IN ('2026', '2025');",strong,high,34,f65a9149-93b4-4aa9-aef6-d12002853222,2,"fin_adtype_name, financial_year"
filter_impact,adsize_name_dimension,"['revenue_transaction_status', 'source_publishing_division', 'fin_adtype_name', 'financial_year']","The distinct values of 'Ad Size Name' are filtered by 'Revenue Transaction Status', 'Source Publishing Division' exclusions, a specific list of 'Financial Ad Type Names', and a particular 'Financial Year'.",N/A,"Ensures that ad size analysis is focused on confirmed revenue, excluding certain divisions, for specific ad types and a particular financial year.","SELECT COUNT(DISTINCT adsize_name) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND financial_year IN ('2025');",strong,high,34,f65a9149-93b4-4aa9-aef6-d12002853222,4,"revenue_transaction_status, source_publishing_division, fin_adtype_name, financial_year"
mathematical_relationship,total_gross_revenue_ex_adj,"['total_gross_revenue_amount', 'total_adjustment_amount']",Gross Revenue Excl. Adjustment is typically Gross Revenue Amount minus Adjustment Amount. This relationship is implied by the naming conventions and common accounting practices.,total_gross_revenue_ex_adj = total_gross_revenue_amount - total_adjustment_amount,"Ensures that the calculation of revenue excluding adjustments is consistent with the raw gross revenue and the adjustments made, providing a clear audit trail for revenue figures.","SELECT
  SUM(gross_revenue_ex_adj_amount) AS sum_gross_revenue_ex_adj,
  SUM(gross_revenue_amount) - SUM(adjustment_amount) AS calculated_gross_revenue_ex_adj,
  CASE WHEN SUM(gross_revenue_ex_adj_amount) = (SUM(gross_revenue_amount) - SUM(adjustment_amount)) THEN 'PASS' ELSE 'FAIL' END AS validation_status
FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`
WHERE revenue_transaction_status IN ('Booked', 'Billed')
  AND financial_year = '2025'
  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000
LIMIT 1;",strong,high,35,a17622e2-ad43-49cc-b3c5-19c95036fd14,2,"total_gross_revenue_amount, total_adjustment_amount"
filter_impact,total_rebate_3_amount,"['total_gross_revenue_ex_adj', 'total_gross_revenue_amount']","The 'rebate_3_amount != 0.000000' filter specifically impacts the calculation of Total Rebate 3 Amount, potentially excluding transactions where the rebate was explicitly zero, even if valid. This filter is present in two of the three queries.",N/A,Understanding if zero-value rebates should be included or excluded is critical for accurate rebate reporting and net revenue calculations. This filter might lead to undercounting total rebate volume if zero-value rebates are meaningful.,"SELECT
  COUNT(*) AS total_records,
  SUM(CASE WHEN rebate_3_amount != 0.000000 THEN 1 ELSE 0 END) AS records_with_non_zero_rebate,
  SUM(CASE WHEN rebate_3_amount = 0.000000 THEN 1 ELSE 0 END) AS records_with_zero_rebate
FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`
WHERE revenue_transaction_status IN ('Booked', 'Billed')
  AND financial_year = '2025'
  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000
LIMIT 1;",medium,medium,35,a17622e2-ad43-49cc-b3c5-19c95036fd14,2,"total_gross_revenue_ex_adj, total_gross_revenue_amount"
mathematical_relationship,current_year_gross_revenue,"['prior_year_gross_revenue', 'prior_year_gross_revenue_ytd_or_full']",These metrics are typically used together for year-over-year (YoY) growth analysis. Current year revenue is compared against prior year full revenue or prior year YTD revenue.,YoY_Growth_Full = (current_year_gross_revenue - prior_year_gross_revenue) / prior_year_gross_revenue; YoY_Growth_YTD = (current_year_gross_revenue_YTD - prior_year_gross_revenue_ytd_or_full) / prior_year_gross_revenue_ytd_or_full,Ensures accurate assessment of business performance trends over time.,"SELECT
  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_year_revenue,
  SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS prior_year_revenue,
  (SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) - SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)) / NULLIF(SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END), 0) AS yoy_growth_percentage
FROM
  `ncau-data-newsquery-prd.sbx_dcp.ia`
WHERE
  (revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR revenue_group_subtype IS NULL)
  AND booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);",strong,high,36,fed70b12-c274-4cde-9920-592ca4c4dab0,2,"prior_year_gross_revenue, prior_year_gross_revenue_ytd_or_full"
filter_impact,gross_amount_difference,['is_current_week_filter'],The `gross_amount_difference` metric is filtered to exclude data from the 'current week' as defined by `is_current_week_filter`.,N/A,"Ensures that revenue movement analysis is based on complete weekly data, avoiding partial week fluctuations.","SELECT
  SUM(CASE WHEN (movement_financial_week = min_week) THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS current_week_diff,
  SUM(CASE WHEN (movement_financial_week != min_week) THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS non_current_week_diff,
  SUM(GROSS_AMOUNT_DIFF) AS total_diff
FROM
  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`
WHERE
  movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);",strong,medium,36,fed70b12-c274-4cde-9920-592ca4c4dab0,1,is_current_week_filter
hierarchical,agency_parent,['account_number'],"Account numbers are typically nested under agency parents, forming a hierarchical relationship.",N/A,Allows for drill-down analysis from overall agency performance to individual account performance.,"SELECT
  agency_parent,
  COUNT(DISTINCT account_number) AS distinct_accounts
FROM
  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`
GROUP BY
  agency_parent
HAVING
  COUNT(DISTINCT account_number) > 1
LIMIT 10;",strong,high,36,fed70b12-c274-4cde-9920-592ca4c4dab0,1,account_number
mathematical_relationship,current_fy_gross_revenue_k_measure,['current_fy_gross_revenue_measure'],Current FY Gross Revenue ('000s) is derived by dividing Current FY Gross Revenue by 1000.,current_fy_gross_revenue_k_measure = current_fy_gross_revenue_measure / 1000,Ensures large revenue figures are presented in a more readable format (thousands).,SELECT SUM(current_fy_gross_revenue_k_measure * 1000) = SUM(current_fy_gross_revenue_measure) FROM calculated_metrics WHERE is_current_fy;,strong,medium,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,current_fy_gross_revenue_measure
mathematical_relationship,previous_fy_gross_revenue_k_measure,['previous_fy_gross_revenue_measure'],Previous FY Gross Revenue ('000s) is derived by dividing Previous FY Gross Revenue by 1000.,previous_fy_gross_revenue_k_measure = previous_fy_gross_revenue_measure / 1000,Ensures large revenue figures are presented in a more readable format (thousands) for year-over-year comparison.,SELECT SUM(previous_fy_gross_revenue_k_measure * 1000) = SUM(previous_fy_gross_revenue_measure) FROM calculated_metrics WHERE is_previous_fy;,strong,medium,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,previous_fy_gross_revenue_measure
mathematical_relationship,final_revenue_metric_k_measure,['final_revenue_metric_raw_measure'],Final Revenue Metric ('000s) is derived by dividing Final Revenue Metric (Raw) by 1000.,final_revenue_metric_k_measure = final_revenue_metric_raw_measure / 1000,Ensures the specific final revenue figure is presented in a more readable format (thousands).,SELECT SUM(final_revenue_metric_k_measure * 1000) = SUM(final_revenue_metric_raw_measure) FROM calculated_metrics;,strong,medium,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,1,final_revenue_metric_raw_measure
dependency,revenue_based_on_fy_pub_date_logic_measure,"['gross_revenue_amount_base_measure', 'is_current_fy_flag', 'is_specific_publication_type_flag', 'digital_revenue_condition_date_calc_dim']","This complex revenue metric depends on the base gross revenue, whether it's the current FY, if it's a specific publication type, and a conditionally derived date for comparison.",IF (is_current_fy AND is_specific_publication_type) THEN gross_revenue_amount ELSE IF (is_current_fy AND digital_revenue_condition_date <= report_date_minus_1_year) THEN gross_revenue_amount ELSE NULL,"This logic defines a specific subset of revenue crucial for the dashboard's focus, likely related to digital or specific product lines within the current FY.","SELECT COUNTIF(revenue_based_on_fy_pub_date_logic_measure IS NOT NULL) AS non_null_records, COUNTIF(is_current_fy_flag AND (is_specific_publication_type_flag OR (digital_revenue_condition_date_calc_dim <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)))) AS expected_records FROM calculated_metrics;",strong,high,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,4,"gross_revenue_amount_base_measure, is_current_fy_flag, is_specific_publication_type_flag, digital_revenue_condition_date_calc_dim"
filter_impact,composite_quarter_half_year_calc_dim,"['sum_current_fy_gross_revenue', 'sum_previous_fy_gross_revenue', 'sum_final_revenue_metric_raw']","All aggregated metrics are filtered by the 'Jul Q1 H1' composite quarter/half-year string, limiting the scope of the dashboard's data.",N/A (filter),"Ensures the dashboard focuses on a very specific, hardcoded reporting period. This makes the dashboard static unless the filter is manually updated.",SELECT COUNT(*) FROM calculated_metrics WHERE composite_quarter_half_year NOT IN ('Jul Q1 H1'); -- Should return 0 if filter is strictly applied,strong,high,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,3,"sum_current_fy_gross_revenue, sum_previous_fy_gross_revenue, sum_final_revenue_metric_raw"
filter_impact,sales_segment_l2_name_dim,"['sum_current_fy_gross_revenue', 'sum_previous_fy_gross_revenue', 'sum_final_revenue_metric_raw']","All aggregated metrics are filtered by the 'Consortium QLD' sales segment, limiting the scope of the dashboard's data to a specific business unit/region.",N/A (filter),Ensures the dashboard focuses on sales performance for a specific sales segment. Hardcoded value requires manual updates if the segment changes or if other segments need to be analyzed.,SELECT COUNT(*) FROM calculated_metrics WHERE sales_segment_l_2_name NOT IN ('Consortium QLD'); -- Should return 0 if filter is strictly applied,strong,high,37,9269e9c6-1ad0-4415-96c3-aca8a710ba01,3,"sum_current_fy_gross_revenue, sum_previous_fy_gross_revenue, sum_final_revenue_metric_raw"
mathematical_relationship,average_deal_value,"['total_sales_amount', 'number_of_deals']",Average Deal Value is derived directly from Total Sales Amount and Number of Deals.,Average Deal Value = Total Sales Amount / Number of Deals,Ensures that the average deal size is consistently calculated based on the underlying total sales and deal counts.,"SELECT SAFE_DIVIDE(SUM(sales_amount_column), COUNT(DISTINCT deal_id_column)) = AVG(sales_amount_column) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 1; -- Note: This validation is conceptual, as AVG(sales_amount_column) would be per row, not per deal. The formula is the correct one.",strong,high,38,80ca81f3-0671-40ef-a0a9-825a1580ca1b,2,"total_sales_amount, number_of_deals"
filter_impact,advertiser_name,"['portfolio_conformed_name_sync', 'sales_segment_l_2_name_sync', 'total_sales_amount', 'number_of_deals', 'average_deal_value']",Filtering by 'portfolio_conformed_name_sync' (especially with hardcoded values) directly impacts the available 'advertiser_name' values and subsequently all aggregated metrics.,N/A,Ensures that the dashboard's filters correctly narrow down the scope of analysis for all displayed metrics and dimensions.,"SELECT COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1') LIMIT 1;",strong,high,38,80ca81f3-0671-40ef-a0a9-825a1580ca1b,5,"portfolio_conformed_name_sync, sales_segment_l_2_name_sync, total_sales_amount, number_of_deals, average_deal_value"
mathematical_relationship,closing_base,"['opening_base', 'add_volume', 'red_volume', 'transfer_in', 'transfer_out']","The closing base is typically calculated as opening base plus additions, minus reductions, plus transfers in, minus transfers out.",Closing Base = Opening Base + Add Volume - Red Volume + Transfer In - Transfer Out,Ensures the integrity of subscription base calculations and reflects net movement.,"SELECT
  fiscal_week_id,
  category_name,
  gl_publication_code,
  SUM(closing_base) AS actual_closing_base,
  SUM(opening_base + add_volume - red_volume + transfer_in - transfer_out) AS calculated_closing_base,
  CASE WHEN SUM(closing_base) = SUM(opening_base + add_volume - red_volume + transfer_in - transfer_out) THEN 'MATCH' ELSE 'MISMATCH' END AS validation_status
FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`
WHERE fiscal_week_id = 202535
GROUP BY 1, 2, 3
HAVING validation_status = 'MISMATCH'
LIMIT 10;",strong,high,39,23c8b213-a9f0-4158-b8fa-bff14425abb5,5,"opening_base, add_volume, red_volume, transfer_in, transfer_out"
filter_impact,fiscal_week_id,"['add_volume', 'category_name', 'closing_base', 'earned_amount', 'gl_publication_code', 'opening_base', 'red_volume', 'transfer_in', 'transfer_out']","The hardcoded fiscal_week_id filter directly impacts the data scope for all subscription-related metrics, limiting them to a single week.",N/A,"Ensures that subscription metrics are reported for the intended fiscal period. However, hardcoding limits flexibility.",SELECT DISTINCT fiscal_week_id FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions` WHERE fiscal_week_id = 202535;,strong,high,39,23c8b213-a9f0-4158-b8fa-bff14425abb5,9,"add_volume, category_name, closing_base, earned_amount, gl_publication_code, opening_base, red_volume, transfer_in, transfer_out"
dependency,home_del_charge,"['channel', 'state']","Home delivery charges are reported at the granularity of channel and state, indicating these dimensions are key for understanding the cost structure.",N/A,Ensures that costs are correctly attributed to specific distribution channels and geographic regions.,"SELECT channel, state, SUM(home_del_charge) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals` GROUP BY 1, 2 LIMIT 10;",strong,medium,39,23c8b213-a9f0-4158-b8fa-bff14425abb5,2,"channel, state"
filter_impact,filtered_financial_year_by_sundry_overlay,['revenue_group_subtype'],The selection of 'SUNDRY ADSALES OVERLAY' for 'revenue_group_subtype' directly determines the available 'financial_year' values presented for this filter. This ensures that only years with this specific revenue type are selectable.,N/A,"Ensures that users can only select financial years that actually contain 'SUNDRY ADSALES OVERLAY' revenue, preventing selection of irrelevant periods.",SELECT COUNT(DISTINCT financial_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE revenue_group_subtype = 'SUNDRY ADSALES OVERLAY',strong,medium,40,3ee20092-1897-49b7-8bcd-4157d5f816eb,1,revenue_group_subtype
filter_impact,filtered_revenue_subtype_for_2025,['financial_year'],The hardcoded selection of '2025' for 'financial_year' directly determines the available 'revenue_group_subtype' values for this filter. This limits the subtypes to those present in the specified year.,N/A,"Ensures that users can only select revenue subtypes that exist within the 2025 financial year, providing a relevant list for current year analysis.",SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year = '2025',strong,medium,40,3ee20092-1897-49b7-8bcd-4157d5f816eb,1,financial_year
filter_impact,filtered_revenue_subtype_for_2024_2025_excluding_weeks,"['financial_year', 'financial_week']",The hardcoded selection of '2024'/'2025' for 'financial_year' and the exclusion of specific 'financial_week' values (47-52) directly determine the available 'revenue_group_subtype' values for this filter. This is a critical business rule for pacing reports.,N/A,"Ensures that users can only select revenue subtypes that exist within the specified financial years and non-excluded weeks, which is crucial for consistent and accurate pacing analysis by removing holiday/atypical periods.","SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2025', '2024') AND (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL)",strong,high,40,3ee20092-1897-49b7-8bcd-4157d5f816eb,2,"financial_year, financial_week"
dependency,financial_year_selected,"['financial_year', 'calendar_year']","The 'Financial Year (Selected)' metric is derived from either the raw 'financial_year' or 'calendar_year' column based on a conditional logic, which is currently hardcoded to always select 'financial_year'.",CASE WHEN ('Fin' = 'Fin') THEN financial_year ELSE calendar_year END,"Ensures that the dashboard can display data aggregated by either financial or calendar year, although this choice is currently fixed.",SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Fin' = 'Fin') THEN financial_year ELSE calendar_year END) IS NOT NULL;,strong,high,41,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"financial_year, calendar_year"
dependency,financial_month_selected,"['financial_short_month', 'calendar_month_short_name']","The 'Financial Month (Selected)' metric is derived from either the raw 'financial_short_month' or 'calendar_month_short_name' column based on a conditional logic, which is currently hardcoded to always select 'financial_short_month'.",CASE WHEN ('Fin' = 'Fin') THEN financial_short_month ELSE calendar_month_short_name END,"Ensures that the dashboard can display data aggregated by either financial or calendar month, although this choice is currently fixed.",SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Fin' = 'Fin') THEN financial_short_month ELSE calendar_month_short_name END) IS NOT NULL;,strong,high,41,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"financial_short_month, calendar_month_short_name"
dependency,portfolio_name_selected,"['portfolio_conformed_name_current', 'portfolio_conformed_name_sync']","The 'Portfolio Name (Selected)' metric is derived from either 'portfolio_conformed_name_current' or 'portfolio_conformed_name_sync' based on a conditional logic, which is currently hardcoded to always select 'portfolio_conformed_name_current'.",CASE WHEN ('Curr' = 'Curr') THEN portfolio_conformed_name_current ELSE portfolio_conformed_name_sync END,"Allows for flexibility in viewing portfolio data, though currently fixed to the 'current' view.",SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Curr' = 'Curr') THEN portfolio_conformed_name_current ELSE portfolio_conformed_name_sync END) IS NOT NULL;,strong,high,41,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"portfolio_conformed_name_current, portfolio_conformed_name_sync"
filter_impact,publication_date,"['financial_year_selected', 'financial_month_selected']",The 'Publication Date' dimension is implicitly filtered by the selections made on 'Financial Year (Selected)' and 'Financial Month (Selected)'. This means that the range of publication dates shown will be constrained by the chosen financial period.,publication_date falls within the period defined by financial_year_selected and financial_month_selected,Ensures that time-series data aligns with the selected financial reporting period.,"SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE publication_date IS NOT NULL AND financial_year = '2025' AND financial_short_month IN ('Feb', 'Mar');",strong,high,41,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,2,"financial_year_selected, financial_month_selected"
filter_impact,advertiser_name,"['financial_year_selected', 'financial_month_selected', 'portfolio_name_selected', 'employee_name']","The list of 'Advertiser Name' is filtered by selections on financial period, portfolio, and employee. This means only advertisers relevant to the current filter context are displayed.",advertiser_name IN (list_of_advertisers_from_filter),"Allows for focused analysis of advertiser performance within specific business contexts (e.g., a particular employee's clients in a given financial year).",SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE advertiser_name IN ('Australian Meat Processor Corporation') AND financial_year = '2025';,strong,high,41,d4d68a71-2b12-4caf-bc6b-96fc2d18a025,4,"financial_year_selected, financial_month_selected, portfolio_name_selected, employee_name"
mathematical_relationship,current_total_closing_base,"['current_closing_base_consumer', 'current_closing_base_3rd_party']",Total Closing Base is likely the sum of Consumer Closing Base and 3rd Party Closing Base.,Total_Closing_Base = Closing_Base_Consumer + Closing_Base_3rd_Party,Ensures comprehensive count of active subscribers across all segments.,SELECT SUM(Total_Closing_Base) - (SUM(Closing_Base_Consumer) + SUM(Closing_Base_3rd_Party)) AS variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37,strong,high,42,57d87efe-c112-4d42-be1b-045f0c8ca73e,2,"current_closing_base_consumer, current_closing_base_3rd_party"
mathematical_relationship,current_net_growth_incl_3rd_party,"['current_net_growth_consumer', 'current_net_growth_3rd_party']",Net Growth including 3rd Party is likely the sum of Net Growth Consumer and Net Growth 3rd Party.,Net_Growth_incl_3rd_Party = Net_Growth_Consumer + Net_Growth_3rd_Party,Verifies the overall growth calculation by summing individual segment growths.,SELECT SUM(Net_Growth_incl_3rd_Party) - (SUM(Net_Growth_Consumer) + SUM(Net_Growth_3rd_Party)) AS variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37,strong,high,42,57d87efe-c112-4d42-be1b-045f0c8ca73e,2,"current_net_growth_consumer, current_net_growth_3rd_party"
filter_impact,fy_week_of_year,"['current_always_on_digital_sales', 'six_week_always_on_digital_sales']","The `fy_week_of_year` dimension, combined with hardcoded report dates, dictates which specific week or range of weeks the metrics are aggregated for. This leads to different versions of the same metric (e.g., 'current' vs '6-week').",N/A,"Ensures that different dashboard components display data for their intended timeframes (e.g., current week vs. trailing 6 weeks).","SELECT fy_year, fy_week_of_year, SUM(Total_Revenue) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37 GROUP BY 1,2 UNION ALL SELECT fy_year, fy_week_of_year, SUM(Total_Revenue_6W) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year BETWEEN 26 AND 31 GROUP BY 1,2",strong,high,42,57d87efe-c112-4d42-be1b-045f0c8ca73e,2,"current_always_on_digital_sales, six_week_always_on_digital_sales"
mathematical_relationship,amount_revenue_type_03,"['total_amount_all_revenue_types', 'revenue_type_prefix']","Amount for Revenue Type '03' is a subset of Total Amount (All Revenue Types), filtered by the '03' prefix on 'revenue_type'.","amount_revenue_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END)",Ensures that the specific revenue type amount correctly contributes to the overall total and that the filtering logic is accurate.,"SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END) AS amount_03, SUM(amount) AS total_amount FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`)",strong,high,43,f7a9efeb-df3c-45c9-899d-0bcada701572,2,"total_amount_all_revenue_types, revenue_type_prefix"
mathematical_relationship,volume_revenue_type_03,"['total_volume_all_revenue_types', 'revenue_type_prefix']","Volume for Revenue Type '03' is a subset of Total Volume (All Revenue Types), filtered by the '03' prefix on 'revenue_type'.","volume_revenue_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN volume ELSE 0 END)",Ensures that the specific revenue type volume correctly contributes to the overall total and that the filtering logic is accurate.,"SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN volume ELSE 0 END) AS volume_03, SUM(volume) AS total_volume FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`)",strong,high,43,f7a9efeb-df3c-45c9-899d-0bcada701572,2,"total_volume_all_revenue_types, revenue_type_prefix"
filter_impact,latest_snapshot_load_time,[],"The calculation of 'latest_snapshot_load_time' is heavily dependent on specific hardcoded filters for source system, scenario, and sub-source system names. Changes to these filters directly impact the data source and the resulting load time.",N/A,"Verify that the specified filters ('Circulation', 'Estimate', 'RCTI', 'THINK', 'DTI') accurately reflect the desired data sources for freshness checks.","SELECT DISTINCT source_system_name, scenario, sub_source_system_name FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`",strong,medium,43,f7a9efeb-df3c-45c9-899d-0bcada701572,0,
dependency,total_draw_volume,"['route_volume', 'charge_type']",Total Draw Volume is calculated by summing `route_volume` only for records where `charge_type` is 'DRAW'.,SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END),Ensures accurate measurement of publications initially distributed.,"SELECT SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);",strong,high,44,c441950c-1e3f-432c-9838-847d1d315b9e,2,"route_volume, charge_type"
dependency,total_returns_volume,"['route_volume', 'charge_type']",Total Returns Volume is calculated by summing `route_volume` only for records where `charge_type` is 'RETURNS'.,SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END),"Ensures accurate measurement of publications returned, indicating unsold copies.","SELECT SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);",strong,high,44,c441950c-1e3f-432c-9838-847d1d315b9e,2,"route_volume, charge_type"
dependency,total_circulation_volume,"['route_volume', 'charge_type']","Total Circulation Volume is the sum of Draw, Returns, and Adjustment volumes. This is a gross sum of all transaction types.",SUM( (CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) ),Represents the total physical movement of publications. It's crucial to distinguish this from 'Net Circulation' (Draw - Returns + Adjustments).,"SELECT SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);",strong,high,44,c441950c-1e3f-432c-9838-847d1d315b9e,2,"route_volume, charge_type"
dependency,derived_publication_type,['gl_publication_code'],Derived Publication Type is a categorical mapping of `gl_publication_code` values based on a complex CASE statement.,CASE WHEN gl_publication_code IN (...) THEN 'Category' ELSE 'Other' END,"Groups granular publication codes into broader, more manageable categories for analysis. Accuracy depends on the completeness and correctness of the mapping logic.","SELECT gl_publication_code, CASE WHEN gl_publication_code IN ('500', '560') THEN 'ADV' WHEN gl_publication_code = '100' THEN 'AUS' WHEN gl_publication_code IN ('400', '402') THEN 'CM' WHEN gl_publication_code = '9504' THEN 'Delicious' WHEN gl_publication_code = '9505' THEN 'Delicious Specials' WHEN gl_publication_code IN ('110', '116') THEN 'DT' WHEN gl_publication_code = '350' THEN 'GAD' WHEN gl_publication_code = '670' THEN 'GCB' WHEN gl_publication_code = '180' THEN 'Group Shared Services' WHEN gl_publication_code = '156' THEN 'Hobart Print Services' WHEN gl_publication_code IN ('301', '303') THEN 'HS' WHEN gl_publication_code = '5003' THEN 'MDM' WHEN gl_publication_code IN ('850', '852') THEN 'MERCURY' WHEN gl_publication_code IN ('961', '963') THEN 'NTN' WHEN gl_publication_code = '158' THEN 'Perth Print Services' WHEN gl_publication_code = 'Post Courier' THEN 'Post Courier' WHEN gl_publication_code = '5024' THEN 'SC' WHEN gl_publication_code IN ('9514', '9515') THEN 'Taste' WHEN gl_publication_code = '5053' THEN 'TCHRN' WHEN gl_publication_code = '450' THEN 'TCP' WHEN gl_publication_code = '475' THEN 'TVB' WHEN gl_publication_code = '9560' THEN 'Vogue' WHEN gl_publication_code = '9556' THEN 'Vogue Living' WHEN gl_publication_code = '305' THEN 'WT' ELSE 'Other' END AS derived_type FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 100;",strong,high,44,c441950c-1e3f-432c-9838-847d1d315b9e,1,gl_publication_code
filter_impact,total_charge_amount,"['fiscal_week_id', 'sales_channel_l4', 'derived_publication_type']","Total Charge Amount is filtered by specific fiscal weeks, sales channel ('Subscriptions'), and derived publication type ('DT').",SUM(charge_amount) WHERE fiscal_week_id IN (...) AND sales_channel_l4 = 'Subscriptions' AND derived_publication_type = 'DT',"These filters narrow the scope of the charge amount to specific business segments and time periods, which is critical for targeted analysis. Hardcoding these limits flexibility.","SELECT SUM(charge_amount) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci LEFT JOIN `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal ON ci.charge_date = cal.calendar_date WHERE `left`(CAST(fiscal_week_id AS string), 4) IN ('2025') AND fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540) AND sales_channel_l4 IN ('Subscriptions') AND (CASE WHEN gl_publication_code IN ('110', '116') THEN 'DT' ELSE 'Other' END) IN ('DT') LIMIT 1;",strong,high,44,c441950c-1e3f-432c-9838-847d1d315b9e,3,"fiscal_week_id, sales_channel_l4, derived_publication_type"
dependency,supercoach_unique_acquisitions_by_source,"['supercoach_unique_acquisitions_total', 'source_masthead']","The 'SuperCoach Unique Acquisitions by Source' metric is a breakdown of the 'SuperCoach Unique Acquisitions (Total)' metric, using 'Source Masthead' as the grouping dimension.",SUM(supercoach_unique_acquisitions_by_source for all source_masthead) = supercoach_unique_acquisitions_total,Ensures that the sum of acquisitions across all sources equals the total acquisitions for SuperCoach.,"SELECT
  SUM(supercoach_unique_acquisitions_by_source) AS sum_by_source,
  (SELECT supercoach_unique_acquisitions_total FROM (
    SELECT
      movement_date,
      source_masthead,
      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,
      COUNT(DISTINCT CASE WHEN source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_unique_acquisitions_cs_source,
      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions
    FROM
      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`
    WHERE
      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)
      AND masthead = 'SC'
      AND subscription_movement_count_type = 'acquisition'
    GROUP BY
      movement_date,
      source_masthead
  ) AS primary_analysis_results
  WHERE movement_date = '2024-07-01' -- Example date
  LIMIT 1) AS total_acquisitions_for_date
FROM
  (
    SELECT
      movement_date,
      source_masthead,
      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,
      COUNT(DISTINCT CASE WHEN source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_unique_acquisitions_cs_source,
      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions
    FROM
      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`
    WHERE
      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)
      AND masthead = 'SC'
      AND subscription_movement_count_type = 'acquisition'
    GROUP BY
      movement_date,
      source_masthead
  ) AS primary_analysis_results
WHERE
  movement_date = '2024-07-01' -- Example date
GROUP BY
  movement_date;",strong,high,45,6e8b534b-485a-48dd-842d-13dc6bebb01a,2,"supercoach_unique_acquisitions_total, source_masthead"
filter_impact,supercoach_specific_rate_plan_subscriber_acquisitions,"['supercoach_unique_acquisitions_total', 'sold_in_rate_plan_code', 'subscriber_id', 'source_masthead']","The 'SuperCoach Specific Rate Plan & Subscriber Acquisitions' metric is a highly filtered subset of the 'SuperCoach Unique Acquisitions (Total)' metric, applying additional specific criteria on rate plan, subscriber ID, and source masthead.",supercoach_specific_rate_plan_subscriber_acquisitions <= supercoach_unique_acquisitions_total,"This metric should always be less than or equal to the total acquisitions, as it applies more restrictive filters.","SELECT
  SUM(supercoach_specific_rate_plan_subscriber_acquisitions) AS specific_acquisitions,
  SUM(supercoach_unique_acquisitions_total) AS total_acquisitions
FROM
  (
    SELECT
      movement_date,
      source_masthead,
      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,
      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions
    FROM
      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`
    WHERE
      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)
      AND masthead = 'SC'
      AND subscription_movement_count_type = 'acquisition'
    GROUP BY
      movement_date, source_masthead
  ) AS subquery
WHERE
  movement_date = '2024-07-01'; -- Example date",strong,medium,45,6e8b534b-485a-48dd-842d-13dc6bebb01a,4,"supercoach_unique_acquisitions_total, sold_in_rate_plan_code, subscriber_id, source_masthead"
