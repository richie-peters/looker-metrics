raw_response,status,response_id
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d7412673-0af1-4efe-8374-ca475b001fb6"",
    ""dashboard_name"": ""Finance OS datasource template report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year"",
      ""source_system_name"",
      ""fiscal_week_id"",
      ""gl_publication_code"",
      ""day_of_week"",
      ""state"",
      ""os_level_1"",
      ""os_level_2"",
      ""os_level_3"",
      ""os_level_4"",
      ""os_level_5"",
      ""os_level_6"",
      ""os_level_7"",
      ""os_level_8"",
      ""os_level_9"",
      ""os_level_10"",
      ""os_level_11"",
      ""os_level_12"",
      ""department_code"",
      ""period_name""
    ],
    ""date_range_detected"": ""Relative to Current Period ('CP') and Prior Year ('PY') based on `v_asl_DIM_period_control`"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""Period types ('CP', 'PY') should be managed via a configuration table or user input rather than hardcoded in the query."",
      ""The `calender_table` CTE is defined but unused in the provided queries and should be removed if not needed.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN -- Single query showing all key metrics calculated together\nWITH\n  OSandFACT AS (\n    SELECT\n      os.source_system_name,\n      os.sub_source_system_name,\n      CAST(os.fiscal_week_id AS int) AS fiscal_week_id,\n      os.gl_publication_code,\n      os.day_of_week,\n      os.state,\n      os.os_level_1,\n      os.os_level_2,\n      os.os_level_3,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_8,\n      os.os_level_9,\n      os.os_level_10,\n      os.os_level_11,\n      os.os_level_12,\n      os.Estimate,\n      os.True_Up_Adjustment,\n      os.Actual_Amount,\n      os.volume,\n      os.Last_Year_Actual_Amount,\n      os.Last_Year_volume,\n      os.Budget_Draft_Amount,\n      os.Budget_Draft_Volume,\n      os.Budget_Amount,\n      os.Budget_Volume,\n      os.Forecast_Amount,\n      os.Forecast_Volume,\n      os.Budget_Jan_Amount,\n      os.Budget_Jan_Volume,\n      os.Budget_Feb_Amount,\n      os.Budget_Feb_Volume,\n      os.Budget_Mar_Amount,\n      os.Budget_Mar_Volume,\n      os.Budget_Apr_Amount,\n      os.Budget_Apr_Volume,\n      os.Budget_May_Amount,\n      os.Budget_May_Volume,\n      os.Budget_Jun_Amount,\n      os.Budget_Jun_Volume,\n      os.Budget_Jul_Amount,\n      os.Budget_Jul_Volume,\n      os.Budget_Aug_Amount,\n      os.Budget_Aug_Volume,\n      os.Budget_Sep_Amount,\n      os.Budget_Sep_Volume,\n      os.Budget_Oct_Amount,\n      os.Budget_Oct_Volume,\n      os.Budget_Nov_Amount,\n      os.Budget_Nov_Volume,\n      os.Budget_Dec_Amount,\n      os.Budget_Dec_Volume,\n      os.Forecast_Q1F_Amount,\n      os.Forecast_Q1F_Volume,\n      os.Forecast_Q2F_Amount,\n      os.Forecast_Q2F_Volume,\n      os.Forecast_Q3F_Amount,\n      os.Forecast_Q3F_Volume,\n      os.Forecast_Q4F_Amount,\n      os.Forecast_Q4F_Volume,\n      os.Forecast_Q5F_Amount,\n      os.Forecast_Q5F_Volume,\n      pub.publication_name,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number AS calendar_fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year,\n      calendar.period_name,\n      dep.department_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN\n      (\n        SELECT DISTINCT\n          CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year_month_number AS int) AS fy_year_month_number,\n          CAST(c.relative_fisc_year_number AS int) AS relative_fisc_year_number,\n          CAST(c.relative_fisc_week_number AS int) AS relative_fisc_week_number,\n          c.fy_month_of_year_short_name,\n          CASE\n            WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y'\n            ELSE 'N'\n          END AS month_end_flag,\n          CAST(c.fy_quarter_of_year AS int) AS fy_quarter_of_year,\n          CAST(c.fy_year AS int) AS fy_year,\n          control_inner.period_name\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control_inner\n          ON control_inner.source_week_number = c.fy_year_week_number AND control_inner.period_name IN ('CP', 'PY')\n        WHERE\n          1 = 1\n      ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n      ON os.os_level_12 = dep.department_code\n  )\nSELECT\n  fy_year,\n  source_system_name,\n  period_name,\n  SUM(Actual_Amount) AS total_actual_amount,\n  COUNT(source_system_name) AS source_system_record_count,\n  COUNT(DISTINCT fiscal_week_id) AS distinct_fiscal_weeks,\n  COUNT(DISTINCT gl_publication_code) AS distinct_publications\nFROM\n  OSandFACT\nWHERE\n  fy_year IS NOT NULL\n  AND source_system_name IS NOT NULL\nGROUP BY\n  fy_year,\n  source_system_name,\n  period_name\nORDER BY\n  fy_year DESC, source_system_name\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT os.fiscal_week_id) as unique_fiscal_weeks_fact,\n  COUNT(DISTINCT os.gl_publication_code) as unique_publication_codes_fact,\n  COUNT(DISTINCT os.os_level_12) as unique_department_codes_fact,\n  MIN(calendar.fy_first_day_of_week) as earliest_fiscal_week_date,\n  MAX(calendar.fy_last_day_of_week) as latest_fiscal_week_date,\n  COUNT(DISTINCT calendar.fy_year) as unique_fiscal_years_calendar,\n  COUNT(DISTINCT control.period_name) as unique_period_names_control,\n  APPROX_COUNT_DISTINCT(os.source_system_name) as approx_unique_source_systems\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n    ON calendar.fy_year_week_number = control.source_week_number\nWHERE\n  calendar.fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 3\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.Actual_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.source_system_name) > 0 THEN 'PASS' ELSE 'FAIL' END as source_system_present_test,\n  CASE WHEN MAX(calendar.fy_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as fiscal_year_freshness_test,\n  CASE WHEN SUM(CASE WHEN control.period_name IN ('CP', 'PY') THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as period_control_filter_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS t0\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON t0.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n    ON calendar.fy_year_week_number = control.source_week_number\nWHERE\n  calendar.fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Period Control Filter' as rule_name,\n  COUNT(*) as total_records_in_control_table,\n  SUM(CASE WHEN period_name IN ('CP', 'PY') THEN 1 ELSE 0 END) as records_matching_dashboard_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN period_name IN ('CP', 'PY') THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_matching_filter,\n  ARRAY_AGG(DISTINCT period_name) as all_period_names_in_control_table\nFROM\n  `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control\nLIMIT 1;"",
    ""sample_data_sql"": ""WITH\n  OSandFACT AS (\n    SELECT\n      os.source_system_name,\n      os.sub_source_system_name,\n      CAST(os.fiscal_week_id AS int) AS fiscal_week_id,\n      os.gl_publication_code,\n      os.day_of_week,\n      os.state,\n      os.os_level_1,\n      os.os_level_2,\n      os.os_level_3,\n      os.os_level_4,\n      os.os_level_5,\n      os.os_level_6,\n      os.os_level_7,\n      os.os_level_8,\n      os.os_level_9,\n      os.os_level_10,\n      os.os_level_11,\n      os.os_level_12,\n      os.Estimate,\n      os.True_Up_Adjustment,\n      os.Actual_Amount,\n      os.volume,\n      os.Last_Year_Actual_Amount,\n      os.Last_Year_volume,\n      os.Budget_Draft_Amount,\n      os.Budget_Draft_Volume,\n      os.Budget_Amount,\n      os.Budget_Volume,\n      os.Forecast_Amount,\n      os.Forecast_Volume,\n      os.Budget_Jan_Amount,\n      os.Budget_Jan_Volume,\n      os.Budget_Feb_Amount,\n      os.Budget_Feb_Volume,\n      os.Budget_Mar_Amount,\n      os.Budget_Mar_Volume,\n      os.Budget_Apr_Amount,\n      os.Budget_Apr_Volume,\n      os.Budget_May_Amount,\n      os.Budget_May_Volume,\n      os.Budget_Jun_Amount,\n      os.Budget_Jun_Volume,\n      os.Budget_Jul_Amount,\n      os.Budget_Jul_Volume,\n      os.Budget_Aug_Amount,\n      os.Budget_Aug_Volume,\n      os.Budget_Sep_Amount,\n      os.Budget_Sep_Volume,\n      os.Budget_Oct_Amount,\n      os.Budget_Oct_Volume,\n      os.Budget_Nov_Amount,\n      os.Budget_Nov_Volume,\n      os.Budget_Dec_Amount,\n      os.Budget_Dec_Volume,\n      os.Forecast_Q1F_Amount,\n      os.Forecast_Q1F_Volume,\n      os.Forecast_Q2F_Amount,\n      os.Forecast_Q2F_Volume,\n      os.Forecast_Q3F_Amount,\n      os.Forecast_Q3F_Volume,\n      os.Forecast_Q4F_Amount,\n      os.Forecast_Q4F_Volume,\n      os.Forecast_Q5F_Amount,\n      os.Forecast_Q5F_Volume,\n      pub.publication_name,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number AS calendar_fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year,\n      calendar.period_name,\n      dep.department_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN\n      (\n        SELECT DISTINCT\n          CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year_month_number AS int) AS fy_year_month_number,\n          CAST(c.relative_fisc_year_number AS int) AS relative_fisc_year_number,\n          CAST(c.relative_fisc_week_number AS int) AS relative_fisc_week_number,\n          c.fy_month_of_year_short_name,\n          CASE\n            WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y'\n            ELSE 'N'\n          END AS month_end_flag,\n          CAST(c.fy_quarter_of_year AS int) AS fy_quarter_of_year,\n          CAST(c.fy_year AS int) AS fy_year,\n          control_inner.period_name\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN\n          `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control_inner\n          ON control_inner.source_week_number = c.fy_year_week_number AND control_inner.period_name IN ('CP', 'PY')\n        WHERE\n          1 = 1\n      ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN\n      `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n      ON os.os_level_12 = dep.department_code\n  )\nSELECT\n  *\nFROM\n  OSandFACT\nWHERE\n  fy_year IS NOT NULL\n  AND source_system_name IS NOT NULL\nORDER BY\n  fy_year DESC, fiscal_week_id DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""period_name filter in the calendar subquery, used to select 'Current Period' and 'Prior Year' data."",
          ""suggested_governance"": ""These period types should ideally be driven by a configuration table or user-selected parameters in the dashboard, allowing for more flexible time period analysis without modifying the SQL."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded period types ('CP', 'PY') with user-selectable parameters or a dynamic lookup from a governance table."",
      ""Consider adding a date range parameter for the fiscal year to allow users to select specific historical periods beyond 'CP' and 'PY'.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_actual_amount"",
      ""metric_name"": ""Total Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of actual financial amounts recorded, representing financial performance."",
      ""sql_logic"": ""SUM(Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""control.period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core financial metric used for tracking revenue or cost performance over time and across different dimensions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CP'"",
        ""'PY'""
      ],
      ""governance_issues"": [
        ""Period types should be configurable.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls in Actual_Amount if not handled upstream, which could skew sums.""
      ]
    },
    {
      ""metric_id"": ""source_system_count"",
      ""metric_name"": ""Source System Record Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""source_system"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The count of records associated with each source system, indicating data volume distribution."",
      ""sql_logic"": ""COUNT(source_system_name) (or COUNT(1) grouped by source_system_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""control.period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the contribution or volume of data from different source systems, often for data quality or integration monitoring."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CP'"",
        ""'PY'""
      ],
      ""governance_issues"": [
        ""Period types should be configurable.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the consistency and distinctness of source_system_name values.""
      ]
    },
    {
      ""metric_id"": ""fiscal_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year associated with the financial data, derived from the calendar dimension."",
      ""sql_logic"": ""calendar.fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control""
      ],
      ""filters_applied"": [
        ""control.period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A primary time dimension for financial reporting and analysis, allowing data to be grouped and filtered by fiscal year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CP'"",
        ""'PY'""
      ],
      ""governance_issues"": [
        ""Period types should be configurable.""
      ],
      ""data_quality_concerns"": [
        ""Ensuring correct fiscal year mapping from the calendar dimension, especially around fiscal year-end transitions.""
      ]
    },
    {
      ""metric_id"": ""source_system_name_dim"",
      ""metric_name"": ""Source System Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""source_system"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the system from which the financial data originated."",
      ""sql_logic"": ""os.source_system_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""control.period_name IN ('CP', 'PY')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for segmenting financial data, allowing analysis by the origin of the data, useful for operational and data governance insights."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CP'"",
        ""'PY'""
      ],
      ""governance_issues"": [
        ""Period types should be configurable.""
      ],
      ""data_quality_concerns"": [
        ""Consistency of naming conventions for source systems across different data loads.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount"",
      ""related_metrics"": [
        ""source_system_count"",
        ""fiscal_year"",
        ""source_system_name_dim""
      ],
      ""relationship_description"": ""All identified metrics and dimensions are filtered by the same period control logic, specifically including data for 'Current Period' (CP) and 'Prior Year' (PY) as defined in the `v_asl_DIM_period_control` table."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that all displayed financial data and its associated dimensions are consistently aligned to the defined 'Current Period' and 'Prior Year' for comparative analysis."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c ON os.fiscal_week_id = c.fy_year_week_number JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control ON c.fy_year_week_number = control.source_week_number WHERE control.period_name IN ('CP', 'PY') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,0
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6f1c8731-02da-464f-b146-bf2947860735"",
    ""dashboard_name"": ""Programmatic Sales_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""PortfolioParentGroup"",
      ""PortfolioChildGroup"",
      ""TransactionType"",
      ""FinancialYear"",
      ""FinancialQuarter"",
      ""FinancialMonthNumber""
    ],
    ""date_range_detected"": ""Financial Year 2025 Q4 and prior (up to 26/06/2025)"",
    ""hardcoded_dates_found"": [
      ""26/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'Guaranteed'"",
      ""'FY2025 - Q4'"",
      ""'CONSORTIUM VIC'"",
      ""'Deal'"",
      ""'VIC CON B3'"",
      ""'VIC CON B2'"",
      ""'VIC CON B1'"",
      ""CASE WHEN (FinancialMonthNumber = 1) THEN 7 ... ELSE NULL END""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Financial periods (e.g., 'FY2025 - Q4') should be dynamic or parameterized"",
      ""Business unit/group names (e.g., 'INDEPENDENT AGENCIES NSW', 'CONSORTIUM VIC', 'VIC CON B3') should use a governed lookup table"",
      ""Transaction types (e.g., 'Guaranteed', 'Deal') should use a governed lookup table"",
      ""Month remapping logic should be externalized to a configuration table or UDF if it's a common business rule""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for comprehensive business analysis, combining all key metrics and dimensions.\n-- Hardcoded values are replaced with dynamic alternatives or parameters for flexibility.\n\nWITH base_data AS (\n  SELECT\n    t0.Advertiser,\n    t0.PortfolioParentGroup,\n    t0.PortfolioChildGroup,\n    t0.TransactionType,\n    t0.FinancialYear,\n    t0.FinancialQuarter,\n    t0.FinancialMonthNumber,\n    t0.RevenueGross,\n    -- Derived Financial Period (from Q2 & Q3)\n    CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING)) AS financial_period_derived,\n    -- Remapped Financial Month Number (from Q3)\n    CASE\n      WHEN (t0.FinancialMonthNumber = 1) THEN 7\n      WHEN (t0.FinancialMonthNumber = 2) THEN 8\n      WHEN (t0.FinancialMonthNumber = 3) THEN 9\n      WHEN (t0.FinancialMonthNumber = 4) THEN 10\n      WHEN (t0.FinancialMonthNumber = 5) THEN 11\n      WHEN (t0.FinancialMonthNumber = 6) THEN 12\n      WHEN (t0.FinancialMonthNumber = 7) THEN 1\n      WHEN (t0.FinancialMonthNumber = 8) THEN 2\n      WHEN (t0.FinancialMonthNumber = 9) THEN 3\n      WHEN (t0.FinancialMonthNumber = 10) THEN 4\n      WHEN (t0.FinancialMonthNumber = 11) THEN 5\n      WHEN (t0.FinancialMonthNumber = 12) THEN 6\n      ELSE NULL\n    END AS remapped_financial_month_number,\n    -- Hardcoded comparison date (replaced with CURRENT_DATE() for dynamic analysis)\n    DATE(CURRENT_DATE()) AS hardcoded_comparison_date_dynamic\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n  -- Apply a general date filter for performance, e.g., last 2 financial years\n  WHERE t0.FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\n)\nSELECT\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber,\n  financial_period_derived,\n  -- Calculate constructed_date and derived_date_complex for analysis\n  DATE(FinancialYear, remapped_financial_month_number, 1) AS constructed_date,\n  SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(FinancialYear, remapped_financial_month_number, 1) AS DATETIME), MONTH) AS DATE) AS derived_date_complex,\n  -- Flag for the complex date comparison logic (original: constructed_date <= '2025-06-26')\n  (DATE(FinancialYear, remapped_financial_month_number, 1) <= hardcoded_comparison_date_dynamic) AS is_date_within_complex_filter,\n  SUM(RevenueGross) AS total_revenue_gross\nFROM base_data\nGROUP BY\n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber,\n  financial_period_derived,\n  constructed_date,\n  derived_date_complex,\n  is_date_within_complex_filter\nORDER BY\n  FinancialYear DESC, FinancialQuarter DESC, total_revenue_gross DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT PortfolioParentGroup) as unique_parent_groups,\n  COUNT(DISTINCT PortfolioChildGroup) as unique_child_groups,\n  COUNT(DISTINCT TransactionType) as unique_transaction_types,\n  MIN(CONCAT(FinancialYear, '-', LPAD(FinancialMonthNumber, 2, '0'))) as earliest_financial_period,\n  MAX(CONCAT(FinancialYear, '-', LPAD(FinancialMonthNumber, 2, '0'))) as latest_financial_period,\n  APPROX_COUNT_DISTINCT(CONCAT(Advertiser, PortfolioParentGroup, FinancialYear, FinancialMonthNumber)) as approx_unique_monthly_records\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(RevenueGross) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(FinancialYear) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` \nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Transaction Type Not Guaranteed' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'Specific PortfolioParentGroup Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN PortfolioParentGroup IN ('CONSORTIUM VIC') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN PortfolioParentGroup IN ('CONSORTIUM VIC') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nLIMIT 2;"",
    ""sample_data_sql"": ""SELECT \n  Advertiser,\n  PortfolioParentGroup,\n  PortfolioChildGroup,\n  TransactionType,\n  FinancialYear,\n  FinancialQuarter,\n  FinancialMonthNumber,\n  RevenueGross\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE FinancialYear >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\nORDER BY FinancialYear DESC, FinancialQuarter DESC, RevenueGross DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""26/06/2025"",
          ""original_format"": ""2025-06-26 07:36:48.083696+00"",
          ""context"": ""Used as a fixed comparison date in a complex date filter (clmn13_ = true, i.e., constructed_date <= hardcoded_date)"",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter to make the filter dynamic and relevant to the current period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'INDEPENDENT AGENCIES NSW'""
          ],
          ""context"": ""Filter for PortfolioParentGroup in Query 1."",
          ""suggested_governance"": ""Use a parameter or join to a 'PortfolioParentGroup' lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Guaranteed'""
          ],
          ""context"": ""Exclusion filter for TransactionType in Query 1."",
          ""suggested_governance"": ""Use a parameter or join to a 'TransactionType' lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'FY2025 - Q4'""
          ],
          ""context"": ""Filter for Financial Period in Query 2 and Query 3."",
          ""suggested_governance"": ""Derive dynamically based on current date/financial period or use a dashboard parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM VIC'""
          ],
          ""context"": ""Filter for PortfolioParentGroup in Query 3."",
          ""suggested_governance"": ""Use a parameter or join to a 'PortfolioParentGroup' lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Deal'""
          ],
          ""context"": ""Filter for TransactionType in Query 3."",
          ""suggested_governance"": ""Use a parameter or join to a 'TransactionType' lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'VIC CON B3'"",
            ""'VIC CON B2'"",
            ""'VIC CON B1'""
          ],
          ""context"": ""Filter for PortfolioChildGroup in Query 3."",
          ""suggested_governance"": ""Use a parameter or join to a 'PortfolioChildGroup' lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""CASE WHEN (FinancialMonthNumber = 1) THEN 7 ... ELSE NULL END""
          ],
          ""context"": ""Month remapping logic in Query 3, potentially for a custom financial calendar."",
          ""suggested_governance"": ""Externalize this logic to a UDF or a configuration table if it's a standard business rule, or document its purpose clearly."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., CURRENT_DATE(), DATE_SUB())."",
      ""Replace hardcoded lookup values for PortfolioParentGroup, PortfolioChildGroup, and TransactionType with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables or dynamic derivations for financial period filters (e.g., 'FY2025 - Q4') instead of hardcoded strings."",
      ""Externalize complex business logic like month remapping into UDFs or configuration tables for better maintainability and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic sales data."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Filtered by PortfolioParentGroup ('INDEPENDENT AGENCIES NSW' or 'CONSORTIUM VIC')"",
        ""Filtered by TransactionType (NOT 'Guaranteed' or 'Deal')"",
        ""Filtered by Financial Period ('FY2025 - Q4')"",
        ""Filtered by PortfolioChildGroup ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting and analyzing sales performance by individual advertisers."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_gross_sum"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue generated from programmatic sales."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""PortfolioParentGroup IN ('INDEPENDENT AGENCIES NSW')"",
        ""TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for overall sales performance and financial tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueGross if not handled at source""
      ]
    },
    {
      ""metric_id"": ""financial_period_derived"",
      ""metric_name"": ""Financial Period (FY - Q)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_quarter""
      ],
      ""business_description"": ""A concatenated string representing the Financial Year and Quarter (e.g., 'FY2025 - Q4')."",
      ""sql_logic"": ""CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Filtered to 'FY2025 - Q4'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping data by specific financial reporting periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025 - Q4'""
      ],
      ""governance_issues"": [
        ""should be dynamic or parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""derived_date_complex"",
      ""metric_name"": ""Derived Filter Date"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""business_description"": ""A date derived from Financial Year and a remapped Financial Month Number, truncated to the beginning of the month. Used in a complex date comparison filter."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 ... ELSE NULL END, 1) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""Date constructed from FinancialYear and remapped FinancialMonthNumber must be <= '2025-06-26'"",
        ""PortfolioParentGroup IN ('CONSORTIUM VIC')"",
        ""Financial Period IN ('FY2025 - Q4')"",
        ""TransactionType IN ('Deal')"",
        ""PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1')""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Likely used for specific period-over-period comparisons or snapshot reporting based on a custom financial calendar and a fixed cutoff date."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""monthly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""26/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""CASE WHEN (FinancialMonthNumber = 1) THEN 7 ... ELSE NULL END"",
        ""'CONSORTIUM VIC'"",
        ""'FY2025 - Q4'"",
        ""'Deal'"",
        ""'VIC CON B3'"",
        ""'VIC CON B2'"",
        ""'VIC CON B1'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table"",
        ""month remapping logic should be externalized""
      ],
      ""data_quality_concerns"": [
        ""potential nulls if month remapping results in NULL""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""revenue_gross_sum"",
      ""related_metrics"": [
        ""portfolio_parent_group"",
        ""transaction_type""
      ],
      ""relationship_description"": ""Total Gross Revenue is filtered by specific Portfolio Parent Groups ('INDEPENDENT AGENCIES NSW') and excludes 'Guaranteed' Transaction Types."",
      ""mathematical_formula"": ""SUM(RevenueGross) WHERE PortfolioParentGroup = 'INDEPENDENT AGENCIES NSW' AND TransactionType != 'Guaranteed'"",
      ""business_validation"": ""Ensures that the revenue reported is specific to a particular agency type and excludes certain transaction models, reflecting a specific business segment's performance."",
      ""validation_sql"": ""SELECT SUM(RevenueGross) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE PortfolioParentGroup = 'INDEPENDENT AGENCIES NSW' AND (TransactionType NOT IN ('Guaranteed') OR TransactionType IS NULL) LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser"",
      ""related_metrics"": [
        ""financial_period_derived""
      ],
      ""relationship_description"": ""The list of Advertisers is filtered to those active within a specific Financial Period ('FY2025 - Q4')."",
      ""mathematical_formula"": ""DISTINCT Advertiser WHERE CONCAT('FY',FinancialYear,' - ',FinancialQuarter) = 'FY2025 - Q4'"",
      ""business_validation"": ""Identifies advertisers relevant to a specific financial reporting quarter, useful for quarterly reviews or planning."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT Advertiser) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CONCAT('FY',SAFE_CAST(FinancialYear AS STRING),' - ',SAFE_CAST(FinancialQuarter AS STRING)) = 'FY2025 - Q4' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""derived_date_complex"",
      ""related_metrics"": [
        ""portfolio_parent_group"",
        ""financial_period_derived"",
        ""transaction_type"",
        ""portfolio_child_group""
      ],
      ""relationship_description"": ""The derived date is filtered by multiple dimensions: specific Portfolio Parent Group ('CONSORTIUM VIC'), Financial Period ('FY2025 - Q4'), Transaction Type ('Deal'), and specific Portfolio Child Groups ('VIC CON B3', 'VIC CON B2', 'VIC CON B1'), in addition to a complex date comparison."",
      ""mathematical_formula"": ""DerivedDate WHERE PortfolioParentGroup = 'CONSORTIUM VIC' AND FinancialPeriod = 'FY2025 - Q4' AND TransactionType = 'Deal' AND PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1') AND ConstructedDate <= '2025-06-26'"",
      ""business_validation"": ""This combination of filters suggests a highly specific analysis of dates related to 'Deal' transactions within a particular consortium and financial quarter, likely for detailed operational or regional performance review."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 WHEN (t0.FinancialMonthNumber = 2) THEN 8 WHEN (t0.FinancialMonthNumber = 3) THEN 9 WHEN (t0.FinancialMonthNumber = 4) THEN 10 WHEN (t0.FinancialMonthNumber = 5) THEN 11 WHEN (t0.FinancialMonthNumber = 6) THEN 12 WHEN (t0.FinancialMonthNumber = 7) THEN 1 WHEN (t0.FinancialMonthNumber = 8) THEN 2 WHEN (t0.FinancialMonthNumber = 9) THEN 3 WHEN (t0.FinancialMonthNumber = 10) THEN 4 WHEN (t0.FinancialMonthNumber = 11) THEN 5 WHEN (t0.FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) AS DATETIME), MONTH) AS DATE)) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0 WHERE (DATE(t0.FinancialYear, CASE WHEN (t0.FinancialMonthNumber = 1) THEN 7 WHEN (t0.FinancialMonthNumber = 2) THEN 8 WHEN (t0.FinancialMonthNumber = 3) THEN 9 WHEN (t0.FinancialMonthNumber = 4) THEN 10 WHEN (t0.FinancialMonthNumber = 5) THEN 11 WHEN (t0.FinancialMonthNumber = 6) THEN 12 WHEN (t0.FinancialMonthNumber = 7) THEN 1 WHEN (t0.FinancialMonthNumber = 8) THEN 2 WHEN (t0.FinancialMonthNumber = 9) THEN 3 WHEN (t0.FinancialMonthNumber = 10) THEN 4 WHEN (t0.FinancialMonthNumber = 11) THEN 5 WHEN (t0.FinancialMonthNumber = 12) THEN 6 ELSE NULL END, 1) <= DATE('2025-06-26')) AND t0.PortfolioParentGroup IN ('CONSORTIUM VIC') AND CONCAT('FY',SAFE_CAST(t0.FinancialYear AS STRING),' - ',SAFE_CAST(t0.FinancialQuarter AS STRING)) IN ('FY2025 - Q4') AND t0.TransactionType IN ('Deal') AND t0.PortfolioChildGroup IN ('VIC CON B3', 'VIC CON B2', 'VIC CON B1') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,1
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52c11c9c-052a-4e45-9cda-8fecd87d7964"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)(with Pluto Reporting Date)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily;ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""adtype_l1"",
      ""fin_adtype_name"",
      ""revenue_type"",
      ""revenue_group_subtype"",
      ""unified_publication_name"",
      ""advertiser_parent"",
      ""booking_line_created_date"",
      ""financial_year"",
      ""financial_quarter"",
      ""financial_month"",
      ""financial_week"",
      ""calendar_year"",
      ""calendar_month_name"",
      ""calendar_week"",
      ""Sales_Group"",
      ""sales_segment_l_1_name"",
      ""sales_segment_l_2_name"",
      ""advertiser_group"",
      ""advertiser_name"",
      ""portfolio_group_name_sync"",
      ""portfolio_group_name_current"",
      ""portfolio_parent_group_name_sync"",
      ""GSD"",
      ""anzsic_industry_level_1_name"",
      ""product_group"",
      ""publishing_division"",
      ""agency_group"",
      ""cost_model_type"",
      ""revenue_transaction_status""
    ],
    ""date_range_detected"": ""Current FY, Previous FY, Next FY (Fiscal) and Current CY, Previous CY (Calendar)"",
    ""hardcoded_dates_found"": [
      ""08/05/2025""
    ],
    ""hardcoded_values_found"": [
      ""Admin.ADV"",
      ""Admin.DTM"",
      ""Admin.HWT"",
      ""Admin.International"",
      ""Admin.Sales"",
      ""Admin.Sport"",
      ""Admin.TCM"",
      ""Bestrecipes.Admin"",
      ""Bodyandsoul.Admin"",
      ""CODE"",
      ""CodeBet"",
      ""Delicious.admin"",
      ""Escape.Admin"",
      ""GQ.Admin"",
      ""Kidspot.Admin"",
      ""National Sundry"",
      ""National Tabloid PrePrint"",
      ""News.Admin"",
      ""odds.com.au"",
      ""Punters.com.au"",
      ""Qantas Travel Insider"",
      ""RACENET"",
      ""Shortlyster Managed Service"",
      ""Sky News"",
      ""SKYNEWS.ADMIN"",
      ""Stellar.Admin"",
      ""Stockhead"",
      ""SUDDENLY.CW"",
      ""SUDDENLY.NORTH"",
      ""SUDDENLY.TGG"",
      ""Taste.Admin"",
      ""TAUS.ADMIN"",
      ""The Sunday Times"",
      ""TOOWOOMBACUSTOM"",
      ""Vogue.Admin"",
      ""Vogueliving.Admin"",
      ""MRCA"",
      ""DOUBLECLICK"",
      ""PLUTO"",
      ""VACANT"",
      ""PRINT"",
      ""DIGITAL"",
      ""PROGRAMMATIC"",
      ""PROGRAMMATIC EXCHANGE"",
      ""PROGRAMMATIC SOURCE"",
      ""SUNDRY ADSALES OVERLAY"",
      ""XTEND"",
      ""ADPT DIGITAL"",
      ""SUNDRY"",
      ""PROGRAMMATIC - GUARANTEED"",
      ""PROGRAMMATIC - OPEN EXCHANGE"",
      ""PROGRAMMATIC - PMP"",
      ""PROGRAMMATIC - DIGITAL OTHER"",
      ""OUTSTREAM"",
      ""EDMEDIA"",
      ""ECOMMERCE"",
      ""17114"",
      ""29172"",
      ""52809"",
      ""-"",
      ""BILLED"",
      ""BOOKED"",
      ""ROP COMPOSITE"",
      ""MEDIUM RARE CONTENT AGENCY"",
      ""$""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterised or use relative functions consistently"",
      ""Publication lists should be managed in a reference table"",
      ""Advertiser IDs should be managed in a reference table"",
      ""Sales segment names should be managed in a reference table"",
      ""Revenue type classifications should be managed in a reference table"",
      ""Currency display format should be a dashboard parameter"",
      ""Default values like 'VACANT' should be handled via data governance rules or configuration.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for business analysis, combining metrics from both queries and using the more granular daily table.\n-- It replaces hardcoded dates with CURRENT_DATE() and suggests parameterization for currency display.\n\nWITH base_data AS (\n  SELECT\n    ad_type_name AS adtype_name,\n    is_xtend_flag AS xtend_flag,\n    unified_publication_name,\n    unified_publication_gl_code,\n    CASE\n      WHEN unified_publication_name IN ('Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales',\n        'Admin.Sport', 'Admin.TCM', 'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin',\n        'Escape.Admin', 'GQ.Admin', 'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin',\n        'odds.com.au', 'Punters.com.au', 'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News',\n        'SKYNEWS.ADMIN', 'Stellar.Admin', 'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin',\n        'TAUS.ADMIN', 'The Sunday Times', 'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin') THEN 'Sundry Pubs'\n      ELSE 'Non Sundry Pubs'\n    END AS Sundry_Pubs_Flag,\n    fy_year_month_number,\n    CAST(`right`(CAST(fy_year_month_number AS STRING), 2) AS INT) AS fiscal_month_number,\n    fy_year AS financial_year,\n    fy_quarter_of_year AS financial_quarter,\n    fy_month_of_year AS financial_month,\n    fy_month_short_name AS financial_short_month,\n    fy_week_of_year AS financial_week,\n    revenue_transaction_status_code AS revenue_transaction_status,\n    is_print_digital_flag,\n    current_fy_month_of_year AS current_financial_month,\n    current_fy_week_of_year AS current_financial_week,\n    fy_year_week_number,\n    style_name,\n    UPPER(ASL.fin_adtype_name) AS fin_adtype_name,\n    CASE\n      WHEN sync_sales_segment_l2_name = 'MRCA' THEN 'MRCA'\n      ELSE 'Client'\n    END AS Sales_Group,\n    EXTRACT(DAYOFWEEK FROM `current_date`()) AS DOW_Today,\n    sales_segment_l1_name AS sales_segment_l_1_name,\n    sales_segment_l2_name AS sales_segment_l_2_name,\n    sync_sales_segment_l1_name AS sales_segment_l_1_name_sync,\n    sync_sales_segment_l2_name AS sales_segment_l_2_name_sync,\n    fy_quarter_of_year_name,\n    relative_fy_year_offset,\n    relative_fy_quarter_offset,\n    relative_fy_month_offset,\n    relative_fy_week_offset,\n    customer_group_name AS advertiser_group,\n    customer_group_parent_name AS advertiser_parent,\n    SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n    curr_sales_segment_gm_name AS sales_segment_gm_name,\n    sync_sales_segment_gm_name AS sales_segment_gm_name_sync,\n    revenue_group_level1_name AS revenue_group_level_1_name,\n    revenue_group_level2_name AS revenue_group_level_2_name,\n    SUM(IFNULL(lgb_pub_amount, 0)) AS pub_lgb,\n    SUM(IFNULL(lgb_ss_amount, 0)) AS ss_lgb,\n    SUM(IFNULL(pipeline_amount, 0)) AS pipeline,\n    SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n    UPPER(revenue_group_type_code) AS revenue_type,\n    Upper(revenue_type_level2_code) AS revenue_type_Level2,\n    UPPER(ASL.revenue_group_sub_type_code) AS revenue_group_subtype,\n    current_portfolio_group_owner_sync,\n    sync_portfolio_group_name AS portfolio_group_name_sync,\n    current_portfolio_group_name AS portfolio_group_name_current,\n    sync_portfolio_parent_group_name AS portfolio_parent_group_name_sync,\n    industry_level1_name AS aszsic_industry_level_1_name,\n    industry_level1_code AS anzsic_industry_level_1_code,\n    industry_level2_code AS anzsic_industry_level_2_code,\n    industry_level2_name AS aszsic_industry_level_2_name,\n    industry_level3_code AS anzsic_industry_level_3_code,\n    industry_level3_name AS anzsic_industry_level_3_name,\n    industry_level4_code AS anzsic_industry_level_4_code,\n    industry_level4_name AS anzsic_industry_level_4_name,\n    industry_pillar_name AS nca_industry_pillar,\n    industry_pillar_group_name AS nca_industry_anzsic_pillar_group,\n    ASL.product_group_name AS product_group,\n    division_group_name AS publishing_division_group,\n    division_parent_group_name AS publishing_division_parent,\n    CASE\n      WHEN client_reporting_date >= `current_date`('Australia/Sydney') THEN 'Y'\n      ELSE 'N'\n    END AS is_future_period_flag,\n    CASE\n      WHEN client_reporting_date >= DATE_ADD(`current_date`('Australia/Sydney'), INTERVAL -365 DAY) THEN 'Y'\n      ELSE 'N'\n    END AS ly_is_future_period_flag,\n    CASE\n      WHEN client_reporting_date >= DATE_ADD(`current_date`('Australia/Sydney'), INTERVAL 365 DAY) THEN 'Y'\n      ELSE 'N'\n    END AS ny_is_future_period_flag,\n    cost_model_type_code AS cost_model_type,\n    CASE\n      WHEN dw_source_system_code = 'PLUTO' THEN CAST(client_reporting_date AS string)\n      ELSE booking_line_created_date\n    END AS booking_line_created_date_str,\n    advertiser_name,\n    current_portfolio_conformed_owner_sync,\n    sync_portfolio_conformed_name AS portfolio_conformed_name_sync,\n    publishing_division_name AS publishing_division,\n    booking_line_created_week_of_year AS booking_line_created_week,\n    booking_line_created_month_of_year AS booking_line_created_month,\n    booking_line_created_month_short_name AS booking_line_created_short_month,\n    booking_line_created_quarter_of_year AS booking_line_created_quarter,\n    booking_line_created_year,\n    agency_group_parent_name AS agency_parent,\n    agency_group_name AS agency_group,\n    agency_name,\n    agency_id_src AS agency_number,\n    cal_month_name AS calendar_month_name,\n    cal_year AS calendar_year,\n    section_l5_name AS classification_name,\n    SUM(IFNULL(target_amount, 0)) AS target_amount,\n    IFNULL(current_portfolio_group_owner_full_name_sync, 'VACANT') AS GSD,\n    IFNULL(current_portfolio_group_owner_full_name_current, 'VACANT') AS current_portfolio_group_owner_full,\n    IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n    IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS portfolio_full_name_sync,\n    IFNULL(current_portfolio_conformed_owner_full_name_sync, 'VACANT') AS sync_portfolio_conformed_owner_full,\n    current_portfolio_conformed_owner_current,\n    current_portfolio_group_owner_current,\n    adtype_l1,\n    adtype_l2,\n    legacy_growth_flag,\n    relative_cal_year_offset,\n    cal_quarter_of_year_name AS calendar_quarter_of_year,\n    cal_year_week_number AS calendar_week,\n    CAST(client_reporting_date AS DATE) AS client_reporting_date_parsed,\n    CAST(booking_line_created_date AS DATE) AS booking_line_created_date_parsed,\n    MIN(CASE WHEN customer_group_parent_name = \""DOUBLECLICK\"" THEN CAST(booking_line_created_date AS DATE) END) OVER (PARTITION BY fy_year) AS fix_date_lod\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` AS ASL\n  WHERE\n    (relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)) AND UPPER(IFNULL(revenue_transaction_status_code,\n        'XXX')) IN ('BILLED', 'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division_name,\n        'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR\n    (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name =\n    '-')))\n  GROUP BY ALL -- Grouping by all selected columns to aggregate sums\n)\nSELECT\n  -- Dimensions\n  adtype_l1,\n  fin_adtype_name,\n  CASE\n    WHEN (fin_adtype_name = 'XTEND') THEN 'XTEND'\n    WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE') THEN 'PROGRAMMATIC - DIGITAL OTHER'\n    WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'GUA') THEN 'PROGRAMMATIC - GUARANTEED'\n    WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'NON') THEN 'PROGRAMMATIC - OPEN EXCHANGE'\n    WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'PMP') THEN 'PROGRAMMATIC - PMP'\n    WHEN (revenue_type = 'DIGITAL') THEN 'ADPT DIGITAL'\n    WHEN (SAFE.LEFT(revenue_group_subtype, 6) = 'SUNDRY') THEN 'SUNDRY'\n    ELSE revenue_group_subtype\n  END AS revenue_type_dimension,\n  revenue_group_subtype,\n  unified_publication_name,\n  advertiser_parent,\n  booking_line_created_date_parsed AS booking_line_created_date,\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_week,\n  Sales_Group,\n  sales_segment_l_1_name,\n  sales_segment_l_2_name,\n  advertiser_group,\n  advertiser_name,\n  portfolio_group_name_sync,\n  portfolio_group_name_current,\n  portfolio_parent_group_name_sync,\n  GSD,\n  anzsic_industry_level_1_name,\n  product_group,\n  publishing_division,\n  agency_group,\n  cost_model_type,\n  revenue_transaction_status,\n  -- Metrics\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS gross_revenue_current_fy,\n  SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END) AS gross_revenue_next_fy,\n  SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END, 1000)) AS gross_revenue_current_fy_k,\n  SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END, 1000)) AS gross_revenue_next_fy_k,\n  SUM(CASE\n    WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE'))\n      OR (relative_fy_year_offset = 0 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE booking_line_created_date_parsed END AS DATETIME) <= DATETIME_ADD(CAST(CURRENT_DATE('Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)))\n    THEN SAFE_DIVIDE(gross_revenue_amount, 1000)\n    ELSE 0\n  END) AS gross_revenue_conditional_k,\n  SUM(adjustment_amount) AS total_adjustment_amount,\n  SUM(pub_lgb) AS total_pub_lgb,\n  SUM(ss_lgb) AS total_ss_lgb,\n  SUM(pipeline) AS total_pipeline,\n  SUM(target_amount) AS total_target_amount,\n  COUNT(CASE\n    WHEN (UPPER(revenue_group_subtype) = 'PRINT') THEN 1\n    WHEN (UPPER(revenue_group_subtype) = 'DIGITAL') THEN 2\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC') THEN 3\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC EXCHANGE') THEN 4\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE') THEN 5\n    WHEN (UPPER(revenue_group_subtype) = 'SUNDRY ADSALES OVERLAY') THEN 6\n    ELSE NULL\n  END) AS revenue_type_encoded_count,\n  SUM(CASE\n    WHEN (UPPER(revenue_group_subtype) = 'PRINT') THEN 1\n    WHEN (UPPER(revenue_group_subtype) = 'DIGITAL') THEN 2\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC') THEN 3\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC EXCHANGE') THEN 4\n    WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE') THEN 5\n    WHEN (UPPER(revenue_group_subtype) = 'SUNDRY ADSALES OVERLAY') THEN 6\n    ELSE NULL\n  END) AS revenue_type_encoded_sum\nFROM base_data\nGROUP BY\n  -- Group by all dimensions to get the correct aggregation level\n  adtype_l1,\n  fin_adtype_name,\n  revenue_type_dimension,\n  revenue_group_subtype,\n  unified_publication_name,\n  advertiser_parent,\n  booking_line_created_date_parsed,\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_week,\n  calendar_year,\n  calendar_month_name,\n  calendar_week,\n  Sales_Group,\n  sales_segment_l_1_name,\n  sales_segment_l_2_name,\n  advertiser_group,\n  advertiser_name,\n  portfolio_group_name_sync,\n  portfolio_group_name_current,\n  portfolio_parent_group_name_sync,\n  GSD,\n  anzsic_industry_level_1_name,\n  product_group,\n  publishing_division,\n  agency_group,\n  cost_model_type,\n  revenue_transaction_status\nORDER BY financial_year DESC, financial_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT client_reporting_date) as unique_client_reporting_dates,\n  COUNT(DISTINCT booking_line_created_date) as unique_booking_line_created_dates,\n  COUNT(DISTINCT advertiser_id_src) as unique_advertisers,\n  COUNT(DISTINCT unified_publication_name) as unique_publications,\n  MIN(client_reporting_date) as earliest_client_reporting_date,\n  MAX(client_reporting_date) as latest_client_reporting_date,\n  MIN(booking_line_created_date) as earliest_booking_line_created_date,\n  MAX(booking_line_created_date) as latest_booking_line_created_date,\n  APPROX_COUNT_DISTINCT(CONCAT(CAST(client_reporting_date AS STRING), '-', CAST(advertiser_id_src AS STRING), '-', CAST(booking_line_id_src AS STRING))) as approx_unique_transactions\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  client_reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data is fresh\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_advertiser_test,\n  CASE WHEN MAX(client_reporting_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN COUNTIF(relative_fy_year_offset = 0) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  client_reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  client_reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'SUDDENLY Publication Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-'))) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-'))) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  client_reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  client_reporting_date,\n  booking_line_created_date,\n  financial_year,\n  financial_month,\n  adtype_l1,\n  fin_adtype_name,\n  revenue_type_code AS revenue_type,\n  revenue_group_subtype_code AS revenue_group_subtype,\n  gross_revenue_amount,\n  target_amount,\n  pipeline_amount,\n  advertiser_name,\n  unified_publication_name,\n  relative_fy_year_offset,\n  relative_cal_year_offset,\n  revenue_transaction_status_code,\n  style_name,\n  source_publishing_division_name,\n  advertiser_id_src,\n  ad_type_name,\n  customer_group_parent_name AS advertiser_parent,\n  dw_source_system_code\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily`\nWHERE\n  client_reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND gross_revenue_amount IS NOT NULL\nORDER BY client_reporting_date DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""08/05/2025"",
          ""original_format"": ""2025-05-08 01:48:02.510465+00"",
          ""context"": ""Used as a fixed reference date in calculations for `clmn13_` and `clmn11_` (Query 2 & 3), which are then used in date comparisons (`clmn43_`, `clmn35_`). This date is in the future relative to current date."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE('Australia/Sydney')` or a dashboard parameter for the 'as of' date."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Admin.ADV'"",
            ""'Admin.DTM'"",
            ""'Admin.HWT'"",
            ""'Admin.International'"",
            ""'Admin.Sales'"",
            ""'Admin.Sport'"",
            ""'Admin.TCM'"",
            ""'Bestrecipes.Admin'"",
            ""'Bodyandsoul.Admin'"",
            ""'CODE'"",
            ""'CodeBet'"",
            ""'Delicious.admin'"",
            ""'Escape.Admin'"",
            ""'GQ.Admin'"",
            ""'Kidspot.Admin'"",
            ""'National Sundry'"",
            ""'National Tabloid PrePrint'"",
            ""'News.Admin'"",
            ""'odds.com.au'"",
            ""'Punters.com.au'"",
            ""'Qantas Travel Insider'"",
            ""'RACENET'"",
            ""'Shortlyster Managed Service'"",
            ""'Sky News'"",
            ""'SKYNEWS.ADMIN'"",
            ""'Stellar.Admin'"",
            ""'Stockhead'"",
            ""'SUDDENLY.CW'"",
            ""'SUDDENLY.NORTH'"",
            ""'SUDDENLY.TGG'"",
            ""'Taste.Admin'"",
            ""'TAUS.ADMIN'"",
            ""'The Sunday Times'"",
            ""'TOOWOOMBACUSTOM'"",
            ""'Vogue.Admin'"",
            ""'Vogueliving.Admin'""
          ],
          ""context"": ""List of unified publication names used to classify 'Sundry Pubs'."",
          ""suggested_governance"": ""Create a `publication_classification_lookup` table with `publication_name` and `is_sundry_flag`."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'MRCA'""
          ],
          ""context"": ""Specific sales segment name used to classify 'Sales_Group'."",
          ""suggested_governance"": ""Manage sales segment classifications in a `sales_segment_lookup` table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'""
          ],
          ""context"": ""Specific advertiser parent name used in `fix_date_lod` calculation and other conditional logic."",
          ""suggested_governance"": ""Manage special advertiser classifications in an `advertiser_lookup` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'""
          ],
          ""context"": ""Specific source system code used to determine `booking_line_created_date` source."",
          ""suggested_governance"": ""Manage source system definitions in a `source_system_lookup` table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""'VACANT'""
          ],
          ""context"": ""Default value for owner names when NULL."",
          ""suggested_governance"": ""Define default values in a configuration table or handle via data quality rules."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'PRINT'"",
            ""'DIGITAL'"",
            ""'PROGRAMMATIC'"",
            ""'PROGRAMMATIC EXCHANGE'"",
            ""'PROGRAMMATIC SOURCE'"",
            ""'SUNDRY ADSALES OVERLAY'"",
            ""'XTEND'"",
            ""'ADPT DIGITAL'"",
            ""'SUNDRY'"",
            ""'PROGRAMMATIC - GUARANTEED'"",
            ""'PROGRAMMATIC - OPEN EXCHANGE'"",
            ""'PROGRAMMATIC - PMP'"",
            ""'PROGRAMMATIC - DIGITAL OTHER'""
          ],
          ""context"": ""Categorization logic for various revenue and ad types."",
          ""suggested_governance"": ""Create a `revenue_type_classification_lookup` table to map raw types to standardized categories."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'OUTSTREAM'"",
            ""'XTEND'"",
            ""'EDMEDIA'"",
            ""'ECOMMERCE'""
          ],
          ""context"": ""Specific unified publication names used in conditional revenue calculations."",
          ""suggested_governance"": ""Manage these publication types in a `publication_type_lookup` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'17114'"",
            ""'29172'"",
            ""'52809'""
          ],
          ""context"": ""Specific advertiser IDs used in a complex filter for 'SUDDENLY' publications."",
          ""suggested_governance"": ""Manage these special advertiser IDs in an `advertiser_special_case_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'$'""
          ],
          ""context"": ""String literal used to determine if currency should be displayed in thousands or as-is. Implies a missing parameter."",
          ""suggested_governance"": ""Introduce a dashboard parameter for currency display format (e.g., 'UNIT_DISPLAY_FORMAT' with values 'FULL' or 'THOUSANDS')."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (`CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values (e.g., publication names, sales segments, advertiser IDs, revenue types) with joins to governed reference tables."",
      ""Use configuration tables for complex business rules (e.g., 'Sundry Pubs' classification, revenue type categorization) instead of hardcoded `CASE` statements."",
      ""Introduce a dashboard parameter for currency display format (e.g., 'Show in Thousands' boolean or 'Currency Unit' string)."",
      ""Parameterize the `relative_fy_year_offset` and `relative_cal_year_offset` filters to allow dynamic selection of fiscal/calendar years.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adtype_l1"",
      ""metric_name"": ""Ad Type Level 1"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The highest level classification of advertisement type."",
      ""sql_logic"": ""adtype_l1"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level segmentation of sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial classification of advertisement type, often used for reporting."",
      ""sql_logic"": ""UPPER(ASL.fin_adtype_name)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a financial perspective on ad types, potentially different from operational classifications."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_dimension"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function|conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""fin_adtype_name"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""cost_model_type""
      ],
      ""business_description"": ""Categorization of revenue based on ad type or revenue type code, including special handling for 'XTEND' and 'PROGRAMMATIC' types."",
      ""sql_logic"": ""CASE WHEN (fin_adtype_name = 'XTEND') THEN 'XTEND' WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE') THEN 'PROGRAMMATIC - DIGITAL OTHER' WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'GUA') THEN 'PROGRAMMATIC - GUARANTEED' WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'NON') THEN 'PROGRAMMATIC - OPEN EXCHANGE' WHEN (revenue_group_subtype = 'DIGITAL' AND revenue_type = 'PROGRAMMATIC SOURCE' AND SAFE.LEFT(cost_model_type, 3) = 'PMP') THEN 'PROGRAMMATIC - PMP' WHEN (revenue_type = 'DIGITAL') THEN 'ADPT DIGITAL' WHEN (SAFE.LEFT(revenue_group_subtype, 6) = 'SUNDRY') THEN 'SUNDRY' ELSE revenue_group_subtype END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue performance by different ad and revenue models."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'XTEND'"",
        ""'PROGRAMMATIC'"",
        ""'PRINT'"",
        ""'DIGITAL'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'"",
        ""'SUNDRY ADSALES OVERLAY'"",
        ""'PROGRAMMATIC - GUARANTEED'"",
        ""'PROGRAMMATIC - OPEN EXCHANGE'"",
        ""'PROGRAMMATIC - PMP'"",
        ""'ADPT DIGITAL'"",
        ""'SUNDRY'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table for revenue type classifications.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount before any adjustments."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1) OR relative_cal_year_offset IN (-1, 0)"",
        ""UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) IN ('BILLED', 'BOOKED')"",
        ""UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'"",
        ""UPPER(IFNULL(source_publishing_division_name, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""(UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND (advertiser_id_src IN ('17114', '29172', '52809') OR ad_type_name = '-')))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for sales performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'"",
        ""'-'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter values should be managed in reference tables.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if `gross_revenue_amount` is not always populated, though `IFNULL` handles this.""
      ]
    },
    {
      ""metric_id"": ""gross_revenue_current_fy"",
      ""metric_name"": ""Gross Revenue (Current FY)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_gross_revenue"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue specifically for the current fiscal year."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for current period performance analysis and target comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_next_fy"",
      ""metric_name"": ""Gross Revenue (Next FY)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_gross_revenue"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue specifically for the next fiscal year, often used for forecasting or future planning."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides insight into future revenue commitments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_current_fy_k"",
      ""metric_name"": ""Gross Revenue (Current FY, '000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|ratio|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_current_fy""
      ],
      ""business_description"": ""Gross revenue for the current fiscal year, scaled to thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Formatted for easier readability in dashboards, representing current fiscal year performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Currency scaling (division by 1000) should be driven by a dashboard parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_next_fy_k"",
      ""metric_name"": ""Gross Revenue (Next FY, '000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|ratio|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_next_fy""
      ],
      ""business_description"": ""Gross revenue for the next fiscal year, scaled to thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN relative_fy_year_offset = 1 THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Formatted for easier readability in dashboards, representing future revenue commitments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Currency scaling (division by 1000) should be driven by a dashboard parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_conditional_k"",
      ""metric_name"": ""Gross Revenue (Conditional, '000)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|ratio|date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""total_gross_revenue"",
        ""relative_fy_year_offset"",
        ""unified_publication_name"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync"",
        ""advertiser_parent"",
        ""booking_line_created_date"",
        ""fix_date_lod""
      ],
      ""business_description"": ""A complex conditional gross revenue metric, scaled to thousands, based on publication type or a specific date comparison involving DoubleClick and booking dates."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND UPPER(unified_publication_name) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) OR (relative_fy_year_offset = 0 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE booking_line_created_date_parsed END AS DATETIME) <= DATETIME_ADD(CAST(CURRENT_DATE('Australia/Sydney') AS DATETIME), INTERVAL -365 DAY))) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Likely a specialized revenue calculation for specific business segments or reporting needs, potentially related to programmatic or digital revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""08/05/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'"",
        ""'DIGITAL'"",
        ""'Digital Other'"",
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""Hardcoded date should be replaced with `CURRENT_DATE()` or a parameter."",
        ""Hardcoded lookup values should use reference tables."",
        ""Complexity of logic suggests a need for clear documentation or a dedicated business rule engine.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on `fix_date_lod` which is an analytic function, could lead to unexpected results if partitioning changes."",
        ""Nested `CASE` and `SAFE_CAST` can be fragile.""
      ]
    },
    {
      ""metric_id"": ""total_target_amount"",
      ""metric_name"": ""Total Target Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total target revenue amount for sales teams."",
      ""sql_logic"": ""SUM(IFNULL(target_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for measuring sales performance against set goals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Reliance on `target_amount` being accurately populated.""
      ]
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of revenue in the sales pipeline."",
      ""sql_logic"": ""SUM(IFNULL(pipeline_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Indicates potential future revenue and sales team activity."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on timely and accurate pipeline updates.""
      ]
    },
    {
      ""metric_id"": ""revenue_type_encoded_count"",
      ""metric_name"": ""Revenue Type Encoded Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""revenue_group_subtype""
      ],
      ""business_description"": ""A count of records where `revenue_group_subtype` matches specific categories, encoded as integers."",
      ""sql_logic"": ""COUNT(CASE WHEN (UPPER(revenue_group_subtype) = 'PRINT') THEN 1 WHEN (UPPER(revenue_group_subtype) = 'DIGITAL') THEN 2 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC') THEN 3 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC EXCHANGE') THEN 4 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE') THEN 5 WHEN (UPPER(revenue_group_subtype) = 'SUNDRY ADSALES OVERLAY') THEN 6 ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely used internally by Looker Studio for sorting or filtering based on an ordered list of revenue types, rather than a direct business metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'"",
        ""'DIGITAL'"",
        ""'PROGRAMMATIC'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'"",
        ""'SUNDRY ADSALES OVERLAY'""
      ],
      ""governance_issues"": [
        ""Hardcoded categories should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_encoded_sum"",
      ""metric_name"": ""Revenue Type Encoded Sum"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""revenue_group_subtype""
      ],
      ""business_description"": ""A sum of encoded integer values representing `revenue_group_subtype` categories."",
      ""sql_logic"": ""SUM(CASE WHEN (UPPER(revenue_group_subtype) = 'PRINT') THEN 1 WHEN (UPPER(revenue_group_subtype) = 'DIGITAL') THEN 2 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC') THEN 3 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC EXCHANGE') THEN 4 WHEN (UPPER(revenue_group_subtype) = 'PROGRAMMATIC SOURCE') THEN 5 WHEN (UPPER(revenue_group_subtype) = 'SUNDRY ADSALES OVERLAY') THEN 6 ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Similar to `revenue_type_encoded_count`, likely for internal Looker Studio ordering or aggregation, not a direct business metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'"",
        ""'DIGITAL'"",
        ""'PROGRAMMATIC'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'"",
        ""'SUNDRY ADSALES OVERLAY'""
      ],
      ""governance_issues"": [
        ""Hardcoded categories should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_revenue_current_fy_k"",
      ""related_metrics"": [
        ""gross_revenue_current_fy""
      ],
      ""relationship_description"": ""Gross Revenue (Current FY, '000) is derived by dividing Gross Revenue (Current FY) by 1000."",
      ""mathematical_formula"": ""gross_revenue_current_fy_k = gross_revenue_current_fy / 1000"",
      ""business_validation"": ""This relationship ensures that the metric is presented in thousands for readability, assuming the base currency is in units."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_current_fy_k * 1000) = SUM(gross_revenue_current_fy) FROM primary_analysis_sql_output;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_revenue_next_fy_k"",
      ""related_metrics"": [
        ""gross_revenue_next_fy""
      ],
      ""relationship_description"": ""Gross Revenue (Next FY, '000) is derived by dividing Gross Revenue (Next FY) by 1000."",
      ""mathematical_formula"": ""gross_revenue_next_fy_k = gross_revenue_next_fy / 1000"",
      ""business_validation"": ""This relationship ensures that the metric is presented in thousands for readability, assuming the base currency is in units."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_next_fy_k * 1000) = SUM(gross_revenue_next_fy) FROM primary_analysis_sql_output;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gross_revenue_conditional_k"",
      ""related_metrics"": [
        ""total_gross_revenue"",
        ""relative_fy_year_offset"",
        ""unified_publication_name"",
        ""revenue_type"",
        ""revenue_group_subtype"",
        ""sales_segment_l_2_name_sync"",
        ""advertiser_parent"",
        ""booking_line_created_date"",
        ""fix_date_lod""
      ],
      ""relationship_description"": ""This metric's calculation is highly conditional, depending on multiple dimensions and a complex date logic involving `fix_date_lod` and `booking_line_created_date` relative to a hardcoded date and `advertiser_parent`."",
      ""mathematical_formula"": ""Conditional sum of gross_revenue_amount / 1000 based on publication type OR a complex date comparison involving DoubleClick and booking dates."",
      ""business_validation"": ""This indicates a specific business rule for a particular revenue stream (e.g., programmatic or digital revenue) that needs careful validation and understanding of its purpose."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_conditional_k) FROM primary_analysis_sql_output WHERE unified_publication_name IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE') AND relative_fy_year_offset = 0;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""style_name"",
        ""source_publishing_division_name"",
        ""publication_name"",
        ""advertiser_id_src"",
        ""ad_type_name""
      ],
      ""relationship_description"": ""All gross revenue metrics are filtered by specific transaction statuses ('BILLED', 'BOOKED'), exclusion of 'ROP COMPOSITE' style, exclusion of 'MEDIUM RARE CONTENT AGENCY' division, and a complex rule for 'SUDDENLY' publications."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""These filters define the scope of 'reportable' revenue, ensuring only relevant transactions are included in performance metrics. Any changes to these filters will directly impact reported revenue figures."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.adsales_revenue_performance_daily` WHERE UPPER(IFNULL(revenue_transaction_status_code, 'XXX')) NOT IN ('BILLED', 'BOOKED'); -- Should return 0 or very few records if filter is effective"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,2
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a1b901e6-c4fb-44bc-955a-3a7070c15829"",
    ""dashboard_name"": ""Revenue Movement"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_date"",
      ""financial_year"",
      ""advertiser_parent"",
      ""portfolio_parent_group_name_sync"",
      ""revenue_type"",
      ""revenue_category""
    ],
    ""date_range_detected"": ""29/05/2025 to 23/06/2025"",
    ""hardcoded_dates_found"": [
      ""29/05/2025"",
      ""23/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'2025'"",
      ""'Y'"",
      ""'Nah'"",
      ""'DIGITAL OTHER'"",
      ""'PRO'"",
      ""'DIGITAL'"",
      ""'SUNDRY'"",
      ""'PRINT'"",
      ""'CONSORTIUM SA'"",
      ""'DIRECT SA WA'"",
      ""'CONSORTIUM NSW'"",
      ""'QLD IA C2'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""revenue categories should use a lookup table"",
      ""portfolio names should use a hierarchy/lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.GROSS_AMOUNT_DIFF,\n    t0.advertiser_group,\n    t0.advertiser_parent,\n    t0.booking_line_id,\n    t0.booking_number,\n    t0.financial_short_month,\n    t0.financial_year,\n    t0.movement_date,\n    t0.portfolio_group_name_sync,\n    t0.portfolio_parent_group_name_sync,\n    t0.portfolio_conformed_name_sync,\n    t0.revenue_sub_type,\n    t0.revenue_type,\n    t0.xtend_flag\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  WHERE t0.movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Use relative date for broader analysis\n),\ncalculated_dimensions AS (\n  SELECT\n    GROSS_AMOUNT_DIFF,\n    movement_date,\n    financial_year,\n    financial_short_month,\n    advertiser_group,\n    advertiser_parent,\n    booking_line_id,\n    booking_number,\n    portfolio_group_name_sync,\n    portfolio_parent_group_name_sync,\n    portfolio_conformed_name_sync,\n    revenue_sub_type,\n    revenue_type,\n    xtend_flag,\n    CASE WHEN advertiser_group IS NULL THEN 'Nah' ELSE advertiser_group END AS advertiser_group_or_nah,\n    PARSE_DATE('%Y-%b-%d', CONCAT(financial_year,'-',financial_short_month,'-1')) AS financial_date_parsed,\n    (portfolio_parent_group_name_sync = 'DIGITAL OTHER') AS is_digital_other_parent,\n    SAFE.LEFT(revenue_sub_type, 6) AS revenue_sub_type_prefix_6,\n    SAFE.LEFT(revenue_sub_type, 3) AS revenue_sub_type_prefix_3,\n    (revenue_sub_type = 'DIGITAL') AS is_revenue_sub_type_digital,\n    (SAFE.LEFT(revenue_sub_type, 3) = 'PRO') AS is_pro_prefix,\n    ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL')) AS is_digital_other_and_digital_sub_type,\n    CASE\n      WHEN xtend_flag = 'Y' THEN 'XTEND'\n      WHEN (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'\n      WHEN revenue_sub_type = 'DIGITAL' THEN 'ADPT DIGITAL'\n      WHEN SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' THEN 'SUNDRY'\n      ELSE revenue_sub_type\n    END AS revenue_category\n  FROM base_data\n)\nSELECT\n  movement_date,\n  financial_year,\n  financial_date_parsed,\n  advertiser_parent,\n  advertiser_group_or_nah,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_type,\n  revenue_sub_type,\n  revenue_category,\n  SUM(GROSS_AMOUNT_DIFF) AS gross_amount_diff_total,\n  SUM(CASE WHEN revenue_type = 'DIGITAL' THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS digital_revenue,\n  SUM(CASE WHEN revenue_type = 'PRINT' THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS print_revenue\nFROM calculated_dimensions\nGROUP BY\n  movement_date,\n  financial_year,\n  financial_date_parsed,\n  advertiser_parent,\n  advertiser_group_or_nah,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_type,\n  revenue_sub_type,\n  revenue_category\nORDER BY movement_date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT movement_date) as unique_movement_dates,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT portfolio_parent_group_name_sync) as unique_portfolio_parent_groups,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  MIN(movement_date) as earliest_movement_date,\n  MAX(movement_date) as latest_movement_date,\n  APPROX_COUNT_DISTINCT(booking_line_id) as approx_unique_booking_line_ids\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(GROSS_AMOUNT_DIFF) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as gross_amount_diff_test,\n  CASE WHEN COUNT(DISTINCT movement_date) > 0 THEN 'PASS' ELSE 'FAIL' END as movement_date_freshness_test,\n  CASE WHEN COUNT(DISTINCT advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_parent_presence_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH base_data AS (\n  SELECT\n    t0.GROSS_AMOUNT_DIFF,\n    t0.advertiser_group,\n    t0.advertiser_parent,\n    t0.financial_short_month,\n    t0.financial_year,\n    t0.movement_date,\n    t0.portfolio_group_name_sync,\n    t0.portfolio_parent_group_name_sync,\n    t0.revenue_sub_type,\n    t0.revenue_type,\n    t0.xtend_flag\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  WHERE t0.movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Category Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE\n    WHEN (xtend_flag = 'Y' AND revenue_category = 'XTEND') THEN 1\n    WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) AND revenue_category = 'PROGRAMMATIC') THEN 1\n    WHEN (revenue_sub_type = 'DIGITAL' AND revenue_category = 'ADPT DIGITAL') THEN 1\n    WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' AND revenue_category = 'SUNDRY') THEN 1\n    WHEN (NOT (xtend_flag = 'Y' OR (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) OR revenue_sub_type = 'DIGITAL' OR SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') AND revenue_category = revenue_sub_type) THEN 1\n    ELSE 0\n  END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE\n    WHEN (xtend_flag = 'Y' AND revenue_category = 'XTEND') THEN 1\n    WHEN ((SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) AND revenue_category = 'PROGRAMMATIC') THEN 1\n    WHEN (revenue_sub_type = 'DIGITAL' AND revenue_category = 'ADPT DIGITAL') THEN 1\n    WHEN (SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' AND revenue_category = 'SUNDRY') THEN 1\n    WHEN (NOT (xtend_flag = 'Y' OR (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) OR revenue_sub_type = 'DIGITAL' OR SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY') AND revenue_category = revenue_sub_type) THEN 1\n    ELSE 0\n  END), COUNT(*)) * 100 as pass_rate_percentage\nFROM (\n  SELECT\n    *,\n    CASE\n      WHEN xtend_flag = 'Y' THEN 'XTEND'\n      WHEN (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'\n      WHEN revenue_sub_type = 'DIGITAL' THEN 'ADPT DIGITAL'\n      WHEN SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' THEN 'SUNDRY'\n      ELSE revenue_sub_type\n    END AS revenue_category\n  FROM base_data\n) subquery;"",
    ""sample_data_sql"": ""SELECT\n  GROSS_AMOUNT_DIFF,\n  advertiser_group,\n  advertiser_parent,\n  booking_line_id,\n  booking_number,\n  financial_short_month,\n  financial_year,\n  movement_date,\n  portfolio_group_name_sync,\n  portfolio_parent_group_name_sync,\n  portfolio_conformed_name_sync,\n  revenue_sub_type,\n  revenue_type,\n  xtend_flag\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY movement_date DESC, GROSS_AMOUNT_DIFF DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""29/05/2025"",
          ""original_format"": ""2025-05-29"",
          ""context"": ""Used as a fixed date filter for movement_date in Query 1."",
          ""suggested_fix"": ""Replace with a dashboard date parameter (e.g., @start_date, @end_date) or relative date functions (e.g., CURRENT_DATE())."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""23/06/2025"",
          ""original_format"": ""2025-06-23"",
          ""context"": ""Used as a fixed date filter for movement_date in Query 2."",
          ""suggested_fix"": ""Replace with a dashboard date parameter (e.g., @start_date, @end_date) or relative date functions (e.g., CURRENT_DATE())."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Y'"",
            ""'PRO'"",
            ""'DIGITAL OTHER'"",
            ""'DIGITAL'"",
            ""'SUNDRY'""
          ],
          ""context"": ""Logic for 'revenue_category' dimension is hardcoded within a CASE statement, defining 'XTEND', 'PROGRAMMATIC', 'ADPT DIGITAL', 'SUNDRY' categories."",
          ""suggested_governance"": ""Move these business rules and their corresponding values to a governed lookup table (e.g., `revenue_category_rules`) that can be joined to, allowing for easier updates and transparency."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Nah'"",
            ""'DIGITAL'"",
            ""'PRINT'""
          ],
          ""context"": ""Default value for NULL advertiser_group ('Nah') and specific revenue_type values ('DIGITAL', 'PRINT') used in calculations."",
          ""suggested_governance"": ""For 'Nah', consider if this should be a standard 'Unknown' or 'N/A' value. For 'DIGITAL'/'PRINT', if these are part of a larger set of revenue types, ensure they are consistent with a `revenue_type_master` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM SA'"",
            ""'DIRECT SA WA'"",
            ""'CONSORTIUM NSW'"",
            ""'QLD IA C2'""
          ],
          ""context"": ""Specific portfolio parent group names and conformed names used as filters."",
          ""suggested_governance"": ""These portfolio names should be managed in a `portfolio_hierarchy` or `portfolio_master` table, allowing for dynamic filtering and consistent naming across reports."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""'2025'""
          ],
          ""context"": ""Fixed financial year filter."",
          ""suggested_governance"": ""Replace with a parameter or relative year calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with dashboard date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Externalize business rules for 'revenue_category' into a configuration table to allow for flexible updates without modifying SQL."",
      ""Manage portfolio names and other categorical filters in governed reference tables to ensure consistency and maintainability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_amount_diff_total"",
      ""metric_name"": ""Total Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross amount difference, representing the primary revenue or financial movement value."",
      ""sql_logic"": ""SUM(GROSS_AMOUNT_DIFF)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date filter"",
        ""financial_year filter"",
        ""portfolio_parent_group_name_sync filter"",
        ""portfolio_conformed_name_sync filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for tracking revenue movement across various dimensions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in GROSS_AMOUNT_DIFF"",
        ""accuracy depends on source data freshness""
      ]
    },
    {
      ""metric_id"": ""digital_revenue"",
      ""metric_name"": ""Digital Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_amount_diff_total"",
        ""revenue_type""
      ],
      ""business_description"": ""The gross amount difference specifically attributed to 'DIGITAL' revenue types."",
      ""sql_logic"": ""SUM(CASE WHEN revenue_type = 'DIGITAL' THEN GROSS_AMOUNT_DIFF ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date filter"",
        ""financial_year filter"",
        ""portfolio_parent_group_name_sync filter"",
        ""portfolio_conformed_name_sync filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for understanding the contribution of digital channels to overall revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'""
      ],
      ""governance_issues"": [
        ""revenue_type 'DIGITAL' is hardcoded; should ideally come from a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""accuracy depends on correct classification of revenue_type""
      ]
    },
    {
      ""metric_id"": ""print_revenue"",
      ""metric_name"": ""Print Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_amount_diff_total"",
        ""revenue_type""
      ],
      ""business_description"": ""The gross amount difference specifically attributed to 'PRINT' revenue types."",
      ""sql_logic"": ""SUM(CASE WHEN revenue_type = 'PRINT' THEN GROSS_AMOUNT_DIFF ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_date filter"",
        ""financial_year filter"",
        ""portfolio_parent_group_name_sync filter"",
        ""portfolio_conformed_name_sync filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for understanding the contribution of print channels to overall revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PRINT'""
      ],
      ""governance_issues"": [
        ""revenue_type 'PRINT' is hardcoded; should ideally come from a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""accuracy depends on correct classification of revenue_type""
      ]
    },
    {
      ""metric_id"": ""advertiser_group_or_nah"",
      ""metric_name"": ""Advertiser Group (or Nah)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The advertiser group, with 'Nah' replacing NULL values."",
      ""sql_logic"": ""CASE WHEN advertiser_group IS NULL THEN 'Nah' ELSE advertiser_group END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and filtering revenue data by advertiser group, handling missing values."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Nah'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'Nah' value for NULLs; consider standardizing to 'Unknown' or similar.""
      ],
      ""data_quality_concerns"": [
        ""consistency of 'Nah' vs. actual advertiser group names""
      ]
    },
    {
      ""metric_id"": ""financial_date_parsed"",
      ""metric_name"": ""Financial Date Parsed"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A date dimension derived from financial year and short month, typically representing the first day of the financial month."",
      ""sql_logic"": ""PARSE_DATE('%Y-%b-%d', CONCAT(financial_year,'-',financial_short_month,'-1'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Provides a consistent date dimension for financial reporting, useful for monthly aggregations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential parsing errors if financial_year or financial_short_month are malformed""
      ]
    },
    {
      ""metric_id"": ""revenue_category"",
      ""metric_name"": ""Revenue Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""business_description"": ""A custom classification of revenue based on various flags and sub-types, categorizing revenue into 'XTEND', 'PROGRAMMATIC', 'ADPT DIGITAL', 'SUNDRY', or the original revenue sub-type."",
      ""sql_logic"": ""CASE WHEN xtend_flag = 'Y' THEN 'XTEND' WHEN (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC' WHEN revenue_sub_type = 'DIGITAL' THEN 'ADPT DIGITAL' WHEN SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' THEN 'SUNDRY' ELSE revenue_sub_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for high-level business reporting and strategic analysis of revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'PRO'"",
        ""'DIGITAL OTHER'"",
        ""'DIGITAL'"",
        ""'SUNDRY'"",
        ""'XTEND'"",
        ""'PROGRAMMATIC'"",
        ""'ADPT DIGITAL'"",
        ""'SUNDRY'""
      ],
      ""governance_issues"": [
        ""Complex business logic with multiple hardcoded values; highly prone to errors if rules change. Should be externalized to a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""accuracy depends on consistency of input flags/sub-types""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_amount_diff_total"",
      ""related_metrics"": [
        ""digital_revenue"",
        ""print_revenue""
      ],
      ""relationship_description"": ""Digital Revenue and Print Revenue are components of the Total Gross Amount Difference, specifically for records where revenue_type is 'DIGITAL' or 'PRINT' respectively."",
      ""mathematical_formula"": ""gross_amount_diff_total = SUM(digital_revenue) + SUM(print_revenue) + SUM(other_revenue_types)"",
      ""business_validation"": ""Ensures that the sum of specific revenue types (Digital, Print) contributes correctly to the overall gross amount difference, allowing for breakdown analysis."",
      ""validation_sql"": ""SELECT\n  SUM(gross_amount_diff_total) AS total_gross_amount,\n  SUM(digital_revenue) AS total_digital_revenue,\n  SUM(print_revenue) AS total_print_revenue,\n  SUM(gross_amount_diff_total) - SUM(digital_revenue) - SUM(print_revenue) AS total_other_revenue\nFROM (\n  SELECT\n    GROSS_AMOUNT_DIFF AS gross_amount_diff_total,\n    CASE WHEN revenue_type = 'DIGITAL' THEN GROSS_AMOUNT_DIFF ELSE 0 END AS digital_revenue,\n    CASE WHEN revenue_type = 'PRINT' THEN GROSS_AMOUNT_DIFF ELSE 0 END AS print_revenue\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\n  WHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\n) subquery;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_category"",
      ""related_metrics"": [
        ""xtend_flag"",
        ""revenue_sub_type"",
        ""portfolio_parent_group_name_sync""
      ],
      ""relationship_description"": ""The 'Revenue Category' dimension is a derived field whose value depends on the values of 'xtend_flag', 'revenue_sub_type', and 'portfolio_parent_group_name_sync' through a complex CASE statement."",
      ""mathematical_formula"": ""N/A (conditional logic)"",
      ""business_validation"": ""This relationship defines how raw data attributes are transformed into a higher-level business classification, critical for aggregated reporting and strategic insights."",
      ""validation_sql"": ""SELECT\n  xtend_flag,\n  revenue_sub_type,\n  portfolio_parent_group_name_sync,\n  CASE\n    WHEN xtend_flag = 'Y' THEN 'XTEND'\n    WHEN (SAFE.LEFT(revenue_sub_type, 3) = 'PRO' OR ((portfolio_parent_group_name_sync = 'DIGITAL OTHER') AND (revenue_sub_type = 'DIGITAL'))) THEN 'PROGRAMMATIC'\n    WHEN revenue_sub_type = 'DIGITAL' THEN 'ADPT DIGITAL'\n    WHEN SAFE.LEFT(revenue_sub_type, 6) = 'SUNDRY' THEN 'SUNDRY'\n    ELSE revenue_sub_type\n  END AS calculated_revenue_category,\n  COUNT(*) as record_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nGROUP BY 1, 2, 3, 4\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,3
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e83da1de-4227-43e6-bcc6-73051c66914b"",
    ""dashboard_name"": ""Ad Events Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_year"",
      ""fy_year_month_number"",
      ""financial_short_month"",
      ""revenue_transaction_status"",
      ""adsize_name"",
      ""booking_name"",
      ""ad_size_category""
    ],
    ""date_range_detected"": ""Fiscal Year relative offset (-1, 0, 1) and hardcoded '2025'"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202501"",
      ""202502"",
      ""202503""
    ],
    ""hardcoded_values_found"": [
      ""'Future Bradfield 2024'"",
      ""'Sydney & Brisbane Future Series'"",
      ""'Future Bradfield FY25 B1'"",
      ""'Future Sydney Bradfield 2024'"",
      ""'event sponsorship'"",
      ""'production'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""booking names should use a lookup table"",
      ""ad size categories should be defined in a configuration table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates all key metrics and dimensions from the dashboard's queries.\n-- It uses relative fiscal year filtering and includes all derived fields.\nWITH base_ad_data AS (\n  SELECT\n    t0.advertiser_name,\n    t0.booking_number,\n    t0.booking_name,\n    t0.regexp_extract(t0.booking_name, r'^[^ _]+') AS booking_name_1st_keyword,\n    t0.sort_caption,\n    t0.adsize_name,\n    t0.classification_name,\n    t0.revenue_type,\n    t0.revenue_group_subtype,\n    t0.financial_year,\n    t0.fy_year_month_number,\n    t0.financial_short_month,\n    t0.revenue_transaction_status,\n    t0.record_type_code,\n    t0.gross_revenue_amount, -- This is already a sum from the underlying view\n    t0.net_revenue,         -- This is already a sum from the underlying view\n    -- Derived Ad Size Category\n    CASE\n      WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(t0.adsize_name AS STRING)), '^(.*event sponsorship.*)$') THEN 'Sponsorship'\n      WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(t0.adsize_name AS STRING)), '^(.*production.*)$') THEN 'Production'\n      ELSE 'Media'\n    END AS ad_size_category\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.relative_fy_year_offset IN (-1, 0, 1) -- Filter for current, previous, and next fiscal year\n)\nSELECT\n  financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  revenue_transaction_status,\n  ad_size_category,\n  booking_name,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(net_revenue) AS total_net_revenue,\n  COUNT(DISTINCT booking_name) AS unique_bookings,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers\nFROM\n  base_ad_data\n-- Example filters for specific analysis, can be parameterized or removed for full dataset\n-- WHERE\n--   financial_year = '2025' -- Example: Filter for a specific financial year\n--   AND fy_year_month_number BETWEEN 202501 AND 202503 -- Example: Specific months from one of the original queries\n--   AND booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series') -- Example: Specific booking names\nGROUP BY\n  financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  revenue_transaction_status,\n  ad_size_category,\n  booking_name\nORDER BY\n  financial_year DESC, fy_year_month_number DESC\nLIMIT 10000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT financial_year) AS unique_financial_years,\n  COUNT(DISTINCT fy_year_month_number) AS unique_fy_months,\n  COUNT(DISTINCT revenue_transaction_status) AS unique_transaction_statuses,\n  COUNT(DISTINCT adsize_name) AS unique_ad_sizes,\n  COUNT(DISTINCT booking_name) AS unique_booking_names,\n  MIN(financial_year) AS earliest_financial_year,\n  MAX(financial_year) AS latest_financial_year,\n  MIN(fy_year_month_number) AS earliest_fy_month_number,\n  MAX(fy_year_month_number) AS latest_fy_month_number,\n  SUM(gross_revenue_amount) AS total_gross_revenue_sample,\n  SUM(net_revenue) AS total_net_revenue_sample\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1) -- Focus on the relevant fiscal years\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT revenue_transaction_status) > 0 THEN 'PASS' ELSE 'FAIL' END AS transaction_status_test,\n  CASE WHEN MAX(financial_year) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS financial_year_freshness_test,\n  COUNT(*) AS records_in_sample\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset = 0 -- Focus on current fiscal year for freshness\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nWITH ad_data AS (\n  SELECT\n    adsize_name,\n    booking_name,\n    financial_year,\n    fy_year_month_number,\n    gross_revenue_amount,\n    -- Re-create the ad_size_category logic\n    CASE\n      WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$') THEN 'Sponsorship'\n      WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$') THEN 'Production'\n      ELSE 'Media'\n    END AS ad_size_category\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1)\n)\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Ad Size Category Distribution' AS rule_name,\n  ad_size_category,\n  COUNT(*) AS records_count,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SAFE_DIVIDE(SUM(gross_revenue_amount), (SELECT SUM(gross_revenue_amount) FROM ad_data)) * 100 AS percentage_of_total_revenue\nFROM\n  ad_data\nGROUP BY\n  ad_size_category\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Hardcoded Booking Names Revenue' AS rule_name,\n  booking_name,\n  COUNT(*) AS records_count,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SAFE_DIVIDE(SUM(gross_revenue_amount), (SELECT SUM(gross_revenue_amount) FROM ad_data WHERE financial_year = '2025')) * 100 AS percentage_of_2025_revenue\nFROM\n  ad_data\nWHERE\n  financial_year = '2025'\n  AND booking_name IN ('Future Bradfield 2024', 'Sydney & Brisbane Future Series', 'Future Bradfield FY25 B1', 'Future Sydney Bradfield 2024')\nGROUP BY\n  booking_name\nORDER BY\n  validation_type, rule_name, total_gross_revenue DESC;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  advertiser_name,\n  booking_name,\n  adsize_name,\n  financial_year,\n  fy_year_month_number,\n  financial_short_month,\n  revenue_transaction_status,\n  gross_revenue_amount,\n  net_revenue,\n  relative_fy_year_offset\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1) -- Focus on relevant fiscal years\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  financial_year DESC, fy_year_month_number DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter"",
          ""suggested_fix"": ""replace with a parameter or relative fiscal year calculation (e.g., based on CURRENT_DATE() and fiscal year start rules)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202501"",
          ""original_format"": ""202501"",
          ""context"": ""fy_year_month_number filter"",
          ""suggested_fix"": ""replace with a parameter or relative fiscal month calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202502"",
          ""original_format"": ""202502"",
          ""context"": ""fy_year_month_number filter"",
          ""suggested_fix"": ""replace with a parameter or relative fiscal month calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202503"",
          ""original_format"": ""202503"",
          ""context"": ""fy_year_month_number filter"",
          ""suggested_fix"": ""replace with a parameter or relative fiscal month calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'^(.*event sponsorship.*)$'"",
            ""'^(.*production.*)$'""
          ],
          ""context"": ""ad_size_category derivation based on adsize_name"",
          ""suggested_governance"": ""define ad size categories in a lookup table or configuration table, join to it"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Future Bradfield 2024'"",
            ""'Sydney & Brisbane Future Series'"",
            ""'Future Bradfield FY25 B1'"",
            ""'Future Sydney Bradfield 2024'""
          ],
          ""context"": ""booking_name filter"",
          ""suggested_governance"": ""define specific booking names/campaigns in a lookup table, join to it or allow user selection via parameters"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., for fiscal year/month selection)."",
      ""Replace hardcoded lookup values for booking names with joins to governed reference tables or allow user selection via parameters."",
      ""Use configuration tables for ad size category business rules instead of hardcoded regex in CASE statements.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for an advertising booking, as aggregated in the base view."",
      ""sql_logic"": ""sum(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""net_revenue_base"",
      ""metric_name"": ""Net Revenue (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw net revenue amount for an advertising booking, as aggregated in the base view."",
      ""sql_logic"": ""sum(net_revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for profitability analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""business_description"": ""The sum of gross revenue amounts for advertising bookings, often filtered by financial year, month, or transaction status."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year IN ('2025')"",
        ""fy_year_month_number IN (202501, 202502, 202503)"",
        ""booking_name IN ('Future Bradfield 2024', ...)""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary revenue metric for ad sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""202501"",
        ""202502"",
        ""202503""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Future Bradfield 2024'"",
        ""'Sydney & Brisbane Future Series'"",
        ""'Future Bradfield FY25 B1'"",
        ""'Future Sydney Bradfield 2024'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""ad_size_category"",
      ""metric_name"": ""Ad Size Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""adsize_name""
      ],
      ""business_description"": ""Categorizes ad sizes into 'Sponsorship', 'Production', or 'Media' based on keywords in the adsize_name."",
      ""sql_logic"": ""CASE WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$')) THEN 'Sponsorship' WHEN (SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$')) THEN 'Production' ELSE 'Media' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze revenue by type of ad event/production."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'event sponsorship'"",
        ""'production'""
      ],
      ""governance_issues"": [
        ""business rules should be defined in a configuration table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year of the advertising booking."",
      ""sql_logic"": ""financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year_month_number"",
      ""metric_name"": ""Financial Year Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year and month number combined (e.g., 202501 for Jan 2025)."",
      ""sql_logic"": ""fy_year_month_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""fy_year_month_number IN (202501, 202502, 202503)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Granular time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202501"",
        ""202502"",
        ""202503""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Jan', 'Feb')."",
      ""sql_logic"": ""financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Display dimension for monthly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The status of the revenue transaction (e.g., 'Actual', 'Forecast')."",
      ""sql_logic"": ""revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue by its current state."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_name"",
      ""metric_name"": ""Booking Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertising booking."",
      ""sql_logic"": ""booking_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""booking_name IN ('Future Bradfield 2024', ...)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter and group revenue by specific campaigns or projects."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Future Bradfield 2024'"",
        ""'Sydney & Brisbane Future Series'"",
        ""'Future Bradfield FY25 B1'"",
        ""'Future Sydney Bradfield 2024'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount_base""
      ],
      ""relationship_description"": ""Total Gross Revenue is the sum of the base Gross Revenue Amount."",
      ""mathematical_formula"": ""Total Gross Revenue = SUM(Gross Revenue Amount (Base))"",
      ""business_validation"": ""Ensures that the aggregated revenue correctly reflects the sum of individual revenue entries."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE relative_fy_year_offset IN (-1, 0, 1)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""ad_size_category"",
      ""related_metrics"": [
        ""adsize_name""
      ],
      ""relationship_description"": ""Ad Size Category is a derived dimension based on pattern matching within the adsize_name."",
      ""mathematical_formula"": ""N/A (conditional logic)"",
      ""business_validation"": ""Categorizes ad bookings for high-level analysis, ensuring consistent grouping of ad types."",
      ""validation_sql"": ""SELECT adsize_name, CASE WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*event sponsorship.*)$') THEN 'Sponsorship' WHEN SAFE.REGEXP_CONTAINS(LOWER(SAFE_CAST(adsize_name AS STRING)), '^(.*production.*)$') THEN 'Production' ELSE 'Media' END AS derived_category FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue"",
      ""related_metrics"": [
        ""financial_year"",
        ""fy_year_month_number"",
        ""revenue_transaction_status"",
        ""booking_name"",
        ""ad_size_category""
      ],
      ""relationship_description"": ""Total Gross Revenue is frequently filtered and grouped by these dimensions to provide specific business insights."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows slicing and dicing of revenue data by time, status, specific campaigns, and ad types."",
      ""validation_sql"": ""SELECT financial_year, SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE financial_year = '2025' GROUP BY 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,4
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""52dd1ac1-19b5-4695-a7e6-632ef7a9dba3"",
    ""dashboard_name"": ""Consumer Finance Landing Page"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 2,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""scenario""
    ],
    ""date_range_detected"": null,
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""''""
    ],
    ""governance_opportunities"": [
      ""Investigate the purpose of the hardcoded empty string ('') in dimension selection; if it represents a category, it should be replaced with a meaningful value or a parameter.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  scenario_counts AS (\n    SELECT\n      t0.scenario,\n      COUNT(1) AS count_by_scenario\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n    GROUP BY\n      t0.scenario\n  ),\n  total_records_cte AS (\n    SELECT\n      COUNT(1) AS total_records\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\n  )\nSELECT\n  sc.scenario,\n  sc.count_by_scenario,\n  (SELECT total_records FROM total_records_cte) AS total_records_overall\nFROM\n  scenario_counts sc\nORDER BY\n  sc.count_by_scenario DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT scenario) as unique_scenarios,\n  MIN(scenario) as min_scenario_value,\n  MAX(scenario) as max_scenario_value\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(1) > 0 THEN 'PASS' ELSE 'FAIL' END as data_exists_test,\n  CASE WHEN COUNT(DISTINCT scenario) > 0 THEN 'PASS' ELSE 'FAIL' END as scenario_data_exists_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'No specific business rules identified from provided queries' as rule_name,\n  COUNT(*) as records_tested,\n  COUNT(*) as records_passing_rule,\n  100.0 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.*\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 100;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""''""
          ],
          ""context"": ""An empty string is selected as 'clmn0_' in the first query, likely a Looker Studio internal placeholder."",
          ""suggested_governance"": ""Investigate the purpose of this empty string. If it's meant to represent a category, it should be replaced with a meaningful value or a parameter. If it's a Looker Studio artifact, no action needed."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Investigate the purpose of the hardcoded empty string (`''`) in dimension selection; if it represents a category, it should be replaced with a meaningful value or a parameter.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""scenario"",
      ""metric_name"": ""Scenario"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents different scenarios or categories within digital subscriptions, used for segmentation."",
      ""sql_logic"": ""t0.scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""This dimension allows users to break down subscription data by various predefined scenarios, providing insights into the performance or characteristics of each segment."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in scenario column""
      ]
    },
    {
      ""metric_id"": ""total_records"",
      ""metric_name"": ""Total Records"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of records (e.g., subscriptions) in the digital subscriptions dataset."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides an overall volume count for the dataset, often used as a baseline for data freshness checks or to understand the total scope of the data."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""data freshness dependent""
      ]
    },
    {
      ""metric_id"": ""count_by_scenario"",
      ""metric_name"": ""Count by Scenario"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""scenario""
      ],
      ""business_description"": ""The number of digital subscriptions associated with each specific scenario."",
      ""sql_logic"": ""COUNT(1) GROUP BY t0.scenario"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""This metric is crucial for understanding the distribution and popularity of different subscription scenarios, helping to identify key segments or areas of focus."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""data freshness dependent""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_records"",
      ""related_metrics"": [
        ""count_by_scenario""
      ],
      ""relationship_description"": ""The sum of 'Count by Scenario' across all distinct scenarios should equal the 'Total Records' in the dataset."",
      ""mathematical_formula"": ""SUM(count_by_scenario) = total_records"",
      ""business_validation"": ""Ensures data consistency and that all records are correctly categorized and accounted for within the scenario breakdown."",
      ""validation_sql"": ""WITH\n  scenario_sum AS (\n    SELECT\n      SUM(count_by_scenario) AS sum_of_scenario_counts\n    FROM (\n      SELECT\n        COUNT(1) AS count_by_scenario\n      FROM\n        `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\n      GROUP BY\n        scenario\n    )\n  ),\n  total_records_cte AS (\n    SELECT\n      COUNT(1) AS total_records\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions`\n  )\nSELECT\n  'Consistency Check: Sum of Scenarios vs. Total Records' AS check_name,\n  ss.sum_of_scenario_counts,\n  tr.total_records,\n  CASE\n    WHEN ss.sum_of_scenario_counts = tr.total_records THEN 'PASS'\n    ELSE 'FAIL'\n  END AS consistency_status\nFROM\n  scenario_sum ss,\n  total_records_cte tr;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,5
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""601ed0d2-e944-4189-8170-d593c8e72026"",
    ""dashboard_name"": ""Adex"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""date"",
      ""Advertiser"",
      ""Major_Category"",
      ""Media_Network"",
      ""Category"",
      ""Sub_Category"",
      ""portfolio_parent_group_name"",
      ""calendar_year"",
      ""calendar_month_short_name"",
      ""financial_year"",
      ""time_period_type"",
      ""quarter_period"",
      ""year_month_key""
    ],
    ""date_range_detected"": ""Dynamic (relative to latest_date in data, typically last 2 years for 'Rolling 12 months' and 'ly' comparison)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Rolling 12 months'"",
      ""'Calendar Year'"",
      ""'Financial Year'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""'ty'"",
      ""'ly'"",
      ""'NEWS CORP'"",
      ""'youtube'"",
      ""'facebook'"",
      ""'KEY ACCOUNTS TRAVEL'"",
      ""'NT Dept Of Trade Business & Innovation'"",
      ""'NT Dept Of Chief Minister'"",
      ""'NT Dept Of Infrastructure Planning & Logistics'"",
      ""'NT Dept Of Industry Tourism & Trade'"",
      ""'NT Dept Of Education Employment & Training'"",
      ""'NT Dept Of Tourism & Culture'"",
      ""'NT Dept Of Transport'"",
      ""'NT Dept Of Attorney-General & Justice'"",
      ""'NT Dept Of Environment & Natural Resources'"",
      ""'NT Dept Of Lands Planning & The Environment'"",
      ""'NT Dept Of Health'"",
      ""'NT Dept Of Police Fire & Emergency Services'"",
      ""'NT Dept Of Business'"",
      ""'NT Dept Of Territory Families, Housing & Communities'"",
      ""'NT Dept Of Primary Industry & Resources'"",
      ""'NT Dept Of Environment Parks & Water Security'"",
      ""'NT Dept Of Corporate & Information Services'"",
      ""'$'"",
      ""'$\\'000'""
    ],
    ""governance_opportunities"": [
      ""Time period selection (e.g., 'Rolling 12 months') should be a dashboard parameter to allow dynamic selection."",
      ""Quarter definitions should be derived from a robust date dimension table or a governed business rule configuration instead of hardcoded month ranges."",
      ""Media Network names ('NEWS CORP', 'youtube', 'facebook') should be managed via a lookup table for consistency and ease of maintenance."",
      ""Advertiser names (e.g., 'NT Dept Of...') should be dynamically filtered or managed via a lookup table/parameter for flexible reporting."",
      ""Display format ('$' vs '$\\'000') should be handled by the visualization layer (Looker Studio's formatting options), not hardcoded in SQL."",
      ""The `fixed_publisher_count` and similar `fixed_` metrics are pre-aggregated and cross-joined, which might indicate a need for a pre-aggregated summary table or a more efficient window function approach if not already optimized for performance.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      source = 'Adex'\n  ),\n  union_table AS (\n    SELECT\n      *\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n  ),\n  TEMP1 AS (\n    SELECT\n      *,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      union_table\n      CROSS JOIN\n      (\n        SELECT\n          MAX(date) AS latest_date\n        FROM\n          adex_data\n      )\n      CROSS JOIN\n      (\n        SELECT\n          MAX(financial_year) AS max_fin_year\n        FROM\n          adex_data\n      )\n  ),\n  TEMP2 AS (\n    SELECT\n      *,\n      -- The @time_period is hardcoded to 'Rolling 12 months' in the outer queries\n      -- This should be a parameter in a governed setup\n      CASE 'Rolling 12 months'\n        WHEN 'Rolling 12 months' THEN\n        CASE\n          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'\n          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Calendar Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Financial Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'\n          ELSE NULL\n        END\n        ELSE NULL\n      END AS ty_ly_embed\n    FROM\n      TEMP1\n  ),\n  fixed_global_counts AS (\n    SELECT\n      COUNT(DISTINCT portfolio_parent_group_name) AS fixed_ppg_count,\n      COUNT(DISTINCT sales_segment_gm_name) AS fixed_gm_count,\n      COUNT(DISTINCT portfolio_group_name) AS fixed_pg_count,\n      COUNT(DISTINCT portfolio_conformed_name) AS fixed_portfolio_count,\n      COUNT(DISTINCT media_network) AS fixed_publisher_count\n    FROM\n      TEMP1\n  ),\n  pre_aggregated_data AS (\n    SELECT\n      t2.*,\n      fc.fixed_publisher_count,\n      -- Calculate quarter based on calendar_month_short_name (as per clmn55_ in Q1)\n      CASE\n        WHEN calendar_month_short_name IN ('Jan', 'Feb', 'Mar') THEN 'Q1'\n        WHEN calendar_month_short_name IN ('Apr', 'May', 'Jun') THEN 'Q2'\n        WHEN calendar_month_short_name IN ('Jul', 'Aug', 'Sep') THEN 'Q3'\n        WHEN calendar_month_short_name IN ('Oct', 'Nov', 'Dec') THEN 'Q4'\n        ELSE NULL\n      END AS calendar_quarter,\n      -- YearMonth key (clmn40_ in Q1)\n      (CAST(calendar_year AS FLOAT64)*100) + \n        CASE calendar_month_short_name\n          WHEN 'Jan' THEN 1 WHEN 'Feb' THEN 2 WHEN 'Mar' THEN 3 WHEN 'Apr' THEN 4 WHEN 'May' THEN 5 WHEN 'Jun' THEN 6\n          WHEN 'Jul' THEN 7 WHEN 'Aug' THEN 8 WHEN 'Sep' THEN 9 WHEN 'Oct' THEN 10 WHEN 'Nov' THEN 11 WHEN 'Dec' THEN 12\n          ELSE NULL\n        END AS year_month_key,\n      EXTRACT(MONTH FROM TIMESTAMP(date)) AS month_of_date_num,\n      -- Spend in thousands\n      SAFE_DIVIDE(Spend, 1000) AS spend_k\n    FROM\n      TEMP2 t2\n      CROSS JOIN fixed_global_counts fc\n  )\nSELECT\n  date,\n  Advertiser,\n  Major_Category,\n  Media_Network,\n  Category,\n  Sub_Category,\n  portfolio_parent_group_name,\n  calendar_year,\n  calendar_month_short_name,\n  financial_year,\n  latest_date,\n  max_fin_year,\n  ty_ly_embed AS time_period_type,\n  calendar_quarter AS quarter_period,\n  year_month_key,\n  month_of_date_num,\n  -- Metrics\n  spend_k AS spend_in_thousands,\n  CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END AS total_spend_ty_k,\n  CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END AS total_spend_ly_k,\n  CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END AS news_corp_spend_ty_k,\n  CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END AS news_corp_spend_ly_k,\n  CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'youtube' THEN spend_k ELSE 0 END AS youtube_spend_ty_k,\n  CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'facebook' THEN spend_k ELSE 0 END AS facebook_spend_ty_k,\n  fixed_publisher_count AS overall_fixed_publisher_count\nFROM\n  pre_aggregated_data\nWHERE\n  date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR) -- Sample for analysis, can be adjusted for full dashboard load\nORDER BY\n  date DESC\nLIMIT 100000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT date) as unique_dates,\n  COUNT(DISTINCT Advertiser) as unique_advertisers,\n  COUNT(DISTINCT Media_Network) as unique_media_networks,\n  COUNT(DISTINCT Major_Category) as unique_major_categories,\n  MIN(date) as earliest_date,\n  MAX(date) as latest_date,\n  APPROX_COUNT_DISTINCT(CONCAT(CAST(date AS STRING), Advertiser, Media_Network, Spend)) as approx_unique_rows_at_grain\nFROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(Spend) > 0 THEN 'PASS' ELSE 'FAIL' END as total_spend_check,\n  CASE WHEN COUNT(DISTINCT Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_advertiser_check,\n  CASE WHEN MAX(date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_check\nFROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      source = 'Adex'\n  ),\n  TEMP1 AS (\n    SELECT\n      *,\n      (SELECT MAX(date) FROM adex_data) AS latest_date,\n      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year\n    FROM\n      adex_data\n  )\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Rolling 12 Months TY/LY Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 1 ELSE 0 END) as records_in_ty_period,\n  SUM(CASE WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 1 ELSE 0 END) as records_in_ly_period,\n  SUM(CASE WHEN Spend IS NULL THEN 1 ELSE 0 END) as null_spend_records,\n  SUM(CASE WHEN Media_Network = 'NEWS CORP' AND Spend IS NOT NULL THEN 1 ELSE 0 END) as news_corp_spend_records\nFROM TEMP1\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);"",
    ""sample_data_sql"": ""SELECT \n  date,\n  Advertiser,\n  Major_Category,\n  Media_Network,\n  Category,\n  Sub_Category,\n  Spend,\n  portfolio_parent_group_name,\n  financial_year,\n  account_number\nFROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND Spend IS NOT NULL\nORDER BY date DESC, Spend DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'NEWS CORP'"",
            ""'youtube'"",
            ""'facebook'""
          ],
          ""context"": ""Media Network names used in conditional spend calculations."",
          ""suggested_governance"": ""These media network names should be managed in a reference table (e.g., `dim_media_network`) and joined to the main data for consistent categorization and easier updates."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Q1'"",
            ""'Q2'"",
            ""'Q3'"",
            ""'Q4'""
          ],
          ""context"": ""Quarter definitions based on month numbers."",
          ""suggested_governance"": ""Quarter definitions should be part of a comprehensive date dimension table, allowing for flexible fiscal or calendar quarter definitions without hardcoding logic in every query."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Rolling 12 months'"",
            ""'Calendar Year'"",
            ""'Financial Year'""
          ],
          ""context"": ""Time period selection logic is hardcoded, overriding the `@time_period` variable."",
          ""suggested_governance"": ""This selection should be driven by a dashboard parameter or a configuration table, allowing users to dynamically choose the time period type without modifying the underlying SQL."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'KEY ACCOUNTS TRAVEL'""
          ],
          ""context"": ""Specific `portfolio_parent_group_name` used as a filter."",
          ""suggested_governance"": ""This filter value should be configurable via a dashboard parameter or a lookup table for business units/groups, enabling dynamic filtering."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'NT Dept Of Trade Business & Innovation'"",
            ""'NT Dept Of Chief Minister'"",
            ""'NT Dept Of Infrastructure Planning & Logistics'"",
            ""'NT Dept Of Industry Tourism & Trade'"",
            ""'NT Dept Of Education Employment & Training'"",
            ""'NT Dept Of Tourism & Culture'"",
            ""'NT Dept Of Transport'"",
            ""'NT Dept Of Attorney-General & Justice'"",
            ""'NT Dept Of Environment & Natural Resources'"",
            ""'NT Dept Of Lands Planning & The Environment'"",
            ""'NT Dept Of Health'"",
            ""'NT Dept Of Police Fire & Emergency Services'"",
            ""'NT Dept Of Business'"",
            ""'NT Dept Of Territory Families, Housing & Communities'"",
            ""'NT Dept Of Primary Industry & Resources'"",
            ""'NT Dept Of Environment Parks & Water Security'"",
            ""'NT Dept Of Corporate & Information Services'""
          ],
          ""context"": ""A long list of specific Advertiser names used as a filter."",
          ""suggested_governance"": ""This list should be managed externally, perhaps in a reference table for 'NT Government Departments' or similar, and joined or filtered dynamically via a dashboard parameter."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""'$'"",
            ""'$\\'000'""
          ],
          ""context"": ""Display format logic embedded in SQL."",
          ""suggested_governance"": ""Display formatting (e.g., currency symbols, thousands separators) should be handled by the visualization tool (Looker Studio) and not by the SQL query."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`) to ensure data freshness and dynamic reporting periods."",
      ""Replace hardcoded lookup values (e.g., Media Network names, Advertiser names, time period types) with joins to governed reference tables or dashboard parameters to improve flexibility and maintainability."",
      ""Use configuration tables for business rules (e.g., quarter definitions, time period logic) instead of hardcoded logic within the query to centralize rule management and reduce redundancy.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""spend_in_thousands"",
      ""metric_name"": ""Spend (in '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw advertising spend value, converted to thousands for display."",
      ""sql_logic"": ""SAFE_DIVIDE(Spend, 1000)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base unit for all spend-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential for NULL Spend values handled by CASE WHEN (clmnX_ IS NULL) THEN 0 ELSE clmnX_ END, but SAFE_DIVIDE handles division by zero. Original Spend column quality should be monitored.""]
    },
    {
      ""metric_id"": ""total_spend_ty_k"",
      ""metric_name"": ""Total Spend (This Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type""],
      ""business_description"": ""Total advertising spend for the current selected time period (e.g., Rolling 12 months 'This Year')."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current period advertising activity and revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ty'"", ""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'""],
      ""governance_issues"": [""Time period definition ('Rolling 12 months') is hardcoded and should be parameterized."", ""The 'ty' flag is derived from complex date logic that should be clearly documented and potentially governed.""],
      ""data_quality_concerns"": [""Accuracy depends on the correctness of `latest_date` and `date` columns.""]
    },
    {
      ""metric_id"": ""total_spend_ly_k"",
      ""metric_name"": ""Total Spend (Last Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type""],
      ""business_description"": ""Total advertising spend for the previous selected time period (e.g., Rolling 12 months 'Last Year')."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year or period-over-period comparisons to assess growth or decline."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ly'"", ""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'""],
      ""governance_issues"": [""Time period definition ('Rolling 12 months') is hardcoded and should be parameterized."", ""The 'ly' flag is derived from complex date logic that should be clearly documented and potentially governed.""],
      ""data_quality_concerns"": [""Accuracy depends on the correctness of `latest_date` and `date` columns.""]
    },
    {
      ""metric_id"": ""news_corp_spend_ty_k"",
      ""metric_name"": ""News Corp Spend (This Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type"", ""Media_Network""],
      ""business_description"": ""Advertising spend specifically for 'NEWS CORP' media network for the current selected time period."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures performance of a specific key media network, crucial for internal reporting and strategic analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'"", ""'ty'""],
      ""governance_issues"": [""'NEWS CORP' is hardcoded; should use a lookup table for media networks."", ""Time period definition is hardcoded.""],
      ""data_quality_concerns"": [""Consistency of 'NEWS CORP' string in source data.""]
    },
    {
      ""metric_id"": ""news_corp_spend_ly_k"",
      ""metric_name"": ""News Corp Spend (Last Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type"", ""Media_Network""],
      ""business_description"": ""Advertising spend specifically for 'NEWS CORP' media network for the previous selected time period."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Enables period-over-period comparison for 'NEWS CORP' performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'NEWS CORP'"", ""'ly'""],
      ""governance_issues"": [""'NEWS CORP' is hardcoded; should use a lookup table for media networks."", ""Time period definition is hardcoded.""],
      ""data_quality_concerns"": [""Consistency of 'NEWS CORP' string in source data.""]
    },
    {
      ""metric_id"": ""youtube_spend_ty_k"",
      ""metric_name"": ""YouTube Spend (This Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type"", ""Media_Network""],
      ""business_description"": ""Advertising spend specifically for 'youtube' media network for the current selected time period."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'youtube' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks spend on a specific digital media platform."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'youtube'"", ""'ty'""],
      ""governance_issues"": [""'youtube' is hardcoded; should use a lookup table for media networks."", ""Time period definition is hardcoded.""],
      ""data_quality_concerns"": [""Consistency of 'youtube' string in source data.""]
    },
    {
      ""metric_id"": ""facebook_spend_ty_k"",
      ""metric_name"": ""Facebook Spend (This Period, '000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""spend_in_thousands"", ""time_period_type"", ""Media_Network""],
      ""business_description"": ""Advertising spend specifically for 'facebook' media network for the current selected time period."",
      ""sql_logic"": ""SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'facebook' THEN spend_k ELSE 0 END)"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks spend on a specific digital media platform."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'facebook'"", ""'ty'""],
      ""governance_issues"": [""'facebook' is hardcoded; should use a lookup table for media networks."", ""Time period definition is hardcoded.""],
      ""data_quality_concerns"": [""Consistency of 'facebook' string in source data.""]
    },
    {
      ""metric_id"": ""overall_fixed_publisher_count"",
      ""metric_name"": ""Overall Fixed Publisher Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""overall"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A count of distinct media networks (publishers) across the entire dataset, pre-calculated and cross-joined."",
      ""sql_logic"": ""COUNT(DISTINCT media_network) OVER ()"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a static count of unique publishers in the dataset, potentially used for context or normalization."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""This metric is pre-calculated and cross-joined, which might be inefficient if the base data is very large and this value is frequently needed. Consider materializing this as a separate lookup or summary table.""],
      ""data_quality_concerns"": [""Accuracy depends on the distinctness and consistency of `media_network` values.""]
    },
    {
      ""metric_id"": ""time_period_type"",
      ""metric_name"": ""Time Period Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""date"", ""latest_date"", ""max_fin_year""],
      ""business_description"": ""Categorizes each record as 'ty' (this period) or 'ly' (last period) based on the selected time period logic (e.g., Rolling 12 months, Calendar Year, Financial Year). In these queries, it's fixed to 'Rolling 12 months'."",
      ""sql_logic"": ""CASE 'Rolling 12 months' WHEN 'Rolling 12 months' THEN CASE WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty' WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly' ELSE NULL END ..."",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial dimension for period-over-period analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Rolling 12 months'"", ""'Calendar Year'"", ""'Financial Year'"", ""'ty'"", ""'ly'""],
      ""governance_issues"": [""The selection of time period logic is hardcoded; should be a parameter."", ""The logic itself is complex and should be well-documented or managed in a date dimension table.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""quarter_period"",
      ""metric_name"": ""Quarter Period"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""calendar_month_short_name""],
      ""business_description"": ""Categorizes the month into a calendar quarter (Q1, Q2, Q3, Q4)."",
      ""sql_logic"": ""CASE WHEN calendar_month_short_name IN ('Jan', 'Feb', 'Mar') THEN 'Q1' ... ELSE NULL END"",
      ""data_sources"": [""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for quarterly reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Jan'"", ""'Feb'"", ""'Mar'"", ""'Apr'"", ""'May'"", ""'Jun'"", ""'Jul'"", ""'Aug'"", ""'Sep'"", ""'Oct'"", ""'Nov'"", ""'Dec'"", ""'Q1'"", ""'Q2'"", ""'Q3'"", ""'Q4'""],
      ""governance_issues"": [""Quarter definitions are hardcoded; should be part of a date dimension table for flexibility (e.g., fiscal vs. calendar quarters).""],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_spend_ty_k"",
      ""related_metrics"": [""total_spend_ly_k""],
      ""relationship_description"": ""Calculates the percentage change in total spend from the last period to the current period."",
      ""mathematical_formula"": ""((total_spend_ty_k - total_spend_ly_k) / total_spend_ly_k) * 100"",
      ""business_validation"": ""This relationship is crucial for understanding growth or decline in overall advertising spend."",
      ""validation_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      source = 'Adex'\n  ),\n  TEMP1 AS (\n    SELECT\n      *,\n      (SELECT MAX(date) FROM adex_data) AS latest_date,\n      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year\n    FROM\n      adex_data\n  ),\n  pre_aggregated_data AS (\n    SELECT\n      *,\n      CASE 'Rolling 12 months'\n        WHEN 'Rolling 12 months' THEN\n        CASE\n          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'\n          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Calendar Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Financial Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'\n          ELSE NULL\n        END\n        ELSE NULL\n      END AS ty_ly_embed,\n      SAFE_DIVIDE(Spend, 1000) AS spend_k\n    FROM\n      TEMP1\n  )\nSELECT \n  SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) AS total_spend_ty_k,\n  SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END) AS total_spend_ly_k,\n  SAFE_DIVIDE(SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) - SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END), SUM(CASE WHEN ty_ly_embed = 'ly' THEN spend_k ELSE 0 END)) * 100 AS spend_growth_percentage\nFROM pre_aggregated_data\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""news_corp_spend_ty_k"",
      ""related_metrics"": [""news_corp_spend_ly_k""],
      ""relationship_description"": ""Calculates the percentage change in News Corp spend from the last period to the current period."",
      ""mathematical_formula"": ""((news_corp_spend_ty_k - news_corp_spend_ly_k) / news_corp_spend_ly_k) * 100"",
      ""business_validation"": ""This relationship is vital for assessing the performance of the 'NEWS CORP' media network over time."",
      ""validation_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      source = 'Adex'\n  ),\n  TEMP1 AS (\n    SELECT\n      *,\n      (SELECT MAX(date) FROM adex_data) AS latest_date,\n      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year\n    FROM\n      adex_data\n  ),\n  pre_aggregated_data AS (\n    SELECT\n      *,\n      CASE 'Rolling 12 months'\n        WHEN 'Rolling 12 months' THEN\n        CASE\n          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'\n          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Calendar Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Financial Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'\n          ELSE NULL\n        END\n        ELSE NULL\n      END AS ty_ly_embed,\n      SAFE_DIVIDE(Spend, 1000) AS spend_k\n    FROM\n      TEMP1\n  )\nSELECT \n  SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) AS news_corp_spend_ty_k,\n  SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) AS news_corp_spend_ly_k,\n  SAFE_DIVIDE(SUM(CASE WHEN ty_ly_embed = 'ty' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END) - SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END), SUM(CASE WHEN ty_ly_embed = 'ly' AND Media_Network = 'NEWS CORP' THEN spend_k ELSE 0 END)) * 100 AS news_corp_spend_growth_percentage\nFROM pre_aggregated_data\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_spend_ty_k"",
      ""related_metrics"": [""Advertiser"", ""portfolio_parent_group_name"", ""quarter_period""],
      ""relationship_description"": ""The total spend metrics are filtered by specific Advertiser lists and Portfolio Parent Group names combined with Quarter periods in the original dashboard queries. These filters are applied at the dashboard level on top of the unified dataset."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""These filters narrow down the scope of spend analysis to specific client segments or timeframes, allowing for targeted performance reviews."",
      ""validation_sql"": ""WITH\n  adex_data AS (\n    SELECT\n      *,\n      FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n      CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year\n    FROM\n      `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n    WHERE\n      source = 'Adex'\n  ),\n  TEMP1 AS (\n    SELECT\n      *,\n      (SELECT MAX(date) FROM adex_data) AS latest_date,\n      (SELECT MAX(financial_year) FROM adex_data) AS max_fin_year\n    FROM\n      adex_data\n  ),\n  pre_aggregated_data AS (\n    SELECT\n      *,\n      CASE 'Rolling 12 months'\n        WHEN 'Rolling 12 months' THEN\n        CASE\n          WHEN DATE_DIFF(latest_date, date, MONTH) <= 11 THEN 'ty'\n          WHEN DATE_DIFF(latest_date, date, MONTH) BETWEEN 12 AND 23 THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Calendar Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) AS STRING),'-1-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(EXTRACT(YEAR FROM latest_date) - 1 AS STRING), '-1-1')) THEN 'ly'\n          ELSE NULL\n        END\n        WHEN 'Financial Year' THEN\n        CASE\n          WHEN date <= latest_date AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 1 AS STRING),'-7-1')) THEN 'ty'\n          WHEN date <= DATETIME_ADD(latest_date, INTERVAL -1 YEAR) AND date >= PARSE_DATE('%Y-%m-%d', CONCAT(CAST(max_fin_year - 2 AS STRING), '-7-1')) THEN 'ly'\n          ELSE NULL\n        END\n        ELSE NULL\n      END AS ty_ly_embed,\n      SAFE_DIVIDE(Spend, 1000) AS spend_k,\n      CASE\n        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Jan', 'Feb', 'Mar') THEN 'Q1'\n        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Apr', 'May', 'Jun') THEN 'Q2'\n        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Jul', 'Aug', 'Sep') THEN 'Q3'\n        WHEN FORMAT_DATETIME('%b', DATETIME(date)) IN ('Oct', 'Nov', 'Dec') THEN 'Q4'\n        ELSE NULL\n      END AS calendar_quarter\n    FROM\n      TEMP1\n  )\nSELECT \n  Advertiser,\n  portfolio_parent_group_name,\n  calendar_quarter AS quarter_period,\n  SUM(CASE WHEN ty_ly_embed = 'ty' THEN spend_k ELSE 0 END) AS total_spend_ty_k_filtered\nFROM pre_aggregated_data\nWHERE \n  (portfolio_parent_group_name IN ('KEY ACCOUNTS TRAVEL') AND calendar_quarter IN ('Q2'))\n  OR\n  (Advertiser IN ('NT Dept Of Trade Business & Innovation', 'NT Dept Of Chief Minister', 'NT Dept Of Infrastructure Planning & Logistics', 'NT Dept Of Industry Tourism & Trade', 'NT Dept Of Education Employment & Training', 'NT Dept Of Tourism & Culture', 'NT Dept Of Transport', 'NT Dept Of Attorney-General & Justice', 'NT Dept Of Environment & Natural Resources', 'NT Dept Of Lands Planning & The Environment', 'NT Dept Of Health', 'NT Dept Of Police Fire & Emergency Services', 'NT Dept Of Business', 'NT Dept Of Territory Families, Housing & Communities', 'NT Dept Of Primary Industry & Resources', 'NT Dept Of Environment Parks & Water Security', 'NT Dept Of Corporate & Information Services'))\nGROUP BY 1, 2, 3\nLIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,6
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""783f341c-8660-4e90-bab8-9bc860119cf5"",
    ""dashboard_name"": ""Deals Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""month_start_date"",
      ""advertiser"",
      ""buyer"",
      ""source"",
      ""source_transaction_type_upper"",
      ""financial_period_label""
    ],
    ""date_range_detected"": ""01/11/2024 to 01/06/2025 (derived date); 01/05/2025 to 01/12/2025 (original data)"",
    ""hardcoded_dates_found"": [
      ""01/11/2024"",
      ""01/12/2024"",
      ""01/01/2025"",
      ""01/02/2025"",
      ""01/03/2025"",
      ""01/04/2025"",
      ""01/05/2025"",
      ""01/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""AdX"",
      ""AppNexus"",
      ""DFP"",
      ""Index Exchange"",
      ""InSkin"",
      ""Kargo"",
      ""Playground XYZ"",
      ""PubMatic"",
      ""Rubicon"",
      ""Tremor"",
      ""DEAL"",
      ""UFR"",
      ""PG - CPD"",
      ""PG - CPM"",
      ""DIRECT"",
      ""The Smith Family *"",
      ""Kmart Corporation *"",
      ""Target Corporation *"",
      ""Myer *"",
      ""FY25 Q2"",
      ""FY25 Q3"",
      ""FY25 Q4""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""source codes should join to a reference table"",
      ""transaction types should join to a reference table"",
      ""advertiser names should join to a master advertiser dimension"",
      ""financial periods should be derived dynamically or from a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for business analysis, providing all key metrics and dimensions at a common grain.\n-- It consolidates the transformations and filters observed across the dashboard's queries.\nWITH transformed_data AS (\n  SELECT\n    t0.advertiser,\n    t0.buyer,\n    t0.revenuenet,\n    t0.source,\n    UPPER(SAFE_CAST(t0.source_transaction_type AS STRING)) AS source_transaction_type_upper,\n    CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS financial_period_label,\n    SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS month_start_date,\n    DATE(t0.financialyear, t0.financialmonthnumber, 1) AS original_financial_date_start\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n)\nSELECT\n  month_start_date,\n  advertiser,\n  buyer,\n  source,\n  source_transaction_type_upper,\n  financial_period_label,\n  SUM(revenuenet) AS total_revenue_net\nFROM transformed_data\nWHERE\n  -- Apply the most common and broad filters observed across all queries\n  source_transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')\n  -- Date range based on the union of all hardcoded dates, adjusted for the 6-month offset.\n  -- This covers the original financial periods from May 2025 to December 2025.\n  AND original_financial_date_start BETWEEN DATE('2025-05-01') AND DATE('2025-12-01')\nGROUP BY\n  month_start_date,\n  advertiser,\n  buyer,\n  source,\n  source_transaction_type_upper,\n  financial_period_label\nORDER BY\n  month_start_date DESC\nLIMIT 10000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financialyear) as unique_financial_years,\n  COUNT(DISTINCT t0.financialmonthnumber) as unique_financial_months,\n  COUNT(DISTINCT t0.advertiser) as unique_advertisers,\n  COUNT(DISTINCT t0.buyer) as unique_buyers,\n  COUNT(DISTINCT t0.source) as unique_sources,\n  COUNT(DISTINCT t0.source_transaction_type) as unique_transaction_types,\n  MIN(DATE(t0.financialyear, t0.financialmonthnumber, 1)) as earliest_financial_date,\n  MAX(DATE(t0.financialyear, t0.financialmonthnumber, 1)) as latest_financial_date,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.advertiser, t0.buyer, t0.source, t0.financialyear, t0.financialmonthnumber)) as approx_unique_combinations\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH);"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.revenuenet) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as revenuenet_exists_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_exists_test,\n  CASE WHEN MAX(DATE(t0.financialyear, t0.financialmonthnumber, 1)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nWITH transformed_data AS (\n  SELECT\n    t0.advertiser,\n    t0.buyer,\n    t0.revenuenet,\n    t0.source,\n    UPPER(SAFE_CAST(t0.source_transaction_type AS STRING)) AS source_transaction_type_upper,\n    CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS financial_period_label,\n    SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS month_start_date\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n  WHERE DATE(t0.financialyear, t0.financialmonthnumber, 1) BETWEEN DATE('2025-05-01') AND DATE('2025-12-01') -- Focus on relevant date range\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Source Transaction Type Filter Coverage' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN source_transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN source_transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_transaction_type,\n  'Advertiser Filter Coverage (Example)' as rule_name_advertiser,\n  SUM(CASE WHEN advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *') THEN 1 ELSE 0 END) as records_passing_advertiser_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_advertiser\nFROM transformed_data;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  t0.advertiser,\n  t0.buyer,\n  t0.revenuenet,\n  t0.source,\n  t0.source_transaction_type,\n  t0.financialmonthnumber,\n  t0.financialquarter,\n  t0.financialyear\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\nWHERE DATE(t0.financialyear, t0.financialmonthnumber, 1) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\n  AND t0.revenuenet IS NOT NULL\nORDER BY DATE(t0.financialyear, t0.financialmonthnumber, 1) DESC, t0.revenuenet DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""01/11/2024"",
          ""original_format"": ""DATE '2024-11-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter (e.g., @start_date) or relative date function (e.g., DATE_TRUNC(CURRENT_DATE(), MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/12/2024"",
          ""original_format"": ""DATE '2024-12-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/01/2025"",
          ""original_format"": ""DATE '2025-01-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/02/2025"",
          ""original_format"": ""DATE '2025-02-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/03/2025"",
          ""original_format"": ""DATE '2025-03-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/04/2025"",
          ""original_format"": ""DATE '2025-04-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1 (assuming typo for 2025-04-01)"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/05/2025"",
          ""original_format"": ""DATE '2025-05-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1, 2, and 3"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/06/2025"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""used as a specific month_start_date filter in Query 1"",
          ""suggested_fix"": ""replace with Looker Studio date parameter or relative date function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'AdX'"",
            ""'AppNexus'"",
            ""'DFP'"",
            ""'Index Exchange'"",
            ""'InSkin'"",
            ""'Kargo'"",
            ""'Playground XYZ'"",
            ""'PubMatic'"",
            ""'Rubicon'"",
            ""'Tremor'""
          ],
          ""context"": ""source values filtered in Query 1"",
          ""suggested_governance"": ""join to a `dim_source` reference table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DEAL'"",
            ""'UFR'"",
            ""'PG - CPD'"",
            ""'PG - CPM'"",
            ""'DIRECT'""
          ],
          ""context"": ""source_transaction_type values filtered across all queries"",
          ""suggested_governance"": ""join to a `dim_transaction_type` reference table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Smith Family *'"",
            ""'Kmart Corporation *'"",
            ""'Target Corporation *'"",
            ""'Myer *'""
          ],
          ""context"": ""advertiser names filtered in all queries"",
          ""suggested_governance"": ""join to a `dim_advertiser` master table with unique IDs"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'FY25 Q2'"",
            ""'FY25 Q3'"",
            ""'FY25 Q4'""
          ],
          ""context"": ""financial period labels filtered in all queries"",
          ""suggested_governance"": ""derive dynamically from a `dim_date` table or use a `dim_financial_period` table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with Looker Studio date parameters or relative date functions (e.g., `_DS_START_DATE`, `_DS_END_DATE`)."",
      ""Replace hardcoded lookup values (Source, Transaction Type, Advertiser) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., valid transaction types) instead of hardcoded logic in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_revenue_net"",
      ""metric_name"": ""Total Revenue Net"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sum of net revenue generated from programmatic advertising deals, adjusted for a 6-month offset from the original financial period."",
      ""sql_logic"": ""SUM(t0.revenuenet)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source_transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')"",
        ""specific source values (e.g., 'DFP', 'Index Exchange', 'Rubicon')"",
        ""specific advertiser names (e.g., 'The Smith Family *')"",
        ""specific financial period labels (e.g., 'FY25 Q2', 'FY25 Q3', 'FY25 Q4')"",
        ""specific month_start_date values (e.g., '01/11/2024' to '01/06/2025')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for tracking performance and financial health of programmatic advertising deals, segmented by various dimensions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""01/11/2024"",
        ""01/12/2024"",
        ""01/01/2025"",
        ""01/02/2025"",
        ""01/03/2025"",
        ""01/04/2025"",
        ""01/05/2025"",
        ""01/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""'AppNexus'"",
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'InSkin'"",
        ""'Kargo'"",
        ""'Playground XYZ'"",
        ""'PubMatic'"",
        ""'Rubicon'"",
        ""'Tremor'"",
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'"",
        ""'The Smith Family *'"",
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in revenuenet"",
        ""accuracy depends on financial period data""
      ]
    },
    {
      ""metric_id"": ""month_start_date"",
      ""metric_name"": ""Month Start Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the month, derived from the financial year and month, then adjusted by subtracting 6 months."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""month_start_date IN (DATE '2024-11-01', ..., DATE '2025-06-01')""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for monthly trend analysis and filtering of advertising performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""01/11/2024"",
        ""01/12/2024"",
        ""01/01/2025"",
        ""01/02/2025"",
        ""01/03/2025"",
        ""01/04/2025"",
        ""01/05/2025"",
        ""01/06/2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential issues if financialmonthnumber or financialyear are invalid or inconsistent""
      ]
    },
    {
      ""metric_id"": ""source"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The platform or system (e.g., DFP, Rubicon) from which the programmatic advertising transaction originated."",
      ""sql_logic"": ""t0.source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source IN ('DFP', 'Index Exchange', 'Rubicon')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue and other metrics by advertising platform, crucial for platform-specific performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'AdX'"",
        ""'AppNexus'"",
        ""'DFP'"",
        ""'Index Exchange'"",
        ""'InSkin'"",
        ""'Kargo'"",
        ""'Playground XYZ'"",
        ""'PubMatic'"",
        ""'Rubicon'"",
        ""'Tremor'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for inconsistent naming or typos in source data""
      ]
    },
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser (client) associated with the programmatic deal."",
      ""sql_logic"": ""t0.advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""advertiser IN ('The Smith Family *', 'Kmart Corporation *', 'Target Corporation *', 'Myer *')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for client-specific analysis, allowing performance tracking per advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Smith Family *'"",
        ""'Kmart Corporation *'"",
        ""'Target Corporation *'"",
        ""'Myer *'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table (master advertiser list)""
      ],
      ""data_quality_concerns"": [
        ""potential for inconsistent naming, duplicates, or variations in advertiser names""
      ]
    },
    {
      ""metric_id"": ""source_transaction_type_upper"",
      ""metric_name"": ""Source Transaction Type (Upper)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of programmatic transaction (e.g., DEAL, UFR), converted to uppercase for consistent filtering and analysis."",
      ""sql_logic"": ""UPPER(SAFE_CAST(t0.source_transaction_type AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""source_transaction_type_upper IN ('DEAL', 'UFR', 'PG - CPD', 'PG - CPM', 'DIRECT')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting revenue and other metrics by the specific type of advertising deal, enabling analysis of deal performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DEAL'"",
        ""'UFR'"",
        ""'PG - CPD'"",
        ""'PG - CPM'"",
        ""'DIRECT'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls or unexpected values in the raw source_transaction_type column""
      ]
    },
    {
      ""metric_id"": ""financial_period_label"",
      ""metric_name"": ""Financial Period Label"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A concatenated string representing the financial year and quarter (e.g., 'FY25 Q4'), used for financial reporting."",
      ""sql_logic"": ""CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""financial_period_label IN ('FY25 Q2', 'FY25 Q3', 'FY25 Q4')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting and filtering data by specific financial quarters, aligning with internal financial calendars."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY25 Q2'"",
        ""'FY25 Q3'"",
        ""'FY25 Q4'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table or be derived dynamically from a date dimension""
      ],
      ""data_quality_concerns"": [
        ""potential for incorrect financial year/quarter data if source is inaccurate""
      ]
    },
    {
      ""metric_id"": ""buyer"",
      ""metric_name"": ""Buyer"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The entity or individual responsible for purchasing the advertising space, often an agency or direct client."",
      ""sql_logic"": ""t0.buyer"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master""
      ],
      ""filters_applied"": [
        ""advertiser IN ('Kmart Corporation *', 'Target Corporation *', 'Myer *')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze buyer-specific performance and relationships, especially for key accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""potential for inconsistent naming, need for master buyer list""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls or unexpected values in the raw buyer column""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_revenue_net"",
      ""related_metrics"": [
        ""source"",
        ""source_transaction_type_upper"",
        ""advertiser"",
        ""financial_period_label"",
        ""month_start_date""
      ],
      ""relationship_description"": ""Total Revenue Net is filtered by specific values of Source, Source Transaction Type, Advertiser, Financial Period Label, and Month Start Date. Different combinations of these filters are applied across various dashboard components."",
      ""mathematical_formula"": ""SUM(revenuenet) WHERE [dimension] IN (...) AND [date_dimension] IN (...)"",
      ""business_validation"": ""Ensures that revenue figures are specific to the selected advertising platforms, deal types, clients, and time periods."",
      ""validation_sql"": ""SELECT SUM(revenuenet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` WHERE UPPER(SAFE_CAST(source_transaction_type AS STRING)) IN ('DEAL', 'UFR') AND advertiser IN ('The Smith Family *');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""month_start_date"",
      ""related_metrics"": [
        ""financial_period_label""
      ],
      ""relationship_description"": ""The 'month_start_date' is derived from the 'financialyear' and 'financialmonthnumber' columns, which are also used to construct the 'financial_period_label'. Both are time-related dimensions, but 'month_start_date' is adjusted by a 6-month offset."",
      ""mathematical_formula"": ""month_start_date = TRUNC(DATE(financialyear, financialmonthnumber, 1) - 6 MONTH, MONTH)"",
      ""business_validation"": ""Ensures consistent time-based analysis, allowing for reporting by both calendar month (adjusted) and financial quarter."",
      ""validation_sql"": ""SELECT DISTINCT month_start_date, financial_period_label FROM (\n  SELECT\n    t0.financialyear,\n    t0.financialmonthnumber,\n    t0.financialquarter,\n    CONCAT('FY', SUBSTR(SAFE_CAST(t0.financialyear AS STRING), 3, 2), ' ', SAFE_CAST(t0.financialquarter AS STRING)) AS financial_period_label,\n    SAFE_CAST(DATETIME_TRUNC(DATETIME_SUB(SAFE_CAST(DATE(t0.financialyear, t0.financialmonthnumber, 1) AS DATETIME), INTERVAL 6 MONTH), MONTH) AS DATE) AS month_start_date\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` AS t0\n) WHERE month_start_date IS NOT NULL AND financial_period_label IS NOT NULL LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""buyer"",
      ""related_metrics"": [
        ""advertiser""
      ],
      ""relationship_description"": ""The 'buyer' dimension is retrieved in queries that filter on specific 'advertiser' values, implying that certain buyers are associated with particular advertisers."",
      ""mathematical_formula"": ""SELECT buyer WHERE advertiser IN (...)"",
      ""business_validation"": ""Allows for analysis of buyers specific to certain key advertisers, which is important for account management and sales strategy."",
      ""validation_sql"": ""SELECT DISTINCT buyer, advertiser FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_weekly_master` WHERE advertiser IN ('Kmart Corporation *', 'Target Corporation *') LIMIT 100;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,7
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a8fe6bb0-3cbf-4d6e-8838-fa6e6dce447f"",
    ""dashboard_name"": ""Pacing Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month;ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 12,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""FinancialYear"",
      ""FinancialMonthNumber"",
      ""Source"",
      ""ProductType""
    ],
    ""date_range_detected"": ""Current Month"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""1 (for CurrentMonthFlag)"",
      ""'Kargo'"",
      ""'AdX'""
    ],
    ""governance_opportunities"": [
      ""CurrentMonthFlag should be derived from date functions"",
      ""Source values should be managed in a lookup table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates the core metrics and dimensions from the 'Pacing Dashboard'.\n-- It extracts financial month details, source-specific day counts, and calculated display strings.\n-- The 'CurrentMonthFlag = 1' filter is applied to focus on current period data, as seen in the original queries.\n\nWITH fin_month_data AS (\n  SELECT\n    t0.CurrentMonthFlag,\n    t0.FinancialMonthNumber,\n    t0.FinancialYear,\n    t0.Source,\n    t0.StaticDays,\n    t0.NumDays,\n    ((t0.FinancialYear * 100) + t0.FinancialMonthNumber) AS Financial_Month_ID\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` AS t0\n)\nSELECT\n  -- Core Dimensions\n  fmd.FinancialYear,\n  fmd.FinancialMonthNumber,\n  fmd.Source,\n  fmd.Financial_Month_ID,\n  -- Metrics for Kargo (Current Month)\n  CASE\n    WHEN fmd.CurrentMonthFlag = 1 AND fmd.Source = 'Kargo' THEN fmd.StaticDays\n    ELSE NULL\n  END AS Kargo_StaticDays_CurrentMonth,\n  -- Display string for Kargo (as seen in original query 1)\n  CONCAT(SAFE_CAST(fmd.StaticDays AS STRING), ' (', SAFE_CAST(fmd.Financial_Month_ID AS STRING), ' )') AS Financial_Month_Display_Kargo,\n  -- Metrics for Non-AdX (Current Month)\n  CASE\n    WHEN fmd.CurrentMonthFlag = 1 AND (fmd.Source NOT IN ('AdX') OR fmd.Source IS NULL) THEN fmd.NumDays\n    ELSE NULL\n  END AS NonAdX_NumDays_CurrentMonth,\n  -- Display string for Non-AdX (as seen in original query 2)\n  CONCAT(SAFE_CAST(fmd.NumDays AS STRING), ' (', SAFE_CAST(fmd.Financial_Month_ID AS STRING), ' )') AS Financial_Month_Display_NonAdX\nFROM fin_month_data AS fmd\nWHERE fmd.CurrentMonthFlag = 1 -- Filter for current month data, as per dashboard logic\nORDER BY fmd.FinancialYear DESC, fmd.FinancialMonthNumber DESC, fmd.Source\nLIMIT 100;"",
    ""structure_sql"": ""-- This query provides an overview of the data structure and grain for the primary tables.\n-- It helps understand the number of records, unique values for key dimensions, and date ranges.\n\nSELECT\n  'programmatic_fin_month' as table_name,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT CurrentMonthFlag) as unique_current_month_flags,\n  COUNT(DISTINCT FinancialMonthNumber) as unique_financial_month_numbers,\n  COUNT(DISTINCT FinancialYear) as unique_financial_years,\n  COUNT(DISTINCT Source) as unique_sources,\n  MIN(FinancialYear * 100 + FinancialMonthNumber) as earliest_financial_month_id,\n  MAX(FinancialYear * 100 + FinancialMonthNumber) as latest_financial_month_id,\n  SUM(StaticDays) as total_static_days,\n  SUM(NumDays) as total_num_days\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nUNION ALL\nSELECT\n  'programmatic_cal_month' as table_name,\n  COUNT(*) as total_records,\n  NULL, NULL, NULL, -- Not applicable for this table\n  COUNT(DISTINCT ProductType) as unique_product_types,\n  NULL, NULL, NULL, NULL\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month`;"",
    ""validation_sql"": ""-- This query performs quick validation checks on the data to ensure basic integrity and freshness.\n-- It verifies if key metrics are populated and if the data is up-to-date for the current month.\n\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(CASE WHEN CurrentMonthFlag = 1 AND Source = 'Kargo' THEN StaticDays ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as kargo_static_days_check,\n  CASE WHEN SUM(CASE WHEN CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) THEN NumDays ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as non_adx_num_days_check,\n  CASE WHEN MAX(FinancialYear * 100 + FinancialMonthNumber) >= ((EXTRACT(YEAR FROM CURRENT_DATE()) * 100) + EXTRACT(MONTH FROM CURRENT_DATE())) THEN 'PASS' ELSE 'FAIL' END as freshness_check\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE CurrentMonthFlag = 1\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This query validates key business logic and data quality assumptions identified from the dashboard queries.\n-- It checks for consistency in CurrentMonthFlag and population of source-specific day metrics.\n\nSELECT\n  'Business Rule Validation' as validation_type,\n  'CurrentMonthFlag Alignment' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN CurrentMonthFlag = 1 AND (FinancialYear * 100 + FinancialMonthNumber) = ((EXTRACT(YEAR FROM CURRENT_DATE()) * 100) + EXTRACT(MONTH FROM CURRENT_DATE())) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN CurrentMonthFlag = 1 AND (FinancialYear * 100 + FinancialMonthNumber) = ((EXTRACT(YEAR FROM CURRENT_DATE()) * 100) + EXTRACT(MONTH FROM CURRENT_DATE())) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE CurrentMonthFlag = 1\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Kargo StaticDays Populated' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN Source = 'Kargo' AND StaticDays IS NOT NULL THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN Source = 'Kargo' AND StaticDays IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE CurrentMonthFlag = 1 AND Source = 'Kargo'\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Non-AdX NumDays Populated' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (Source NOT IN ('AdX') OR Source IS NULL) AND NumDays IS NOT NULL THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (Source NOT IN ('AdX') OR Source IS NULL) AND NumDays IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL);"",
    ""sample_data_sql"": ""-- This query retrieves a representative sample of the raw data for further detailed analysis.\n-- It focuses on the 'programmatic_fin_month' table, which is central to the dashboard's metrics.\n\nSELECT\n  CurrentMonthFlag,\n  FinancialMonthNumber,\n  FinancialYear,\n  Source,\n  StaticDays,\n  NumDays\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month`\nWHERE CurrentMonthFlag = 1 -- Focus on current month data\nORDER BY FinancialYear DESC, FinancialMonthNumber DESC, Source\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""1""
          ],
          ""context"": ""CurrentMonthFlag is hardcoded to 1 to identify the current month."",
          ""suggested_governance"": ""Replace with a dynamic date comparison (e.g., `FORMAT_DATE('%Y%m', CURRENT_DATE()) = FORMAT_DATE('%Y%m', DATE(FinancialYear, FinancialMonthNumber, 1))`) or a governed date dimension."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Kargo'"",
            ""'AdX'""
          ],
          ""context"": ""Specific source names are hardcoded in WHERE clauses for filtering."",
          ""suggested_governance"": ""Manage source names in a dedicated lookup table and join to it, or use parameters for filtering."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded 'CurrentMonthFlag = 1' with a dynamic date parameter or relative date function (e.g., `WHERE FinancialYear = EXTRACT(YEAR FROM CURRENT_DATE()) AND FinancialMonthNumber = EXTRACT(MONTH FROM CURRENT_DATE())`)."",
      ""Replace hardcoded source values ('Kargo', 'AdX') with parameters or by joining to a governed 'Source' lookup table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""current_month_flag"",
      ""metric_name"": ""Current Month Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag (0 or 1) indicating if the financial month corresponds to the current reporting month. Used primarily as a filter."",
      ""sql_logic"": ""t0.CurrentMonthFlag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for filtering data to show only the most recent financial month's performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [
        ""The flag '1' is hardcoded; it should be derived dynamically from current date logic.""
      ],
      ""data_quality_concerns"": [
        ""Reliance on an ETL process to correctly set this flag for the current month.""
      ]
    },
    {
      ""metric_id"": ""financial_month_number"",
      ""metric_name"": ""Financial Month Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The numerical representation of the financial month (e.g., 1 for July, 2 for August, etc., depending on financial year start)."",
      ""sql_logic"": ""t0.FinancialMonthNumber"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for chronological ordering and grouping of financial data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year to which the data pertains."",
      ""sql_logic"": ""t0.FinancialYear"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for chronological ordering and grouping of financial data, especially for year-over-year comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_dimension"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The advertising platform or partner from which the data originates (e.g., 'Kargo', 'AdX')."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting performance by advertising channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Kargo'"",
        ""'AdX'""
      ],
      ""governance_issues"": [
        ""Source names are hardcoded in filters; they should be managed in a lookup table for consistency and maintainability.""
      ],
      ""data_quality_concerns"": [
        ""Potential for misspellings or variations if not governed.""
      ]
    },
    {
      ""metric_id"": ""static_days"",
      ""metric_name"": ""Static Days"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A pre-calculated count of 'static' days for a given financial month, specific to certain advertising sources (e.g., 'Kargo')."",
      ""sql_logic"": ""t0.StaticDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in the calculation of the 'Financial Month Display (Kargo)' string, likely representing a key pacing metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the upstream ETL process that populates this column.""
      ]
    },
    {
      ""metric_id"": ""num_days"",
      ""metric_name"": ""Number of Days"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A pre-calculated count of 'number of days' for a given financial month, specific to certain advertising sources (e.g., Non-AdX)."",
      ""sql_logic"": ""t0.NumDays"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in the calculation of the 'Financial Month Display (Non-AdX)' string, likely representing a key pacing metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the upstream ETL process that populates this column.""
      ]
    },
    {
      ""metric_id"": ""product_type"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of product associated with advertising data."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used as a filter or grouping dimension in the dashboard to segment data by product."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_id"",
      ""metric_name"": ""Financial Month ID"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""business_description"": ""A unique numerical identifier for each financial month, created by concatenating the financial year and month number (e.g., 202309 for September 2023)."",
      ""sql_logic"": ""((FinancialYear * 100) + FinancialMonthNumber)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for internal sorting, grouping, and as part of the display strings for financial months."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_display_kargo"",
      ""metric_name"": ""Financial Month Display (Kargo)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""static_days"",
        ""financial_month_id""
      ],
      ""business_description"": ""A formatted string combining 'Static Days' and 'Financial Month ID' for 'Kargo' source data, used for display in the dashboard (e.g., '30 (202309)')."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(StaticDays AS STRING), CONCAT(' (', SAFE_CAST(Financial_Month_ID AS STRING)), ' )')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source IN ('Kargo')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Serves as a user-friendly label for selecting or displaying Kargo-specific financial month data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on the accuracy of 'StaticDays' and 'FinancialMonthID'.""
      ]
    },
    {
      ""metric_id"": ""financial_month_display_non_adx"",
      ""metric_name"": ""Financial Month Display (Non-AdX)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""num_days"",
        ""financial_month_id""
      ],
      ""business_description"": ""A formatted string combining 'Num Days' and 'Financial Month ID' for 'Non-AdX' source data, used for display in the dashboard (e.g., '31 (202309)')."",
      ""sql_logic"": ""CONCAT(SAFE_CAST(NumDays AS STRING), CONCAT(' (', SAFE_CAST(Financial_Month_ID AS STRING)), ' )')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""(Source NOT IN ('AdX') OR Source IS NULL)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Serves as a user-friendly label for selecting or displaying Non-AdX specific financial month data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Relies on the accuracy of 'NumDays' and 'FinancialMonthID'.""
      ]
    },
    {
      ""metric_id"": ""kargo_static_days_current_month"",
      ""metric_name"": ""Kargo Static Days (Current Month)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""static_days"",
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""business_description"": ""The 'StaticDays' value specifically for the 'Kargo' advertising source, filtered for the current financial month. This is a key pacing metric."",
      ""sql_logic"": ""CASE WHEN CurrentMonthFlag = 1 AND Source = 'Kargo' THEN StaticDays ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""Source IN ('Kargo')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Represents a critical daily count for the 'Kargo' platform, used for monitoring pacing against targets."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""'Kargo'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'CurrentMonthFlag' and 'Source' values should be parameterized or governed.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the upstream ETL and correct 'CurrentMonthFlag' assignment.""
      ]
    },
    {
      ""metric_id"": ""non_adx_num_days_current_month"",
      ""metric_name"": ""Non-AdX Number of Days (Current Month)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""num_days"",
        ""current_month_flag"",
        ""source_dimension""
      ],
      ""business_description"": ""The 'NumDays' value for advertising sources other than 'AdX' (or NULL sources), filtered for the current financial month. This is a key pacing metric."",
      ""sql_logic"": ""CASE WHEN CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) THEN NumDays ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month""
      ],
      ""filters_applied"": [
        ""CurrentMonthFlag = 1"",
        ""(Source NOT IN ('AdX') OR Source IS NULL)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Represents a critical daily count for non-AdX platforms, used for monitoring pacing against targets."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1"",
        ""'AdX'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'CurrentMonthFlag' and 'Source' values should be parameterized or governed.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the upstream ETL and correct 'CurrentMonthFlag' assignment.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_month_flag"",
      ""related_metrics"": [
        ""kargo_static_days_current_month"",
        ""non_adx_num_days_current_month"",
        ""financial_month_display_kargo"",
        ""financial_month_display_non_adx""
      ],
      ""relationship_description"": ""The 'Current Month Flag' acts as a primary filter, ensuring that all related metrics and display strings reflect data only for the current financial month."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that pacing metrics are always relevant to the ongoing reporting period."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""source_dimension"",
      ""related_metrics"": [
        ""kargo_static_days_current_month"",
        ""non_adx_num_days_current_month"",
        ""financial_month_display_kargo"",
        ""financial_month_display_non_adx""
      ],
      ""relationship_description"": ""The 'Source' dimension is used to conditionally calculate and display 'Static Days' for 'Kargo' and 'Num Days' for 'Non-AdX' sources, ensuring metrics are specific to their respective platforms."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows for platform-specific pacing analysis, which is critical for managing advertising campaigns."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN Source = 'Kargo' THEN StaticDays ELSE 0 END) AS KargoDays, SUM(CASE WHEN Source NOT IN ('AdX') OR Source IS NULL THEN NumDays ELSE 0 END) AS NonAdXDays FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""financial_month_id"",
      ""related_metrics"": [
        ""financial_year"",
        ""financial_month_number""
      ],
      ""relationship_description"": ""The 'Financial Month ID' is a derived metric, mathematically combining 'Financial Year' and 'Financial Month Number' to create a unique, sortable identifier for each financial month."",
      ""mathematical_formula"": ""Financial_Month_ID = (FinancialYear * 100) + FinancialMonthNumber"",
      ""business_validation"": ""Ensures consistent and correct chronological ordering of financial periods, regardless of the financial year start date."",
      ""validation_sql"": ""SELECT FinancialYear, FinancialMonthNumber, ((FinancialYear * 100) + FinancialMonthNumber) AS CalculatedID FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_month_display_kargo"",
      ""related_metrics"": [
        ""static_days"",
        ""financial_month_id""
      ],
      ""relationship_description"": ""The 'Financial Month Display (Kargo)' is a display-oriented string that directly depends on the 'Static Days' metric and the 'Financial Month ID' for its content."",
      ""mathematical_formula"": ""Display String = CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )')"",
      ""business_validation"": ""Provides a user-friendly representation of the key pacing metric for Kargo within its relevant financial period."",
      ""validation_sql"": ""SELECT StaticDays, Financial_Month_ID, CONCAT(SAFE_CAST(StaticDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )') AS DisplayString FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND Source = 'Kargo' LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_month_display_non_adx"",
      ""related_metrics"": [
        ""num_days"",
        ""financial_month_id""
      ],
      ""relationship_description"": ""The 'Financial Month Display (Non-AdX)' is a display-oriented string that directly depends on the 'Num Days' metric and the 'Financial Month ID' for its content."",
      ""mathematical_formula"": ""Display String = CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )')"",
      ""business_validation"": ""Provides a user-friendly representation of the key pacing metric for Non-AdX sources within its relevant financial period."",
      ""validation_sql"": ""SELECT NumDays, Financial_Month_ID, CONCAT(SAFE_CAST(NumDays AS STRING), ' (', SAFE_CAST(Financial_Month_ID AS STRING), ' )') AS DisplayString FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_fin_month` WHERE CurrentMonthFlag = 1 AND (Source NOT IN ('AdX') OR Source IS NULL) LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,8
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5dae02f0-dc48-418c-bdf9-5e5d2b1d6e26"",
    ""dashboard_name"": ""Optimizing Digital Subscriptions Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_week_month_string"",
      ""recognition_type"",
      ""masthead_group_broad"",
      ""masthead_group_detailed"",
      ""masthead_group_broader"",
      ""email_bundle_flag"",
      ""report_type_fct"",
      ""cancellation_type"",
      ""acquisition_type""
    ],
    ""date_range_detected"": ""Not explicitly filtered in SQL, relies on Looker Studio date picker. Base date for week calculation: 03/07/2024. Date for day of week calculation: 23/03/2025."",
    ""hardcoded_dates_found"": [
      ""23/03/2025"",
      ""03/07/2024"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""gl_publication_code IDs (e.g., '100', '402')"",
      ""masthead_code values (e.g., 'AP', 'NT')"",
      ""classification_level_1_description ('Standard Paid')"",
      ""classification_level_2_description ('The Oz')"",
      ""delivery_medium_type ('Print', 'Bundle')"",
      ""subscriber_has_email_flag ('subsnapfact', 'N')"",
      ""Masthead categories ('Metros', 'Regionals', 'Discontinued')"",
      ""Recognition types ('Digital Recognition')"",
      ""Fiscal month names ('July', 'August')"",
      ""Report types ('FCT', 'BUD')"",
      ""Cancellation/Acquisition types ('Gross Cancellations', 'Gross Acquisitions')""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Masthead categorization logic should be moved to a governed lookup table"",
      ""Fiscal calendar definitions (week to month mapping) should be in a governed table or UDF"",
      ""Report type and metric type labels should be managed as parameters or metadata, not hardcoded in SQL""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.classification_level_1_description AS classification_level_1_description,\n    t0.classification_level_2_description AS classification_level_2_description,\n    t0.delivery_medium_type AS delivery_medium_type,\n    t0.gl_publication_code AS gl_publication_code,\n    t0.masthead_code AS masthead_code,\n    t0.subscriber_has_email_flag AS subscriber_has_email_flag,\n    -- Assuming a subscription_id or similar unique identifier exists for counting\n    t0.some_subscription_id_column AS subscription_id_placeholder, -- Placeholder for actual subscription ID\n    -- Hardcoded date for week/day calculations (replace with dynamic date if needed)\n    DATE(TIMESTAMP '2025-03-23 04:54:02.058726+00', 'Australia/Sydney') AS base_calc_date,\n    DATETIME_DIFF(SAFE_CAST(DATE(TIMESTAMP '2025-03-23 04:54:02.058726+00', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS week_diff_from_baseline\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\n  -- Add date filters here if the table has a date column, e.g., WHERE t0.event_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\n  -- For demonstration, we'll assume Looker Studio handles the primary date filtering.\n),\n\ncalculated_dimensions AS (\n  SELECT\n    base_data.*,\n    -- Derived: email_bundle_flag (clmn85_ / clmn82_ / clmn84_ logic)\n    CASE\n      WHEN (subscriber_has_email_flag = 'subsnapfact') THEN 'Y'\n      WHEN (classification_level_1_description = 'Standard Paid' AND delivery_medium_type = 'Bundle') THEN subscriber_has_email_flag\n      ELSE 'Y'\n    END AS email_bundle_flag,\n\n    -- Derived: detailed_masthead_group (clmn86_ / clmn83_ / clmn85_ logic)\n    CASE\n      WHEN (gl_publication_code = '100' OR gl_publication_code = '101' OR masthead_code = 'TA') THEN 'The Australian'\n      WHEN (gl_publication_code = '400' OR gl_publication_code = '401' OR gl_publication_code = '402' OR masthead_code = 'CM') THEN 'Courier Mail'\n      WHEN (gl_publication_code = '110' OR gl_publication_code = '111' OR gl_publication_code = '116' OR masthead_code = 'DT') THEN 'Daily Telegraph'\n      WHEN (gl_publication_code = '301' OR gl_publication_code = '302' OR gl_publication_code = '303' OR gl_publication_code = '304' OR masthead_code = 'HS') THEN 'Herald Sun'\n      WHEN (gl_publication_code = '500' OR gl_publication_code = '501' OR gl_publication_code = '560' OR gl_publication_code = '72') THEN 'The Advertiser'\n      WHEN (gl_publication_code = '450' OR gl_publication_code = '460' OR gl_publication_code = '76') THEN 'Cairns Post'\n      WHEN (gl_publication_code = '350' OR gl_publication_code = '351' OR masthead_code = 'GA') THEN 'Geelong'\n      WHEN (gl_publication_code = '670' OR gl_publication_code = '685' OR masthead_code = 'GC') THEN 'Gold Coast'\n      WHEN (gl_publication_code = '961' OR gl_publication_code = '962' OR gl_publication_code = '963' OR masthead_code = 'NT') THEN 'NT News'\n      WHEN (gl_publication_code = '850' OR gl_publication_code = '851' OR gl_publication_code = '852' OR masthead_code = 'TM') THEN 'The Mercury'\n      WHEN (gl_publication_code = '5053' OR gl_publication_code = '5253' OR masthead_code = 'TC') THEN 'Toowoomba'\n      WHEN (gl_publication_code = '475' OR gl_publication_code = '490' OR masthead_code = 'TB') THEN 'Townsville'\n      WHEN (gl_publication_code = '305' OR gl_publication_code = '307' OR masthead_code = 'WT') THEN 'Weekly Times'\n      WHEN (gl_publication_code = '9001' OR gl_publication_code = '78') THEN 'Code'\n      WHEN (gl_publication_code = '8821' OR gl_publication_code = '8822' OR masthead_code = 'PU') THEN 'Punters'\n      WHEN (gl_publication_code = '8822' OR gl_publication_code = 'Racenet' OR masthead_code = 'RN') THEN 'Racenet'\n      WHEN (gl_publication_code = '9653' OR masthead_code = 'SC') THEN 'Supercoach Plus'\n      WHEN (gl_publication_code = '9600' OR gl_publication_code = '70') THEN 'Taste Online'\n      WHEN (gl_publication_code = '9003' OR masthead_code = 'AP') THEN 'Apple Podcast: Crime X'\n      WHEN (gl_publication_code = '103' OR classification_level_2_description = 'The Oz') THEN 'The Oz'\n      WHEN (gl_publication_code = '9000' OR masthead_code = 'NW') THEN 'news.com.au'\n      WHEN (gl_publication_code = '121') THEN 'Others'\n      WHEN (gl_publication_code = '9002' OR masthead_code = 'BG') THEN 'Brain Games'\n      WHEN (gl_publication_code = '9504' OR gl_publication_code = '9514' OR gl_publication_code = '9556' OR gl_publication_code = '9558' OR gl_publication_code = '9603' OR gl_publication_code = '9623' OR gl_publication_code = '9560') THEN 'Others'\n      WHEN (gl_publication_code = '9644') THEN 'Suddenly'\n      WHEN (gl_publication_code = '9903') THEN 'News Corporate'\n      WHEN (gl_publication_code = 'Group Newspaper Management - Digital') THEN 'Group Newspaper Management - Digital'\n      ELSE NULL\n    END AS detailed_masthead_group,\n\n    -- Derived: recognition_type (clmn88_ / clmn84_ / clmn86_ logic)\n    CASE\n      WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition'\n      WHEN (CASE WHEN (subscriber_has_email_flag = 'subsnapfact') THEN 'Y' WHEN (classification_level_1_description = 'Standard Paid' AND delivery_medium_type = 'Bundle') THEN subscriber_has_email_flag ELSE 'Y' END = 'N') THEN 'Print Recognition'\n      ELSE 'Digital Recognition'\n    END AS recognition_type,\n\n    -- Derived: day_of_week (clmn7_ logic)\n    (EXTRACT(DAYOFWEEK FROM TIMESTAMP(base_calc_date)) - 1) AS day_of_week,\n\n    -- Derived: week_number_adjusted (clmn87_ / clmn126_ logic)\n    CASE WHEN ((EXTRACT(DAYOFWEEK FROM TIMESTAMP(base_calc_date)) - 1) <= 2) THEN (week_diff_from_baseline - 1) ELSE week_diff_from_baseline END AS week_number_adjusted\n),\n\nfinal_dimensions AS (\n  SELECT\n    calculated_dimensions.*,\n    -- Derived: masthead_group_broad (clmn127_ / clmn103_ / clmn105_ logic)\n    CASE\n      WHEN (detailed_masthead_group = 'The Australian') THEN 'The Australian'\n      WHEN (detailed_masthead_group IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser')) THEN 'Metros'\n      WHEN (detailed_masthead_group IN ('Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville')) THEN 'Regionals'\n      WHEN (detailed_masthead_group = 'Weekly Times') THEN 'Others'\n      WHEN (detailed_masthead_group IN ('Supercoach Plus', 'Code', 'Apple Podcast: Crime X', 'Taste Online', 'Racenet', 'Punters', 'Brain Games')) THEN 'Deep Niche Publications'\n      ELSE 'Discontinued'\n    END AS masthead_group_broad,\n\n    -- Derived: masthead_group_broader (clmn128_ logic - using detailed_masthead_group and raw codes)\n    CASE\n      WHEN (detailed_masthead_group = 'The Australian' OR gl_publication_code = '9556' OR gl_publication_code = '9560') THEN 'The Australian and Prestige'\n      WHEN (detailed_masthead_group IN ('Courier Mail', 'Daily Telegraph', 'Herald Sun', 'The Advertiser', 'Cairns Post', 'Geelong', 'Gold Coast', 'NT News', 'The Mercury', 'Toowoomba', 'Townsville', 'Weekly Times', 'Supercoach Plus', 'Code', 'Apple Podcast: Crime X') OR gl_publication_code = '121' OR gl_publication_code = '9504') THEN 'States & Community'\n      WHEN (detailed_masthead_group IN ('Racenet', 'Punters')) THEN 'Commercial Content'\n      WHEN (detailed_masthead_group IN ('Taste Online') OR gl_publication_code = '9514') THEN 'Free & Lifestyle'\n      ELSE 'Discontinued'\n    END AS masthead_group_broader,\n\n    -- Derived: custom_fiscal_month_number (clmn129_ logic)\n    CASE\n      WHEN (week_number_adjusted <= 4) THEN 1\n      WHEN (week_number_adjusted <= 9) THEN 2\n      WHEN (week_number_adjusted <= 13) THEN 3\n      WHEN (week_number_adjusted <= 17) THEN 4\n      WHEN (week_number_adjusted <= 22) THEN 5\n      WHEN (week_number_adjusted <= 26) THEN 6\n      WHEN (week_number_adjusted <= 30) THEN 7\n      WHEN (week_number_adjusted <= 35) THEN 8\n      WHEN (week_number_adjusted <= 39) THEN 9\n      WHEN (week_number_adjusted <= 43) THEN 10\n      WHEN (week_number_adjusted <= 48) THEN 11\n      WHEN (week_number_adjusted <= 53) THEN 12\n      ELSE NULL\n    END AS custom_fiscal_month_number\n)\n\nSELECT\n  final_output.fiscal_week_month_string,\n  final_output.recognition_type,\n  final_output.masthead_group_broad,\n  final_output.masthead_group_detailed,\n  final_output.masthead_group_broader,\n  final_output.email_bundle_flag,\n  'FCT' AS report_type_fct, -- Hardcoded from Q2\n  'Gross Cancellations' AS cancellation_type, -- Hardcoded from Q3\n  'Gross Acquisitions' AS acquisition_type, -- Hardcoded from Q3\n  -- Placeholder for actual subscription count metric\n  COUNT(DISTINCT final_output.subscription_id_placeholder) AS digital_subscription_count\nFROM (\n  SELECT\n    final_dimensions.*,\n    -- Derived: month_name (clmn131_ logic)\n    CASE\n      WHEN (custom_fiscal_month_number = 1) THEN 'July'\n      WHEN (custom_fiscal_month_number = 2) THEN 'August'\n      WHEN (custom_fiscal_month_number = 3) THEN 'September'\n      WHEN (custom_fiscal_month_number = 4) THEN 'October'\n      WHEN (custom_fiscal_month_number = 5) THEN 'November'\n      WHEN (custom_fiscal_month_number = 6) THEN 'December'\n      WHEN (custom_fiscal_month_number = 7) THEN 'January'\n      WHEN (custom_fiscal_month_number = 8) THEN 'February'\n      WHEN (custom_fiscal_month_number = 9) THEN 'March'\n      WHEN (custom_fiscal_month_number = 10) THEN 'April'\n      WHEN (custom_fiscal_month_number = 11) THEN 'May'\n      WHEN (custom_fiscal_month_number = 12) THEN 'June'\n      ELSE NULL\n    END AS month_name,\n    -- Derived: fiscal_week_month_string (clmn132_ / clmn133_ logic)\n    CONCAT('FY ', '2025', ' Week ', SAFE_CAST(week_number_adjusted AS STRING), ' (', CASE\n      WHEN (custom_fiscal_month_number = 1) THEN 'July'\n      WHEN (custom_fiscal_month_number = 2) THEN 'August'\n      WHEN (custom_fiscal_month_number = 3) THEN 'September'\n      WHEN (custom_fiscal_month_number = 4) THEN 'October'\n      WHEN (custom_fiscal_month_number = 5) THEN 'November'\n      WHEN (custom_fiscal_month_number = 6) THEN 'December'\n      WHEN (custom_fiscal_month_number = 7) THEN 'January'\n      WHEN (custom_fiscal_month_number = 8) THEN 'February'\n      WHEN (custom_fiscal_month_number = 9) THEN 'March'\n      WHEN (custom_fiscal_month_number = 10) THEN 'April'\n      WHEN (custom_fiscal_month_number = 11) THEN 'May'\n      WHEN (custom_fiscal_month_number = 12) THEN 'June'\n      ELSE NULL\n    END, ')') AS fiscal_week_month_string\n  FROM final_dimensions\n) AS final_output\nWHERE\n  final_output.recognition_type = 'Digital Recognition' AND\n  final_output.masthead_group_broad != 'Discontinued'\nGROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9\nLIMIT 1000"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.classification_level_1_description) AS unique_classification_level_1_descriptions,\n  COUNT(DISTINCT t0.classification_level_2_description) AS unique_classification_level_2_descriptions,\n  COUNT(DISTINCT t0.delivery_medium_type) AS unique_delivery_medium_types,\n  COUNT(DISTINCT t0.gl_publication_code) AS unique_gl_publication_codes,\n  COUNT(DISTINCT t0.masthead_code) AS unique_masthead_codes,\n  COUNT(DISTINCT t0.subscriber_has_email_flag) AS unique_subscriber_has_email_flags,\n  MIN(t0.some_date_column) AS earliest_record_date, -- Placeholder for actual date column\n  MAX(t0.some_date_column) AS latest_record_date -- Placeholder for actual date column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nLIMIT 1000"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS record_count_test,\n  CASE WHEN SUM(CASE WHEN t0.delivery_medium_type = 'Digital' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END AS digital_records_test,\n  CASE WHEN SUM(CASE WHEN t0.gl_publication_code IS NULL THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END AS gl_publication_code_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE 1=1 -- Add date filter if a date column exists, e.g., t0.event_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Digital Recognition Filter' AS rule_name,\n  COUNT(*) AS total_records_evaluated,\n  SUM(CASE\n    WHEN (t0.delivery_medium_type != 'Print' AND NOT (t0.subscriber_has_email_flag = 'N')) THEN 1\n    ELSE 0\n  END) AS records_matching_digital_recognition_logic,\n  SAFE_DIVIDE(SUM(CASE\n    WHEN (t0.delivery_medium_type != 'Print' AND NOT (t0.subscriber_has_email_flag = 'N')) THEN 1\n    ELSE 0\n  END), COUNT(*)) * 100 AS digital_recognition_match_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE 1=1 -- Add date filter if a date column exists, e.g., t0.event_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1000"",
    ""sample_data_sql"": ""SELECT\n  t0.classification_level_1_description,\n  t0.classification_level_2_description,\n  t0.delivery_medium_type,\n  t0.gl_publication_code,\n  t0.masthead_code,\n  t0.subscriber_has_email_flag,\n  t0.some_subscription_id_column -- Placeholder for actual subscription ID\nFROM `ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions` AS t0\nWHERE 1=1 -- Add date filter if a date column exists, e.g., t0.event_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""23/03/2025"",
          ""original_format"": ""2025-03-23 04:54:02.058726+00"",
          ""context"": ""Used as the base date for calculating day of week and week difference. This date is in the future relative to current date (assuming current date is before March 2025)."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a Looker Studio date parameter to make calculations dynamic and relevant to the reporting period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""03/07/2024"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as the baseline date for calculating week difference (fiscal week start)."",
          ""suggested_fix"": ""Replace with a configurable fiscal year start date parameter or a lookup from a fiscal calendar table."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Hardcoded fiscal year in the 'FY' string concatenation."",
          ""suggested_fix"": ""Derive fiscal year dynamically from the reporting date or a fiscal calendar table."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'100'"",
            ""'402'"",
            ""'301'"",
            ""'AP'"",
            ""'NT'"",
            ""'SC'""
          ],
          ""context"": ""Numerous `gl_publication_code` and `masthead_code` values are hardcoded within complex `CASE WHEN` statements to categorize mastheads (e.g., 'Metros', 'Regionals')."",
          ""suggested_governance"": ""Create a `masthead_lookup` table with `gl_publication_code`, `masthead_code`, `detailed_masthead_group`, `masthead_group_broad`, and `masthead_group_broader` columns. Join to this table instead of using `CASE WHEN`."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Print Recognition'"",
            ""'Digital Recognition'"",
            ""'Discontinued'""
          ],
          ""context"": ""Categorization logic for 'Recognition Type' and 'Masthead Group Broad' is hardcoded."",
          ""suggested_governance"": ""Define these categorizations in a business rule configuration table or a UDF for consistency and easier updates."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'July'"",
            ""'August'"",
            ""'FCT'"",
            ""'Gross Cancellations'"",
            ""'Gross Acquisitions'""
          ],
          ""context"": ""Fiscal month names and report/metric type labels are hardcoded strings."",
          ""suggested_governance"": ""Fiscal month names should come from a fiscal calendar table. Report/metric type labels should be managed as parameters or metadata in Looker Studio, or derived from a configuration table if they represent different calculation paths."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""4"",
            ""9"",
            ""13"",
            ""17"",
            ""22"",
            ""26"",
            ""30"",
            ""35"",
            ""39"",
            ""43"",
            ""48"",
            ""53""
          ],
          ""context"": ""Week number thresholds used to map weeks to custom fiscal months."",
          ""suggested_governance"": ""Define fiscal week-to-month mapping in a fiscal calendar table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-03-23', '2024-07-03') with Looker Studio date parameters or `CURRENT_DATE()`/`DATE_TRUNC()` functions to enable dynamic reporting."",
      ""Implement a `masthead_dimension` table to centralize `gl_publication_code` and `masthead_code` mappings to `detailed_masthead_group`, `masthead_group_broad`, and `masthead_group_broader`. This will significantly reduce SQL complexity and maintenance."",
      ""Create a `fiscal_calendar` table to manage fiscal year, week, and month definitions, including the week-to-month mapping and fiscal year start dates."",
      ""Externalize hardcoded report/metric type labels (e.g., 'FCT', 'Gross Cancellations') into Looker Studio parameters or a small configuration table if they drive different data views or calculations.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fiscal_week_month_string"",
      ""metric_name"": ""Fiscal Week and Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""week_number_adjusted"",
        ""custom_fiscal_month_number""
      ],
      ""business_description"": ""A custom formatted string representing the fiscal year, week number, and corresponding fiscal month name. Used for time-based grouping and filtering."",
      ""sql_logic"": ""CONCAT('FY ', '2025', ' Week ', SAFE_CAST(week_number_adjusted AS STRING), ' (', month_name, ')')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a custom time hierarchy for subscription reporting, aligning with internal fiscal periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""23/03/2025"",
        ""03/07/2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'FY '"",
        ""' Week '"",
        ""' ('"",
        ""')'"",
        ""'July'"",
        ""'August'"",
        ""'September'"",
        ""'October'"",
        ""'November'"",
        ""'December'"",
        ""'January'"",
        ""'February'"",
        ""'March'"",
        ""'April'"",
        ""'May'"",
        ""'June'""
      ],
      ""governance_issues"": [
        ""Date calculations rely on hardcoded dates and a fixed fiscal year, which should be parameterized or sourced from a fiscal calendar table."",
        ""Week-to-month mapping is hardcoded and should be in a governed lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the fixed fiscal year and baseline date. Future data will require manual update of hardcoded values.""
      ]
    },
    {
      ""metric_id"": ""recognition_type"",
      ""metric_name"": ""Recognition Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""delivery_medium_type"",
        ""email_bundle_flag""
      ],
      ""business_description"": ""Categorizes a subscription as 'Print Recognition' or 'Digital Recognition' based on delivery medium and email flag."",
      ""sql_logic"": ""CASE WHEN (delivery_medium_type = 'Print') THEN 'Print Recognition' WHEN (email_bundle_flag = 'N') THEN 'Print Recognition' ELSE 'Digital Recognition' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""recognition_type = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting subscription data into digital vs. print categories, which is central to the dashboard's purpose."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Print'"",
        ""'Print Recognition'"",
        ""'Digital Recognition'"",
        ""'N'""
      ],
      ""governance_issues"": [
        ""Categorization logic is hardcoded; should be managed as a business rule in a central configuration.""
      ],
      ""data_quality_concerns"": [
        ""Relies on the accuracy of `delivery_medium_type` and `subscriber_has_email_flag`.""
      ]
    },
    {
      ""metric_id"": ""masthead_group_broad"",
      ""metric_name"": ""Masthead Group (Broad)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""masthead_group_detailed""
      ],
      ""business_description"": ""Groups detailed mastheads into broader categories like 'Metros', 'Regionals', 'Deep Niche Publications', 'Others', 'Discontinued', and 'The Australian'."",
      ""sql_logic"": ""CASE WHEN (detailed_masthead_group = 'The Australian') THEN 'The Australian' WHEN (...) THEN 'Metros' WHEN (...) THEN 'Regionals' WHEN (...) THEN 'Deep Niche Publications' WHEN (detailed_masthead_group = 'Weekly Times') THEN 'Others' ELSE 'Discontinued' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group_broad != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables high-level analysis of subscription performance across major masthead segments."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian'"",
        ""'Metros'"",
        ""'Regionals'"",
        ""'Deep Niche Publications'"",
        ""'Others'"",
        ""'Discontinued'"",
        ""'Weekly Times'""
      ],
      ""governance_issues"": [
        ""Categorization logic is hardcoded and highly complex; should be moved to a governed lookup table for maintainability and consistency.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the correctness of the `detailed_masthead_group` and the extensive `CASE WHEN` logic.""
      ]
    },
    {
      ""metric_id"": ""masthead_group_detailed"",
      ""metric_name"": ""Masthead Group (Detailed)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gl_publication_code"",
        ""masthead_code""
      ],
      ""business_description"": ""Categorizes individual mastheads based on their GL publication code and masthead code."",
      ""sql_logic"": ""CASE WHEN (gl_publication_code = '100' OR gl_publication_code = '101' OR masthead_code = 'TA') THEN 'The Australian' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides granular detail for subscription analysis at the individual masthead level."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'100'"",
        ""'402'"",
        ""'301'"",
        ""'AP'"",
        ""'NT'"",
        ""'SC'"",
        ""numerous other gl_publication_code and masthead_code values and their mapped names""
      ],
      ""governance_issues"": [
        ""Extensive hardcoding of lookup values and their mappings; should be replaced by a `masthead_lookup` table."",
        ""High maintenance risk due to direct embedding of business rules in SQL.""
      ],
      ""data_quality_concerns"": [
        ""Potential for errors or inconsistencies if new codes are introduced or existing mappings change without SQL updates.""
      ]
    },
    {
      ""metric_id"": ""masthead_group_broader"",
      ""metric_name"": ""Masthead Group (Broader)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gl_publication_code"",
        ""masthead_code"",
        ""detailed_masthead_group""
      ],
      ""business_description"": ""Provides an even higher-level grouping of mastheads, such as 'The Australian and Prestige', 'States & Community', 'Commercial Content', and 'Free & Lifestyle'."",
      ""sql_logic"": ""CASE WHEN (detailed_masthead_group = 'The Australian' OR gl_publication_code = '9556' OR gl_publication_code = '9560') THEN 'The Australian and Prestige' ... ELSE 'Discontinued' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for very high-level strategic analysis of subscription portfolio performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Australian and Prestige'"",
        ""'States & Community'"",
        ""'Commercial Content'"",
        ""'Free & Lifestyle'"",
        ""'Discontinued'"",
        ""numerous gl_publication_code and masthead_code values""
      ],
      ""governance_issues"": [
        ""Similar to detailed and broad masthead groups, this logic is hardcoded and should be externalized to a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Risk of inconsistencies if not centrally managed.""
      ]
    },
    {
      ""metric_id"": ""email_bundle_flag"",
      ""metric_name"": ""Email/Bundle Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""subscriber_has_email_flag"",
        ""classification_level_1_description"",
        ""delivery_medium_type""
      ],
      ""business_description"": ""A flag indicating if a subscriber has an email or if the subscription is a 'Standard Paid' bundle. Used in the 'Recognition Type' calculation."",
      ""sql_logic"": ""CASE WHEN (subscriber_has_email_flag = 'subsnapfact') THEN 'Y' WHEN (classification_level_1_description = 'Standard Paid' AND delivery_medium_type = 'Bundle') THEN subscriber_has_email_flag ELSE 'Y' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""An intermediate dimension used to determine the 'Recognition Type'."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'subsnapfact'"",
        ""'Y'"",
        ""'Standard Paid'"",
        ""'Bundle'""
      ],
      ""governance_issues"": [
        ""Hardcoded values for flags and descriptions; could be managed via configuration if these values change.""
      ],
      ""data_quality_concerns"": [
        ""Depends on the consistency of input `subscriber_has_email_flag`, `classification_level_1_description`, and `delivery_medium_type`.""
      ]
    },
    {
      ""metric_id"": ""report_type_fct"",
      ""metric_name"": ""Report Type (FCT)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'FCT', likely representing a 'Forecast' report type. Used as a dimension in the dashboard."",
      ""sql_logic"": ""CASE WHEN (2 = 1) THEN 'BUD' WHEN (2 = 2) THEN 'FCT' WHEN (2 = 3) THEN 'YOY' WHEN (2 = 4) THEN 'BUD NY' ELSE NULL END (always evaluates to 'FCT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used to distinguish data sets or views within the dashboard, possibly for comparing actuals to forecast."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'BUD'"",
        ""'FCT'"",
        ""'YOY'"",
        ""'BUD NY'""
      ],
      ""governance_issues"": [
        ""Hardcoded label; should be managed as a Looker Studio parameter or a configuration table if dynamic selection is needed.""
      ],
      ""data_quality_concerns"": [
        ""None, as it's a static value.""
      ]
    },
    {
      ""metric_id"": ""cancellation_type"",
      ""metric_name"": ""Cancellation Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'Gross Cancellations', likely representing a specific type of cancellation metric. Used as a dimension in the dashboard."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Gross Cancellations' WHEN (1 = 2) THEN 'Net Cancellations' ELSE NULL END (always evaluates to 'Gross Cancellations')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used to categorize or label cancellation data within the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Gross Cancellations'"",
        ""'Net Cancellations'""
      ],
      ""governance_issues"": [
        ""Hardcoded label; should be managed as a Looker Studio parameter or a configuration table if dynamic selection is needed.""
      ],
      ""data_quality_concerns"": [
        ""None, as it's a static value.""
      ]
    },
    {
      ""metric_id"": ""acquisition_type"",
      ""metric_name"": ""Acquisition Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded label 'Gross Acquisitions', likely representing a specific type of acquisition metric. Used as a dimension in the dashboard."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Gross Acquisitions' WHEN (1 = 2) THEN 'Net Acquisitions' ELSE NULL END (always evaluates to 'Gross Acquisitions')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used to categorize or label acquisition data within the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Gross Acquisitions'"",
        ""'Net Acquisitions'""
      ],
      ""governance_issues"": [
        ""Hardcoded label; should be managed as a Looker Studio parameter or a configuration table if dynamic selection is needed.""
      ],
      ""data_quality_concerns"": [
        ""None, as it's a static value.""
      ]
    },
    {
      ""metric_id"": ""digital_subscription_count"",
      ""metric_name"": ""Digital Subscription Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""subscription_id_placeholder"",
        ""recognition_type"",
        ""masthead_group_broad""
      ],
      ""business_description"": ""The total count of unique digital subscriptions, filtered by digital recognition and non-discontinued mastheads. This is an inferred core metric for a subscription report."",
      ""sql_logic"": ""COUNT(DISTINCT t0.some_subscription_id_column)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.digital_subscriptions""
      ],
      ""filters_applied"": [
        ""recognition_type = 'Digital Recognition'"",
        ""masthead_group_broad != 'Discontinued'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A primary KPI for understanding the volume of digital subscriptions, segmented by various dimensions."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Assumes existence of a unique subscription identifier. If not, `COUNT(*)` would be used, which might overcount.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the uniqueness and completeness of `subscription_id_placeholder` and the correctness of filtering dimensions.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""fiscal_week_month_string"",
      ""related_metrics"": [
        ""week_number_adjusted"",
        ""custom_fiscal_month_number""
      ],
      ""relationship_description"": ""The fiscal week and month string is formatted using the calculated adjusted week number and custom fiscal month number."",
      ""mathematical_formula"": ""N/A (string concatenation)"",
      ""business_validation"": ""Ensures the time dimension is correctly presented according to the defined fiscal calendar."",
      ""validation_sql"": ""SELECT fiscal_week_month_string, week_number_adjusted, custom_fiscal_month_number FROM primary_analysis_sql LIMIT 10"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""recognition_type"",
      ""related_metrics"": [
        ""delivery_medium_type"",
        ""email_bundle_flag""
      ],
      ""relationship_description"": ""The recognition type (Digital/Print) is determined by the delivery medium and an internal email/bundle flag."",
      ""mathematical_formula"": ""N/A (conditional logic)"",
      ""business_validation"": ""Ensures subscriptions are correctly classified for digital vs. print analysis."",
      ""validation_sql"": ""SELECT delivery_medium_type, subscriber_has_email_flag, recognition_type FROM primary_analysis_sql LIMIT 10"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""masthead_group_broad"",
      ""related_metrics"": [
        ""masthead_group_detailed""
      ],
      ""relationship_description"": ""The broad masthead grouping is derived from the detailed masthead grouping, consolidating specific mastheads into larger categories."",
      ""mathematical_formula"": ""N/A (conditional grouping)"",
      ""business_validation"": ""Provides a summarized view of masthead performance, essential for high-level reporting."",
      ""validation_sql"": ""SELECT masthead_group_detailed, masthead_group_broad FROM primary_analysis_sql LIMIT 10"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""digital_subscription_count"",
      ""related_metrics"": [
        ""recognition_type"",
        ""masthead_group_broad""
      ],
      ""relationship_description"": ""The digital subscription count is directly filtered by 'Digital Recognition' and excludes 'Discontinued' mastheads, ensuring only relevant digital subscriptions are counted."",
      ""mathematical_formula"": ""COUNT(DISTINCT subscription_id) WHERE recognition_type = 'Digital Recognition' AND masthead_group_broad != 'Discontinued'"",
      ""business_validation"": ""Ensures the core metric aligns with the dashboard's focus on 'Optimizing Digital Subscriptions'."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT subscription_id_placeholder) FROM primary_analysis_sql WHERE recognition_type = 'Digital Recognition' AND masthead_group_broad != 'Discontinued'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,9
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d8074b2-17a8-48ba-babe-c536359b1f64"",
    ""dashboard_name"": ""Final_Draft Adsales Performance Dashboard - FY25 20241127"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 18,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""revenue_type"",
      ""sales_segment_l_2_name_sync"",
      ""product_group"",
      ""unified_publication_name"",
      ""relative_fy_year_offset"",
      ""relative_fy_month_offset""
    ],
    ""date_range_detected"": ""Data spans multiple financial years (current, previous, next) relative to a hardcoded reference date of 2025-01-06."",
    ""hardcoded_dates_found"": [
      ""06/01/2025""
    ],
    ""hardcoded_values_found"": [
      ""'DOUBLECLICK'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'N'"",
      ""0 (relative_fy_week_offset)"",
      ""-1 (relative_fy_year_offset)"",
      ""0 (relative_fy_year_offset)"",
      ""1 (relative_fy_year_offset)"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""7 (divisor)"",
      ""1000 (divisor)"",
      ""'Y'"",
      ""'XTEND'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())."",
      ""Month names and their sorting order should be managed via a lookup table."",
      ""Categorical values like 'DOUBLECLICK', 'DIGITAL', 'Digital Other', 'XTEND' should be managed via reference tables."",
      ""Offset values (-1, 0, 1) for financial years/weeks should be clearly defined and potentially parameterized."",
      ""Division by 1000 for 'K' (thousands) values could be a standardized function or view.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run, calculating all key metrics together.\n-- Replaces hardcoded date with CURRENT_DATETIME for dynamic analysis.\n\nWITH base_data AS (\n  SELECT\n    t0.DOW_Today,\n    t0.advertiser_parent,\n    t0.booking_line_created_date,\n    t0.financial_quarter,\n    t0.financial_short_month,\n    t0.financial_year,\n    t0.fix_date_lod,\n    t0.gross_revenue_amount,\n    t0.is_future_period_flag,\n    t0.pipeline,\n    t0.relative_fy_month_offset,\n    t0.relative_fy_week_offset,\n    t0.relative_fy_year_offset,\n    t0.revenue_group_subtype,\n    t0.revenue_type,\n    t0.sales_segment_l_2_name_sync,\n    t0.ss_lgb,\n    t0.xtend_flag,\n    DATE(CURRENT_DATETIME('Australia/Sydney')) AS current_ref_date -- Replaced hardcoded '2025-01-06' with current date\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Add a relevant date filter for performance, e.g., last 2 financial years\n  WHERE t0.financial_year IN (EXTRACT(YEAR FROM CURRENT_DATE()), EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)), EXTRACT(YEAR FROM DATE_ADD(CURRENT_DATE(), INTERVAL 1 YEAR)))\n),\nlayer1_calcs AS (\n  SELECT\n    DOW_Today,\n    advertiser_parent,\n    booking_line_created_date,\n    financial_quarter,\n    financial_short_month,\n    financial_year,\n    fix_date_lod,\n    gross_revenue_amount,\n    is_future_period_flag,\n    pipeline,\n    relative_fy_month_offset,\n    relative_fy_week_offset,\n    relative_fy_year_offset,\n    revenue_group_subtype,\n    revenue_type,\n    sales_segment_l_2_name_sync,\n    ss_lgb,\n    xtend_flag,\n    current_ref_date,\n    DATETIME_ADD(SAFE_CAST(current_ref_date AS DATETIME), INTERVAL -365 DAY) AS date_one_year_ago, -- clmn19_\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick_advertiser, -- clmn20_\n    PARSE_DATE('%Y-%m-%d', booking_line_created_date) AS parsed_booking_date, -- clmn21_\n    SAFE_CAST(financial_quarter AS INT64) AS financial_quarter_int, -- clmn22_\n    CASE\n      WHEN (financial_short_month = 'Jul') THEN '01.Jul'\n      WHEN (financial_short_month = 'Aug') THEN '02.Aug'\n      WHEN (financial_short_month = 'Sep') THEN '03.Sep'\n      WHEN (financial_short_month = 'Oct') THEN '04.Oct'\n      WHEN (financial_short_month = 'Nov') THEN '05.Nov'\n      WHEN (financial_short_month = 'Dec') THEN '06.Dec'\n      WHEN (financial_short_month = 'Jan') THEN '07.Jan'\n      WHEN (financial_short_month = 'Feb') THEN '08.Feb'\n      WHEN (financial_short_month = 'Mar') THEN '09.Mar'\n      WHEN (financial_short_month = 'Apr') THEN '10.Apr'\n      WHEN (financial_short_month = 'May') THEN '11.May'\n      WHEN (financial_short_month = 'Jun') THEN '12.Jun'\n      ELSE NULL\n    END AS financial_short_month_sorted, -- clmn23_\n    SAFE_DIVIDE(gross_revenue_amount, 1000) AS gross_revenue_k, -- clmn24_\n    (is_future_period_flag = 'N') AS is_not_future_period, -- clmn25_\n    (relative_fy_week_offset = 0) AS is_current_fy_week, -- clmn26_\n    (relative_fy_week_offset < 0) AS is_past_fy_week, -- clmn27_\n    CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END AS prev_fy_gross_revenue_raw, -- clmn28_, clmn32_\n    (relative_fy_year_offset = 0) AS is_current_fy, -- clmn29_\n    (relative_fy_year_offset = -1) AS is_prev_fy, -- clmn30_\n    CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue_raw, -- clmn31_, clmn33_\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype, -- clmn34_\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type, -- clmn35_\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment_flag, -- clmn36_\n    SAFE_DIVIDE((ss_lgb * DOW_Today), 7) AS ss_lgb_adjusted, -- clmn37_\n    SAFE_DIVIDE(ss_lgb, 1000) AS ss_lgb_k, -- clmn38_\n    CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS revenue_type_xtend_adjusted -- clmn39_\n  FROM base_data\n),\nlayer2_calcs AS (\n  SELECT\n    * EXCEPT(prev_fy_gross_revenue_raw, current_fy_gross_revenue_raw, ss_lgb_adjusted, ss_lgb_k),\n    prev_fy_gross_revenue_raw,\n    current_fy_gross_revenue_raw,\n    ss_lgb_adjusted,\n    ss_lgb_k,\n    CASE WHEN (is_current_fy) THEN gross_revenue_k ELSE 0 END AS current_fy_gross_revenue_k_calc, -- clmn40_, clmn42_\n    CASE WHEN (relative_fy_year_offset = 1) THEN gross_revenue_k ELSE 0 END AS next_fy_gross_revenue_k_calc, -- clmn41_\n    CASE WHEN (is_current_fy AND is_past_fy_week) THEN ss_lgb ELSE 0 END AS current_fy_past_week_lgb_calc, -- clmn43_\n    CASE WHEN (is_current_fy AND is_not_future_period) THEN gross_revenue_amount ELSE 0 END AS current_fy_non_future_gross_revenue_raw, -- clmn44_\n    CASE WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment_flag AND is_not_doubleclick_advertiser) THEN fix_date_lod ELSE parsed_booking_date END AS effective_lod_date, -- clmn45_\n    CASE WHEN (is_current_fy AND is_current_fy_week) THEN ss_lgb_adjusted ELSE 0 END AS current_fy_week_lgb_adjusted_calc, -- clmn46_\n    CASE WHEN (is_current_fy) THEN ss_lgb_k ELSE 0 END AS current_fy_lgb_k_calc -- clmn47_, clmn48_\n  FROM layer1_calcs\n),\nlayer3_calcs AS (\n  SELECT\n    * EXCEPT(current_fy_non_future_gross_revenue_raw, effective_lod_date),\n    current_fy_non_future_gross_revenue_raw,\n    effective_lod_date,\n    SAFE_DIVIDE(current_fy_non_future_gross_revenue_raw, 1000) AS current_fy_non_future_gross_revenue_k_calc, -- clmn49_\n    (SAFE_CAST(effective_lod_date AS DATETIME) <= date_one_year_ago) AS is_lod_date_le_one_year_ago_flag -- clmn50_\n  FROM layer2_calcs\n),\nlayer4_calcs AS (\n  SELECT\n    * EXCEPT(gross_revenue_amount),\n    gross_revenue_amount,\n    CASE WHEN (is_prev_fy AND is_lod_date_le_one_year_ago_flag) THEN gross_revenue_amount ELSE 0 END AS prev_fy_gross_revenue_lod_date_le_1_year_ago_raw -- clmn51_, clmn52_\n  FROM layer3_calcs\n)\nSELECT\n  financial_short_month AS financial_short_month_dim,\n  financial_year AS financial_year_dim,\n  financial_short_month_sorted AS financial_short_month_sorted_dim,\n  revenue_type_xtend_adjusted AS revenue_type_xtend_adjusted_dim,\n  financial_quarter_int AS financial_quarter_dim,\n  relative_fy_month_offset AS relative_fy_month_offset_dim,\n  relative_fy_year_offset AS relative_fy_year_offset_dim,\n  sales_segment_l_2_name_sync AS sales_segment_l_2_name_sync_dim,\n  SUM(current_fy_week_lgb_adjusted_calc) AS current_fy_week_lgb_adjusted,\n  MAX(is_digital_other_sales_segment_flag) AS is_digital_other_sales_segment,\n  SUM(current_fy_gross_revenue_k_calc) AS current_fy_gross_revenue_k,\n  SUM(current_fy_gross_revenue_raw) AS current_fy_gross_revenue,\n  SUM(current_fy_non_future_gross_revenue_k_calc) AS current_fy_non_future_gross_revenue_k,\n  SUM(pipeline) AS total_pipeline,\n  SUM(current_fy_lgb_k_calc) AS current_fy_lgb_k,\n  SUM(current_fy_past_week_lgb_calc) AS current_fy_past_week_lgb,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(prev_fy_gross_revenue_raw) AS previous_fy_gross_revenue,\n  SUM(current_fy_gross_revenue_k_calc - current_fy_lgb_k_calc) AS current_fy_gross_revenue_k_minus_current_fy_lgb_k,\n  SUM(prev_fy_gross_revenue_lod_date_le_1_year_ago_raw) AS previous_fy_gross_revenue_lod_date_le_1_year_ago,\n  SUM(ss_lgb) AS total_lgb,\n  SUM(SAFE_DIVIDE(prev_fy_gross_revenue_raw, 1000)) AS previous_fy_gross_revenue_k,\n  SUM(next_fy_gross_revenue_k_calc) AS next_fy_gross_revenue_k\nFROM layer4_calcs\nGROUP BY\n  financial_short_month,\n  financial_year,\n  financial_short_month_sorted,\n  revenue_type_xtend_adjusted,\n  financial_quarter_int,\n  relative_fy_month_offset,\n  relative_fy_year_offset,\n  sales_segment_l_2_name_sync\nORDER BY financial_year DESC, financial_short_month_sorted ASC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT financial_quarter) as unique_financial_quarters,\n  COUNT(DISTINCT financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  MIN(booking_line_created_date) as earliest_booking_date,\n  MAX(booking_line_created_date) as latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(financial_year, financial_quarter, financial_short_month, revenue_type, sales_segment_l_2_name_sync)) as approx_unique_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT financial_year) > 1 THEN 'PASS' ELSE 'FAIL' END as multi_year_data_test,\n  CASE WHEN MAX(PARSE_DATE('%Y-%m-%d', booking_line_created_date)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Digital Revenue Type Consistency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' THEN 1 ELSE 0 END) as digital_revenue_match_count,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' THEN 1 ELSE 0 END), COUNT(*)) * 100 as digital_revenue_match_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Current FY Gross Revenue Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN relative_fy_year_offset = 0 AND gross_revenue_amount > 0 THEN 1 ELSE 0 END) as current_fy_revenue_records,\n  SAFE_DIVIDE(SUM(CASE WHEN relative_fy_year_offset = 0 AND gross_revenue_amount > 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 as current_fy_revenue_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR);"",
    ""sample_data_sql"": ""SELECT\n  financial_year,\n  financial_quarter,\n  financial_short_month,\n  revenue_type,\n  sales_segment_l_2_name_sync,\n  gross_revenue_amount,\n  pipeline,\n  ss_lgb,\n  relative_fy_year_offset,\n  relative_fy_month_offset,\n  relative_fy_week_offset,\n  booking_line_created_date,\n  is_future_period_flag,\n  xtend_flag\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\nORDER BY booking_line_created_date DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""06/01/2025"",
          ""original_format"": ""DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney')"",
          ""context"": ""Used as the base date (clmn0_) from which 'date_one_year_ago' (clmn19_) is derived. This anchors FY calculations to a specific future date."",
          ""suggested_fix"": ""Replace with `CURRENT_DATETIME('Australia/Sydney')` or a dashboard parameter for the 'as-of' date."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'"",
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'""
          ],
          ""context"": ""Month names hardcoded in a CASE statement to create a sorted financial month dimension."",
          ""suggested_governance"": ""Create a `dim_financial_month` lookup table with month name and sort order."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'"",
            ""'DIGITAL'"",
            ""'Digital Other'"",
            ""'N'"",
            ""'Y'"",
            ""'XTEND'""
          ],
          ""context"": ""Specific string values used for filtering and transforming `advertiser_parent`, `is_future_period_flag`, `revenue_group_subtype`, `revenue_type`, `sales_segment_l_2_name_sync`, `xtend_flag`."",
          ""suggested_governance"": ""Implement reference tables for these categorical dimensions to ensure consistency and allow for easier updates."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""-1"",
            ""0"",
            ""1""
          ],
          ""context"": ""Integer offsets for `relative_fy_year_offset` and `relative_fy_week_offset` used to define 'previous FY', 'current FY', 'next FY', 'current week', 'past week'."",
          ""suggested_governance"": ""Define these offsets and their meanings in a configuration table or as named constants in a view layer."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""1000"",
            ""7""
          ],
          ""context"": ""Divisors for converting amounts to 'K' (thousands) and for adjusting LGB by DOW_Today."",
          ""suggested_governance"": ""Standardize these constants (e.g., `K_FACTOR = 1000`, `DAYS_IN_WEEK = 7`) in a central place or as UDFs."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Replace hardcoded lookup values (e.g., month names, revenue types) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., financial year/week offsets, digital definitions) instead of hardcoded logic within SQL queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of products."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping sales performance by product category."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Standardized name of the publication."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping sales performance by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month_dim"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the financial month (e.g., 'Jul', 'Aug')."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for time-series analysis of sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year_dim"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for year-over-year comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month_sorted_dim"",
      ""metric_name"": ""Financial Short Month (Sorted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_short_month_dim""
      ],
      ""business_description"": ""Financial short month prefixed with a number for correct chronological sorting (e.g., '01.Jul', '07.Jan')."",
      ""sql_logic"": ""CASE WHEN (financial_short_month = 'Jul') THEN '01.Jul' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Ensures correct ordering of months in visualizations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jul'"",
        ""'Aug'"",
        ""'Sep'"",
        ""'Oct'"",
        ""'Nov'"",
        ""'Dec'"",
        ""'Jan'"",
        ""'Feb'"",
        ""'Mar'"",
        ""'Apr'"",
        ""'May'"",
        ""'Jun'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_xtend_adjusted_dim"",
      ""metric_name"": ""Revenue Type (XTEND Adjusted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Revenue type, with 'Y' xtend_flag values remapped to 'XTEND'."",
      ""sql_logic"": ""CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a consolidated view of revenue types, highlighting 'XTEND' specific revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_dim"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter number."",
      ""sql_logic"": ""SAFE_CAST(financial_quarter AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key dimension for quarterly performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_month_offset_dim"",
      ""metric_name"": ""Relative FY Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial month relative to a reference point (e.g., 0 for current month, -1 for previous)."",
      ""sql_logic"": ""t0.relative_fy_month_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for relative period comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset_dim"",
      ""metric_name"": ""Relative FY Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""integer"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial year relative to a reference point (e.g., 0 for current FY, -1 for previous FY, 1 for next FY)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for year-over-year comparisons and defining current/previous/next financial periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync_dim"",
      ""metric_name"": ""Sales Segment L2 Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Level 2 sales segment name."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_week_lgb_adjusted"",
      ""metric_name"": ""Current FY Week LGB (Adjusted)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""relative_fy_week_offset"",
        ""ss_lgb"",
        ""DOW_Today""
      ],
      ""business_description"": ""LGB (Likely to Go Booked) amount for the current financial year and current financial week, adjusted by Day of Week."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_week_offset = 0) THEN (ss_lgb * DOW_Today / 7) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_week_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for current week's expected bookings."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)"",
        ""0 (relative_fy_week_offset)"",
        ""7 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' and 'current week' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment"",
      ""metric_name"": ""Is Digital Other Sales Segment"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""max|conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync_dim""
      ],
      ""business_description"": ""Flag indicating if the sales segment is 'Digital Other'. Aggregated as MAX to show if any record in the group matches."",
      ""sql_logic"": ""MAX(sales_segment_l_2_name_sync = 'Digital Other')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for filtering or segmenting data by a specific sales segment."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""Lookup value should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k"",
      ""metric_name"": ""Current FY Gross Revenue (K)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the current financial year, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (gross_revenue_amount / 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for the current financial year, used for high-level performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)"",
        ""1000 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the current financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for the current financial year, used for detailed performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_non_future_gross_revenue_k"",
      ""metric_name"": ""Current FY Non-Future Gross Revenue (K)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""is_future_period_flag"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the current financial year, excluding future period bookings, in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = 0 AND is_future_period_flag = 'N') THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""is_future_period_flag = 'N'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Refined revenue metric focusing on actualized or non-future bookings within the current FY."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)"",
        ""'N'"",
        ""1000 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' and 'non-future' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pipeline"",
      ""metric_name"": ""Total Pipeline"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total value of the sales pipeline."",
      ""sql_logic"": ""SUM(pipeline)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key indicator of future revenue potential."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_lgb_k"",
      ""metric_name"": ""Current FY LGB (K)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""ss_lgb""
      ],
      ""business_description"": ""Likely to Go Booked (LGB) amount for the current financial year, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (ss_lgb / 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Forecasted bookings for the current financial year, used for pipeline health and forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)"",
        ""1000 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_past_week_lgb"",
      ""metric_name"": ""Current FY Past Week LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""relative_fy_week_offset"",
        ""ss_lgb""
      ],
      ""business_description"": ""LGB amount for the current financial year, specifically for past financial weeks."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_week_offset < 0) THEN ss_lgb ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""relative_fy_week_offset < 0""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to analyze past week's LGB performance within the current FY."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0 (relative_fy_year_offset)"",
        ""0 (relative_fy_week_offset)""
      ],
      ""governance_issues"": [
        ""Business logic for 'current FY' and 'past week' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue"",
      ""metric_name"": ""Total Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue amount across all periods."",
      ""sql_logic"": ""SUM(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall revenue sum, often used as a base for other calculations or for total dashboard context."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the previous financial year."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for year-over-year growth analysis and historical performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1 (relative_fy_year_offset)""
      ],
      ""governance_issues"": [
        ""Business logic for 'previous FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k_minus_current_fy_lgb_k"",
      ""metric_name"": ""Current FY Gross Revenue (K) - Current FY LGB (K)"",
      ""metric_type"": ""ratio"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_lgb_k""
      ],
      ""business_description"": ""The difference between current financial year's gross revenue (in thousands) and current financial year's LGB (in thousands)."",
      ""sql_logic"": ""SUM(current_fy_gross_revenue_k_calc - current_fy_lgb_k_calc)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Indicates the gap or surplus between actual revenue and forecasted bookings for the current FY."",
      ""metric_category"": ""efficiency"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_lod_date_le_1_year_ago"",
      ""metric_name"": ""Previous FY Gross Revenue (LOD Date <= 1 Year Ago)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""fix_date_lod"",
        ""booking_line_created_date"",
        ""date_one_year_ago""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, specifically where the effective LOD (Last Order Date) is less than or equal to one year ago from a fixed reference date."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1 AND (SAFE_CAST(effective_lod_date AS DATETIME) <= date_one_year_ago)) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1"",
        ""effective_lod_date <= date_one_year_ago""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A specific historical revenue metric, likely used for very precise year-over-year comparisons based on a fixed historical cut-off."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""06/01/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""-1 (relative_fy_year_offset)""
      ],
      ""governance_issues"": [
        ""Hardcoded reference date for 'one year ago' should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_lgb"",
      ""metric_name"": ""Total LGB"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total Likely to Go Booked (LGB) amount across all periods."",
      ""sql_logic"": ""SUM(ss_lgb)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall sum of forecasted bookings, indicating total potential revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k"",
      ""metric_name"": ""Previous FY Gross Revenue (K)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the previous financial year, in thousands."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = -1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Historical revenue in thousands, used for year-over-year percentage change calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1 (relative_fy_year_offset)"",
        ""1000 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'previous FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""next_fy_gross_revenue_k"",
      ""metric_name"": ""Next FY Gross Revenue (K)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum|conditional|mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim"",
        ""gross_revenue_amount""
      ],
      ""business_description"": ""Gross revenue for the next financial year, in thousands."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 1) THEN (gross_revenue_amount / 1000) ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 1""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Forward-looking revenue in thousands, used for future planning and forecasting."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1 (relative_fy_year_offset)"",
        ""1000 (divisor)""
      ],
      ""governance_issues"": [
        ""Business logic for 'next FY' is hardcoded.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_k_minus_current_fy_lgb_k"",
      ""related_metrics"": [
        ""current_fy_gross_revenue_k"",
        ""current_fy_lgb_k""
      ],
      ""relationship_description"": ""This metric is the difference between 'Current FY Gross Revenue (K)' and 'Current FY LGB (K)'."",
      ""mathematical_formula"": ""Current FY Gross Revenue (K) - Current FY LGB (K)"",
      ""business_validation"": ""Measures the variance between actual/non-future revenue and the forecasted LGB for the current financial year. A positive value indicates revenue exceeding LGB, while a negative value indicates LGB exceeding revenue."",
      ""validation_sql"": ""SELECT\n  SUM(current_fy_gross_revenue_k) - SUM(current_fy_lgb_k) AS calculated_difference,\n  SUM(current_fy_gross_revenue_k_minus_current_fy_lgb_k) AS reported_difference\nFROM (\n  -- Insert the primary_analysis_sql here, or a CTE that calculates these metrics\n  -- For brevity, assuming a pre-calculated table or CTE 'metrics_data'\n  SELECT\n    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (gross_revenue_amount / 1000) ELSE 0 END) AS current_fy_gross_revenue_k,\n    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (ss_lgb / 1000) ELSE 0 END) AS current_fy_lgb_k,\n    SUM(CASE WHEN (relative_fy_year_offset = 0) THEN (gross_revenue_amount / 1000) ELSE 0 END - CASE WHEN (relative_fy_year_offset = 0) THEN (ss_lgb / 1000) ELSE 0 END) AS current_fy_gross_revenue_k_minus_current_fy_lgb_k\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\n  WHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\n) AS metrics_data\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_non_future_gross_revenue_k"",
      ""related_metrics"": [
        ""current_fy_gross_revenue"",
        ""is_future_period_flag""
      ],
      ""relationship_description"": ""This metric is derived from 'Current FY Gross Revenue' by excluding records where 'is_future_period_flag' is not 'N' and then dividing by 1000."",
      ""mathematical_formula"": ""SUM(IF(relative_fy_year_offset = 0 AND is_future_period_flag = 'N', gross_revenue_amount, 0)) / 1000"",
      ""business_validation"": ""Ensures that revenue figures for the current FY only include actualized or non-future bookings, providing a more conservative and reliable revenue measure."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN relative_fy_year_offset = 0 AND is_future_period_flag = 'N' THEN gross_revenue_amount ELSE 0 END) / 1000 AS calculated_k,\n  SUM(SAFE_DIVIDE(CASE WHEN (relative_fy_year_offset = 0 AND is_future_period_flag = 'N') THEN gross_revenue_amount ELSE 0 END, 1000)) AS reported_k\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""previous_fy_gross_revenue_lod_date_le_1_year_ago"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue"",
        ""fix_date_lod"",
        ""booking_line_created_date"",
        ""date_one_year_ago""
      ],
      ""relationship_description"": ""This metric is a subset of 'Previous FY Gross Revenue', filtered by a specific date condition on the 'effective_lod_date' relative to a hardcoded 'one year ago' date."",
      ""mathematical_formula"": ""SUM(IF(relative_fy_year_offset = -1 AND effective_lod_date <= date_one_year_ago, gross_revenue_amount, 0))"",
      ""business_validation"": ""Provides a specific historical comparison point, useful for analyzing performance against a fixed prior period baseline. The hardcoded date makes this less dynamic."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS calculated_value,\n  SUM(CASE WHEN relative_fy_year_offset = -1 AND (SAFE_CAST(CASE WHEN (revenue_type = 'DIGITAL' AND revenue_group_subtype = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END AS DATETIME) <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-01-06 23:58:33.668651+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS reported_value\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE PARSE_DATE('%Y-%m-%d', booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,10
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""1a5f7b4e-ea3a-46e4-8b77-b428f4178510"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""sales_group"",
      ""advertiser_parent"",
      ""financial_year"",
      ""revenue_type"",
      ""fin_adtype_name"",
      ""sales_segment_l_2_name_sync"",
      ""gsd""
    ],
    ""date_range_detected"": ""Last FY, Current FY, Next FY (relative to current date)"",
    ""hardcoded_dates_found"": [""02/01/2025""],
    ""hardcoded_values_found"": [
      ""'DOUBLECLICK'"",
      ""'Client'"",
      ""'XTEND'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""account_number IN ('17114', '29172', '52809')"",
      ""'Ian Paterson'"",
      ""'DIGITAL'"",
      ""'Digital Other'"",
      ""'MRCA'"",
      ""sales_segment_l_2_name_sync IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE')"",
      ""'PLUTO'"",
      ""'$'"",
      ""'$\\'000'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative functions"",
      ""lookup values for revenue transaction status, style name, publishing division, ad types, revenue types, sales segments should be managed in reference tables"",
      ""business rules for sales group and GM assignment should be externalized or managed in a dimension table"",
      ""the '$/1000' logic is inconsistently applied due to hardcoded string comparisons and should be reviewed for accuracy and standardization""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH SFCE_USER AS (\n    SELECT\n      TEMP1.network_user_name AS login_name,\n      TEMP1.user_name AS full_name\n    FROM\n      (\n        SELECT\n          UPPER(network_user_name) AS network_user_name,\n          UPPER(user_name) AS user_name,\n          ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n        FROM\n          `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n        WHERE\n          dw_source_system_code = 'SFCE'\n      ) AS TEMP1\n    WHERE\n      TEMP1.RN = 1\n  ),\n  CTE2 AS (\n    SELECT\n      unified_publication_name,\n      unified_publication_gl_code,\n      fy_year_month_number,\n      financial_year,\n      financial_quarter,\n      financial_month,\n      financial_short_month,\n      financial_week,\n      revenue_transaction_status,\n      is_print_digital_flag,\n      current_financial_month,\n      current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE()) AS DOW_Today,\n      sales_segment_l_1_name,\n      sales_segment_l_2_name,\n      sales_segment_l_1_name_sync,\n      sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      advertiser_group,\n      advertiser_parent,\n      SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n      sales_segment_gm_name,\n      CASE\n        WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n        ELSE sales_segment_gm_name_sync\n      END AS sales_segment_gm_name_sync,\n      revenue_group_level_1_name,\n      revenue_group_level_2_name,\n      SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n      SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n      SUM(IFNULL(pipeline, 0)) AS pipeline,\n      SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n      UPPER(revenue_type) AS revenue_type,\n      UPPER(revenue_group_subtype) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      portfolio_group_name_sync,\n      portfolio_group_name_current,\n      portfolio_parent_group_name_sync,\n      nca_industry_pillar,\n      publishing_division_group,\n      publishing_division_parent,\n      is_future_period_flag,\n      ly_is_future_period_flag,\n      ny_is_future_period_flag,\n      cost_model_type,\n      CASE\n        WHEN source_system_code = 'PLUTO' THEN NULL\n        ELSE booking_line_created_date\n      END AS booking_line_created_date,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      portfolio_conformed_name_sync,\n      publishing_division,\n      booking_line_created_week,\n      booking_line_created_month,\n      booking_line_created_short_month,\n      booking_line_created_quarter,\n      booking_line_created_year,\n      agency_parent,\n      agency_group,\n      agency_name,\n      agency_number,\n      calendar_month_name,\n      calendar_year,\n      classification_name,\n      SUM(IFNULL(target, 0)) AS target,\n      IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD\n    FROM\n      `ncau-data-newsquery-prd`.asl_advertising.v_adsales_revenue_client_weekly\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN\n      ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n    WHERE\n      relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n    GROUP BY ALL\n  ),\n  base_data AS (\n    SELECT\n      *,\n      MIN(CASE WHEN advertiser_parent = \""DOUBLECLICK\"" THEN CAST(booking_line_created_date AS DATE) END) OVER (PARTITION BY financial_year) AS fix_date_lod\n    FROM\n      CTE2\n  )\nSELECT\n  -- Dimensions\n  base_data.Sales_Group AS sales_group_dimension,\n  CASE WHEN UPPER(base_data.fin_adtype_name) = 'XTEND' THEN 'XTEND' ELSE UPPER(base_data.revenue_type) END AS fin_adtype_revenue_type_group_dimension,\n  base_data.advertiser_parent AS advertiser_parent_dimension,\n  base_data.financial_year AS financial_year_dim,\n  base_data.revenue_type AS revenue_type_dim,\n  base_data.revenue_group_subtype AS revenue_group_subtype_dim,\n  base_data.sales_segment_l_2_name_sync AS sales_segment_l_2_name_sync_dim,\n  base_data.advertiser_group AS advertiser_group_dim,\n  base_data.advertiser_name AS advertiser_name_dim,\n  base_data.GSD AS gsd_dim,\n  base_data.relative_fy_year_offset AS relative_fy_year_offset_dim,\n  base_data.revenue_transaction_status AS revenue_transaction_status_dim,\n  base_data.style_name AS style_name_dim,\n  base_data.source_publishing_division AS source_publishing_division_dim,\n  base_data.unified_publication_name AS publication_name_dim,\n  base_data.fix_date_lod AS fix_date_lod_dim,\n  base_data.booking_line_created_date AS booking_line_created_date_dim,\n\n  -- Measures\n  SUM(base_data.gross_revenue_amount) AS gross_revenue_amount_base,\n  SUM(base_data.adjustment_amount) AS adjustment_amount_base,\n  SUM(base_data.pub_lgb) AS pub_lgb_base,\n  SUM(base_data.ss_lgb) AS ss_lgb_base,\n  SUM(base_data.pipeline) AS pipeline_base,\n  SUM(base_data.target) AS target_base,\n  SUM(CASE WHEN base_data.relative_fy_year_offset = -1 THEN base_data.gross_revenue_amount ELSE 0 END) AS last_fy_gross_revenue,\n  SUM(CASE WHEN base_data.relative_fy_year_offset = 0 THEN base_data.gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue,\n  SUM(\n    CASE\n      WHEN base_data.relative_fy_year_offset = -1\n      AND (\n        CASE\n          WHEN (\n            UPPER(base_data.revenue_type) = 'DIGITAL'\n            AND UPPER(base_data.revenue_group_subtype) = 'DIGITAL'\n            AND base_data.sales_segment_l_2_name_sync = 'Digital Other'\n            AND base_data.advertiser_parent != 'DOUBLECLICK'\n          ) THEN base_data.fix_date_lod\n          ELSE PARSE_DATE('%Y-%m-%d', base_data.booking_line_created_date)\n        END <= DATE_ADD(CURRENT_DATE(), INTERVAL -365 DAY)\n      ) THEN base_data.gross_revenue_amount\n      ELSE 0\n    END\n  ) AS last_fy_digital_revenue_conditional,\n  MAX(CASE WHEN base_data.relative_fy_year_offset = -1 THEN base_data.gross_revenue_amount ELSE 0 END) AS max_last_fy_gross_revenue\nFROM\n  base_data\nWHERE\n  base_data.Sales_Group = 'Client'\nGROUP BY\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17\nORDER BY\n  financial_year_dim DESC, sales_group_dimension, advertiser_parent_dimension\nLIMIT 10000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT unified_publication_name) as unique_publications,\n  COUNT(DISTINCT advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year,\n  MIN(booking_line_created_date) as earliest_booking_date,\n  MAX(booking_line_created_date) as latest_booking_date,\n  APPROX_COUNT_DISTINCT(CONCAT(financial_year, unified_publication_name, advertiser_parent, sales_segment_l_2_name_sync, revenue_type)) as approx_unique_grain_combinations\nFROM\n  `ncau-data-newsquery-prd`.asl_advertising.v_adsales_revenue_client_weekly\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_parent_test,\n  CASE WHEN MAX(financial_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) - CASE WHEN EXTRACT(MONTH FROM CURRENT_DATE()) >= 7 THEN 0 ELSE 1 END THEN 'PASS' ELSE 'FAIL' END as financial_year_freshness_test,\n  CASE WHEN MAX(booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as booking_date_freshness_test\nFROM\n  `ncau-data-newsquery-prd`.asl_advertising.v_adsales_revenue_client_weekly\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Sales Group Derivation Accuracy' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (sales_segment_l_2_name_sync = 'MRCA' AND (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'MRCA') OR (sales_segment_l_2_name_sync <> 'MRCA' AND (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'Client') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (sales_segment_l_2_name_sync = 'MRCA' AND (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'MRCA') OR (sales_segment_l_2_name_sync <> 'MRCA' AND (CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END) = 'Client') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd`.asl_advertising.v_adsales_revenue_client_weekly\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nLIMIT 10000;"",
    ""sample_data_sql"": ""SELECT\n  financial_year,\n  financial_quarter,\n  financial_month,\n  financial_week,\n  booking_line_created_date,\n  advertiser_parent,\n  advertiser_group,\n  advertiser_name,\n  sales_segment_l_2_name_sync,\n  revenue_type,\n  revenue_group_subtype,\n  gross_revenue_amount,\n  adjustment_amount,\n  pub_lgb,\n  ss_lgb,\n  pipeline,\n  target,\n  relative_fy_year_offset,\n  revenue_transaction_status,\n  style_name,\n  source_system_code,\n  current_portfolio_group_owner_sync,\n  unified_publication_name,\n  account_number,\n  fin_adtype_name\nFROM\n  `ncau-data-newsquery-prd`.asl_advertising.v_adsales_revenue_client_weekly\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\nORDER BY\n  financial_year DESC, booking_line_created_date DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""02/01/2025"",
          ""original_format"": ""2025-01-02 01:26:03.721975+00"",
          ""context"": ""Used as a fixed reference date for calculating a conditional revenue metric (last_fy_digital_revenue_conditional). A date 365 days prior (2024-01-02) is used as a cutoff."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter to ensure dynamic and relevant date filtering."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'$'"", ""'$\\'000'""],
          ""context"": ""These string comparisons are used in CASE statements to conditionally apply a division by 1000. The condition `'$' = '$'` (always true) prevents division by 1000 in Query 1's final metrics. The condition `'$\\'000' = '$'` (always false) *enables* division by 1000 in Query 3's final metrics. This leads to inconsistent scaling (some metrics are raw, some are /1000) within the same dashboard, which is a significant data accuracy and user experience issue."",
          ""suggested_governance"": ""Standardize the display of monetary values across the dashboard (either always raw or always in thousands). Remove the misleading conditional logic and apply the scaling consistently, or remove the scaling logic if raw values are intended. This should be driven by business requirements and user expectations."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'DOUBLECLICK'"", ""'XTEND'"", ""'BILLED'"", ""'BOOKED'"", ""'ROP COMPOSITE'"", ""'MEDIUM RARE CONTENT AGENCY'"", ""'SUDDENLY%'"", ""'DIGITAL'"", ""'Digital Other'"", ""'MRCA'"", ""'PLUTO'""],
          ""context"": ""Various categorical values used for filtering or deriving new dimensions (e.g., advertiser_parent, fin_adtype_name, revenue_transaction_status, style_name, source_publishing_division, revenue_type, sales_segment_l_2_name_sync, source_system_code)."",
          ""suggested_governance"": ""These values should ideally be managed in a central reference or dimension table (e.g., `dim_advertiser_type`, `dim_revenue_status`, `dim_product_style`). This allows for easier updates, consistency across dashboards, and better data governance."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Client'"", ""account_number IN ('17114', '29172', '52809')"", ""sales_segment_l_2_name_sync IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE')"", ""'Ian Paterson'""],
          ""context"": ""Specific business rules for categorizing sales groups, handling publication names, and assigning sales GMs. For example, 'Client' is derived from 'MRCA', and 'Ian Paterson' is hardcoded for specific sales segments."",
          ""suggested_governance"": ""These business rules should be externalized. For sales groups and GM assignments, consider a `dim_sales_segment` table with `sales_segment_l_2_name_sync`, `sales_group_derived`, and `sales_gm_derived` columns. For publication name exceptions, a `dim_publication_exceptions` table could be used."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [""-1"", ""0"", ""1""],
          ""context"": ""Used for filtering `relative_fy_year_offset` to include last, current, and next financial years."",
          ""suggested_governance"": ""While these are common relative offsets, consider if they should be dynamic based on user selection (e.g., a parameter for 'number of past years to include')."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded date '2025-01-02' with a dashboard date parameter or `CURRENT_DATE()` for dynamic date calculations."",
      ""Implement a parameter for the financial year offset range (e.g., `fy_offset_start`, `fy_offset_end`) instead of hardcoding `(-1, 0, 1)`."",
      ""Externalize lookup values (e.g., revenue transaction statuses, style names, advertiser types) into dedicated reference tables and join to them instead of using hardcoded string comparisons."",
      ""Externalize complex business rules (e.g., sales group derivation, GM assignment, publication exceptions) into configuration tables or views to improve maintainability and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""sales_group_dimension"",
      ""metric_name"": ""Sales Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorizes sales segments into 'MRCA' or 'Client' based on sales_segment_l_2_name_sync."",
      ""sql_logic"": ""CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping sales performance by broad client categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'MRCA'"", ""'Client'""],
      ""governance_issues"": [""business rule hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fin_adtype_revenue_type_group_dimension"",
      ""metric_name"": ""Ad Type / Revenue Type Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Groups financial ad types, specifically mapping 'XTEND' and defaulting to the revenue type."",
      ""sql_logic"": ""CASE WHEN UPPER(fin_adtype_name) = 'XTEND' THEN 'XTEND' ELSE UPPER(revenue_type) END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for analyzing revenue by specific ad type or general revenue type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'XTEND'""],
      ""governance_issues"": [""lookup value hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_parent_dimension"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent advertiser name."",
      ""sql_logic"": ""advertiser_parent"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for grouping sales performance by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount_base"",
      ""metric_name"": ""Gross Revenue Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Fundamental building block for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""last_fy_gross_revenue"",
      ""metric_name"": ""Last FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_base""],
      ""business_description"": ""Total gross revenue for the last financial year (relative_fy_year_offset = -1). Based on Query 1's logic, this metric is displayed as raw values (not divided by 1000), though Query 3 applies a /1000 division for a similar calculation."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [""relative_fy_year_offset IN (-1, 0, 1)"", ""revenue_transaction_status IN ('BILLED', 'BOOKED')"", ""style_name <> 'ROP COMPOSITE'"", ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"", ""publication_name filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for year-over-year comparison of sales revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""-1""],
      ""governance_issues"": [""relative_fy_year_offset hardcoded"", ""inconsistent scaling with other dashboard metrics""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_base""],
      ""business_description"": ""Total gross revenue for the current financial year (relative_fy_year_offset = 0). Based on Query 1's logic, this metric is displayed as raw values (not divided by 1000), though Query 3 applies a /1000 division for a similar calculation."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [""relative_fy_year_offset IN (-1, 0, 1)"", ""revenue_transaction_status IN ('BILLED', 'BOOKED')"", ""style_name <> 'ROP COMPOSITE'"", ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"", ""publication_name filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for tracking current sales revenue against targets and prior periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0""],
      ""governance_issues"": [""relative_fy_year_offset hardcoded"", ""inconsistent scaling with other dashboard metrics""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_fy_digital_revenue_conditional"",
      ""metric_name"": ""Last FY Digital Revenue (Conditional)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""gross_revenue_amount_base"", ""fix_date_lod_dim"", ""booking_line_created_date_dim"", ""revenue_type_dim"", ""revenue_group_subtype_dim"", ""sales_segment_l_2_name_sync_dim"", ""advertiser_parent_dim""],
      ""business_description"": ""Gross revenue for the last financial year, specifically for 'Digital' revenue types, 'Digital Other' sales segments, excluding 'DOUBLECLICK' advertiser_parent, and where the relevant date is before a hardcoded cutoff date (2024-01-02). This metric is displayed as raw values (not divided by 1000)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 AND (CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END <= DATE_ADD(DATE '2025-01-02', INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [""relative_fy_year_offset IN (-1, 0, 1)"", ""revenue_transaction_status IN ('BILLED', 'BOOKED')"", ""style_name <> 'ROP COMPOSITE'"", ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"", ""publication_name filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A specific, highly filtered revenue metric likely used for a particular digital revenue analysis or reconciliation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""02/01/2025""],
      ""hardcoded_values_in_metric"": [""-1"", ""'DIGITAL'"", ""'Digital Other'"", ""'DOUBLECLICK'""],
      ""governance_issues"": [""hardcoded date"", ""hardcoded lookup values"", ""complex business logic embedded""],
      ""data_quality_concerns"": [""reliance on specific date for cutoff"", ""potential for misinterpretation due to complex conditions""]
    },
    {
      ""metric_id"": ""max_last_fy_gross_revenue"",
      ""metric_name"": ""Max Last FY Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""gross_revenue_amount_base""],
      ""business_description"": ""The maximum gross revenue amount recorded for the last financial year. This metric is displayed as raw values (not divided by 1000)."",
      ""sql_logic"": ""MAX(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [""relative_fy_year_offset IN (-1, 0, 1)"", ""revenue_transaction_status IN ('BILLED', 'BOOKED')"", ""style_name <> 'ROP COMPOSITE'"", ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"", ""publication_name filter""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Potentially used for identifying peak revenue transactions in the last FY."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""-1""],
      ""governance_issues"": [""relative_fy_year_offset hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjustment_amount_base"",
      ""metric_name"": ""Adjustment Amount (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw adjustment amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(adjustment_amount, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for understanding revenue adjustments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""pub_lgb_base"",
      ""metric_name"": ""Pub LGB (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw 'pub_lgb' amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(pub_lgb, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific internal metric, likely related to publishing revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""ss_lgb_base"",
      ""metric_name"": ""SS LGB (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw 'ss_lgb' amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(ss_lgb, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific internal metric, likely related to sales segment revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""pipeline_base"",
      ""metric_name"": ""Pipeline (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw 'pipeline' amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(pipeline, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents potential future revenue in the sales pipeline."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    },
    {
      ""metric_id"": ""target_base"",
      ""metric_name"": ""Target (Base)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw 'target' amount from the source system."",
      ""sql_logic"": ""SUM(IFNULL(target, 0))"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents sales targets for comparison against actual revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls handled by IFNULL""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""last_fy_gross_revenue"",
      ""related_metrics"": [""gross_revenue_amount_base""],
      ""relationship_description"": ""Last FY Gross Revenue is a conditional sum of the base gross revenue amount."",
      ""mathematical_formula"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)"",
      ""business_validation"": ""Ensures that only revenue from the previous financial year is included for comparison."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS last_fy_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE financial_year = (SELECT financial_year FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 LIMIT 1) - 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [""gross_revenue_amount_base""],
      ""relationship_description"": ""Current FY Gross Revenue is a conditional sum of the base gross revenue amount."",
      ""mathematical_formula"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""business_validation"": ""Ensures that only revenue from the current financial year is included for tracking."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE financial_year = (SELECT financial_year FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = 0 LIMIT 1)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""last_fy_digital_revenue_conditional"",
      ""related_metrics"": [""gross_revenue_amount_base"", ""revenue_type_dim"", ""revenue_group_subtype_dim"", ""sales_segment_l_2_name_sync_dim"", ""advertiser_parent_dim"", ""fix_date_lod_dim"", ""booking_line_created_date_dim""],
      ""relationship_description"": ""This metric is a highly specific subset of last FY gross revenue, filtered by multiple digital-related dimensions and a hardcoded date cutoff."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE relative_fy_year_offset = -1 AND (digital_conditions AND date_condition)"",
      ""business_validation"": ""Used for specific digital revenue analysis, but its complexity and hardcoded date make it prone to misinterpretation or staleness."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = -1 AND (CASE WHEN (UPPER(revenue_type) = 'DIGITAL' AND UPPER(revenue_group_subtype) = 'DIGITAL' AND sales_segment_l_2_name_sync = 'Digital Other' AND advertiser_parent != 'DOUBLECLICK') THEN fix_date_lod ELSE PARSE_DATE('%Y-%m-%d', booking_line_created_date) END <= DATE_ADD(DATE '2025-01-02', INTERVAL -365 DAY)) THEN gross_revenue_amount ELSE 0 END) AS conditional_digital_revenue FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset = -1 LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,11
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c560ed20-040d-4c6a-9c3f-ec8bce27d132"",
    ""dashboard_name"": ""Xtend Details"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""calendar_year"",
      ""calendar_month"",
      ""publication_name"",
      ""advertiser_name"",
      ""advertiser_group"",
      ""booking_number"",
      ""revenue_type"",
      ""source_unified_publication_name"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""revenue_group_subtype""
    ],
    ""date_range_detected"": ""2022 to 2025 (Calendar Year), 202x (Financial Year)"",
    ""hardcoded_dates_found"": [""202"", ""2022"", ""2024"", ""2025""],
    ""hardcoded_values_found"": [
      ""'Medium Rare Content Agency'"",
      ""'Billed'"",
      ""'Booked'"",
      ""'Digital'"",
      ""'Print'"",
      ""'INTERNAL PUIG Oceania'"",
      ""'PUIG Oceania'"",
      ""'Greyhound Racing Victoria'""
    ],
    ""governance_opportunities"": [
      ""financial_year and calendar_year should be parameterised or use relative date functions"",
      ""source_publishing_division, revenue_transaction_status, revenue_group_subtype, and advertiser_name should use governed reference tables or parameters""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.publication_name,\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.advertiser_name,\n    t0.calendar_month,\n    t0.calendar_year,\n    t0.revenue_group_subtype,\n    t0.advertiser_group,\n    t0.booking_number,\n    t0.gross_revenue_amount,\n    t0.revenue_type,\n    t0.source_unified_publication_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.source_publishing_division != 'Medium Rare Content Agency'\n    AND t0.revenue_transaction_status IN ('Billed', 'Booked')\n    AND t0.financial_year IS NOT NULL\n    -- Broad date range for analysis, replace hardcoded years with dynamic ones\n    AND t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 3 AS STRING)\n    AND t0.calendar_year <= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) + 1 AS STRING)\n)\nSELECT\n  financial_year,\n  calendar_year,\n  calendar_month,\n  publication_name,\n  advertiser_name,\n  advertiser_group,\n  booking_number,\n  revenue_type,\n  source_unified_publication_name,\n  revenue_transaction_status,\n  source_publishing_division,\n  revenue_group_subtype,\n  SAFE_CAST(calendar_month AS FLOAT64) AS calendar_month_float, -- From Q2\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount -- From Q3\nFROM base_data\nGROUP BY\n  financial_year,\n  calendar_year,\n  calendar_month,\n  publication_name,\n  advertiser_name,\n  advertiser_group,\n  booking_number,\n  revenue_type,\n  source_unified_publication_name,\n  revenue_transaction_status,\n  source_publishing_division,\n  revenue_group_subtype\nORDER BY\n  calendar_year DESC, calendar_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT t0.calendar_year) as unique_calendar_years,\n  COUNT(DISTINCT t0.calendar_month) as unique_calendar_months,\n  COUNT(DISTINCT t0.publication_name) as unique_publications,\n  COUNT(DISTINCT t0.advertiser_name) as unique_advertisers,\n  COUNT(DISTINCT t0.booking_number) as unique_bookings,\n  MIN(t0.calendar_year) as earliest_calendar_year,\n  MAX(t0.calendar_year) as latest_calendar_year,\n  MIN(t0.financial_year) as earliest_financial_year,\n  MAX(t0.financial_year) as latest_financial_year,\n  SUM(CASE WHEN t0.gross_revenue_amount IS NULL THEN 1 ELSE 0 END) AS null_gross_revenue_amount_count\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 5 AS STRING)\n  AND t0.calendar_year <= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) + 1 AS STRING)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_advertiser_test,\n  CASE WHEN MAX(t0.calendar_year) >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS STRING) THEN 'PASS' ELSE 'FAIL' END as freshness_test_calendar_year,\n  CASE WHEN MAX(t0.financial_year) >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS STRING) THEN 'PASS' ELSE 'FAIL' END as freshness_test_financial_year\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 1 AS STRING)\n  AND t0.revenue_transaction_status IN ('Billed', 'Booked')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Exclude Medium Rare Content Agency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 1 AS STRING)\n  AND t0.revenue_transaction_status IN ('Billed', 'Booked')\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Include Billed/Booked Status' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 1 AS STRING)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.financial_year,\n  t0.publication_name,\n  t0.revenue_transaction_status,\n  t0.source_publishing_division,\n  t0.advertiser_name,\n  t0.calendar_month,\n  t0.calendar_year,\n  t0.revenue_group_subtype,\n  t0.advertiser_group,\n  t0.booking_number,\n  t0.gross_revenue_amount,\n  t0.revenue_type,\n  t0.source_unified_publication_name\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.calendar_year >= CAST(EXTRACT(YEAR FROM CURRENT_DATE()) - 1 AS STRING)\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY t0.calendar_year DESC, t0.calendar_month DESC, t0.gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""202"",
          ""original_format"": ""202"",
          ""context"": ""financial_year filter in Query 1"",
          ""suggested_fix"": ""replace with parameter or relative financial year calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or a financial year lookup)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2022"",
          ""original_format"": ""2022"",
          ""context"": ""calendar_year exclusion filter in Query 2"",
          ""suggested_fix"": ""replace with parameter or relative calendar year calculation"",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2024"",
          ""original_format"": ""2024"",
          ""context"": ""calendar_year inclusion filter in Query 3"",
          ""suggested_fix"": ""replace with parameter or relative calendar year calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""calendar_year inclusion filter in Query 3"",
          ""suggested_fix"": ""replace with parameter or relative calendar year calculation"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Medium Rare Content Agency'""],
          ""context"": ""source_publishing_division exclusion filter (all queries)"",
          ""suggested_governance"": ""use a configuration table for excluded divisions or a parameter"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Billed'"", ""'Booked'""],
          ""context"": ""revenue_transaction_status inclusion filter (all queries)"",
          ""suggested_governance"": ""use a reference table for transaction statuses or a parameter"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Digital'"", ""'Print'""],
          ""context"": ""revenue_group_subtype inclusion filter (Query 2, Query 3)"",
          ""suggested_governance"": ""use a reference table for revenue subtypes or a parameter"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'INTERNAL PUIG Oceania'"", ""'PUIG Oceania'""],
          ""context"": ""advertiser_name inclusion filter (Query 2)"",
          ""suggested_governance"": ""use an advertiser master table or a parameter"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Greyhound Racing Victoria'""],
          ""context"": ""advertiser_name inclusion filter (Query 3)"",
          ""suggested_governance"": ""use an advertiser master table or a parameter"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (financial_year, calendar_year) with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)"",
      ""Replace hardcoded lookup values (e.g., 'Medium Rare Content Agency', 'Billed', 'Booked', 'Digital', 'Print', specific advertiser names) with joins to governed reference tables or user-selectable parameters"",
      ""Use configuration tables for business rules instead of hardcoded logic for exclusions/inclusions""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the publication associated with the advertising revenue."",
      ""sql_logic"": ""t0.publication_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""financial_year IN ('202')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter and group revenue data by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""202""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'""],
      ""governance_issues"": [""financial_year '202' should be parameterised"", ""hardcoded filter values for division and status""],
      ""data_quality_concerns"": ""Potential for '202' to be an incomplete year, leading to data gaps.""
    },
    {
      ""metric_id"": ""calendar_month_float"",
      ""metric_name"": ""Calendar Month (Float)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Calendar month of the transaction, cast to a float for unknown reason (likely for sorting or specific visualization)."",
      ""sql_logic"": ""SAFE_CAST(t0.calendar_month AS FLOAT64)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year NOT IN ('2022')"",
        ""advertiser_name IN ('INTERNAL PUIG Oceania', 'PUIG Oceania')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for time-series analysis or grouping by month, specific to certain advertisers and revenue types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2022""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'INTERNAL PUIG Oceania'"", ""'PUIG Oceania'""],
      ""governance_issues"": [""calendar_year '2022' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""SAFE_CAST can result in NULLs if data is malformed.""
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue generated from advertising transactions."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for specific advertisers, revenue types, and time periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""Accuracy depends on the underlying gross_revenue_amount data.""
    },
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group to which an advertiser belongs."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level grouping of revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific name of the advertiser."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year NOT IN ('2022')"",
        ""advertiser_name IN ('INTERNAL PUIG Oceania', 'PUIG Oceania')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for detailed revenue analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2022"", ""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'INTERNAL PUIG Oceania'"", ""'PUIG Oceania'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2022', '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""booking_number"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an advertising booking."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for granular tracking of individual bookings."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""calendar_year"",
      ""metric_name"": ""Calendar Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The calendar year of the transaction."",
      ""sql_logic"": ""t0.calendar_year"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year NOT IN ('2022')"",
        ""advertiser_name IN ('INTERNAL PUIG Oceania', 'PUIG Oceania')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2022"", ""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'INTERNAL PUIG Oceania'"", ""'PUIG Oceania'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2022', '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of revenue generated (e.g., display, native)."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue streams."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""source_unified_publication_name"",
      ""metric_name"": ""Source Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unified name of the publication from which the revenue originated."",
      ""sql_logic"": ""t0.source_unified_publication_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_group_subtype IN ('Digital', 'Print')"",
        ""calendar_year IN ('2024', '2025')"",
        ""advertiser_name IN ('Greyhound Racing Victoria')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping revenue by publication, potentially a standardized version of publication_name."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2024"", ""2025""],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'"", ""'Billed'"", ""'Booked'"", ""'Digital'"", ""'Print'"", ""'Greyhound Racing Victoria'""],
      ""governance_issues"": [""calendar_year '2024', '2025' should be parameterised"", ""hardcoded filter values for division, status, subtype, and advertiser""],
      ""data_quality_concerns"": ""None identified.""
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""financial_year IS NOT NULL"", ""financial_year IN ('202')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key time dimension for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""202""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""financial_year '202' should be parameterised""],
      ""data_quality_concerns"": ""Potential for '202' to be an incomplete year.""
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_gross_revenue_amount"",
      ""related_metrics"": [
        ""publication_name"",
        ""financial_year"",
        ""calendar_year"",
        ""calendar_month_float"",
        ""advertiser_name"",
        ""advertiser_group"",
        ""booking_number"",
        ""revenue_type"",
        ""source_unified_publication_name"",
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""All identified dimensions and filters directly impact the aggregated 'Total Gross Revenue Amount' by defining the scope of transactions included in the sum. Specific filters from the original queries (e.g., specific advertiser names, calendar years) narrow down the revenue calculation significantly."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [filters] GROUP BY [dimensions]"",
      ""business_validation"": ""Revenue figures are highly dependent on the selected time periods, transaction statuses, publishing divisions, revenue subtypes, and advertisers. Changes in these filters will directly alter the reported revenue."",
      ""validation_sql"": ""SELECT SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE source_publishing_division != 'Medium Rare Content Agency' AND revenue_transaction_status IN ('Billed', 'Booked') AND calendar_year IN ('2024', '2025') AND advertiser_name IN ('Greyhound Racing Victoria') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,12
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""bb49fa78-5abe-4e68-a9c1-8172a832e724"",
    ""dashboard_name"": ""optimization"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""masthead_group"",
      ""finance_recognition"",
      ""fy_year"",
      ""fy_week_of_year"",
      ""fy_month_of_year"",
      ""fy_quarter_of_year""
    ],
    ""date_range_detected"": ""Calculations are based on a specific 'current' date (26/03/2025 or 25/03/2025) and a baseline (03/07/2024). The underlying data likely covers a broader range, but the queries focus on a single point in time."",
    ""hardcoded_dates_found"": [
      ""26/03/2025"",
      ""25/03/2025"",
      ""03/07/2024""
    ],
    ""hardcoded_values_found"": [
      ""'Discontinued'"",
      ""'Digital Recognition'"",
      ""2025"",
      ""1"",
      ""2"",
      ""3"",
      ""4"",
      ""5"",
      ""10"",
      ""14"",
      ""18"",
      ""23"",
      ""27"",
      ""31"",
      ""36"",
      ""40"",
      ""44"",
      ""49"",
      ""13"",
      ""26"",
      ""39"",
      ""53"",
      ""'Week to Date & Budget View'"",
      ""'Week to Date & Forecast View'"",
      ""'Week to Date & Year on Year View'"",
      ""'Week to Date & NY Budget View'"",
      ""'Month to Date & Budget View'"",
      ""'Month to Date & Forecast View'"",
      ""'Month to Date & NY Budget View'"",
      ""'Quarter to Date & Budget View'"",
      ""'Quarter to Date & Forecast View'"",
      ""'Quarter to Date & Year on Year View'"",
      ""'Quarter to Date & NY Budget View'"",
      ""'Year to Date & Budget View'"",
      ""'Year to Date & Forecast View'"",
      ""'Year to Date & Year on Year View'"",
      ""'Year to Date & NY Budget View'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""fiscal calendar mappings should be in a lookup table"",
      ""view type strings should be defined centrally""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""DECLARE current_report_date DATE DEFAULT DATE(TIMESTAMP '2025-03-26 03:31:44.896010+00', 'Australia/Sydney');\nDECLARE baseline_date DATETIME DEFAULT DATETIME '2024-07-03T00:00:00';\n\nWITH\n  date_calculations AS (\n    SELECT\n      EXTRACT(DAYOFWEEK FROM TIMESTAMP(current_report_date)) - 1 AS day_of_week_num,\n      DATETIME_DIFF(SAFE_CAST(current_report_date AS DATETIME), SAFE_CAST(baseline_date AS DATETIME), WEEK) AS weeks_diff_from_baseline,\n      EXTRACT(YEAR FROM current_report_date) AS current_fy_year_dynamic\n  ),\n  calculated_week_num AS (\n    SELECT\n      dc.current_fy_year_dynamic,\n      CASE\n        WHEN dc.day_of_week_num <= 2 THEN dc.weeks_diff_from_baseline - 1\n        ELSE dc.weeks_diff_from_baseline\n      END AS current_fy_week_calculated\n    FROM date_calculations dc\n  ),\n  base_data AS (\n    SELECT\n      t0.BudgetEarnedAmount,\n      t0.ClosingBase,\n      t0.EarnedAmount,\n      t0.ForecastBudgetEarnedAmount,\n      t0.NFEarnedAmount,\n      t0.NYBudgetEarnedAmount,\n      t0.OpeningBase,\n      t0.finance_recognition,\n      t0.fy_month_of_year,\n      t0.fy_quarter_of_year,\n      t0.fy_week_of_year,\n      t0.fy_year,\n      t0.masthead_group\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` AS t0\n    WHERE\n      t0.masthead_group != 'Discontinued'\n      AND t0.finance_recognition = 'Digital Recognition'\n  )\nSELECT\n  bd.masthead_group,\n  SUM(\n    CASE\n      WHEN bd.fy_year = (SELECT current_fy_year_dynamic FROM calculated_week_num) AND bd.fy_week_of_year = (SELECT current_fy_week_calculated FROM calculated_week_num) THEN bd.BudgetEarnedAmount\n      ELSE 0\n    END\n  ) AS budget_earned_amount_current_fy_week,\n  SUM(\n    CASE\n      WHEN bd.fy_year = (SELECT current_fy_year_dynamic FROM calculated_week_num) AND bd.fy_week_of_year = (SELECT current_fy_week_calculated FROM calculated_week_num) THEN bd.EarnedAmount\n      ELSE 0\n    END\n  ) AS earned_amount_current_fy_week,\n  SUM(\n    CASE\n      WHEN bd.fy_year = (SELECT current_fy_year_dynamic FROM calculated_week_num) AND bd.fy_week_of_year = (SELECT current_fy_week_calculated FROM calculated_week_num) THEN bd.ClosingBase\n      ELSE 0\n    END\n  ) AS closing_base_current_fy_week,\n  SUM(\n    CASE\n      WHEN bd.fy_year = (SELECT current_fy_year_dynamic FROM calculated_week_num) AND bd.fy_week_of_year = (SELECT current_fy_week_calculated FROM calculated_week_num) THEN bd.OpeningBase\n      ELSE 0\n    END\n  ) AS opening_base_current_fy_week,\n  MAX(1) AS record_presence_flag,\n  'Week to Date & Budget View' AS view_type_dimension,\n  COUNT(DISTINCT 'Week to Date & Budget View') AS distinct_view_type_count\nFROM\n  base_data bd\nGROUP BY\n  bd.masthead_group\nORDER BY\n  bd.masthead_group\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fy_year) as unique_fiscal_years,\n  COUNT(DISTINCT fy_week_of_year) as unique_fiscal_weeks,\n  COUNT(DISTINCT masthead_group) as unique_masthead_groups,\n  MIN(fy_year) as earliest_fiscal_year,\n  MAX(fy_year) as latest_fiscal_year,\n  APPROX_COUNT_DISTINCT(CONCAT(CAST(fy_year AS STRING), '-', CAST(fy_week_of_year AS STRING), '-', masthead_group)) as approx_unique_records_at_week_masthead_grain\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(BudgetEarnedAmount) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_earned_amount_test,\n  CASE WHEN SUM(EarnedAmount) > 0 THEN 'PASS' ELSE 'FAIL' END as earned_amount_test,\n  CASE WHEN COUNT(DISTINCT masthead_group) > 0 THEN 'PASS' ELSE 'FAIL' END as masthead_group_test,\n  CASE WHEN MAX(fy_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE finance_recognition = 'Digital Recognition'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Digital Recognition Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN finance_recognition = 'Digital Recognition' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) \n  AND masthead_group != 'Discontinued'\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT \n  BudgetEarnedAmount,\n  ClosingBase,\n  EarnedAmount,\n  ForecastBudgetEarnedAmount,\n  NFEarnedAmount,\n  NYBudgetEarnedAmount,\n  OpeningBase,\n  finance_recognition,\n  fy_month_of_year,\n  fy_quarter_of_year,\n  fy_week_of_year,\n  fy_year,\n  masthead_group\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1\n  AND finance_recognition = 'Digital Recognition'\nORDER BY fy_year DESC, fy_week_of_year DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""26/03/2025"",
          ""original_format"": ""2025-03-26 03:31:44.896010+00"",
          ""context"": ""Used as the primary 'current' date for calculating the fiscal week in Query 1."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a Looker Studio date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""25/03/2025"",
          ""original_format"": ""2025-03-25 23:59:29.736172+00"",
          ""context"": ""Used as the primary 'current' date for calculating the fiscal week in Query 2."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a Looker Studio date parameter, and ensure consistency with other 'current' date definitions."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""03/07/2024"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a fixed baseline date for DATETIME_DIFF to calculate week numbers."",
          ""suggested_fix"": ""If this is a fixed fiscal year start, it should be documented and potentially stored in a configuration table. Otherwise, consider a dynamic baseline (e.g., start of current fiscal year)."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Discontinued'"",
            ""'Digital Recognition'""
          ],
          ""context"": ""Filters applied to `masthead_group` and `finance_recognition` columns."",
          ""suggested_governance"": ""These values should be managed in a reference table (e.g., `dim_masthead_status`, `dim_finance_recognition_type`) and joined to the main table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""2025""
          ],
          ""context"": ""Fiscal year `2025` is hardcoded for filtering current year data."",
          ""suggested_governance"": ""Replace with `EXTRACT(YEAR FROM CURRENT_DATE())` or a Looker Studio parameter for the fiscal year."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""1"",
            ""2"",
            ""3"",
            ""4"",
            ""5"",
            ""10"",
            ""14"",
            ""18"",
            ""23"",
            ""27"",
            ""31"",
            ""36"",
            ""40"",
            ""44"",
            ""49"",
            ""13"",
            ""26"",
            ""39"",
            ""53""
          ],
          ""context"": ""Numeric values used in `CASE` statements to map week numbers to fiscal months and quarters."",
          ""suggested_governance"": ""These fiscal calendar mappings should be stored in a dedicated `dim_fiscal_calendar` table, allowing for flexible and auditable fiscal period definitions."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Week to Date & Budget View'"",
            ""'Week to Date & Forecast View'"",
            ""'Week to Date & Year on Year View'"",
            ""'Week to Date & NY Budget View'"",
            ""'Month to Date & Budget View'"",
            ""'Month to Date & Forecast View'"",
            ""'Month to Date & NY Budget View'"",
            ""'Quarter to Date & Budget View'"",
            ""'Quarter to Date & Forecast View'"",
            ""'Quarter to Date & Year on Year View'"",
            ""'Quarter to Date & NY Budget View'"",
            ""'Year to Date & Budget View'"",
            ""'Year to Date & Forecast View'"",
            ""'Year to Date & Year on Year View'"",
            ""'Year to Date & NY Budget View'""
          ],
          ""context"": ""String literals defining 'view types' in Query 3."",
          ""suggested_governance"": ""These view types should be defined in a configuration table or as Looker Studio parameters/fields, rather than hardcoded in SQL."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-03-26', '2024-07-03') with Looker Studio date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)`)."",
      ""Replace hardcoded fiscal year (e.g., `2025`) with a dynamic calculation (`EXTRACT(YEAR FROM CURRENT_DATE())`) or a Looker Studio parameter."",
      ""Externalize fiscal calendar mappings (week to month/quarter) into a dedicated dimension table (`dim_fiscal_calendar`) to allow for flexible and auditable fiscal period definitions."",
      ""Manage business rule values (e.g., 'Discontinued', 'Digital Recognition') and view type strings in governed reference tables or Looker Studio field definitions, rather than hardcoding them in SQL.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""budget_earned_amount_current_fy_week"",
      ""metric_name"": ""Budget Earned Amount (Current Fiscal Year & Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of Budget Earned Amount for the current fiscal year and the calculated current fiscal week, based on a specific reporting date."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = [current_fy_year] AND t0.fy_week_of_year = [calculated_current_fy_week] THEN t0.BudgetEarnedAmount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'"",
        ""fy_year = [current_fy_year]"",
        ""fy_week_of_year = [calculated_current_fy_week]""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key financial metric for tracking budget performance against actuals for the current reporting period, typically used for weekly performance reviews."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""26/03/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025""
      ],
      ""governance_issues"": [
        ""date used for current week calculation is hardcoded"",
        ""fiscal year is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""reliance on accurate fy_week_of_year mapping""
      ]
    },
    {
      ""metric_id"": ""earned_amount_current_fy_week"",
      ""metric_name"": ""Earned Amount (Current Fiscal Year & Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of Earned Amount for the current fiscal year and the calculated current fiscal week, based on a specific reporting date."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = [current_fy_year] AND t0.fy_week_of_year = [calculated_current_fy_week] THEN t0.EarnedAmount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'"",
        ""fy_year = [current_fy_year]"",
        ""fy_week_of_year = [calculated_current_fy_week]""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core financial metric representing actual revenue earned for the current reporting period, crucial for performance monitoring."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""26/03/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025""
      ],
      ""governance_issues"": [
        ""date used for current week calculation is hardcoded"",
        ""fiscal year is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""reliance on accurate fy_week_of_year mapping""
      ]
    },
    {
      ""metric_id"": ""closing_base_current_fy_week"",
      ""metric_name"": ""Closing Base (Current Fiscal Year & Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of Closing Base (e.g., subscriber count) for the current fiscal year and the calculated current fiscal week."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = [current_fy_year] AND t0.fy_week_of_year = [calculated_current_fy_week] THEN t0.ClosingBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'"",
        ""fy_year = [current_fy_year]"",
        ""fy_week_of_year = [calculated_current_fy_week]""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the closing subscriber base or similar metric at the end of the current reporting week, indicating growth or decline."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""26/03/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025""
      ],
      ""governance_issues"": [
        ""date used for current week calculation is hardcoded"",
        ""fiscal year is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""reliance on accurate fy_week_of_year mapping""
      ]
    },
    {
      ""metric_id"": ""opening_base_current_fy_week"",
      ""metric_name"": ""Opening Base (Current Fiscal Year & Week)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of Opening Base (e.g., subscriber count) for the current fiscal year and the calculated current fiscal week."",
      ""sql_logic"": ""SUM(CASE WHEN t0.fy_year = [current_fy_year] AND t0.fy_week_of_year = [calculated_current_fy_week] THEN t0.OpeningBase ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'"",
        ""fy_year = [current_fy_year]"",
        ""fy_week_of_year = [calculated_current_fy_week]""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the opening subscriber base or similar metric at the beginning of the current reporting week, used for tracking changes over the period."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""26/03/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""2025""
      ],
      ""governance_issues"": [
        ""date used for current week calculation is hardcoded"",
        ""fiscal year is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""reliance on accurate fy_week_of_year mapping""
      ]
    },
    {
      ""metric_id"": ""record_presence_flag"",
      ""metric_name"": ""Record Presence Flag"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""max"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag indicating the presence of at least one record matching the applied filters. Always 1 if records exist, 0 otherwise."",
      ""sql_logic"": ""MAX(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'"",
        ""finance_recognition = 'Digital Recognition'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely used internally by Looker Studio for conditional formatting, visibility, or simple existence checks, rather than a direct business metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""view_type_dimension"",
      ""metric_name"": ""View Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A hardcoded string representing the current dashboard view type. Based on the query logic, this will always resolve to 'Week to Date & Budget View'."",
      ""sql_logic"": ""CASE WHEN (1 = 1) THEN 'Week to Date & Budget View' WHEN (1 = 2) THEN 'Week to Date & Forecast View' ... ELSE NULL END (simplifies to 'Week to Date & Budget View')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Likely used to label the current view or filter options within the dashboard, indicating the specific data perspective being displayed."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Week to Date & Budget View'"",
        ""'Week to Date & Forecast View'"",
        ""'Week to Date & Year on Year View'"",
        ""'Week to Date & NY Budget View'"",
        ""'Month to Date & Budget View'"",
        ""'Month to Date & Forecast View'"",
        ""'Month to Date & NY Budget View'"",
        ""'Quarter to Date & Budget View'"",
        ""'Quarter to Date & Forecast View'"",
        ""'Quarter to Date & Year on Year View'"",
        ""'Quarter to Date & NY Budget View'"",
        ""'Year to Date & Budget View'"",
        ""'Year to Date & Forecast View'"",
        ""'Year to Date & Year on Year View'"",
        ""'Year to Date & NY Budget View'""
      ],
      ""governance_issues"": [
        ""view type strings are hardcoded and not dynamic""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""distinct_view_type_count"",
      ""metric_name"": ""Distinct View Type Count"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""view_type_dimension""
      ],
      ""business_description"": ""Counts the number of distinct view types. Given the hardcoded logic, this metric will always resolve to 1."",
      ""sql_logic"": ""COUNT(DISTINCT 'Week to Date & Budget View')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions""
      ],
      ""filters_applied"": [
        ""masthead_group != 'Discontinued'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely an internal Looker Studio mechanism or a check for the number of active view types, not a direct business metric for analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Week to Date & Budget View'""
      ],
      ""governance_issues"": [
        ""view type strings are hardcoded""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""budget_earned_amount_current_fy_week"",
      ""related_metrics"": [
        ""earned_amount_current_fy_week"",
        ""closing_base_current_fy_week"",
        ""opening_base_current_fy_week""
      ],
      ""relationship_description"": ""All 'Current Fiscal Year & Week' metrics (Budget Earned Amount, Earned Amount, Closing Base, Opening Base) are calculated using the same underlying logic for determining the 'current' fiscal year and week. This means they are inherently linked by the date context."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensuring the 'current' fiscal period calculation is accurate and consistent is critical for the validity of all these financial metrics. Any change to the date logic affects all of them."",
      ""validation_sql"": ""SELECT \n  (EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-26', 'Australia/Sydney'))) - 1) AS day_of_week_q1,\n  DATETIME_DIFF(SAFE_CAST(DATE('2025-03-26', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS weeks_diff_q1,\n  (EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-25', 'Australia/Sydney'))) - 1) AS day_of_week_q2,\n  DATETIME_DIFF(SAFE_CAST(DATE('2025-03-25', 'Australia/Sydney') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS weeks_diff_q2\n-- Verify that the derived 'current_fy_week_calculated' is consistent across queries if the intent is for them to show the same week."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""distinct_view_type_count"",
      ""related_metrics"": [
        ""view_type_dimension""
      ],
      ""relationship_description"": ""The 'Distinct View Type Count' metric directly depends on the 'View Type' dimension. Since the 'View Type' dimension is hardcoded to a single value ('Week to Date & Budget View'), the distinct count will always be 1."",
      ""mathematical_formula"": ""COUNT(DISTINCT view_type_dimension)"",
      ""business_validation"": ""This interaction confirms that the distinct count is not a meaningful business metric for variability, but rather a technical artifact of the dashboard's design."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT (CASE WHEN (1 = 1) THEN 'Week to Date & Budget View' ELSE NULL END)) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dt_digital_subscriptions` LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,13
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b15d856f-e3ce-4991-bf2a-92395390524f"",
    ""dashboard_name"": ""Programmatic Rolling 60 Day Overview_NQ Data"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""ProductType"",
      ""TransactionType"",
      ""TransactionCategory""
    ],
    ""date_range_detected"": ""Rolling 60 days from Current"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Guaranteed'"",
      ""'Deal'"",
      ""'Open Auction'"",
      ""'pmp'"",
      ""'PG - CPM'"",
      ""'AG'"",
      ""'PMP_DEAL'"",
      ""'RTB'"",
      ""'PG - CPD'"",
      ""'Unknown'"",
      ""'UFR'""
    ],
    ""governance_opportunities"": [
      ""TransactionType categorization should be externalized to a lookup table.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN FOR UNIFIED ANALYSIS\n-- This query provides the base data with all derived dimensions and the core measure,\n-- allowing for flexible aggregation in the dashboard to reproduce the original metrics.\nWITH base_data AS (\n  SELECT\n    t0.ProductType,\n    t0.RevenueNet,\n    t0.TransactionType,\n    -- Derived TransactionCategory based on business rules\n    CASE\n      WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed'\n      WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal'\n      WHEN (t0.TransactionType = 'RTB' OR t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'Unknown') THEN 'Open Auction'\n      ELSE SAFE_CAST(t0.TransactionType AS STRING) -- Fallback for unmapped values\n    END AS TransactionCategory\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0\n  -- The 'programmatic_60_day_view' implies a rolling 60-day window.\n  -- If the view does not implicitly filter by date, a date column (e.g., `event_date` or `_PARTITIONTIME`) would be needed here.\n  -- Example: WHERE t0.event_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY)\n)\nSELECT\n  ProductType,\n  TransactionCategory,\n  SUM(RevenueNet) AS total_revenue_net\nFROM base_data\nGROUP BY\n  ProductType,\n  TransactionCategory\nORDER BY\n  total_revenue_net DESC\nLIMIT 1000; -- Sample limit for analysis and cost optimization"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT ProductType) as unique_product_types,\n  COUNT(DISTINCT TransactionType) as unique_transaction_types,\n  SUM(RevenueNet) as total_revenue_net_sum\n  -- Add MIN/MAX date if a date column exists in the view, e.g., MIN(event_date) as earliest_date, MAX(event_date) as latest_date\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(RevenueNet) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT ProductType) > 0 THEN 'PASS' ELSE 'FAIL' END as product_type_exists_test,\n  CASE WHEN COUNT(DISTINCT TransactionType) > 0 THEN 'PASS' ELSE 'FAIL' END as transaction_type_exists_test\n  -- Add date freshness check if a date column is available, e.g., CASE WHEN MAX(event_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality for TransactionType categorization\nWITH transaction_mapping AS (\n  SELECT\n    TransactionType,\n    CASE\n      WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n      WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n      WHEN (TransactionType = 'RTB' OR TransactionType = 'Open Auction' OR TransactionType = 'Unknown') THEN 'Open Auction'\n      ELSE SAFE_CAST(TransactionType AS STRING)\n    END AS TransactionCategory\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'TransactionType Categorization' as rule_name,\n  COUNT(*) as total_records,\n  SUM(CASE WHEN TransactionCategory IN ('Guaranteed', 'Deal', 'Open Auction') THEN 1 ELSE 0 END) as records_mapped_to_known_category,\n  SUM(CASE WHEN TransactionCategory NOT IN ('Guaranteed', 'Deal', 'Open Auction') THEN 1 ELSE 0 END) as records_mapped_to_other_category,\n  SAFE_DIVIDE(SUM(CASE WHEN TransactionCategory IN ('Guaranteed', 'Deal', 'Open Auction') THEN 1 ELSE 0 END), COUNT(*)) * 100 as mapped_percentage\nFROM transaction_mapping\nLIMIT 1;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  ProductType,\n  RevenueNet,\n  TransactionType,\n  -- Include derived TransactionCategory for context\n  CASE\n    WHEN (TransactionType = 'AG' OR TransactionType = 'PG - CPM' OR TransactionType = 'PG - CPD') THEN 'Guaranteed'\n    WHEN (TransactionType = 'Deal' OR TransactionType = 'pmp' OR TransactionType = 'PMP_DEAL' OR TransactionType = 'UFR') THEN 'Deal'\n    WHEN (TransactionType = 'RTB' OR TransactionType = 'Open Auction' OR TransactionType = 'Unknown') THEN 'Open Auction'\n    ELSE SAFE_CAST(TransactionType AS STRING)\n  END AS TransactionCategory\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`\nWHERE RevenueNet IS NOT NULL -- Filter out null revenue for meaningful samples\nORDER BY RevenueNet DESC -- Order by revenue to see high-value transactions\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Deal'"",
            ""'pmp'"",
            ""'PG - CPM'"",
            ""'AG'"",
            ""'PMP_DEAL'"",
            ""'RTB'"",
            ""'PG - CPD'"",
            ""'Open Auction'"",
            ""'Unknown'"",
            ""'UFR'"",
            ""'Guaranteed'"",
            ""'Deal'"",
            ""'Open Auction'""
          ],
          ""context"": ""TransactionType values are hardcoded in a CASE statement to derive TransactionCategory."",
          ""suggested_governance"": ""Create a `transaction_type_lookup` table with `original_transaction_type` and `mapped_category` columns. Join to this table instead of hardcoding."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded lookup values for TransactionType categorization with joins to a governed reference table."",
      ""If the `programmatic_60_day_view` does not inherently manage the date range, introduce a date parameter for the rolling window (e.g., `DATE_SUB(CURRENT_DATE(), INTERVAL @days_back DAY)`).""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_revenue_by_product_type"",
      ""metric_name"": ""Total Revenue by Product Type"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total net revenue generated, broken down by different product types."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to understand revenue contribution from different product offerings within programmatic advertising."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueNet""
      ]
    },
    {
      ""metric_id"": ""product_type"",
      ""metric_name"": ""Product Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of advertising products (e.g., display, video, native) as recorded in the source system."",
      ""sql_logic"": ""t0.ProductType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary grouping dimension for analyzing revenue performance across different product lines."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for inconsistent naming or typos in source data""
      ]
    },
    {
      ""metric_id"": ""total_revenue_by_transaction_category"",
      ""metric_name"": ""Total Revenue by Transaction Category"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""transaction_category""
      ],
      ""business_description"": ""The total net revenue generated, categorized by the type of programmatic transaction (e.g., Guaranteed, Deal, Open Auction)."",
      ""sql_logic"": ""SUM(t0.RevenueNet) GROUP BY (CASE WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal' WHEN (t0.TransactionType = 'RTB' OR t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'Unknown') THEN 'Open Auction' ELSE t0.TransactionType END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for understanding revenue distribution across different programmatic buying models and strategies."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'"",
        ""'pmp'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PMP_DEAL'"",
        ""'RTB'"",
        ""'PG - CPD'"",
        ""'Unknown'"",
        ""'UFR'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in RevenueNet"",
        ""unmapped TransactionType values will fall into ELSE clause, potentially showing raw TransactionType values""
      ]
    },
    {
      ""metric_id"": ""transaction_category"",
      ""metric_name"": ""Transaction Category"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A derived categorization of raw `TransactionType` values into broader, more business-friendly groups: 'Guaranteed', 'Deal', 'Open Auction'."",
      ""sql_logic"": ""CASE WHEN (t0.TransactionType = 'AG' OR t0.TransactionType = 'PG - CPM' OR t0.TransactionType = 'PG - CPD') THEN 'Guaranteed' WHEN (t0.TransactionType = 'Deal' OR t0.TransactionType = 'pmp' OR t0.TransactionType = 'PMP_DEAL' OR t0.TransactionType = 'UFR') THEN 'Deal' WHEN (t0.TransactionType = 'RTB' OR t0.TransactionType = 'Open Auction' OR t0.TransactionType = 'Unknown') THEN 'Open Auction' ELSE t0.TransactionType END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for analyzing programmatic revenue streams by business model and understanding the mix of direct vs. auction-based transactions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Deal'"",
        ""'Open Auction'"",
        ""'pmp'"",
        ""'PG - CPM'"",
        ""'AG'"",
        ""'PMP_DEAL'"",
        ""'RTB'"",
        ""'PG - CPD'"",
        ""'Unknown'"",
        ""'UFR'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""unmapped TransactionType values will fall into ELSE clause, potentially showing raw TransactionType values which might not be desired for reporting""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""total_revenue_by_product_type"",
      ""related_metrics"": [
        ""total_revenue_by_transaction_category""
      ],
      ""relationship_description"": ""Both metrics represent different aggregations (slices) of the same underlying `RevenueNet` measure. The sum of `total_revenue_by_product_type` across all product types should equal the sum of `total_revenue_by_transaction_category` across all transaction categories, assuming the same underlying data and filters."",
      ""mathematical_formula"": ""SUM(total_revenue_by_product_type) = SUM(total_revenue_by_transaction_category)"",
      ""business_validation"": ""Ensures consistency in total revenue reporting across different analytical views and provides confidence in the data's integrity."",
      ""validation_sql"": ""SELECT\n  (SELECT SUM(RevenueNet) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view`) AS total_revenue_from_source,\n  (SELECT SUM(t0_qt_qrna4jodrd) FROM (SELECT clmn0_, SUM(clmn1_) AS t0_qt_qrna4jodrd FROM (SELECT t0.ProductType AS clmn0_, t0.RevenueNet AS clmn1_ FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0) GROUP BY clmn0_)) AS total_revenue_from_product_type_agg,\n  (SELECT SUM(t0_qt_ac6k8jodrd) FROM (SELECT clmn13_ AS t0_qt_0v7k8jodrd, SUM(clmn0_) AS t0_qt_ac6k8jodrd FROM (SELECT CASE WHEN (clmn6_ OR clmn5_ OR clmn9_) THEN 'Guaranteed' WHEN (clmn3_ OR clmn4_ OR clmn7_ OR clmn12_) THEN 'Deal' WHEN (clmn10_ OR clmn8_ OR clmn11_) THEN 'Open Auction' ELSE clmn2_ END AS clmn13_, clmn0_ FROM (SELECT SAFE_CAST(clmn1_ AS STRING) AS clmn2_, (clmn1_ = 'Deal') AS clmn3_, (clmn1_ = 'pmp') AS clmn4_, (clmn1_ = 'PG - CPM') AS clmn5_, (clmn1_ = 'AG') AS clmn6_, (clmn1_ = 'PMP_DEAL') AS clmn7_, (clmn1_ = 'RTB') AS clmn8_, (clmn1_ = 'PG - CPD') AS clmn9_, (clmn1_ = 'Open Auction') AS clmn10_, (clmn1_ = 'Unknown') AS clmn11_, (clmn1_ = 'UFR') AS clmn12_, clmn0_ FROM (SELECT t0.RevenueNet AS clmn0_, t0.TransactionType AS clmn1_ FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_60_day_view` AS t0)))) GROUP BY t0_qt_0v7k8jodrd)) AS total_revenue_from_transaction_category_agg"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,14
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d3bcf796-2396-4a6f-b0a3-da0b7f299a58"",
    ""dashboard_name"": ""Publisher and Product Performance Dashboard - FY25 v2"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 2,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_week"",
      ""advertiser_group"",
      ""fin_adtype_name"",
      ""product_group""
    ],
    ""date_range_detected"": ""Current (based on financial_week)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Commercial Content'"",
      ""'Free News & Lifestyle'"",
      ""'State & Communities'"",
      ""'The Australian & Prestige'"",
      ""'Unknown'"",
      ""''""
    ],
    ""governance_opportunities"": [
      ""Product group names should be managed in a governed reference table and joined, rather than hardcoded in queries.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates key ad sales performance metrics based on inferred schema from 'adsales_performance' table.\n-- It includes the dimensions identified in the provided Looker Studio filter queries.\n-- Replace placeholder metrics (e.g., total_revenue, total_impressions) with actual column names from your table.\n\nWITH AdSalesData AS (\n  SELECT\n    t0.financial_week,\n    t0.advertiser_group,\n    t0.fin_adtype_name,\n    t0.product_group,\n    -- Assuming these are common metrics in an ad sales performance table\n    SAFE_CAST(t0.revenue AS NUMERIC) AS total_revenue,\n    SAFE_CAST(t0.impressions AS INT64) AS total_impressions,\n    SAFE_CAST(t0.clicks AS INT64) AS total_clicks,\n    SAFE_CAST(t0.cost AS NUMERIC) AS total_cost\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE\n    -- Apply common dashboard filters for product_group\n    t0.product_group IN (\n      'Commercial Content',\n      'Free News & Lifestyle',\n      'State & Communities',\n      'The Australian & Prestige',\n      '' -- Includes the empty string filter from query 3\n    )\n    AND (t0.product_group NOT IN ('Unknown') OR t0.product_group IS NULL) -- From query 2\n    -- Add a typical date filter for performance dashboards (e.g., last 12 financial weeks)\n    AND t0.financial_week >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 12\n)\nSELECT\n  financial_week,\n  advertiser_group,\n  fin_adtype_name,\n  product_group,\n  SUM(total_revenue) AS sum_total_revenue,\n  SUM(total_impressions) AS sum_total_impressions,\n  SUM(total_clicks) AS sum_total_clicks,\n  SUM(total_cost) AS sum_total_cost,\n  SAFE_DIVIDE(SUM(total_revenue), SUM(total_impressions)) AS revenue_per_impression,\n  SAFE_DIVIDE(SUM(total_clicks), SUM(total_impressions)) AS click_through_rate\nFROM AdSalesData\nGROUP BY\n  financial_week,\n  advertiser_group,\n  fin_adtype_name,\n  product_group\nORDER BY\n  financial_week DESC,\n  advertiser_group,\n  fin_adtype_name,\n  product_group\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_week) as unique_financial_weeks,\n  COUNT(DISTINCT advertiser_group) as unique_advertiser_groups,\n  COUNT(DISTINCT fin_adtype_name) as unique_fin_adtype_names,\n  COUNT(DISTINCT product_group) as unique_product_groups,\n  MIN(financial_week) as earliest_financial_week,\n  MAX(financial_week) as latest_financial_week,\n  APPROX_COUNT_DISTINCT(CONCAT(financial_week, '-', advertiser_group, '-', fin_adtype_name, '-', product_group)) as approx_unique_combinations\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_week >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 52;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_existence_test,\n  CASE WHEN MAX(financial_week) >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 4 THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN SUM(CASE WHEN product_group IS NULL THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END as product_group_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_week >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 4\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality for product_group\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Product Group Filtering' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige', '') THEN 1 ELSE 0 END) as records_matching_filter_set_1,\n  SUM(CASE WHEN product_group NOT IN ('Unknown') OR product_group IS NULL THEN 1 ELSE 0 END) as records_matching_filter_set_2,\n  SUM(CASE WHEN product_group = 'Unknown' THEN 1 ELSE 0 END) as records_with_unknown_product_group,\n  SUM(CASE WHEN product_group = '' THEN 1 ELSE 0 END) as records_with_empty_product_group\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_week >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 12;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  financial_week,\n  advertiser_group,\n  fin_adtype_name,\n  product_group,\n  -- Assuming these are actual columns in your table\n  revenue,\n  impressions,\n  clicks,\n  cost\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_week >= (SELECT MAX(financial_week) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`) - 4\nORDER BY financial_week DESC, revenue DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Commercial Content'"",
            ""'Free News & Lifestyle'"",
            ""'State & Communities'"",
            ""'The Australian & Prestige'""
          ],
          ""context"": ""Used in WHERE clause to filter `product_group` for `advertiser_group` dimension lookup."",
          ""suggested_governance"": ""These product group names should be stored in a `product_group_master` reference table and joined to the `adsales_performance` table, or used as parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Unknown'""
          ],
          ""context"": ""Used in WHERE clause to exclude `product_group` values for `fin_adtype_name` dimension lookup."",
          ""suggested_governance"": ""The 'Unknown' category should be handled consistently, potentially by defining it in a reference table or using a standard `COALESCE` or `IFNULL` pattern if it represents missing data."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""''""
          ],
          ""context"": ""Used in WHERE clause to filter `product_group` for `financial_week` dimension lookup."",
          ""suggested_governance"": ""Empty string values for `product_group` should be addressed. Either they represent a valid category that should be named, or they indicate missing/invalid data that should be cleaned or excluded explicitly."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded product group names with parameters in Looker Studio, allowing users to select from a dynamic list."",
      ""Implement a `product_group_master` reference table in BigQuery and join to it for filtering and categorisation, ensuring data consistency and easier maintenance."",
      ""Consider using a date parameter for the `financial_week` filter (e.g., `_DS_FINANCIAL_WEEK_START_` or `_DS_FINANCIAL_WEEK_END_`) instead of relative `MAX(financial_week) - N` logic, if Looker Studio supports financial week parameters.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of advertisers, used for filtering and grouping ad sales performance data."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Commercial Content', 'Free News & Lifestyle', 'State & Communities', 'The Australian & Prestige')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of ad sales performance by different advertiser segments."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Commercial Content'"",
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""Hardcoded product group values should be managed in a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the financial advertising type, used for filtering and grouping ad sales performance data."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group NOT IN ('Unknown') OR product_group IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows breakdown of ad sales performance by specific advertising product types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Unknown'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'Unknown' value should be managed consistently.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week number, typically used for time-series analysis and filtering."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_week AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('Free News & Lifestyle', 'State & Communities', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for trend analysis and reporting performance over specific financial periods."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Hardcoded product group values and empty string should be managed in a reference table or cleaned.""
      ],
      ""data_quality_concerns"": [
        ""Potential for non-numeric values if SAFE_CAST fails, though unlikely for financial week.""
      ]
    },
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A key dimension used across multiple filters to segment ad sales performance by product category."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Central to segmenting and analyzing ad sales data by different product lines or content types. Its values are frequently hardcoded in dashboard filters."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Commercial Content'"",
        ""'Free News & Lifestyle'"",
        ""'State & Communities'"",
        ""'The Australian & Prestige'"",
        ""'Unknown'"",
        ""''""
      ],
      ""governance_issues"": [
        ""Extensive hardcoding of product group values across multiple queries. This is a significant governance risk and should be replaced by a governed lookup table or parameters.""
      ],
      ""data_quality_concerns"": [
        ""Presence of 'Unknown' and empty string values suggests potential data quality issues or inconsistent categorization.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""product_group"",
      ""related_metrics"": [
        ""advertiser_group"",
        ""fin_adtype_name"",
        ""financial_week""
      ],
      ""relationship_description"": ""The 'product_group' dimension is used as a filter for retrieving distinct values of 'advertiser_group', 'fin_adtype_name', and 'financial_week'. This implies that the selection of product groups directly influences the available options for these other dimensions in the dashboard's filters."",
      ""mathematical_formula"": ""N/A (filter relationship)"",
      ""business_validation"": ""Ensures that users can filter other dimensions based on specific product categories, providing contextual filtering capabilities. However, the hardcoded nature of these filters limits flexibility."",
      ""validation_sql"": ""SELECT DISTINCT product_group FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE product_group IN ('Free News & Lifestyle', 'State & Communities', '');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,15
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f353b933-30eb-4853-9976-d35371db7d7"",
    ""dashboard_name"": ""Month End Reporting Reconcilation"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 3,
    ""consolidation_score"": 10,
    ""total_metrics_identified"": 2,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [""month_name""],
    ""date_range_detected"": ""Not explicitly filtered in SQL (likely 'All Time' or controlled by Looker Studio UI)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [],
    ""governance_opportunities"": [
      ""The metric 'sum_of_fiscal_month_numbers' appears unusual for a reconciliation report and might indicate a misconfigured calculation or a placeholder. Review its business purpose and ensure the correct column is being summed.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for business analysis based on the provided queries.\n-- Note: The metric 'sum_of_fiscal_month_numbers' is unusual for a reconciliation report.\n-- It sums the fiscal month number itself, not a financial amount. It might indicate a misconfigured calculation.\nSELECT\n  t0.month_name AS month_name_dimension,\n  COUNT(t0.fy_month_num) AS record_count_by_month,\n  SUM(t0.fy_month_num) AS sum_of_fiscal_month_numbers\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation` AS t0\n-- No date filter was present in the original query. For practical analysis, you would typically add a date filter here, e.g.:\n-- WHERE t0.transaction_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH) -- Assuming 'transaction_date' exists in the table\nGROUP BY\n  t0.month_name\nORDER BY\n  t0.month_name -- Order by month_name (alphabetical) or by fy_month_num if available as a dimension for proper chronological sorting\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fy_month_num) as unique_fiscal_months,\n  COUNT(DISTINCT month_name) as unique_month_names,\n  MIN(fy_month_num) as earliest_fiscal_month_num,\n  MAX(fy_month_num) as latest_fiscal_month_num,\n  -- Assuming a 'transaction_date' column for typical GL data, adjust if column name differs\n  MIN(transaction_date) as earliest_transaction_date,\n  MAX(transaction_date) as latest_transaction_date,\n  APPROX_COUNT_DISTINCT(transaction_id) as approx_unique_transactions -- Assuming a 'transaction_id' column\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation`\nWHERE transaction_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY); -- Sample recent data for structure analysis"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN COUNT(fy_month_num) > 0 THEN 'PASS' ELSE 'FAIL' END as record_count_test,\n  CASE WHEN SUM(fy_month_num) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as sum_metric_test,\n  CASE WHEN COUNT(DISTINCT month_name) > 0 THEN 'PASS' ELSE 'FAIL' END as month_name_dimension_test\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation`\nWHERE transaction_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) -- Assuming 'transaction_date' exists\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Non-zero fy_month_num check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN fy_month_num > 0 THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN fy_month_num > 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation`\nWHERE transaction_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY); -- Assuming 'transaction_date' exists"",
    ""sample_data_sql"": ""SELECT \n  fy_month_num,\n  month_name,\n  -- Include other relevant columns for GL reconciliation if they exist (e.g., transaction_id, account_id, debit_amount, credit_amount, transaction_date, description)\n  -- For example, assuming these columns exist:\n  transaction_id,\n  account_id,\n  debit_amount,\n  credit_amount,\n  transaction_date,\n  description\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation`\nWHERE transaction_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY) -- Sample recent data\nORDER BY transaction_date DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": []
    },
    ""parameterisation_recommendations"": [
      ""Implement date parameters in Looker Studio to allow users to select custom date ranges instead of relying on 'All Time' data or implicit date filtering."",
      ""If 'fy_month_num' was mistakenly used for summation instead of a financial amount, update the Looker Studio field definition to use the correct column (e.g., 'debit_amount', 'credit_amount', or 'transaction_amount').""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""record_count_by_month"",
      ""metric_name"": ""Record Count by Month"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Counts the number of records (e.g., transactions or ledger entries) present in the 'dv_gl_reconciliation' table for each fiscal month. This can indicate the volume of activity."",
      ""sql_logic"": ""COUNT(t0.fy_month_num)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""],
      ""filters_applied"": [""None explicitly in SQL (Looker Studio UI might apply filters)""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a volume indicator for the general ledger reconciliation process, showing how many entries are processed or available for each month. If 'fy_month_num' is never NULL, this is equivalent to a simple COUNT(*)."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""If 'fy_month_num' can be NULL, this count might differ from COUNT(*), potentially undercounting records.""]
    },
    {
      ""metric_id"": ""sum_of_fiscal_month_numbers"",
      ""metric_name"": ""Sum of Fiscal Month Numbers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Sums the numerical value of the fiscal month (e.g., 1 for January, 2 for February) for all records within each month. This is an unusual metric for a financial reconciliation dashboard and strongly suggests a misconfiguration where a financial amount column (e.g., debit_amount, credit_amount) was intended for summation."",
      ""sql_logic"": ""SUM(t0.fy_month_num)"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""],
      ""filters_applied"": [""None explicitly in SQL (Looker Studio UI might apply filters)""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Its business utility is unclear in a reconciliation context. It might be a proxy for volume weighted by month number, or a misconfigured metric. Further investigation with the dashboard owner is highly recommended to clarify its intended purpose."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Potential misconfiguration: 'fy_month_num' is likely not the intended column for summation in a financial context. Review the business requirement for this metric and correct the underlying field definition in Looker Studio.""],
      ""data_quality_concerns"": [""The meaning and utility of this sum are ambiguous. If 'fy_month_num' is not always consistent for a given 'month_name' (e.g., if data spans multiple fiscal years where Jan 2023 is 1 and Jan 2024 is 1), the sum would still be consistent per month name, but its interpretation remains odd.""]
    },
    {
      ""metric_id"": ""month_name_dimension"",
      ""metric_name"": ""Month Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the fiscal month (e.g., 'January', 'February'), used as the primary grouping dimension for the reconciliation data."",
      ""sql_logic"": ""t0.month_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.sbx_fda_corefin.dv_gl_reconciliation""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""This is a key dimension for time-based analysis and reporting of monthly reconciliation figures, allowing users to view metrics broken down by month."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Consistency of month names (e.g., 'Jan' vs 'January' vs 'JAN'). Ensure consistent formatting for proper grouping and sorting.""]
    }
  ],
  ""metric_interactions"": []
}
```",success,16
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""77c68c35-20ce-477a-b216-0c781d43a8ca"",
    ""dashboard_name"": ""Cecile - Adsales Adhoc Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 8,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_week"",
      ""source_system_code"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""invoice_number"",
      ""fiscal_week_id"",
      ""os_level_5"",
      ""unified_publication_gl_code"",
      ""data_load_datetime""
    ],
    ""date_range_detected"": ""FY2025 (Financial Year) & FW202548-FW202551 (Fiscal Weeks)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202548"",
      ""202549"",
      ""202550"",
      ""202551""
    ],
    ""hardcoded_values_found"": [
      ""Booked"",
      ""Billed"",
      ""Medium Rare Content Agency"",
      ""-1"",
      ""PLUTO"",
      ""CPQ"",
      ""ADPT"",
      ""9707"",
      ""9655"",
      ""9658""
    ],
    ""governance_opportunities"": [
      ""Financial years and fiscal weeks should be parameterised or derived from a date dimension table."",
      ""Revenue transaction statuses, publishing divisions, source system codes, and GL codes should be managed via governed reference tables instead of hardcoded values.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query consolidates key metrics from the 'v_adsales_revenue_client' table, which appears to be the primary focus of the 'Adsales Adhoc Analysis' dashboard. Metrics from 'finance_operating_statement' are not included here as they originate from a different dataset with no apparent join key.\nWITH AdSalesData AS (\n  SELECT\n    t0.financial_year,\n    t0.financial_week,\n    t0.gross_revenue_amount,\n    t0.invoice_number,\n    t0.revenue_transaction_status,\n    t0.source_publishing_division,\n    t0.source_system_code,\n    t0.data_load_datetime,\n    t0.unified_publication_gl_code\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n)\nSELECT\n  financial_year AS financial_year_dimension,\n  financial_week AS financial_week_dimension,\n  source_system_code AS source_system_code_dimension,\n  DATETIME_TRUNC(data_load_datetime, SECOND) AS data_load_datetime_truncated,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(SAFE_CAST(financial_week AS INT64)) AS sum_financial_week_int\nFROM AdSalesData\nWHERE\n  revenue_transaction_status IN ('Booked', 'Billed')\n  AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)\n  AND invoice_number = '-1'\n  AND source_system_code IN ('PLUTO', 'CPQ', 'ADPT')\n  AND financial_year = '2025' -- Hardcoded: Consider replacing with a parameter (e.g., @financial_year) or relative date logic (e.g., EXTRACT(YEAR FROM CURRENT_DATE()) + 1)\n  AND unified_publication_gl_code IN ('9707', '9655', '9658') -- Hardcoded: Consider joining to a 'unified_publication_gl_code_master' reference table\nGROUP BY\n  financial_year,\n  financial_week,\n  source_system_code,\n  DATETIME_TRUNC(data_load_datetime, SECOND)\nORDER BY\n  financial_year DESC, total_gross_revenue_amount DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT financial_week) as unique_financial_weeks,\n  COUNT(DISTINCT source_system_code) as unique_source_systems,\n  COUNT(DISTINCT revenue_transaction_status) as unique_transaction_statuses,\n  COUNT(DISTINCT unified_publication_gl_code) as unique_gl_codes,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year,\n  MIN(data_load_datetime) as earliest_data_load_datetime,\n  MAX(data_load_datetime) as latest_data_load_datetime\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Sample for the relevant year\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT financial_year) = 1 AND MAX(financial_year) = '2025' THEN 'PASS' ELSE 'FAIL' END as financial_year_filter_test,\n  CASE WHEN COUNTIF(revenue_transaction_status IN ('Booked', 'Billed')) = COUNT(*) THEN 'PASS' ELSE 'FAIL' END as transaction_status_filter_test,\n  CASE WHEN MAX(data_load_datetime) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as data_freshness_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  financial_year = '2025'\n  AND revenue_transaction_status IN ('Booked', 'Billed')\n  AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)\n  AND invoice_number = '-1'\n  AND source_system_code IN ('PLUTO', 'CPQ', 'ADPT')\n  AND unified_publication_gl_code IN ('9707', '9655', '9658')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Focus on the relevant year for the dashboard\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Source Publishing Division Exclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025'\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Invoice Number -1 Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN invoice_number = '-1' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN invoice_number = '-1' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025'\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Source System Code Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN source_system_code IN ('PLUTO', 'CPQ', 'ADPT') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN source_system_code IN ('PLUTO', 'CPQ', 'ADPT') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025'\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Unified Publication GL Code Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN unified_publication_gl_code IN ('9707', '9655', '9658') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN unified_publication_gl_code IN ('9707', '9655', '9658') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025';"",
    ""sample_data_sql"": ""SELECT \n  financial_year,\n  financial_week,\n  gross_revenue_amount,\n  invoice_number,\n  revenue_transaction_status,\n  source_publishing_division,\n  source_system_code,\n  data_load_datetime,\n  unified_publication_gl_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE\n  financial_year = '2025' -- Sample for the relevant year\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  data_load_datetime DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter in ad sales revenue queries"",
          ""suggested_fix"": ""replace with a parameter or relative date function (e.g., CURRENT_FINANCIAL_YEAR())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202548"",
          ""original_format"": ""202548"",
          ""context"": ""fiscal_week_id filter in finance operating statement query"",
          ""suggested_fix"": ""replace with a parameter or derive from a date dimension table"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202549"",
          ""original_format"": ""202549"",
          ""context"": ""fiscal_week_id filter in finance operating statement query"",
          ""suggested_fix"": ""replace with a parameter or derive from a date dimension table"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202550"",
          ""original_format"": ""202550"",
          ""context"": ""fiscal_week_id filter in finance operating statement query"",
          ""suggested_fix"": ""replace with a parameter or derive from a date dimension table"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202551"",
          ""original_format"": ""202551"",
          ""context"": ""fiscal_week_id filter in finance operating statement query"",
          ""suggested_fix"": ""replace with a parameter or derive from a date dimension table"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""revenue_transaction_status filter"",
          ""suggested_governance"": ""join to a 'revenue_transaction_status_master' reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""exclusion filter for source_publishing_division"",
          ""suggested_governance"": ""manage excluded divisions in a configuration table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'-1'""
          ],
          ""context"": ""invoice_number filter (likely for specific transaction types)"",
          ""suggested_governance"": ""clarify business meaning of '-1' and manage via a lookup or configuration table if it represents a specific category"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'"",
            ""'CPQ'"",
            ""'ADPT'""
          ],
          ""context"": ""source_system_code filter"",
          ""suggested_governance"": ""join to a 'source_system_master' reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'9707'"",
            ""'9655'"",
            ""'9658'""
          ],
          ""context"": ""unified_publication_gl_code filter"",
          ""suggested_governance"": ""join to a 'gl_code_master' reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years and fiscal week IDs with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., transaction statuses, source systems, GL codes) with joins to governed reference tables or configuration tables."",
      ""Externalize business rules (e.g., excluded publishing divisions, special invoice numbers) into configuration tables for easier maintenance and transparency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""financial_year_dimension"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""None"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the ad sales revenue transaction."",
      ""sql_logic"": ""t0.financial_year AS clmn1_"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for yearly aggregation and filtering of ad sales revenue data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""year should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount_sum"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of gross revenue amounts for ad sales transactions, filtered by specific criteria (booked/billed status, specific source systems, excluding a particular publishing division, and for a specific invoice type)."",
      ""sql_logic"": ""SUM(clmn2_) AS t0_qt_awwg752qqd (where clmn2_ is t0.gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for ad sales performance analysis, focusing on specific types of revenue transactions and systems."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'-1'"",
        ""'PLUTO'"",
        ""'CPQ'"",
        ""'ADPT'""
      ],
      ""governance_issues"": [
        ""year should be parameterised"",
        ""transaction statuses should use reference table"",
        ""publishing division should use reference table"",
        ""invoice number filter needs clarification/governance"",
        ""source system codes should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week_dimension"",
      ""metric_name"": ""Financial Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""None"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial week associated with the ad sales revenue transaction."",
      ""sql_logic"": ""t0.financial_week AS clmn0_ (then aliased as clmn7_ and t0_qt_i5ozi72qqd)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for weekly aggregation and analysis of ad sales revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'-1'"",
        ""'PLUTO'"",
        ""'CPQ'"",
        ""'ADPT'""
      ],
      ""governance_issues"": [
        ""year should be parameterised"",
        ""transaction statuses should use reference table"",
        ""publishing division should use reference table"",
        ""invoice number filter needs clarification/governance"",
        ""source system codes should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_week_int_sum"",
      ""metric_name"": ""Sum of Financial Week (as INT64)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_week_dimension""
      ],
      ""business_description"": ""The sum of financial week numbers, cast to INT64. This is an unusual metric, likely used for internal sorting or an intermediate calculation rather than a direct business metric."",
      ""sql_logic"": ""SUM(SAFE_CAST(clmn0_ AS INT64)) AS t0_qt_ztwme82qqd (where clmn0_ is t0.financial_week)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Appears to be an internal calculation or sorting mechanism for the dashboard, not a primary business metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'-1'"",
        ""'PLUTO'"",
        ""'CPQ'"",
        ""'ADPT'""
      ],
      ""governance_issues"": [
        ""year should be parameterised"",
        ""transaction statuses should use reference table"",
        ""publishing division should use reference table"",
        ""invoice number filter needs clarification/governance"",
        ""source system codes should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls/errors from SAFE_CAST if financial_week is not numeric""
      ]
    },
    {
      ""metric_id"": ""source_system_code_dimension"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""None"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The system from which the ad sales revenue transaction originated."",
      ""sql_logic"": ""t0.source_system_code AS clmn6_"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""source_system_code IN ('PLUTO', 'CPQ', 'ADPT')"",
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR IS NULL"",
        ""invoice_number = '-1'"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment and analyze ad sales revenue by the originating system."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'-1'"",
        ""'PLUTO'"",
        ""'CPQ'"",
        ""'ADPT'""
      ],
      ""governance_issues"": [
        ""year should be parameterised"",
        ""transaction statuses should use reference table"",
        ""publishing division should use reference table"",
        ""invoice number filter needs clarification/governance"",
        ""source system codes should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5_dimension"",
      ""metric_name"": ""Operating Statement Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""None"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A dimension representing a specific level in the finance operating statement hierarchy."",
      ""sql_logic"": ""t0.os_level_5 AS clmn1_"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to group financial record counts for specific fiscal weeks."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal week IDs should be parameterised or derived from a date dimension""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""record_count_finance_os"",
      ""metric_name"": ""Record Count (Finance Operating Statement)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The count of records in the finance operating statement for specific fiscal weeks, grouped by operating statement level 5."",
      ""sql_logic"": ""COUNT(1) AS t0_qt_dr5zew8rtd"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement""
      ],
      ""filters_applied"": [
        ""fiscal_week_id IN ('202548', '202549', '202550', '202551')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a volume count for financial data, likely used for data validation or understanding distribution across different operating statement levels."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202548"",
        ""202549"",
        ""202550"",
        ""202551""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal week IDs should be parameterised or derived from a date dimension""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""data_load_datetime_truncated"",
      ""metric_name"": ""Data Load Datetime (Truncated to Second)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""second"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp when the ad sales data was loaded into the system, truncated to the nearest second."",
      ""sql_logic"": ""DATETIME_TRUNC(clmn0_, SECOND) AS clmn2_ (where clmn0_ is t0.data_load_datetime)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""unified_publication_gl_code IN ('9707', '9655', '9658')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Used to group data by load time, likely for data freshness monitoring or auditing purposes, specifically for transactions associated with certain GL codes."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'9707'"",
        ""'9655'"",
        ""'9658'""
      ],
      ""governance_issues"": [
        ""GL codes should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_amount_sum"",
      ""related_metrics"": [
        ""financial_year_dimension"",
        ""financial_week_dimension"",
        ""source_system_code_dimension""
      ],
      ""relationship_description"": ""The 'Total Gross Revenue Amount' is heavily filtered and grouped by 'Financial Year', 'Financial Week', and 'Source System Code', along with specific transaction statuses, publishing divisions, and invoice numbers. Changes to these filters directly impact the calculated revenue."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [filters]"",
      ""business_validation"": ""Ensures that revenue is reported only for specific, defined business criteria, allowing for focused analysis of ad sales performance."",
      ""validation_sql"": ""See 'business_rules_sql' for validation of individual filter impacts."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_week_int_sum"",
      ""related_metrics"": [
        ""financial_week_dimension""
      ],
      ""relationship_description"": ""The 'Sum of Financial Week (as INT64)' is a direct numerical transformation and aggregation of the 'Financial Week' dimension. It's likely used for internal sorting or calculation within the dashboard rather than a direct business interpretation."",
      ""mathematical_formula"": ""SUM(SAFE_CAST(financial_week AS INT64))"",
      ""business_validation"": ""This metric's business validation is primarily in its utility for dashboard presentation (e.g., sorting) rather than a direct business insight."",
      ""validation_sql"": ""SELECT SUM(SAFE_CAST(financial_week AS INT64)) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE financial_year = '2025' LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""data_load_datetime_truncated"",
      ""related_metrics"": [],
      ""relationship_description"": ""The 'Data Load Datetime (Truncated to Second)' is filtered by specific 'Unified Publication GL Codes'. This suggests that the data freshness or audit analysis is focused on particular GL segments."",
      ""mathematical_formula"": ""DATETIME_TRUNC(data_load_datetime, SECOND) WHERE unified_publication_gl_code IN (...)"",
      ""business_validation"": ""Ensures that data load timestamps are analyzed for specific publication GL codes, which is important for data quality and operational monitoring for those segments."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE unified_publication_gl_code IN ('9707', '9655', '9658') LIMIT 1;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""record_count_finance_os"",
      ""related_metrics"": [
        ""os_level_5_dimension""
      ],
      ""relationship_description"": ""The 'Record Count (Finance Operating Statement)' is filtered by specific 'Fiscal Week IDs' and grouped by 'Operating Statement Level 5'. This indicates a focus on volume analysis within defined financial periods and organizational structures."",
      ""mathematical_formula"": ""COUNT(1) WHERE fiscal_week_id IN (...) GROUP BY os_level_5"",
      ""business_validation"": ""Provides a count of financial records for specific fiscal weeks and operating levels, useful for data volume assessment and financial reporting integrity."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement` WHERE fiscal_week_id IN ('202548', '202549', '202550', '202551') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,17
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6a26c78f-0070-4fb3-88b8-691ee4a4485a"",
    ""dashboard_name"": ""Circ Budget Revenue Weekly Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 18,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""fy_quarter_of_year"",
      ""publication_name_standardized"",
      ""publication_state_region"",
      ""os_level_8"",
      ""sales_channel_group"",
      ""day_of_week_category"",
      ""publication_group""
    ],
    ""date_range_detected"": ""FY2025 (Fiscal Year 2025) and relative fiscal weeks/months"",
    ""hardcoded_dates_found"": [
      ""15/04/2025"",
      ""03/07/2024""
    ],
    ""hardcoded_values_found"": [
      ""'CIRCULATION'"",
      ""'Free News & Lifestyle'"",
      ""'Food'"",
      ""'Prestige'"",
      ""'FY2025'"",
      ""'DTI Free Copies'"",
      ""'Retail'"",
      ""'YTD'"",
      ""'PNG'"",
      ""'6 Day Pubs'"",
      ""'M-F'"",
      ""'SAT'"",
      ""'Sun'"",
      ""'ALL SALES CHANNELS'"",
      ""'The Sportsman'"",
      ""'Weekly Times'"",
      ""'The Courier Mail'"",
      ""'The Australian'"",
      ""'Mercury and Sunday Tas'"",
      ""'NT News & Sunday Territorian'"",
      ""'Other'"",
      ""'The Advertiser'"",
      ""'The Daily Telegraph'"",
      ""'The Herald Sun'"",
      ""'Convenience Stores / Service Stations'"",
      ""'Newsagencies'"",
      ""'Supermarkets'"",
      ""'Subscriptions'"",
      ""'Unspec Channel'"",
      ""'Alternative Channels'"",
      ""'CP'"",
      ""'PY'"",
      ""'1'"",
      ""'2'"",
      ""'3'"",
      ""'4'"",
      ""'5'"",
      ""'6'"",
      ""'7'"",
      ""'9'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Fiscal year 'FY2025' should be parameterized"",
      ""Publication names, sales channels, and day of week categories should use governed lookup tables instead of hardcoded CASE statements"",
      ""The numeric literals '1', '2', '3' used for period selection should be replaced by a clear parameter or configuration""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT_Base AS (\n  SELECT\n    os.source_system_name,\n    os.sub_source_system_name,\n    CAST(os.fiscal_week_id AS INT64) AS fiscal_week_id,\n    os.gl_publication_code,\n    os.day_of_week,\n    os.state,\n    os.os_level_1,\n    os.os_level_2,\n    os.os_level_3,\n    os.os_level_4,\n    os.os_level_5,\n    os.os_level_6,\n    os.os_level_7,\n    os.os_level_8,\n    os.os_level_9,\n    os.os_level_10,\n    os.os_level_11,\n    os.os_level_12,\n    os.Estimate,\n    os.True_Up_Adjustment,\n    os.Actual_Amount,\n    os.volume,\n    os.Last_Year_Actual_Amount,\n    os.Last_Year_volume,\n    os.Budget_Draft_Amount,\n    os.Budget_Draft_Volume,\n    os.Budget_Amount,\n    os.Budget_Volume,\n    os.Forecast_Amount,\n    os.Forecast_Volume,\n    os.Budget_Jan_Amount,\n    os.Budget_Jan_Volume,\n    os.Budget_Feb_Amount,\n    os.Budget_Feb_Volume,\n    os.Budget_Mar_Amount,\n    os.Budget_Mar_Volume,\n    os.Budget_Apr_Amount,\n    os.Budget_Apr_Volume,\n    os.Budget_May_Amount,\n    os.Budget_May_Volume,\n    os.Budget_Jun_Amount,\n    os.Budget_Jun_Volume,\n    os.Budget_Jul_Amount,\n    os.Budget_Jul_Volume,\n    os.Budget_Aug_Amount,\n    os.Budget_Aug_Volume,\n    os.Budget_Sep_Amount,\n    os.Budget_Sep_Volume,\n    os.Budget_Oct_Amount,\n    os.Budget_Oct_Volume,\n    os.Budget_Nov_Amount,\n    os.Budget_Nov_Volume,\n    os.Budget_Dec_Amount,\n    os.Budget_Dec_Volume,\n    os.Forecast_Q1F_Amount,\n    os.Forecast_Q1F_Volume,\n    os.Forecast_Q2F_Amount,\n    os.Forecast_Q2F_Volume,\n    os.Forecast_Q3F_Amount,\n    os.Forecast_Q3F_Volume,\n    os.Forecast_Q4F_Amount,\n    os.Forecast_Q4F_Volume,\n    os.Forecast_Q5F_Amount,\n    os.Forecast_Q5F_Volume,\n    pub.publication_name,\n    pub.l04_publication_code,\n    pub.l06_publication_code,\n    pub.gl_hierarchy_code,\n    calendar.fy_week_of_year,\n    calendar.fy_year_week_number,\n    calendar.fy_first_day_of_week,\n    calendar.fy_last_day_of_week,\n    calendar.fy_month_of_year,\n    calendar.fy_year_month_number,\n    calendar.relative_fisc_year_number,\n    calendar.relative_fisc_week_number,\n    calendar.fy_quarter_of_year,\n    calendar.fy_year\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n      ON control.source_week_number = calendar.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n      ON os.os_level_12 = dep.department_code\n  WHERE\n    upper(os.os_level_6) = 'CIRCULATION'\n    AND pub.l04_publication_code <> 'Free News & Lifestyle'\n    AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n    AND pub.gl_hierarchy_code = 'FY2025'\n),\ntransformed_data AS (\n  SELECT\n    *,\n    -- Derived publication name\n    CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END AS publication_name_derived,\n\n    -- Standardized publication name\n    CASE\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Weekly Times')) THEN 'Weekly Times'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Toowoomba') THEN 'The Chronicle'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Townsville Bulletin') THEN 'Townsville Bulletin'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Gold Coast Bulletin') THEN 'GCB'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Geelong Advertiser') THEN 'Geelong Advertiser'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Cairns Post') THEN 'Cairns Post'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Sunshine Coast') THEN 'Sunshine Coast'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'Courier Mail'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Sunday Territorian', 'NT News')) THEN 'Northern Territory News'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Mackay') THEN 'Daily Mercury'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Australian') THEN 'The Australian'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Sportsman') THEN 'The Sportsman'\n      ELSE NULL\n    END AS publication_name_standardized,\n\n    -- State/Region\n    CASE\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Daily Telegraph') THEN ' NSW'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('The Herald Sun', 'Geelong Advertiser', 'Weekly Times')) THEN '  VIC'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'The Advertiser') THEN '   SA'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Courier Mail', 'Cairns Post', 'GCB', 'Townsville Bulletin', 'The Chronicle', 'Daily Mercury', 'Sunshine Coast')) THEN '     QLD'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Northern Territory News') THEN '      NT'\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'Mercury') THEN '    TAS'\n      ELSE NULL\n    END AS publication_state_region,\n\n    -- Sales Channel Group\n    CASE\n      WHEN (os_level_10 IN ('Airlines', 'Hotels', 'Other Alternate', 'Other Alternate Channels')) THEN 'Alternative Channels'\n      WHEN (os_level_10 IN ('Petrol and Convenience')) THEN 'Convenience Stores / Service Stations'\n      WHEN (os_level_10 IN ('Agent & Dist')) THEN 'Newsagencies'\n      WHEN (os_level_10 IN ('Home Delivery', 'Roadside Delivery', 'Unspecified Print Sub')) THEN 'Subscriptions'\n      WHEN (os_level_10 IN ('Supermarkets')) THEN 'Supermarkets'\n      ELSE 'Unspec Channel'\n    END AS sales_channel_group,\n\n    -- Day of Week Category\n    CASE\n      WHEN (day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry')) THEN 'M-F'\n      WHEN (day_of_week = 'Sat') THEN 'SAT'\n      WHEN (day_of_week = 'Sun') THEN 'Sun'\n      ELSE NULL\n    END AS day_of_week_category,\n\n    -- Publication Group\n    CASE\n      WHEN (publication_name_derived IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin')) THEN '6 Day Pubs'\n      WHEN (publication_name_derived IN ('Mercury', 'Sunday Tasmanian')) THEN 'Mercury and Sunday Tas'\n      WHEN (publication_name_derived IN ('NT News', 'Sunday Territorian')) THEN 'NT News & Sunday Territorian'\n      WHEN (publication_name_derived IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital')) THEN 'Other'\n      WHEN (publication_name_derived IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser'\n      WHEN (publication_name_derived IN ('Courier Mail', 'Sunday Mail (QLD)')) THEN 'The Courier Mail'\n      WHEN (publication_name_derived IN ('The Daily Telegraph', 'The Sunday Telegraph')) THEN 'The Daily Telegraph'\n      WHEN (publication_name_derived IN ('Herald Sun', 'Sunday Herald Sun')) THEN 'The Herald Sun'\n      ELSE publication_name_derived\n    END AS publication_group,\n\n    -- Budget Volume for Past Weeks\n    CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END AS budget_volume_past_weeks,\n\n    -- YTD Actual Amount (simplified, original uses hardcoded dates and complex week logic)\n    -- This assumes 'current week' is derived dynamically from CURRENT_DATE()\n    CASE WHEN (fy_week_of_year <= (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1)) THEN Actual_Amount ELSE 0 END AS ytd_actual_amount_calc,\n\n    -- Budget Amount for Current Period (simplified, original logic was problematic)\n    -- This assumes 'current week' is derived dynamically from CURRENT_DATE()\n    CASE WHEN (fy_week_of_year = (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1)) THEN Budget_Amount ELSE 0 END AS budget_amount_current_period,\n\n    -- Calculated Daily Average Volume (simplified from original complex logic)\n    CASE\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin')) THEN SAFE_DIVIDE(volume, 6)\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'PNG') THEN 0\n      ELSE SAFE_DIVIDE(volume, 7)\n    END AS calculated_daily_avg_volume,\n\n    -- Calculated Daily Average Volume (Forecast/Budget) (simplified from original complex logic)\n    CASE\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin')) THEN SAFE_DIVIDE(Budget_Volume, 6)\n      WHEN (CASE WHEN (gl_publication_code = 'Post Courier') THEN 'PNG' ELSE publication_name END = 'PNG') THEN 0\n      ELSE SAFE_DIVIDE(Budget_Volume, 7)\n    END AS calculated_daily_avg_volume_forecast_budget\n\n  FROM OSandFACT_Base\n  WHERE\n    os_level_8 != 'DTI Free Copies'\n    AND publication_name_standardized IS NOT NULL\n    AND sales_channel_group = 'Retail'\n),\nfinal_data AS (\nSELECT\n  fy_quarter_of_year,\n  publication_state_region,\n  publication_name_standardized,\n  os_level_8,\n  sales_channel_group,\n  day_of_week_category,\n  publication_group,\n  'YTD' AS period_type_label,\n\n  -- Metrics from Query 1\n  SUM(budget_volume_past_weeks) AS total_budget_volume_past_weeks,\n  SUM(volume - budget_volume_past_weeks) AS volume_vs_budget_variance,\n  SUM(volume) AS total_actual_volume,\n\n  -- Metrics from Query 2\n  SUM(Budget_Volume) AS total_budget_volume_q2,\n  SUM(Actual_Amount) AS total_actual_amount_q2,\n  SUM(CASE WHEN os_level_7 = 'ALL SALES CHANNELS' THEN Actual_Amount ELSE 0 END) AS total_actual_amount_all_sales_channels,\n  SUM(ytd_actual_amount_calc) AS total_ytd_actual_amount,\n  SUM(calculated_daily_avg_volume) AS total_calculated_daily_avg_volume,\n  SUM(calculated_daily_avg_volume_forecast_budget) AS total_calculated_daily_avg_volume_forecast_budget,\n  SUM(budget_amount_current_period) AS total_budget_amount_current_period\n\nFROM transformed_data\nGROUP BY\n  fy_quarter_of_year,\n  publication_state_region,\n  publication_name_standardized,\n  os_level_8,\n  sales_channel_group,\n  day_of_week_category,\n  publication_group\n)\nSELECT *\nFROM final_data\nORDER BY\n  fy_quarter_of_year DESC,\n  publication_state_region,\n  publication_name_standardized\nLIMIT 100;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fiscal_week_id) as unique_fiscal_weeks,\n  COUNT(DISTINCT gl_publication_code) as unique_publication_codes,\n  COUNT(DISTINCT os_level_8) as unique_os_level_8_values,\n  COUNT(DISTINCT os_level_10) as unique_sales_channels,\n  MIN(fiscal_week_id) as earliest_fiscal_week_id,\n  MAX(fiscal_week_id) as latest_fiscal_week_id,\n  MIN(fy_first_day_of_week) as earliest_date,\n  MAX(fy_last_day_of_week) as latest_date,\n  APPROX_COUNT_DISTINCT(CONCAT(fiscal_week_id, gl_publication_code, os_level_8, os_level_10)) as approx_unique_grain_records\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(Actual_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END as actual_amount_test,\n  CASE WHEN SUM(Budget_Volume) > 0 THEN 'PASS' ELSE 'FAIL' END as budget_volume_test,\n  CASE WHEN COUNT(DISTINCT gl_publication_code) > 0 THEN 'PASS' ELSE 'FAIL' END as publication_test,\n  CASE WHEN MAX(calendar.fy_last_day_of_week) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\n  AND calendar.fy_last_day_of_week >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Circulation Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated`\nWHERE\n  gl_hierarchy_code = 'FY2025'\n  AND fiscal_week_id = (SELECT MAX(fiscal_week_id) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE gl_hierarchy_code = 'FY2025');"",
    ""sample_data_sql"": ""SELECT\n  os.fiscal_week_id,\n  os.gl_publication_code,\n  pub.publication_name,\n  os.day_of_week,\n  os.os_level_8,\n  os.os_level_10,\n  os.Actual_Amount,\n  os.volume,\n  os.Budget_Amount,\n  os.Budget_Volume,\n  os.Forecast_Amount,\n  os.Forecast_Volume,\n  os.Last_Year_Actual_Amount,\n  os.Last_Year_volume,\n  calendar.fy_quarter_of_year,\n  calendar.relative_fisc_week_number\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND pub.gl_hierarchy_code = 'FY2025'\nORDER BY\n  os.fiscal_week_id DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""15/04/2025"",
          ""original_format"": ""2025-04-15 04:14:20.297382+00"",
          ""context"": ""Used as a reference date for calculating week differences and current date in Query 2."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""03/07/2024"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a fixed baseline date in DATETIME_DIFF calculation for week number in Query 2."",
          ""suggested_fix"": ""Replace with a dynamic start date (e.g., start of fiscal year) or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'1'"",
            ""'2'"",
            ""'3'""
          ],
          ""context"": ""Numeric literals used in CASE statements to select different metric calculation paths (e.g., current, forecast, last year). These likely correspond to Looker Studio parameter values."",
          ""suggested_governance"": ""Use a Looker Studio parameter that directly maps to column names or a more explicit conditional logic, or pre-calculate these periods in the underlying data model."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Daily Telegraph'"",
            ""'The Herald Sun'"",
            ""'The Advertiser'"",
            ""'Courier Mail'"",
            ""'Cairns Post'"",
            ""'GCB'"",
            ""'Townsville Bulletin'"",
            ""'The Chronicle'"",
            ""'Daily Mercury'"",
            ""'Sunshine Coast'"",
            ""'Northern Territory News'"",
            ""'Mercury'"",
            ""'Weekly Times'"",
            ""'Geelong Advertiser'"",
            ""'The Australian'"",
            ""'The Sportsman'"",
            ""'PNG'"",
            ""'6 Day Pubs'"",
            ""'Mercury and Sunday Tas'"",
            ""'NT News & Sunday Territorian'"",
            ""'Other'"",
            ""'Retail'"",
            ""'Subscriptions'"",
            ""'Alternative Channels'"",
            ""'M-F'"",
            ""'SAT'"",
            ""'Sun'"",
            ""'ALL SALES CHANNELS'"",
            ""'FY2025'"",
            ""'CIRCULATION'"",
            ""'DTI Free Copies'""
          ],
          ""context"": ""Various string literals used for publication names, sales channels, day categories, and filtering criteria within CASE statements and WHERE clauses."",
          ""suggested_governance"": ""Create and join to governed dimension tables (e.g., `dim_publication`, `dim_sales_channel`, `dim_calendar`) for consistent categorization and filtering. Parameterize the fiscal year."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-04-15', '2024-07-03') with Looker Studio date range parameters or `CURRENT_DATE()` for dynamic reporting."",
      ""Parameterize the fiscal year filter ('FY2025') to allow for easy year-over-year analysis without modifying SQL."",
      ""Implement Looker Studio controls for publication groups, sales channels, and day categories, which then map to values from governed lookup tables, rather than hardcoding in SQL."",
      ""Refactor the complex 'period selection' logic (using '1', '2', '3') into a more explicit parameter-driven approach, potentially using a `UNION ALL` structure or a configuration table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fiscal_quarter_of_year"",
      ""metric_name"": ""Fiscal Quarter of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal quarter number within the fiscal year (e.g., 1, 2, 3, 4)."",
      ""sql_logic"": ""CAST(c.fy_quarter_of_year AS int)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for quarterly reporting and aggregation of financial data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_state_region"",
      ""metric_name"": ""Publication State/Region"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_name_standardized""
      ],
      ""business_description"": ""The Australian state or region associated with a standardized publication name."",
      ""sql_logic"": ""CASE WHEN (publication_name_standardized = 'The Daily Telegraph') THEN ' NSW' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key geographical dimension for reporting and analysis of circulation data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'"",
        ""'The Advertiser'"",
        ""'Courier Mail'"",
        ""'Cairns Post'"",
        ""'GCB'"",
        ""'Townsville Bulletin'"",
        ""'The Chronicle'"",
        ""'Daily Mercury'"",
        ""'Sunshine Coast'"",
        ""'Northern Territory News'"",
        ""'Mercury'"",
        ""'Weekly Times'"",
        ""'Geelong Advertiser'""
      ],
      ""governance_issues"": [
        ""Lookup values should use a reference table for state/region mapping.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULL values if publication name is not mapped.""
      ]
    },
    {
      ""metric_id"": ""publication_name_standardized"",
      ""metric_name"": ""Publication Name (Standardized)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_name_derived""
      ],
      ""business_description"": ""A standardized name for publications, grouping variations (e.g., 'Herald Sun' and 'Sunday Herald Sun' become 'The Herald Sun')."",
      ""sql_logic"": ""CASE WHEN (publication_name_derived IN ('Advertiser', 'Sunday Mail (SA)')) THEN 'The Advertiser' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for reporting and analysis of circulation data by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Advertiser'"",
        ""'Sunday Mail (SA)'"",
        ""'Weekly Times'"",
        ""'Herald Sun'"",
        ""'Sunday Herald Sun'"",
        ""'The Daily Telegraph'"",
        ""'The Sunday Telegraph'"",
        ""'Toowoomba'"",
        ""'Townsville Bulletin'"",
        ""'Gold Coast Bulletin'"",
        ""'Geelong Advertiser'"",
        ""'Cairns Post'"",
        ""'Sunshine Coast'"",
        ""'Courier Mail'"",
        ""'Sunday Mail (QLD)'"",
        ""'Mercury'"",
        ""'Sunday Tasmanian'"",
        ""'Sunday Territorian'"",
        ""'NT News'"",
        ""'Mackay'"",
        ""'The Australian'"",
        ""'The Sportsman'""
      ],
      ""governance_issues"": [
        ""Lookup values should use a reference table for publication name standardization.""
      ],
      ""data_quality_concerns"": [
        ""Potential for NULL values if publication name is not mapped.""
      ]
    },
    {
      ""metric_id"": ""os_level_8"",
      ""metric_name"": ""OS Level 8"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""An organizational hierarchy level, often representing a specific product or category within circulation."",
      ""sql_logic"": ""t0.os_level_8"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_8 != 'DTI Free Copies'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for detailed analysis of circulation performance by specific product/category."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DTI Free Copies'""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion 'DTI Free Copies' should be managed via a configuration or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_channel_group"",
      ""metric_name"": ""Sales Channel Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of sales channels (e.g., 'Retail', 'Subscriptions', 'Alternative Channels')."",
      ""sql_logic"": ""CASE WHEN (os_level_10 IN ('Airlines', ...)) THEN 'Alternative Channels' ... ELSE 'Unspec Channel' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""sales_channel_group = 'Retail'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze circulation performance across different sales channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Airlines'"",
        ""'Hotels'"",
        ""'Other Alternate'"",
        ""'Other Alternate Channels'"",
        ""'Petrol and Convenience'"",
        ""'Agent & Dist'"",
        ""'Home Delivery'"",
        ""'Roadside Delivery'"",
        ""'Unspecified Print Sub'"",
        ""'Supermarkets'"",
        ""'Unspec Channel'"",
        ""'Retail'""
      ],
      ""governance_issues"": [
        ""Lookup values should use a reference table for sales channel grouping.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""day_of_week_category"",
      ""metric_name"": ""Day of Week Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of days of the week into 'M-F', 'SAT', 'Sun'."",
      ""sql_logic"": ""CASE WHEN (day_of_week IN ('Mon', ...)) THEN 'M-F' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for analyzing daily patterns within weekly circulation data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Mon'"",
        ""'Tue'"",
        ""'Wed'"",
        ""'Thu'"",
        ""'Fri'"",
        ""'Weekday Entry'"",
        ""'Sat'"",
        ""'Sun'""
      ],
      ""governance_issues"": [
        ""Lookup values should use a reference table for day of week categorization.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_group"",
      ""metric_name"": ""Publication Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_name_derived""
      ],
      ""business_description"": ""Custom grouping of publications (e.g., '6 Day Pubs', 'Mercury and Sunday Tas')."",
      ""sql_logic"": ""CASE WHEN (publication_name_derived IN ('Cairns Post', ...)) THEN '6 Day Pubs' ... ELSE publication_name_derived END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level analysis and comparison of circulation performance across different publication tiers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Cairns Post'"",
        ""'Geelong Advertiser'"",
        ""'Gold Coast Bulletin'"",
        ""'The Australian'"",
        ""'Toowoomba'"",
        ""'Townsville Bulletin'"",
        ""'Mercury'"",
        ""'Sunday Tasmanian'"",
        ""'NT News'"",
        ""'Sunday Territorian'"",
        ""'Other'"",
        ""'The Advertiser'"",
        ""'The Courier Mail'"",
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'"",
        ""'PNG'""
      ],
      ""governance_issues"": [
        ""Lookup values should use a reference table for publication grouping.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_volume_past_weeks"",
      ""metric_name"": ""Total Budget Volume (Past Weeks)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""budget_volume"",
        ""relative_fisc_week_number""
      ],
      ""business_description"": ""Sum of Budget Volume for fiscal weeks prior to the current fiscal week (relative_fisc_week_number < 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to compare actual performance against budget for past periods."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""volume_vs_budget_variance"",
      ""metric_name"": ""Volume vs. Budget Variance"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume"",
        ""total_budget_volume_past_weeks""
      ],
      ""business_description"": ""The difference between actual volume and budget volume for past fiscal weeks."",
      ""sql_logic"": ""SUM(volume - (CASE WHEN (relative_fisc_week_number < 0) THEN Budget_Volume ELSE NULL END))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Critical KPI for assessing performance against budget targets for circulation volume."",
      ""metric_category"": ""efficiency"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_volume"",
      ""metric_name"": ""Total Actual Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume""
      ],
      ""business_description"": ""The sum of actual circulation volume."",
      ""sql_logic"": ""SUM(volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core KPI representing the total physical units circulated."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_budget_volume_q2"",
      ""metric_name"": ""Total Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""budget_volume""
      ],
      ""business_description"": ""The sum of budgeted circulation volume."",
      ""sql_logic"": ""SUM(Budget_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core KPI representing the target physical units for circulation."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_amount_q2"",
      ""metric_name"": ""Total Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""actual_amount""
      ],
      ""business_description"": ""The sum of actual revenue/amount."",
      ""sql_logic"": ""SUM(Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core KPI representing the total revenue generated from circulation."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_amount_all_sales_channels"",
      ""metric_name"": ""Total Actual Amount (All Sales Channels)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""actual_amount"",
        ""os_level_7""
      ],
      ""business_description"": ""The sum of actual revenue/amount specifically for 'ALL SALES CHANNELS'."",
      ""sql_logic"": ""SUM(CASE WHEN os_level_7 = 'ALL SALES CHANNELS' THEN Actual_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a specific view of revenue from a consolidated sales channel perspective."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ALL SALES CHANNELS'""
      ],
      ""governance_issues"": [
        ""Hardcoded 'ALL SALES CHANNELS' should be managed via a configuration or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_ytd_actual_amount"",
      ""metric_name"": ""Total YTD Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""actual_amount"",
        ""fy_week_of_year"",
        ""fy_year_week_number""
      ],
      ""business_description"": ""The sum of actual revenue/amount from the start of the fiscal year up to the current fiscal week."",
      ""sql_logic"": ""SUM(CASE WHEN (fy_week_of_year <= (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1)) THEN Actual_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial KPI for tracking year-to-date financial performance against targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""Current""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""The 'current week' logic relies on CURRENT_DATE() which is good, but the original query used hardcoded dates, which should be avoided.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_calculated_daily_avg_volume"",
      ""metric_name"": ""Total Calculated Daily Average Volume"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""volume"",
        ""publication_group""
      ],
      ""business_description"": ""The sum of daily average actual volume, calculated based on publication group (e.g., dividing by 6 for '6 Day Pubs', 7 for others)."",
      ""sql_logic"": ""SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(volume, 6) ELSE SAFE_DIVIDE(volume, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a normalized view of volume on a daily basis, accounting for publication schedules."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Hardcoded divisors (6, 7) and publication group names should be managed via configuration or lookup tables.""
      ],
      ""data_quality_concerns"": [
        ""SAFE_DIVIDE handles division by zero, but logic assumes consistent publication days.""
      ]
    },
    {
      ""metric_id"": ""total_calculated_daily_avg_volume_forecast_budget"",
      ""metric_name"": ""Total Calculated Daily Average Volume (Forecast/Budget)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""budget_volume"",
        ""publication_group""
      ],
      ""business_description"": ""The sum of daily average forecast/budget volume, calculated based on publication group."",
      ""sql_logic"": ""SUM(CASE WHEN publication_group = 'PNG' THEN 0 WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(Budget_Volume, 6) ELSE SAFE_DIVIDE(Budget_Volume, 7) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Provides a normalized view of target volume on a daily basis, accounting for publication schedules."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""6"",
        ""7""
      ],
      ""governance_issues"": [
        ""Hardcoded divisors (6, 7) and publication group names should be managed via configuration or lookup tables.""
      ],
      ""data_quality_concerns"": [
        ""SAFE_DIVIDE handles division by zero, but logic assumes consistent publication days.""
      ]
    },
    {
      ""metric_id"": ""total_budget_amount_current_period"",
      ""metric_name"": ""Total Budget Amount (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""budget_amount"",
        ""fy_week_of_year""
      ],
      ""business_description"": ""The sum of budget amount for the current fiscal week."",
      ""sql_logic"": ""SUM(CASE WHEN (fy_week_of_year = (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1)) THEN Budget_Amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key KPI for tracking current period financial targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""Current""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""The 'current week' logic relies on CURRENT_DATE() which is good, but the original query used hardcoded dates, which should be avoided.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Raw actual financial amount from the source system."",
      ""sql_logic"": ""Actual_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base measure for all actual revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Raw budgeted financial amount from the source system."",
      ""sql_logic"": ""Budget_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base measure for all budget revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""volume"",
      ""metric_name"": ""Volume (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Raw circulation volume from the source system."",
      ""sql_logic"": ""volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base measure for all actual volume calculations."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_volume"",
      ""metric_name"": ""Budget Volume (Raw)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Raw budgeted circulation volume from the source system."",
      ""sql_logic"": ""Budget_Volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base measure for all budget volume calculations."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""volume_vs_budget_variance"",
      ""related_metrics"": [
        ""total_actual_volume"",
        ""total_budget_volume_past_weeks""
      ],
      ""relationship_description"": ""Volume vs. Budget Variance is calculated as Total Actual Volume minus Total Budget Volume (Past Weeks)."",
      ""mathematical_formula"": ""volume_vs_budget_variance = total_actual_volume - total_budget_volume_past_weeks"",
      ""business_validation"": ""This relationship is fundamental for assessing performance against budget. A positive variance indicates exceeding budget, while a negative variance indicates falling short."",
      ""validation_sql"": ""SELECT SUM(volume) - SUM(CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END) AS calculated_variance, SUM(volume - (CASE WHEN relative_fisc_week_number < 0 THEN Budget_Volume ELSE NULL END)) AS direct_variance FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number WHERE upper(os.os_level_6) = 'CIRCULATION' AND os.gl_hierarchy_code = 'FY2025';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_calculated_daily_avg_volume"",
      ""related_metrics"": [
        ""total_actual_volume"",
        ""publication_group""
      ],
      ""relationship_description"": ""Total Calculated Daily Average Volume depends on Total Actual Volume and the Publication Group, which determines the divisor (6 or 7 days)."",
      ""mathematical_formula"": ""total_calculated_daily_avg_volume = SUM(volume / (CASE WHEN publication_group = '6 Day Pubs' THEN 6 ELSE 7 END))"",
      ""business_validation"": ""This relationship normalizes volume data for daily comparison across different publication schedules. It's crucial for understanding daily run rates."",
      ""validation_sql"": ""SELECT SUM(volume) AS total_volume, SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(volume, 6) ELSE SAFE_DIVIDE(volume, 7) END) AS daily_avg_volume FROM transformed_data WHERE publication_group IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_calculated_daily_avg_volume_forecast_budget"",
      ""related_metrics"": [
        ""total_budget_volume_q2"",
        ""publication_group""
      ],
      ""relationship_description"": ""Total Calculated Daily Average Volume (Forecast/Budget) depends on Total Budget Volume and the Publication Group, which determines the divisor (6 or 7 days)."",
      ""mathematical_formula"": ""total_calculated_daily_avg_volume_forecast_budget = SUM(Budget_Volume / (CASE WHEN publication_group = '6 Day Pubs' THEN 6 ELSE 7 END))"",
      ""business_validation"": ""This relationship normalizes budget/forecast volume data for daily comparison across different publication schedules, allowing for daily target tracking."",
      ""validation_sql"": ""SELECT SUM(Budget_Volume) AS total_budget_volume, SUM(CASE WHEN publication_group = '6 Day Pubs' THEN SAFE_DIVIDE(Budget_Volume, 6) ELSE SAFE_DIVIDE(Budget_Volume, 7) END) AS daily_avg_budget_volume FROM transformed_data WHERE publication_group IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount_all_sales_channels"",
      ""related_metrics"": [
        ""total_actual_amount_q2"",
        ""os_level_7""
      ],
      ""relationship_description"": ""Total Actual Amount (All Sales Channels) is a subset of Total Actual Amount, filtered specifically for records where os_level_7 is 'ALL SALES CHANNELS'."",
      ""mathematical_formula"": ""total_actual_amount_all_sales_channels = SUM(Actual_Amount WHERE os_level_7 = 'ALL SALES CHANNELS')"",
      ""business_validation"": ""This highlights the revenue contribution from a specific, consolidated sales channel category, allowing for focused analysis."",
      ""validation_sql"": ""SELECT SUM(Actual_Amount) AS total_actual, SUM(CASE WHEN os_level_7 = 'ALL SALES CHANNELS' THEN Actual_Amount ELSE 0 END) AS all_channels_actual FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` WHERE upper(os_level_6) = 'CIRCULATION' AND gl_hierarchy_code = 'FY2025';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_ytd_actual_amount"",
      ""related_metrics"": [
        ""total_actual_amount_q2"",
        ""fy_week_of_year"",
        ""fy_year_week_number""
      ],
      ""relationship_description"": ""Total YTD Actual Amount is a cumulative sum of Actual Amount from the start of the fiscal year up to the current fiscal week."",
      ""mathematical_formula"": ""total_ytd_actual_amount = SUM(Actual_Amount WHERE fy_week_of_year <= current_fiscal_week)"",
      ""business_validation"": ""This metric provides a running total of actual revenue for the fiscal year, essential for tracking progress towards annual goals."",
      ""validation_sql"": ""SELECT SUM(Actual_Amount) AS total_actual, SUM(CASE WHEN fy_week_of_year <= (SELECT fy_week_of_year FROM `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` WHERE CURRENT_DATE() BETWEEN fy_first_day_of_week AND fy_last_day_of_week LIMIT 1) THEN Actual_Amount ELSE 0 END) AS ytd_actual FROM `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar ON os.fiscal_week_id = calendar.fy_year_week_number WHERE upper(os.os_level_6) = 'CIRCULATION' AND os.gl_hierarchy_code = 'FY2025';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,18
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""2104a3f5-9424-4087-a928-e67fecae789a"",
    ""dashboard_name"": ""Circulation Performance Dashboard_dev_20250415"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_rel_timeperiod_weekly"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""publication_name"",
      ""os_level_7"",
      ""fy_year_week_number"",
      ""fy_month_of_year"",
      ""day_of_week"",
      ""fy_year"",
      ""publication_category_level_1"",
      ""publication_type""
    ],
    ""date_range_detected"": ""FY2025 (with specific week filters)"",
    ""hardcoded_dates_found"": [
      ""03/07/2024"",
      ""23/06/2025"",
      ""04/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'CIRCULATION'"",
      ""'FY2025'"",
      ""'Free News & Lifestyle'"",
      ""'Food'"",
      ""'Prestige'"",
      ""'All Sales Channels'"",
      ""'Weekly Times'"",
      ""'Sunshine Coast'"",
      ""'Mackay'"",
      ""'NT News'"",
      ""'Sunday Territorian'"",
      ""'Advertiser'"",
      ""'Post Courier'"",
      ""'PNG'"",
      ""'The Daily Telegraph'"",
      ""'The Sunday Telegraph'"",
      ""'Herald Sun'"",
      ""'Sunday Herald Sun'"",
      ""'Sunday Tasmanian'"",
      ""'Mercury'"",
      ""'The Sportsman'"",
      ""'The Courier Mail'"",
      ""'The Australian'"",
      ""'6 Day Pubs'"",
      ""'Mercury and Sunday Tas'"",
      ""'NT News & Sunday Territorian'"",
      ""'Other'"",
      ""'The Advertiser'"",
      ""'The Courier Mail'"",
      ""'The Daily Telegraph'"",
      ""'The Herald Sun'"",
      ""'Geelong Advertiser'"",
      ""'Sydney Suburbans'"",
      ""'Toowoomba'"",
      ""'Townsville Bulletin'"",
      ""'CP'"",
      ""'PY'"",
      ""magic_number_48"",
      ""magic_string_2""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE())"",
      ""Fiscal year should be dynamic based on current date or a parameter"",
      ""Publication names and categories should be managed in a governed lookup/dimension table (e.g., DIM_publication_hierarchy_categorized)"",
      ""Sales channel values should be managed in a governed lookup table"",
      ""Magic numbers/strings used in calculations (e.g., '48', '2') should be replaced with meaningful variables, parameters, or derived from metadata.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.*,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year_month_number AS int) AS fy_year_month_number,\n          CAST(c.relative_fisc_year_number AS int) AS relative_fisc_year_number,\n          CAST(c.relative_fisc_week_number AS int) AS relative_fisc_week_number,\n          c.fy_month_of_year_short_name,\n          CASE WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y' ELSE 'N' END AS month_end_flag,\n          CAST(c.fy_quarter_of_year AS int) AS fy_quarter_of_year,\n          CAST(c.fy_year AS int) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n            ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n        WHERE 1 = 1\n      ) AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n  ),\n  transformed_data AS (\n    SELECT\n      *,\n      -- Publication Category Level 1 (from Query 2/3 logic)\n      CASE\n        WHEN publication_code = 'Post Courier' THEN 'PNG'\n        WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'Northern Territory'\n        WHEN publication_name IN ('', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Others'\n        WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n        WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n        WHEN publication_name IN ('Sunday Tasmanian', 'Mercury') THEN 'Mercury'\n        WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n        WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail'\n        WHEN publication_name = 'The Australian' THEN 'The Australian'\n        WHEN publication_name = 'The Sportsman' THEN 'The Sportsman'\n        WHEN publication_name = 'Weekly Times' THEN 'Weekly Times'\n        ELSE publication_name\n      END AS publication_category_level_1,\n      -- Publication Type (from Query 3 logic)\n      CASE\n        WHEN publication_name IN ('Cairns Post', 'Geelong Advertiser', 'Gold Coast Bulletin', 'The Australian', 'Toowoomba', 'Townsville Bulletin') THEN '6 Day Pubs'\n        WHEN publication_name IN ('Mercury', 'Sunday Tasmanian') THEN 'Mercury and Sunday Tas'\n        WHEN publication_name IN ('NT News', 'Sunday Territorian') THEN 'NT News & Sunday Territorian'\n        WHEN publication_name IN ('Other', 'Brisbane Other', 'Cairns Post Digital', 'Corporate', 'Geelong Advertiser Digital', 'Gold Coast Bulletin Digital', 'Gold Coast Other', 'Herald Sun Digital', 'Melbourne Other', 'Mercury Digital', 'News Xtend', 'NIMs', 'NT News Digital', 'NT Other', 'Perth Now Digital', 'Sydney Other', 'The Australian Digital', 'The Courier Mail Digital', 'The Daily Telegraph Digital', 'The Weekend Australian Mag', 'Townsville Bulletin Digital', 'Transformation', 'Weekly Times Digital') THEN 'Other'\n        WHEN publication_name IN ('Advertiser', 'Sunday Mail (SA)') THEN 'The Advertiser'\n        WHEN publication_name IN ('Courier Mail', 'Sunday Mail (QLD)') THEN 'The Courier Mail'\n        WHEN publication_name IN ('The Daily Telegraph', 'The Sunday Telegraph') THEN 'The Daily Telegraph'\n        WHEN publication_name IN ('Herald Sun', 'Sunday Herald Sun') THEN 'The Herald Sun'\n        ELSE publication_name\n      END AS publication_type,\n      -- Day of Week Category (from Query 3 logic)\n      CASE\n        WHEN day_of_week IN ('Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Weekday Entry') THEN 'M-F'\n        WHEN day_of_week = 'Sat' THEN 'SAT'\n        WHEN day_of_week = 'Sun' THEN 'Sun'\n        ELSE NULL\n      END AS day_of_week_category,\n      -- Derived Fiscal Month Number for calculations (assuming 48 was fy_month_of_year)\n      CASE WHEN fy_month_of_year = 0 THEN 1 ELSE fy_month_of_year END AS calculated_fy_month_for_div,\n      -- Derived Fiscal Week Number for calculations (assuming 48 was fy_year_week_number)\n      CASE WHEN fy_year_week_number = 0 THEN 1 ELSE fy_year_week_number END AS calculated_fy_week_for_div\n    FROM OSandFACT\n  )\nSELECT\n  -- Dimensions\n  td.publication_name,\n  td.os_level_7 AS sales_channel,\n  td.fy_year_week_number,\n  td.fy_month_of_year,\n  td.day_of_week,\n  td.fy_year,\n  td.publication_category_level_1,\n  td.publication_type,\n  td.day_of_week_category,\n  -- Base Metrics\n  SUM(td.Actual_Amount) AS total_actual_amount,\n  SUM(td.volume) AS total_volume,\n  SUM(td.Last_Year_Actual_Amount) AS total_last_year_actual_amount,\n  SUM(td.Last_Year_volume) AS total_last_year_volume,\n  SUM(td.Budget_Amount) AS total_budget_amount,\n  SUM(td.Budget_Volume) AS total_budget_volume,\n  SUM(td.Forecast_Amount) AS total_forecast_amount,\n  SUM(td.Forecast_Volume) AS total_forecast_volume,\n  -- Calculated Metrics (Adjusted Volume)\n  SUM(\n    CASE\n      WHEN td.publication_type = 'PNG' THEN 0\n      WHEN td.publication_type = '6 Day Pubs' THEN SAFE_DIVIDE(\n        CASE\n          WHEN (td.publication_name = 'The Australian' OR td.publication_name = 'The Courier Mail') THEN CASE WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 5)) * 5) ELSE SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div) END\n          WHEN td.publication_name = 'The Sportsman' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 2)) * 5)\n          WHEN td.publication_name = 'Weekly Times' THEN (SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div) * 5)\n          WHEN td.publication_type = 'PNG' THEN 0\n          WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 5)) * 5)\n          ELSE SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div)\n        END, 6\n      )\n      ELSE SAFE_DIVIDE(\n        CASE\n          WHEN (td.publication_name = 'The Australian' OR td.publication_name = 'The Courier Mail') THEN CASE WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 5)) * 5) ELSE SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div) END\n          WHEN td.publication_name = 'The Sportsman' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 2)) * 5)\n          WHEN td.publication_name = 'Weekly Times' THEN (SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div) * 5)\n          WHEN td.publication_type = 'PNG' THEN 0\n          WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(td.volume, (td.calculated_fy_month_for_div * 5)) * 5)\n          ELSE SAFE_DIVIDE(td.volume, td.calculated_fy_month_for_div)\n        END, 7\n      )\n    END\n  ) AS adjusted_actual_volume,\n  SUM(\n    CASE\n      WHEN td.publication_type = 'PNG' THEN 0\n      WHEN td.publication_type = '6 Day Pubs' THEN SAFE_DIVIDE(\n        CASE\n          WHEN (td.publication_name = 'The Australian' OR td.publication_name = 'The Courier Mail') THEN CASE WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 5)\n          ) * 5) ELSE SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          ) END\n          WHEN td.publication_name = 'The Sportsman' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 2)\n          ) * 5)\n          WHEN td.publication_name = 'Weekly Times' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          ) * 5)\n          WHEN td.publication_type = 'PNG' THEN 0\n          WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 5)\n          ) * 5)\n          ELSE SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          )\n        END, 6\n      )\n      ELSE SAFE_DIVIDE(\n        CASE\n          WHEN (td.publication_name = 'The Australian' OR td.publication_name = 'The Courier Mail') THEN CASE WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 5)\n          ) * 5) ELSE SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          ) END\n          WHEN td.publication_name = 'The Sportsman' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 2)\n          ) * 5)\n          WHEN td.publication_name = 'Weekly Times' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          ) * 5)\n          WHEN td.publication_type = 'PNG' THEN 0\n          WHEN td.day_of_week_category = 'M-F' THEN (SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, (td.calculated_fy_month_for_div * 5)\n          ) * 5)\n          ELSE SAFE_DIVIDE(\n            CASE\n              WHEN td.calculated_fy_week_for_div < 4 THEN td.volume\n              WHEN td.calculated_fy_week_for_div < 6 THEN (CASE WHEN td.fy_month_of_year < 4 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 6 THEN (CASE WHEN td.fy_month_of_year < 6 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div < 9 THEN (CASE WHEN td.fy_month_of_year < 7 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.calculated_fy_week_for_div = 9 THEN (CASE WHEN td.fy_month_of_year < 9 THEN td.volume ELSE td.Forecast_Volume END)\n              WHEN td.fy_month_of_year < 10 THEN td.volume\n              ELSE td.Forecast_Volume\n            END, td.calculated_fy_month_for_div\n          )\n        END, 7\n      )\n    END\n  ) AS adjusted_target_forecast_py_volume\nFROM transformed_data td\nWHERE\n  td.os_level_7 = 'All Sales Channels'\n  AND td.publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')\n  AND td.publication_category_level_1 IN ('Geelong Advertiser', 'Mercury', 'Sunday Tasmanian', 'Sunshine Coast', 'Sydney Suburbans', 'The Australian', 'The Daily Telegraph', 'The Herald Sun', 'Toowoomba', 'Townsville Bulletin', 'Weekly Times')\n  AND td.fy_year = 2025\n  AND td.fy_year_week_number <= (SELECT MAX(fy_year_week_number) FROM transformed_data WHERE DATE(CURRENT_TIMESTAMP(), 'Australia/Sydney') BETWEEN fy_first_day_of_week AND fy_last_day_of_week)\nGROUP BY\n  td.publication_name,\n  td.os_level_7,\n  td.fy_year_week_number,\n  td.fy_month_of_year,\n  td.day_of_week,\n  td.fy_year,\n  td.publication_category_level_1,\n  td.publication_type,\n  td.day_of_week_category\nORDER BY\n  td.fy_year_week_number DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT os.fiscal_week_id) AS unique_fiscal_weeks,\n  COUNT(DISTINCT os.gl_publication_code) AS unique_publications,\n  COUNT(DISTINCT os.os_level_7) AS unique_sales_channels,\n  MIN(calendar.fy_first_day_of_week) AS earliest_fiscal_week_start_date,\n  MAX(calendar.fy_last_day_of_week) AS latest_fiscal_week_end_date,\n  APPROX_COUNT_DISTINCT(CONCAT(os.fiscal_week_id, os.gl_publication_code, os.day_of_week, os.os_level_7)) AS approx_unique_data_grain_records\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  upper(os.os_level_6) = 'CIRCULATION'\n  AND os.gl_hierarchy_code = 'FY2025'\n  AND calendar.fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) -- Filter for current year data for structure analysis\nLIMIT 1000;"",
    ""validation_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.*,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year AS int) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n            ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n  )\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(Actual_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS actual_amount_test,\n  CASE WHEN SUM(volume) > 0 THEN 'PASS' ELSE 'FAIL' END AS volume_test,\n  CASE WHEN COUNT(DISTINCT publication_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS publication_test,\n  CASE WHEN MAX(fy_last_day_of_week) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test\nFROM OSandFACT\nWHERE\n  fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) AND fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM OSandFACT WHERE fy_year = EXTRACT(YEAR FROM CURRENT_DATE()))\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.*,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year AS int) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n            ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n  )\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Circulation Data Filtered Correctly' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN upper(os_level_6) = 'CIRCULATION' THEN 1 ELSE 0 END) AS records_passing_circulation_filter,\n  SUM(CASE WHEN l04_publication_code <> 'Free News & Lifestyle' THEN 1 ELSE 0 END) AS records_passing_free_news_filter,\n  SUM(CASE WHEN l06_publication_code NOT IN ('Food', 'Prestige') THEN 1 ELSE 0 END) AS records_passing_food_prestige_filter,\n  SUM(CASE WHEN gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) AS records_passing_fy2025_filter,\n  SUM(CASE WHEN os_level_7 = 'All Sales Channels' THEN 1 ELSE 0 END) AS records_passing_all_sales_channels_filter\nFROM OSandFACT\nWHERE\n  fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) AND fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM OSandFACT WHERE fy_year = EXTRACT(YEAR FROM CURRENT_DATE()))\nLIMIT 1;"",
    ""sample_data_sql"": ""WITH OSandFACT AS (\n    SELECT\n      os.*,\n      pub.publication_name,\n      pub.publication_code,\n      pub.l04_publication_code,\n      pub.l06_publication_code,\n      calendar.fy_week_of_year,\n      calendar.fy_year_week_number,\n      calendar.fy_first_day_of_week,\n      calendar.fy_last_day_of_week,\n      calendar.fy_month_of_year,\n      calendar.fy_year_month_number,\n      calendar.relative_fisc_year_number,\n      calendar.relative_fisc_week_number,\n      calendar.fy_month_of_year_short_name,\n      calendar.month_end_flag,\n      calendar.fy_quarter_of_year,\n      calendar.fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n          CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n          CAST(c.fy_month_of_year AS int) AS fy_month_of_year,\n          CAST(c.fy_year AS int) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n            ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      ) AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n        ON os.os_level_12 = dep.department_code\n    WHERE\n      upper(os.os_level_6) = 'CIRCULATION'\n      AND pub.l04_publication_code <> 'Free News & Lifestyle'\n      AND pub.l06_publication_code NOT IN ('Food', 'Prestige')\n      AND os.gl_hierarchy_code = 'FY2025'\n  )\nSELECT\n  fiscal_week_id,\n  gl_publication_code,\n  publication_name,\n  day_of_week,\n  os_level_7,\n  Actual_Amount,\n  volume,\n  Last_Year_Actual_Amount,\n  Last_Year_volume,\n  Budget_Amount,\n  Budget_Volume,\n  Forecast_Amount,\n  Forecast_Volume,\n  fy_year_week_number,\n  fy_month_of_year,\n  fy_year\nFROM OSandFACT\nWHERE\n  fy_year = EXTRACT(YEAR FROM CURRENT_DATE()) AND fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM OSandFACT WHERE fy_year = EXTRACT(YEAR FROM CURRENT_DATE()))\nORDER BY\n  fiscal_week_id DESC, publication_name\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""03/07/2024"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as a baseline date for calculating week differences (DATETIME_DIFF) in Query 1."",
          ""suggested_fix"": ""Replace with a dynamic fiscal year start date from a calendar dimension table or a parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""23/06/2025"",
          ""original_format"": ""2025-06-23 04:08:01.229999+00"",
          ""context"": ""Used to derive a specific fiscal week number (202549) for filtering in Query 1. This hardcodes the report to a single week."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a date parameter to allow dynamic reporting for the current or selected week."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""04/06/2025"",
          ""original_format"": ""2025-06-04 07:28:59.451817+00"",
          ""context"": ""Used to derive a fiscal week number for a 'year-to-date' or 'current period' filter in Query 3."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a date parameter to allow dynamic reporting for the current period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'CIRCULATION'""
          ],
          ""context"": ""Primary filter for os_level_6, defining the dashboard's scope."",
          ""suggested_governance"": ""Consider if this should be configurable or derived from a business unit dimension."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY2025'""
          ],
          ""context"": ""Fiscal year filter applied to the base data. This will make the dashboard stale after FY2025."",
          ""suggested_governance"": ""Replace with a dynamic fiscal year (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or a parameter) or derive from a period control table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Free News & Lifestyle'"",
            ""'Food'"",
            ""'Prestige'""
          ],
          ""context"": ""Exclusion filters for publication codes (l04_publication_code, l06_publication_code)."",
          ""suggested_governance"": ""Manage these exclusions in a configuration table or a publication dimension with a 'is_excluded' flag."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Weekly Times'"",
            ""'Sunshine Coast'"",
            ""'Mackay'""
          ],
          ""context"": ""Exclusion filters for publication names."",
          ""suggested_governance"": ""Manage these exclusions in a configuration table or a publication dimension with a 'is_excluded' flag."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'All Sales Channels'""
          ],
          ""context"": ""Filter for os_level_7 (Sales Channel)."",
          ""suggested_governance"": ""Manage sales channel categories in a dimension table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'NT News'"",
            ""'Sunday Territorian'"",
            ""'Advertiser'"",
            ""'Post Courier'"",
            ""'PNG'"",
            ""'The Daily Telegraph'"",
            ""'The Sunday Telegraph'"",
            ""'Herald Sun'"",
            ""'Sunday Herald Sun'"",
            ""'Sunday Tasmanian'"",
            ""'Mercury'"",
            ""'The Sportsman'"",
            ""'The Courier Mail'"",
            ""'The Australian'"",
            ""'6 Day Pubs'"",
            ""'Mercury and Sunday Tas'"",
            ""'NT News & Sunday Territorian'"",
            ""'Other'"",
            ""'The Advertiser'"",
            ""'The Courier Mail'"",
            ""'The Daily Telegraph'"",
            ""'The Herald Sun'"",
            ""'Geelong Advertiser'"",
            ""'Sydney Suburbans'"",
            ""'Toowoomba'"",
            ""'Townsville Bulletin'""
          ],
          ""context"": ""Extensive hardcoded lists for publication categorization (e.g., publication_category_level_1, publication_type)."",
          ""suggested_governance"": ""Create a `DIM_publication_category` table to manage these mappings and join to it. This will centralize business logic and reduce query complexity."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""48""
          ],
          ""context"": ""Magic number '48' used in calculations for `clmn38_` (divisor for volume) and `clmn45_` (week to month mapping). This is highly ambiguous and likely a bug or placeholder."",
          ""suggested_governance"": ""Clarify the intent of this number. If it's a fiscal week/month, use the actual `fy_year_week_number` or `fy_month_of_year` column. If it's a fixed constant, parameterize it with a clear name."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'2'""
          ],
          ""context"": ""Magic string '2' used in `CASE WHEN ('2' = '1') THEN ...` to select a specific volume type (always `clmn51_`). This implies a hardcoded selection of 'Actual' or 'Forecast' based on other conditions."",
          ""suggested_governance"": ""Replace with a clear parameter (e.g., `selected_volume_type`) or a more explicit `CASE WHEN` that directly references the desired volume column based on business logic."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 WEEK)`)."",
      ""Replace hardcoded fiscal year (`FY2025`) with a dynamic parameter or a derived value from a fiscal calendar table."",
      ""Externalize publication categorization logic into a dedicated dimension table (`DIM_publication_category`) to avoid complex, repetitive `CASE WHEN` statements in queries."",
      ""Parameterize key filters like `os_level_6` ('CIRCULATION') if the dashboard needs to support other business areas."",
      ""Clarify and parameterize the 'magic numbers' (e.g., `48`) and 'magic strings' (e.g., `'2'`) used in calculations to improve readability and maintainability.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual financial amount recorded for a circulation event."",
      ""sql_logic"": ""t0.Actual_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base financial metric for circulation performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""volume"",
      ""metric_name"": ""Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The physical volume (e.g., number of copies) for a circulation event."",
      ""sql_logic"": ""t0.volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Base volume metric for circulation performance."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_actual_amount"",
      ""metric_name"": ""Last Year Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Actual financial amount from the previous fiscal year for comparison."",
      ""sql_logic"": ""t0.Last_Year_Actual_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_year_volume"",
      ""metric_name"": ""Last Year Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume from the previous fiscal year for comparison."",
      ""sql_logic"": ""t0.Last_Year_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for year-over-year comparisons."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budgeted financial amount for circulation."",
      ""sql_logic"": ""t0.Budget_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for actual vs. budget analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""budget_volume"",
      ""metric_name"": ""Budget Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Budgeted volume for circulation."",
      ""sql_logic"": ""t0.Budget_Volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for actual vs. budget analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecasted financial amount for circulation."",
      ""sql_logic"": ""t0.Forecast_Amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for actual vs. forecast analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""forecast_volume"",
      ""metric_name"": ""Forecast Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Forecasted volume for circulation."",
      ""sql_logic"": ""t0.Forecast_Volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for actual vs. forecast analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_actual_amount_sum"",
      ""metric_name"": ""Total Actual Amount (Sum)"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""actual_amount"",
        ""current_fiscal_week_filter"",
        ""sales_channel"",
        ""publication_name""
      ],
      ""business_description"": ""The sum of actual financial amounts for the filtered circulation data, typically for a specific fiscal week."",
      ""sql_logic"": ""SUM(t0.Actual_Amount) WHERE fy_year_week_number = (calculated_fiscal_week_from_2025-06-23) AND os_level_7 = 'All Sales Channels' AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""Fiscal Year: FY2025"",
        ""Circulation Type: 'CIRCULATION'"",
        ""Publication Exclusions: 'Free News & Lifestyle', 'Food', 'Prestige'"",
        ""Specific Fiscal Week (derived from 23/06/2025)"",
        ""Sales Channel: 'All Sales Channels'"",
        ""Publication Exclusions: 'Weekly Times', 'Sunshine Coast', 'Mackay'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary KPI for overall circulation revenue performance for a specific period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""23/06/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'All Sales Channels'"",
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_volume_sum"",
      ""metric_name"": ""Total Volume (Sum)"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume"",
        ""current_fiscal_week_filter"",
        ""sales_channel"",
        ""publication_name""
      ],
      ""business_description"": ""The sum of circulation volumes for the filtered data, typically for a specific fiscal week."",
      ""sql_logic"": ""SUM(t0.volume) WHERE fy_year_week_number = (calculated_fiscal_week_from_2025-06-23) AND os_level_7 = 'All Sales Channels' AND publication_name NOT IN ('Weekly Times', 'Sunshine Coast', 'Mackay')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""Fiscal Year: FY2025"",
        ""Circulation Type: 'CIRCULATION'"",
        ""Publication Exclusions: 'Free News & Lifestyle', 'Food', 'Prestige'"",
        ""Specific Fiscal Week (derived from 23/06/2025)"",
        ""Sales Channel: 'All Sales Channels'"",
        ""Publication Exclusions: 'Weekly Times', 'Sunshine Coast', 'Mackay'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A primary KPI for overall circulation volume performance for a specific period."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""23/06/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'All Sales Channels'"",
        ""'Weekly Times'"",
        ""'Sunshine Coast'"",
        ""'Mackay'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""record_count_by_publication_category"",
      ""metric_name"": ""Record Count by Publication Category"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""publication_category_level_1""
      ],
      ""business_description"": ""Counts the number of records for a specific publication category, primarily used for data validation or simple counts."",
      ""sql_logic"": ""COUNT(1) WHERE publication_category_level_1 = 'Advertiser'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""Fiscal Year: FY2025"",
        ""Circulation Type: 'CIRCULATION'"",
        ""Publication Exclusions: 'Free News & Lifestyle', 'Food', 'Prestige'"",
        ""Publication Category: 'Advertiser'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to verify data availability or distribution for specific publication groups."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Advertiser'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_category_level_1"",
      ""metric_name"": ""Publication Category (Level 1)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_name"",
        ""publication_code""
      ],
      ""business_description"": ""Categorizes publications into broader groups like 'Northern Territory', 'The Daily Telegraph', 'Others', etc."",
      ""sql_logic"": ""CASE WHEN publication_code = 'Post Courier' THEN 'PNG' WHEN publication_name IN (...) THEN 'Northern Territory' ... ELSE publication_name END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables aggregated reporting across different publication groups."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Post Courier'"",
        ""'NT News'"",
        ""'Sunday Territorian'"",
        ""'Others'"",
        ""'The Daily Telegraph'"",
        ""'The Sunday Telegraph'"",
        ""'Herald Sun'"",
        ""'Sunday Herald Sun'"",
        ""'Sunday Tasmanian'"",
        ""'Mercury'"",
        ""'Advertiser'"",
        ""'Sunday Mail (SA)'"",
        ""'Courier Mail'"",
        ""'Sunday Mail (QLD)'"",
        ""'The Australian'"",
        ""'The Sportsman'"",
        ""'Weekly Times'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_type"",
      ""metric_name"": ""Publication Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_name""
      ],
      ""business_description"": ""Classifies publications by their operational type, such as '6 Day Pubs', 'Mercury and Sunday Tas', etc."",
      ""sql_logic"": ""CASE WHEN publication_name IN ('Cairns Post', ...) THEN '6 Day Pubs' ... ELSE publication_name END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used in calculations for adjusted volume metrics, reflecting different operational models."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'6 Day Pubs'"",
        ""'Mercury and Sunday Tas'"",
        ""'NT News & Sunday Territorian'"",
        ""'Other'"",
        ""'The Advertiser'"",
        ""'The Courier Mail'"",
        ""'The Daily Telegraph'"",
        ""'The Herald Sun'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjusted_actual_volume"",
      ""metric_name"": ""Adjusted Actual Volume"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume"",
        ""publication_type"",
        ""publication_name"",
        ""day_of_week"",
        ""fy_month_of_year""
      ],
      ""business_description"": ""Represents the actual circulation volume normalized by publication frequency (e.g., 6-day vs 7-day) and adjusted based on specific publication rules and fiscal month, providing an 'average daily/weekly volume'."",
      ""sql_logic"": ""SUM(CASE WHEN publication_type = 'PNG' THEN 0 WHEN publication_type = '6 Day Pubs' THEN SAFE_DIVIDE(adjusted_volume_base, 6) ELSE SAFE_DIVIDE(adjusted_volume_base, 7) END) where adjusted_volume_base is a complex calculation of volume / fy_month_of_year, adjusted by day_of_week and specific publications."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""Fiscal Year: FY2025"",
        ""Circulation Type: 'CIRCULATION'"",
        ""Publication Exclusions: 'Free News & Lifestyle', 'Food', 'Prestige'"",
        ""Year-to-Date Fiscal Week (derived from 04/06/2025)"",
        ""Sales Channel: 'All Sales Channels'"",
        ""Publication Exclusions: 'Weekly Times', 'Sunshine Coast', 'Mackay'"",
        ""Publication Category Inclusion: specific list""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A critical KPI for understanding normalized circulation performance, accounting for operational differences across publications. Used for trend analysis and comparison."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""04/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""'The Australian'"",
        ""'The Courier Mail'"",
        ""'The Sportsman'"",
        ""'Weekly Times'"",
        ""magic_number_48""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table"",
        ""magic number should be clarified/parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential for division by zero if fy_month_of_year is 0 or null (handled by SAFE_DIVIDE but results in null)""
      ]
    },
    {
      ""metric_id"": ""adjusted_target_forecast_py_volume"",
      ""metric_name"": ""Adjusted Target/Forecast/PY Volume"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""volume"",
        ""budget_volume"",
        ""forecast_volume"",
        ""last_year_volume"",
        ""publication_type"",
        ""publication_name"",
        ""day_of_week"",
        ""fy_month_of_year"",
        ""fy_year_week_number""
      ],
      ""business_description"": ""Represents a normalized circulation volume that dynamically switches between actual, budget, forecast, or previous year volumes based on the fiscal period (week/month) and publication rules, adjusted for publication frequency."",
      ""sql_logic"": ""SUM(CASE WHEN publication_type = 'PNG' THEN 0 WHEN publication_type = '6 Day Pubs' THEN SAFE_DIVIDE(dynamic_volume_base, 6) ELSE SAFE_DIVIDE(dynamic_volume_base, 7) END) where dynamic_volume_base is a complex selection of volume, Forecast_Volume, Last_Year_volume, Budget_Volume based on fy_year_week_number and fy_month_of_year, then adjusted by day_of_week and specific publications."",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""Fiscal Year: FY2025"",
        ""Circulation Type: 'CIRCULATION'"",
        ""Publication Exclusions: 'Free News & Lifestyle', 'Food', 'Prestige'"",
        ""Year-to-Date Fiscal Week (derived from 04/06/2025)"",
        ""Sales Channel: 'All Sales Channels'"",
        ""Publication Exclusions: 'Weekly Times', 'Sunshine Coast', 'Mackay'"",
        ""Publication Category Inclusion: specific list""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A critical KPI for comparing current performance against targets, forecasts, or historical data, providing a comprehensive view of circulation health."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""04/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'PNG'"",
        ""'6 Day Pubs'"",
        ""'The Australian'"",
        ""'The Courier Mail'"",
        ""'The Sportsman'"",
        ""'Weekly Times'"",
        ""magic_number_48"",
        ""magic_string_2""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table"",
        ""magic number/string should be clarified/parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential for division by zero if fy_month_of_year is 0 or null (handled by SAFE_DIVIDE but results in null)""
      ]
    },
    {
      ""metric_id"": ""fiscal_week_number"",
      ""metric_name"": ""Fiscal Week Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year."",
      ""sql_logic"": ""t0.fy_year_week_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated"",
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for weekly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_channel"",
      ""metric_name"": ""Sales Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sales channel through which circulation occurs (e.g., 'All Sales Channels')."",
      ""sql_logic"": ""t0.os_level_7"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of circulation performance by sales channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific name of the publication (e.g., 'The Daily Telegraph', 'Herald Sun')."",
      ""sql_logic"": ""t0.publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for breaking down circulation performance by individual publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_actual_amount_sum"",
      ""related_metrics"": [
        ""total_volume_sum""
      ],
      ""relationship_description"": ""Both Total Actual Amount and Total Volume are filtered by the same complex fiscal week logic and publication/sales channel exclusions, ensuring consistent reporting for the selected period and scope."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that revenue and volume metrics are always reported for the same underlying data subset, preventing discrepancies."",
      ""validation_sql"": ""SELECT COUNT(*) FROM (SELECT SUM(clmn0_) FROM (...) WHERE (clmn12_ = true AND clmn4_ != 'Weekly Times' AND clmn4_ != 'Sunshine Coast' AND clmn4_ != 'Mackay' AND clmn3_ = 'All Sales Channels')) AS q1 JOIN (SELECT SUM(clmn5_) FROM (...) WHERE (clmn12_ = true AND clmn4_ != 'Weekly Times' AND clmn4_ != 'Sunshine Coast' AND clmn4_ != 'Mackay' AND clmn3_ = 'All Sales Channels')) AS q2 ON 1=1 WHERE q1.sum_clmn0_ IS NOT NULL AND q2.sum_clmn5_ IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""adjusted_actual_volume"",
      ""related_metrics"": [
        ""volume"",
        ""publication_type"",
        ""day_of_week"",
        ""fy_month_of_year""
      ],
      ""relationship_description"": ""Adjusted Actual Volume is derived from raw volume, normalized by publication type (6-day vs 7-day) and further adjusted based on day of week and fiscal month, reflecting an 'average daily/weekly volume'."",
      ""mathematical_formula"": ""Adjusted_Volume = (Volume / (Fiscal_Month_Number * X)) / Y, where X and Y vary based on publication type and day of week."",
      ""business_validation"": ""This calculation aims to provide a comparable volume metric across different publication types and reporting periods, essential for fair performance evaluation."",
      ""validation_sql"": ""SELECT publication_name, fy_year_week_number, volume, adjusted_actual_volume FROM primary_analysis_sql WHERE volume > 0 LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""adjusted_target_forecast_py_volume"",
      ""related_metrics"": [
        ""volume"",
        ""budget_volume"",
        ""forecast_volume"",
        ""last_year_volume"",
        ""publication_type"",
        ""day_of_week"",
        ""fy_month_of_year"",
        ""fy_year_week_number""
      ],
      ""relationship_description"": ""Adjusted Target/Forecast/PY Volume dynamically selects a base volume (Actual, Budget, Forecast, or Last Year) based on fiscal week/month, then applies the same normalization and adjustment logic as Adjusted Actual Volume."",
      ""mathematical_formula"": ""Adjusted_Target_Volume = (Selected_Base_Volume / (Fiscal_Month_Number * X)) / Y, where Selected_Base_Volume is chosen conditionally."",
      ""business_validation"": ""This metric provides a dynamic benchmark for comparison against Adjusted Actual Volume, allowing for 'actual vs. target' or 'actual vs. forecast' analysis within a single metric depending on the reporting period."",
      ""validation_sql"": ""SELECT publication_name, fy_year_week_number, volume, forecast_volume, adjusted_target_forecast_py_volume FROM primary_analysis_sql WHERE volume > 0 LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""publication_name"",
      ""related_metrics"": [
        ""publication_category_level_1"",
        ""publication_type""
      ],
      ""relationship_description"": ""Individual publication names roll up into broader publication categories and types, enabling aggregated reporting and specific calculation logic."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Provides flexibility in reporting granularity and applies specific business rules (e.g., 6-day vs 7-day pubs) at the appropriate level."",
      ""validation_sql"": ""SELECT DISTINCT publication_name, publication_category_level_1, publication_type FROM primary_analysis_sql LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,19
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""155c4518-72bf-4309-a0e9-240dd564f421"",
    ""dashboard_name"": ""Portfolio Performance Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""finance|sales|advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 22,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""GSD"",
      ""financial_month"",
      ""financial_quarter"",
      ""relative_fy_month_offset"",
      ""relative_fy_quarter_offset"",
      ""relative_fy_year_offset"",
      ""advertiser_group"",
      ""portfolio_conformed_name_sync"",
      ""fin_adtype_name"",
      ""product_group"",
      ""revenue_type"",
      ""sales_segment_gm_name_sync""
    ],
    ""date_range_detected"": ""Current Fiscal Year/Month and Previous Fiscal Year/Month"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'$\\'000' = '$'"",
      ""0 (offset)"",
      ""-1 (offset)"",
      ""-12 (offset)"",
      ""-4 (offset)"",
      ""1000 (scaling factor)"",
      ""0.01 (threshold)"",
      ""-0.01 (threshold)"",
      ""0 (threshold)"",
      ""'All' (customer status)"",
      ""'NEW BUSINESS' (customer status)"",
      ""'RETAINED' (customer status)"",
      ""'INACTIVE' (customer status)"",
      ""'LAPSED' (customer status)"",
      ""'Other' (customer status)"",
      ""'The Australian & Prestige' (product group)"",
      ""'State & Communities' (product group)"",
      ""'Free News & Lifestyle' (product group)"",
      ""'Client' (product group)"",
      ""'Commercial Content' (product group)"",
      ""'Group Functions' (product group)"",
      ""'Others' (product group)"",
      ""'Unknown' (product group)"",
      ""'XTEND' (ad type)"",
      ""'PRINT' (revenue type)"",
      ""'DESIREE DURRANT' (GSD)"",
      ""'CHRIS JEFFS' (GSD)"",
      ""'1' (customer retention type parameter value)""
    ],
    ""governance_opportunities"": [
      ""Replace hardcoded relative offsets with dynamic date logic or parameters for fiscal periods."",
      ""Externalize all lookup values (customer status, product groups, ad types, revenue types) into governed reference tables."",
      ""Parameterize thresholds for flags like 'blank_portfolio_flag'."",
      ""Parameterize GSD names for filtering."",
      ""Remove or fix dead code like `('$\\'000' = '$')` condition."",
      ""Consolidate redundant metric calculations.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for comprehensive portfolio performance analysis.\n-- It calculates all key metrics and dimensions identified from the dashboard queries.\n-- Parameters:\n--   @reporting_mth: Integer, 0 for current/previous FY month, or specific financial month (e.g., 7 for July). Default to 0.\n--   @customer_retention_type: String, '1' to force 'All' customer status, or any other value for detailed status. Default to '0'.\n--   @gsd_filter: String, comma-separated list of GSD names (e.g., 'DESIREE DURRANT', 'CHRIS JEFFS'). Set to '%' for all. Default to '%'.\n--   @revenue_type_exclude_filter: String, comma-separated list of revenue types to exclude (e.g., 'PRINT'). Set to '%' for none. Default to '%'.\n\nWITH\n  base_data AS (\n    SELECT\n      t0.GSD,\n      t0.gross_revenue_amount,\n      t0.relative_fy_quarter_offset,\n      t0.relative_fy_year_offset,\n      t0.target,\n      t0.financial_month,\n      t0.financial_quarter,\n      t0.relative_fy_month_offset,\n      t0.advertiser_group,\n      t0.portfolio_conformed_name_sync,\n      t0.fin_adtype_name,\n      t0.product_group,\n      t0.revenue_type,\n      t0.sales_segment_gm_name_sync,\n      -- Derived fields from original CTE\n      CASE\n        WHEN COALESCE(@reporting_mth, 0) = 0 THEN\n          CASE\n            WHEN t0.relative_fy_month_offset = 0 OR t0.relative_fy_month_offset = -12 THEN CAST(t0.financial_month AS INT)\n          END\n        ELSE COALESCE(@reporting_mth, 0)\n      END AS filter_reporting_month,\n      SUM(CASE WHEN t0.relative_fy_year_offset = -1 THEN t0.gross_revenue_amount ELSE 0 END) OVER (PARTITION BY t0.advertiser_group) AS fix_ly_lgr,\n      SUM(CASE WHEN t0.relative_fy_year_offset = 0 THEN t0.gross_revenue_amount ELSE 0 END) OVER (PARTITION BY t0.advertiser_group) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance AS t0\n    WHERE\n      -- Apply a reasonable date filter for performance and cost optimization\n      -- Assuming 'relative_fy_year_offset' covers relevant periods\n      t0.relative_fy_year_offset IN (0, -1) -- Current and Previous Fiscal Year\n  ),\n  calculated_metrics AS (\n    SELECT\n      GSD,\n      gross_revenue_amount,\n      relative_fy_quarter_offset,\n      relative_fy_year_offset,\n      target,\n      financial_month,\n      financial_quarter,\n      relative_fy_month_offset,\n      advertiser_group,\n      portfolio_conformed_name_sync,\n      fin_adtype_name,\n      product_group,\n      revenue_type,\n      sales_segment_gm_name_sync,\n      filter_reporting_month,\n      fix_ly_lgr,\n      fix_ty_lgr,\n      -- Derived dimensions/metrics\n      MAX(\n        CASE\n          WHEN filter_reporting_month = CAST(financial_month AS INT) THEN financial_quarter\n          WHEN COALESCE(@reporting_mth, 0) = 0 THEN `IF`(relative_fy_quarter_offset = 0, financial_quarter, null)\n          ELSE NULL\n        END) OVER (PARTITION BY filter_reporting_month) AS report_quarter,\n      CASE\n        WHEN COALESCE(@customer_retention_type, '0') = '1' THEN 'All'\n        ELSE\n          CASE\n            WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS'\n            WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED'\n            WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE'\n            WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED'\n            ELSE 'Other'\n          END\n      END AS customer_status_full,\n      SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) AS portfolio_gross_revenue_000s,\n      SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) AS portfolio_current_fy_target,\n      SAFE_DIVIDE(gross_revenue_amount, 1000) AS gross_revenue_amount_000s,\n      SAFE_DIVIDE(target, 1000) AS target_amount_000s,\n      CASE WHEN (relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END AS current_fy_qtr_gross_revenue_000s_detail,\n      CASE WHEN (relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4) THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE NULL END AS previous_fy_qtr_gross_revenue_000s_detail,\n      CASE WHEN (relative_fy_quarter_offset = 0) THEN SAFE_DIVIDE(target, 1000) ELSE NULL END AS current_fy_qtr_target_000s_detail,\n      CASE\n        WHEN product_group = 'The Australian & Prestige' THEN 1\n        WHEN product_group = 'State & Communities' THEN 2\n        WHEN product_group = 'Free News & Lifestyle' THEN 3\n        WHEN product_group = 'Client' THEN 4\n        WHEN product_group = 'Commercial Content' THEN 5\n        WHEN product_group = 'Group Functions' THEN 6\n        WHEN product_group = 'Others' THEN 7\n        WHEN product_group = 'Unknown' THEN 8\n        ELSE 9\n      END AS product_group_order,\n      CASE WHEN fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE revenue_type END AS revenue_type_category\n    FROM\n      base_data\n  )\nSELECT\n  GSD,\n  financial_month,\n  financial_quarter,\n  relative_fy_quarter_offset,\n  relative_fy_year_offset,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  fin_adtype_name,\n  product_group,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  filter_reporting_month,\n  report_quarter,\n  customer_status_full,\n  CASE\n    WHEN portfolio_gross_revenue_000s > 0.01 OR portfolio_gross_revenue_000s < -0.01 OR portfolio_current_fy_target != 0 THEN 'include'\n    ELSE 'exclude'\n  END AS blank_portfolio_flag,\n  product_group_order,\n  revenue_type_category,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount,\n  SUM(target) AS total_target_amount,\n  SUM(gross_revenue_amount_000s) AS total_gross_revenue_amount_000s,\n  SUM(target_amount_000s) AS total_target_amount_000s,\n  SUM(current_fy_qtr_gross_revenue_000s_detail) AS current_fy_qtr_gross_revenue_000s_sum,\n  SUM(previous_fy_qtr_gross_revenue_000s_detail) AS previous_fy_qtr_gross_revenue_000s_sum,\n  SUM(current_fy_qtr_target_000s_detail) AS current_fy_qtr_target_000s_sum,\n  COUNT(product_group_order) AS product_group_count,\n  SUM(product_group_order) AS product_group_sum_order\nFROM\n  calculated_metrics\nWHERE\n  (COALESCE(@gsd_filter, '%') = '%' OR GSD IN UNNEST(SPLIT(COALESCE(@gsd_filter, '%'), ',')))\n  AND (COALESCE(@revenue_type_exclude_filter, '%') = '%' OR revenue_type_category NOT IN UNNEST(SPLIT(COALESCE(@revenue_type_exclude_filter, '%'), ',')))\nGROUP BY\n  GSD,\n  financial_month,\n  financial_quarter,\n  relative_fy_quarter_offset,\n  relative_fy_year_offset,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  fin_adtype_name,\n  product_group,\n  revenue_type,\n  sales_segment_gm_name_sync,\n  filter_reporting_month,\n  report_quarter,\n  customer_status_full,\n  blank_portfolio_flag,\n  product_group_order,\n  revenue_type_category\nLIMIT 1000; -- Add a limit for sampling"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_month) as unique_financial_months,\n  COUNT(DISTINCT financial_quarter) as unique_financial_quarters,\n  COUNT(DISTINCT relative_fy_year_offset) as unique_fy_year_offsets,\n  COUNT(DISTINCT GSD) as unique_gsds,\n  COUNT(DISTINCT advertiser_group) as unique_advertiser_groups,\n  COUNT(DISTINCT portfolio_conformed_name_sync) as unique_portfolios,\n  MIN(relative_fy_year_offset) as earliest_fy_year_offset,\n  MAX(relative_fy_year_offset) as latest_fy_year_offset,\n  MIN(financial_month) as earliest_financial_month,\n  MAX(financial_month) as latest_financial_month,\n  SUM(gross_revenue_amount) as total_gross_revenue_sample\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  relative_fy_year_offset IN (0, -1) -- Focus on recent fiscal years\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT advertiser_group) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_group_test,\n  CASE WHEN MAX(relative_fy_year_offset) = 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_freshness_test,\n  CASE WHEN MIN(relative_fy_year_offset) <= -1 THEN 'PASS' ELSE 'FAIL' END as historical_fy_data_presence_test\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  relative_fy_year_offset IN (0, -1) -- Check current and previous FY\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Validate customer status full logic\nWITH\n  base_data AS (\n    SELECT\n      advertiser_group,\n      SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS fix_ly_lgr,\n      SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS fix_ty_lgr\n    FROM\n      `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\n    WHERE\n      relative_fy_year_offset IN (0, -1)\n    GROUP BY\n      advertiser_group\n  )\nSELECT\n  'Customer Status Full Validation' as validation_type,\n  'NEW BUSINESS Rule' as rule_name,\n  COUNT(*) as total_advertisers,\n  SUM(CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END) as new_business_count,\n  SAFE_DIVIDE(SUM(CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END), COUNT(*)) * 100 as new_business_percentage\nFROM\n  base_data\nUNION ALL\nSELECT\n  'Customer Status Full Validation' as validation_type,\n  'RETAINED Rule' as rule_name,\n  COUNT(*) as total_advertisers,\n  SUM(CASE WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END) as retained_count,\n  SAFE_DIVIDE(SUM(CASE WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 1 ELSE 0 END), COUNT(*)) * 100 as retained_percentage\nFROM\n  base_data\nUNION ALL\nSELECT\n  'Customer Status Full Validation' as validation_type,\n  'INACTIVE Rule' as rule_name,\n  COUNT(*) as total_advertisers,\n  SUM(CASE WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END) as inactive_count,\n  SAFE_DIVIDE(SUM(CASE WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END), COUNT(*)) * 100 as inactive_percentage\nFROM\n  base_data\nUNION ALL\nSELECT\n  'Customer Status Full Validation' as validation_type,\n  'LAPSED Rule' as rule_name,\n  COUNT(*) as total_advertisers,\n  SUM(CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END) as lapsed_count,\n  SAFE_DIVIDE(SUM(CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 1 ELSE 0 END), COUNT(*)) * 100 as lapsed_percentage\nFROM\n  base_data;"",
    ""sample_data_sql"": ""SELECT \n  GSD,\n  gross_revenue_amount,\n  target,\n  relative_fy_quarter_offset,\n  relative_fy_year_offset,\n  financial_month,\n  financial_quarter,\n  relative_fy_month_offset,\n  advertiser_group,\n  portfolio_conformed_name_sync,\n  fin_adtype_name,\n  product_group,\n  revenue_type,\n  sales_segment_gm_name_sync\nFROM\n  `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance\nWHERE\n  relative_fy_year_offset IN (0, -1) -- Current and Previous Fiscal Year\nORDER BY\n  gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'$\\'000' = '$'""],
          ""context"": ""Conditional logic for revenue/target formatting, which is always false due to string comparison. This makes the 'THEN' branch unreachable."",
          ""suggested_governance"": ""Remove dead code or parameterize formatting preference if dynamic formatting is truly needed."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [""0.01"", ""-0.01"", ""0""],
          ""context"": ""Thresholds used to determine 'blank_portfolio_flag' based on scaled gross revenue and target."",
          ""suggested_governance"": ""Parameterize these thresholds for flexibility and easier adjustment by business users."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'NEW BUSINESS'"", ""'RETAINED'"", ""'INACTIVE'"", ""'LAPSED'"", ""'Other'"", ""'All'""],
          ""context"": ""Customer status categories derived from revenue performance (fix_ly_lgr, fix_ty_lgr)."",
          ""suggested_governance"": ""Store these categories and their definitions (including thresholds) in a governed reference table to centralize business logic."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'The Australian & Prestige'"", ""'State & Communities'"", ""'Free News & Lifestyle'"", ""'Client'"", ""'Commercial Content'"", ""'Group Functions'"", ""'Others'"", ""'Unknown'""],
          ""context"": ""Product group categories and their hardcoded numerical ordering."",
          ""suggested_governance"": ""Store product group definitions and their display order in a reference table, allowing for easier updates and consistent application."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'XTEND'""],
          ""context"": ""Specific ad type used for categorization within 'revenue_type_category'."",
          ""suggested_governance"": ""If 'XTEND' is a specific type, it should be part of a `fin_adtype_name` lookup table to ensure consistency and manageability."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'PRINT'""],
          ""context"": ""Specific revenue type used for filtering in one of the queries."",
          ""suggested_governance"": ""If 'PRINT' is a specific type, it should be part of a `revenue_type` lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""0"", ""-1"", ""-12"", ""-4""],
          ""context"": ""Relative fiscal year/month/quarter offsets used for current/previous period calculations. These define the reporting window."",
          ""suggested_governance"": ""Use dynamic date logic (e.g., `CURRENT_DATE()`, `DATE_TRUNC`) or parameterize fiscal period definitions to make the dashboard adaptable to different reporting periods."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'DESIREE DURRANT'"", ""'CHRIS JEFFS'""],
          ""context"": ""Specific GSD names used for filtering data in individual queries."",
          ""suggested_governance"": ""Parameterize GSD names for filtering or use a GSD dimension table for dynamic selection, avoiding hardcoded lists."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""parameters"",
          ""hardcoded_values"": [""'1'""],
          ""context"": ""Hardcoded value for `@customer_retention_type` parameter, which forces 'All' customer status, overriding detailed logic."",
          ""suggested_governance"": ""Ensure parameter is correctly configured in Looker Studio to allow user selection, or remove the hardcoded default if it's not intended to force 'All'."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [""1000""],
          ""context"": ""Scaling factor used to convert amounts to '000s."",
          ""suggested_governance"": ""Parameterize the scaling factor if it might change or if different scales are needed."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded relative fiscal period offsets with dynamic date parameters (e.g., `reporting_fiscal_month`, `reporting_fiscal_year`) or relative date functions based on `CURRENT_DATE()`."",
      ""Replace hardcoded lookup values (customer status, product groups, revenue types, GSD names) with joins to governed reference tables."",
      ""Use configuration tables or Looker Studio parameters for business rule thresholds (e.g., `blank_portfolio_flag_threshold`, `customer_retention_revenue_threshold`).""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gsd_name"",
      ""metric_name"": ""General Sales Director Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the General Sales Director associated with the ad sales performance."",
      ""sql_logic"": ""t0.GSD"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping performance data by sales director."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue generated from ad sales."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for sales performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential for nulls or negative values.""]
    },
    {
      ""metric_id"": ""target_amount"",
      ""metric_name"": ""Target Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The target revenue amount set for ad sales."",
      ""sql_logic"": ""t0.target"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to measure performance against set goals."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential for nulls or incorrect targets.""]
    },
    {
      ""metric_id"": ""relative_fy_quarter_offset"",
      ""metric_name"": ""Relative Fiscal Quarter Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the fiscal quarter relative to the current reporting fiscal quarter (0 for current, -4 for previous year's same quarter)."",
      ""sql_logic"": ""t0.relative_fy_quarter_offset"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to identify current and previous fiscal quarters for comparative analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""-4""],
      ""governance_issues"": [""Hardcoded offsets should be parameterized or derived dynamically.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset"",
      ""metric_name"": ""Relative Fiscal Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the fiscal year relative to the current reporting fiscal year (0 for current, -1 for previous)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to identify current and previous fiscal years for comparative analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""-1""],
      ""governance_issues"": [""Hardcoded offsets should be parameterized or derived dynamically.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month number."",
      ""sql_logic"": ""t0.financial_month"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for time-based aggregation and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter string (e.g., 'Q1', 'Q2')."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for time-based aggregation and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_month_offset"",
      ""metric_name"": ""Relative Fiscal Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the fiscal month relative to the current reporting fiscal month (0 for current, -12 for previous year's same month)."",
      ""sql_logic"": ""t0.relative_fy_month_offset"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to identify current and previous fiscal months for comparative analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""-12""],
      ""governance_issues"": [""Hardcoded offsets should be parameterized or derived dynamically.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_group"",
      ""metric_name"": ""Advertiser Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group to which an advertiser belongs."",
      ""sql_logic"": ""t0.advertiser_group"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing performance by advertiser segments."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The conformed name of the portfolio."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing performance by portfolio."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the financial ad type."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides detail on the type of advertisement."",
      ""metric_category"": ""advertising"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group"",
      ""metric_name"": ""Product Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The product group classification."",
      ""sql_logic"": ""t0.product_group"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and analyzing performance by product category."",
      ""metric_category"": ""advertising"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of revenue generated."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting revenue by its nature (e.g., 'PRINT')."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_gm_name_sync"",
      ""metric_name"": ""Sales Segment GM Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the General Manager for the sales segment."",
      ""sql_logic"": ""t0.sales_segment_gm_name_sync"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping performance data by sales segment leadership."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount_000s"",
      ""metric_name"": ""Gross Revenue Amount ('000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount""],
      ""business_description"": ""Gross revenue amount scaled down by 1000 for display purposes. The original query had a redundant CASE statement that always resulted in this calculation."",
      ""sql_logic"": ""SAFE_DIVIDE(gross_revenue_amount, 1000)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate calculation for final revenue metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1000""],
      ""governance_issues"": [""Scaling factor '1000' is hardcoded.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""target_amount_000s"",
      ""metric_name"": ""Target Amount ('000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""target_amount""],
      ""business_description"": ""Target amount scaled down by 1000 for display purposes. The original query had a redundant CASE statement that always resulted in this calculation."",
      ""sql_logic"": ""SAFE_DIVIDE(target, 1000)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate calculation for final target metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1000""],
      ""governance_issues"": [""Scaling factor '1000' is hardcoded.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""filter_reporting_month"",
      ""metric_name"": ""Filter Reporting Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""relative_fy_month_offset"", ""financial_month""],
      ""business_description"": ""Determines the reporting month based on a Looker Studio parameter (`@reporting_mth`) or relative fiscal month offset (current or previous year's same month)."",
      ""sql_logic"": ""CASE WHEN @reporting_mth = 0 THEN CASE WHEN relative_fy_month_offset = 0 OR relative_fy_month_offset = -12 THEN CAST(financial_month AS INT) END ELSE @reporting_mth END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for dynamic date filtering and period selection in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""-12""],
      ""governance_issues"": [""Hardcoded offsets and parameter default '0' for @reporting_mth.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fix_ly_lgr"",
      ""metric_name"": ""Fixed Last Year Gross Revenue (Advertiser Group)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser_group"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount"", ""relative_fy_year_offset"", ""advertiser_group""],
      ""business_description"": ""Sum of gross revenue for the previous fiscal year, partitioned by advertiser group. This is an intermediate calculation used for customer status determination."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key component for determining customer retention status."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""-1""],
      ""governance_issues"": [""Hardcoded relative year offset.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fix_ty_lgr"",
      ""metric_name"": ""Fixed This Year Gross Revenue (Advertiser Group)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""advertiser_group"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount"", ""relative_fy_year_offset"", ""advertiser_group""],
      ""business_description"": ""Sum of gross revenue for the current fiscal year, partitioned by advertiser group. This is an intermediate calculation used for customer status determination."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) OVER (PARTITION BY advertiser_group)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key component for determining customer retention status."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0""],
      ""governance_issues"": [""Hardcoded relative year offset.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""report_quarter"",
      ""metric_name"": ""Report Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""filter_reporting_month"", ""financial_month"", ""financial_quarter"", ""relative_fy_quarter_offset""],
      ""business_description"": ""Determines the reporting quarter based on the filter reporting month and fiscal quarter offsets. Used for dynamic quarter-based reporting."",
      ""sql_logic"": ""MAX(CASE WHEN filter_reporting_month = CAST(financial_month AS INT) THEN financial_quarter WHEN @reporting_mth = 0 THEN IF(relative_fy_quarter_offset = 0, financial_quarter, null) ELSE NULL END) OVER (PARTITION BY filter_reporting_month)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for dynamic quarter-based reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0""],
      ""governance_issues"": [""Hardcoded offset '0' for relative_fy_quarter_offset.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""customer_status_full"",
      ""metric_name"": ""Customer Retention Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""fix_ly_lgr"", ""fix_ty_lgr""],
      ""business_description"": ""Categorizes customers into retention statuses (NEW BUSINESS, RETAINED, INACTIVE, LAPSED, Other) based on their gross revenue performance in current and previous fiscal years. Can be forced to 'All' via a Looker Studio parameter."",
      ""sql_logic"": ""CASE WHEN @customer_retention_type = '1' THEN 'All' ELSE CASE WHEN fix_ly_lgr <= 1 AND fix_ty_lgr > 1 THEN 'NEW BUSINESS' WHEN fix_ly_lgr > 1 AND fix_ty_lgr > 1 THEN 'RETAINED' WHEN fix_ly_lgr > 1 AND fix_ty_lgr <= 1 THEN 'INACTIVE' WHEN fix_ly_lgr <= 1 AND fix_ty_lgr <= 1 THEN 'LAPSED' ELSE 'Other' END END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Critical for understanding customer lifecycle and segmenting retention efforts."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'1'"", ""'NEW BUSINESS'"", ""'RETAINED'"", ""'INACTIVE'"", ""'LAPSED'"", ""'Other'""],
      ""governance_issues"": [""Hardcoded thresholds (1) and category names. Parameter value '1' for @customer_retention_type forces 'All'.""],
      ""data_quality_concerns"": [""Reliance on '1' as a threshold for revenue presence might be too simplistic.""]
    },
    {
      ""metric_id"": ""blank_portfolio_flag"",
      ""metric_name"": ""Blank Portfolio Flag"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""portfolio"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""gross_revenue_amount_000s"", ""target_amount_000s"", ""relative_fy_year_offset"", ""portfolio_conformed_name_sync""],
      ""business_description"": ""Flag to include/exclude portfolios based on whether they have significant gross revenue (scaled by 1000) or target in the current fiscal year. 'include' if revenue is outside (-0.01, 0.01) or target is non-zero, 'exclude' otherwise."",
      ""sql_logic"": ""CASE WHEN SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) > 0.01 OR SUM(gross_revenue_amount / 1000) OVER (PARTITION BY portfolio_conformed_name_sync) < -0.01 OR SUM(IF(relative_fy_year_offset = 0, target, null)) OVER (PARTITION BY portfolio_conformed_name_sync) != 0 THEN 'include' ELSE 'exclude' END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter out portfolios with negligible activity, ensuring focus on relevant data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""1000"", ""0.01"", ""-0.01"", ""0""],
      ""governance_issues"": [""Hardcoded scaling factor and thresholds.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group_order"",
      ""metric_name"": ""Product Group Order"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""product_group""],
      ""business_description"": ""Numerical ordering for product groups, used for sorting or internal calculations. The order is hardcoded."",
      ""sql_logic"": ""CASE WHEN product_group = 'The Australian & Prestige' THEN 1 ... ELSE 9 END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a consistent sort order for product groups in visualizations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'The Australian & Prestige'"", ""'State & Communities'"", ""'Free News & Lifestyle'"", ""'Client'"", ""'Commercial Content'"", ""'Group Functions'"", ""'Others'"", ""'Unknown'"", ""1"", ""2"", ""3"", ""4"", ""5"", ""6"", ""7"", ""8"", ""9""],
      ""governance_issues"": [""Hardcoded product group names and their corresponding order. Should be in a lookup table.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_category"",
      ""metric_name"": ""Revenue Type Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [""fin_adtype_name"", ""revenue_type""],
      ""business_description"": ""Categorizes revenue type, specifically highlighting 'XTEND' ad type. If fin_adtype_name is 'XTEND', it uses 'XTEND', otherwise it uses the raw revenue_type."",
      ""sql_logic"": ""CASE WHEN fin_adtype_name = 'XTEND' THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering and grouping by a specific revenue type category."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'XTEND'""],
      ""governance_issues"": [""Hardcoded 'XTEND' value.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_qtr_gross_revenue_000s_sum"",
      ""metric_name"": ""Current FY Quarter Gross Revenue ('000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_000s"", ""relative_fy_year_offset"", ""relative_fy_quarter_offset""],
      ""business_description"": ""Total gross revenue in thousands for the current fiscal year and current fiscal quarter."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 AND relative_fy_quarter_offset = 0 THEN gross_revenue_amount_000s ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""GSD filter (e.g., 'DESIREE DURRANT')""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for current period revenue performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0"", ""0""],
      ""governance_issues"": [""Hardcoded relative year and quarter offsets.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_qtr_gross_revenue_000s_sum"",
      ""metric_name"": ""Previous FY Quarter Gross Revenue ('000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gross_revenue_amount_000s"", ""relative_fy_year_offset"", ""relative_fy_quarter_offset""],
      ""business_description"": ""Total gross revenue in thousands for the previous fiscal year and previous fiscal quarter (relative to current)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = -1 AND relative_fy_quarter_offset = -4 THEN gross_revenue_amount_000s ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""GSD filter (e.g., 'DESIREE DURRANT')""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for year-over-year and quarter-over-quarter revenue comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""-1"", ""-4""],
      ""governance_issues"": [""Hardcoded relative year and quarter offsets.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_qtr_target_000s_sum"",
      ""metric_name"": ""Current FY Quarter Target ('000s)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""target_amount_000s"", ""relative_fy_quarter_offset""],
      ""business_description"": ""Total target amount in thousands for the current fiscal quarter."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_quarter_offset = 0 THEN target_amount_000s ELSE NULL END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""GSD filter (e.g., 'DESIREE DURRANT')""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for current period target performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""0""],
      ""governance_issues"": [""Hardcoded relative quarter offset.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_group_count"",
      ""metric_name"": ""Product Group Count"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""product_group_order""],
      ""business_description"": ""Count of records for each product group, based on its numerical order. This metric's business utility is questionable as it counts the numerical representation, not distinct product groups."",
      ""sql_logic"": ""COUNT(product_group_order)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""GSD filter (e.g., 'CHRIS JEFFS')"", ""Revenue Type filter (e.g., NOT 'PRINT')""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of entries per product group, potentially indicating volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""The underlying 'product_group_order' is a numerical representation, not a true count of distinct items.""],
      ""data_quality_concerns"": [""This metric is likely not useful for business analysis and should be reviewed.""]
    },
    {
      ""metric_id"": ""product_group_sum_order"",
      ""metric_name"": ""Product Group Sum of Order"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""product"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [""product_group_order""],
      ""business_description"": ""Sum of the numerical order values for each product group. This metric's business utility is highly questionable as it sums an arbitrary numerical ordering."",
      ""sql_logic"": ""SUM(product_group_order)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""GSD filter (e.g., 'CHRIS JEFFS')"", ""Revenue Type filter (e.g., NOT 'PRINT')""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Unclear business utility; likely an artifact of Looker Studio's aggregation of a numerical dimension."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Metric is derived from an arbitrary numerical ordering, not a meaningful business value.""],
      ""data_quality_concerns"": [""This metric is likely not useful for business analysis and should be reviewed.""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""customer_status_full"",
      ""related_metrics"": [""fix_ly_lgr"", ""fix_ty_lgr""],
      ""relationship_description"": ""Customer retention status is determined by comparing current and previous fiscal year gross revenue for an advertiser group. The logic uses hardcoded thresholds (<=1, >1) for `fix_ly_lgr` and `fix_ty_lgr`."",
      ""mathematical_formula"": ""Based on thresholds (<=1, >1) for fix_ly_lgr and fix_ty_lgr."",
      ""business_validation"": ""Ensures accurate categorization of customer lifecycle stages (New, Retained, Inactive, Lapsed)."",
      ""validation_sql"": ""SELECT customer_status_full, fix_ly_lgr, fix_ty_lgr, COUNT(*) FROM CTE GROUP BY 1,2,3 LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_revenue_amount_000s"",
      ""related_metrics"": [""gross_revenue_amount""],
      ""relationship_description"": ""Gross Revenue Amount ('000s) is derived by dividing Gross Revenue Amount by 1000 for display purposes."",
      ""mathematical_formula"": ""gross_revenue_amount_000s = gross_revenue_amount / 1000"",
      ""business_validation"": ""Ensures consistent scaling of revenue figures for reporting."",
      ""validation_sql"": ""SELECT gross_revenue_amount, gross_revenue_amount_000s, gross_revenue_amount / 1000 AS calculated_000s FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance` WHERE gross_revenue_amount IS NOT NULL LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""blank_portfolio_flag"",
      ""related_metrics"": [""gross_revenue_amount_000s"", ""target_amount_000s"", ""relative_fy_year_offset"", ""portfolio_conformed_name_sync""],
      ""relationship_description"": ""The 'blank_portfolio_flag' determines whether a portfolio is included ('include') or excluded ('exclude') from analysis based on its aggregated revenue and target values. It filters out portfolios with negligible activity."",
      ""mathematical_formula"": ""IF (SUM(revenue_000s) OVER (PARTITION BY portfolio) > 0.01 OR SUM(revenue_000s) OVER (PARTITION BY portfolio) < -0.01 OR SUM(target_current_fy) OVER (PARTITION BY portfolio) != 0) THEN 'include' ELSE 'exclude'"",
      ""business_validation"": ""Ensures that only portfolios with meaningful activity are considered in reports, reducing noise and focusing analysis on relevant data."",
      ""validation_sql"": ""SELECT blank_portfolio_flag, SUM(gross_revenue_amount / 1000) as total_rev_000s, SUM(IF(relative_fy_year_offset = 0, target, null)) as total_target_current_fy FROM `ncau-data-newsquery-prd`.asl_finance_derived.adsales_performance` GROUP BY blank_portfolio_flag LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,20
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""705edcb5-737a-4600-b1a7-11870177f97a"",
    ""dashboard_name"": ""Programmatic Impact Reporting"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 1,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""financial_short_month"",
      ""source_publishing_division"",
      ""revenue_transaction_status"",
      ""cost_model_type"",
      ""advertiser_name"",
      ""revenue_group_subtype"",
      ""revenue_type_level2"",
      ""source_system_code"",
      ""data_load_datetime""
    ],
    ""date_range_detected"": ""Financial Year 2025 (specifically October 2025 for some views)"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""Oct""
    ],
    ""hardcoded_values_found"": [
      ""Medium Rare Content Agency"",
      ""Billed"",
      ""Booked"",
      ""Programmatic"",
      ""Programmatic Source"",
      ""Digital"",
      ""Foxtel Management Pty Ltd"",
      ""PLUTO""
    ],
    ""governance_opportunities"": [
      ""financial year and month should be parameterized"",
      ""source_publishing_division should use a configurable exclusion list or reference table"",
      ""revenue_transaction_status should use a reference table"",
      ""revenue_type_level2 should use a reference table"",
      ""revenue_group_subtype should use a reference table"",
      ""advertiser_name should be parameterized or use a reference table"",
      ""source_system_code should use a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_adsales AS (\n  SELECT\n    t0.financial_year,\n    t0.financial_short_month,\n    t0.cost_model_type,\n    t0.advertiser_name,\n    t0.gross_revenue_amount,\n    t0.revenue_group_subtype,\n    t0.revenue_type_level2,\n    t0.source_system_code,\n    t0.source_publishing_division,\n    t0.revenue_transaction_status\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.financial_year IS NOT NULL\n    AND t0.source_publishing_division != 'Medium Rare Content Agency'\n    AND t0.revenue_transaction_status IN ('Billed', 'Booked')\n    -- Parameterize financial_year instead of hardcoding '2025'\n    AND t0.financial_year = '2025' -- Example: Use a parameter like @financial_year\n)\nSELECT\n  base.financial_year,\n  base.financial_short_month,\n  base.cost_model_type,\n  base.advertiser_name,\n  base.revenue_group_subtype,\n  base.revenue_type_level2,\n  base.source_system_code,\n  SUM(CASE\n    WHEN base.revenue_type_level2 = 'Programmatic'\n    AND base.revenue_group_subtype IN ('Programmatic Source', 'Digital')\n    AND base.advertiser_name = 'Foxtel Management Pty Ltd'\n    AND base.source_system_code = 'PLUTO'\n    THEN base.gross_revenue_amount\n    ELSE 0\n  END) AS programmatic_gross_revenue,\n  SUM(base.gross_revenue_amount) AS total_gross_revenue_for_filtered_data\nFROM base_adsales AS base\nGROUP BY\n  base.financial_year,\n  base.financial_short_month,\n  base.cost_model_type,\n  base.advertiser_name,\n  base.revenue_group_subtype,\n  base.revenue_type_level2,\n  base.source_system_code\nORDER BY\n  base.financial_year DESC,\n  base.financial_short_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT t0.financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT t0.advertiser_name) as unique_advertisers,\n  COUNT(DISTINCT t0.source_publishing_division) as unique_publishing_divisions,\n  COUNT(DISTINCT t0.revenue_transaction_status) as unique_transaction_statuses,\n  COUNT(DISTINCT t0.cost_model_type) as unique_cost_model_types,\n  MIN(t0.data_load_datetime) as earliest_data_load_datetime,\n  MAX(t0.data_load_datetime) as latest_data_load_datetime,\n  APPROX_COUNT_DISTINCT(t0.data_load_datetime) as approx_unique_data_load_datetimes,\n  APPROX_COUNT_DISTINCT(t0.gross_revenue_amount) as approx_unique_gross_revenue_amounts\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025'\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_count_test,\n  CASE WHEN MAX(t0.data_load_datetime) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNTIF(t0.financial_year = '2025') > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_2025_data_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025'\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Exclude Medium Rare Content Agency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.source_publishing_division != 'Medium Rare Content Agency' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025'\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Billed/Booked' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_transaction_status IN ('Billed', 'Booked') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025'\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'Programmatic Revenue Type Level 2' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025' AND t0.revenue_type_level2 IS NOT NULL;"",
    ""sample_data_sql"": ""SELECT \n  t0.data_load_datetime,\n  t0.financial_short_month,\n  t0.financial_year,\n  t0.revenue_transaction_status,\n  t0.source_publishing_division,\n  t0.cost_model_type,\n  t0.advertiser_name,\n  t0.gross_revenue_amount,\n  t0.revenue_group_subtype,\n  t0.revenue_type_level2,\n  t0.source_system_code\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE\n  t0.financial_year = '2025'\n  AND t0.gross_revenue_amount IS NOT NULL\nORDER BY t0.data_load_datetime DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter across all queries"",
          ""suggested_fix"": ""replace with CURRENT_DATE() based year or parameter"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""Oct"",
          ""original_format"": ""Oct"",
          ""context"": ""financial_short_month filter in one query"",
          ""suggested_fix"": ""replace with CURRENT_DATE() based month or parameter"",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""exclusion filter for source_publishing_division"",
          ""suggested_governance"": ""use a configurable exclusion list or join to a reference table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Billed'"",
            ""'Booked'""
          ],
          ""context"": ""inclusion filter for revenue_transaction_status"",
          ""suggested_governance"": ""join to a reference table for transaction statuses"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic'""
          ],
          ""context"": ""inclusion filter for revenue_type_level2"",
          ""suggested_governance"": ""join to a reference table for revenue types"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Programmatic Source'"",
            ""'Digital'""
          ],
          ""context"": ""inclusion filter for revenue_group_subtype"",
          ""suggested_governance"": ""join to a reference table for revenue group subtypes"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Foxtel Management Pty Ltd'""
          ],
          ""context"": ""inclusion filter for advertiser_name"",
          ""suggested_governance"": ""parameterize or join to a reference table for advertisers"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'""
          ],
          ""context"": ""inclusion filter for source_system_code"",
          ""suggested_governance"": ""join to a reference table for source systems"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial year and month with date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded lookup values (e.g., 'Medium Rare Content Agency', 'Foxtel Management Pty Ltd', 'Programmatic') with joins to governed reference tables or dashboard parameters."",
      ""Consider using configuration tables for business rules (e.g., exclusion lists) instead of hardcoded logic in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""programmatic_gross_revenue"",
      ""metric_name"": ""Programmatic Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue generated from programmatic advertising, specifically for 'Foxtel Management Pty Ltd' and 'PLUTO' source system, within the 'Billed' or 'Booked' transaction status, and excluding 'Medium Rare Content Agency'."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount) FILTER (WHERE t0.revenue_type_level2 = 'Programmatic' AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital') AND t0.advertiser_name = 'Foxtel Management Pty Ltd' AND t0.source_system_code = 'PLUTO')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year = '2025'"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')"",
        ""revenue_type_level2 = 'Programmatic'"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Digital')"",
        ""advertiser_name = 'Foxtel Management Pty Ltd'"",
        ""source_system_code = 'PLUTO'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for tracking programmatic ad sales performance for a specific client and system, indicating the financial impact of programmatic initiatives."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""Medium Rare Content Agency"",
        ""Billed"",
        ""Booked"",
        ""Programmatic"",
        ""Programmatic Source"",
        ""Digital"",
        ""Foxtel Management Pty Ltd"",
        ""PLUTO""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls in gross_revenue_amount"",
        ""accuracy depends on source system data quality and consistent classification of revenue types/subtypes.""
      ]
    },
    {
      ""metric_id"": ""financial_year_dimension"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the advertising revenue transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IS NOT NULL"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension used for financial reporting and analysis of ad sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls""
      ]
    },
    {
      ""metric_id"": ""financial_short_month_dimension"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_year_dimension""
      ],
      ""business_description"": ""The abbreviated name of the financial month (e.g., 'Oct') associated with the advertising revenue transaction."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_short_month IN ('Oct')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Secondary time dimension for granular financial reporting, often used in conjunction with financial year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""Oct""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""month should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls""
      ]
    },
    {
      ""metric_id"": ""cost_model_type_dimension"",
      ""metric_name"": ""Cost Model Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of cost model (e.g., CPM, CPC) applied to the advertising transaction."",
      ""sql_logic"": ""t0.cost_model_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025')"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment and analyze revenue performance based on different pricing models, crucial for understanding profitability and campaign effectiveness."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential for nulls""
      ]
    },
    {
      ""metric_id"": ""data_load_datetime_dimension"",
      ""metric_name"": ""Data Load Datetime (Second Truncated)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp indicating when the raw data for the transaction was loaded into the system, truncated to the nearest second."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.data_load_datetime, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2025')"",
        ""financial_short_month IN ('Oct')"",
        ""source_publishing_division != 'Medium Rare Content Agency'"",
        ""revenue_transaction_status IN ('Billed', 'Booked')""
      ],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Primarily used for data freshness checks and highly granular time-series analysis, though often aggregated to daily or monthly for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025"",
        ""Oct""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""programmatic_gross_revenue"",
      ""related_metrics"": [
        ""financial_year_dimension"",
        ""financial_short_month_dimension"",
        ""cost_model_type_dimension"",
        ""data_load_datetime_dimension""
      ],
      ""relationship_description"": ""The 'Programmatic Gross Revenue' metric is heavily influenced by a specific set of filters applied to various dimensions, including financial year, transaction status, revenue type, revenue group subtype, advertiser, and source system. Changes to these filters directly impact the calculated revenue."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE (financial_year = '2025' AND source_publishing_division != 'Medium Rare Content Agency' AND revenue_transaction_status IN ('Billed', 'Booked') AND revenue_type_level2 = 'Programmatic' AND revenue_group_subtype IN ('Programmatic Source', 'Digital') AND advertiser_name = 'Foxtel Management Pty Ltd' AND source_system_code = 'PLUTO')"",
      ""business_validation"": ""Ensuring these filters are correctly applied is critical for accurate programmatic revenue reporting. Any deviation from these business rules would misrepresent programmatic performance."",
      ""validation_sql"": ""SELECT \n  SUM(CASE WHEN t0.revenue_type_level2 = 'Programmatic' AND t0.revenue_group_subtype IN ('Programmatic Source', 'Digital') AND t0.advertiser_name = 'Foxtel Management Pty Ltd' AND t0.source_system_code = 'PLUTO' THEN t0.gross_revenue_amount ELSE 0 END) AS programmatic_revenue_filtered,\n  SUM(t0.gross_revenue_amount) AS total_revenue_unfiltered\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\nWHERE t0.financial_year = '2025' AND t0.source_publishing_division != 'Medium Rare Content Agency' AND t0.revenue_transaction_status IN ('Billed', 'Booked');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,22
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""61f1feb4-fc3e-4bee-b987-84c86cfe6425"",
    ""dashboard_name"": ""Digital - Publications and Products Monthly "",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_year"",
      ""unified_publication_name"",
      ""revenue_group_subtype"",
      ""revenue_type"",
      ""xtend_flag"",
      ""dw_asl_load_timestamp""
    ],
    ""date_range_detected"": ""2024 to 2025"",
    ""hardcoded_dates_found"": [
      ""2024"",
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'DIGITAL'"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'Y'"",
      ""'XTEND'"",
      ""'PRINT'"",
      ""'DIGITAL (excl.XTEND)'"",
      ""'XTEND ONLY'"",
      ""'digital'""
    ],
    ""governance_opportunities"": [
      ""financial_year should be parameterized"",
      ""revenue_group_subtype values should use a lookup table"",
      ""revenue type categories and XTEND logic should be externalized or use a governed reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN for unified dimension analysis\n-- This query combines the logic from the provided SQLs to show all relevant dimensions and derived categories.\n-- Note: The provided SQLs primarily extract distinct dimension values for filters/lists, not aggregate business metrics (e.g., revenue).\n-- If actual performance metrics are needed, they would need to be added from the 'adsales_performance' table.\nWITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.revenue_group_subtype,\n    t0.unified_publication_name,\n    t0.revenue_type,\n    t0.xtend_flag,\n    t0.dw_asl_load_timestamp,\n    -- Intermediate derived revenue type (clmn4_ equivalent from Query 2)\n    CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END AS derived_revenue_type_intermediate,\n    -- Final calculated revenue type (clmn5_ equivalent from Query 2)\n    CASE\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)'\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'PRINT') THEN 'PRINT'\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'XTEND') THEN 'XTEND ONLY'\n      ELSE NULL\n    END AS calculated_revenue_type\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Apply common financial year filter from both queries\n  WHERE t0.financial_year IN ('2024', '2025')\n)\nSELECT\n  financial_year,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type,\n  xtend_flag,\n  derived_revenue_type_intermediate,\n  calculated_revenue_type,\n  COUNT(*) AS record_count, -- Count of records for these dimension combinations\n  MIN(dw_asl_load_timestamp) AS earliest_load_timestamp -- Minimum load timestamp for data freshness\nFROM base_data\nWHERE\n  -- Apply specific filters from Query 1 and Query 2, combined with OR as they are for different outputs\n  (revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')\n  OR calculated_revenue_type IN ('digital')) -- Note: 'digital' is lowercase in the original filter\nGROUP BY\n  financial_year,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type,\n  xtend_flag,\n  derived_revenue_type_intermediate,\n  calculated_revenue_type\nORDER BY\n  financial_year DESC, unified_publication_name ASC\nLIMIT 100;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT financial_year) AS unique_financial_years,\n  COUNT(DISTINCT unified_publication_name) AS unique_publications,\n  COUNT(DISTINCT revenue_group_subtype) AS unique_revenue_subtypes,\n  COUNT(DISTINCT revenue_type) AS unique_revenue_types,\n  MIN(financial_year) AS earliest_financial_year,\n  MAX(financial_year) AS latest_financial_year,\n  MIN(dw_asl_load_timestamp) AS earliest_load_timestamp,\n  MAX(dw_asl_load_timestamp) AS latest_load_timestamp\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_year >= '2023' -- Sample recent data\nLIMIT 1;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and return expected values\nWITH validation_data AS (\n  SELECT\n    t0.financial_year,\n    t0.revenue_group_subtype,\n    t0.unified_publication_name,\n    t0.revenue_type,\n    t0.xtend_flag,\n    t0.dw_asl_load_timestamp,\n    CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END AS derived_revenue_type_intermediate,\n    CASE\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)'\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'PRINT') THEN 'PRINT'\n      WHEN (CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END = 'XTEND') THEN 'XTEND ONLY'\n      ELSE NULL\n    END AS calculated_revenue_type\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  WHERE t0.financial_year IN ('2024', '2025')\n)\nSELECT\n  'Validation Check' AS test_type,\n  COUNT(*) AS total_records_processed,\n  COUNT(DISTINCT unified_publication_name) AS distinct_publications_count,\n  COUNT(DISTINCT revenue_group_subtype) AS distinct_revenue_subtypes_count,\n  COUNT(DISTINCT calculated_revenue_type) AS distinct_calculated_revenue_types_count,\n  MIN(dw_asl_load_timestamp) AS min_load_timestamp_check,\n  MAX(dw_asl_load_timestamp) AS max_load_timestamp_check,\n  SUM(CASE WHEN calculated_revenue_type IS NULL THEN 1 ELSE 0 END) AS null_calculated_revenue_types\nFROM validation_data\nWHERE (revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE') OR calculated_revenue_type IN ('digital'))\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'XTEND Flag Logic' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN xtend_flag = 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 1 ELSE 0 END) AS records_matching_xtend_logic,\n  SUM(CASE WHEN xtend_flag != 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = revenue_type THEN 1 ELSE 0 END) AS records_matching_non_xtend_logic,\n  SUM(CASE WHEN calculated_revenue_type = 'DIGITAL (excl.XTEND)' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 1 ELSE 0 END) AS digital_excl_xtend_matches,\n  SUM(CASE WHEN calculated_revenue_type = 'XTEND ONLY' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 1 ELSE 0 END) AS xtend_only_matches,\n  SUM(CASE WHEN calculated_revenue_type = 'PRINT' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'PRINT' THEN 1 ELSE 0 END) AS print_matches,\n  SUM(CASE WHEN calculated_revenue_type IS NULL THEN 1 ELSE 0 END) AS null_calculated_types_count\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_year IN ('2024', '2025')\nLIMIT 1;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  financial_year,\n  revenue_group_subtype,\n  unified_publication_name,\n  revenue_type,\n  xtend_flag,\n  dw_asl_load_timestamp,\n  CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END AS derived_revenue_type_intermediate,\n  CASE\n    WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)'\n    WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END = 'PRINT') THEN 'PRINT'\n    WHEN (CASE WHEN (xtend_flag = 'Y') THEN 'XTEND' ELSE revenue_type END = 'XTEND') THEN 'XTEND ONLY'\n    ELSE NULL\n  END AS calculated_revenue_type\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_year IN ('2024', '2025')\nORDER BY dw_asl_load_timestamp DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2024"",
          ""original_format"": ""2024"",
          ""context"": ""financial_year filter in multiple queries"",
          ""suggested_fix"": ""replace with parameter or relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter in multiple queries"",
          ""suggested_fix"": ""replace with parameter or relative date logic (e.g., `EXTRACT(YEAR FROM CURRENT_DATE()) + 1`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'DIGITAL'"",
            ""'PROGRAMMATIC EXCHANGE'"",
            ""'PROGRAMMATIC SOURCE'""
          ],
          ""context"": ""revenue_group_subtype filter in Query 1"",
          ""suggested_governance"": ""join to a `revenue_group_subtype_lookup` table or use a parameter list"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Y'""
          ],
          ""context"": ""xtend_flag check in derived revenue type calculation"",
          ""suggested_governance"": ""define XTEND flag values in a configuration table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'XTEND'"",
            ""'DIGITAL'"",
            ""'PRINT'"",
            ""'DIGITAL (excl.XTEND)'"",
            ""'XTEND ONLY'""
          ],
          ""context"": ""derived and calculated revenue type categories in CASE statements"",
          ""suggested_governance"": ""use a `revenue_category_mapping` lookup table or externalize this logic"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'digital'""
          ],
          ""context"": ""filter value for calculated_revenue_type in Query 2 (note case mismatch with 'DIGITAL')"",
          ""suggested_governance"": ""ensure consistent casing or use `LOWER()`/`UPPER()` for comparison; use a lookup table for filter values"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years ('2024', '2025') with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values for `revenue_group_subtype` and derived revenue categories with joins to governed reference tables."",
      ""Externalize complex `CASE` statement logic for revenue categorization into a UDF or a configuration table for easier maintenance and consistency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the unified publication, used for grouping and filtering ad sales performance data."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2024', '2025')"",
        ""revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A primary dimension for analyzing ad sales performance by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""financial_year should be parameterized"",
        ""revenue_group_subtype values should use a lookup table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year for which the ad sales performance data is reported."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('2024', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Defines the reporting period for all ad sales metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""financial_year should be parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A subtype classification of revenue, used to filter data (e.g., DIGITAL, PROGRAMMATIC)."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting ad sales data by specific digital revenue streams."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'PROGRAMMATIC EXCHANGE'"",
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""values should be from a lookup table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_group_subtype_output"",
      ""metric_name"": ""Revenue Group Subtype (Output)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The revenue group subtype, used as a grouping dimension after applying XTEND logic and filters."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""financial_year IN ('2024', '2025')"",
        ""Calculated Revenue Type IN ('digital')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for grouping ad sales performance, especially for digital revenue, considering XTEND."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2024"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'digital'""
      ],
      ""governance_issues"": [
        ""financial_year should be parameterized"",
        ""filter value 'digital' should be consistent with 'DIGITAL' or use a lookup""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The primary classification of revenue, used as an input for derived revenue categories."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""An foundational dimension that contributes to more complex revenue categorization."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""xtend_flag"",
      ""metric_name"": ""XTEND Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A flag ('Y' or 'N') indicating if the revenue is associated with XTEND, critical for revenue categorization."",
      ""sql_logic"": ""t0.xtend_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key indicator that drives specific business logic for revenue classification."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""unexpected values other than 'Y'/'N'""
      ]
    },
    {
      ""metric_id"": ""derived_revenue_type_intermediate"",
      ""metric_name"": ""Derived Revenue Type (Intermediate)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""business_description"": ""An intermediate calculation that determines if revenue is 'XTEND' based on the flag, or falls back to the original revenue type."",
      ""sql_logic"": ""CASE WHEN (t0.xtend_flag = 'Y') THEN 'XTEND' ELSE t0.revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A foundational step in the multi-stage revenue categorization logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""hardcoded 'XTEND' value""
      ],
      ""data_quality_concerns"": [
        ""null if revenue_type is null and xtend_flag is not 'Y'""
      ]
    },
    {
      ""metric_id"": ""calculated_revenue_type"",
      ""metric_name"": ""Calculated Revenue Type"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""derived_revenue_type_intermediate""
      ],
      ""business_description"": ""The final categorization of revenue into specific business-defined groups like 'DIGITAL (excl.XTEND)', 'PRINT', or 'XTEND ONLY'."",
      ""sql_logic"": ""CASE WHEN (derived_revenue_type_intermediate = 'DIGITAL') THEN 'DIGITAL (excl.XTEND)' WHEN (derived_revenue_type_intermediate = 'PRINT') THEN 'PRINT' WHEN (derived_revenue_type_intermediate = 'XTEND') THEN 'XTEND ONLY' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""IN ('digital')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""The primary revenue category used for high-level reporting and filtering in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'"",
        ""'DIGITAL (excl.XTEND)'"",
        ""'PRINT'"",
        ""'XTEND'"",
        ""'XTEND ONLY'"",
        ""'digital'""
      ],
      ""governance_issues"": [
        ""hardcoded categories"",
        ""potential case sensitivity issue ('digital' vs 'DIGITAL')""
      ],
      ""data_quality_concerns"": [
        ""null if intermediate type doesn't match any WHEN condition""
      ]
    },
    {
      ""metric_id"": ""dw_asl_load_timestamp"",
      ""metric_name"": ""Data Warehouse Load Timestamp"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""timestamp"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The timestamp when a specific record was loaded into the data warehouse, used for data freshness checks."",
      ""sql_logic"": ""t0.dw_asl_load_timestamp"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""timestamp"",
      ""business_context"": ""Metadata for understanding the recency and lineage of the data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""truncated_load_timestamp"",
      ""metric_name"": ""Truncated Load Timestamp"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""timestamp"",
      ""aggregation_level"": ""second"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""dw_asl_load_timestamp""
      ],
      ""business_description"": ""The data warehouse load timestamp, truncated to the nearest second, used as an intermediate step for aggregation."",
      ""sql_logic"": ""DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""timestamp"",
      ""business_context"": ""Prepares the timestamp for finding the minimum value, ensuring consistent granularity."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""null if source timestamp is null""
      ]
    },
    {
      ""metric_id"": ""min_load_timestamp"",
      ""metric_name"": ""Minimum Load Timestamp"",
      ""metric_type"": ""aggregation"",
      ""calculation_type"": ""min"",
      ""data_type"": ""timestamp"",
      ""aggregation_level"": ""overall"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""truncated_load_timestamp""
      ],
      ""business_description"": ""The earliest (minimum) data warehouse load timestamp across the entire dataset, indicating the oldest data point's freshness."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""timestamp"",
      ""business_context"": ""Provides an overall data freshness indicator for the underlying table."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""null if table is empty""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""calculated_revenue_type"",
      ""related_metrics"": [
        ""derived_revenue_type_intermediate""
      ],
      ""relationship_description"": ""The 'Calculated Revenue Type' is directly derived from the 'Derived Revenue Type (Intermediate)' based on a series of CASE WHEN conditions."",
      ""mathematical_formula"": ""calculated_revenue_type = CASE WHEN derived_revenue_type_intermediate = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ... END"",
      ""business_validation"": ""Ensures that the final revenue categorization correctly reflects the intermediate derived type."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (CASE WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' ELSE NULL END) IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""derived_revenue_type_intermediate"",
      ""related_metrics"": [
        ""revenue_type"",
        ""xtend_flag""
      ],
      ""relationship_description"": ""The 'Derived Revenue Type (Intermediate)' is determined by the 'XTEND Flag'; if 'Y', it's 'XTEND', otherwise it's the original 'Revenue Type'."",
      ""mathematical_formula"": ""derived_revenue_type_intermediate = CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END"",
      ""business_validation"": ""Confirms that the XTEND logic is correctly applied before further categorization."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE (xtend_flag = 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND') OR (xtend_flag != 'Y' AND (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = revenue_type);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""unified_publication_name"",
      ""related_metrics"": [
        ""financial_year"",
        ""revenue_group_subtype""
      ],
      ""relationship_description"": ""The list of 'Unified Publication Names' displayed is filtered by specific 'Financial Years' and 'Revenue Group Subtypes'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that publication lists are relevant to the selected financial period and revenue categories."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT unified_publication_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025') AND revenue_group_subtype IN ('DIGITAL', 'PROGRAMMATIC EXCHANGE', 'PROGRAMMATIC SOURCE');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""revenue_group_subtype_output"",
      ""related_metrics"": [
        ""financial_year"",
        ""calculated_revenue_type""
      ],
      ""relationship_description"": ""The list of 'Revenue Group Subtypes' displayed is filtered by specific 'Financial Years' and the 'Calculated Revenue Type' (specifically 'digital')."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that revenue subtype lists are relevant to the selected financial period and digital revenue categories."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2024', '2025') AND (CASE WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'DIGITAL' THEN 'DIGITAL (excl.XTEND)' WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'PRINT' THEN 'PRINT' WHEN (CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END) = 'XTEND' THEN 'XTEND ONLY' ELSE NULL END) IN ('digital');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""min_load_timestamp"",
      ""related_metrics"": [
        ""truncated_load_timestamp"",
        ""dw_asl_load_timestamp""
      ],
      ""relationship_description"": ""The 'Minimum Load Timestamp' is an aggregation (MIN) of the 'Truncated Load Timestamp', which itself is derived from the raw 'Data Warehouse Load Timestamp'."",
      ""mathematical_formula"": ""min_load_timestamp = MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND))"",
      ""business_validation"": ""Confirms that the data freshness metric accurately reflects the earliest load time."",
      ""validation_sql"": ""SELECT MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""low""
    }
  ]
}
```",success,23
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""258a722d-9b6e-45df-ba00-1b9954ec36b2"",
    ""dashboard_name"": ""Debtor to Account Mapping"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref;sdm_advertisingexternals.__TABLES__"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 3,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""Adpoint_Account"",
      ""Genera_Booking_Account"",
      ""Medium_Rare_Debtor_Account"",
      ""National_Debtor_Account""
    ],
    ""date_range_detected"": ""Current"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'56694'"",
      ""\""Australia/Sydney\"""",
      ""\""gbaba_act_xref\""""
    ],
    ""governance_opportunities"": [
      ""Adpoint_Account filter should be parameterized""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for the core account mapping data.\n-- The 'Last Update Time' is a separate metadata query and not combined here.\nSELECT\n  t0.Adpoint_Account,\n  t0.Genera_Booking_Account,\n  t0.Medium_Rare_Debtor_Account,\n  t0.National_Debtor_Account\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref` AS t0\nWHERE\n  -- This filter was hardcoded in one of the original queries.\n  -- It should be replaced with a Looker Studio parameter (e.g., @adpoint_account_param)\n  -- Example: (t0.Adpoint_Account = @adpoint_account_param OR @adpoint_account_param IS NULL)\n  (t0.Adpoint_Account = '56694' OR '56694' IS NULL) -- Placeholder for parameterization\nGROUP BY\n  t0.Adpoint_Account,\n  t0.Genera_Booking_Account,\n  t0.Medium_Rare_Debtor_Account,\n  t0.National_Debtor_Account\nORDER BY\n  t0.Adpoint_Account ASC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT Adpoint_Account) as unique_adpoint_accounts,\n  COUNT(DISTINCT Genera_Booking_Account) as unique_genera_accounts,\n  COUNT(DISTINCT Medium_Rare_Debtor_Account) as unique_mr_debtor_accounts,\n  COUNT(DISTINCT National_Debtor_Account) as unique_national_debtor_accounts\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as record_count_test,\n  CASE WHEN COUNT(DISTINCT Adpoint_Account) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_adpoint_account_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Adpoint Account 56694 Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN Adpoint_Account = '56694' THEN 1 ELSE 0 END) as records_matching_filter,\n  SAFE_DIVIDE(SUM(CASE WHEN Adpoint_Account = '56694' THEN 1 ELSE 0 END), COUNT(*)) * 100 as match_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 1000;"",
    ""sample_data_sql"": ""SELECT\n  Adpoint_Account,\n  Genera_Booking_Account,\n  Medium_Rare_Debtor_Account,\n  National_Debtor_Account\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref`\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""date_value"": null,
          ""original_format"": null,
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'56694'""
          ],
          ""context"": ""Adpoint_Account filter value in WHERE clause"",
          ""suggested_governance"": ""replace with Looker Studio parameter for user selection"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""date_value"": null,
          ""original_format"": null,
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""\""Australia/Sydney\""""
          ],
          ""context"": ""Timezone for last_update_time calculation"",
          ""suggested_governance"": ""Consider if this should be configurable or derived from a central configuration, but often fixed for reporting."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""date_value"": null,
          ""original_format"": null,
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""\""gbaba_act_xref\""""
          ],
          ""context"": ""Table ID filter in BigQuery metadata query for last_update_time"",
          ""suggested_governance"": ""This is specific to the metadata query's purpose; generally not a governance issue for business logic."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded Adpoint_Account filter value ('56694') with a Looker Studio parameter to allow dynamic filtering by users.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""adpoint_account"",
      ""metric_name"": ""Adpoint Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The primary account identifier used in the Adpoint system, serving as a key for mapping other debtor accounts."",
      ""sql_logic"": ""t0.Adpoint_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [
        ""Adpoint_Account = '56694' (in specific filtered query)""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A core dimension for understanding the relationships between various advertising and debtor accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""genera_booking_account"",
      ""metric_name"": ""Genera Booking Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The account identifier used within the Genera Booking system."",
      ""sql_logic"": ""t0.Genera_Booking_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to map Genera Booking accounts to the central Adpoint account and other debtor accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""medium_rare_debtor_account"",
      ""metric_name"": ""Medium Rare Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The debtor account identifier specific to Medium Rare."",
      ""sql_logic"": ""t0.Medium_Rare_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to map Medium Rare debtor accounts to the central Adpoint account and other debtor accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""national_debtor_account"",
      ""metric_name"": ""National Debtor Account"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The national debtor account identifier."",
      ""sql_logic"": ""t0.National_Debtor_Account"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_asl_gbaba_act_xref""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to map National debtor accounts to the central Adpoint account and other debtor accounts."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""last_update_time"",
      ""metric_name"": ""Last Update Time"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The last time the underlying 'gbaba_act_xref' table, which contains the account mapping data, was modified. Presented in 'Australia/Sydney' timezone."",
      ""sql_logic"": ""DATETIME_TRUNC(PARSE_DATETIME('%Y-%m-%dT%H:%M:%S', FORMAT_TIMESTAMP('%Y-%m-%dT%H:%M:%S', SAFE_CAST(datetime(timestamp_millis(last_modified_time), \""Australia/Sydney\"") AS TIMESTAMP))), SECOND)"",
      ""data_sources"": [
        ""sdm_advertisingexternals.__TABLES__""
      ],
      ""filters_applied"": [
        ""table_id = \""gbaba_act_xref\""""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides data freshness information, crucial for users to understand the recency of the account mapping data they are viewing."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""\""Australia/Sydney\"""",
        ""\""gbaba_act_xref\""""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": []
}
```",success,24
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4bd7954c-5a94-4fb6-92e1-ed152b1cf7b3"",
    ""dashboard_name"": ""Copy of Interim Adsales Performance Dashboard for FY26"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 7,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 7,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""product_group"",
      ""revenue_type"",
      ""unified_publication_name"",
      ""relative_fy_year_offset""
    ],
    ""date_range_detected"": ""Current and Previous Fiscal Year"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'The Australian & Prestige'"",
      ""'PRINT'"",
      ""'GQ Mag'"",
      ""Admin.ADV"",
      ""Admin.DTM"",
      ""Admin.HWT"",
      ""Admin.International"",
      ""Admin.Sales"",
      ""Admin.Sport"",
      ""Admin.TCM"",
      ""Bestrecipes.Admin"",
      ""Bodyandsoul.Admin"",
      ""CODE"",
      ""CodeBet"",
      ""Delicious.admin"",
      ""Escape.Admin"",
      ""GQ.Admin"",
      ""Kidspot.Admin"",
      ""National Sundry"",
      ""National Tabloid PrePrint"",
      ""News.Admin"",
      ""odds.com.au"",
      ""Punters.com.au"",
      ""Qantas Travel Insider"",
      ""RACENET"",
      ""Shortlyster Managed Service"",
      ""Sky News"",
      ""SKYNEWS.ADMIN"",
      ""Stellar.Admin"",
      ""Stockhead"",
      ""SUDDENLY.CW"",
      ""SUDDENLY.NORTH"",
      ""SUDDENLY.TGG"",
      ""Taste.Admin"",
      ""TAUS.ADMIN"",
      ""The Sunday Times"",
      ""TOOWOOMBACUSTOM"",
      ""Vogue.Admin"",
      ""Vogueliving.Admin"",
      ""0"",
      ""1"",
      ""1000""
    ],
    ""governance_opportunities"": [
      ""relative_fy_year_offset should be derived from a date dimension table or parameter"",
      ""scaling factor (1000) should be parameterized"",
      ""product_group, revenue_type, and unified_publication_name filters should be parameterized"",
      ""the list of unified_publication_name for 'Sundry Pubs' categorization should be managed in a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.gross_revenue_amount,\n    t0.product_group,\n    t0.relative_fy_year_offset,\n    t0.revenue_type,\n    t0.unified_publication_name,\n    t0.dw_asl_load_timestamp\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  LIMIT 100000 -- Sample for analysis\n),\naggregated_metrics AS (\n  SELECT\n    product_group,\n    revenue_type,\n    unified_publication_name,\n    CASE\n      WHEN unified_publication_name IN (\n        'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n        'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n        'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n        'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n        'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n        'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n      ) THEN 'Sundry Pubs'\n      ELSE 'Non Sundry Pubs'\n    END AS publication_category,\n    SUM(CASE WHEN relative_fy_year_offset = 0 AND product_group = 'The Australian & Prestige' THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) AS current_fy_gross_revenue_k_aud,\n    SUM(CASE WHEN relative_fy_year_offset = 1 AND product_group = 'The Australian & Prestige' THEN SAFE_DIVIDE(gross_revenue_amount, 1000) ELSE 0 END) AS previous_fy_gross_revenue_k_aud\n  FROM base_data\n  GROUP BY\n    product_group,\n    revenue_type,\n    unified_publication_name\n),\nglobal_metrics AS (\n  SELECT\n    MIN(DATETIME_TRUNC(dw_asl_load_timestamp, SECOND)) AS earliest_data_load_timestamp\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\n)\nSELECT\n  am.product_group,\n  am.revenue_type,\n  am.unified_publication_name,\n  am.publication_category,\n  am.current_fy_gross_revenue_k_aud,\n  am.previous_fy_gross_revenue_k_aud,\n  gm.earliest_data_load_timestamp\nFROM aggregated_metrics am\nCROSS JOIN global_metrics gm\nWHERE am.product_group IN ('The Australian & Prestige')\nORDER BY am.product_group, am.revenue_type, am.unified_publication_name\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT product_group) as unique_product_groups,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  COUNT(DISTINCT unified_publication_name) as unique_publication_names,\n  COUNT(DISTINCT relative_fy_year_offset) as unique_fy_offsets,\n  MIN(dw_asl_load_timestamp) as earliest_load_timestamp,\n  MAX(dw_asl_load_timestamp) as latest_load_timestamp\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE dw_asl_load_timestamp >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 90 DAY)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT product_group) > 0 THEN 'PASS' ELSE 'FAIL' END as product_group_test,\n  CASE WHEN MAX(dw_asl_load_timestamp) >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE dw_asl_load_timestamp >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Sundry Pubs Categorization' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN unified_publication_name IN (\n        'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n        'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n        'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n        'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n        'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n        'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n      ) THEN 1 ELSE 0 END) as records_categorized_as_sundry,\n  SAFE_DIVIDE(SUM(CASE WHEN unified_publication_name IN (\n        'Admin.ADV', 'Admin.DTM', 'Admin.HWT', 'Admin.International', 'Admin.Sales', 'Admin.Sport', 'Admin.TCM',\n        'Bestrecipes.Admin', 'Bodyandsoul.Admin', 'CODE', 'CodeBet', 'Delicious.admin', 'Escape.Admin', 'GQ.Admin',\n        'Kidspot.Admin', 'National Sundry', 'National Tabloid PrePrint', 'News.Admin', 'odds.com.au', 'Punters.com.au',\n        'Qantas Travel Insider', 'RACENET', 'Shortlyster Managed Service', 'Sky News', 'SKYNEWS.ADMIN', 'Stellar.Admin',\n        'Stockhead', 'SUDDENLY.CW', 'SUDDENLY.NORTH', 'SUDDENLY.TGG', 'Taste.Admin', 'TAUS.ADMIN', 'The Sunday Times',\n        'TOOWOOMBACUSTOM', 'Vogue.Admin', 'Vogueliving.Admin'\n      ) THEN 1 ELSE 0 END), COUNT(*)) * 100 as sundry_category_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE dw_asl_load_timestamp >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 90 DAY)\nLIMIT 1000;"",
    ""sample_data_sql"": ""SELECT \n  gross_revenue_amount,\n  product_group,\n  relative_fy_year_offset,\n  revenue_type,\n  unified_publication_name,\n  dw_asl_load_timestamp\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE dw_asl_load_timestamp >= DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 14 DAY)\nORDER BY dw_asl_load_timestamp DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1""
          ],
          ""context"": ""relative_fy_year_offset values used to identify current and previous fiscal years."",
          ""suggested_governance"": ""Define fiscal year logic in a date dimension table or use parameters for dynamic FY selection."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""1000""
          ],
          ""context"": ""Scaling factor for gross revenue amount (converting to thousands)."",
          ""suggested_governance"": ""Parameterize the scaling factor or store in a configuration table if it might change."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'The Australian & Prestige'"",
            ""'PRINT'"",
            ""'GQ Mag'""
          ],
          ""context"": ""Specific product group, revenue type, and unified publication name used as filters."",
          ""suggested_governance"": ""Parameterize these filter values in Looker Studio or use a lookup table for product/publication details."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Admin.ADV'"",
            ""'Admin.DTM'"",
            ""'Admin.HWT'"",
            ""'Admin.International'"",
            ""'Admin.Sales'"",
            ""'Admin.Sport'"",
            ""'Admin.TCM'"",
            ""'Bestrecipes.Admin'"",
            ""'Bodyandsoul.Admin'"",
            ""'CODE'"",
            ""'CodeBet'"",
            ""'Delicious.admin'"",
            ""'Escape.Admin'"",
            ""'GQ.Admin'"",
            ""'Kidspot.Admin'"",
            ""'National Sundry'"",
            ""'National Tabloid PrePrint'"",
            ""'News.Admin'"",
            ""'odds.com.au'"",
            ""'Punters.com.au'"",
            ""'Qantas Travel Insider'"",
            ""'RACENET'"",
            ""'Shortlyster Managed Service'"",
            ""'Sky News'"",
            ""'SKYNEWS.ADMIN'"",
            ""'Stellar.Admin'"",
            ""'Stockhead'"",
            ""'SUDDENLY.CW'"",
            ""'SUDDENLY.NORTH'"",
            ""'SUDDENLY.TGG'"",
            ""'Taste.Admin'"",
            ""'TAUS.ADMIN'"",
            ""'The Sunday Times'"",
            ""'TOOWOOMBACUSTOM'"",
            ""'Vogue.Admin'"",
            ""'Vogueliving.Admin'""
          ],
          ""context"": ""Extensive list of unified_publication_name values used to categorize 'Sundry Pubs'."",
          ""suggested_governance"": ""Create a `publication_master` or `publication_category_lookup` table with `unified_publication_name` and `publication_category` columns, then join to this table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded relative fiscal year offsets (0, 1) with dynamic calculations based on current date and fiscal year definitions, or Looker Studio parameters."",
      ""Replace hardcoded scaling factors (1000) with Looker Studio parameters or a configuration table."",
      ""Replace hardcoded filter values for product_group, revenue_type, and unified_publication_name with Looker Studio parameters."",
      ""Replace hardcoded lists for categorization (e.g., 'Sundry Pubs') with joins to governed reference tables.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount recorded for each ad sales transaction."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy of source data""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_raw"",
      ""metric_name"": ""Current FY Gross Revenue (Raw)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue amount specifically for the current fiscal year, identified by a relative offset of 0."",
      ""sql_logic"": ""CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate step for calculating current FY revenue metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""relative_fy_year_offset should be derived from a date dimension table or parameter""
      ],
      ""data_quality_concerns"": [
        ""reliance on correct relative_fy_year_offset mapping""
      ]
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_raw"",
      ""metric_name"": ""Previous FY Gross Revenue (Raw)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue amount specifically for the previous fiscal year, identified by a relative offset of 1."",
      ""sql_logic"": ""CASE WHEN (t0.relative_fy_year_offset = 1) THEN t0.gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Intermediate step for calculating previous FY revenue metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [
        ""relative_fy_year_offset should be derived from a date dimension table or parameter""
      ],
      ""data_quality_concerns"": [
        ""reliance on correct relative_fy_year_offset mapping""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k_aud"",
      ""metric_name"": ""Current FY Gross Revenue (k AUD)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""current_fy_gross_revenue_raw""
      ],
      ""business_description"": ""Total gross revenue for the current fiscal year, aggregated and expressed in thousands of Australian Dollars. This is a key performance indicator for current period performance."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (t0.relative_fy_year_offset = 0) THEN t0.gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for current fiscal year revenue performance for 'The Australian & Prestige' product group."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""scaling factor (1000) should be parameterized"",
        ""product_group filter should be parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential for division by zero if SAFE_DIVIDE is not used (though 1000 is constant)"",
        ""accuracy of underlying gross_revenue_amount""
      ]
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k_aud"",
      ""metric_name"": ""Previous FY Gross Revenue (k AUD)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""previous_fy_gross_revenue_raw""
      ],
      ""business_description"": ""Total gross revenue for the previous fiscal year, aggregated and expressed in thousands of Australian Dollars. Used for year-over-year comparison."",
      ""sql_logic"": ""SUM(SAFE_DIVIDE(CASE WHEN (t0.relative_fy_year_offset = 1) THEN t0.gross_revenue_amount ELSE 0 END, 1000))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primary metric for previous fiscal year revenue performance for 'The Australian & Prestige' product group, crucial for trend analysis."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1000"",
        ""'The Australian & Prestige'""
      ],
      ""governance_issues"": [
        ""scaling factor (1000) should be parameterized"",
        ""product_group filter should be parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential for division by zero if SAFE_DIVIDE is not used"",
        ""accuracy of underlying gross_revenue_amount""
      ]
    },
    {
      ""metric_id"": ""publication_category"",
      ""metric_name"": ""Publication Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""unified_publication_name""
      ],
      ""business_description"": ""Categorizes publications into 'Sundry Pubs' or 'Non Sundry Pubs' based on a predefined hardcoded list of unified publication names."",
      ""sql_logic"": ""CASE WHEN (t0.unified_publication_name IN ('Admin.ADV', ..., 'Vogueliving.Admin')) THEN 'Sundry Pubs' ELSE 'Non Sundry Pubs' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""product_group IN ('The Australian & Prestige')"",
        ""revenue_type IN ('PRINT')"",
        ""unified_publication_name IN ('GQ Mag')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting revenue and other metrics by publication type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Admin.ADV'"",
        ""'Admin.DTM'"",
        ""'Admin.HWT'"",
        ""'Admin.International'"",
        ""'Admin.Sales'"",
        ""'Admin.Sport'"",
        ""'Admin.TCM'"",
        ""'Bestrecipes.Admin'"",
        ""'Bodyandsoul.Admin'"",
        ""'CODE'"",
        ""'CodeBet'"",
        ""'Delicious.admin'"",
        ""'Escape.Admin'"",
        ""'GQ.Admin'"",
        ""'Kidspot.Admin'"",
        ""'National Sundry'"",
        ""'National Tabloid PrePrint'"",
        ""'News.Admin'"",
        ""'odds.com.au'"",
        ""'Punters.com.au'"",
        ""'Qantas Travel Insider'"",
        ""'RACENET'"",
        ""'Shortlyster Managed Service'"",
        ""'Sky News'"",
        ""'SKYNEWS.ADMIN'"",
        ""'Stellar.Admin'"",
        ""'Stockhead'"",
        ""'SUDDENLY.CW'"",
        ""'SUDDENLY.NORTH'"",
        ""'SUDDENLY.TGG'"",
        ""'Taste.Admin'"",
        ""'TAUS.ADMIN'"",
        ""'The Sunday Times'"",
        ""'TOOWOOMBACUSTOM'"",
        ""'Vogue.Admin'"",
        ""'Vogueliving.Admin'""
      ],
      ""governance_issues"": [
        ""hardcoded list of values should be replaced with a join to a governed reference table""
      ],
      ""data_quality_concerns"": [
        ""risk of outdated or incomplete categorization if the hardcoded list is not maintained""
      ]
    },
    {
      ""metric_id"": ""earliest_data_load_timestamp"",
      ""metric_name"": ""Earliest Data Load Timestamp"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""dw_asl_load_timestamp""
      ],
      ""business_description"": ""The earliest timestamp from the `dw_asl_load_timestamp` column, indicating the oldest data load time in the dataset. Useful for monitoring data freshness."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(t0.dw_asl_load_timestamp, SECOND))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""timestamp"",
      ""business_context"": ""Data quality and operational monitoring."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""nulls in dw_asl_load_timestamp could affect result""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_k_aud"",
      ""related_metrics"": [
        ""current_fy_gross_revenue_raw""
      ],
      ""relationship_description"": ""Current FY Gross Revenue (k AUD) is derived by dividing Current FY Gross Revenue (Raw) by 1000."",
      ""mathematical_formula"": ""current_fy_gross_revenue_k_aud = current_fy_gross_revenue_raw / 1000"",
      ""business_validation"": ""Ensures revenue is presented in a readable 'thousands' format for financial reporting."",
      ""validation_sql"": ""SELECT SUM(current_fy_gross_revenue_k_aud * 1000) = SUM(current_fy_gross_revenue_raw) FROM your_table_or_cte;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""previous_fy_gross_revenue_k_aud"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue_raw""
      ],
      ""relationship_description"": ""Previous FY Gross Revenue (k AUD) is derived by dividing Previous FY Gross Revenue (Raw) by 1000."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_k_aud = previous_fy_gross_revenue_raw / 1000"",
      ""business_validation"": ""Ensures previous FY revenue is presented in a readable 'thousands' format for financial reporting and year-over-year comparison."",
      ""validation_sql"": ""SELECT SUM(previous_fy_gross_revenue_k_aud * 1000) = SUM(previous_fy_gross_revenue_raw) FROM your_table_or_cte;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""publication_category"",
      ""related_metrics"": [
        ""unified_publication_name""
      ],
      ""relationship_description"": ""Publication Category is a classification of unified_publication_name, grouping specific publications into 'Sundry Pubs' or 'Non Sundry Pubs'."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Provides a higher-level grouping for analysis, enabling aggregated views of revenue and other metrics across publication types."",
      ""validation_sql"": ""SELECT unified_publication_name, publication_category FROM your_table_or_cte GROUP BY 1,2 LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_gross_revenue_k_aud"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""Current FY Gross Revenue (k AUD) is specifically filtered for 'The Australian & Prestige' product group."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures the metric reflects performance for a specific, high-priority product group."",
      ""validation_sql"": ""SELECT product_group, SUM(current_fy_gross_revenue_k_aud) FROM your_table_or_cte GROUP BY 1 HAVING product_group != 'The Australian & Prestige';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""previous_fy_gross_revenue_k_aud"",
      ""related_metrics"": [
        ""product_group""
      ],
      ""relationship_description"": ""Previous FY Gross Revenue (k AUD) is specifically filtered for 'The Australian & Prestige' product group."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures the metric reflects performance for a specific, high-priority product group, allowing for consistent year-over-year comparison."",
      ""validation_sql"": ""SELECT product_group, SUM(previous_fy_gross_revenue_k_aud) FROM your_table_or_cte GROUP BY 1 HAVING product_group != 'The Australian & Prestige';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,25
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""87651b69-c43e-471f-9c4b-98df1208a844"",
    ""dashboard_name"": ""Programmatic Sales Patches"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 4,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""Advertiser"",
      ""TransactionType"",
      ""month_start_date"",
      ""Source""
    ],
    ""date_range_detected"": ""Unknown, but includes future date 01/06/2025"",
    ""hardcoded_dates_found"": [
      ""01/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'Guaranteed'"",
      ""'Chemist Warehouse *'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""advertiser names and transaction types should use governed lookup tables""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.Advertiser,\n    t0.TransactionType,\n    t0.Source,\n    SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS month_start_date,\n    t0.PaidImpressions,\n    t0.RevenueGross\n  FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\n  WHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 24 MONTH)\n)\nSELECT\n  Advertiser,\n  TransactionType,\n  Source,\n  month_start_date,\n  SUM(PaidImpressions) AS total_paid_impressions,\n  SUM(RevenueGross) AS total_gross_revenue\nFROM base_data\nGROUP BY\n  Advertiser,\n  TransactionType,\n  Source,\n  month_start_date\nORDER BY\n  month_start_date DESC, Advertiser, TransactionType, Source\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.Advertiser) as unique_advertisers,\n  COUNT(DISTINCT t0.TransactionType) as unique_transaction_types,\n  COUNT(DISTINCT t0.Source) as unique_sources,\n  COUNT(DISTINCT SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)) as unique_month_start_dates,\n  MIN(SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)) as earliest_month_start_date,\n  MAX(SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)) as latest_month_start_date,\n  SUM(CASE WHEN t0.PaidImpressions IS NULL THEN 1 ELSE 0 END) as null_paid_impressions_count,\n  SUM(CASE WHEN t0.RevenueGross IS NULL THEN 1 ELSE 0 END) as null_revenue_gross_count\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.RevenueGross) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_positive_test,\n  CASE WHEN SUM(t0.PaidImpressions) > 0 THEN 'PASS' ELSE 'FAIL' END as impressions_positive_test,\n  CASE WHEN COUNT(DISTINCT t0.Advertiser) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_present_test,\n  CASE WHEN MAX(SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Guaranteed Transaction Type Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.TransactionType = 'Guaranteed' THEN 1 ELSE 0 END) as records_matching_guaranteed,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.TransactionType = 'Guaranteed' THEN 1 ELSE 0 END), COUNT(*)) * 100 as guaranteed_percentage\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  t0.Advertiser,\n  t0.TransactionType,\n  t0.Source,\n  t0.CalendarMonth,\n  t0.CalendarYear,\n  SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) AS month_start_date,\n  t0.PaidImpressions,\n  t0.RevenueGross\nFROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` AS t0\nWHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\n  AND t0.PaidImpressions IS NOT NULL\n  AND t0.RevenueGross IS NOT NULL\nORDER BY month_start_date DESC, t0.Advertiser\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""01/06/2025"",
          ""original_format"": ""DATE '2025-06-01'"",
          ""context"": ""used as a specific filter for Month Start Date"",
          ""suggested_fix"": ""replace with a Looker Studio date parameter or relative date function (e.g., DATE_TRUNC(CURRENT_DATE(), MONTH))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Guaranteed'""
          ],
          ""context"": ""TransactionType filter"",
          ""suggested_governance"": ""Use a Looker Studio parameter for TransactionType or join to a transaction_type_lookup table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Chemist Warehouse *'""
          ],
          ""context"": ""Advertiser filter"",
          ""suggested_governance"": ""Use a Looker Studio parameter for Advertiser or join to an advertiser_master table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions"",
      ""Replace hardcoded lookup values for TransactionType with a parameter or join to a governed reference table"",
      ""Replace hardcoded lookup values for Advertiser with a parameter or join to a governed reference table""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser"",
      ""metric_name"": ""Advertiser"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the programmatic sales data."",
      ""sql_logic"": ""t0.Advertiser"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""'Chemist Warehouse *' in one query""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment sales performance by specific advertisers."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""Advertiser names should be managed via a lookup table to ensure consistency and avoid hardcoding.""
      ],
      ""data_quality_concerns"": [
        ""Potential for typos or variations in advertiser names if not governed.""
      ]
    },
    {
      ""metric_id"": ""transaction_type"",
      ""metric_name"": ""Transaction Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of transaction, e.g., Guaranteed, Non-Guaranteed."",
      ""sql_logic"": ""t0.TransactionType"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""'Guaranteed'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter sales data by specific transaction models."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""Transaction types should be managed via a lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Potential for inconsistent naming.""
      ]
    },
    {
      ""metric_id"": ""month_start_date"",
      ""metric_name"": ""Month Start Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first day of the calendar month for which the data is reported."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(t0.CalendarYear, t0.CalendarMonth, 1) AS DATETIME), MONTH) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""01/06/2025 in one query""
      ],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for sales analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/06/2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded dates should be replaced with parameters or relative date functions.""
      ],
      ""data_quality_concerns"": [
        ""None apparent, date transformation seems robust.""
      ]
    },
    {
      ""metric_id"": ""paid_impressions"",
      ""metric_name"": ""Paid Impressions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of paid impressions delivered for programmatic campaigns."",
      ""sql_logic"": ""SUM(t0.PaidImpressions)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = Guaranteed"",
        ""Advertiser = Chemist Warehouse *"",
        ""Month Start Date = 01/06/2025""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key volume metric for programmatic advertising performance."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""01/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""Filters should be parameterised.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if data is missing.""
      ]
    },
    {
      ""metric_id"": ""gross_revenue"",
      ""metric_name"": ""Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue generated from programmatic sales."",
      ""sql_logic"": ""SUM(t0.RevenueGross)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [
        ""TransactionType = Guaranteed"",
        ""Advertiser = Chemist Warehouse *"",
        ""Month Start Date = 01/06/2025""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key financial metric for programmatic advertising performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""01/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Chemist Warehouse *'""
      ],
      ""governance_issues"": [
        ""Filters should be parameterised.""
      ],
      ""data_quality_concerns"": [
        ""Potential for nulls if data is missing.""
      ]
    },
    {
      ""metric_id"": ""source"",
      ""metric_name"": ""Source"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The source of the programmatic sales data."",
      ""sql_logic"": ""t0.Source"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a high-level categorization of the data origin, potentially for filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""paid_impressions"",
      ""related_metrics"": [
        ""transaction_type"",
        ""advertiser"",
        ""month_start_date""
      ],
      ""relationship_description"": ""Paid Impressions are filtered by specific Transaction Type, Advertiser, and Month Start Date."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that the impressions reported are specific to 'Guaranteed' transactions for 'Chemist Warehouse *' in June 2025."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue"",
      ""related_metrics"": [
        ""transaction_type"",
        ""advertiser"",
        ""month_start_date""
      ],
      ""relationship_description"": ""Gross Revenue is filtered by specific Transaction Type, Advertiser, and Month Start Date."",
      ""mathematical_formula"": null,
      ""business_validation"": ""Ensures that the revenue reported is specific to 'Guaranteed' transactions for 'Chemist Warehouse *' in June 2025."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE TransactionType = 'Guaranteed' AND Advertiser = 'Chemist Warehouse *' AND SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) = DATE '2025-06-01';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""gross_revenue"",
      ""related_metrics"": [
        ""paid_impressions""
      ],
      ""relationship_description"": ""Gross Revenue and Paid Impressions are key performance indicators often analyzed together to derive metrics like Revenue Per Impression (RPM) or Cost Per Mille (CPM)."",
      ""mathematical_formula"": ""Revenue Per Impression = total_gross_revenue / total_paid_impressions"",
      ""business_validation"": ""These metrics are fundamental for evaluating the efficiency and profitability of programmatic campaigns."",
      ""validation_sql"": ""SELECT SUM(RevenueGross) / SUM(PaidImpressions) FROM `ncau-data-newsquery-prd.prstn_advertising.programmatic_cal_month` WHERE SAFE_CAST(DATETIME_TRUNC(SAFE_CAST(DATE(CalendarYear, CalendarMonth, 1) AS DATETIME), MONTH) AS DATE) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,26
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""e9d8a216-4950-4d30-b344-5011776edbdf"",
    ""dashboard_name"": ""Adex Report"",
    ""primary_data_sources"": ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 14,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""date"",
      ""Major_Category"",
      ""Media_Network"",
      ""Media_Group"",
      ""Media_Type""
    ],
    ""date_range_detected"": ""01/08/2022 to 01/06/2024"",
    ""hardcoded_dates_found"": [
      ""01/08/2023"",
      ""01/06/2024"",
      ""01/08/2022"",
      ""01/06/2023""
    ],
    ""hardcoded_values_found"": [
      ""'NEWS CORP'"",
      ""'Retail'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""month names should use standard date functions or a lookup table"",
      ""specific category/network names ('NEWS CORP', 'Retail') could be parameterized or managed via a reference table if they change frequently""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH adex_data AS (\n  SELECT *\n  FROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n),\nadex_date_fact AS (\n  SELECT\n    Media_Type,\n    portfolio_parent_group_name,\n    date,\n    DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n    DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n  FROM (\n    SELECT DISTINCT\n      Media_Type,\n      portfolio_parent_group_name\n    FROM\n      adex_data\n  )\n  CROSS JOIN\n  UNNEST(GENERATE_DATE_ARRAY((\n      SELECT\n        MIN(date)\n      FROM\n        adex_data\n    ), (\n      SELECT\n        MAX(date)\n      FROM\n        adex_data\n    ), INTERVAL 1 MONTH)) AS date\n),\nadex_full_date AS (\n  SELECT\n    adf.*,\n    financial_year,\n    Major_Category,\n    Advertiser_Group___Advertiser,\n    Advertiser,\n    Media_Network,\n    Media_Group,\n    Ad_Type,\n    Brand,\n    Product,\n    Category,\n    Sub_Category,\n    Spend,\n    sales_segment_gm_name\n  FROM\n    adex_date_fact AS adf\n    LEFT JOIN\n    adex_data\n    ON adf.date = adex_data.date\n    AND adf.Media_Type = adex_data.Media_Type\n    AND adf.portfolio_parent_group_name = adex_data.portfolio_parent_group_name\n),\nbase_data AS (\n  SELECT\n    afd.*,\n    FORMAT_DATETIME('%b', DATETIME(date)) AS calendar_month_short_name,\n    CAST(FORMAT_DATETIME('%Y', DATETIME(date)) AS INT) AS calendar_year,\n    SUM(Spend) OVER (PARTITION BY date) AS spend_monthly_agg,\n    (SELECT MAX(date) FROM adex_full_date) AS latest_date\n  FROM\n    adex_full_date AS afd\n),\n-- Define dynamic date ranges based on a reference date (e.g., latest_date or CURRENT_DATE())\n-- For this analysis, we'll use the hardcoded values found to replicate the dashboard's current logic,\n-- but note that these should be parameterized.\ndate_ranges AS (\n  SELECT\n    PARSE_DATE('%Y-%m-%d', CONCAT('20', SAFE_CAST(SAFE.RIGHT('Aug 23', 2) AS STRING), '-',\n      CASE SAFE.LEFT('Aug 23', 3) WHEN 'Jan' THEN 1 WHEN 'Feb' THEN 2 WHEN 'Mar' THEN 3 WHEN 'Apr' THEN 4 WHEN 'May' THEN 5 WHEN 'Jun' THEN 6 WHEN 'Jul' THEN 7 WHEN 'Aug' THEN 8 WHEN 'Sep' THEN 9 WHEN 'Oct' THEN 10 WHEN 'Nov' THEN 11 WHEN 'Dec' THEN 12 ELSE NULL END, '-1')) AS current_period_start_date,\n    PARSE_DATE('%Y-%m-%d', CONCAT('20', SAFE_CAST(SAFE.RIGHT('Jun 24', 2) AS STRING), '-',\n      CASE SAFE.LEFT('Jun 24', 3) WHEN 'Jan' THEN 1 WHEN 'Feb' THEN 2 WHEN 'Mar' THEN 3 WHEN 'Apr' THEN 4 WHEN 'May' THEN 5 WHEN 'Jun' THEN 6 WHEN 'Jul' THEN 7 WHEN 'Aug' THEN 8 WHEN 'Sep' THEN 9 WHEN 'Oct' THEN 10 WHEN 'Nov' THEN 11 WHEN 'Dec' THEN 12 ELSE NULL END, '-1')) AS current_period_end_date\n),\nfinal_data AS (\n  SELECT\n    b.*,\n    dr.current_period_start_date,\n    dr.current_period_end_date,\n    DATE_ADD(dr.current_period_start_date, INTERVAL -12 MONTH) AS previous_period_start_date,\n    DATE_ADD(dr.current_period_end_date, INTERVAL -12 MONTH) AS previous_period_end_date\n  FROM\n    base_data b\n    CROSS JOIN date_ranges dr\n)\nSELECT\n  date AS date_monthly,\n  Major_Category,\n  Media_Network,\n  Media_Group,\n  Media_Type,\n  CASE WHEN date >= current_period_start_date AND date <= current_period_end_date THEN TRUE ELSE FALSE END AS is_current_period_flag,\n  CASE WHEN date >= previous_period_start_date AND date <= previous_period_end_date THEN TRUE ELSE FALSE END AS is_previous_year_period_flag,\n  SUM(Spend) AS total_spend,\n  SUM(CASE WHEN date >= current_period_start_date AND date <= current_period_end_date THEN Spend ELSE 0 END) AS spend_current_period,\n  SUM(CASE WHEN date >= previous_period_start_date AND date <= previous_period_end_date THEN Spend ELSE 0 END) AS spend_previous_year_period,\n  SUM(CASE WHEN date >= current_period_start_date AND date <= current_period_end_date AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END) AS news_corp_spend_current_period,\n  SUM(CASE WHEN date >= previous_period_start_date AND date <= previous_period_end_date AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END) AS news_corp_spend_previous_year_period,\n  SUM(CASE WHEN date >= current_period_start_date AND date <= current_period_end_date AND Major_Category = 'Retail' THEN Spend ELSE 0 END) AS retail_spend_current_period\nFROM\n  final_data\nGROUP BY\n  date,\n  Major_Category,\n  Media_Network,\n  Media_Group,\n  Media_Type,\n  is_current_period_flag,\n  is_previous_year_period_flag\nORDER BY\n  date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT date) as unique_dates,\n  MIN(date) as earliest_date,\n  MAX(date) as latest_date,\n  COUNT(DISTINCT Major_Category) as unique_major_categories,\n  COUNT(DISTINCT Media_Network) as unique_media_networks,\n  COUNT(DISTINCT Media_Group) as unique_media_groups,\n  COUNT(DISTINCT Media_Type) as unique_media_types,\n  SUM(Spend) as total_spend_sum,\n  AVG(Spend) as average_spend\nFROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\nWHERE date >= DATE_SUB(CURRENT_DATE(), INTERVAL 36 MONTH)\nLIMIT 1;"",
    ""validation_sql"": ""WITH adex_data AS (\n  SELECT *\n  FROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n)\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(Spend) > 0 THEN 'PASS' ELSE 'FAIL' END as total_spend_test,\n  CASE WHEN COUNT(DISTINCT date) > 0 THEN 'PASS' ELSE 'FAIL' END as date_data_test,\n  CASE WHEN MAX(date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNT(DISTINCT Media_Type) > 0 THEN 'PASS' ELSE 'FAIL' END as media_type_test\nFROM\n  adex_data\nWHERE\n  date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""WITH adex_data AS (\n  SELECT *\n  FROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n)\nSELECT\n  'Business Rule Validation' as validation_type,\n  'News Corp Spend Calculation' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN Media_Network = 'NEWS CORP' AND Spend IS NOT NULL THEN 1 ELSE 0 END) as news_corp_spend_records,\n  SAFE_DIVIDE(SUM(CASE WHEN Media_Network = 'NEWS CORP' AND Spend IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as news_corp_spend_percentage\nFROM\n  adex_data\nWHERE\n  date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Retail Category Spend Calculation' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN Major_Category = 'Retail' AND Spend IS NOT NULL THEN 1 ELSE 0 END) as retail_spend_records,\n  SAFE_DIVIDE(SUM(CASE WHEN Major_Category = 'Retail' AND Spend IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 as retail_spend_percentage\nFROM\n  adex_data\nWHERE\n  date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""WITH adex_data AS (\n  SELECT *\n  FROM `ncau-data-newsquery-prd`.sbx_dcp.adex_datasource\n),\nadex_date_fact AS (\n  SELECT\n    Media_Type,\n    portfolio_parent_group_name,\n    date,\n    DATE_ADD(date, INTERVAL 1 MONTH) AS next_mth,\n    DATE_ADD(date, INTERVAL 12 MONTH) AS next_yr\n  FROM (\n    SELECT DISTINCT\n      Media_Type,\n      portfolio_parent_group_name\n    FROM\n      adex_data\n  )\n  CROSS JOIN\n  UNNEST(GENERATE_DATE_ARRAY((\n      SELECT\n        MIN(date)\n      FROM\n        adex_data\n    ), (\n      SELECT\n        MAX(date)\n      FROM\n        adex_data\n    ), INTERVAL 1 MONTH)) AS date\n),\nadex_full_date AS (\n  SELECT\n    adf.*,\n    financial_year,\n    Major_Category,\n    Advertiser_Group___Advertiser,\n    Advertiser,\n    Media_Network,\n    Media_Group,\n    Ad_Type,\n    Brand,\n    Product,\n    Category,\n    Sub_Category,\n    account_number,\n    portfolio_group_name,\n    portfolio_conformed_name,\n    Spend,\n    sales_segment_gm_name\n  FROM\n    adex_date_fact AS adf\n    LEFT JOIN\n    adex_data\n    ON adf.date = adex_data.date\n    AND adf.Media_Type = adex_data.Media_Type\n    AND adf.portfolio_parent_group_name = adex_data.portfolio_parent_group_name\n)\nSELECT\n  afd.date,\n  afd.Major_Category,\n  afd.Media_Network,\n  afd.Media_Group,\n  afd.Media_Type,\n  afd.Spend,\n  afd.financial_year,\n  afd.Advertiser,\n  afd.Brand,\n  afd.Product\nFROM\n  adex_full_date afd\nWHERE\n  afd.date >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\n  AND afd.Spend IS NOT NULL\nORDER BY\n  afd.date DESC,\n  afd.Spend DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""01/08/2023"",
          ""original_format"": ""'Aug 23'"",
          ""context"": ""Used to derive the start date of the 'current period' for spend calculations (e.g., `clmn13_` in Q1, `clmn12_` in Q2)."",
          ""suggested_fix"": ""Replace with a dashboard parameter or a relative date function (e.g., `DATE_TRUNC(CURRENT_DATE(), MONTH)` or `DATE_SUB(CURRENT_DATE(), INTERVAL 1 MONTH)`)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/06/2024"",
          ""original_format"": ""'Jun 24'"",
          ""context"": ""Used to derive the end date of the 'current period' for spend calculations (e.g., `clmn14_` in Q1, `clmn13_` in Q2)."",
          ""suggested_fix"": ""Replace with a dashboard parameter or a relative date function (e.g., `CURRENT_DATE()` or `DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)`)."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""01/08/2022"",
          ""original_format"": ""Derived from 'Aug 23' minus 12 months"",
          ""context"": ""Used to derive the start date of the 'previous year period' for spend calculations (e.g., `clmn15_` in Q1, `clmn14_` in Q2)."",
          ""suggested_fix"": ""This date is derived from the 'current period' start date. Ensure the base date parameterization handles this derivation."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""01/06/2023"",
          ""original_format"": ""Derived from 'Jun 24' minus 12 months"",
          ""context"": ""Used to derive the end date of the 'previous year period' for spend calculations (e.g., `clmn17_` in Q1, `clmn16_` in Q2)."",
          ""suggested_fix"": ""This date is derived from the 'current period' end date. Ensure the base date parameterization handles this derivation."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Month abbreviations are hardcoded in CASE statements to convert string month names to numeric month values for date parsing."",
          ""suggested_governance"": ""Use standard SQL date functions like `EXTRACT(MONTH FROM PARSE_DATE('%b %y', month_year_string))` or a dedicated date dimension table for month name lookups."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'NEWS CORP'""
          ],
          ""context"": ""Used to filter `Media_Network` for specific spend calculations (e.g., `NewsCorp_Spend_Current_Period`)."",
          ""suggested_governance"": ""If this value is subject to change or part of a larger set of media networks, it should be managed via a configuration table or a dashboard parameter."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Retail'""
          ],
          ""context"": ""Used to filter `Major_Category` for specific spend calculations (e.g., `Retail_Spend_Current_Period`)."",
          ""suggested_governance"": ""If this value is subject to change or part of a larger set of major categories, it should be managed via a configuration table or a dashboard parameter."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates ('Aug 23', 'Jun 24') with date parameters (e.g., `p_current_period_start_month_year`, `p_current_period_end_month_year`) or relative date functions (e.g., `DATE_TRUNC(CURRENT_DATE(), MONTH)`)."",
      ""Replace hardcoded month name parsing (CASE statements for 'Jan', 'Feb', etc.) with standard date functions or a robust date dimension table."",
      ""Consider externalizing specific filter values like 'NEWS CORP' and 'Retail' into a configuration table or dashboard parameters if they are dynamic business rules.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""spend_base"",
      ""metric_name"": ""Base Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw advertising spend value from the source data."",
      ""sql_logic"": ""t0.Spend"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all spend-related metrics."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""major_category"",
      ""metric_name"": ""Major Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The primary category of the advertiser (e.g., 'Retail')."",
      ""sql_logic"": ""t0.Major_Category"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting spend by broad industry or business type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_network"",
      ""metric_name"": ""Media Network"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific media network where advertising spend occurred (e.g., 'NEWS CORP')."",
      ""sql_logic"": ""t0.Media_Network"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting spend by specific media entities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_group"",
      ""metric_name"": ""Media Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The broader media group to which a network belongs."",
      ""sql_logic"": ""t0.Media_Group"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for higher-level aggregation of spend across media entities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""media_type"",
      ""metric_name"": ""Media Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of media used for advertising (e.g., 'Digital', 'Print')."",
      ""sql_logic"": ""t0.Media_Type"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting spend by advertising channel."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""date_monthly"",
      ""metric_name"": ""Date (Monthly)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The month and year of the advertising spend, aggregated to the first day of the month."",
      ""sql_logic"": ""t0.date"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_current_period_flag"",
      ""metric_name"": ""Is Current Period Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""date_monthly""
      ],
      ""business_description"": ""A boolean flag indicating if the date falls within the defined 'current period' (Aug 1, 2023 - Jun 1, 2024)."",
      ""sql_logic"": ""CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN TRUE ELSE FALSE END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter and group data for current period comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2023"",
        ""01/06/2024""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_previous_year_period_flag"",
      ""metric_name"": ""Is Previous Year Period Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""date_monthly""
      ],
      ""business_description"": ""A boolean flag indicating if the date falls within the defined 'previous year period' (Aug 1, 2022 - Jun 1, 2023)."",
      ""sql_logic"": ""CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN TRUE ELSE FALSE END"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter and group data for year-over-year comparisons."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2022"",
        ""01/06/2023""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_spend"",
      ""metric_name"": ""Total Spend"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_base""
      ],
      ""business_description"": ""The total advertising spend for the given dimensions and date."",
      ""sql_logic"": ""SUM(Spend)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core metric for overall advertising expenditure tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_current_period"",
      ""metric_name"": ""Spend (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_base"",
        ""is_current_period_flag""
      ],
      ""business_description"": ""Total advertising spend within the defined 'current period' (Aug 1, 2023 - Jun 1, 2024)."",
      ""sql_logic"": ""SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date filter for current period""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for analyzing recent performance and comparing against previous periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2023"",
        ""01/06/2024""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""spend_previous_year_period"",
      ""metric_name"": ""Spend (Previous Year Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""spend_base"",
        ""is_previous_year_period_flag""
      ],
      ""business_description"": ""Total advertising spend within the defined 'previous year period' (Aug 1, 2022 - Jun 1, 2023)."",
      ""sql_logic"": ""SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date filter for previous year period""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Essential for year-over-year growth analysis and trend identification."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2022"",
        ""01/06/2023""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""news_corp_spend_current_period"",
      ""metric_name"": ""News Corp Spend (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_base"",
        ""is_current_period_flag"",
        ""media_network""
      ],
      ""business_description"": ""Advertising spend for 'NEWS CORP' media network within the current period."",
      ""sql_logic"": ""SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date filter for current period"",
        ""Media_Network = 'NEWS CORP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific performance tracking for a key media partner."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2023"",
        ""01/06/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NEWS CORP'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""news_corp_spend_previous_year_period"",
      ""metric_name"": ""News Corp Spend (Previous Year Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_base"",
        ""is_previous_year_period_flag"",
        ""media_network""
      ],
      ""business_description"": ""Advertising spend for 'NEWS CORP' media network within the previous year period."",
      ""sql_logic"": ""SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date filter for previous year period"",
        ""Media_Network = 'NEWS CORP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Year-over-year comparison for 'NEWS CORP' media network performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2022"",
        ""01/06/2023""
      ],
      ""hardcoded_values_in_metric"": [
        ""'NEWS CORP'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""retail_spend_current_period"",
      ""metric_name"": ""Retail Spend (Current Period)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""spend_base"",
        ""is_current_period_flag"",
        ""major_category""
      ],
      ""business_description"": ""Advertising spend for 'Retail' major category within the current period."",
      ""sql_logic"": ""SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Major_Category = 'Retail' THEN Spend ELSE 0 END)"",
      ""data_sources"": [
        ""`ncau-data-newsquery-prd`.sbx_dcp.adex_datasource""
      ],
      ""filters_applied"": [
        ""date filter for current period"",
        ""Major_Category = 'Retail'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Specific performance tracking for the 'Retail' industry category."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""01/08/2023"",
        ""01/06/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Retail'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""spend_current_period"",
      ""related_metrics"": [
        ""spend_base"",
        ""is_current_period_flag""
      ],
      ""relationship_description"": ""Spend (Current Period) is a conditional sum of Base Spend, filtered by the Is Current Period Flag."",
      ""mathematical_formula"": ""SUM(Spend) WHERE Is_Current_Period_Flag = TRUE"",
      ""business_validation"": ""Ensures that only spend within the designated current timeframe is included for analysis."",
      ""validation_sql"": ""SELECT SUM(Spend) FROM adex_full_date WHERE date >= '2023-08-01' AND date <= '2024-06-01'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""spend_previous_year_period"",
      ""related_metrics"": [
        ""spend_base"",
        ""is_previous_year_period_flag""
      ],
      ""relationship_description"": ""Spend (Previous Year Period) is a conditional sum of Base Spend, filtered by the Is Previous Year Period Flag."",
      ""mathematical_formula"": ""SUM(Spend) WHERE Is_Previous_Year_Period_Flag = TRUE"",
      ""business_validation"": ""Ensures that only spend within the designated previous year timeframe is included for year-over-year comparison."",
      ""validation_sql"": ""SELECT SUM(Spend) FROM adex_full_date WHERE date >= '2022-08-01' AND date <= '2023-06-01'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""spend_current_period"",
      ""related_metrics"": [
        ""spend_previous_year_period""
      ],
      ""relationship_description"": ""These two metrics are used for year-over-year growth calculations."",
      ""mathematical_formula"": ""(spend_current_period - spend_previous_year_period) / spend_previous_year_period"",
      ""business_validation"": ""Provides insight into the growth or decline of advertising spend compared to the prior year."",
      ""validation_sql"": ""SELECT (SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) - SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN Spend ELSE 0 END)) / SUM(CASE WHEN date >= '2022-08-01' AND date <= '2023-06-01' THEN Spend ELSE 0 END) AS YOY_Growth FROM adex_full_date"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""news_corp_spend_current_period"",
      ""related_metrics"": [
        ""spend_current_period"",
        ""media_network""
      ],
      ""relationship_description"": ""News Corp Spend (Current Period) is a subset of Spend (Current Period), filtered specifically for 'NEWS CORP' media network."",
      ""mathematical_formula"": ""SUM(Spend) WHERE Is_Current_Period_Flag = TRUE AND Media_Network = 'NEWS CORP'"",
      ""business_validation"": ""Allows for granular analysis of spend attributed to a specific media network within the current period."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Media_Network = 'NEWS CORP' THEN Spend ELSE 0 END) AS NewsCorp_Spend, SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) AS Total_Spend FROM adex_full_date"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""retail_spend_current_period"",
      ""related_metrics"": [
        ""spend_current_period"",
        ""major_category""
      ],
      ""relationship_description"": ""Retail Spend (Current Period) is a subset of Spend (Current Period), filtered specifically for 'Retail' major category."",
      ""mathematical_formula"": ""SUM(Spend) WHERE Is_Current_Period_Flag = TRUE AND Major_Category = 'Retail'"",
      ""business_validation"": ""Allows for granular analysis of spend attributed to a specific major category within the current period."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' AND Major_Category = 'Retail' THEN Spend ELSE 0 END) AS Retail_Spend, SUM(CASE WHEN date >= '2023-08-01' AND date <= '2024-06-01' THEN Spend ELSE 0 END) AS Total_Spend FROM adex_full_date"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,27
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b1c5901f-a535-42eb-870d-05cc025f7c27"",
    ""dashboard_name"": ""OS extract for month end rec"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_gl_department;ncau-data-newsquery-prd.asl_finance.v_asl_DIM_period_control"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fy_year"",
      ""fy_week_of_year"",
      ""gl_hierarchy_code"",
      ""os_level_4"",
      ""publication_name""
    ],
    ""date_range_detected"": ""FY2025, Week 40 (hardcoded)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'FY2025'"",
      ""40"",
      ""'Total Revenue'"",
      ""'Total Expenses'"",
      ""'News Media Publishing'"",
      ""'Circulation'"",
      ""'Subscription'"",
      ""'Content Licensing'"",
      ""'CP'"",
      ""'PY'""
    ],
    ""governance_opportunities"": [
      ""fiscal year and week should be parameterised"",
      ""OS levels and publication codes should use governed reference tables or parameters"",
      ""period control names should be configurable""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH OSandFACT AS (\n  SELECT\n    os.Actual_Amount,\n    os.Budget_Amount,\n    os.Forecast_Amount,\n    calendar.fy_week_of_year,\n    calendar.fy_year,\n    os.gl_hierarchy_code,\n    os.is_print_digital_flag,\n    pub.l03_publication_code,\n    pub.l12_publication_code,\n    os.os_level_4,\n    os.os_level_5,\n    os.os_level_6,\n    os.os_level_7,\n    os.os_level_9,\n    pub.publication_name\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN (\n      SELECT DISTINCT\n        CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n        CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n        CAST(c.fy_year AS int) AS fy_year\n      FROM\n        `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n        JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n      WHERE\n        1 = 1\n    ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n      ON os.os_level_12 = dep.department_code\n)\nSELECT\n  fy_year,\n  fy_week_of_year,\n  gl_hierarchy_code,\n  is_print_digital_flag,\n  l03_publication_code,\n  l12_publication_code,\n  os_level_4,\n  os_level_5,\n  os_level_6,\n  os_level_7,\n  os_level_9,\n  publication_name,\n  SUM(Actual_Amount) AS total_actual_amount,\n  SUM(Budget_Amount) AS total_budget_amount,\n  SUM(Forecast_Amount) AS total_forecast_amount\nFROM\n  OSandFACT\nWHERE\n  gl_hierarchy_code = 'FY2025' -- Hardcoded fiscal year, consider parameterizing\n  AND fy_week_of_year = 40 -- Hardcoded fiscal week, consider parameterizing\n  AND os_level_4 IN ('Total Revenue', 'Total Expenses') -- Hardcoded OS levels, consider parameterizing\n  -- Additional filters from specific queries (e.g., l03_publication_code, os_level_9) can be added here as optional parameters\nGROUP BY\n  fy_year,\n  fy_week_of_year,\n  gl_hierarchy_code,\n  is_print_digital_flag,\n  l03_publication_code,\n  l12_publication_code,\n  os_level_4,\n  os_level_5,\n  os_level_6,\n  os_level_7,\n  os_level_9,\n  publication_name\nLIMIT 100000; -- Reduced limit for general analysis, original was 2000001"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT os.fiscal_week_id) AS unique_fiscal_weeks,\n  COUNT(DISTINCT calendar.fy_year) AS unique_fiscal_years,\n  COUNT(DISTINCT os.gl_publication_code) AS unique_gl_publications,\n  COUNT(DISTINCT os.os_level_4) AS unique_os_level_4s,\n  MIN(calendar.fy_first_day_of_week) AS earliest_fiscal_week_start_date,\n  MAX(calendar.fy_last_day_of_week) AS latest_fiscal_week_end_date\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\nWHERE\n  calendar.fy_year = 2025 -- Focusing on the relevant fiscal year for structure analysis\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(t0.Actual_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS actual_amount_test,\n  CASE WHEN SUM(t0.Budget_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS budget_amount_test,\n  CASE WHEN SUM(t0.Forecast_Amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS forecast_amount_test,\n  CASE WHEN COUNT(DISTINCT t0.gl_hierarchy_code) > 0 THEN 'PASS' ELSE 'FAIL' END AS gl_hierarchy_code_test,\n  CASE WHEN COUNT(DISTINCT t0.fy_week_of_year) > 0 THEN 'PASS' ELSE 'FAIL' END AS fy_week_of_year_test\nFROM (\n  WITH OSandFACT AS (\n    SELECT\n      os.Actual_Amount,\n      os.Budget_Amount,\n      os.Forecast_Amount,\n      calendar.fy_week_of_year,\n      calendar.fy_year,\n      os.gl_hierarchy_code\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n      LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n        ON os.gl_publication_code = pub.publication_code\n      LEFT JOIN (\n        SELECT DISTINCT\n          CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n          CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n          CAST(c.fy_year AS int) AS fy_year\n        FROM\n          `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n          JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n            ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n        WHERE\n          1 = 1\n      ) AS calendar\n        ON os.fiscal_week_id = calendar.fy_year_week_number\n      LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n        ON os.os_level_12 = dep.department_code\n  )\n  SELECT\n    *\n  FROM\n    OSandFACT\n) AS t0\nWHERE\n  t0.gl_hierarchy_code = 'FY2025' -- Hardcoded fiscal year\n  AND t0.fy_week_of_year = 40 -- Hardcoded fiscal week\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'FY2025 and Week 40 Filter Coverage' AS rule_name,\n  COUNT(*) AS total_records_in_scope,\n  SUM(CASE WHEN gl_hierarchy_code = 'FY2025' AND fy_week_of_year = 40 THEN 1 ELSE 0 END) AS records_matching_dashboard_filters,\n  SAFE_DIVIDE(SUM(CASE WHEN gl_hierarchy_code = 'FY2025' AND fy_week_of_year = 40 THEN 1 ELSE 0 END), COUNT(*)) * 100 AS percentage_matching_filters,\n  COUNT(DISTINCT os_level_4) AS distinct_os_level_4_values,\n  COUNT(DISTINCT l03_publication_code) AS distinct_l03_publication_codes,\n  COUNT(DISTINCT os_level_9) AS distinct_os_level_9_values\nFROM (\n  SELECT\n    os.gl_hierarchy_code,\n    calendar.fy_week_of_year,\n    os.os_level_4,\n    pub.l03_publication_code,\n    os.os_level_9\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN (\n      SELECT DISTINCT\n        CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n        CAST(c.fy_year_week_number AS int) AS fy_year_week_number\n      FROM\n        `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n        JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n          ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n    ) AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n) AS sub\nWHERE\n  gl_hierarchy_code = 'FY2025' -- Filter to the relevant fiscal year for this validation\nLIMIT 1;"",
    ""sample_data_sql"": ""SELECT\n  os.source_system_name,\n  os.sub_source_system_name,\n  os.fiscal_week_id,\n  os.gl_publication_code,\n  os.day_of_week,\n  os.state,\n  os.os_level_1,\n  os.os_level_2,\n  os.os_level_3,\n  os.os_level_4,\n  os.os_level_5,\n  os.os_level_6,\n  os.os_level_7,\n  os.os_level_8,\n  os.os_level_9,\n  os.os_level_10,\n  os.os_level_11,\n  os.os_level_12,\n  os.Estimate,\n  os.True_Up_Adjustment,\n  os.Actual_Amount,\n  os.volume,\n  os.Last_Year_Actual_Amount,\n  os.Last_Year_volume,\n  os.Budget_Draft_Amount,\n  os.Budget_Draft_Volume,\n  os.Budget_Amount,\n  os.Budget_Volume,\n  os.Forecast_Amount,\n  os.Forecast_Volume,\n  calendar.fy_week_of_year,\n  calendar.fy_year,\n  calendar.fy_first_day_of_week,\n  calendar.fy_last_day_of_week,\n  calendar.month_end_flag,\n  pub.publication_name,\n  pub.l03_publication_code,\n  pub.l12_publication_code,\n  dep.department_name\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n  LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n    ON os.gl_publication_code = pub.publication_code\n  LEFT JOIN (\n    SELECT DISTINCT\n      CAST(c.fy_week_of_year AS int) AS fy_week_of_year,\n      CAST(c.fy_year_week_number AS int) AS fy_year_week_number,\n      CAST(c.fy_first_day_of_week AS date) AS fy_first_day_of_week,\n      CAST(c.fy_last_day_of_week AS date) AS fy_last_day_of_week,\n      CASE\n        WHEN c.fy_last_day_of_week = c.fy_last_day_of_month THEN 'Y'\n        ELSE 'N'\n      END AS month_end_flag,\n      CAST(c.fy_year AS int) AS fy_year\n    FROM\n      `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS c\n      JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n        ON control.source_week_number = c.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n  ) AS calendar\n    ON os.fiscal_week_id = calendar.fy_year_week_number\n  LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_gl_department AS dep\n    ON os.os_level_12 = dep.department_code\nWHERE\n  calendar.fy_year = 2025 -- Sample data for the relevant fiscal year\n  AND calendar.fy_week_of_year = 40 -- Sample data for the relevant fiscal week\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY2025'""
          ],
          ""context"": ""Fiscal year filter applied to gl_hierarchy_code. This makes the dashboard static for a specific year."",
          ""suggested_governance"": ""Replace with a dashboard parameter for fiscal year or use relative fiscal year calculations."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""40""
          ],
          ""context"": ""Fiscal week filter applied to fy_week_of_year. This makes the dashboard static for a specific week."",
          ""suggested_governance"": ""Replace with a dashboard parameter for fiscal week or use relative fiscal week calculations (e.g., current week, previous week)."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Total Revenue'"",
            ""'Total Expenses'""
          ],
          ""context"": ""OS Level 4 filter. These are specific categories of financial data."",
          ""suggested_governance"": ""Use a multi-select dashboard parameter for os_level_4 or join to a reference table for OS levels if they are dynamic."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'News Media Publishing'""
          ],
          ""context"": ""L03 Publication Code filter. This is a specific publication hierarchy level."",
          ""suggested_governance"": ""Use a dashboard parameter for l03_publication_code or ensure this value is managed in the `v_asl_DIM_os_publication_hierachy` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Circulation'"",
            ""'Subscription'"",
            ""'Content Licensing'""
          ],
          ""context"": ""OS Level 9 filter. These are specific sub-categories of financial data."",
          ""suggested_governance"": ""Use a multi-select dashboard parameter for os_level_9 or join to a reference table for OS levels."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CP'"",
            ""'PY'""
          ],
          ""context"": ""Period names used in the join to `v_asl_DIM_period_control` within the calendar subquery. These define which periods are considered 'current' or 'previous year'."",
          ""suggested_governance"": ""If these period names can change or need to be dynamic, consider making them configurable via a lookup table or parameter."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year ('FY2025') with a dashboard parameter (e.g., `{{Fiscal Year}}`) or a relative fiscal year calculation (e.g., `CURRENT_FISCAL_YEAR()`)."",
      ""Replace hardcoded fiscal week (40) with a dashboard parameter (e.g., `{{Fiscal Week}}`) or a relative fiscal week calculation."",
      ""Replace hardcoded OS level values ('Total Revenue', 'Total Expenses', 'Circulation', 'Subscription', 'Content Licensing') with multi-select dashboard parameters or dynamic lookups from a configuration table."",
      ""Replace hardcoded publication codes ('News Media Publishing') with a dashboard parameter or dynamic lookups."",
      ""Review the `calender_table` CTE definition in the original queries. It is defined but not used in the `OSandFACT` CTE or the final `SELECT * FROM OSandFACT` statement. This indicates potential dead code or an incomplete query structure. If it's intended for use, integrate it; otherwise, remove it for clarity and efficiency.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""actual_amount"",
      ""metric_name"": ""Actual Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The actual financial amount recorded for a given period and dimension."",
      ""sql_logic"": ""SUM(Actual_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for tracking performance against budget and forecast."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in Actual_Amount"",
        ""data freshness dependent on underlying ETL""
      ]
    },
    {
      ""metric_id"": ""budget_amount"",
      ""metric_name"": ""Budget Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The planned or budgeted financial amount for a given period and dimension."",
      ""sql_logic"": ""SUM(Budget_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing'"",
        ""os_level_9 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for variance analysis against actuals and forecasts."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'"",
        ""'News Media Publishing'"",
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in Budget_Amount"",
        ""accuracy dependent on budget planning process""
      ]
    },
    {
      ""metric_id"": ""forecast_amount"",
      ""metric_name"": ""Forecast Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The projected financial amount for a given period and dimension, typically updated more frequently than budget."",
      ""sql_logic"": ""SUM(Forecast_Amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'"",
        ""fy_week_of_year = 40"",
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')"",
        ""l03_publication_code = 'News Media Publishing'"",
        ""os_level_9 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for variance analysis against actuals and budget, providing a more current view of expected performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'"",
        ""40"",
        ""'Total Revenue'"",
        ""'Total Expenses'"",
        ""'News Media Publishing'"",
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in Forecast_Amount"",
        ""accuracy dependent on forecasting methodology""
      ]
    },
    {
      ""metric_id"": ""fy_week_of_year"",
      ""metric_name"": ""Fiscal Week of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year."",
      ""sql_logic"": ""fy_week_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [
        ""fy_week_of_year = 40""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for weekly financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""40""
      ],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year."",
      ""sql_logic"": ""fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for annual financial reporting and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gl_hierarchy_code"",
      ""metric_name"": ""GL Hierarchy Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A code representing the GL hierarchy, often used for fiscal year or specific reporting structures."",
      ""sql_logic"": ""gl_hierarchy_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""gl_hierarchy_code = 'FY2025'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter data by specific financial reporting periods or structures."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'FY2025'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_print_digital_flag"",
      ""metric_name"": ""Is Print Digital Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Flag indicating if the publication is print or digital."",
      ""sql_logic"": ""is_print_digital_flag"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment financial data by publication type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""l03_publication_code"",
      ""metric_name"": ""L03 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Level 3 publication code from the hierarchy."",
      ""sql_logic"": ""l03_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [
        ""l03_publication_code = 'News Media Publishing'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to group financial data by a higher level of publication hierarchy."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'News Media Publishing'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""l12_publication_code"",
      ""metric_name"": ""L12 Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Level 12 publication code from the hierarchy."",
      ""sql_logic"": ""l12_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to group financial data by a specific publication code."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_4"",
      ""metric_name"": ""OS Level 4"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 4, typically a high-level category like 'Total Revenue' or 'Total Expenses'."",
      ""sql_logic"": ""os_level_4"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_4 IN ('Total Revenue', 'Total Expenses')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for distinguishing between revenue and expense line items."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Total Revenue'"",
        ""'Total Expenses'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_5"",
      ""metric_name"": ""OS Level 5"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 5, a sub-category of OS Level 4."",
      ""sql_logic"": ""os_level_5"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides further granularity for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_6"",
      ""metric_name"": ""OS Level 6"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 6, a sub-category of OS Level 5."",
      ""sql_logic"": ""os_level_6"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides further granularity for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_7"",
      ""metric_name"": ""OS Level 7"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 7, a sub-category of OS Level 6."",
      ""sql_logic"": ""os_level_7"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides further granularity for financial reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""os_level_9"",
      ""metric_name"": ""OS Level 9"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Operating Statement Level 9, a specific financial category like 'Circulation' or 'Subscription'."",
      ""sql_logic"": ""os_level_9"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated""
      ],
      ""filters_applied"": [
        ""os_level_9 IN ('Circulation', 'Subscription', 'Content Licensing')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue/expense by specific business activities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Circulation'"",
        ""'Subscription'"",
        ""'Content Licensing'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""publication_name"",
      ""metric_name"": ""Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The human-readable name of the publication."",
      ""sql_logic"": ""publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary dimension for reporting financial data by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""budget_amount"",
        ""forecast_amount""
      ],
      ""relationship_description"": ""Actual Amount is compared against Budget Amount and Forecast Amount to determine variance and performance."",
      ""mathematical_formula"": ""Variance to Budget = Actual_Amount - Budget_Amount; Variance to Forecast = Actual_Amount - Forecast_Amount"",
      ""business_validation"": ""These comparisons are fundamental for financial performance analysis, identifying deviations from plans and projections."",
      ""validation_sql"": ""SELECT\n  SUM(Actual_Amount) AS total_actual,\n  SUM(Budget_Amount) AS total_budget,\n  SUM(Forecast_Amount) AS total_forecast,\n  SUM(Actual_Amount) - SUM(Budget_Amount) AS variance_to_budget,\n  SUM(Actual_Amount) - SUM(Forecast_Amount) AS variance_to_forecast\nFROM (\n  SELECT\n    os.Actual_Amount,\n    os.Budget_Amount,\n    os.Forecast_Amount\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n    LEFT JOIN `ncau-data-newsquery-prd`.asl_finance.v_asl_DIM_period_control AS control\n      ON control.source_week_number = calendar.fy_year_week_number AND control.period_name IN ('CP', 'PY')\n  WHERE\n    os.gl_hierarchy_code = 'FY2025' AND calendar.fy_week_of_year = 40\n) AS sub;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""actual_amount"",
      ""related_metrics"": [
        ""budget_amount"",
        ""forecast_amount"",
        ""fy_week_of_year"",
        ""gl_hierarchy_code"",
        ""os_level_4"",
        ""l03_publication_code"",
        ""os_level_9""
      ],
      ""relationship_description"": ""All financial metrics (Actual, Budget, Forecast) are directly impacted by the filters applied to fiscal year, fiscal week, OS levels, and publication codes. The hardcoded nature of these filters means the dashboard only shows a very specific slice of data."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Understanding the impact of these filters is critical for interpreting the dashboard's scope. Any analysis outside 'FY2025', 'Week 40', or the specified OS levels/publications will not be reflected."",
      ""validation_sql"": ""SELECT\n  'Filter Impact Analysis' AS analysis_type,\n  COUNT(*) AS total_records_before_filters,\n  SUM(CASE WHEN gl_hierarchy_code = 'FY2025' THEN 1 ELSE 0 END) AS records_fy2025,\n  SUM(CASE WHEN fy_week_of_year = 40 THEN 1 ELSE 0 END) AS records_week40,\n  SUM(CASE WHEN os_level_4 IN ('Total Revenue', 'Total Expenses') THEN 1 ELSE 0 END) AS records_os_level_4_filtered,\n  SUM(CASE WHEN l03_publication_code = 'News Media Publishing' THEN 1 ELSE 0 END) AS records_l03_filtered,\n  SUM(CASE WHEN os_level_9 IN ('Circulation', 'Subscription', 'Content Licensing') THEN 1 ELSE 0 END) AS records_os_level_9_filtered\nFROM (\n  SELECT\n    os.gl_hierarchy_code,\n    calendar.fy_week_of_year,\n    os.os_level_4,\n    pub.l03_publication_code,\n    os.os_level_9\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_FCT_finance_os_aggregated` AS os\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_os_publication_hierachy` AS pub\n      ON os.gl_publication_code = pub.publication_code\n    LEFT JOIN `ncau-data-newsquery-prd.asl_finance.v_asl_DIM_calendar` AS calendar\n      ON os.fiscal_week_id = calendar.fy_year_week_number\n) AS sub\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,28
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""b9dfd2f4-92fa-4f81-a5b1-17de880470f9"",
    ""dashboard_name"": ""Contra Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard;ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily;ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 8,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""adpoint_account_number"",
      ""advertiser_name"",
      ""financial_year"",
      ""calendar_year_month"",
      ""portfolio_conformed_name_current"",
      ""current_portfolio_conformed_owner_full"",
      ""revenue_type"",
      ""sales_segment_gm_name"",
      ""nca_industry_pillar""
    ],
    ""date_range_detected"": ""All available data up to current"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'Contra'"",
      ""'Renee Sycamore'"",
      ""'13019'"",
      ""'52246'"",
      ""'18387'"",
      ""'ctr'"",
      ""'Guaranteed'"",
      ""'Exchange'"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'-'"",
      ""'CTR_2023_AFL SPORT'"",
      ""'CTR_2023_GWS GIANTS'"",
      ""'CTR_2023_SYDNEY SWANS'"",
      ""'CTR_2025_Greater Western Sydney Giants'"",
      ""'CTR_2025_Raising Literacy Australia'"",
      ""'VACANT'"",
      ""'Y'"",
      ""'N'"",
      ""'XXX'"",
      ""'ctr1'"",
      ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
    ],
    ""governance_opportunities"": [
      ""Account numbers and advertiser names used in filters should be managed in governed reference tables."",
      ""Business rules embedded in CASE statements (e.g., 'ctr1' logic) should be externalized to configuration tables."",
      ""Sales segment and industry pillar filters could be parameterized.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\nWITH\n  ContraSheetAccounts AS (\n    SELECT DISTINCT\n      NMBS_T_Number\n    FROM\n      `ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data`\n  ),\n  RevenueBase AS (\n    SELECT\n      financial_year,\n      CAST(financial_month AS int) AS financial_month_no,\n      financial_short_month,\n      calendar_year_month,\n      sales_segment_gm_name,\n      portfolio_conformed_name_current,\n      IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') AS current_portfolio_conformed_owner_full,\n      advertiser_name,\n      adpoint_account_number,\n      revenue_type,\n      gross_revenue_amount,\n      CASE\n        WHEN adpoint_account_number IN (\n          SELECT\n            NMBS_T_Number\n          FROM\n            ContraSheetAccounts\n        ) THEN 'Y'\n        ELSE 'N'\n      END AS sheet_account_flag,\n      CASE\n        WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1'\n        ELSE adpoint_account_number\n      END AS adpoint_account_number_categorized,\n      CASE\n        WHEN (\n          CASE\n            WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1'\n            ELSE adpoint_account_number\n          END\n        ) = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'\n        ELSE advertiser_name\n      END AS advertiser_name_categorized\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\n    WHERE\n      lower(`left`(advertiser_name, 3)) = 'ctr'\n      AND (\n        NOT (\n          cost_model_type = 'Guaranteed'\n          AND revenue_group_name = 'Exchange'\n        )\n      )\n      AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n      AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'\n      AND UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n      AND (\n        UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%'\n        OR (\n          UPPER(publication_name) LIKE 'SUDDENLY%'\n          AND (\n            account_number IN ('17114', '29172', '52809')\n            OR adtype_name = '-'\n          )\n        )\n      )\n  ),\n  DetailsBase AS (\n    SELECT\n      account_number,\n      adpoint_account_number,\n      advertiser_name,\n      current_portfolio_conformed_owner_full,\n      nca_industry_pillar,\n      sales_segment_gm_name\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\n  ),\n  AggregatedRevenue AS (\n    SELECT\n      financial_year,\n      financial_month_no,\n      financial_short_month,\n      calendar_year_month,\n      sales_segment_gm_name,\n      portfolio_conformed_name_current,\n      current_portfolio_conformed_owner_full,\n      advertiser_name_categorized,\n      adpoint_account_number_categorized,\n      revenue_type,\n      sheet_account_flag,\n      SUM(gross_revenue_amount) AS total_gross_revenue_amount\n    FROM\n      RevenueBase\n    GROUP BY\n      1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11\n  ),\n  AggregatedDetails AS (\n    SELECT\n      adpoint_account_number,\n      advertiser_name,\n      COUNT(1) AS record_count_for_advertisers,\n      MAX(CASE WHEN nca_industry_pillar = 'Contra' AND sales_segment_gm_name IN ('Renee Sycamore') THEN current_portfolio_conformed_owner_full END) AS filtered_owner_full_name,\n      MAX(CASE WHEN nca_industry_pillar = 'Contra' AND sales_segment_gm_name IN ('Renee Sycamore') THEN nca_industry_pillar END) AS filtered_nca_industry_pillar,\n      MAX(CASE WHEN nca_industry_pillar = 'Contra' AND sales_segment_gm_name IN ('Renee Sycamore') THEN sales_segment_gm_name END) AS filtered_sales_segment_gm_name\n    FROM\n      DetailsBase\n    WHERE\n      nca_industry_pillar = 'Contra' AND sales_segment_gm_name IN ('Renee Sycamore') -- Q1 filter\n      OR advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia') -- Q3 filter\n    GROUP BY\n      1, 2\n  )\nSELECT\n  ar.financial_year,\n  ar.financial_month_no,\n  ar.financial_short_month,\n  ar.calendar_year_month,\n  ar.sales_segment_gm_name,\n  ar.portfolio_conformed_name_current,\n  ar.current_portfolio_conformed_owner_full,\n  ar.advertiser_name_categorized,\n  ar.adpoint_account_number_categorized,\n  ar.revenue_type,\n  ar.sheet_account_flag,\n  ar.total_gross_revenue_amount,\n  ad.record_count_for_advertisers,\n  ad.filtered_owner_full_name,\n  ad.filtered_nca_industry_pillar,\n  ad.filtered_sales_segment_gm_name\nFROM\n  AggregatedRevenue AS ar\n  LEFT JOIN AggregatedDetails AS ad ON ar.adpoint_account_number_categorized = ad.adpoint_account_number\n  AND ar.advertiser_name_categorized = ad.advertiser_name\nWHERE\n  ar.financial_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Example date filter for last 2 years\nORDER BY\n  ar.financial_year DESC, ar.financial_month_no DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`) AS total_revenue_records,\n  (SELECT COUNT(DISTINCT adpoint_account_number) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`) AS unique_revenue_accounts,\n  (SELECT COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`) AS unique_revenue_advertisers,\n  (SELECT MIN(CONCAT(financial_year, '-', LPAD(CAST(financial_month AS STRING), 2, '0'))) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`) AS earliest_revenue_month,\n  (SELECT MAX(CONCAT(financial_year, '-', LPAD(CAST(financial_month AS STRING), 2, '0'))) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`) AS latest_revenue_month,\n  (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`) AS total_details_records,\n  (SELECT COUNT(DISTINCT adpoint_account_number) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`) AS unique_details_accounts,\n  (SELECT COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`) AS unique_details_advertisers\nFROM\n  DUAL;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT adpoint_account_number) > 0 THEN 'PASS' ELSE 'FAIL' END AS unique_accounts_test,\n  CASE WHEN MAX(financial_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END AS freshness_test_revenue,\n  (SELECT CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE advertiser_name LIKE 'CTR_%' LIMIT 1) AS contra_advertiser_presence_test\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  financial_year = EXTRACT(YEAR FROM CURRENT_DATE());"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Contra Advertiser Naming Convention' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN lower(left(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END) AS records_matching_ctr_prefix,\n  SAFE_DIVIDE(SUM(CASE WHEN lower(left(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS ctr_prefix_match_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  financial_year = EXTRACT(YEAR FROM CURRENT_DATE()) -- Focus on recent data\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Billed/Booked Revenue Status' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_billed_or_booked,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 AS billed_booked_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  financial_year = EXTRACT(YEAR FROM CURRENT_DATE());"",
    ""sample_data_sql"": ""SELECT\n  financial_year,\n  calendar_year_month,\n  advertiser_name,\n  adpoint_account_number,\n  gross_revenue_amount,\n  revenue_type,\n  sales_segment_gm_name,\n  current_portfolio_conformed_owner_full_name_current,\n  cost_model_type,\n  revenue_group_name,\n  revenue_transaction_status,\n  publication_name\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily`\nWHERE\n  financial_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Last 1 year of data\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  financial_year DESC, calendar_year_month DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Contra'"",
            ""'Renee Sycamore'"",
            ""'13019'"",
            ""'52246'"",
            ""'18387'"",
            ""'ctr'"",
            ""'Guaranteed'"",
            ""'Exchange'"",
            ""'BILLED'"",
            ""'BOOKED'"",
            ""'ROP COMPOSITE'"",
            ""'MEDIUM RARE CONTENT AGENCY'"",
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'"",
            ""'-'"",
            ""'CTR_2023_AFL SPORT'"",
            ""'CTR_2023_GWS GIANTS'"",
            ""'CTR_2023_SYDNEY SWANS'"",
            ""'CTR_2025_Greater Western Sydney Giants'"",
            ""'CTR_2025_Raising Literacy Australia'""
          ],
          ""context"": ""Used in WHERE clauses for filtering dimensions (industry pillar, sales GM, advertiser name, account number, revenue attributes) and in CASE statements for re-categorization."",
          ""suggested_governance"": ""These values should be managed in governed reference tables (e.g., `dim_contra_accounts`, `dim_advertiser_categories`, `dim_revenue_rules`)."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'VACANT'"",
            ""'Y'"",
            ""'N'"",
            ""'XXX'"",
            ""'ctr1'"",
            ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
          ],
          ""context"": ""Default values for IFNULL, flags for derived categories, and specific re-categorized advertiser names."",
          ""suggested_governance"": ""Derived categories and flags should be defined in a business rule configuration table or a dedicated dimension table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., specific account numbers, advertiser names, status codes) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., `cost_model_type`, `revenue_group_name` exclusions, `publication_name` exceptions) instead of hardcoded logic in SQL.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""owner_full_name"",
      ""metric_name"": ""Current Portfolio Conformed Owner Full Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Full name of the current portfolio conformed owner, with 'VACANT' as a default."",
      ""sql_logic"": ""t0.current_portfolio_conformed_owner_full (from details_dashboard), IFNULL(current_portfolio_conformed_owner_full_name_current, 'VACANT') (from v_adsales_revenue_client_daily)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""nca_industry_pillar = 'Contra'"",
        ""sales_segment_gm_name IN ('Renee Sycamore')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter and group by specific owners within the 'Contra' segment for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls handled by IFNULL""
      ]
    },
    {
      ""metric_id"": ""nca_industry_pillar"",
      ""metric_name"": ""NCA Industry Pillar"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Industry pillar classification from NCA."",
      ""sql_logic"": ""t0.nca_industry_pillar"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""nca_industry_pillar = 'Contra'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting financial data, specifically for 'Contra' reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Contra'""
      ],
      ""governance_issues"": [
        ""filter value 'Contra' could be parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_gm_name"",
      ""metric_name"": ""Sales Segment GM Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Name of the General Manager for the sales segment."",
      ""sql_logic"": ""t0.sales_segment_gm_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""sales_segment_gm_name IN ('Renee Sycamore')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for filtering by sales team/manager for specific reporting needs."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Renee Sycamore'""
      ],
      ""governance_issues"": [
        ""filter value 'Renee Sycamore' could be parameterized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adpoint_account_number_categorized"",
      ""metric_name"": ""Adpoint Account Number (Categorized)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for accounts in the Adpoint system, re-categorized to 'ctr1' for specific contra accounts."",
      ""sql_logic"": ""CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1' ELSE adpoint_account_number END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary key for accounts, used for aggregation and specific contra account identification and grouping."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'13019'"",
        ""'52246'"",
        ""'18387'"",
        ""'ctr1'""
      ],
      ""governance_issues"": [
        ""account numbers should be managed in a reference table"",
        ""derived 'ctr1' value should be externalized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name_categorized"",
      ""metric_name"": ""Advertiser Name (Categorized)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""adpoint_account_number_categorized""
      ],
      ""business_description"": ""Name of the advertiser, re-categorized to a specific 'CTR_2023_AFL Sports...' string if the account is 'ctr1'."",
      ""sql_logic"": ""CASE WHEN adpoint_account_number_categorized = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""lower(left(advertiser_name, 3)) = 'ctr'"",
        ""advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for identifying and grouping revenue by advertiser, especially for 'Contra' accounts, with specific re-categorization for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'ctr'"",
        ""'CTR_2023_AFL SPORT'"",
        ""'CTR_2023_GWS GIANTS'"",
        ""'CTR_2023_SYDNEY SWANS'"",
        ""'CTR_2025_Greater Western Sydney Giants'"",
        ""'CTR_2025_Raising Literacy Australia'"",
        ""'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants'""
      ],
      ""governance_issues"": [
        ""advertiser names used in filters should be managed in a reference table"",
        ""derived advertiser name should be externalized""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total gross revenue generated, subject to specific filtering rules for contra reporting."",
      ""sql_logic"": ""sum(gross_revenue_amount)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily""
      ],
      ""filters_applied"": [
        ""lower(left(advertiser_name, 3)) = 'ctr'"",
        ""NOT(cost_model_type = 'Guaranteed' AND revenue_group_name = 'Exchange')"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name NOT LIKE 'SUDDENLY%' OR (publication_name LIKE 'SUDDENLY%' AND (account_number IN ('17114', '29172', '52809') OR adtype_name = '-'))""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for advertising sales, specifically for contra accounts, indicating the value of transactions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'"",
        ""'Exchange'"",
        ""'BILLED'"",
        ""'BOOKED'"",
        ""'ROP COMPOSITE'"",
        ""'MEDIUM RARE CONTENT AGENCY'"",
        ""'SUDDENLY%'"",
        ""'17114'"",
        ""'29172'"",
        ""'52809'"",
        ""'-'""
      ],
      ""governance_issues"": [
        ""all filter values should be externalized or parameterized""
      ],
      ""data_quality_concerns"": [
        ""potential for nulls if not handled by source view""
      ]
    },
    {
      ""metric_id"": ""record_count"",
      ""metric_name"": ""Record Count for Advertisers"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Count of records from the details dashboard matching specific advertiser criteria."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to understand the volume of entries for specific contra advertisers in the details system."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CTR_2023_AFL SPORT'"",
        ""'CTR_2023_GWS GIANTS'"",
        ""'CTR_2023_SYDNEY SWANS'"",
        ""'CTR_2025_Greater Western Sydney Giants'"",
        ""'CTR_2025_Raising Literacy Australia'""
      ],
      ""governance_issues"": [
        ""advertiser names used in filters should be managed in a reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sheet_account_flag"",
      ""metric_name"": ""Contra Sheet Account Flag"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Flag indicating if an account number is present in the `contra_sheet_data` table ('Y' if present, 'N' otherwise)."",
      ""sql_logic"": ""CASE WHEN adpoint_account_number IN (SELECT DISTINCT NMBS_T_Number FROM ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data) THEN 'Y' ELSE 'N' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily"",
        ""ncau-data-newsquery-prd.sbx_dcp.contra_sheet_data""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial flag for identifying accounts that are part of the official contra sheet, enabling segmentation of revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'N'""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""data freshness of contra_sheet_data""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""advertiser_name_categorized"",
      ""related_metrics"": [
        ""adpoint_account_number_categorized""
      ],
      ""relationship_description"": ""The categorization of 'Advertiser Name' depends on the categorization of 'Adpoint Account Number'. If 'Adpoint Account Number' is categorized as 'ctr1', then 'Advertiser Name' is assigned a specific long string."",
      ""mathematical_formula"": ""IF adpoint_account_number_categorized = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE original_advertiser_name"",
      ""business_validation"": ""Ensures consistent grouping and naming for specific contra accounts across reports."",
      ""validation_sql"": ""SELECT adpoint_account_number_categorized, advertiser_name_categorized, COUNT(*) FROM (SELECT CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1' ELSE adpoint_account_number END AS adpoint_account_number_categorized, CASE WHEN (CASE WHEN adpoint_account_number IN ('13019', '52246', '18387') THEN 'ctr1' ELSE adpoint_account_number END) = 'ctr1' THEN 'CTR_2023_AFL Sports CTR_2023_Sydney Swans CTR_2023_GWS Giants' ELSE advertiser_name END AS advertiser_name_categorized FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE adpoint_account_number IN ('13019', '52246', '18387')) GROUP BY 1, 2;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""advertiser_name"",
        ""cost_model_type"",
        ""revenue_group_name"",
        ""revenue_transaction_status"",
        ""style_name"",
        ""source_publishing_division"",
        ""publication_name"",
        ""account_number"",
        ""adtype_name""
      ],
      ""relationship_description"": ""Gross Revenue Amount is heavily filtered by multiple conditions on various dimensions, ensuring only specific 'contra-related' and valid revenue transactions are included."",
      ""mathematical_formula"": ""SUM(gross_revenue_amount) WHERE [multiple conditions]"",
      ""business_validation"": ""These filters define the specific scope of 'Contra' revenue being reported, excluding certain types of revenue or publications."",
      ""validation_sql"": ""SELECT COUNT(*) AS total_records, SUM(CASE WHEN lower(left(advertiser_name, 3)) = 'ctr' THEN 1 ELSE 0 END) AS ctr_records, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS billed_booked_records FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_daily` WHERE financial_year = EXTRACT(YEAR FROM CURRENT_DATE());"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""record_count"",
      ""related_metrics"": [
        ""advertiser_name""
      ],
      ""relationship_description"": ""Record Count is specifically filtered to include only certain 'CTR' named advertisers, indicating a focus on specific contra accounts."",
      ""mathematical_formula"": ""COUNT(1) WHERE advertiser_name IN ('CTR_2023_AFL SPORT', ...)"",
      ""business_validation"": ""This filter ensures the count reflects only the specified contra advertisers, which are likely key accounts for the report."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE advertiser_name IN ('CTR_2023_AFL SPORT', 'CTR_2023_GWS GIANTS', 'CTR_2023_SYDNEY SWANS', 'CTR_2025_Greater Western Sydney Giants', 'CTR_2025_Raising Literacy Australia');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,29
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""4d22b4c2-4bb3-49db-a0c1-4d46d4fba101"",
    ""dashboard_name"": ""Copy of Acquisitions - Extracts"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 1,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fy_year"",
      ""fy_week_of_year"",
      ""masthead"",
      ""publication_type"",
      ""publication_group"",
      ""subscription_type"",
      ""source_channel"",
      ""business_type"",
      ""offer_category_group_name"",
      ""offer_category_name""
    ],
    ""date_range_detected"": ""FY2025"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'op'"",
      ""'Digital Y'"",
      ""'Digital N'"",
      ""'Bundle Y'"",
      ""'Not Available Y'"",
      ""'TA'"",
      ""'CM'"",
      ""'DT'"",
      ""'HS'"",
      ""'AA'"",
      ""'CP'"",
      ""'GA'"",
      ""'GC'"",
      ""'NT'"",
      ""'TM'"",
      ""'TB'"",
      ""'TC'"",
      ""'WT'"",
      ""'SC'"",
      ""'CS'"",
      ""'TS'"",
      ""'AP'"",
      ""'RN'"",
      ""'PU'"",
      ""'Exclude'"",
      ""'The Australian and Prestige'"",
      ""'_AB'"",
      ""'_BB'"",
      ""'_CF'"",
      ""'_CS'"",
      ""'_FA'"",
      ""'_FF'"",
      ""'_NA'"",
      ""'_PC'"",
      ""'_PE'"",
      ""'_SL'"",
      ""'_SS'"",
      ""'_TE'"",
      ""'_TH'"",
      ""'_TO'"",
      ""'_WS'"",
      ""'PRED'"",
      ""'AMP'"",
      ""'FBK'"",
      ""'FMB'"",
      ""'GGL'"",
      ""'GGN'"",
      ""'INS'"",
      ""'LIN'"",
      ""'NEW'"",
      ""'NWL'"",
      ""'POD'"",
      ""'POR'"",
      ""'RED'"",
      ""'SCP'"",
      ""'SEC'"",
      ""'TCA'"",
      ""'TMP'"",
      ""'TWA'"",
      ""'TWT'"",
      ""'WID'"",
      ""'_FBK'"",
      ""'_GGL'"",
      ""'_LIN'"",
      ""'_RED'"",
      ""'_TWT'"",
      ""'Consumer'"",
      ""'Gift Receiver'"",
      ""'Campus'"",
      ""'Corporate'"",
      ""'Corporate excluding IP'"",
      ""'Corporate IP'"",
      ""'IP Access'"",
      ""'SMB'"",
      ""'Others'"",
      ""'B2C'"",
      ""'B2B'"",
      ""''""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""masthead codes should join to a masthead_lookup table"",
      ""source_code patterns should join to a source_channel_lookup table"",
      ""classification_level_2 values should join to a business_type_lookup table"",
      ""subscription type logic should be defined in a governed view or lookup""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the SQL you will run for business analysis\nWITH base_data AS (\n  SELECT\n    t0.delivery_medium_type,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    t0.masthead,\n    t0.sold_in_source_code,\n    t0.subscriber_has_email_flag,\n    t0.table_nm,\n    t0.classification_level_2,\n    t0.offer_category_group_name,\n    t0.offer_category_name\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` AS t0\n),\ntransformed_data AS (\n  SELECT\n    fy_year,\n    fy_week_of_year,\n    masthead,\n    offer_category_group_name,\n    offer_category_name,\n    table_nm,\n\n    -- Derived Dimension: delivery_medium_type_transformed (clmn6_ in Q1)\n    CASE WHEN (delivery_medium_type = 'Not Available') THEN 'Digital' ELSE delivery_medium_type END AS delivery_medium_type_transformed,\n\n    -- Derived Dimension: publication_type (clmn7_ in Q1, clmn8_ in Q2, clmn11_ in Q3)\n    CASE\n      WHEN (masthead = 'TA') THEN 'The Australian'\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals'\n      WHEN (masthead = 'WT') THEN 'Other Publications'\n      WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications'\n      WHEN (masthead IS NULL) THEN 'check'\n      ELSE 'Exclude'\n    END AS publication_type,\n\n    -- Derived Dimension: publication_group (clmn8_ in Q1, clmn9_ in Q2, clmn12_ in Q3)\n    CASE\n      WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community'\n      WHEN (masthead = 'TA') THEN 'The Australian and Prestige'\n      WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content'\n      WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle'\n      ELSE 'Exclude'\n    END AS publication_group,\n\n    -- Derived Dimension: subscription_type (clmn13_/clmn14_ in Q1, clmn15_/clmn16_ in Q2, clmn18_/clmn19_ in Q3)\n    CASE\n      WHEN (CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions'\n      ELSE 'Print Subscriptions'\n    END AS subscription_type,\n\n    -- Derived Dimension: business_type (clmn13_ in Q2, clmn16_ in Q3)\n    CASE\n      WHEN (classification_level_2 IN ('Consumer', 'Gift Receiver')) THEN 'B2C'\n      WHEN (classification_level_2 IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B'\n      ELSE 'Others'\n    END AS business_type,\n\n    -- Derived Dimension: source_channel (clmn15_ in Q1, clmn17_ in Q2, clmn20_/clmn21_ in Q3)\n    CASE\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_AB') > 0) THEN 'Above the Fold'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_BB') > 0) THEN 'Blackbook'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CF') > 0) THEN 'Community Form'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CS') > 0) THEN 'Closing Speed'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FA') > 0) THEN 'Free Articles'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FF') > 0) THEN 'Form Finder'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_NA') > 0) THEN 'News Articles'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PC') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PE') > 0) THEN 'Punters Edge'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SL') > 0) THEN 'Shortlist'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SS') > 0) THEN 'Setting Speed'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TE') > 0) THEN 'Tippers Edge'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TH') > 0) THEN 'Todays Headlines'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TO') > 0) THEN 'The Oz'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_WS') > 0) THEN 'Why Subscribe'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 4), 'PRED') > 0) THEN 'Predictor'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'AMP') > 0) THEN 'Google AMP'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FMB') > 0) THEN 'Facebook Messenger Bot'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGN') > 0) THEN 'Google News'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NEW') > 0) THEN 'news.com.au'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NWL') > 0) THEN 'Newsletter'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POD') > 0) THEN 'Podcasts'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POR') > 0) THEN 'Newsletter Sports'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SCP') > 0) THEN 'Supercoach Plus'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SEC') > 0) THEN 'Sectionals'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TCA') > 0) THEN 'True Crime Aus'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TMP') > 0) THEN 'Tips Mrket Place'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWA') > 0) THEN 'The Weekend Aus'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWT') > 0) THEN 'Twitter'\n      WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'WID') > 0) THEN 'Widget'\n      WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook'\n      WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google'\n      WHEN (STRPOS(sold_in_source_code, 'INS') > 0) THEN 'Instagram'\n      WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In'\n      WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit'\n      WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter'\n      ELSE NULL\n    END AS source_channel\n  FROM base_data\n)\nSELECT\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  publication_type,\n  publication_group,\n  delivery_medium_type_transformed,\n  subscription_type,\n  source_channel,\n  business_type,\n  offer_category_group_name,\n  offer_category_name,\n  COUNT(1) AS total_acquisitions_movements\nFROM transformed_data\nWHERE\n  fy_year = 2025 -- Hardcoded year\n  AND table_nm != 'op'\n  AND publication_type != 'Exclude'\n  AND publication_group = 'The Australian and Prestige'\n  AND subscription_type = 'Digital Subscriptions'\n  AND source_channel IS NOT NULL\n  AND business_type IN ('B2C', '') -- From Q3, Q2 only had 'B2C'. Keeping both for completeness.\nGROUP BY\n  fy_year,\n  fy_week_of_year,\n  masthead,\n  publication_type,\n  publication_group,\n  delivery_medium_type_transformed,\n  subscription_type,\n  source_channel,\n  business_type,\n  offer_category_group_name,\n  offer_category_name\nORDER BY\n  fy_year DESC, fy_week_of_year DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fy_year) as unique_fy_years,\n  COUNT(DISTINCT fy_week_of_year) as unique_fy_weeks,\n  COUNT(DISTINCT masthead) as unique_mastheads,\n  COUNT(DISTINCT sold_in_source_code) as unique_source_codes,\n  COUNT(DISTINCT classification_level_2) as unique_classification_levels,\n  MIN(fy_year) as earliest_fy_year,\n  MAX(fy_year) as latest_fy_year,\n  APPROX_COUNT_DISTINCT(CONCAT(fy_year, '-', fy_week_of_year, '-', masthead, '-', sold_in_source_code)) as approx_unique_records_at_grain\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN COUNT(1) > 0 THEN 'PASS' ELSE 'FAIL' END as records_exist_test,\n  CASE WHEN SUM(CASE WHEN fy_year = 2025 THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as fy2025_data_test,\n  CASE WHEN SUM(CASE WHEN masthead IS NULL THEN 1 ELSE 0 END) = 0 THEN 'PASS' ELSE 'FAIL' END as masthead_not_null_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements`\nWHERE fy_year = 2025\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Digital Subscriptions Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements`\nWHERE fy_year = 2025 AND table_nm != 'op' AND masthead = 'TA' -- Example specific filters to narrow down\nLIMIT 1000;"",
    ""sample_data_sql"": ""SELECT \n  fy_year,\n  fy_week_of_year,\n  masthead,\n  sold_in_source_code,\n  delivery_medium_type,\n  subscriber_has_email_flag,\n  classification_level_2,\n  offer_category_group_name,\n  offer_category_name,\n  table_nm\nFROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements`\nWHERE fy_year = 2025\nORDER BY RAND()\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""Fiscal Year filter in WHERE clause"",
          ""suggested_fix"": ""replace with a parameter or relative fiscal year (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or `CURRENT_FY_YEAR()`)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'op'""
          ],
          ""context"": ""Exclusion filter for `table_nm`"",
          ""suggested_governance"": ""Define valid `table_nm` values in a reference table or configuration."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Digital Y'"",
            ""'Digital N'"",
            ""'Bundle Y'"",
            ""'Not Available Y'""
          ],
          ""context"": ""Logic for `subscription_type` derivation"",
          ""suggested_governance"": ""Create a `subscription_type_lookup` table or a governed view that defines these mappings."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'TA'"",
            ""'CM'"",
            ""'DT'"",
            ""'HS'"",
            ""'AA'"",
            ""'CP'"",
            ""'GA'"",
            ""'GC'"",
            ""'NT'"",
            ""'TM'"",
            ""'TB'"",
            ""'TC'"",
            ""'WT'"",
            ""'SC'"",
            ""'CS'"",
            ""'TS'"",
            ""'AP'"",
            ""'RN'"",
            ""'PU'""
          ],
          ""context"": ""Masthead codes used in `publication_type` and `publication_group` derivations"",
          ""suggested_governance"": ""Create a `masthead_lookup` table with `masthead_code`, `publication_type`, `publication_group` columns and join to it."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Exclude'"",
            ""'The Australian and Prestige'""
          ],
          ""context"": ""Specific values used for filtering `publication_type` and `publication_group`"",
          ""suggested_governance"": ""These derived values should be consistent with the `masthead_lookup` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'_AB'"",
            ""'_BB'"",
            ""'_CF'"",
            ""'_CS'"",
            ""'_FA'"",
            ""'_FF'"",
            ""'_NA'"",
            ""'_PC'"",
            ""'_PE'"",
            ""'_SL'"",
            ""'_SS'"",
            ""'_TE'"",
            ""'_TH'"",
            ""'_TO'"",
            ""'_WS'"",
            ""'PRED'"",
            ""'AMP'"",
            ""'FBK'"",
            ""'FMB'"",
            ""'GGL'"",
            ""'GGN'"",
            ""'INS'"",
            ""'LIN'"",
            ""'NEW'"",
            ""'NWL'"",
            ""'POD'"",
            ""'POR'"",
            ""'RED'"",
            ""'SCP'"",
            ""'SEC'"",
            ""'TCA'"",
            ""'TMP'"",
            ""'TWA'"",
            ""'TWT'"",
            ""'WID'"",
            ""'_FBK'"",
            ""'_GGL'"",
            ""'_LIN'"",
            ""'_RED'"",
            ""'_TWT'""
          ],
          ""context"": ""Source codes/patterns used in `source_channel` derivation"",
          ""suggested_governance"": ""Create a `source_channel_lookup` table with `source_code_pattern`, `channel_name`, and potentially `pattern_type` (e.g., 'RIGHT_3', 'RIGHT_4', 'FULL_STRPOS') and join to it."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Consumer'"",
            ""'Gift Receiver'"",
            ""'Campus'"",
            ""'Corporate'"",
            ""'Corporate excluding IP'"",
            ""'Corporate IP'"",
            ""'IP Access'"",
            ""'SMB'"",
            ""'Others'"",
            ""'B2C'"",
            ""'B2B'"",
            ""''""
          ],
          ""context"": ""Logic for `business_type` derivation and filtering"",
          ""suggested_governance"": ""Create a `business_type_lookup` table for `classification_level_2` to `business_type` mapping."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., for fiscal year)."",
      ""Replace hardcoded lookup values (e.g., masthead codes, source codes, classification levels) with joins to governed reference tables."",
      ""Use configuration tables for business rules (e.g., subscription type mapping) instead of hardcoded logic in CASE statements.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_acquisitions_movements"",
      ""metric_name"": ""Total Acquisitions/Movements"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total count of acquisition or movement records based on the applied filters, representing new subscriptions or changes in subscriber status."",
      ""sql_logic"": ""COUNT(1)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""table_nm != 'op'"",
        ""publication_type != 'Exclude'"",
        ""publication_group = 'The Australian and Prestige'"",
        ""subscription_type = 'Digital Subscriptions'"",
        ""source_channel IS NOT NULL"",
        ""business_type IN ('B2C', '')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""This metric is crucial for understanding the volume of new acquisitions and subscriber movements, broken down by various dimensions like publication, source, and business type. It directly supports acquisition strategy analysis."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'op'"",
        ""'Exclude'"",
        ""'The Australian and Prestige'"",
        ""'Digital Subscriptions'"",
        ""'B2C'"",
        ""''""
      ],
      ""governance_issues"": [
        ""date should be parameterised"",
        ""lookup values for filters should use reference tables""
      ],
      ""data_quality_concerns"": [
        ""potential nulls in source_channel if new patterns emerge"",
        ""accuracy depends on completeness of `acquisitions_cancellations_movements` table""
      ]
    },
    {
      ""metric_id"": ""publication_type"",
      ""metric_name"": ""Publication Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of mastheads into broader publication types like 'The Australian', 'Metro', 'Regionals', 'Deep Niche Publications', etc."",
      ""sql_logic"": ""CASE WHEN (masthead = 'TA') THEN 'The Australian' ... ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""publication_type != 'Exclude'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze acquisitions across different tiers or types of publications."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TA'"",
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""'check' and 'Exclude' categories might indicate unmapped or problematic data""
      ]
    },
    {
      ""metric_id"": ""publication_group"",
      ""metric_name"": ""Publication Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""publication_type""
      ],
      ""business_description"": ""Broader grouping of publications into categories like 'States and Community', 'The Australian and Prestige', 'Commercial Content', 'Free & Lifestyle'."",
      ""sql_logic"": ""CASE WHEN (masthead IN ('CM', 'DT', ...)) THEN 'States and Community' ... ELSE 'Exclude' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""publication_group = 'The Australian and Prestige'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a higher-level view for analyzing acquisitions across strategic publication segments."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'States and Community'"",
        ""'The Australian and Prestige'"",
        ""'Exclude'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""'Exclude' category might indicate unmapped data""
      ]
    },
    {
      ""metric_id"": ""subscription_type"",
      ""metric_name"": ""Subscription Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Classifies subscriptions as 'Digital Subscriptions' or 'Print Subscriptions' based on delivery medium and email flag."",
      ""sql_logic"": ""CASE WHEN (CONCAT(delivery_medium_type, ' ', subscriber_has_email_flag) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""subscription_type = 'Digital Subscriptions'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Essential for segmenting acquisitions by digital vs. print channels, critical for digital transformation strategies."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Y'"",
        ""'Digital N'"",
        ""'Bundle Y'"",
        ""'Not Available Y'"",
        ""'Digital Subscriptions'"",
        ""'Print Subscriptions'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""potential for new delivery_medium_type/email_flag combinations not covered by logic""
      ]
    },
    {
      ""metric_id"": ""source_channel"",
      ""metric_name"": ""Source Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Identifies the specific marketing or acquisition channel (e.g., 'Facebook', 'Google', 'Newsletter', 'Above the Fold') from which a subscriber originated."",
      ""sql_logic"": ""CASE WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_AB') > 0) THEN 'Above the Fold' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""source_channel IS NOT NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for attributing acquisitions to specific marketing efforts and optimizing channel spend."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'_AB'"",
        ""'_BB'"",
        ""'PRED'"",
        ""'FBK'"",
        ""'GGL'"",
        ""'INS'"",
        ""'NEW'"",
        ""'NWL'"",
        ""'POD'"",
        ""'RED'"",
        ""'TWT'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table"",
        ""complex string parsing logic should be externalized""
      ],
      ""data_quality_concerns"": [
        ""new source codes may not be mapped, leading to NULLs or 'Other' category"",
        ""potential for misclassification due to overlapping patterns""
      ]
    },
    {
      ""metric_id"": ""business_type"",
      ""metric_name"": ""Business Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Classifies the subscriber's business relationship as 'B2C' (Business to Consumer), 'B2B' (Business to Business), or 'Others'."",
      ""sql_logic"": ""CASE WHEN (classification_level_2 IN ('Consumer', 'Gift Receiver')) THEN 'B2C' ... ELSE 'Others' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements""
      ],
      ""filters_applied"": [
        ""business_type IN ('B2C', '')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment acquisitions by customer type, informing different sales and marketing strategies for B2C vs. B2B."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Consumer'"",
        ""'Gift Receiver'"",
        ""'Campus'"",
        ""'Corporate'"",
        ""'B2C'"",
        ""'B2B'"",
        ""''""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": [
        ""'Others' category might indicate unmapped data"",
        ""empty string filter might be unintended""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_acquisitions_movements"",
      ""related_metrics"": [
        ""fy_year"",
        ""table_nm"",
        ""publication_type"",
        ""publication_group"",
        ""subscription_type"",
        ""source_channel"",
        ""business_type""
      ],
      ""relationship_description"": ""The 'Total Acquisitions/Movements' metric is directly filtered by specific values of several dimensions, narrowing down the scope of the count."",
      ""mathematical_formula"": ""COUNT(1) WHERE [dimension_filter_conditions]"",
      ""business_validation"": ""Ensures that the acquisition count is specific to Digital Subscriptions for The Australian and Prestige mastheads, from identified B2C sources, for FY2025."",
      ""validation_sql"": ""SELECT COUNT(1) FROM `ncau-data-newsquery-prd.asl_finance_derived.acquisitions_cancellations_movements` WHERE fy_year = 2025 AND table_nm != 'op' AND (CASE WHEN (masthead = 'TA') THEN 'The Australian' WHEN (masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro' WHEN (masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC')) THEN 'Regionals' WHEN (masthead = 'WT') THEN 'Other Publications' WHEN (masthead IN ('SC', 'CS', 'TS', 'AP', 'RN', 'PU')) THEN 'Deep Niche Publications' WHEN (masthead IS NULL) THEN 'check' ELSE 'Exclude' END) != 'Exclude' AND (CASE WHEN (masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT', 'CS', 'AP', 'SC')) THEN 'States and Community' WHEN (masthead = 'TA') THEN 'The Australian and Prestige' WHEN (masthead IN ('PU', 'RN')) THEN 'Commercial Content' WHEN (masthead IN ('TS')) THEN 'Free & Lifestyle' ELSE 'Exclude' END) = 'The Australian and Prestige' AND (CASE WHEN (CONCAT(SAFE_CAST(delivery_medium_type AS STRING),' ',SAFE_CAST(subscriber_has_email_flag AS STRING)) IN ('Digital Y', 'Digital N', 'Bundle Y', 'Not Available Y')) THEN 'Digital Subscriptions' ELSE 'Print Subscriptions' END) = 'Digital Subscriptions' AND (CASE WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_AB') > 0) THEN 'Above the Fold' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_BB') > 0) THEN 'Blackbook' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CF') > 0) THEN 'Community Form' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_CS') > 0) THEN 'Closing Speed' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FA') > 0) THEN 'Free Articles' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_FF') > 0) THEN 'Form Finder' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_NA') > 0) THEN 'News Articles' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PC') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_PE') > 0) THEN 'Punters Edge' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SL') > 0) THEN 'Shortlist' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_SS') > 0) THEN 'Setting Speed' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TE') > 0) THEN 'Tippers Edge' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TH') > 0) THEN 'Todays Headlines' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_TO') > 0) THEN 'The Oz' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), '_WS') > 0) THEN 'Why Subscribe' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 4), 'PRED') > 0) THEN 'Predictor' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'AMP') > 0) THEN 'Google AMP' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FBK') > 0) THEN 'Facebook' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'FMB') > 0) THEN 'Facebook Messenger Bot' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGL') > 0) THEN 'Google' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'GGN') > 0) THEN 'Google News' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'LIN') > 0) THEN 'Linked In' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NEW') > 0) THEN 'news.com.au' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'NWL') > 0) THEN 'Newsletter' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POD') > 0) THEN 'Podcasts' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'POR') > 0) THEN 'Newsletter Sports' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'RED') > 0) THEN 'Reddit' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SCP') > 0) THEN 'Supercoach Plus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'SEC') > 0) THEN 'Sectionals' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TCA') > 0) THEN 'True Crime Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TMP') > 0) THEN 'Tips Mrket Place' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWA') > 0) THEN 'The Weekend Aus' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'TWT') > 0) THEN 'Twitter' WHEN (STRPOS(SAFE.RIGHT(sold_in_source_code, 3), 'WID') > 0) THEN 'Widget' WHEN (STRPOS(sold_in_source_code, '_FBK') > 0) THEN 'Facebook' WHEN (STRPOS(sold_in_source_code, '_GGL') > 0) THEN 'Google' WHEN (STRPOS(sold_in_source_code, 'INS') > 0) THEN 'Instagram' WHEN (STRPOS(sold_in_source_code, '_LIN') > 0) THEN 'Linked In' WHEN (STRPOS(sold_in_source_code, '_RED') > 0) THEN 'Reddit' WHEN (STRPOS(sold_in_source_code, '_TWT') > 0) THEN 'Twitter' ELSE NULL END) IS NOT NULL AND (CASE WHEN (classification_level_2 IN ('Consumer', 'Gift Receiver')) THEN 'B2C' WHEN (classification_level_2 IN ('Campus', 'Corporate', 'Corporate excluding IP', 'Corporate IP', 'IP Access', 'SMB')) THEN 'B2B' ELSE 'Others' END) IN ('B2C', '') LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,30
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""5491badf-5ec0-4b4f-a427-b12a3a3395dd"",
    ""dashboard_name"": ""Programmatic / Tubi Performance FY25"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 17,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""financial_short_month"",
      ""financial_quarter"",
      ""financial_month"",
      ""relative_fy_month_offset"",
      ""revenue_category"",
      ""cost_model_type"",
      ""unified_publication_name"",
      ""revenue_group_subtype"",
      ""portfolio_conformed_name_sync""
    ],
    ""date_range_detected"": ""Current Financial Year (relative_fy_year_offset = 0) up to 18/06/2025"",
    ""hardcoded_dates_found"": [
      ""18/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'Guaranteed'"",
      ""'PMP'"",
      ""'Non-Guaranteed'"",
      ""'TUBI'"",
      ""'PERFORMANCE'"",
      ""'PROGRAMMATIC SOURCE'"",
      ""'PG'"",
      ""'OMP'"",
      ""'Y'"",
      ""'N'"",
      ""'Run of Audience Extension'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""revenue categories should use governed lookup tables"",
      ""cost model types should use governed lookup tables"",
      ""publication names should use governed lookup tables""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for business analysis, calculating all key metrics together.\n-- The hardcoded date '2025-06-18' has been retained as per original query logic but flagged for parameterization.\nWITH\n  base_data AS (\n    SELECT\n      t0.cost_model_type,\n      t0.financial_month,\n      t0.financial_quarter,\n      t0.financial_short_month,\n      t0.gross_revenue_amount,\n      t0.relative_fy_month_offset,\n      t0.relative_fy_year_offset,\n      t0.reporting_date,\n      t0.revenue_group_subtype,\n      t0.unified_publication_name,\n      t0.portfolio_conformed_name_sync -- Added from second query for completeness\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\n  ),\n  derived_flags_and_dims AS (\n    SELECT\n      cost_model_type,\n      financial_month,\n      financial_quarter,\n      financial_short_month,\n      gross_revenue_amount,\n      relative_fy_month_offset,\n      relative_fy_year_offset,\n      reporting_date,\n      revenue_group_subtype,\n      unified_publication_name,\n      portfolio_conformed_name_sync,\n      -- Hardcoded date from original query, consider replacing with CURRENT_DATE() or a parameter for dynamic reporting\n      DATE(TIMESTAMP '2025-06-18 03:06:41.434326+00', 'Australia/Sydney') AS dashboard_snapshot_date,\n      UPPER(cost_model_type) AS cost_model_type_upper,\n      SAFE_CAST(financial_month AS INT64) AS financial_month_int,\n      SAFE_CAST(financial_quarter AS INT64) AS financial_quarter_int,\n      (relative_fy_year_offset = 0) AS is_current_fy,\n      (reporting_date < DATE(TIMESTAMP '2025-06-18 03:06:41.434326+00', 'Australia/Sydney')) AS is_reporting_date_before_dashboard_date,\n      UPPER(revenue_group_subtype) AS revenue_group_subtype_upper,\n      (unified_publication_name = 'TUBI') AS is_tubi_publication,\n      (unified_publication_name = 'Run of Audience Extension') AS is_run_of_audience_extension,\n      CASE\n        WHEN (unified_publication_name = 'TUBI') THEN 'TUBI'\n        WHEN (UPPER(cost_model_type) = 'GUARANTEED') THEN 'PG'\n        WHEN (UPPER(cost_model_type) = 'NON-GUARANTEED') THEN 'OMP'\n        WHEN (UPPER(cost_model_type) = 'PMP') THEN 'PMP'\n        WHEN (unified_publication_name = 'Run of Audience Extension') THEN 'PERFORMANCE'\n        ELSE NULL\n      END AS revenue_category_dim\n    FROM\n      base_data\n  ),\n  intermediate_revenue_calcs AS (\n    SELECT\n      *,\n      CASE WHEN (revenue_group_subtype_upper = 'PROGRAMMATIC SOURCE') THEN gross_revenue_amount ELSE NULL END AS programmatic_source_revenue,\n      CASE WHEN (is_tubi_publication AND is_current_fy) THEN gross_revenue_amount ELSE 0 END AS tubi_current_fy_revenue_raw,\n      CASE WHEN (is_tubi_publication AND is_current_fy AND is_reporting_date_before_dashboard_date) THEN gross_revenue_amount ELSE 0 END AS tubi_current_fy_past_dashboard_date_revenue_raw,\n      CASE WHEN (is_run_of_audience_extension AND is_current_fy) THEN gross_revenue_amount ELSE NULL END AS performance_current_fy_revenue_raw,\n      CASE WHEN (is_run_of_audience_extension AND is_current_fy AND is_reporting_date_before_dashboard_date) THEN gross_revenue_amount ELSE NULL END AS performance_current_fy_past_dashboard_date_revenue_raw\n    FROM\n      derived_flags_and_dims\n  ),\n  final_revenue_bases AS (\n    SELECT\n      *,\n      CASE\n        WHEN (revenue_category_dim IN ('TUBI', 'PERFORMANCE')) THEN gross_revenue_amount\n        ELSE programmatic_source_revenue\n      END AS tubi_performance_or_programmatic_revenue_base\n    FROM\n      intermediate_revenue_calcs\n  )\nSELECT\n  financial_short_month,\n  financial_quarter_int AS financial_quarter,\n  revenue_category_dim AS revenue_category,\n  financial_month_int AS financial_month,\n  relative_fy_month_offset,\n  SUM(CASE WHEN cost_model_type = 'PMP' THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS pmp_current_fy_revenue_total,\n  SUM(performance_current_fy_past_dashboard_date_revenue_raw) AS performance_current_fy_past_dashboard_date_revenue_total,\n  SUM(CASE WHEN cost_model_type = 'Non-Guaranteed' THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS non_guaranteed_current_fy_revenue_total,\n  SUM(tubi_performance_or_programmatic_revenue_base) AS current_fy_tubi_performance_programmatic_revenue_total,\n  SUM(CASE WHEN is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total,\n  SUM(CASE WHEN cost_model_type = 'Non-Guaranteed' AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS non_guaranteed_past_dashboard_date_revenue_total,\n  SUM(tubi_current_fy_past_dashboard_date_revenue_raw) AS tubi_current_fy_past_dashboard_date_revenue_total,\n  SUM(CASE WHEN cost_model_type = 'Guaranteed' AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS guaranteed_past_dashboard_date_revenue_total,\n  SUM(performance_current_fy_revenue_raw) AS performance_current_fy_revenue_total,\n  SUM(CASE WHEN cost_model_type = 'Guaranteed' THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS guaranteed_current_fy_revenue_total,\n  SUM(tubi_current_fy_revenue_raw) AS tubi_current_fy_revenue_total,\n  SUM(CASE WHEN cost_model_type = 'PMP' AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END) AS pmp_past_dashboard_date_revenue_total\nFROM\n  final_revenue_bases\nWHERE\n  is_current_fy = TRUE -- Filter for current financial year\nGROUP BY\n  financial_short_month,\n  financial_quarter_int,\n  revenue_category_dim,\n  financial_month_int,\n  relative_fy_month_offset\nORDER BY\n  financial_month_int DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT reporting_date) as unique_reporting_dates,\n  COUNT(DISTINCT financial_month) as unique_financial_months,\n  COUNT(DISTINCT financial_quarter) as unique_financial_quarters,\n  COUNT(DISTINCT cost_model_type) as unique_cost_models,\n  COUNT(DISTINCT unified_publication_name) as unique_publications,\n  MIN(reporting_date) as earliest_reporting_date,\n  MAX(reporting_date) as latest_reporting_date,\n  MIN(financial_month) as earliest_financial_month,\n  MAX(financial_month) as latest_financial_month\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY);"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_positive_test,\n  CASE WHEN COUNT(DISTINCT unified_publication_name) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_publications_test,\n  CASE WHEN MAX(reporting_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as data_freshness_test,\n  CASE WHEN SUM(CASE WHEN relative_fy_year_offset = 0 THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_exists_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` \nWHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Current FY Filter (relative_fy_year_offset = 0)' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN 1 ELSE 0 END) as records_in_current_fy,\n  SAFE_DIVIDE(SUM(CASE WHEN relative_fy_year_offset = 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 as current_fy_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 365 DAY)\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'Reporting Date Before Dashboard Date (2025-06-18)' as rule_name,\n  COUNT(*) as total_records_in_scope,\n  SUM(CASE WHEN reporting_date < DATE('2025-06-18') THEN 1 ELSE 0 END) as records_before_dashboard_date,\n  SAFE_DIVIDE(SUM(CASE WHEN reporting_date < DATE('2025-06-18') THEN 1 ELSE 0 END), COUNT(*)) * 100 as before_dashboard_date_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE relative_fy_year_offset = 0;"",
    ""sample_data_sql"": ""SELECT \n  reporting_date,\n  financial_short_month,\n  financial_quarter,\n  financial_month,\n  cost_model_type,\n  unified_publication_name,\n  revenue_group_subtype,\n  portfolio_conformed_name_sync,\n  gross_revenue_amount,\n  relative_fy_month_offset,\n  relative_fy_year_offset\nFROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard`\nWHERE reporting_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nORDER BY reporting_date DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""18/06/2025"",
          ""original_format"": ""2025-06-18 03:06:41.434326+00"",
          ""context"": ""Used as a fixed snapshot date (clmn0_) to determine 'past dashboard date' calculations (clmn15_, clmn30_, clmn34_)."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE()` for dynamic 'as of today' reporting, or parameterize if a specific historical snapshot date is intended."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Guaranteed'"",
            ""'PMP'"",
            ""'Non-Guaranteed'""
          ],
          ""context"": ""Cost model types used in CASE statements for revenue segmentation (clmn1_, clmn11_)."",
          ""suggested_governance"": ""These values should be sourced from a `cost_model_type_lookup` reference table to ensure consistency and allow for future changes without code modification."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'TUBI'"",
            ""'PERFORMANCE'"",
            ""'PROGRAMMATIC SOURCE'"",
            ""'Run of Audience Extension'""
          ],
          ""context"": ""Unified publication names and revenue group subtypes used for classification and filtering (clmn10_, clmn16_, clmn17_, clmn18_, clmn23_)."",
          ""suggested_governance"": ""These should be managed in a `publication_name_lookup` or `revenue_group_lookup` table. This allows for centralized management of business categories."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PG'"",
            ""'OMP'""
          ],
          ""context"": ""Derived revenue category codes (clmn23_)."",
          ""suggested_governance"": ""These are internal codes derived from other hardcoded values. If these codes are used elsewhere, they should be part of a governed `revenue_category_lookup` table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Y'"",
            ""'N'""
          ],
          ""context"": ""Boolean flags derived from `unified_publication_name` (clmn18_, clmn22_)."",
          ""suggested_governance"": ""While simple, using boolean (TRUE/FALSE) directly is often cleaner than 'Y'/'N' strings. If 'Y'/'N' is a standard, ensure it's documented."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (e.g., '2025-06-18') with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)`)."",
      ""Replace hardcoded lookup values (e.g., 'Guaranteed', 'TUBI', 'PROGRAMMATIC SOURCE') with joins to governed reference tables for maintainability and consistency."",
      ""Consider externalizing complex CASE WHEN logic for revenue categorization into a configuration table or a UDF if it becomes more complex or needs frequent updates.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount recorded for each transaction or reporting line item."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Foundation for all revenue calculations in the dashboard."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls or zero values that might need handling.""
      ]
    },
    {
      ""metric_id"": ""financial_short_month"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Short name of the financial month (e.g., 'Jan', 'Feb'). Used for grouping and display."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for monthly performance tracking."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter number."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_quarter AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Higher-level time dimension for quarterly performance tracking."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""cast"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month number."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_month AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Detailed time dimension for monthly performance tracking, often used for ordering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_month_offset"",
      ""metric_name"": ""Relative FY Month Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial month relative to the start of the financial year. Used for ordering or relative period analysis."",
      ""sql_logic"": ""t0.relative_fy_month_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Supports relative time-based analysis within a financial year."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_category"",
      ""metric_name"": ""Revenue Category"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""cost_model_type"",
        ""unified_publication_name""
      ],
      ""business_description"": ""Categorization of revenue based on publication name and cost model type, used for high-level grouping."",
      ""sql_logic"": ""CASE WHEN (unified_publication_name = 'TUBI') THEN 'TUBI' WHEN (UPPER(cost_model_type) = 'GUARANTEED') THEN 'PG' WHEN (UPPER(cost_model_type) = 'NON-GUARANTEED') THEN 'OMP' WHEN (UPPER(cost_model_type) = 'PMP') THEN 'PMP' WHEN (unified_publication_name = 'Run of Audience Extension') THEN 'PERFORMANCE' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for segmenting revenue performance by strategic categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'PG'"",
        ""'OMP'"",
        ""'PMP'"",
        ""'PERFORMANCE'"",
        ""'GUARANTEED'"",
        ""'NON-GUARANTEED'"",
        ""'Run of Audience Extension'""
      ],
      ""governance_issues"": [
        ""Lookup values should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": [
        ""Null values if no category matches.""
      ]
    },
    {
      ""metric_id"": ""pmp_current_fy_revenue_total"",
      ""metric_name"": ""PMP Current FY Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for PMP (Programmatic Guaranteed) cost model type within the current financial year, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'PMP' AND is_current_fy THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""cost_model_type = 'PMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for PMP revenue contribution in the current fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PMP'""
      ],
      ""governance_issues"": [
        ""Hardcoded cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""performance_current_fy_past_dashboard_date_revenue_total"",
      ""metric_name"": ""Performance Current FY Past Dashboard Date Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_run_of_audience_extension"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date""
      ],
      ""business_description"": ""Total revenue for 'Run of Audience Extension' (Performance) within the current financial year, specifically for reporting dates before the dashboard's snapshot date."",
      ""sql_logic"": ""SUM(performance_current_fy_past_dashboard_date_revenue_raw)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""unified_publication_name = 'Run of Audience Extension'"",
        ""reporting_date < '2025-06-18'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical performance revenue up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Run of Audience Extension'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and publication name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""non_guaranteed_current_fy_revenue_total"",
      ""metric_name"": ""Non-Guaranteed Current FY Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for Non-Guaranteed cost model type within the current financial year, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'Non-Guaranteed' AND is_current_fy THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""cost_model_type = 'Non-Guaranteed'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for Non-Guaranteed revenue contribution in the current fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Non-Guaranteed'""
      ],
      ""governance_issues"": [
        ""Hardcoded cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_tubi_performance_programmatic_revenue_total"",
      ""metric_name"": ""Current FY Tubi/Performance/Programmatic Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_current_fy"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for 'TUBI', 'PERFORMANCE' (Run of Audience Extension), or 'PROGRAMMATIC SOURCE' categories within the current financial year."",
      ""sql_logic"": ""SUM(CASE WHEN is_current_fy THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""revenue_category IN ('TUBI', 'PERFORMANCE') OR revenue_group_subtype = 'PROGRAMMATIC SOURCE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Overall revenue performance for key programmatic and Tubi segments in the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'PERFORMANCE'"",
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""Hardcoded category values.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total"",
      ""metric_name"": ""Current FY Past Dashboard Date Tubi/Performance/Programmatic Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for 'TUBI', 'PERFORMANCE', or 'PROGRAMMATIC SOURCE' categories within the current financial year, specifically for reporting dates before the dashboard's snapshot date."",
      ""sql_logic"": ""SUM(CASE WHEN is_current_fy AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""revenue_category IN ('TUBI', 'PERFORMANCE') OR revenue_group_subtype = 'PROGRAMMATIC SOURCE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical revenue for key programmatic and Tubi segments up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'"",
        ""'PERFORMANCE'"",
        ""'PROGRAMMATIC SOURCE'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and category values.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""non_guaranteed_past_dashboard_date_revenue_total"",
      ""metric_name"": ""Non-Guaranteed Past Dashboard Date Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for Non-Guaranteed cost model type within the current financial year, specifically for reporting dates before the dashboard's snapshot date, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'Non-Guaranteed' AND is_current_fy AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'Non-Guaranteed'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical Non-Guaranteed revenue up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Non-Guaranteed'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""tubi_current_fy_past_dashboard_date_revenue_total"",
      ""metric_name"": ""Tubi Current FY Past Dashboard Date Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_tubi_publication"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date""
      ],
      ""business_description"": ""Total revenue for 'TUBI' within the current financial year, specifically for reporting dates before the dashboard's snapshot date."",
      ""sql_logic"": ""SUM(tubi_current_fy_past_dashboard_date_revenue_raw)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""unified_publication_name = 'TUBI'"",
        ""reporting_date < '2025-06-18'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical Tubi revenue up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and publication name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""guaranteed_past_dashboard_date_revenue_total"",
      ""metric_name"": ""Guaranteed Past Dashboard Date Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for Guaranteed cost model type within the current financial year, specifically for reporting dates before the dashboard's snapshot date, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'Guaranteed' AND is_current_fy AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'Guaranteed'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical Guaranteed revenue up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""performance_current_fy_revenue_total"",
      ""metric_name"": ""Performance Current FY Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_run_of_audience_extension"",
        ""is_current_fy""
      ],
      ""business_description"": ""Total revenue for 'Run of Audience Extension' (Performance) within the current financial year."",
      ""sql_logic"": ""SUM(performance_current_fy_revenue_raw)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""unified_publication_name = 'Run of Audience Extension'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for Performance revenue contribution in the current fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Run of Audience Extension'""
      ],
      ""governance_issues"": [
        ""Hardcoded publication name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""guaranteed_current_fy_revenue_total"",
      ""metric_name"": ""Guaranteed Current FY Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for Guaranteed cost model type within the current financial year, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'Guaranteed' AND is_current_fy THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""cost_model_type = 'Guaranteed'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for Guaranteed revenue contribution in the current fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Guaranteed'""
      ],
      ""governance_issues"": [
        ""Hardcoded cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""tubi_current_fy_revenue_total"",
      ""metric_name"": ""Tubi Current FY Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""is_tubi_publication"",
        ""is_current_fy""
      ],
      ""business_description"": ""Total revenue for 'TUBI' within the current financial year."",
      ""sql_logic"": ""SUM(tubi_current_fy_revenue_raw)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""unified_publication_name = 'TUBI'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key performance indicator for Tubi revenue contribution in the current fiscal period."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'""
      ],
      ""governance_issues"": [
        ""Hardcoded publication name.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""pmp_past_dashboard_date_revenue_total"",
      ""metric_name"": ""PMP Past Dashboard Date Revenue Total"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""cost_model_type"",
        ""is_current_fy"",
        ""is_reporting_date_before_dashboard_date"",
        ""tubi_performance_or_programmatic_revenue_base""
      ],
      ""business_description"": ""Total revenue for PMP cost model type within the current financial year, specifically for reporting dates before the dashboard's snapshot date, considering Tubi/Performance/Programmatic Source revenue."",
      ""sql_logic"": ""SUM(CASE WHEN cost_model_type = 'PMP' AND is_current_fy AND is_reporting_date_before_dashboard_date THEN tubi_performance_or_programmatic_revenue_base ELSE NULL END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset = 0"",
        ""reporting_date < '2025-06-18'"",
        ""cost_model_type = 'PMP'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Measures historical PMP revenue up to a specific point in time within the current fiscal year."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""18/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'PMP'""
      ],
      ""governance_issues"": [
        ""Hardcoded date and cost model type.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A conformed name for the portfolio, specifically filtered for 'TUBI' publication."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""
      ],
      ""filters_applied"": [
        ""unified_publication_name = 'TUBI'""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for filtering or grouping specific to the 'TUBI' publication, likely for a dropdown or filter in the dashboard."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TUBI'""
      ],
      ""governance_issues"": [
        ""Hardcoded filter value.""
      ],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_tubi_performance_programmatic_revenue_total"",
      ""related_metrics"": [
        ""pmp_current_fy_revenue_total"",
        ""non_guaranteed_current_fy_revenue_total"",
        ""guaranteed_current_fy_revenue_total""
      ],
      ""relationship_description"": ""The 'current_fy_tubi_performance_programmatic_revenue_total' represents the total revenue for specific categories in the current FY. The PMP, Non-Guaranteed, and Guaranteed current FY revenue totals are subsets of this total, filtered by their respective 'cost_model_type'."",
      ""mathematical_formula"": ""current_fy_tubi_performance_programmatic_revenue_total = SUM(pmp_current_fy_revenue_total + non_guaranteed_current_fy_revenue_total + guaranteed_current_fy_revenue_total + other_cost_model_types_revenue)"",
      ""business_validation"": ""Ensures that the sum of revenue by cost model type for the specified categories equals the overall total for those categories."",
      ""validation_sql"": ""SELECT SUM(pmp_current_fy_revenue_total) + SUM(non_guaranteed_current_fy_revenue_total) + SUM(guaranteed_current_fy_revenue_total) AS sum_of_cost_model_types, SUM(current_fy_tubi_performance_programmatic_revenue_total) AS overall_total FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""current_fy_tubi_performance_programmatic_revenue_total"",
      ""related_metrics"": [
        ""current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total""
      ],
      ""relationship_description"": ""The 'past dashboard date' metrics are a subset of their 'current FY' counterparts, specifically filtered to include only data reported before the hardcoded dashboard snapshot date (18/06/2025)."",
      ""mathematical_formula"": ""current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total <= current_fy_tubi_performance_programmatic_revenue_total"",
      ""business_validation"": ""Verifies that the 'past dashboard date' metrics accurately reflect a historical snapshot of the 'current FY' metrics."",
      ""validation_sql"": ""SELECT SUM(current_fy_past_dashboard_date_tubi_performance_programmatic_revenue_total) AS past_dashboard_total, SUM(current_fy_tubi_performance_programmatic_revenue_total) AS current_fy_total FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""tubi_current_fy_revenue_total"",
      ""related_metrics"": [
        ""tubi_current_fy_past_dashboard_date_revenue_total""
      ],
      ""relationship_description"": ""The 'tubi_current_fy_past_dashboard_date_revenue_total' is a subset of 'tubi_current_fy_revenue_total', filtered by the reporting date being before the dashboard snapshot date."",
      ""mathematical_formula"": ""tubi_current_fy_past_dashboard_date_revenue_total <= tubi_current_fy_revenue_total"",
      ""business_validation"": ""Confirms the correct application of the historical date filter for Tubi revenue."",
      ""validation_sql"": ""SELECT SUM(tubi_current_fy_past_dashboard_date_revenue_total) AS tubi_past_dashboard, SUM(tubi_current_fy_revenue_total) AS tubi_current_fy FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""performance_current_fy_revenue_total"",
      ""related_metrics"": [
        ""performance_current_fy_past_dashboard_date_revenue_total""
      ],
      ""relationship_description"": ""The 'performance_current_fy_past_dashboard_date_revenue_total' is a subset of 'performance_current_fy_revenue_total', filtered by the reporting date being before the dashboard snapshot date."",
      ""mathematical_formula"": ""performance_current_fy_past_dashboard_date_revenue_total <= performance_current_fy_revenue_total"",
      ""business_validation"": ""Confirms the correct application of the historical date filter for Performance revenue."",
      ""validation_sql"": ""SELECT SUM(performance_current_fy_past_dashboard_date_revenue_total) AS perf_past_dashboard, SUM(performance_current_fy_revenue_total) AS perf_current_fy FROM (/* primary_analysis_sql here */) WHERE financial_month IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,31
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""8956e94b-f6d1-46a3-9c7f-87a91fbe98b5"",
    ""dashboard_name"": ""LODs"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly;ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 11,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""financial_month"",
      ""financial_year"",
      ""sales_segment_l_2_name_sync"",
      ""revenue_type"",
      ""portfolio_group_name_sync"",
      ""GSD"",
      ""financial_quarter"",
      ""xtend_flag""
    ],
    ""date_range_detected"": ""Current FY, Previous FY, Next FY"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""-1"",
      ""0"",
      ""1"",
      ""'BILLED'"",
      ""'BOOKED'"",
      ""'ROP COMPOSITE'"",
      ""'MEDIUM RARE CONTENT AGENCY'"",
      ""'SUDDENLY%'"",
      ""'17114'"",
      ""'29172'"",
      ""'52809'"",
      ""'Digital Other'"",
      ""'Y'"",
      ""'XTEND'"",
      ""'MRCA'"",
      ""'Client'"",
      ""'CONSORTIUM NSW'"",
      ""'KEY ACCOUNTS NSW RETAIL'"",
      ""'DIRECT NSW'"",
      ""'INDEPENDENT AGENCIES NSW'"",
      ""'PRESTIGE'"",
      ""'Ian Paterson'"",
      ""'PLUTO'"",
      ""'VACANT'"",
      ""'XXX'""
    ],
    ""governance_opportunities"": [
      ""relative_fy_year_offset should be handled by a date dimension table or parameter"",
      ""revenue_transaction_status, style_name, source_publishing_division, sales_segment_l_2_name_sync, xtend_flag, revenue_type, source_system_code should use reference tables for lookup values"",
      ""publication_name and account_number logic could be managed via a configuration table"",
      ""Sales_Group and sales_segment_gm_name_sync derivations could be part of a governed business rule table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the SQL you will run for business analysis\nWITH SFCE_USER AS (\n    SELECT\n      TEMP1.network_user_name AS login_name,\n      TEMP1.user_name AS full_name\n    FROM\n      (\n        SELECT\n          UPPER(network_user_name) AS network_user_name,\n          UPPER(user_name) AS user_name,\n          ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n        FROM\n          `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n        WHERE\n          dw_source_system_code = 'SFCE'\n      ) AS TEMP1\n    WHERE\n      TEMP1.RN = 1\n  ),\n  base_data AS (\n    SELECT\n      unified_publication_name,\n      unified_publication_gl_code,\n      fy_year_month_number,\n      financial_year,\n      financial_quarter,\n      financial_month,\n      financial_short_month,\n      financial_week,\n      revenue_transaction_status,\n      is_print_digital_flag,\n      current_financial_month,\n      current_financial_week,\n      fy_year_week_number,\n      style_name,\n      UPPER(fin_adtype_name) AS fin_adtype_name,\n      CASE\n        WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA'\n        ELSE 'Client'\n      END AS Sales_Group,\n      EXTRACT(DAYOFWEEK FROM CURRENT_DATE()) AS DOW_Today,\n      sales_segment_l_1_name,\n      nca_industry_anzsic_pillar_group,\n      sales_segment_l_2_name,\n      sales_segment_l_1_name_sync,\n      sales_segment_l_2_name_sync,\n      fy_quarter_of_year_name,\n      relative_fy_year_offset,\n      relative_fy_quarter_offset,\n      relative_fy_month_offset,\n      relative_fy_week_offset,\n      advertiser_group,\n      advertiser_parent,\n      SUM(IFNULL(adjustment_amount, 0)) AS adjustment_amount,\n      sales_segment_gm_name,\n      CASE\n        WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson'\n        ELSE sales_segment_gm_name_sync\n      END AS sales_segment_gm_name_sync_derived,\n      revenue_group_level_1_name,\n      revenue_group_level_2_name,\n      SUM(IFNULL(pub_lgb, 0)) AS pub_lgb,\n      SUM(IFNULL(ss_lgb, 0)) AS ss_lgb,\n      SUM(IFNULL(pipeline, 0)) AS pipeline,\n      SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n      UPPER(revenue_type) AS revenue_type,\n      UPPER(revenue_group_subtype) AS revenue_group_subtype,\n      current_portfolio_group_owner_sync,\n      portfolio_group_name_sync,\n      portfolio_group_name_current,\n      portfolio_parent_group_name_sync,\n      nca_industry_pillar,\n      publishing_division_group,\n      publishing_division_parent,\n      is_future_period_flag,\n      ly_is_future_period_flag,\n      xtend_flag,\n      ny_is_future_period_flag,\n      cost_model_type,\n      CASE\n        WHEN source_system_code = 'PLUTO' THEN NULL\n        ELSE booking_line_created_date\n      END AS booking_line_created_date_derived,\n      advertiser_name,\n      current_portfolio_conformed_owner_sync,\n      portfolio_conformed_name_sync,\n      publishing_division,\n      booking_line_created_week,\n      booking_line_created_month,\n      booking_line_created_short_month,\n      booking_line_created_quarter,\n      booking_line_created_year,\n      agency_parent,\n      agency_group,\n      agency_name,\n      agency_number,\n      calendar_month_name,\n      calendar_year,\n      classification_name,\n      product_group,\n      SUM(IFNULL(target, 0)) AS target,\n      IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD_Name,\n      current_portfolio_conformed_owner_current,\n      current_portfolio_group_owner_current,\n      IFNULL(GSD_JOIN_CURR.full_name, 'VACANT') AS current_portfolio_group_owner_full,\n      IFNULL(GSD_JOIN_CONFORM.full_name, 'VACANT') AS current_portfolio_conformed_owner_full\n    FROM\n      `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN\n      ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN_CURR\n      ON UPPER(current_portfolio_group_owner_current) = GSD_JOIN_CURR.login_name\n      LEFT JOIN\n      SFCE_USER AS GSD_JOIN_CONFORM\n      ON UPPER(current_portfolio_conformed_owner_current) = GSD_JOIN_CONFORM.login_name\n    WHERE\n      relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE' AND UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY' AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n    GROUP BY ALL -- Group by all non-aggregated columns\n  )\nSELECT\n  financial_year,\n  financial_month,\n  financial_short_month,\n  financial_quarter,\n  sales_segment_l_2_name_sync,\n  portfolio_group_name_sync,\n  GSD_Name,\n  CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END AS Revenue_Type_or_XTEND,\n  SAFE_CAST(financial_quarter AS FLOAT64) AS Financial_Quarter_Float,\n  SUM(gross_revenue_amount) AS Total_Gross_Revenue_Amount,\n  SUM(pipeline) AS Total_Pipeline_Amount,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS Current_FY_Gross_Revenue,\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS Current_FY_Pipeline,\n  MAX(sales_segment_l_2_name_sync = 'Digital Other') AS Is_Digital_Other_Sales_Segment_Flag,\n  SUM(adjustment_amount) AS Total_Adjustment_Amount,\n  SUM(pub_lgb) AS Total_Pub_LGB,\n  SUM(ss_lgb) AS Total_SS_LGB,\n  SUM(target) AS Total_Target,\n  Sales_Group,\n  sales_segment_gm_name_sync_derived,\n  DOW_Today\nFROM\n  base_data\nGROUP BY\n  financial_year,\n  financial_month,\n  financial_short_month,\n  financial_quarter,\n  sales_segment_l_2_name_sync,\n  portfolio_group_name_sync,\n  GSD_Name,\n  Revenue_Type_or_XTEND,\n  Financial_Quarter_Float,\n  Sales_Group,\n  sales_segment_gm_name_sync_derived,\n  DOW_Today\nORDER BY\n  financial_year DESC, financial_month DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT financial_month) as unique_financial_months,\n  COUNT(DISTINCT financial_week) as unique_financial_weeks,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  COUNT(DISTINCT portfolio_group_name_sync) as unique_portfolio_groups,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year,\n  MIN(financial_month) as earliest_financial_month,\n  MAX(financial_month) as latest_financial_month,\n  APPROX_COUNT_DISTINCT(CONCAT(financial_year, '-', financial_month, '-', financial_week, '-', sales_segment_l_2_name_sync, '-', portfolio_group_name_sync)) as approx_unique_grain_combinations\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n  AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'\n  AND UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n  AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809'));"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_check,\n  CASE WHEN SUM(pipeline) > 0 THEN 'PASS' ELSE 'FAIL' END as total_pipeline_check,\n  CASE WHEN MAX(financial_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 THEN 'PASS' ELSE 'FAIL' END as freshness_check,\n  CASE WHEN COUNT(DISTINCT GSD_Name) > 1 THEN 'PASS' ELSE 'FAIL' END as multiple_gsd_check\nFROM (\n  WITH SFCE_USER AS (\n    SELECT\n      TEMP1.network_user_name AS login_name,\n      TEMP1.user_name AS full_name\n    FROM\n      (\n        SELECT\n          UPPER(network_user_name) AS network_user_name,\n          UPPER(user_name) AS user_name,\n          ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) AS RN\n        FROM\n          `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim\n        WHERE\n          dw_source_system_code = 'SFCE'\n      ) AS TEMP1\n    WHERE\n      TEMP1.RN = 1\n  )\n  SELECT\n    SUM(IFNULL(gross_revenue_amount, 0)) AS gross_revenue_amount,\n    SUM(IFNULL(pipeline, 0)) AS pipeline,\n    financial_year,\n    IFNULL(GSD_JOIN.full_name, 'VACANT') AS GSD_Name\n  FROM\n    `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\n    LEFT JOIN SFCE_USER AS GSD_JOIN ON UPPER(current_portfolio_group_owner_sync) = GSD_JOIN.login_name\n  WHERE\n    relative_fy_year_offset IN (-1, 0, 1)\n    AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n    AND UPPER(IFNULL(style_name, 'XXX')) <> 'ROP COMPOSITE'\n    AND UPPER(IFNULL(source_publishing_division, 'XXX')) <> 'MEDIUM RARE CONTENT AGENCY'\n    AND (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809')))\n  GROUP BY\n    financial_year, GSD_Name\n)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Relative FY Year Offset Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN relative_fy_year_offset IN (-1, 0, 1) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN relative_fy_year_offset IN (-1, 0, 1) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  financial_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Look at a broader range to validate filter\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  financial_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Publication Name Exclusion Logic' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809'))) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (UPPER(IFNULL(publication_name, 'XXX')) NOT LIKE 'SUDDENLY%' OR (UPPER(publication_name) LIKE 'SUDDENLY%' AND account_number IN ('17114', '29172', '52809'))) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  financial_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2;"",
    ""sample_data_sql"": ""SELECT \n  financial_year,\n  financial_month,\n  financial_week,\n  sales_segment_l_2_name_sync,\n  portfolio_group_name_sync,\n  revenue_type,\n  xtend_flag,\n  gross_revenue_amount,\n  pipeline,\n  relative_fy_year_offset,\n  revenue_transaction_status,\n  style_name,\n  source_publishing_division,\n  publication_name,\n  account_number,\n  current_portfolio_group_owner_sync,\n  current_portfolio_conformed_owner_sync,\n  current_portfolio_group_owner_current,\n  current_portfolio_conformed_owner_current,\n  sales_segment_gm_name_sync\nFROM\n  `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly`\nWHERE\n  relative_fy_year_offset IN (-1, 0, 1)\n  AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED')\n  AND gross_revenue_amount IS NOT NULL\nORDER BY\n  financial_year DESC, financial_month DESC, gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""-1"",
            ""0"",
            ""1""
          ],
          ""context"": ""relative_fy_year_offset filter for fiscal years"",
          ""suggested_governance"": ""Use a date dimension table with relative fiscal year flags or parameterize the offset."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'BILLED'"",
            ""'BOOKED'""
          ],
          ""context"": ""revenue_transaction_status filter"",
          ""suggested_governance"": ""Join to a `revenue_transaction_status_lookup` table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'ROP COMPOSITE'""
          ],
          ""context"": ""style_name exclusion filter"",
          ""suggested_governance"": ""Manage excluded style names in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'MEDIUM RARE CONTENT AGENCY'""
          ],
          ""context"": ""source_publishing_division exclusion filter"",
          ""suggested_governance"": ""Manage excluded publishing divisions in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'SUDDENLY%'"",
            ""'17114'"",
            ""'29172'"",
            ""'52809'""
          ],
          ""context"": ""Complex publication_name and account_number logic"",
          ""suggested_governance"": ""Externalize this logic into a configuration table or a dedicated view."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Digital Other'""
          ],
          ""context"": ""sales_segment_l_2_name_sync for 'Is Digital Other Sales Segment' metric"",
          ""suggested_governance"": ""Use a sales segment dimension table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Y'"",
            ""'XTEND'""
          ],
          ""context"": ""xtend_flag for 'Revenue Type or XTEND' metric"",
          ""suggested_governance"": ""Define XTEND flag values in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'MRCA'"",
            ""'Client'""
          ],
          ""context"": ""sales_segment_l_2_name_sync for 'Sales Group' derivation"",
          ""suggested_governance"": ""Define sales group mappings in a configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'CONSORTIUM NSW'"",
            ""'KEY ACCOUNTS NSW RETAIL'"",
            ""'DIRECT NSW'"",
            ""'INDEPENDENT AGENCIES NSW'"",
            ""'PRESTIGE'"",
            ""'Ian Paterson'""
          ],
          ""context"": ""sales_segment_l_2_name_sync for 'sales_segment_gm_name_sync_derived' derivation"",
          ""suggested_governance"": ""Define GM assignments in a configuration table or a dedicated mapping table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'PLUTO'""
          ],
          ""context"": ""source_system_code for booking_line_created_date derivation"",
          ""suggested_governance"": ""Manage source system codes in a lookup table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""'VACANT'""
          ],
          ""context"": ""Default value for GSD names when null"",
          ""suggested_governance"": ""Standardize default values in a configuration table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [
            ""'XXX'""
          ],
          ""context"": ""Default value for IFNULL checks in WHERE clauses"",
          ""suggested_governance"": ""This is a common pattern for `IFNULL` in BigQuery, but consider if `COALESCE` with a more meaningful default or direct `IS NULL` checks are better."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded relative fiscal year offsets with dynamic date calculations or parameters."",
      ""Replace hardcoded lookup values (e.g., 'BILLED', 'Digital Other', 'MRCA', 'Ian Paterson') with joins to governed reference tables or configuration tables."",
      ""Use configuration tables for complex business rules like publication name exclusions and sales segment GM assignments instead of hardcoded logic in SQL.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount recorded for a given period."",
      ""sql_logic"": ""SUM(IFNULL(gross_revenue_amount, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for sales performance tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""pipeline_amount"",
      ""metric_name"": ""Pipeline Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total pipeline amount, representing potential future revenue."",
      ""sql_logic"": ""SUM(IFNULL(pipeline, 0))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for sales forecasting and pipeline management."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential nulls handled by IFNULL(..., 0)""
      ]
    },
    {
      ""metric_id"": ""current_fy_gross_revenue"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Gross revenue amount specifically for the current fiscal year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for current period performance analysis, often compared to targets or previous periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""relative_fy_year_offset should be handled by a date dimension table or parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_pipeline"",
      ""metric_name"": ""Current FY Pipeline"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""pipeline_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Pipeline amount specifically for the current fiscal year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for current period sales forecasting and pipeline health."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [
        ""relative_fy_year_offset should be handled by a date dimension table or parameter""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment_flag"",
      ""metric_name"": ""Is Digital Other Sales Segment Flag"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""A flag indicating if the sales segment is 'Digital Other'. Aggregated as MAX to show if any record in the group matches."",
      ""sql_logic"": ""MAX(sales_segment_l_2_name_sync = 'Digital Other')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used for segmenting revenue by specific sales channels."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""Sales segment value should be managed in a lookup table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_or_xtend"",
      ""metric_name"": ""Revenue Type or XTEND"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""xtend_flag"",
        ""revenue_type""
      ],
      ""business_description"": ""Categorizes revenue as 'XTEND' if the xtend_flag is 'Y', otherwise uses the original revenue_type."",
      ""sql_logic"": ""CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for detailed revenue categorization and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Y'"",
        ""'XTEND'""
      ],
      ""governance_issues"": [
        ""XTEND flag and value should be managed in lookup tables.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_float"",
      ""metric_name"": ""Financial Quarter (Float)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_quarter""
      ],
      ""business_description"": ""The financial quarter, cast to a float64. Likely used for numerical sorting or specific visualization needs."",
      ""sql_logic"": ""SAFE_CAST(financial_quarter AS FLOAT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Primarily for data formatting or specific chart types in Looker Studio."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gsd_name"",
      ""metric_name"": ""GSD Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""current_portfolio_group_owner_sync"",
        ""v_user_dim""
      ],
      ""business_description"": ""The full name of the GSD (Group Sales Director) based on the current portfolio group owner, defaulting to 'VACANT' if not found."",
      ""sql_logic"": ""IFNULL(GSD_JOIN.full_name, 'VACANT')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly"",
        ""ncau-data-newsquery-prd.prstn_advertising_views.v_user_dim""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for sales performance analysis by GSD."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'VACANT'""
      ],
      ""governance_issues"": [
        ""Default 'VACANT' should be standardized.""
      ],
      ""data_quality_concerns"": [
        ""Dependency on external user dimension table.""
      ]
    },
    {
      ""metric_id"": ""sales_group"",
      ""metric_name"": ""Sales Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""Categorizes sales into 'MRCA' or 'Client' based on the sales segment L2 name."",
      ""sql_logic"": ""CASE WHEN sales_segment_l_2_name_sync = 'MRCA' THEN 'MRCA' ELSE 'Client' END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level sales segment reporting."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'MRCA'"",
        ""'Client'""
      ],
      ""governance_issues"": [
        ""Sales group mapping should be externalized to a configuration table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_gm_name_derived"",
      ""metric_name"": ""Sales Segment GM Name (Derived)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync"",
        ""sales_segment_gm_name_sync""
      ],
      ""business_description"": ""Assigns 'Ian Paterson' as the GM for specific NSW sales segments, otherwise uses the synced GM name."",
      ""sql_logic"": ""CASE WHEN upper(sales_segment_l_2_name_sync) IN ('CONSORTIUM NSW', 'KEY ACCOUNTS NSW RETAIL', 'DIRECT NSW', 'INDEPENDENT AGENCIES NSW', 'PRESTIGE') THEN 'Ian Paterson' ELSE sales_segment_gm_name_sync END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [
        ""relative_fy_year_offset IN (-1, 0, 1)"",
        ""revenue_transaction_status IN ('BILLED', 'BOOKED')"",
        ""style_name <> 'ROP COMPOSITE'"",
        ""source_publishing_division <> 'MEDIUM RARE CONTENT AGENCY'"",
        ""publication_name filter""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting sales performance by specific General Managers."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CONSORTIUM NSW'"",
        ""'KEY ACCOUNTS NSW RETAIL'"",
        ""'DIRECT NSW'"",
        ""'INDEPENDENT AGENCIES NSW'"",
        ""'PRESTIGE'"",
        ""'Ian Paterson'""
      ],
      ""governance_issues"": [
        ""GM assignment rules should be externalized to a configuration table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""dow_today"",
      ""metric_name"": ""Day of Week Today"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""none"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The day of the week for the current date (1=Sunday, 7=Saturday)."",
      ""sql_logic"": ""EXTRACT(DAYOFWEEK FROM CURRENT_DATE())"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Potentially used for dynamic filtering or display based on the current day."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_gross_revenue"",
      ""related_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current FY Gross Revenue is a conditional sum of Gross Revenue Amount, filtered by relative_fy_year_offset = 0."",
      ""mathematical_formula"": ""SUM(IF(relative_fy_year_offset = 0, gross_revenue_amount, 0))"",
      ""business_validation"": ""Ensures that only revenue from the current fiscal year contributes to this metric."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_fy_gross_revenue_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""current_fy_pipeline"",
      ""related_metrics"": [
        ""pipeline_amount"",
        ""relative_fy_year_offset""
      ],
      ""relationship_description"": ""Current FY Pipeline is a conditional sum of Pipeline Amount, filtered by relative_fy_year_offset = 0."",
      ""mathematical_formula"": ""SUM(IF(relative_fy_year_offset = 0, pipeline, 0))"",
      ""business_validation"": ""Ensures that only pipeline from the current fiscal year contributes to this metric."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN relative_fy_year_offset = 0 THEN pipeline ELSE 0 END) AS current_fy_pipeline_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE relative_fy_year_offset IN (-1, 0, 1) AND UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""is_digital_other_sales_segment_flag"",
      ""related_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""relationship_description"": ""Flag is true if sales_segment_l_2_name_sync is 'Digital Other'."",
      ""mathematical_formula"": ""MAX(sales_segment_l_2_name_sync = 'Digital Other')"",
      ""business_validation"": ""Identifies records belonging to the 'Digital Other' sales segment for specific analysis."",
      ""validation_sql"": ""SELECT MAX(sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` WHERE sales_segment_l_2_name_sync = 'Digital Other' LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_type_or_xtend"",
      ""related_metrics"": [
        ""xtend_flag"",
        ""revenue_type""
      ],
      ""relationship_description"": ""Derives a unified revenue type based on xtend_flag."",
      ""mathematical_formula"": ""CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END"",
      ""business_validation"": ""Provides a consolidated view of revenue types, highlighting XTEND revenue."",
      ""validation_sql"": ""SELECT DISTINCT CASE WHEN xtend_flag = 'Y' THEN 'XTEND' ELSE revenue_type END AS revenue_type_or_xtend_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""gsd_name"",
      ""related_metrics"": [
        ""current_portfolio_group_owner_sync"",
        ""v_user_dim""
      ],
      ""relationship_description"": ""GSD name is looked up from a user dimension table based on the portfolio owner, defaulting to 'VACANT'."",
      ""mathematical_formula"": ""IFNULL(GSD_JOIN.full_name, 'VACANT')"",
      ""business_validation"": ""Ensures GSD names are always present for reporting, even if the lookup fails."",
      ""validation_sql"": ""WITH SFCE_USER AS (SELECT UPPER(network_user_name) AS login_name, UPPER(user_name) AS full_name FROM `ncau-data-newsquery-prd`.prstn_advertising_views.v_user_dim WHERE dw_source_system_code = 'SFCE' QUALIFY ROW_NUMBER() OVER (PARTITION BY UPPER(network_user_name)) = 1) SELECT T1.current_portfolio_group_owner_sync, IFNULL(T2.full_name, 'VACANT') AS gsd_name_check FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` AS T1 LEFT JOIN SFCE_USER AS T2 ON UPPER(T1.current_portfolio_group_owner_sync) = T2.login_name LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_revenue_amount"",
      ""related_metrics"": [
        ""pipeline_amount"",
        ""current_fy_gross_revenue"",
        ""current_fy_pipeline""
      ],
      ""relationship_description"": ""All revenue and pipeline metrics are filtered by specific fiscal years, transaction statuses, style names, publishing divisions, and publication names."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that only relevant and valid revenue data is included in the analysis, excluding certain types of transactions or publications."",
      ""validation_sql"": ""SELECT COUNT(*) AS total_records, SUM(CASE WHEN relative_fy_year_offset IN (-1, 0, 1) THEN 1 ELSE 0 END) AS records_in_fy_range, SUM(CASE WHEN UPPER(IFNULL(revenue_transaction_status, 'XXX')) IN ('BILLED', 'BOOKED') THEN 1 ELSE 0 END) AS records_billed_booked FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client_weekly` LIMIT 1"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,32
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6de90f2a-b3f3-46fe-a4fe-13474b2d6618"",
    ""dashboard_name"": ""PACMAN AND EXCLUDE LOD"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4;ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 4,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""Margin_Level"",
      ""Category"",
      ""Product_L1"",
      ""Product_L2"",
      ""Product_L3"",
      ""Product_L4"",
      ""Product_Name"",
      ""Fiscal_Year""
    ],
    ""date_range_detected"": ""2025"",
    ""hardcoded_dates_found"": [
      ""2025""
    ],
    ""hardcoded_values_found"": [
      ""'Category'"",
      ""'Product_Name'"",
      ""'Product_L1'"",
      ""'Product_L2'"",
      ""'Product_L3'"",
      ""'Product_L4'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""dynamic dimension selection should be handled via Looker Studio parameters, not hardcoded CASE logic""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query attempts to consolidate metrics from both primary data sources.\n-- Note: Dimensions from different sources may not fully align, leading to NULLs for non-applicable metrics.\n-- The 'Product_L3' dimension is used as a common join key where possible.\n\nWITH\n  exclude_lod_data AS (\n    SELECT\n      t0.Margin_Level AS margin_level,\n      CASE\n        WHEN ('Category' = 'Category')\n        THEN t0.Category\n        WHEN ('Category' = 'Product_Name')\n        THEN t0.Product_Name\n        WHEN ('Category' = 'Product_L1')\n        THEN t0.Product_L1\n        WHEN ('Category' = 'Product_L2')\n        THEN t0.Product_L2\n        WHEN ('Category' = 'Product_L3')\n        THEN t0.Product_L3\n        WHEN ('Category' = 'Product_L4')\n        THEN t0.Product_L4\n        ELSE t0.Category\n      END AS selected_category_dimension,\n      t0.Product_L1 AS product_l1,\n      t0.Product_L2 AS product_l2,\n      t0.Product_L3 AS product_l3,\n      t0.Product_L4 AS product_l4,\n      t0.Product_Name AS product_name,\n      SUM(t0.Product_Revenue) AS total_product_revenue_exclude_lod,\n      SUM(t0.Product_Revenue_Merged_OneRow) AS total_merged_product_revenue_exclude_lod\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\n    GROUP BY\n      1, 2, 3, 4, 5, 6, 7\n  ),\n  pacman_data AS (\n    SELECT\n      t0.Fiscal_Year AS fiscal_year,\n      t0.Product_L3 AS product_l3,\n      SUM(t0.Product_Revenue) AS total_pacman_product_revenue,\n      SUM(t0.Fiscal_Year) AS total_fiscal_year_volume_pacman -- Note: Summing Fiscal_Year is unusual, interpreted literally.\n    FROM\n      `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\n    WHERE\n      t0.Fiscal_Year = 2025 -- Hardcoded year, should be parameterized\n    GROUP BY\n      1, 2\n  )\nSELECT\n  COALESCE(eld.product_l3, pd.product_l3) AS product_l3,\n  eld.margin_level,\n  eld.selected_category_dimension,\n  eld.product_l1,\n  eld.product_l2,\n  eld.product_l4,\n  eld.product_name,\n  pd.fiscal_year,\n  eld.total_product_revenue_exclude_lod,\n  eld.total_merged_product_revenue_exclude_lod,\n  pd.total_pacman_product_revenue,\n  pd.total_fiscal_year_volume_pacman\nFROM\n  exclude_lod_data AS eld\nFULL OUTER JOIN\n  pacman_data AS pd\n  ON eld.product_l3 = pd.product_l3\nORDER BY\n  product_l3, fiscal_year\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'dv_exclude_product_l3_and_l4' AS table_name,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT Margin_Level) AS unique_margin_levels,\n  COUNT(DISTINCT Category) AS unique_categories,\n  COUNT(DISTINCT Product_L1) AS unique_product_l1s,\n  COUNT(DISTINCT Product_L2) AS unique_product_l2s,\n  COUNT(DISTINCT Product_L3) AS unique_product_l3s,\n  COUNT(DISTINCT Product_L4) AS unique_product_l4s,\n  COUNT(DISTINCT Product_Name) AS unique_product_names,\n  MIN(Product_Revenue) AS min_product_revenue,\n  MAX(Product_Revenue) AS max_product_revenue\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4`\nUNION ALL\nSELECT\n  'dv_pacman_running_expense' AS table_name,\n  COUNT(*) AS total_records,\n  NULL AS unique_margin_levels,\n  NULL AS unique_categories,\n  NULL AS unique_product_l1s,\n  NULL AS unique_product_l2s,\n  COUNT(DISTINCT Product_L3) AS unique_product_l3s,\n  NULL AS unique_product_l4s,\n  NULL AS unique_product_names,\n  MIN(Product_Revenue) AS min_product_revenue,\n  MAX(Product_Revenue) AS max_product_revenue\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense`\nLIMIT 100;"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN SUM(t0.Product_Revenue) > 0\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS exclude_lod_revenue_test,\n  CASE\n    WHEN SUM(t0.Product_Revenue_Merged_OneRow) > 0\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS exclude_lod_merged_revenue_test\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` AS t0\nUNION ALL\nSELECT\n  'Validation Check' AS test_type,\n  CASE\n    WHEN SUM(t0.Product_Revenue) > 0\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS pacman_revenue_test,\n  CASE\n    WHEN SUM(t0.Fiscal_Year) > 0\n    THEN 'PASS'\n    ELSE 'FAIL'\n  END AS pacman_fiscal_year_sum_test\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense` AS t0\nWHERE\n  t0.Fiscal_Year = 2025\nLIMIT 10;"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Hardcoded Fiscal Year 2025 Filter' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(\n    CASE\n      WHEN Fiscal_Year = 2025\n      THEN 1\n      ELSE 0\n    END\n  ) AS records_passing_rule,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN Fiscal_Year = 2025\n        THEN 1\n        ELSE 0\n      END\n    ),\n    COUNT(*)\n  ) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense`\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Dynamic Dimension Selection Logic (Hardcoded to Category)' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(\n    CASE\n      WHEN (\n        CASE\n          WHEN ('Category' = 'Category')\n          THEN Category\n          WHEN ('Category' = 'Product_Name')\n          THEN Product_Name\n          WHEN ('Category' = 'Product_L1')\n          THEN Product_L1\n          WHEN ('Category' = 'Product_L2')\n          THEN Product_L2\n          WHEN ('Category' = 'Product_L3')\n          THEN Product_L3\n          WHEN ('Category' = 'Product_L4')\n          THEN Product_L4\n          ELSE Category\n        END\n      ) IS NOT NULL\n      THEN 1\n      ELSE 0\n    END\n  ) AS records_passing_rule,\n  SAFE_DIVIDE(\n    SUM(\n      CASE\n        WHEN (\n          CASE\n            WHEN ('Category' = 'Category')\n            THEN Category\n            WHEN ('Category' = 'Product_Name')\n            THEN Product_Name\n            WHEN ('Category' = 'Product_L1')\n            THEN Product_L1\n            WHEN ('Category' = 'Product_L2')\n            THEN Product_L2\n            WHEN ('Category' = 'Product_L3')\n            THEN Product_L3\n            WHEN ('Category' = 'Product_L4')\n            THEN Product_L4\n            ELSE Category\n          END\n        )\n        IS NOT NULL\n      THEN 1\n      ELSE 0\n    END\n  ),\n  COUNT(*)\n  ) * 100 AS pass_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4`\nLIMIT 10;"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  'dv_exclude_product_l3_and_l4' AS source_table,\n  Margin_Level,\n  Category,\n  Product_L1,\n  Product_L2,\n  Product_L3,\n  Product_L4,\n  Product_Name,\n  Product_Revenue,\n  Product_Revenue_Merged_OneRow,\n  NULL AS Fiscal_Year\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4`\nWHERE\n  Product_Revenue IS NOT NULL\nLIMIT 50\nUNION ALL\nSELECT\n  'dv_pacman_running_expense' AS source_table,\n  NULL AS Margin_Level,\n  NULL AS Category,\n  NULL AS Product_L1,\n  NULL AS Product_L2,\n  Product_L3,\n  NULL AS Product_L4,\n  NULL AS Product_Name,\n  Product_Revenue,\n  NULL AS Product_Revenue_Merged_OneRow,\n  Fiscal_Year\nFROM\n  `ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense`\nWHERE\n  Fiscal_Year = 2025 -- Sample for the hardcoded year\n  AND Product_Revenue IS NOT NULL\nLIMIT 50;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""used as a filter for Fiscal_Year in dv_pacman_running_expense queries"",
          ""suggested_fix"": ""replace with a Looker Studio date parameter or CURRENT_DATE() + INTERVAL X YEAR for future-proofing"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Category'"",
            ""'Product_Name'"",
            ""'Product_L1'"",
            ""'Product_L2'"",
            ""'Product_L3'"",
            ""'Product_L4'""
          ],
          ""context"": ""string literals used in CASE statement to select a dimension. The condition `('Category' = 'Category')` is always true, making the dynamic selection static in this query."",
          ""suggested_governance"": ""Ensure Looker Studio's parameterization correctly injects the selected dimension name, rather than relying on a hardcoded comparison that defaults to one option. If dynamic dimension selection is intended, the SQL should reflect the parameter's value directly."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal year '2025' with a Looker Studio date parameter (e.g., `_DS_FISCAL_YEAR`) to allow dynamic year selection."",
      ""Review the dynamic dimension selection logic in `dv_exclude_product_l3_and_l4` to ensure it correctly uses Looker Studio parameters for dimension switching, rather than the current static `CASE` statement.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""margin_level_dimension"",
      ""metric_name"": ""Margin Level"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The margin level associated with a product or revenue entry, used for grouping and analysis."",
      ""sql_logic"": ""t0.Margin_Level"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for financial reporting and profitability analysis."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""selected_category_dimension"",
      ""metric_name"": ""Selected Category/Product Dimension"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""category_dimension"",
        ""product_name_dimension"",
        ""product_l1_dimension"",
        ""product_l2_dimension"",
        ""product_l3_dimension"",
        ""product_l4_dimension""
      ],
      ""business_description"": ""A dynamic dimension that allows selection between Category, Product Name, or various Product Levels (L1-L4). In the provided query, it defaults to 'Category' due to hardcoded logic."",
      ""sql_logic"": ""CASE WHEN ('Category' = 'Category') THEN t0.Category WHEN ('Category' = 'Product_Name') THEN t0.Product_Name WHEN ('Category' = 'Product_L1') THEN t0.Product_L1 WHEN ('Category' = 'Product_L2') THEN t0.Product_L2 WHEN ('Category' = 'Product_L3') THEN t0.Product_L3 WHEN ('Category' = 'Product_L4') THEN t0.Product_L4 ELSE t0.Category END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides flexibility in analyzing revenue data across different product hierarchies or categories."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Category'"",
        ""'Product_Name'"",
        ""'Product_L1'"",
        ""'Product_L2'"",
        ""'Product_L3'"",
        ""'Product_L4'""
      ],
      ""governance_issues"": [
        ""The CASE statement uses hardcoded string comparisons that make the dynamic selection static in this specific query. This should be driven by a Looker Studio parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""product_l3_dimension"",
      ""metric_name"": ""Product Level 3"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The third level of product hierarchy, used for grouping and analysis."",
      ""sql_logic"": ""t0.Product_L3"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4"",
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A common dimension across different financial datasets, enabling cross-analysis of product performance."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fiscal_year_dimension"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year associated with financial data."",
      ""sql_logic"": ""t0.Fiscal_Year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [
        ""Fiscal_Year = 2025""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for time-based financial reporting and analysis of expenses and revenues."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""yearly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded year '2025' should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_product_revenue_exclude_lod"",
      ""metric_name"": ""Total Product Revenue (Exclude LOD)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of product revenue from the 'exclude LOD' dataset, likely representing revenue after certain levels of detail have been excluded or consolidated."",
      ""sql_logic"": ""SUM(t0.Product_Revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for financial performance analysis, potentially adjusted for specific reporting requirements."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_merged_product_revenue_exclude_lod"",
      ""metric_name"": ""Total Merged Product Revenue (Exclude LOD)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of product revenue from the 'exclude LOD' dataset, specifically from a column indicating revenue that has been merged or consolidated into a single row."",
      ""sql_logic"": ""SUM(t0.Product_Revenue_Merged_OneRow)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""An alternative or adjusted revenue metric, possibly used for specific reconciliation or reporting purposes where revenue is consolidated."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_pacman_product_revenue"",
      ""metric_name"": ""Total PACMAN Product Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of product revenue specifically from the 'PACMAN running expense' dataset for the fiscal year 2025."",
      ""sql_logic"": ""SUM(t0.Product_Revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [
        ""Fiscal_Year = 2025""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key revenue metric within the PACMAN project context, used for tracking financial performance against expenses or targets."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""yearly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded year '2025' should be parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_fiscal_year_volume_pacman"",
      ""metric_name"": ""Total Fiscal Year Volume (PACMAN)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of the Fiscal_Year column itself, grouped by Product_L3. This is an unusual calculation; it likely represents a count of records or a proxy for volume associated with each fiscal year, rather than a meaningful sum of the year number."",
      ""sql_logic"": ""SUM(t0.Fiscal_Year)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_pacman_running_expense""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Potentially used to understand the distribution or volume of data points per fiscal year within product level 3, but the direct sum of the year number is not a standard business metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""yearly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""The calculation `SUM(Fiscal_Year)` is highly unusual and likely unintended. It should probably be `COUNT(*)` or `COUNT(DISTINCT Fiscal_Year)` to represent volume or distinct years.""
      ],
      ""data_quality_concerns"": [
        ""The metric's interpretation is ambiguous due to the unusual SUM aggregation on a year column.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_product_revenue_exclude_lod"",
      ""related_metrics"": [
        ""margin_level_dimension"",
        ""selected_category_dimension""
      ],
      ""relationship_description"": ""Total Product Revenue (Exclude LOD) is aggregated by Margin Level and a dynamically selected category/product dimension."",
      ""mathematical_formula"": ""SUM(Product_Revenue) GROUP BY Margin_Level, Selected_Category_Dimension"",
      ""business_validation"": ""This relationship allows analysis of revenue performance across different margin tiers and product groupings."",
      ""validation_sql"": ""SELECT Margin_Level, selected_category_dimension, SUM(total_product_revenue_exclude_lod) FROM primary_analysis_sql GROUP BY 1,2"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_merged_product_revenue_exclude_lod"",
      ""related_metrics"": [
        ""margin_level_dimension"",
        ""selected_category_dimension""
      ],
      ""relationship_description"": ""Total Merged Product Revenue (Exclude LOD) is aggregated by Margin Level and a dynamically selected category/product dimension."",
      ""mathematical_formula"": ""SUM(Product_Revenue_Merged_OneRow) GROUP BY Margin_Level, Selected_Category_Dimension"",
      ""business_validation"": ""Similar to standard revenue, but for a 'merged' revenue stream, allowing comparison and specific analysis of consolidated revenue figures."",
      ""validation_sql"": ""SELECT Margin_Level, selected_category_dimension, SUM(total_merged_product_revenue_exclude_lod) FROM primary_analysis_sql GROUP BY 1,2"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_pacman_product_revenue"",
      ""related_metrics"": [
        ""fiscal_year_dimension""
      ],
      ""relationship_description"": ""Total PACMAN Product Revenue is strictly filtered to Fiscal Year 2025, limiting its scope to a specific period."",
      ""mathematical_formula"": ""SUM(Product_Revenue) WHERE Fiscal_Year = 2025"",
      ""business_validation"": ""This filter ensures that the PACMAN revenue metric is always reported for the specified fiscal year, which is critical for period-specific financial tracking."",
      ""validation_sql"": ""SELECT SUM(total_pacman_product_revenue) FROM primary_analysis_sql WHERE fiscal_year = 2025"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_fiscal_year_volume_pacman"",
      ""related_metrics"": [
        ""product_l3_dimension"",
        ""fiscal_year_dimension""
      ],
      ""relationship_description"": ""Total Fiscal Year Volume (PACMAN) is aggregated by Product Level 3 and Fiscal Year. The calculation itself (SUM of Fiscal_Year) is unusual and may indicate a misinterpretation or proxy for record count."",
      ""mathematical_formula"": ""SUM(Fiscal_Year) GROUP BY Product_L3, Fiscal_Year"",
      ""business_validation"": ""If interpreted as a proxy for record count, this relationship helps understand the volume of data points or transactions associated with each product level 3 within a given fiscal year."",
      ""validation_sql"": ""SELECT product_l3, fiscal_year, SUM(total_fiscal_year_volume_pacman) FROM primary_analysis_sql GROUP BY 1,2"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""low""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""product_l3_dimension"",
      ""related_metrics"": [
        ""product_l1_dimension"",
        ""product_l2_dimension"",
        ""product_l4_dimension"",
        ""product_name_dimension"",
        ""selected_category_dimension""
      ],
      ""relationship_description"": ""Product_L3 is part of a broader product hierarchy (L1, L2, L3, L4, Product_Name, Category). The 'selected_category_dimension' can dynamically represent any of these levels."",
      ""mathematical_formula"": ""N/A (hierarchical relationship)"",
      ""business_validation"": ""Understanding the product hierarchy is crucial for granular analysis and roll-up reporting of financial metrics."",
      ""validation_sql"": ""SELECT DISTINCT Product_L1, Product_L2, Product_L3, Product_L4, Product_Name FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_exclude_product_l3_and_l4` LIMIT 100"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,33
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f65a9149-93b4-4aa9-aef6-d12002853222"",
    ""dashboard_name"": ""Digital Video Content Audio"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 6,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""yearly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""sales_segment_l_2_name_sync"",
      ""booking_number"",
      ""adsize_name"",
      ""fin_adtype_name"",
      ""revenue_transaction_status"",
      ""source_publishing_division"",
      ""financial_year""
    ],
    ""date_range_detected"": ""2025 to 2026"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""2026""
    ],
    ""hardcoded_values_found"": [
      ""Booked"",
      ""Billed"",
      ""Medium Rare Content Agency"",
      ""Audio (Targeted)"",
      ""Audio (Non-Targeted)"",
      ""Events (Non-Targeted)"",
      ""Events (Targeted)"",
      ""Rich Media (Non-Targeted)"",
      ""Rich Media (Targeted)"",
      ""Social Display (Targeted)"",
      ""Social Display (Non-Targeted)"",
      ""Standard Display (Targeted)"",
      ""Standard Display (Non-Targeted)"",
      ""TTIV (Targeted)"",
      ""TTIV (Non-Targeted)"",
      ""Content Discovery (Non-Targeted)"",
      ""Content Discovery (Targeted)"",
      ""Native (Non-Targeted)"",
      ""Native (Targeted)""
    ],
    ""governance_opportunities"": [
      ""financial_year should be parameterised or use dynamic calculations"",
      ""fin_adtype_name values should be sourced from a reference table"",
      ""revenue_transaction_status values should be sourced from a reference table"",
      ""source_publishing_division exclusion should use a configuration table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.fin_adtype_name,\n    t0.revenue_transaction_status,\n    t0.sales_segment_l_2_name_sync,\n    t0.source_publishing_division,\n    t0.booking_number,\n    t0.financial_year,\n    t0.adsize_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    -- Common filters from Q1 & Q3\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    -- Union of all financial years and adtype names used across queries to ensure all relevant rows are considered\n    AND (\n        t0.financial_year IN ('2025', '2026')\n        OR t0.fin_adtype_name IN (\n            'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n            'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n            'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)',\n            'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n        )\n    )\n)\nSELECT\n  -- Key dimensions for grouping and analysis\n  financial_year,\n  fin_adtype_name,\n  revenue_transaction_status,\n  source_publishing_division,\n  -- Conditional counts for each 'metric' based on their original query filters\n  COUNT(DISTINCT CASE\n    WHEN\n      fin_adtype_name IN (\n        'Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)',\n        'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)',\n        'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)'\n      )\n    THEN sales_segment_l_2_name_sync\n    ELSE NULL\n  END) AS distinct_sales_segments_l2_count,\n  COUNT(DISTINCT CASE\n    WHEN\n      fin_adtype_name IN (\n        'Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)'\n      )\n      AND financial_year IN ('2026', '2025')\n    THEN booking_number\n    ELSE NULL\n  END) AS distinct_booking_numbers_count,\n  COUNT(DISTINCT CASE\n    WHEN\n      fin_adtype_name IN (\n        'Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)',\n        'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)',\n        'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)'\n      )\n      AND financial_year IN ('2025')\n    THEN adsize_name\n    ELSE NULL\n  END) AS distinct_ad_sizes_count\nFROM base_data\nGROUP BY\n  financial_year,\n  fin_adtype_name,\n  revenue_transaction_status,\n  source_publishing_division\nORDER BY\n  financial_year DESC, fin_adtype_name\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT booking_number) as unique_booking_numbers,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) as unique_sales_segments,\n  COUNT(DISTINCT adsize_name) as unique_ad_sizes,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year IN ('2025', '2026') -- Focus on relevant years\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END as data_presence_test,\n  CASE WHEN COUNT(DISTINCT revenue_transaction_status) >= 2 THEN 'PASS' ELSE 'FAIL' END as status_diversity_test,\n  CASE WHEN MAX(financial_year) >= '2025' THEN 'PASS' ELSE 'FAIL' END as financial_year_freshness_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year IN ('2025', '2026')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'revenue_status_filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_revenue_status\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year IN ('2025', '2026')\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'source_publishing_division_exclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage_division_exclusion\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year IN ('2025', '2026');"",
    ""sample_data_sql"": ""SELECT \n  financial_year,\n  fin_adtype_name,\n  revenue_transaction_status,\n  sales_segment_l_2_name_sync,\n  source_publishing_division,\n  booking_number,\n  adsize_name\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year IN ('2025', '2026')\nORDER BY financial_year DESC, booking_number\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial year filter in multiple queries"",
          ""suggested_fix"": ""replace with dynamic financial year calculation (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or `CURRENT_FINANCIAL_YEAR()`) or a parameter"",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""2026"",
          ""original_format"": ""2026"",
          ""context"": ""financial year filter in query 2"",
          ""suggested_fix"": ""replace with dynamic financial year calculation or a parameter"",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Booked'"",
            ""'Billed'""
          ],
          ""context"": ""revenue transaction status filter"",
          ""suggested_governance"": ""join to a `revenue_transaction_status_lookup` table"",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'Medium Rare Content Agency'""
          ],
          ""context"": ""source publishing division exclusion filter"",
          ""suggested_governance"": ""use a configuration table for excluded `source_publishing_division` values"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Audio (Targeted)'"",
            ""'Audio (Non-Targeted)'"",
            ""'Events (Non-Targeted)'"",
            ""'Events (Targeted)'"",
            ""'Rich Media (Non-Targeted)'"",
            ""'Rich Media (Targeted)'"",
            ""'Social Display (Targeted)'"",
            ""'Social Display (Non-Targeted)'"",
            ""'Standard Display (Targeted)'"",
            ""'Standard Display (Non-Targeted)'"",
            ""'TTIV (Targeted)'"",
            ""'TTIV (Non-Targeted)'"",
            ""'Content Discovery (Non-Targeted)'"",
            ""'Content Discovery (Targeted)'"",
            ""'Native (Non-Targeted)'"",
            ""'Native (Targeted)'""
          ],
          ""context"": ""fin_adtype_name filters across all queries"",
          ""suggested_governance"": ""join to a `fin_adtype_name_lookup` table or use a parameter for ad type categories"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with date parameters or relative date functions (e.g., `CURRENT_FINANCIAL_YEAR()`)."",
      ""Replace hardcoded `fin_adtype_name` values with joins to a governed reference table or allow multi-select parameters for ad type categories."",
      ""Replace hardcoded `revenue_transaction_status` and `source_publishing_division` values with joins to governed reference tables.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""sales_segment_l_2_name_sync_dimension"",
      ""metric_name"": ""Sales Segment (L2) Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the Level 2 sales segment name, used for filtering or grouping sales data."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize and filter advertising revenue by sales segment, likely for reporting on sales performance or client segmentation."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Targeted)'"",
        ""'Audio (Non-Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Events (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Lookup values for `revenue_transaction_status`, `source_publishing_division`, and `fin_adtype_name` are hardcoded.""
      ],
      ""data_quality_concerns"": [
        ""Potential nulls for `sales_segment_l_2_name_sync` if not always populated.""
      ]
    },
    {
      ""metric_id"": ""booking_number_dimension"",
      ""metric_name"": ""Booking Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a booking or transaction."",
      ""sql_logic"": ""t0.booking_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)')"",
        ""financial_year IN ('2026', '2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to identify individual bookings, likely for drill-down or detailed transaction analysis within specific ad types and financial years."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2026"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Content Discovery (Non-Targeted)'"",
        ""'Content Discovery (Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'""
      ],
      ""governance_issues"": [
        ""Hardcoded financial years and `fin_adtype_name` values.""
      ],
      ""data_quality_concerns"": [
        ""Ensuring uniqueness and consistency of booking numbers.""
      ]
    },
    {
      ""metric_id"": ""adsize_name_dimension"",
      ""metric_name"": ""Ad Size Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name or type of the advertisement size."",
      ""sql_logic"": ""t0.adsize_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze ad performance or inventory by specific ad sizes, filtered by transaction status, publishing division, ad type, and financial year."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Non-Targeted)'"",
        ""'Audio (Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Hardcoded financial year, `revenue_transaction_status`, `source_publishing_division`, and `fin_adtype_name` values.""
      ],
      ""data_quality_concerns"": [
        ""Consistency in ad size naming conventions.""
      ]
    },
    {
      ""metric_id"": ""distinct_sales_segments_count"",
      ""metric_name"": ""Count of Distinct Sales Segments (L2)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync_dimension""
      ],
      ""business_description"": ""The number of unique Level 2 sales segments matching the specified criteria."",
      ""sql_logic"": ""COUNT(DISTINCT sales_segment_l_2_name_sync) FILTER (WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of distinct sales segments, useful for understanding the breadth of sales activity under specific conditions."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Targeted)'"",
        ""'Audio (Non-Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Events (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Inherits hardcoded values from `sales_segment_l_2_name_sync_dimension`.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the quality of `sales_segment_l_2_name_sync` and filter data.""
      ]
    },
    {
      ""metric_id"": ""distinct_booking_numbers_count"",
      ""metric_name"": ""Count of Distinct Booking Numbers"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""booking_number_dimension""
      ],
      ""business_description"": ""The number of unique booking numbers matching the specified criteria."",
      ""sql_logic"": ""COUNT(DISTINCT booking_number) FILTER (WHERE fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND financial_year IN ('2026', '2025'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)')"",
        ""financial_year IN ('2026', '2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of distinct bookings, useful for understanding transaction volume for specific ad types and financial years."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2026"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Content Discovery (Non-Targeted)'"",
        ""'Content Discovery (Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'""
      ],
      ""governance_issues"": [
        ""Inherits hardcoded values from `booking_number_dimension`.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the quality of `booking_number` and filter data.""
      ]
    },
    {
      ""metric_id"": ""distinct_ad_sizes_count"",
      ""metric_name"": ""Count of Distinct Ad Sizes"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""adsize_name_dimension""
      ],
      ""business_description"": ""The number of unique ad sizes matching the specified criteria."",
      ""sql_logic"": ""COUNT(DISTINCT adsize_name) FILTER (WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND financial_year IN ('2025'))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL"",
        ""fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)')"",
        ""financial_year IN ('2025')""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides a count of distinct ad sizes, useful for inventory management or understanding ad format popularity under specific conditions."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'"",
        ""'Medium Rare Content Agency'"",
        ""'Audio (Non-Targeted)'"",
        ""'Audio (Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'""
      ],
      ""governance_issues"": [
        ""Inherits hardcoded values from `adsize_name_dimension`.""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on the quality of `adsize_name` and filter data.""
      ]
    },
    {
      ""metric_id"": ""fin_adtype_name"",
      ""metric_name"": ""Financial Ad Type Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of the advertisement type based on financial reporting standards."",
      ""sql_logic"": ""t0.fin_adtype_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A critical dimension used across all queries to filter and segment data by specific ad product types, indicating its importance in business analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Audio (Targeted)'"",
        ""'Audio (Non-Targeted)'"",
        ""'Events (Non-Targeted)'"",
        ""'Events (Targeted)'"",
        ""'Rich Media (Non-Targeted)'"",
        ""'Rich Media (Targeted)'"",
        ""'Social Display (Targeted)'"",
        ""'Social Display (Non-Targeted)'"",
        ""'Standard Display (Targeted)'"",
        ""'Standard Display (Non-Targeted)'"",
        ""'TTIV (Targeted)'"",
        ""'TTIV (Non-Targeted)'"",
        ""'Content Discovery (Non-Targeted)'"",
        ""'Content Discovery (Targeted)'"",
        ""'Native (Non-Targeted)'"",
        ""'Native (Targeted)'""
      ],
      ""governance_issues"": [
        ""Extensive hardcoded lists of ad types, suggesting a need for a governed lookup table.""
      ],
      ""data_quality_concerns"": [
        ""Potential for misspellings or inconsistencies if not managed by a lookup.""
      ]
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The current status of a revenue transaction (e.g., Booked, Billed)."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('Booked', 'Billed')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used as a primary filter to include only relevant (booked or billed) transactions for analysis, indicating focus on confirmed revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Booked'"",
        ""'Billed'""
      ],
      ""governance_issues"": [
        ""Hardcoded status values; should be from a controlled lookup.""
      ],
      ""data_quality_concerns"": [
        ""Ensuring accurate and consistent status assignment.""
      ]
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue transaction originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""!= 'Medium Rare Content Agency' OR IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to exclude specific divisions (e.g., 'Medium Rare Content Agency') from the analysis, indicating a focus on core publishing revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Medium Rare Content Agency'""
      ],
      ""governance_issues"": [
        ""Hardcoded exclusion value; should be managed via a configuration table.""
      ],
      ""data_quality_concerns"": [
        ""Consistency in division naming and handling of nulls.""
      ]
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year associated with the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""
      ],
      ""filters_applied"": [
        ""IN ('2026', '2025')"",
        ""IN ('2025')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key temporal dimension used to filter data for specific financial periods, indicating a focus on current and near-future performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""2026"",
        ""2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Hardcoded financial years; should be dynamic or parameterised.""
      ],
      ""data_quality_concerns"": [
        ""Ensuring financial year is correctly assigned to transactions.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""sales_segment_l_2_name_sync_dimension"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""fin_adtype_name""
      ],
      ""relationship_description"": ""The distinct values of 'Sales Segment (L2) Name' are directly filtered by specific 'Revenue Transaction Status', 'Source Publishing Division' exclusions, and a predefined list of 'Financial Ad Type Names'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that sales segment analysis focuses only on confirmed revenue from specific ad types and excludes certain publishing divisions."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT sales_segment_l_2_name_sync) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Targeted)', 'Audio (Non-Targeted)', 'Events (Non-Targeted)', 'Events (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Targeted)', 'Social Display (Non-Targeted)', 'Standard Display (Targeted)', 'Standard Display (Non-Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""booking_number_dimension"",
      ""related_metrics"": [
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""The distinct values of 'Booking Number' are filtered by a specific set of 'Financial Ad Type Names' and 'Financial Years'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that booking number analysis is constrained to specific ad content types and relevant financial periods."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT booking_number) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE fin_adtype_name IN ('Content Discovery (Non-Targeted)', 'Content Discovery (Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)') AND financial_year IN ('2026', '2025');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""adsize_name_dimension"",
      ""related_metrics"": [
        ""revenue_transaction_status"",
        ""source_publishing_division"",
        ""fin_adtype_name"",
        ""financial_year""
      ],
      ""relationship_description"": ""The distinct values of 'Ad Size Name' are filtered by 'Revenue Transaction Status', 'Source Publishing Division' exclusions, a specific list of 'Financial Ad Type Names', and a particular 'Financial Year'."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that ad size analysis is focused on confirmed revenue, excluding certain divisions, for specific ad types and a particular financial year."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT adsize_name) FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` WHERE revenue_transaction_status IN ('Booked', 'Billed') AND (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) AND fin_adtype_name IN ('Audio (Non-Targeted)', 'Audio (Targeted)', 'Events (Non-Targeted)', 'Native (Non-Targeted)', 'Native (Targeted)', 'Rich Media (Non-Targeted)', 'Rich Media (Targeted)', 'Social Display (Non-Targeted)', 'Social Display (Targeted)', 'Standard Display (Non-Targeted)', 'Standard Display (Targeted)', 'TTIV (Targeted)', 'TTIV (Non-Targeted)') AND financial_year IN ('2025');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,34
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""a17622e2-ad43-49cc-b3c5-19c95036fd14"",
    ""dashboard_name"": ""Advertising Rebates Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client"",
    ""business_domain"": ""advertising"",
    ""complexity_score"": 7,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 15,
    ""date_grain"": ""monthly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""account_number"",
      ""advertiser_name"",
      ""advertiser_parent"",
      ""financial_year"",
      ""financial_month"",
      ""invoice_number"",
      ""revenue_type"",
      ""source_publishing_division"",
      ""revenue_group_subtype"",
      ""revenue_transaction_status"",
      ""unified_publication_name""
    ],
    ""date_range_detected"": ""Financial Year 2025, Financial Month 10"",
    ""hardcoded_dates_found"": [""2025"", ""10""],
    ""hardcoded_values_found"": [
      ""'Booked'"",
      ""'Billed'"",
      ""'Medium Rare Content Agency'"",
      ""'Print'"",
      ""'Digital'"",
      ""'Programmatic Source'"",
      ""'4039072'""
    ],
    ""governance_opportunities"": [
      ""financial_year and financial_month should be parameterised"",
      ""revenue_transaction_status, source_publishing_division, revenue_type, revenue_group_subtype should use governed reference tables"",
      ""account_number should be parameterised or use a governed lookup""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.account_number,\n    t0.advertiser_name,\n    t0.advertiser_parent,\n    SAFE_CAST(t0.financial_month AS FLOAT64) AS financial_month,\n    t0.financial_year,\n    t0.gross_revenue_amount,\n    t0.gross_revenue_ex_adj_amount,\n    t0.invoice_number,\n    t0.rebate_3_amount,\n    t0.adjustment_amount,\n    t0.revenue_group_subtype,\n    t0.revenue_transaction_status,\n    t0.revenue_type,\n    t0.source_publishing_division,\n    t0.source_system_code,\n    t0.unified_publication_name\n  FROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client` AS t0\n  WHERE\n    t0.revenue_transaction_status IN ('Booked', 'Billed')\n    AND t0.financial_year IS NOT NULL\n    AND (t0.source_publishing_division != 'Medium Rare Content Agency' OR t0.source_publishing_division IS NULL)\n    AND t0.revenue_type IN ('Print', 'Digital')\n    AND t0.revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')\n    -- Apply common date/period filters, using parameters for flexibility\n    AND t0.financial_year = '2025' -- Example: Replace with {{financial_year_param}}\n    AND SAFE_CAST(t0.financial_month AS FLOAT64) = 10.000000 -- Example: Replace with {{financial_month_param}}\n    -- Specific filters from original queries that might need to be handled at dashboard level or as conditional metrics:\n    -- AND t0.rebate_3_amount != 0.000000\n    -- AND t0.account_number = '4039072'\n)\nSELECT\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  financial_month,\n  financial_year,\n  invoice_number,\n  revenue_type,\n  source_publishing_division,\n  source_system_code,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  SUM(gross_revenue_ex_adj_amount) AS total_gross_revenue_ex_adj,\n  SUM(rebate_3_amount) AS total_rebate_3_amount,\n  SUM(adjustment_amount) AS total_adjustment_amount,\n  SUM(gross_revenue_amount) AS total_gross_revenue_amount\nFROM base_data\nGROUP BY\n  account_number,\n  advertiser_name,\n  advertiser_parent,\n  financial_month,\n  financial_year,\n  invoice_number,\n  revenue_type,\n  source_publishing_division,\n  source_system_code,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_transaction_status\nORDER BY financial_year DESC, financial_month DESC, advertiser_name ASC\nLIMIT 10000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT account_number) as unique_accounts,\n  COUNT(DISTINCT advertiser_name) as unique_advertisers,\n  COUNT(DISTINCT financial_year) as unique_financial_years,\n  COUNT(DISTINCT financial_month) as unique_financial_months,\n  MIN(financial_year) as earliest_financial_year,\n  MAX(financial_year) as latest_financial_year,\n  MIN(SAFE_CAST(financial_month AS FLOAT64)) as earliest_financial_month,\n  MAX(SAFE_CAST(financial_month AS FLOAT64)) as latest_financial_month,\n  APPROX_COUNT_DISTINCT(CONCAT(account_number, '-', invoice_number)) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Adjust for relevant period\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000 -- Adjust for relevant period\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN SUM(rebate_3_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as rebate_amount_test,\n  CASE WHEN COUNT(DISTINCT account_number) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_account_test,\n  CASE WHEN MAX(financial_year) = '2025' THEN 'PASS' ELSE 'FAIL' END as financial_year_test\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Transaction Status Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_transaction_status IN ('Booked', 'Billed') THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Adjust for relevant period\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000 -- Adjust for relevant period\nUNION ALL\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Source Publishing Division Exclusion' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Adjust for relevant period\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000; -- Adjust for relevant period"",
    ""sample_data_sql"": ""SELECT\n  account_number,\n  advertiser_name,\n  financial_year,\n  financial_month,\n  gross_revenue_amount,\n  gross_revenue_ex_adj_amount,\n  rebate_3_amount,\n  adjustment_amount,\n  revenue_type,\n  revenue_group_subtype,\n  revenue_transaction_status,\n  source_publishing_division,\n  invoice_number\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE financial_year = '2025' -- Adjust for relevant period\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000 -- Adjust for relevant period\n  AND revenue_transaction_status IN ('Booked', 'Billed')\nORDER BY gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""2025"",
          ""context"": ""financial_year filter"",
          ""suggested_fix"": ""replace with parameter or relative financial year function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""10"",
          ""original_format"": ""10.000000"",
          ""context"": ""financial_month filter (October)"",
          ""suggested_fix"": ""replace with parameter or relative financial month function"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Booked'"", ""'Billed'""],
          ""context"": ""revenue_transaction_status filter"",
          ""suggested_governance"": ""join to a transaction_status_lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Medium Rare Content Agency'""],
          ""context"": ""source_publishing_division exclusion filter"",
          ""suggested_governance"": ""manage excluded divisions in a configuration table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Print'"", ""'Digital'""],
          ""context"": ""revenue_type filter"",
          ""suggested_governance"": ""join to a revenue_type_lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Programmatic Source'"", ""'Print'"", ""'Digital'""],
          ""context"": ""revenue_group_subtype filter"",
          ""suggested_governance"": ""join to a revenue_group_subtype_lookup table"",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'4039072'""],
          ""context"": ""account_number filter"",
          ""suggested_governance"": ""replace with parameter or lookup from a customer/account master table"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial year and month with dashboard parameters (e.g., `{{financial_year_param}}`, `{{financial_month_param}}`) or relative date functions."",
      ""Replace hardcoded lookup values for `revenue_transaction_status`, `revenue_type`, `revenue_group_subtype` with joins to governed reference tables."",
      ""Manage excluded `source_publishing_division` values in a configuration table instead of hardcoded logic."",
      ""Parameterize specific `account_number` filters for dynamic analysis.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""account_number"",
      ""metric_name"": ""Account Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for the client account."",
      ""sql_logic"": ""t0.account_number"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""account_number = '4039072' (specific to one query)""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for client-specific reporting and filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'4039072'""],
      ""governance_issues"": [""account_number should be parameterised or use a governed lookup""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the revenue."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for reporting revenue by advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_parent"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The parent company of the advertiser."",
      ""sql_logic"": ""t0.advertiser_parent"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for hierarchical reporting of advertising revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month"",
      ""metric_name"": ""Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month of the transaction (1-12)."",
      ""sql_logic"": ""SAFE_CAST(t0.financial_month AS FLOAT64)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""financial_month = 10.000000""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for monthly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""10""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""financial_month should be parameterised""],
      ""data_quality_concerns"": [""potential for non-integer values if not cast correctly""]
    },
    {
      ""metric_id"": ""financial_year"",
      ""metric_name"": ""Financial Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year of the transaction."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""financial_year IS NOT NULL"", ""financial_year = '2025'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time dimension for annual reporting and trend analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""financial_year should be parameterised""],
      ""data_quality_concerns"": [""potential for nulls""]
    },
    {
      ""metric_id"": ""invoice_number"",
      ""metric_name"": ""Invoice Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unique invoice number for the transaction."",
      ""sql_logic"": ""t0.invoice_number"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for transaction-level detail and reconciliation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Classification of revenue, e.g., 'Print' or 'Digital'."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""revenue_type IN ('Print', 'Digital')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment revenue by media type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Print'"", ""'Digital'""],
      ""governance_issues"": [""revenue_type should use a governed reference table""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_publishing_division"",
      ""metric_name"": ""Source Publishing Division"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The publishing division from which the revenue originated."",
      ""sql_logic"": ""t0.source_publishing_division"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to filter or segment revenue by internal division."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Medium Rare Content Agency'""],
      ""governance_issues"": [""excluded divisions should be managed in a configuration table""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_system_code"",
      ""metric_name"": ""Source System Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Code indicating the source system of the transaction."",
      ""sql_logic"": ""t0.source_system_code"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Internal operational dimension for data lineage."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Standardized name of the publication."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting revenue by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Further classification of revenue group, e.g., 'Programmatic Source'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides more granular segmentation of revenue."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Programmatic Source'"", ""'Print'"", ""'Digital'""],
      ""governance_issues"": [""revenue_group_subtype should use a governed reference table""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_transaction_status"",
      ""metric_name"": ""Revenue Transaction Status"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Status of the revenue transaction, e.g., 'Booked' or 'Billed'."",
      ""sql_logic"": ""t0.revenue_transaction_status"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [""revenue_transaction_status IN ('Booked', 'Billed')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial filter for including only relevant revenue transactions."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Booked'"", ""'Billed'""],
      ""governance_issues"": [""revenue_transaction_status should use a governed reference table""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_gross_revenue_ex_adj"",
      ""metric_name"": ""Total Gross Revenue Excl. Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount excluding any adjustments. This is a key revenue metric."",
      ""sql_logic"": ""SUM(t0.gross_revenue_ex_adj_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""financial_month = 10""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core metric for understanding revenue performance before considering specific rebates or adjustments. Often used for top-line revenue tracking."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025"", ""10""],
      ""hardcoded_values_in_metric"": [""'Booked'"", ""'Billed'"", ""'Medium Rare Content Agency'"", ""'Print'"", ""'Digital'"", ""'Programmatic Source'""],
      ""governance_issues"": [""filters contain hardcoded values and dates""],
      ""data_quality_concerns"": [""potential for nulls in source column""]
    },
    {
      ""metric_id"": ""total_rebate_3_amount"",
      ""metric_name"": ""Total Rebate 3 Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of 'Rebate 3' applied to transactions. This is a specific type of rebate."",
      ""sql_logic"": ""SUM(t0.rebate_3_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""rebate_3_amount != 0.000000"",
        ""financial_year = '2025'"",
        ""financial_month = 10""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Crucial for understanding the impact of specific rebate programs on net revenue. Directly impacts profitability."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025"", ""10""],
      ""hardcoded_values_in_metric"": [""'Booked'"", ""'Billed'"", ""'Medium Rare Content Agency'"", ""'Print'"", ""'Digital'"", ""'Programmatic Source'""],
      ""governance_issues"": [""filters contain hardcoded values and dates""],
      ""data_quality_concerns"": [""potential for nulls in source column"", ""filter `!= 0` might exclude valid zero rebates""]
    },
    {
      ""metric_id"": ""total_adjustment_amount"",
      ""metric_name"": ""Total Adjustment Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total amount of adjustments applied to revenue."",
      ""sql_logic"": ""SUM(t0.adjustment_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""financial_month = 10""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used to track and analyze various revenue adjustments, which can impact net revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [""2025"", ""10""],
      ""hardcoded_values_in_metric"": [""'Booked'"", ""'Billed'"", ""'Medium Rare Content Agency'"", ""'Print'"", ""'Digital'"", ""'Programmatic Source'""],
      ""governance_issues"": [""filters contain hardcoded values and dates""],
      ""data_quality_concerns"": [""potential for nulls in source column""]
    },
    {
      ""metric_id"": ""total_gross_revenue_amount"",
      ""metric_name"": ""Total Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total gross revenue amount before any adjustments or specific rebates."",
      ""sql_logic"": ""SUM(t0.gross_revenue_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client""],
      ""filters_applied"": [
        ""revenue_transaction_status IN ('Booked', 'Billed')"",
        ""financial_year IS NOT NULL"",
        ""(source_publishing_division != 'Medium Rare Content Agency' OR source_publishing_division IS NULL)"",
        ""revenue_type IN ('Print', 'Digital')"",
        ""revenue_group_subtype IN ('Programmatic Source', 'Print', 'Digital')"",
        ""financial_year = '2025'"",
        ""financial_month = 10""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Represents the raw, unadjusted revenue. Important for understanding the initial booking value."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025"", ""10""],
      ""hardcoded_values_in_metric"": [""'Booked'"", ""'Billed'"", ""'Medium Rare Content Agency'"", ""'Print'"", ""'Digital'"", ""'Programmatic Source'""],
      ""governance_issues"": [""filters contain hardcoded values and dates""],
      ""data_quality_concerns"": [""potential for nulls in source column""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""total_gross_revenue_ex_adj"",
      ""related_metrics"": [""total_gross_revenue_amount"", ""total_adjustment_amount""],
      ""relationship_description"": ""Gross Revenue Excl. Adjustment is typically Gross Revenue Amount minus Adjustment Amount. This relationship is implied by the naming conventions and common accounting practices."",
      ""mathematical_formula"": ""total_gross_revenue_ex_adj = total_gross_revenue_amount - total_adjustment_amount"",
      ""business_validation"": ""Ensures that the calculation of revenue excluding adjustments is consistent with the raw gross revenue and the adjustments made, providing a clear audit trail for revenue figures."",
      ""validation_sql"": ""SELECT\n  SUM(gross_revenue_ex_adj_amount) AS sum_gross_revenue_ex_adj,\n  SUM(gross_revenue_amount) - SUM(adjustment_amount) AS calculated_gross_revenue_ex_adj,\n  CASE WHEN SUM(gross_revenue_ex_adj_amount) = (SUM(gross_revenue_amount) - SUM(adjustment_amount)) THEN 'PASS' ELSE 'FAIL' END AS validation_status\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000\nLIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_rebate_3_amount"",
      ""related_metrics"": [""total_gross_revenue_ex_adj"", ""total_gross_revenue_amount""],
      ""relationship_description"": ""The 'rebate_3_amount != 0.000000' filter specifically impacts the calculation of Total Rebate 3 Amount, potentially excluding transactions where the rebate was explicitly zero, even if valid. This filter is present in two of the three queries."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Understanding if zero-value rebates should be included or excluded is critical for accurate rebate reporting and net revenue calculations. This filter might lead to undercounting total rebate volume if zero-value rebates are meaningful."",
      ""validation_sql"": ""SELECT\n  COUNT(*) AS total_records,\n  SUM(CASE WHEN rebate_3_amount != 0.000000 THEN 1 ELSE 0 END) AS records_with_non_zero_rebate,\n  SUM(CASE WHEN rebate_3_amount = 0.000000 THEN 1 ELSE 0 END) AS records_with_zero_rebate\nFROM `ncau-data-newsquery-prd.asl_advertising.v_adsales_revenue_client`\nWHERE revenue_transaction_status IN ('Booked', 'Billed')\n  AND financial_year = '2025'\n  AND SAFE_CAST(financial_month AS FLOAT64) = 10.000000\nLIMIT 1;"",
      ""relationship_strength"": ""medium"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,35
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""fed70b12-c274-4cde-9920-592ca4c4dab0"",
    ""dashboard_name"": ""Independent Agency Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_dcp.ia;ncau-data-newsquery-prd.asl_finance_derived.revenue_movement"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 17,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""agency_parent"",
      ""account_number"",
      ""booking_line_created_date"",
      ""movement_date"",
      ""financial_year"",
      ""financial_quarter"",
      ""financial_month"",
      ""movement_financial_week"",
      ""revenue_group_subtype""
    ],
    ""date_range_detected"": ""Historical to Current"",
    ""hardcoded_dates_found"": [
      ""23/05/2025"",
      ""22/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""'FY'"",
      ""-12"",
      ""-1"",
      ""0"",
      ""6"",
      ""'PROGRAMMATIC EXCHANGE'"",
      ""'Jan'"",
      ""'Feb'"",
      ""'Mar'"",
      ""'Apr'"",
      ""'May'"",
      ""'Jun'"",
      ""'Jul'"",
      ""'Aug'"",
      ""'Sep'"",
      ""'Oct'"",
      ""'Nov'"",
      ""'Dec'"",
      ""'Q1'"",
      ""'Q2'"",
      ""'Q3'"",
      ""'Q4'"",
      ""'Current Week'""
    ],
    ""governance_opportunities"": [
      ""Dates used as 'current date' should be parameterized or use CURRENT_DATE()"",
      ""Relative date calculations (e.g., -365 days) should use INTERVAL 1 YEAR for robustness"",
      ""Month and quarter mappings should be externalized to a reference table"",
      ""Business rules like 'PROGRAMMATIC EXCHANGE' exclusion or financial month adjustments should be configurable""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query attempts to consolidate key metrics from both data sources into a single view.\n-- Note: Direct joining of 'ia' and 'revenue_movement' tables is assumed to be possible on 'agency_parent' and financial period dimensions.\n-- If the underlying data grains or join keys are not perfectly aligned, this query might need further refinement (e.g., separate CTEs with UNION ALL or more complex joins).\n\nWITH\n  current_date_sydney AS (\n    SELECT\n      DATE(CURRENT_TIMESTAMP(), 'Australia/Sydney') AS current_report_date\n  ),\n  ia_metrics AS (\n    SELECT\n      t0.agency_parent,\n      t0.booking_line_created_date,\n      t0.gross_revenue_amount,\n      t0.relative_cal_month_offset,\n      t0.relative_cal_year_offset,\n      t0.relative_fy_month_offset,\n      t0.relative_fy_year_offset,\n      t0.revenue_group_subtype,\n      -- Derived financial period dimensions for joining\n      CASE WHEN t0.relative_fy_year_offset = 0 THEN 'Current FY' WHEN t0.relative_fy_year_offset = -1 THEN 'Prior FY' ELSE 'Other FY' END AS financial_year_label,\n      CASE WHEN t0.financial_quarter IS NOT NULL THEN SAFE_CAST(t0.financial_quarter AS STRING) ELSE NULL END AS financial_quarter_label,\n      CASE WHEN t0.financial_month IS NOT NULL THEN SAFE_CAST(t0.financial_month AS STRING) ELSE NULL END AS financial_month_label,\n      -- Adjusted Financial Month (from Q2 logic)\n      CASE WHEN t0.financial_month > 6 THEN t0.financial_month - 6 ELSE t0.financial_month + 6 END AS adjusted_financial_month_calc\n    FROM\n      `ncau-data-newsquery-prd.sbx_dcp.ia` AS t0\n    WHERE\n      t0.revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR t0.revenue_group_subtype IS NULL\n  ),\n  revenue_movement_metrics AS (\n    SELECT\n      t0.account_number,\n      t0.agency_parent,\n      t0.movement_date,\n      t0.GROSS_AMOUNT_DIFF,\n      t0.financial_month,\n      t0.financial_year,\n      t0.relative_fy_year_offset,\n      t0.financial_short_month,\n      t0.movement_financial_week,\n      t0.max_week,\n      t0.min_week,\n      -- Derived financial period dimensions for joining\n      CASE WHEN t0.relative_fy_year_offset = 0 THEN 'Current FY' WHEN t0.relative_fy_year_offset = -1 THEN 'Prior FY' ELSE 'Other FY' END AS financial_year_label,\n      CASE WHEN t0.financial_quarter IS NOT NULL THEN SAFE_CAST(t0.financial_quarter AS STRING) ELSE NULL END AS financial_quarter_label,\n      CASE WHEN t0.financial_month IS NOT NULL THEN SAFE_CAST(t0.financial_month AS STRING) ELSE NULL END AS financial_month_label,\n      -- Financial Quarter (from Q3 logic)\n      CASE\n        WHEN (t0.financial_month IN (1, 2, 3)) THEN 'Q1'\n        WHEN (t0.financial_month IN (4, 5, 6)) THEN 'Q2'\n        WHEN (t0.financial_month IN (7, 8, 9)) THEN 'Q3'\n        WHEN (t0.financial_month IN (10, 11, 12)) THEN 'Q4'\n        ELSE NULL\n      END AS financial_quarter_derived_q3,\n      -- Movement Financial Week Formatted (from Q3 logic)\n      CASE WHEN t0.movement_financial_week = t0.max_week THEN 'Current Week' ELSE CONCAT(' Week ', SAFE_CAST(t0.movement_financial_week AS STRING)) END AS movement_financial_week_formatted,\n      -- Is Current Week Filter (from Q3 logic)\n      (t0.movement_financial_week = t0.min_week) AS is_current_week_filter\n    FROM\n      `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` AS t0\n  )\nSELECT\n  COALESCE(ia.agency_parent, rm.agency_parent) AS agency_parent,\n  COALESCE(ia.financial_year_label, rm.financial_year_label) AS financial_year_label,\n  COALESCE(ia.financial_quarter_label, rm.financial_quarter_label, rm.financial_quarter_derived_q3) AS financial_quarter_label,\n  COALESCE(ia.financial_month_label, rm.financial_month_label) AS financial_month_label,\n  ia.adjusted_financial_month_calc AS adjusted_financial_month,\n  rm.account_number,\n  rm.movement_date,\n  rm.financial_short_month,\n  rm.movement_financial_week_formatted,\n  SUM(CASE WHEN ia.relative_fy_year_offset = 0 THEN ia.gross_revenue_amount ELSE 0 END) AS current_year_gross_revenue,\n  SUM(CASE WHEN ia.relative_fy_year_offset = -1 THEN ia.gross_revenue_amount ELSE 0 END) AS prior_year_gross_revenue,\n  SUM(\n    CASE\n      WHEN ia.relative_fy_month_offset < -12 THEN (CASE WHEN ia.relative_fy_year_offset = -1 THEN ia.gross_revenue_amount ELSE 0 END)\n      ELSE (CASE WHEN ia.relative_fy_year_offset = -1 AND ia.booking_line_created_date <= DATE_SUB(current_date_sydney.current_report_date, INTERVAL 365 DAY) THEN ia.gross_revenue_amount ELSE 0 END)\n    END\n  ) AS prior_year_gross_revenue_ytd_or_full,\n  SUM(CASE WHEN rm.is_current_week_filter != TRUE THEN rm.GROSS_AMOUNT_DIFF ELSE 0 END) AS gross_amount_difference\nFROM\n  ia_metrics ia\nFULL OUTER JOIN\n  revenue_movement_metrics rm\n  ON ia.agency_parent = rm.agency_parent\n  AND ia.financial_year_label = rm.financial_year_label\n  AND COALESCE(ia.financial_quarter_label, ia.adjusted_financial_month_calc) = COALESCE(rm.financial_quarter_label, rm.financial_quarter_derived_q3, rm.financial_month_label)\n  -- More sophisticated date/period joining might be needed based on exact business logic\nCROSS JOIN\n  current_date_sydney\nGROUP BY\n  1, 2, 3, 4, 5, 6, 7, 8, 9\nORDER BY\n  agency_parent, financial_year_label, financial_quarter_label, financial_month_label\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.sbx_dcp.ia`) AS total_records_ia,\n  (SELECT COUNT(DISTINCT agency_parent) FROM `ncau-data-newsquery-prd.sbx_dcp.ia`) AS unique_agency_parents_ia,\n  (SELECT MIN(booking_line_created_date) FROM `ncau-data-newsquery-prd.sbx_dcp.ia`) AS earliest_date_ia,\n  (SELECT MAX(booking_line_created_date) FROM `ncau-data-newsquery-prd.sbx_dcp.ia`) AS latest_date_ia,\n  (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`) AS total_records_revenue_movement,\n  (SELECT COUNT(DISTINCT account_number) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`) AS unique_account_numbers_revenue_movement,\n  (SELECT MIN(movement_date) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`) AS earliest_date_revenue_movement,\n  (SELECT MAX(movement_date) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`) AS latest_date_revenue_movement\nFROM\n  DUMMY_TABLE -- Or any existing table to run a single query\nLIMIT 1;"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  (SELECT SUM(gross_revenue_amount) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) AND (revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR revenue_group_subtype IS NULL)) AS recent_ia_revenue,\n  (SELECT SUM(GROSS_AMOUNT_DIFF) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) AND (movement_financial_week != min_week)) AS recent_revenue_movement_diff,\n  CASE WHEN (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.sbx_dcp.ia` WHERE booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)) > 0 THEN 'PASS' ELSE 'FAIL' END AS ia_freshness_test,\n  CASE WHEN (SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement` WHERE movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)) > 0 THEN 'PASS' ELSE 'FAIL' END AS revenue_movement_freshness_test\nFROM\n  DUMMY_TABLE -- Or any existing table to run a single query\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Exclude Programmatic Exchange Revenue' AS rule_name,\n  COUNT(*) AS total_ia_records,\n  SUM(CASE WHEN revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END) AS programmatic_exchange_records,\n  SAFE_DIVIDE(SUM(CASE WHEN revenue_group_subtype = 'PROGRAMMATIC EXCHANGE' THEN 1 ELSE 0 END), COUNT(*)) * 100 AS programmatic_exchange_percentage\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia`\nWHERE\n  booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)\nUNION ALL\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Exclude Current Week Revenue Movement' AS rule_name,\n  COUNT(*) AS total_revenue_movement_records,\n  SUM(CASE WHEN movement_financial_week = min_week THEN 1 ELSE 0 END) AS current_week_movement_records,\n  SAFE_DIVIDE(SUM(CASE WHEN movement_financial_week = min_week THEN 1 ELSE 0 END), COUNT(*)) * 100 AS current_week_movement_percentage\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE\n  movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""sample_data_sql"": ""SELECT\n  'sbx_dcp.ia' AS source_table,\n  agency_parent,\n  booking_line_created_date,\n  gross_revenue_amount,\n  relative_fy_year_offset,\n  relative_fy_month_offset,\n  revenue_group_subtype,\n  NULL AS account_number,\n  NULL AS movement_date,\n  NULL AS GROSS_AMOUNT_DIFF,\n  NULL AS financial_month,\n  NULL AS financial_year,\n  NULL AS financial_short_month,\n  NULL AS movement_financial_week,\n  NULL AS max_week,\n  NULL AS min_week\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia`\nWHERE\n  booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 100\nUNION ALL\nSELECT\n  'asl_finance_derived.revenue_movement' AS source_table,\n  agency_parent,\n  NULL AS booking_line_created_date,\n  NULL AS gross_revenue_amount,\n  relative_fy_year_offset,\n  NULL AS relative_fy_month_offset,\n  NULL AS revenue_group_subtype,\n  account_number,\n  movement_date,\n  GROSS_AMOUNT_DIFF,\n  financial_month,\n  financial_year,\n  financial_short_month,\n  movement_financial_week,\n  max_week,\n  min_week\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE\n  movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)\nLIMIT 100;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""23/05/2025"",
          ""original_format"": ""2025-05-23 01:19:32.916346+00"",
          ""context"": ""Used as a fixed 'current date' for YTD calculations in Query 1."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE('Australia/Sydney')` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""22/06/2025"",
          ""original_format"": ""2025-06-22 22:46:58.786738+00"",
          ""context"": ""Used as a fixed 'current date' for YTD calculations in Query 2."",
          ""suggested_fix"": ""Replace with `CURRENT_DATE('Australia/Sydney')` or a dashboard date parameter."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'FY'""
          ],
          ""context"": ""Used in `CASE WHEN ('FY' = 'FY')` which is always true, making the conditional logic redundant."",
          ""suggested_governance"": ""Remove redundant `CASE` statements."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""-12""
          ],
          ""context"": ""Threshold for `relative_fy_month_offset` to determine if a period is 'more than a year ago' for YTD calculation."",
          ""suggested_governance"": ""Consider externalizing such thresholds if they are subject to change or vary by business unit."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""thresholds"",
          ""hardcoded_values"": [
            ""6""
          ],
          ""context"": ""Threshold for `financial_month` to adjust month numbers (e.g., `financial_month - 6` or `+ 6`)."",
          ""suggested_governance"": ""Externalize this adjustment logic to a configuration table if the financial year start is variable."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'PROGRAMMATIC EXCHANGE'""
          ],
          ""context"": ""Used to filter out specific revenue subtypes."",
          ""suggested_governance"": ""Manage excluded revenue types in a reference table or parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jan'"",
            ""'Feb'"",
            ""'Mar'"",
            ""'Apr'"",
            ""'May'"",
            ""'Jun'"",
            ""'Jul'"",
            ""'Aug'"",
            ""'Sep'"",
            ""'Oct'"",
            ""'Nov'"",
            ""'Dec'""
          ],
          ""context"": ""Mapping month short names to month numbers."",
          ""suggested_governance"": ""Use a date dimension table or built-in date functions for month number extraction."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Q1'"",
            ""'Q2'"",
            ""'Q3'"",
            ""'Q4'""
          ],
          ""context"": ""Mapping financial months to financial quarters."",
          ""suggested_governance"": ""Manage financial quarter definitions in a date dimension or configuration table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'Current Week'""
          ],
          ""context"": ""Label for the current financial week."",
          ""suggested_governance"": ""Can be kept as a display label, but the underlying logic for 'current week' should be dynamic."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB()`)."",
      ""Replace hardcoded lookup values for month/quarter mapping with joins to governed reference tables or more robust date functions."",
      ""Use configuration tables for business rules (e.g., `PROGRAMMATIC EXCHANGE` exclusion list, financial month adjustment logic) instead of hardcoded logic within queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""agency_parent"",
      ""metric_name"": ""Agency Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The top-level parent agency associated with the booking or revenue movement."",
      ""sql_logic"": ""t0.agency_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia"",
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for agency-level reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of revenue, used to exclude specific types like 'PROGRAMMATIC EXCHANGE'."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR revenue_group_subtype IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Ensures only relevant revenue types are included in calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'PROGRAMMATIC EXCHANGE'""
      ],
      ""governance_issues"": [
        ""Filter value is hardcoded; should be managed externally.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_year_gross_revenue"",
      ""metric_name"": ""Current Year Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Sum of gross revenue for the current financial year (relative_fy_year_offset = 0)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = 0) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for current performance, used for tracking and comparisons."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prior_year_gross_revenue"",
      ""metric_name"": ""Prior Year Gross Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset""
      ],
      ""business_description"": ""Sum of gross revenue for the prior financial year (relative_fy_year_offset = -1)."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for year-over-year comparisons to assess growth or decline."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""-1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""prior_year_gross_revenue_ytd_or_full"",
      ""metric_name"": ""Prior Year Gross Revenue (YTD or Full)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount"",
        ""relative_fy_year_offset"",
        ""booking_line_created_date"",
        ""relative_fy_month_offset""
      ],
      ""business_description"": ""Sum of gross revenue for the prior financial year, up to the equivalent date of the current year (YTD), or full prior year revenue for periods more than a year ago."",
      ""sql_logic"": ""SUM(CASE WHEN (relative_fy_month_offset < -12) THEN (CASE WHEN (relative_fy_year_offset = -1) THEN gross_revenue_amount ELSE 0 END) ELSE (CASE WHEN (relative_fy_year_offset = -1 AND booking_line_created_date <= (CURRENT_DATE() - INTERVAL 365 DAY)) THEN gross_revenue_amount ELSE 0 END) END)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [
        ""revenue_group_subtype != 'PROGRAMMATIC EXCHANGE'""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key for YTD performance comparison, adapting to show full prior year for older periods."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""23/05/2025"",
        ""22/06/2025""
      ],
      ""hardcoded_values_in_metric"": [
        ""-12"",
        ""-1"",
        ""365 DAY""
      ],
      ""governance_issues"": [
        ""Hardcoded 'current date' and '365 DAY' interval should be dynamic/parameterized.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""adjusted_financial_month"",
      ""metric_name"": ""Adjusted Financial Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_month""
      ],
      ""business_description"": ""Financial month adjusted by +/- 6, possibly for a specific reporting cycle or financial year start."",
      ""sql_logic"": ""CASE WHEN (financial_month > 6) THEN financial_month - 6 ELSE financial_month + 6 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping revenue by a specific financial month definition, potentially aligning with a non-standard fiscal calendar."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""6""
      ],
      ""governance_issues"": [
        ""Hardcoded adjustment value '6' should be configurable.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter of the booking."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping revenue by financial quarter for quarterly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_amount_difference"",
      ""metric_name"": ""Gross Amount Difference"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""GROSS_AMOUNT_DIFF""
      ],
      ""business_description"": ""Sum of the difference in gross amounts, likely representing revenue movements or adjustments."",
      ""sql_logic"": ""SUM(t0.GROSS_AMOUNT_DIFF)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""movement_financial_week != min_week""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Tracks changes or movements in gross revenue, important for financial reconciliation and analysis of adjustments."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""account_number"",
      ""metric_name"": ""Account Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for an account."",
      ""sql_logic"": ""t0.account_number"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for account-level reporting and detailed financial analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""movement_date"",
      ""metric_name"": ""Movement Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date of the revenue movement."",
      ""sql_logic"": ""t0.movement_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Time dimension for analyzing revenue movements over time."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_month_q3"",
      ""metric_name"": ""Financial Month (Q3)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial month from the revenue movement table."",
      ""sql_logic"": ""t0.financial_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping revenue movements by financial month for reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_q3"",
      ""metric_name"": ""Financial Quarter (Q3)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_month_q3""
      ],
      ""business_description"": ""Financial quarter derived from financial month for the revenue movement table."",
      ""sql_logic"": ""CASE WHEN (financial_month IN (1, 2, 3)) THEN 'Q1' WHEN (financial_month IN (4, 5, 6)) THEN 'Q2' WHEN (financial_month IN (7, 8, 9)) THEN 'Q3' WHEN (financial_month IN (10, 11, 12)) THEN 'Q4' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping revenue movements by financial quarter for quarterly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Q1'"",
        ""'Q2'"",
        ""'Q3'"",
        ""'Q4'"",
        ""1"",
        ""2"",
        ""3"",
        ""4"",
        ""5"",
        ""6"",
        ""7"",
        ""8"",
        ""9"",
        ""10"",
        ""11"",
        ""12""
      ],
      ""governance_issues"": [
        ""Hardcoded quarter mapping should be externalized to a reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year_q3"",
      ""metric_name"": ""Financial Year (Q3)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial year from the revenue movement table."",
      ""sql_logic"": ""t0.financial_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for grouping revenue movements by financial year for annual reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset_q3"",
      ""metric_name"": ""Relative FY Year Offset (Q3)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial year relative to the current financial year for revenue movements."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for relative year comparisons in revenue movement analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month_q3"",
      ""metric_name"": ""Financial Short Month (Q3)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Short name of the financial month for revenue movements."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for display of financial month in reports."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""movement_financial_week_formatted"",
      ""metric_name"": ""Movement Financial Week Formatted"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""movement_financial_week"",
        ""max_week""
      ],
      ""business_description"": ""Formatted financial week, labeled 'Current Week' if it corresponds to the maximum week in the dataset."",
      ""sql_logic"": ""CASE WHEN (movement_financial_week = max_week) THEN 'Current Week' ELSE CONCAT(' Week ', SAFE_CAST(movement_financial_week AS STRING)) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for weekly grouping and highlighting the current week in revenue movement reports."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Current Week'""
      ],
      ""governance_issues"": [
        ""Hardcoded label 'Current Week' is acceptable for display, but the underlying logic for 'current week' should be dynamic.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_current_week_filter"",
      ""metric_name"": ""Is Current Week Filter"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""movement_financial_week"",
        ""min_week""
      ],
      ""business_description"": ""Boolean indicating if the record is for the 'current week' based on `movement_financial_week` being equal to `min_week`."",
      ""sql_logic"": ""(movement_financial_week = min_week)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.revenue_movement""
      ],
      ""filters_applied"": [
        ""is_current_week_filter != true""
      ],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter out current week data from the `gross_amount_difference` calculation, ensuring only completed week data is analyzed."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_line_created_date"",
      ""metric_name"": ""Booking Line Created Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date when the booking line was created."",
      ""sql_logic"": ""t0.booking_line_created_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary date dimension for `sbx_dcp.ia` table, used for time-based filtering and YTD calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for a booking line."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base metric for all revenue calculations in `sbx_dcp.ia`."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset"",
      ""metric_name"": ""Relative FY Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""direct_mapping"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Offset of the financial year relative to the current financial year (0 for current, -1 for prior, etc.)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_dcp.ia""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Crucial for defining current vs. prior year revenue metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_year_gross_revenue"",
      ""related_metrics"": [
        ""prior_year_gross_revenue"",
        ""prior_year_gross_revenue_ytd_or_full""
      ],
      ""relationship_description"": ""These metrics are typically used together for year-over-year (YoY) growth analysis. Current year revenue is compared against prior year full revenue or prior year YTD revenue."",
      ""mathematical_formula"": ""YoY_Growth_Full = (current_year_gross_revenue - prior_year_gross_revenue) / prior_year_gross_revenue; YoY_Growth_YTD = (current_year_gross_revenue_YTD - prior_year_gross_revenue_ytd_or_full) / prior_year_gross_revenue_ytd_or_full"",
      ""business_validation"": ""Ensures accurate assessment of business performance trends over time."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) AS current_year_revenue,\n  SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END) AS prior_year_revenue,\n  (SUM(CASE WHEN relative_fy_year_offset = 0 THEN gross_revenue_amount ELSE 0 END) - SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END)) / NULLIF(SUM(CASE WHEN relative_fy_year_offset = -1 THEN gross_revenue_amount ELSE 0 END), 0) AS yoy_growth_percentage\nFROM\n  `ncau-data-newsquery-prd.sbx_dcp.ia`\nWHERE\n  (revenue_group_subtype != 'PROGRAMMATIC EXCHANGE' OR revenue_group_subtype IS NULL)\n  AND booking_line_created_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""gross_amount_difference"",
      ""related_metrics"": [
        ""is_current_week_filter""
      ],
      ""relationship_description"": ""The `gross_amount_difference` metric is filtered to exclude data from the 'current week' as defined by `is_current_week_filter`."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that revenue movement analysis is based on complete weekly data, avoiding partial week fluctuations."",
      ""validation_sql"": ""SELECT\n  SUM(CASE WHEN (movement_financial_week = min_week) THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS current_week_diff,\n  SUM(CASE WHEN (movement_financial_week != min_week) THEN GROSS_AMOUNT_DIFF ELSE 0 END) AS non_current_week_diff,\n  SUM(GROSS_AMOUNT_DIFF) AS total_diff\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nWHERE\n  movement_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""hierarchical"",
      ""primary_metric"": ""agency_parent"",
      ""related_metrics"": [
        ""account_number""
      ],
      ""relationship_description"": ""Account numbers are typically nested under agency parents, forming a hierarchical relationship."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Allows for drill-down analysis from overall agency performance to individual account performance."",
      ""validation_sql"": ""SELECT\n  agency_parent,\n  COUNT(DISTINCT account_number) AS distinct_accounts\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.revenue_movement`\nGROUP BY\n  agency_parent\nHAVING\n  COUNT(DISTINCT account_number) > 1\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,36
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""9269e9c6-1ad0-4415-96c3-aca8a710ba01"",
    ""dashboard_name"": ""Team Sales Performance - FY26 (Interim)"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 7,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 32,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_parent"",
      ""financial_quarter"",
      ""financial_short_month"",
      ""sales_segment_l_2_name"",
      ""unified_publication_name"",
      ""revenue_group_subtype"",
      ""revenue_type"",
      ""relative_fy_year_offset"",
      ""booking_line_created_date"",
      ""fix_date_lod""
    ],
    ""date_range_detected"": ""FY24 and FY25 relative to 23/06/2025"",
    ""hardcoded_dates_found"": [
      ""23/06/2025""
    ],
    ""hardcoded_values_found"": [
      ""Jul Q1 H1"",
      ""DOUBLECLICK"",
      ""0"",
      ""1"",
      ""DIGITAL"",
      ""Digital Other"",
      ""OUTSTREAM"",
      ""XTEND"",
      ""EDMEDIA"",
      ""ECOMMERCE"",
      ""Consortium QLD"",
      ""$"",
      ""$\\'000'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative date functions (e.g., CURRENT_DATE())"",
      ""lookup values (publication types, sales segments, revenue types) should use governed reference tables"",
      ""currency display logic should be a dashboard parameter, not hardcoded in SQL""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""WITH base_data AS (\n  SELECT\n    t0.advertiser_parent,\n    t0.financial_quarter,\n    t0.financial_short_month,\n    t0.booking_line_created_date,\n    t0.fix_date_lod,\n    t0.gross_revenue_amount,\n    t0.relative_fy_year_offset,\n    t0.revenue_group_subtype,\n    t0.revenue_type,\n    t0.sales_segment_l_2_name,\n    t0.sales_segment_l_2_name_sync,\n    t0.unified_publication_name,\n    DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS report_as_of_date_hardcoded\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n),\nderived_dimensions AS (\n  SELECT\n    advertiser_parent,\n    financial_quarter,\n    financial_short_month,\n    sales_segment_l_2_name,\n    unified_publication_name,\n    revenue_group_subtype,\n    revenue_type,\n    relative_fy_year_offset,\n    booking_line_created_date,\n    fix_date_lod,\n    gross_revenue_amount,\n    report_as_of_date_hardcoded,\n    DATETIME_ADD(SAFE_CAST(report_as_of_date_hardcoded AS DATETIME), INTERVAL -365 DAY) AS report_date_minus_1_year,\n    SAFE_CAST(financial_quarter AS INT64) AS financial_quarter_int,\n    CONCAT('Q', SAFE_CAST(financial_quarter AS STRING)) AS quarter_string,\n    CASE\n      WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1'\n      WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2'\n      ELSE SAFE_CAST(financial_quarter AS STRING)\n    END AS half_year,\n    CONCAT(SAFE_CAST(financial_short_month AS STRING), ' ', CONCAT('Q',SAFE_CAST(financial_quarter AS STRING)), ' ', CASE WHEN (SAFE_CAST(financial_quarter AS INT64) >= 1 AND SAFE_CAST(financial_quarter AS INT64) <= 2) THEN 'H1' WHEN (SAFE_CAST(financial_quarter AS INT64) >= 3 AND SAFE_CAST(financial_quarter AS INT64) <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END) AS composite_quarter_half_year,\n    (advertiser_parent != 'DOUBLECLICK') AS is_not_doubleclick_advertiser,\n    PARSE_DATE('%Y-%m-%d', booking_line_created_date) AS booking_date_parsed,\n    (relative_fy_year_offset = 0) AS is_current_fy,\n    (relative_fy_year_offset = 1) AS is_previous_fy,\n    (revenue_group_subtype = 'DIGITAL') AS is_digital_revenue_group_subtype,\n    (revenue_type = 'DIGITAL') AS is_digital_revenue_type,\n    (sales_segment_l_2_name_sync = 'Digital Other') AS is_digital_other_sales_segment,\n    UPPER(SAFE_CAST(unified_publication_name AS STRING)) AS unified_publication_name_upper,\n    (UPPER(SAFE_CAST(unified_publication_name AS STRING)) IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')) AS is_specific_publication_type\n  FROM base_data\n),\ncalculated_metrics AS (\n  SELECT\n    advertiser_parent,\n    financial_quarter,\n    financial_short_month,\n    sales_segment_l_2_name,\n    unified_publication_name,\n    revenue_group_subtype,\n    revenue_type,\n    relative_fy_year_offset,\n    booking_line_created_date,\n    fix_date_lod,\n    gross_revenue_amount,\n    report_as_of_date_hardcoded,\n    report_date_minus_1_year,\n    financial_quarter_int,\n    quarter_string,\n    half_year,\n    composite_quarter_half_year,\n    is_not_doubleclick_advertiser,\n    booking_date_parsed,\n    is_current_fy,\n    is_previous_fy,\n    is_digital_revenue_group_subtype,\n    is_digital_revenue_type,\n    is_digital_other_sales_segment,\n    unified_publication_name_upper,\n    is_specific_publication_type,\n    CASE WHEN is_current_fy THEN gross_revenue_amount ELSE 0 END AS current_fy_gross_revenue,\n    CASE WHEN is_previous_fy THEN gross_revenue_amount ELSE 0 END AS previous_fy_gross_revenue,\n    CASE\n      WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment AND is_not_doubleclick_advertiser)\n      THEN fix_date_lod\n      ELSE booking_date_parsed\n    END AS digital_revenue_condition_date,\n    CASE\n      WHEN (is_current_fy AND is_specific_publication_type) THEN gross_revenue_amount\n      WHEN (is_current_fy AND (SAFE_CAST(CASE WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment AND is_not_doubleclick_advertiser) THEN fix_date_lod ELSE booking_date_parsed END AS DATETIME) <= SAFE_CAST(report_date_minus_1_year AS DATETIME))) THEN gross_revenue_amount\n      ELSE NULL\n    END AS revenue_based_on_fy_pub_date_logic\n  FROM derived_dimensions\n)\nSELECT\n  advertiser_parent,\n  financial_quarter,\n  financial_short_month,\n  sales_segment_l_2_name,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type,\n  relative_fy_year_offset,\n  booking_line_created_date,\n  fix_date_lod,\n  financial_quarter_int,\n  quarter_string,\n  half_year,\n  composite_quarter_half_year,\n  SUM(gross_revenue_amount) AS total_gross_revenue,\n  SUM(current_fy_gross_revenue) AS sum_current_fy_gross_revenue,\n  SUM(previous_fy_gross_revenue) AS sum_previous_fy_gross_revenue,\n  SUM(SAFE_DIVIDE(current_fy_gross_revenue, 1000)) AS sum_current_fy_gross_revenue_k,\n  SUM(SAFE_DIVIDE(previous_fy_gross_revenue, 1000)) AS sum_previous_fy_gross_revenue_k,\n  SUM(COALESCE(revenue_based_on_fy_pub_date_logic, 0)) AS sum_final_revenue_metric_raw,\n  SUM(SAFE_DIVIDE(COALESCE(revenue_based_on_fy_pub_date_logic, 0), 1000)) AS sum_final_revenue_metric_k\nFROM calculated_metrics\nWHERE\n  composite_quarter_half_year IN ('Jul Q1 H1')\n  AND sales_segment_l_2_name IN ('Consortium QLD')\nGROUP BY\n  advertiser_parent,\n  financial_quarter,\n  financial_short_month,\n  sales_segment_l_2_name,\n  unified_publication_name,\n  revenue_group_subtype,\n  revenue_type,\n  relative_fy_year_offset,\n  booking_line_created_date,\n  fix_date_lod,\n  financial_quarter_int,\n  quarter_string,\n  half_year,\n  composite_quarter_half_year\nORDER BY\n  advertiser_parent ASC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.advertiser_parent) as unique_advertiser_parents,\n  COUNT(DISTINCT t0.financial_quarter) as unique_financial_quarters,\n  COUNT(DISTINCT t0.financial_short_month) as unique_financial_months,\n  COUNT(DISTINCT t0.sales_segment_l_2_name) as unique_sales_segments,\n  COUNT(DISTINCT t0.unified_publication_name) as unique_publications,\n  MIN(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) as earliest_booking_date,\n  MAX(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) as latest_booking_date,\n  MIN(t0.fix_date_lod) as earliest_fix_date_lod,\n  MAX(t0.fix_date_lod) as latest_fix_date_lod,\n  APPROX_COUNT_DISTINCT(CONCAT(t0.advertiser_parent, t0.booking_line_created_date, t0.gross_revenue_amount)) as approx_unique_transactions\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 2 YEAR)\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(t0.gross_revenue_amount) > 0 THEN 'PASS' ELSE 'FAIL' END as gross_revenue_test,\n  CASE WHEN COUNT(DISTINCT t0.advertiser_parent) > 0 THEN 'PASS' ELSE 'FAIL' END as advertiser_count_test,\n  CASE WHEN MAX(PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date)) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN COUNTIF(t0.relative_fy_year_offset = 0) > 0 THEN 'PASS' ELSE 'FAIL' END as current_fy_data_test,\n  CASE WHEN COUNTIF(t0.relative_fy_year_offset = 1) > 0 THEN 'PASS' ELSE 'FAIL' END as previous_fy_data_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Digital Revenue Type Consistency' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.revenue_group_subtype = 'DIGITAL' AND t0.revenue_type = 'DIGITAL' THEN 1 ELSE 0 END) as digital_revenue_consistent_records,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.revenue_group_subtype = 'DIGITAL' AND t0.revenue_type = 'DIGITAL' THEN 1 ELSE 0 END), COUNT(*)) * 100 as consistency_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'FY Offset Logic Check' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN t0.relative_fy_year_offset IN (0, 1) THEN 1 ELSE 0 END) as valid_fy_offset_records,\n  SAFE_DIVIDE(SUM(CASE WHEN t0.relative_fy_year_offset IN (0, 1) THEN 1 ELSE 0 END), COUNT(*)) * 100 as valid_fy_offset_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR);"",
    ""sample_data_sql"": ""SELECT \n  t0.advertiser_parent,\n  t0.financial_quarter,\n  t0.financial_short_month,\n  t0.booking_line_created_date,\n  t0.fix_date_lod,\n  t0.gross_revenue_amount,\n  t0.relative_fy_year_offset,\n  t0.revenue_group_subtype,\n  t0.revenue_type,\n  t0.sales_segment_l_2_name,\n  t0.sales_segment_l_2_name_sync,\n  t0.unified_publication_name\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE PARSE_DATE('%Y-%m-%d', t0.booking_line_created_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 3 MONTH)\nORDER BY t0.booking_line_created_date DESC, t0.gross_revenue_amount DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""23/06/2025"",
          ""original_format"": ""2025-06-23 10:00:32.354880+00"",
          ""context"": ""Used as a fixed 'report as of' date (clmn0_) and then for calculating a date 365 days prior (clmn11_) for revenue logic. This date is in the future relative to current date, but likely represents a specific FY end or reporting period for FY25."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a dashboard parameter (e.g., @report_date) to make the dashboard dynamic and relevant to the current financial period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Jul Q1 H1'""
          ],
          ""context"": ""Filter for a specific composite quarter/half-year string (clmn11_)."",
          ""suggested_governance"": ""Use date parameters to derive the current quarter/half-year dynamically, or join to a date dimension table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DOUBLECLICK'""
          ],
          ""context"": ""Exclusion filter for advertiser_parent (clmn1_ != 'DOUBLECLICK')."",
          ""suggested_governance"": ""Manage excluded advertisers in a configuration table or parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1""
          ],
          ""context"": ""Used for `relative_fy_year_offset` to identify current (0) and previous (1) financial years."",
          ""suggested_governance"": ""These are likely standard, but could be mapped to descriptive labels in a lookup table if needed for clarity or future changes."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'DIGITAL'""
          ],
          ""context"": ""Filters for `revenue_group_subtype` and `revenue_type`."",
          ""suggested_governance"": ""Manage revenue types/subtypes in a governed reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Digital Other'""
          ],
          ""context"": ""Filter for `sales_segment_l_2_name_sync`."",
          ""suggested_governance"": ""Manage sales segments in a governed reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'OUTSTREAM'"",
            ""'XTEND'"",
            ""'EDMEDIA'"",
            ""'ECOMMERCE'""
          ],
          ""context"": ""Specific `unified_publication_name` types used in revenue calculation logic."",
          ""suggested_governance"": ""Manage publication types in a governed reference table."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'Consortium QLD'""
          ],
          ""context"": ""Filter for `sales_segment_l_2_name`."",
          ""suggested_governance"": ""Manage sales segments in a governed reference table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""'$'"",
            ""'$\\'000'""
          ],
          ""context"": ""Conditional logic to determine if revenue should be displayed in thousands or as raw values. This is a display concern embedded in the calculation."",
          ""suggested_governance"": ""This logic should be handled at the presentation layer (Looker Studio field settings) or via a dashboard parameter, not hardcoded in the SQL query."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR)`)."",
      ""Replace hardcoded lookup values (e.g., 'Jul Q1 H1', 'Consortium QLD', publication types, revenue types) with joins to governed reference tables or dashboard parameters."",
      ""Use configuration tables for business rules (e.g., specific publication types, advertiser exclusions) instead of hardcoded logic within the query."",
      ""Implement a dashboard parameter for currency display (e.g., 'display_in_thousands' boolean) to control the division by 1000, rather than hardcoding the '$' vs '$\\'000' string comparison.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_parent_dim"",
      ""metric_name"": ""Advertiser Parent"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""customer"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The top-level parent company or group for an advertiser."",
      ""sql_logic"": ""t0.advertiser_parent"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for grouping and filtering sales performance by major advertiser entities."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_dim"",
      ""metric_name"": ""Financial Quarter"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The financial quarter (e.g., '1', '2', '3', '4') associated with the sales record."",
      ""sql_logic"": ""t0.financial_quarter"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key dimension for time-based sales performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_short_month_dim"",
      ""metric_name"": ""Financial Short Month"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The abbreviated financial month (e.g., 'Jul', 'Aug') associated with the sales record."",
      ""sql_logic"": ""t0.financial_short_month"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for detailed time-based sales performance analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l2_name_dim"",
      ""metric_name"": ""Sales Segment L2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The second-level sales segment name for the sales record."",
      ""sql_logic"": ""t0.sales_segment_l_2_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""sales_segment_l_2_name IN ('Consortium QLD')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for segmenting sales performance by internal sales team or market segments."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Consortium QLD'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name_dim"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unified name of the publication associated with the ad sale."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Allows analysis of sales performance by specific publication or platform."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_group_subtype_dim"",
      ""metric_name"": ""Revenue Group Subtype"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The subtype of the revenue group (e.g., 'DIGITAL')."",
      ""sql_logic"": ""t0.revenue_group_subtype"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue by its specific group subtype, often for digital vs. print distinction."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_type_dim"",
      ""metric_name"": ""Revenue Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of revenue (e.g., 'DIGITAL')."",
      ""sql_logic"": ""t0.revenue_type"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to categorize revenue by its general type, often for digital vs. print distinction."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""relative_fy_year_offset_dim"",
      ""metric_name"": ""Relative FY Year Offset"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""An integer indicating the financial year offset relative to the current FY (0 for current FY, 1 for previous FY)."",
      ""sql_logic"": ""t0.relative_fy_year_offset"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Critical for year-over-year comparisons and filtering data for specific financial years."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0"",
        ""1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_line_created_date_dim"",
      ""metric_name"": ""Booking Line Created Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date when the sales booking line was created."",
      ""sql_logic"": ""t0.booking_line_created_date"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary date dimension for sales activity tracking."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fix_date_lod_dim"",
      ""metric_name"": ""Fix Date LOD"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A 'fix date' or 'last updated date' for the sales record, used in specific revenue calculations."",
      ""sql_logic"": ""t0.fix_date_lod"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""An auxiliary date field, specifically used in complex digital revenue logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_quarter_int_calc_dim"",
      ""metric_name"": ""Financial Quarter (Integer)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_quarter_dim""
      ],
      ""business_description"": ""The financial quarter cast as an integer for numerical comparisons."",
      ""sql_logic"": ""SAFE_CAST(financial_quarter AS INT64)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Intermediate calculation for deriving half-year and composite quarter strings."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""quarter_string_calc_dim"",
      ""metric_name"": ""Quarter String"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""financial_quarter_dim""
      ],
      ""business_description"": ""The financial quarter prefixed with 'Q' (e.g., 'Q1')."",
      ""sql_logic"": ""CONCAT('Q', SAFE_CAST(financial_quarter AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Intermediate calculation for creating the composite quarter/half-year string."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""half_year_calc_dim"",
      ""metric_name"": ""Half Year"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""financial_quarter_int_calc_dim""
      ],
      ""business_description"": ""Derives 'H1' for Q1/Q2 and 'H2' for Q3/Q4 based on the financial quarter."",
      ""sql_logic"": ""CASE WHEN (financial_quarter_int >= 1 AND financial_quarter_int <= 2) THEN 'H1' WHEN (financial_quarter_int >= 3 AND financial_quarter_int <= 4) THEN 'H2' ELSE SAFE_CAST(financial_quarter AS STRING) END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for half-yearly reporting and analysis."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""composite_quarter_half_year_calc_dim"",
      ""metric_name"": ""Composite Quarter Half Year"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""quarterly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""financial_short_month_dim"",
        ""quarter_string_calc_dim"",
        ""half_year_calc_dim""
      ],
      ""business_description"": ""A concatenated string representing the month, quarter, and half-year (e.g., 'Jul Q1 H1')."",
      ""sql_logic"": ""CONCAT(financial_short_month, ' ', quarter_string, ' ', half_year)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""composite_quarter_half_year IN ('Jul Q1 H1')""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key filter dimension for specific reporting periods, but hardcoded values make it inflexible."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Jul Q1 H1'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_not_doubleclick_advertiser_flag"",
      ""metric_name"": ""Is Not Doubleclick Advertiser"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""advertiser_parent_dim""
      ],
      ""business_description"": ""Flag indicating if the advertiser is not 'DOUBLECLICK'. Used in complex revenue logic."",
      ""sql_logic"": ""advertiser_parent != 'DOUBLECLICK'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Excludes specific advertiser data from certain revenue calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DOUBLECLICK'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""booking_date_parsed_calc_dim"",
      ""metric_name"": ""Booking Date Parsed"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""booking_line_created_date_dim""
      ],
      ""business_description"": ""The booking line created date parsed into a standard date format."",
      ""sql_logic"": ""PARSE_DATE('%Y-%m-%d', booking_line_created_date)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Intermediate step for date comparisons in revenue calculations."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_current_fy_flag"",
      ""metric_name"": ""Is Current Financial Year"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim""
      ],
      ""business_description"": ""Flag indicating if the record belongs to the current financial year (offset 0)."",
      ""sql_logic"": ""relative_fy_year_offset = 0"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter and calculate current FY specific metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""0""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_previous_fy_flag"",
      ""metric_name"": ""Is Previous Financial Year"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""relative_fy_year_offset_dim""
      ],
      ""business_description"": ""Flag indicating if the record belongs to the previous financial year (offset 1)."",
      ""sql_logic"": ""relative_fy_year_offset = 1"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used to filter and calculate previous FY specific metrics for year-over-year comparison."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""1""
      ],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_revenue_group_subtype_flag"",
      ""metric_name"": ""Is Digital Revenue Group Subtype"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""revenue_group_subtype_dim""
      ],
      ""business_description"": ""Flag indicating if the revenue group subtype is 'DIGITAL'."",
      ""sql_logic"": ""revenue_group_subtype = 'DIGITAL'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used in complex digital revenue calculation logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_revenue_type_flag"",
      ""metric_name"": ""Is Digital Revenue Type"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""revenue_type_dim""
      ],
      ""business_description"": ""Flag indicating if the revenue type is 'DIGITAL'."",
      ""sql_logic"": ""revenue_type = 'DIGITAL'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used in complex digital revenue calculation logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'DIGITAL'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_digital_other_sales_segment_flag"",
      ""metric_name"": ""Is Digital Other Sales Segment"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""sales_segment_l_2_name_sync""
      ],
      ""business_description"": ""Flag indicating if the sales segment sync is 'Digital Other'."",
      ""sql_logic"": ""sales_segment_l_2_name_sync = 'Digital Other'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used in complex digital revenue calculation logic."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'Digital Other'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""unified_publication_name_upper_calc_dim"",
      ""metric_name"": ""Unified Publication Name (Uppercase)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""unified_publication_name_dim""
      ],
      ""business_description"": ""The unified publication name converted to uppercase for consistent comparison."",
      ""sql_logic"": ""UPPER(SAFE_CAST(unified_publication_name AS STRING))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Intermediate step for filtering by specific publication types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_specific_publication_type_flag"",
      ""metric_name"": ""Is Specific Publication Type"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""boolean"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""unified_publication_name_upper_calc_dim""
      ],
      ""business_description"": ""Flag indicating if the publication is one of 'OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE'."",
      ""sql_logic"": ""unified_publication_name_upper IN ('OUTSTREAM', 'XTEND', 'EDMEDIA', 'ECOMMERCE')"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""boolean"",
      ""business_context"": ""Used in complex revenue calculation logic to identify specific digital publication types."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'OUTSTREAM'"",
        ""'XTEND'"",
        ""'EDMEDIA'"",
        ""'ECOMMERCE'""
      ],
      ""governance_issues"": [
        ""lookup values should use reference table""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""gross_revenue_amount_base_measure"",
      ""metric_name"": ""Gross Revenue Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw gross revenue amount for a sales record."",
      ""sql_logic"": ""t0.gross_revenue_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""The fundamental revenue metric for sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_measure"",
      ""metric_name"": ""Current FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base_measure"",
        ""is_current_fy_flag""
      ],
      ""business_description"": ""Gross revenue amount specifically for the current financial year."",
      ""sql_logic"": ""CASE WHEN is_current_fy THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for tracking current period sales performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_measure"",
      ""metric_name"": ""Previous FY Gross Revenue"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base_measure"",
        ""is_previous_fy_flag""
      ],
      ""business_description"": ""Gross revenue amount specifically for the previous financial year."",
      ""sql_logic"": ""CASE WHEN is_previous_fy THEN gross_revenue_amount ELSE 0 END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key metric for year-over-year sales performance comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_fy_gross_revenue_k_measure"",
      ""metric_name"": ""Current FY Gross Revenue ('000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""current_fy_gross_revenue_measure""
      ],
      ""business_description"": ""Current FY Gross Revenue expressed in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(current_fy_gross_revenue, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for display purposes to present large revenue figures concisely."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""previous_fy_gross_revenue_k_measure"",
      ""metric_name"": ""Previous FY Gross Revenue ('000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""previous_fy_gross_revenue_measure""
      ],
      ""business_description"": ""Previous FY Gross Revenue expressed in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(previous_fy_gross_revenue, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for display purposes to present large revenue figures concisely for comparison."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""digital_revenue_condition_date_calc_dim"",
      ""metric_name"": ""Digital Revenue Condition Date"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""is_digital_revenue_type_flag"",
        ""is_digital_revenue_group_subtype_flag"",
        ""is_digital_other_sales_segment_flag"",
        ""is_not_doubleclick_advertiser_flag"",
        ""fix_date_lod_dim"",
        ""booking_date_parsed_calc_dim""
      ],
      ""business_description"": ""Determines which date (fix_date_lod or booking_line_created_date) to use for specific digital revenue calculations based on multiple conditions."",
      ""sql_logic"": ""CASE WHEN (is_digital_revenue_type AND is_digital_revenue_group_subtype AND is_digital_other_sales_segment AND is_not_doubleclick_advertiser) THEN fix_date_lod ELSE booking_date_parsed END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Intermediate date field for complex revenue logic, indicating the relevant date for a transaction based on its digital attributes."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""revenue_based_on_fy_pub_date_logic_measure"",
      ""metric_name"": ""Revenue Based on FY, Publication & Date Logic"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""gross_revenue_amount_base_measure"",
        ""is_current_fy_flag"",
        ""is_specific_publication_type_flag"",
        ""digital_revenue_condition_date_calc_dim""
      ],
      ""business_description"": ""Gross revenue amount filtered by current FY and either specific publication types OR a complex date condition relative to a hardcoded report date."",
      ""sql_logic"": ""CASE WHEN (is_current_fy AND is_specific_publication_type) THEN gross_revenue_amount WHEN (is_current_fy AND (SAFE_CAST(digital_revenue_condition_date AS DATETIME) <= SAFE_CAST(report_date_minus_1_year AS DATETIME))) THEN gross_revenue_amount ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A highly specific revenue calculation used for a particular business view, combining multiple conditions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""23/06/2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""date should be parameterised""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""final_revenue_metric_raw_measure"",
      ""metric_name"": ""Final Revenue Metric (Raw)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""revenue_based_on_fy_pub_date_logic_measure""
      ],
      ""business_description"": ""The final calculated revenue metric, handling NULLs from the complex revenue logic by defaulting to 0."",
      ""sql_logic"": ""COALESCE(revenue_based_on_fy_pub_date_logic, 0)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""This is one of the primary revenue figures displayed on the dashboard, representing a specific slice of revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls handled by COALESCE""
      ]
    },
    {
      ""metric_id"": ""final_revenue_metric_k_measure"",
      ""metric_name"": ""Final Revenue Metric ('000s)"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""mathematical"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""final_revenue_metric_raw_measure""
      ],
      ""business_description"": ""The final calculated revenue metric, expressed in thousands."",
      ""sql_logic"": ""SAFE_DIVIDE(final_revenue_metric_raw, 1000)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Used for display purposes to present the final revenue metric concisely."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment L2 Name Sync"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A synchronized version of the sales segment L2 name, used in specific digital revenue logic."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""An internal dimension used for specific business rule application."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_fy_gross_revenue_k_measure"",
      ""related_metrics"": [
        ""current_fy_gross_revenue_measure""
      ],
      ""relationship_description"": ""Current FY Gross Revenue ('000s) is derived by dividing Current FY Gross Revenue by 1000."",
      ""mathematical_formula"": ""current_fy_gross_revenue_k_measure = current_fy_gross_revenue_measure / 1000"",
      ""business_validation"": ""Ensures large revenue figures are presented in a more readable format (thousands)."",
      ""validation_sql"": ""SELECT SUM(current_fy_gross_revenue_k_measure * 1000) = SUM(current_fy_gross_revenue_measure) FROM calculated_metrics WHERE is_current_fy;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""previous_fy_gross_revenue_k_measure"",
      ""related_metrics"": [
        ""previous_fy_gross_revenue_measure""
      ],
      ""relationship_description"": ""Previous FY Gross Revenue ('000s) is derived by dividing Previous FY Gross Revenue by 1000."",
      ""mathematical_formula"": ""previous_fy_gross_revenue_k_measure = previous_fy_gross_revenue_measure / 1000"",
      ""business_validation"": ""Ensures large revenue figures are presented in a more readable format (thousands) for year-over-year comparison."",
      ""validation_sql"": ""SELECT SUM(previous_fy_gross_revenue_k_measure * 1000) = SUM(previous_fy_gross_revenue_measure) FROM calculated_metrics WHERE is_previous_fy;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""final_revenue_metric_k_measure"",
      ""related_metrics"": [
        ""final_revenue_metric_raw_measure""
      ],
      ""relationship_description"": ""Final Revenue Metric ('000s) is derived by dividing Final Revenue Metric (Raw) by 1000."",
      ""mathematical_formula"": ""final_revenue_metric_k_measure = final_revenue_metric_raw_measure / 1000"",
      ""business_validation"": ""Ensures the specific final revenue figure is presented in a more readable format (thousands)."",
      ""validation_sql"": ""SELECT SUM(final_revenue_metric_k_measure * 1000) = SUM(final_revenue_metric_raw_measure) FROM calculated_metrics;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""revenue_based_on_fy_pub_date_logic_measure"",
      ""related_metrics"": [
        ""gross_revenue_amount_base_measure"",
        ""is_current_fy_flag"",
        ""is_specific_publication_type_flag"",
        ""digital_revenue_condition_date_calc_dim""
      ],
      ""relationship_description"": ""This complex revenue metric depends on the base gross revenue, whether it's the current FY, if it's a specific publication type, and a conditionally derived date for comparison."",
      ""mathematical_formula"": ""IF (is_current_fy AND is_specific_publication_type) THEN gross_revenue_amount ELSE IF (is_current_fy AND digital_revenue_condition_date <= report_date_minus_1_year) THEN gross_revenue_amount ELSE NULL"",
      ""business_validation"": ""This logic defines a specific subset of revenue crucial for the dashboard's focus, likely related to digital or specific product lines within the current FY."",
      ""validation_sql"": ""SELECT COUNTIF(revenue_based_on_fy_pub_date_logic_measure IS NOT NULL) AS non_null_records, COUNTIF(is_current_fy_flag AND (is_specific_publication_type_flag OR (digital_revenue_condition_date_calc_dim <= DATETIME_ADD(SAFE_CAST(DATE(TIMESTAMP '2025-06-23 10:00:32.354880+00', 'Australia/Sydney') AS DATETIME), INTERVAL -365 DAY)))) AS expected_records FROM calculated_metrics;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""composite_quarter_half_year_calc_dim"",
      ""related_metrics"": [
        ""sum_current_fy_gross_revenue"",
        ""sum_previous_fy_gross_revenue"",
        ""sum_final_revenue_metric_raw""
      ],
      ""relationship_description"": ""All aggregated metrics are filtered by the 'Jul Q1 H1' composite quarter/half-year string, limiting the scope of the dashboard's data."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""Ensures the dashboard focuses on a very specific, hardcoded reporting period. This makes the dashboard static unless the filter is manually updated."",
      ""validation_sql"": ""SELECT COUNT(*) FROM calculated_metrics WHERE composite_quarter_half_year NOT IN ('Jul Q1 H1'); -- Should return 0 if filter is strictly applied"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""sales_segment_l2_name_dim"",
      ""related_metrics"": [
        ""sum_current_fy_gross_revenue"",
        ""sum_previous_fy_gross_revenue"",
        ""sum_final_revenue_metric_raw""
      ],
      ""relationship_description"": ""All aggregated metrics are filtered by the 'Consortium QLD' sales segment, limiting the scope of the dashboard's data to a specific business unit/region."",
      ""mathematical_formula"": ""N/A (filter)"",
      ""business_validation"": ""Ensures the dashboard focuses on sales performance for a specific sales segment. Hardcoded value requires manual updates if the segment changes or if other segments need to be analyzed."",
      ""validation_sql"": ""SELECT COUNT(*) FROM calculated_metrics WHERE sales_segment_l_2_name NOT IN ('Consortium QLD'); -- Should return 0 if filter is strictly applied"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,37
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""80ca81f3-0671-40ef-a0a9-825a1580ca1b"",
    ""dashboard_name"": ""Team Sales Performance"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 2,
    ""consolidation_score"": 8,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""none"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""advertiser_name"",
      ""portfolio_conformed_name_sync"",
      ""sales_segment_l_2_name_sync""
    ],
    ""date_range_detected"": ""N/A"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [
      ""'GAD RAM A1'"",
      ""'HBT RAM A1'"",
      ""'VIC DIRECT A7'"",
      ""'VIC DIRECT A8'"",
      ""'VIC DIRECT A9'""
    ],
    ""governance_opportunities"": [
      ""portfolio names should use a reference table or parameter""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This SQL calculates key sales performance metrics, inferring common metrics (sales_amount, deal_id) that would typically be present in an 'adsales_performance' table for a 'Team Sales Performance' dashboard.\n-- The original queries provided were primarily for populating filter dropdowns (dimensions).\n\nWITH base_sales_data AS (\n  SELECT\n    t0.advertiser_name,\n    t0.portfolio_conformed_name_sync,\n    t0.sales_segment_l_2_name_sync,\n    -- Inferred metrics based on dashboard name 'Team Sales Performance'\n    -- Replace 'sales_amount_column' and 'deal_id_column' with actual column names if known.\n    COALESCE(t0.sales_amount_column, 0) AS sales_amount, -- Assuming a sales amount column\n    t0.deal_id_column AS deal_id, -- Assuming a deal identifier column\n    t0.transaction_date_column AS transaction_date -- Assuming a date column for filtering\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n  -- Add a date filter for performance dashboards, assuming a 'transaction_date_column'\n  WHERE t0.transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Example: last 90 days\n)\nSELECT\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync,\n  COUNT(DISTINCT deal_id) AS number_of_deals,\n  SUM(sales_amount) AS total_sales_amount,\n  SAFE_DIVIDE(SUM(sales_amount), COUNT(DISTINCT deal_id)) AS average_deal_value,\n  COUNT(*) AS record_count_for_group\nFROM base_sales_data\nGROUP BY\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync\nORDER BY\n  total_sales_amount DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- This SQL helps understand the data structure, grain, and key dimensions of the primary data source.\nSELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT portfolio_conformed_name_sync) AS unique_portfolios,\n  COUNT(DISTINCT sales_segment_l_2_name_sync) AS unique_sales_segments,\n  MIN(transaction_date_column) AS earliest_transaction_date, -- Assuming a transaction_date_column\n  MAX(transaction_date_column) AS latest_transaction_date, -- Assuming a transaction_date_column\n  APPROX_COUNT_DISTINCT(deal_id_column) AS approx_unique_deals -- Assuming a deal_id_column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 180 DAY) -- Sample for recent data\nLIMIT 1;"",
    ""validation_sql"": ""-- This SQL provides a quick validation of data presence and basic metric calculations.\nSELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS data_presence_test,\n  CASE WHEN COUNT(DISTINCT advertiser_name) > 0 THEN 'PASS' ELSE 'FAIL' END AS advertiser_distinct_test,\n  CASE WHEN SUM(sales_amount_column) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END AS sales_amount_not_null_test, -- Assuming sales_amount_column\n  CASE WHEN MAX(transaction_date_column) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS data_freshness_test -- Assuming transaction_date_column\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) -- Check recent data\nLIMIT 1;"",
    ""business_rules_sql"": ""-- This SQL validates a common business rule: ensuring key dimensions are not null.\nSELECT\n  'Business Rule Validation' AS validation_type,\n  'Non-Null Key Dimensions' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN advertiser_name IS NOT NULL AND portfolio_conformed_name_sync IS NOT NULL AND sales_segment_l_2_name_sync IS NOT NULL THEN 1 ELSE 0 END) AS records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN advertiser_name IS NOT NULL AND portfolio_conformed_name_sync IS NOT NULL AND sales_segment_l_2_name_sync IS NOT NULL THEN 1 ELSE 0 END), COUNT(*)) * 100 AS pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Focus on recent data\nLIMIT 1;"",
    ""sample_data_sql"": ""-- This SQL retrieves a representative sample of raw data for further analysis.\nSELECT\n  advertiser_name,\n  portfolio_conformed_name_sync,\n  sales_segment_l_2_name_sync,\n  sales_amount_column AS sales_amount, -- Inferred sales amount\n  deal_id_column AS deal_id, -- Inferred deal ID\n  transaction_date_column AS transaction_date, -- Inferred transaction date\n  -- Add any other relevant columns from the table\n  *\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) -- Sample from recent data\nORDER BY transaction_date_column DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'GAD RAM A1'"",
            ""'HBT RAM A1'"",
            ""'VIC DIRECT A7'"",
            ""'VIC DIRECT A8'"",
            ""'VIC DIRECT A9'""
          ],
          ""context"": ""Used in a WHERE IN clause to filter 'portfolio_conformed_name_sync'. This is likely for a specific filter selection in the dashboard."",
          ""suggested_governance"": ""These values should ideally be managed in a reference table (e.g., `dim_portfolio`) and joined, or passed as a parameter from the dashboard UI."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded portfolio names with a join to a governed reference table (e.g., `dim_portfolio`) or use a Looker Studio parameter for dynamic filtering."",
      ""Introduce date parameters (e.g., `start_date`, `end_date`) for all date filters instead of hardcoded relative dates (e.g., `DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY)`).""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the sales performance record. Used for grouping and filtering."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""Optional filter on portfolio_conformed_name_sync""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A primary dimension for analyzing sales performance by individual advertiser."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for variations in naming (e.g., 'ABC Corp' vs 'ABC Corporation')""
      ]
    },
    {
      ""metric_id"": ""portfolio_conformed_name_sync"",
      ""metric_name"": ""Portfolio Conformed Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The conformed name of the portfolio associated with the sales record. Used for filtering and potentially grouping."",
      ""sql_logic"": ""t0.portfolio_conformed_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A key dimension for segmenting sales performance by portfolio, often used in dashboard filters."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'GAD RAM A1'"",
        ""'HBT RAM A1'"",
        ""'VIC DIRECT A7'"",
        ""'VIC DIRECT A8'"",
        ""'VIC DIRECT A9'""
      ],
      ""governance_issues"": [
        ""Hardcoded values used in filters; should be managed via reference table or parameter.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_segment_l_2_name_sync"",
      ""metric_name"": ""Sales Segment L2 Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The Level 2 sales segment name associated with the sales record. Used for grouping and filtering."",
      ""sql_logic"": ""t0.sales_segment_l_2_name_sync"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Provides a hierarchical view of sales performance by segment, useful for organizational reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_sales_amount"",
      ""metric_name"": ""Total Sales Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all sales amounts within the selected dimensions and filters. This is an inferred metric based on the dashboard's purpose."",
      ""sql_logic"": ""SUM(sales_amount_column)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""Date filter (e.g., last 90 days)"",
        ""Optional filters on advertiser_name, portfolio_conformed_name_sync, sales_segment_l_2_name_sync""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A core KPI for sales performance, indicating the total revenue generated."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for nulls in sales_amount_column, requiring COALESCE or similar handling.""
      ]
    },
    {
      ""metric_id"": ""number_of_deals"",
      ""metric_name"": ""Number of Deals"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The count of unique deals within the selected dimensions and filters. This is an inferred metric based on the dashboard's purpose."",
      ""sql_logic"": ""COUNT(DISTINCT deal_id_column)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""Date filter (e.g., last 90 days)"",
        ""Optional filters on advertiser_name, portfolio_conformed_name_sync, sales_segment_l_2_name_sync""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key KPI for sales volume and activity, indicating the number of successful transactions."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Accuracy depends on the uniqueness and consistency of deal_id_column.""
      ]
    },
    {
      ""metric_id"": ""average_deal_value"",
      ""metric_name"": ""Average Deal Value"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""ratio"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""total_sales_amount"",
        ""number_of_deals""
      ],
      ""business_description"": ""The average sales amount per deal. Calculated as Total Sales Amount / Number of Deals. This is an inferred metric based on the dashboard's purpose."",
      ""sql_logic"": ""SAFE_DIVIDE(SUM(sales_amount_column), COUNT(DISTINCT deal_id_column))"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""
      ],
      ""filters_applied"": [
        ""Date filter (e.g., last 90 days)"",
        ""Optional filters on advertiser_name, portfolio_conformed_name_sync, sales_segment_l_2_name_sync""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""An efficiency KPI for sales, indicating the typical size of a deal. Useful for understanding sales strategy and deal negotiation."",
      ""metric_category"": ""efficiency"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Division by zero if no deals are present; SAFE_DIVIDE handles this.""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""average_deal_value"",
      ""related_metrics"": [
        ""total_sales_amount"",
        ""number_of_deals""
      ],
      ""relationship_description"": ""Average Deal Value is derived directly from Total Sales Amount and Number of Deals."",
      ""mathematical_formula"": ""Average Deal Value = Total Sales Amount / Number of Deals"",
      ""business_validation"": ""Ensures that the average deal size is consistently calculated based on the underlying total sales and deal counts."",
      ""validation_sql"": ""SELECT SAFE_DIVIDE(SUM(sales_amount_column), COUNT(DISTINCT deal_id_column)) = AVG(sales_amount_column) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE transaction_date_column >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 1; -- Note: This validation is conceptual, as AVG(sales_amount_column) would be per row, not per deal. The formula is the correct one."",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_name"",
      ""related_metrics"": [
        ""portfolio_conformed_name_sync"",
        ""sales_segment_l_2_name_sync"",
        ""total_sales_amount"",
        ""number_of_deals"",
        ""average_deal_value""
      ],
      ""relationship_description"": ""Filtering by 'portfolio_conformed_name_sync' (especially with hardcoded values) directly impacts the available 'advertiser_name' values and subsequently all aggregated metrics."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that the dashboard's filters correctly narrow down the scope of analysis for all displayed metrics and dimensions."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT advertiser_name) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE portfolio_conformed_name_sync IN ('GAD RAM A1', 'HBT RAM A1') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,38
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""23c8b213-a9f0-4158-b8fa-bff14425abb5"",
    ""dashboard_name"": ""TM1 NewsQuery Tables"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions;ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 3,
    ""consolidation_score"": 3,
    ""total_metrics_identified"": 14,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""category_name"",
      ""gl_publication_code"",
      ""channel"",
      ""state""
    ],
    ""date_range_detected"": ""Specific fiscal week (202535) detected, no range"",
    ""hardcoded_dates_found"": [
      ""202535""
    ],
    ""hardcoded_values_found"": [
      ""202535 (fiscal week ID)""
    ],
    ""governance_opportunities"": [
      ""fiscal_week_id should be parameterised or use relative dates"",
      ""consider joining subscription and circulation data on common dimensions like state or publication if available in underlying data models""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query attempts to unify metrics from both subscription and circulation data sources.\n-- Note: A direct join between these two tables on common business keys (e.g., state, publication, fiscal_week_id) \n-- is not explicitly evident from the provided SQL queries. \n-- This query assumes a conceptual join on 'state' and 'fiscal_week_id' for demonstration purposes, \n-- but actual join keys might differ in the underlying data model.\n\nWITH SubscriptionsData AS (\n  SELECT\n    t0.fiscal_week_id,\n    t0.category_name,\n    t0.gl_publication_code,\n    t0.add_volume,\n    t0.closing_base,\n    t0.earned_amount,\n    t0.opening_base,\n    t0.red_volume,\n    t0.transfer_in,\n    t0.transfer_out\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions` AS t0\n  WHERE t0.fiscal_week_id = 202535 -- Example filter, replace with parameter or date range\n),\nCirculationData AS (\n  SELECT\n    -- Assuming a fiscal_week_id can be derived or joined for circulation data\n    -- For this example, we'll use a placeholder or derive from a date column if available.\n    -- If no time dimension exists, this data might be static or aggregated differently.\n    CAST(NULL AS INT64) AS fiscal_week_id, -- Placeholder, replace with actual fiscal_week_id if available\n    t0.state,\n    t0.channel,\n    t0.home_del_charge,\n    t0.returns_credit_amount,\n    t0.rev_adjust\n  FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals` AS t0\n)\nSELECT\n  COALESCE(s.fiscal_week_id, c.fiscal_week_id) AS fiscal_week_id,\n  s.category_name,\n  s.gl_publication_code,\n  c.state,\n  c.channel,\n  SUM(s.add_volume) AS total_add_volume,\n  SUM(s.closing_base) AS total_closing_base,\n  SUM(s.earned_amount) AS total_earned_amount,\n  SUM(s.opening_base) AS total_opening_base,\n  SUM(s.red_volume) AS total_red_volume,\n  SUM(s.transfer_in) AS total_transfer_in,\n  SUM(s.transfer_out) AS total_transfer_out,\n  SUM(c.home_del_charge) AS total_home_del_charge,\n  SUM(c.returns_credit_amount) AS total_returns_credit_amount,\n  SUM(c.rev_adjust) AS total_rev_adjust\nFROM SubscriptionsData s\nFULL OUTER JOIN CirculationData c\n  ON s.fiscal_week_id = c.fiscal_week_id -- Conceptual join on fiscal week\n  -- AND s.state = c.state -- Add if state is available in subscriptions data\nGROUP BY 1, 2, 3, 4, 5\nORDER BY 1 DESC\nLIMIT 1000;\n"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling\nSELECT\n  'dv_tm1_pbf_subscriptions' AS table_name,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT fiscal_week_id) AS unique_fiscal_weeks,\n  COUNT(DISTINCT category_name) AS unique_categories,\n  COUNT(DISTINCT gl_publication_code) AS unique_publications,\n  MIN(fiscal_week_id) AS earliest_fiscal_week,\n  MAX(fiscal_week_id) AS latest_fiscal_week,\n  APPROX_COUNT_DISTINCT(CONCAT(CAST(fiscal_week_id AS STRING), category_name, gl_publication_code)) AS approx_unique_grain\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE fiscal_week_id >= 202401 -- Example filter for recent data\nUNION ALL\nSELECT\n  'dv_tm1_pbf_circulation_actuals' AS table_name,\n  COUNT(*) AS total_records,\n  NULL AS unique_fiscal_weeks, -- No explicit fiscal_week_id in this table from provided SQL\n  NULL AS unique_categories,\n  NULL AS unique_publications,\n  NULL AS earliest_fiscal_week,\n  NULL AS latest_fiscal_week,\n  APPROX_COUNT_DISTINCT(CONCAT(channel, state)) AS approx_unique_grain\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`;\n"",
    ""validation_sql"": ""-- Quick validation that all metric calculations work syntactically and data exists\nSELECT\n  'Validation Check - Subscriptions' AS test_type,\n  CASE WHEN SUM(earned_amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS earned_amount_test,\n  CASE WHEN COUNT(DISTINCT fiscal_week_id) > 0 THEN 'PASS' ELSE 'FAIL' END AS fiscal_week_freshness_test,\n  MAX(fiscal_week_id) AS latest_fiscal_week_in_data\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE fiscal_week_id >= 202401 -- Example filter for recent data\nLIMIT 1\nUNION ALL\nSELECT\n  'Validation Check - Circulation' AS test_type,\n  CASE WHEN SUM(home_del_charge) > 0 THEN 'PASS' ELSE 'FAIL' END AS home_del_charge_test,\n  CASE WHEN COUNT(DISTINCT state) > 0 THEN 'PASS' ELSE 'FAIL' END AS state_data_test,\n  NULL AS latest_fiscal_week_in_data -- No explicit time dimension\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`\nLIMIT 1;\n"",
    ""business_rules_sql"": ""-- Query to validate key business logic, filters, and data quality\n-- Example: Check for negative volumes or amounts where they shouldn't exist\nSELECT\n  'Business Rule Validation - Subscriptions' AS validation_type,\n  'Negative Volumes/Amounts Check' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN add_volume < 0 OR closing_base < 0 OR earned_amount < 0 OR opening_base < 0 OR red_volume < 0 OR transfer_in < 0 OR transfer_out < 0 THEN 1 ELSE 0 END) AS records_failing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN add_volume < 0 OR closing_base < 0 OR earned_amount < 0 OR opening_base < 0 OR red_volume < 0 OR transfer_in < 0 OR transfer_out < 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 AS fail_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE fiscal_week_id = 202535 -- Specific week from query\nUNION ALL\nSELECT\n  'Business Rule Validation - Circulation' AS validation_type,\n  'Negative Charges/Adjustments Check' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN home_del_charge < 0 OR returns_credit_amount < 0 OR rev_adjust < 0 THEN 1 ELSE 0 END) AS records_failing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN home_del_charge < 0 OR returns_credit_amount < 0 OR rev_adjust < 0 THEN 1 ELSE 0 END), COUNT(*)) * 100 AS fail_rate_percentage\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`;\n"",
    ""sample_data_sql"": ""-- Query to get representative sample data for further analysis\nSELECT\n  'dv_tm1_pbf_subscriptions' AS source_table,\n  fiscal_week_id,\n  category_name,\n  gl_publication_code,\n  add_volume,\n  closing_base,\n  earned_amount,\n  opening_base,\n  red_volume,\n  transfer_in,\n  transfer_out,\n  NULL AS channel,\n  NULL AS state,\n  NULL AS home_del_charge,\n  NULL AS returns_credit_amount,\n  NULL AS rev_adjust\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE fiscal_week_id = 202535 -- Specific week from query\nORDER BY earned_amount DESC\nLIMIT 250\nUNION ALL\nSELECT\n  'dv_tm1_pbf_circulation_actuals' AS source_table,\n  NULL AS fiscal_week_id,\n  NULL AS category_name,\n  NULL AS gl_publication_code,\n  NULL AS add_volume,\n  NULL AS closing_base,\n  NULL AS earned_amount,\n  NULL AS opening_base,\n  NULL AS red_volume,\n  NULL AS transfer_in,\n  NULL AS transfer_out,\n  channel,\n  state,\n  home_del_charge,\n  returns_credit_amount,\n  rev_adjust\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals`\nORDER BY home_del_charge DESC\nLIMIT 250;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""202535"",
          ""original_format"": ""Integer (Fiscal Week ID)"",
          ""context"": ""used as a specific fiscal week filter in dv_tm1_pbf_subscriptions query"",
          ""suggested_fix"": ""replace with a Looker Studio date parameter or relative fiscal week calculation (e.g., CURRENT_FISCAL_WEEK_ID())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": []
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal week IDs with date parameters or relative fiscal week functions to allow dynamic reporting."",
      ""If 'state' or 'channel' are common dimensions across both datasets, consider creating a governed dimension table for consistent filtering and joining.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""add_volume"",
      ""metric_name"": ""Added Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the volume of new subscriptions or additions within a fiscal week."",
      ""sql_logic"": ""t0.add_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in subscription performance tracking to understand growth."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""negative values might indicate adjustments""
      ]
    },
    {
      ""metric_id"": ""category_name"",
      ""metric_name"": ""Category Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of the subscription product or service."",
      ""sql_logic"": ""t0.category_name"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting subscription data by product type."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming conventions""
      ]
    },
    {
      ""metric_id"": ""closing_base"",
      ""metric_name"": ""Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""opening_base"",
        ""add_volume"",
        ""red_volume"",
        ""transfer_in"",
        ""transfer_out""
      ],
      ""business_description"": ""The total number of active subscriptions at the end of a fiscal week."",
      ""sql_logic"": ""t0.closing_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key metric for tracking subscriber growth and retention."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential discrepancies if not calculated correctly from other base metrics""
      ]
    },
    {
      ""metric_id"": ""earned_amount"",
      ""metric_name"": ""Earned Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The revenue earned from subscriptions within a fiscal week."",
      ""sql_logic"": ""t0.earned_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core revenue metric for subscription business performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy depends on underlying revenue recognition rules""
      ]
    },
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""other"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Unique identifier for a fiscal week, used for time-based filtering and aggregation."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for subscription data."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""hardcoded in WHERE clause""
      ],
      ""data_quality_concerns"": [
        ""missing or incorrect fiscal week IDs""
      ]
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger code for the publication associated with the subscription."",
      ""sql_logic"": ""t0.gl_publication_code"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for financial reporting and analysis by publication."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies or missing codes""
      ]
    },
    {
      ""metric_id"": ""opening_base"",
      ""metric_name"": ""Opening Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of active subscriptions at the beginning of a fiscal week."",
      ""sql_logic"": ""t0.opening_base"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used to calculate net changes in subscription base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls or incorrect values""
      ]
    },
    {
      ""metric_id"": ""red_volume"",
      ""metric_name"": ""Reduced Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Represents the volume of subscription reductions (e.g., cancellations, churn) within a fiscal week."",
      ""sql_logic"": ""t0.red_volume"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in subscription performance tracking to understand churn."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""negative values might indicate adjustments""
      ]
    },
    {
      ""metric_id"": ""transfer_in"",
      ""metric_name"": ""Transfer In Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of subscriptions transferred into this category/publication within a fiscal week."",
      ""sql_logic"": ""t0.transfer_in"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Accounts for internal movements of subscriptions between different segments."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""transfer_out"",
      ""metric_name"": ""Transfer Out Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Volume of subscriptions transferred out of this category/publication within a fiscal week."",
      ""sql_logic"": ""t0.transfer_out"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions""
      ],
      ""filters_applied"": [
        ""fiscal_week_id = 202535""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Accounts for internal movements of subscriptions between different segments."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""202535""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""fiscal_week_id is hardcoded""
      ],
      ""data_quality_concerns"": [
        ""potential nulls""
      ]
    },
    {
      ""metric_id"": ""channel"",
      ""metric_name"": ""Channel"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The distribution channel for circulation (e.g., home delivery, retail)."",
      ""sql_logic"": ""t0.channel"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze circulation performance by distribution method."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming""
      ]
    },
    {
      ""metric_id"": ""home_del_charge"",
      ""metric_name"": ""Home Delivery Charge"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total charge associated with home deliveries."",
      ""sql_logic"": ""t0.home_del_charge"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A key cost or revenue component related to circulation operations."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy depends on underlying cost allocation""
      ]
    },
    {
      ""metric_id"": ""returns_credit_amount"",
      ""metric_name"": ""Returns Credit Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Credit amount issued for returned circulation items."",
      ""sql_logic"": ""t0.returns_credit_amount"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Impacts net revenue from circulation, reflecting losses due to returns."",
      ""metric_category"": ""cost"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""accuracy depends on return processing""
      ]
    },
    {
      ""metric_id"": ""rev_adjust"",
      ""metric_name"": ""Revenue Adjustment"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General adjustments made to revenue figures for circulation."",
      ""sql_logic"": ""t0.rev_adjust"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Captures various revenue corrections or reclassifications."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential nulls"",
        ""transparency of adjustment reasons""
      ]
    },
    {
      ""metric_id"": ""state"",
      ""metric_name"": ""State"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Geographical state associated with the circulation data."",
      ""sql_logic"": ""t0.state"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for geographical analysis of circulation performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""potential inconsistencies in naming""
      ]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""closing_base"",
      ""related_metrics"": [
        ""opening_base"",
        ""add_volume"",
        ""red_volume"",
        ""transfer_in"",
        ""transfer_out""
      ],
      ""relationship_description"": ""The closing base is typically calculated as opening base plus additions, minus reductions, plus transfers in, minus transfers out."",
      ""mathematical_formula"": ""Closing Base = Opening Base + Add Volume - Red Volume + Transfer In - Transfer Out"",
      ""business_validation"": ""Ensures the integrity of subscription base calculations and reflects net movement."",
      ""validation_sql"": ""SELECT\n  fiscal_week_id,\n  category_name,\n  gl_publication_code,\n  SUM(closing_base) AS actual_closing_base,\n  SUM(opening_base + add_volume - red_volume + transfer_in - transfer_out) AS calculated_closing_base,\n  CASE WHEN SUM(closing_base) = SUM(opening_base + add_volume - red_volume + transfer_in - transfer_out) THEN 'MATCH' ELSE 'MISMATCH' END AS validation_status\nFROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions`\nWHERE fiscal_week_id = 202535\nGROUP BY 1, 2, 3\nHAVING validation_status = 'MISMATCH'\nLIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""fiscal_week_id"",
      ""related_metrics"": [
        ""add_volume"",
        ""category_name"",
        ""closing_base"",
        ""earned_amount"",
        ""gl_publication_code"",
        ""opening_base"",
        ""red_volume"",
        ""transfer_in"",
        ""transfer_out""
      ],
      ""relationship_description"": ""The hardcoded fiscal_week_id filter directly impacts the data scope for all subscription-related metrics, limiting them to a single week."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that subscription metrics are reported for the intended fiscal period. However, hardcoding limits flexibility."",
      ""validation_sql"": ""SELECT DISTINCT fiscal_week_id FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_subscriptions` WHERE fiscal_week_id = 202535;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""home_del_charge"",
      ""related_metrics"": [
        ""channel"",
        ""state""
      ],
      ""relationship_description"": ""Home delivery charges are reported at the granularity of channel and state, indicating these dimensions are key for understanding the cost structure."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that costs are correctly attributed to specific distribution channels and geographic regions."",
      ""validation_sql"": ""SELECT channel, state, SUM(home_del_charge) FROM `ncau-data-newsquery-prd.sbx_fda_corefin.dv_tm1_pbf_circulation_actuals` GROUP BY 1, 2 LIMIT 10;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,39
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""3ee20092-1897-49b7-8bcd-4157d5f816eb"",
    ""dashboard_name"": ""AdSales Data for Pacing Report"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 3,
    ""consolidation_score"": 7,
    ""total_metrics_identified"": 3,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [""financial_year"", ""financial_week"", ""revenue_group_subtype""],
    ""date_range_detected"": ""2024 to 2025"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [""'2025'"", ""'2024'"", ""'SUNDRY ADSALES OVERLAY'"", ""47"", ""48"", ""49"", ""50"", ""51"", ""52""],
    ""governance_opportunities"": [
      ""financial_year should be parameterized or use relative date functions"",
      ""revenue_group_subtype should join to a reference table for dynamic filtering"",
      ""financial_week exclusions should be managed via a calendar table or configuration table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query shows the distinct combinations of key dimensions under the most comprehensive filter conditions observed in the provided SQL samples. The original queries primarily extract dimension values for dashboard filters, not aggregate measures. Actual pacing metrics (e.g., revenue, volume) are not present in the provided SQL samples.\nWITH base_data AS (\n  SELECT\n    t0.financial_year,\n    t0.financial_week,\n    t0.revenue_group_subtype\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\n)\nSELECT\n  financial_year,\n  financial_week,\n  revenue_group_subtype,\n  COUNT(*) AS record_count_for_combination\nFROM base_data\nWHERE\n  financial_year IN ('2024', '2025') -- Most comprehensive year filter\n  AND (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL) -- Most comprehensive week filter\nGROUP BY\n  financial_year,\n  financial_week,\n  revenue_group_subtype\nORDER BY\n  financial_year DESC, financial_week DESC\nLIMIT 100;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT t0.financial_year) as unique_financial_years,\n  COUNT(DISTINCT t0.financial_week) as unique_financial_weeks,\n  COUNT(DISTINCT t0.revenue_group_subtype) as unique_revenue_subtypes,\n  MIN(t0.financial_year) as earliest_financial_year,\n  MAX(t0.financial_year) as latest_financial_year\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nLIMIT 1;"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN COUNT(DISTINCT financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_year_test,\n  CASE WHEN COUNT(DISTINCT revenue_group_subtype) > 0 THEN 'PASS' ELSE 'FAIL' END as revenue_subtype_test,\n  CASE WHEN COUNT(DISTINCT financial_week) > 0 THEN 'PASS' ELSE 'FAIL' END as financial_week_test,\n  CASE WHEN SUM(CASE WHEN financial_year = '2025' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as has_2025_data_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_year IN ('2024', '2025')\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Exclude Year-End Financial Weeks' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL) THEN 1 ELSE 0 END) as records_passing_rule,\n  SAFE_DIVIDE(SUM(CASE WHEN (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL) THEN 1 ELSE 0 END), COUNT(*)) * 100 as pass_rate_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance`\nWHERE financial_year IN ('2024', '2025')\nLIMIT 100;"",
    ""sample_data_sql"": ""SELECT \n  t0.financial_year,\n  t0.financial_week,\n  t0.revenue_group_subtype\n  -- The provided SQL queries only expose these three dimensions. \n  -- If the 'adsales_performance' table contains measures like revenue, impressions, etc., they would be added here.\n  -- Example placeholder for potential measures:\n  -- , t0.revenue\n  -- , t0.impressions\n  -- , t0.clicks\nFROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` AS t0\nWHERE t0.financial_year IN ('2024', '2025')\nORDER BY t0.financial_year DESC, t0.financial_week DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'2025'"", ""'2024'""],
          ""context"": ""Financial years used for filtering data in multiple queries."",
          ""suggested_governance"": ""Replace with Looker Studio date parameters or relative date functions (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` and `EXTRACT(YEAR FROM DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR))`) to ensure dynamic updates and reduce maintenance."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'SUNDRY ADSALES OVERLAY'""],
          ""context"": ""Specific revenue group subtype used for filtering in one query."",
          ""suggested_governance"": ""Store revenue group subtypes in a governed reference table and join to it, or use a Looker Studio parameter for user selection to allow dynamic filtering and maintain data consistency."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""47"", ""48"", ""49"", ""50"", ""51"", ""52""],
          ""context"": ""Specific financial weeks excluded from analysis in one query, likely representing year-end or holiday periods."",
          ""suggested_governance"": ""Manage excluded weeks in a dedicated calendar or configuration table, allowing for easier updates, transparency of business rules, and consistency across reports."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded financial years with Looker Studio date parameters (e.g., 'Start Year', 'End Year') or relative date functions."",
      ""Replace hardcoded revenue group subtypes with a Looker Studio parameter that allows users to select from available values, or join to a governed reference table."",
      ""Replace hardcoded financial week exclusions with a configuration table that defines holiday/excluded periods, or derive from a comprehensive calendar dimension table.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""filtered_financial_year_by_sundry_overlay"",
      ""metric_name"": ""Financial Year (Filtered by Sundry AdSales Overlay)"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Provides a list of financial years available in the dataset where the 'revenue_group_subtype' is specifically 'SUNDRY ADSALES OVERLAY'. This is likely used to populate a filter control in the dashboard, allowing users to select years relevant to this specific revenue type."",
      ""sql_logic"": ""SELECT financial_year FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to narrow down the scope of analysis to specific financial years relevant to 'SUNDRY ADSALES OVERLAY' revenue, which might represent specific adjustments or non-standard revenue streams in ad sales."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'SUNDRY ADSALES OVERLAY'""],
      ""governance_issues"": [""lookup values should use reference table""],
      ""data_quality_concerns"": [""potential for misspellings if not from a controlled list""]
    },
    {
      ""metric_id"": ""filtered_revenue_subtype_for_2025"",
      ""metric_name"": ""Revenue Group Subtype (Filtered for FY2025)"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Provides a list of distinct 'revenue_group_subtype' values available specifically for the financial year 2025. This is likely used to populate a filter control in the dashboard, enabling focused analysis on current or upcoming periods."",
      ""sql_logic"": ""SELECT revenue_group_subtype FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year = '2025'"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [""financial_year = '2025'""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables users to select specific revenue subtypes when analyzing data pertinent to the 2025 financial year, allowing for focused analysis on current or upcoming ad sales performance."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'2025'""],
      ""governance_issues"": [""year should be parameterised""],
      ""data_quality_concerns"": [""potential for misspellings if not from a controlled list""]
    },
    {
      ""metric_id"": ""filtered_revenue_subtype_for_2024_2025_excluding_weeks"",
      ""metric_name"": ""Revenue Group Subtype (Filtered for FY2024/2025, Excl. Year-End Weeks)"",
      ""metric_type"": ""filter"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Provides a list of distinct 'revenue_group_subtype' values for financial years 2024 and 2025, specifically excluding financial weeks 47-52 (likely year-end/holiday periods). This is crucial for standard pacing reports to exclude atypical periods."",
      ""sql_logic"": ""SELECT revenue_group_subtype FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2025', '2024') AND (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.adsales_performance""],
      ""filters_applied"": [
        ""financial_year IN ('2025', '2024')"",
        ""financial_week NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL""
      ],
      ""expected_data_type"": ""string"",
      ""business_context"": ""This is likely the primary filter for revenue subtypes in the main ad sales pacing report, ensuring that analysis focuses on standard business weeks and relevant financial years, excluding periods with atypical performance due to holidays or year-end closures."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'2025'"", ""'2024'"", ""47"", ""48"", ""49"", ""50"", ""51"", ""52""],
      ""governance_issues"": [""years should be parameterised"", ""financial week exclusions should be managed via a calendar/config table""],
      ""data_quality_concerns"": [""potential for misspellings if not from a controlled list"", ""correctness of financial week exclusion logic""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""filtered_financial_year_by_sundry_overlay"",
      ""related_metrics"": [""revenue_group_subtype""],
      ""relationship_description"": ""The selection of 'SUNDRY ADSALES OVERLAY' for 'revenue_group_subtype' directly determines the available 'financial_year' values presented for this filter. This ensures that only years with this specific revenue type are selectable."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that users can only select financial years that actually contain 'SUNDRY ADSALES OVERLAY' revenue, preventing selection of irrelevant periods."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT financial_year) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE revenue_group_subtype = 'SUNDRY ADSALES OVERLAY'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""filtered_revenue_subtype_for_2025"",
      ""related_metrics"": [""financial_year""],
      ""relationship_description"": ""The hardcoded selection of '2025' for 'financial_year' directly determines the available 'revenue_group_subtype' values for this filter. This limits the subtypes to those present in the specified year."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that users can only select revenue subtypes that exist within the 2025 financial year, providing a relevant list for current year analysis."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year = '2025'"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""filtered_revenue_subtype_for_2024_2025_excluding_weeks"",
      ""related_metrics"": [""financial_year"", ""financial_week""],
      ""relationship_description"": ""The hardcoded selection of '2024'/'2025' for 'financial_year' and the exclusion of specific 'financial_week' values (47-52) directly determine the available 'revenue_group_subtype' values for this filter. This is a critical business rule for pacing reports."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that users can only select revenue subtypes that exist within the specified financial years and non-excluded weeks, which is crucial for consistent and accurate pacing analysis by removing holiday/atypical periods."",
      ""validation_sql"": ""SELECT COUNT(DISTINCT revenue_group_subtype) FROM `ncau-data-newsquery-prd.asl_finance_derived.adsales_performance` WHERE financial_year IN ('2025', '2024') AND (SAFE_CAST(financial_week AS INT64) NOT IN (47, 48, 49, 50, 51, 52) OR financial_week IS NULL)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,40
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""d4d68a71-2b12-4caf-bc6b-96fc2d18a025"",
    ""dashboard_name"": ""Adsales Details Dashboard"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard"",
    ""business_domain"": ""sales"",
    ""complexity_score"": 6,
    ""consolidation_score"": 4,
    ""total_metrics_identified"": 9,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""publication_date"",
      ""advertiser_name"",
      ""employee_name"",
      ""agency_group"",
      ""unified_publication_name"",
      ""financial_year_selected"",
      ""financial_month_selected"",
      ""portfolio_name_selected""
    ],
    ""date_range_detected"": ""2024 to 2025 (financial years)"",
    ""hardcoded_dates_found"": [""2025"", ""2024""],
    ""hardcoded_values_found"": [
      ""Feb"",
      ""Mar"",
      ""Apr"",
      ""May"",
      ""Jun"",
      ""Jul"",
      ""Aug"",
      ""Sep"",
      ""NSW IA C3"",
      ""Marley-Kale Kentia"",
      ""Australian Meat Processor Corporation"",
      ""Australian Pork"",
      ""CMC Markets"",
      ""Coco Republic"",
      ""Dry July Limited"",
      ""Fred Hollows Foundation"",
      ""LGT Crestone"",
      ""Vogue Australia"",
      ""Monday"",
      ""Tuesday"",
      ""Wednesday"",
      ""Thursday"",
      ""Friday"",
      ""Saturday"",
      ""Sunday""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative date functions"",
      ""lookup values (portfolio, employee, advertiser, publication) should use Looker Studio controls or reference tables"",
      ""dynamic dimension selection logic (Fin/Curr) should be driven by Looker Studio parameters""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for consolidated analysis of key dimensions and potential metrics.\n-- Assumes 'revenue' and 'volume' are common metrics in an adsales dashboard, even if not explicitly in provided queries.\nSELECT\n  t0.publication_date,\n  t0.advertiser_name,\n  t0.employee_name,\n  t0.agency_group,\n  t0.unified_publication_name,\n  CASE WHEN (TRUE) THEN t0.financial_year ELSE t0.calendar_year END AS financial_year_selected, -- Replace TRUE with Looker Studio parameter\n  CASE WHEN (TRUE) THEN t0.financial_short_month ELSE t0.calendar_month_short_name END AS financial_month_selected, -- Replace TRUE with Looker Studio parameter\n  CASE WHEN (TRUE) THEN t0.portfolio_conformed_name_current ELSE t0.portfolio_conformed_name_sync END AS portfolio_name_selected, -- Replace TRUE with Looker Studio parameter\n  CASE WHEN (t0.dow = 'Monday') THEN 'Monday' WHEN (t0.dow = 'Tuesday') THEN ' Tuesday' WHEN (t0.dow = 'Wednesday') THEN '  Wednesday' WHEN (t0.dow = 'Thursday') THEN '   Thursday' WHEN (t0.dow = 'Friday') THEN '    Friday' WHEN (t0.dow = 'Saturday') THEN '     Saturday' WHEN (t0.dow = 'Sunday') THEN '      Sunday' ELSE NULL END AS day_of_week_formatted,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertisers\n  -- Add other relevant measures if available in the source table, e.g.:\n  -- SUM(t0.revenue_column) AS total_revenue,\n  -- SUM(t0.impressions_column) AS total_impressions,\n  -- COUNT(DISTINCT t0.campaign_id) AS unique_campaigns\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.publication_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 YEAR) -- Example: Last 1 year, replace with parameter\n  AND t0.financial_year IN (CAST(EXTRACT(YEAR FROM CURRENT_DATE()) AS STRING), CAST(EXTRACT(YEAR FROM CURRENT_DATE()) + 1 AS STRING)) -- Example: Current and next financial year, replace with parameter\n  -- Add other common filters here, e.g., t0.advertiser_name IN (...) or t0.employee_name IN (...)\nGROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9\nORDER BY t0.publication_date DESC\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT t0.publication_date) AS unique_publication_dates,\n  COUNT(DISTINCT t0.advertiser_name) AS unique_advertisers,\n  COUNT(DISTINCT t0.employee_name) AS unique_employees,\n  COUNT(DISTINCT t0.agency_group) AS unique_agency_groups,\n  MIN(t0.publication_date) AS earliest_publication_date,\n  MAX(t0.publication_date) AS latest_publication_date,\n  APPROX_COUNT_DISTINCT(t0.transaction_id) AS approx_unique_transactions -- Assuming a transaction_id exists\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.publication_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN COUNT(*) > 0 THEN 'PASS' ELSE 'FAIL' END AS data_presence_test,\n  CASE WHEN MAX(t0.publication_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(DISTINCT t0.financial_year) > 0 THEN 'PASS' ELSE 'FAIL' END AS financial_year_data_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.publication_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'Financial vs Calendar Year Logic' AS rule_name,\n  COUNT(*) AS records_tested,\n  SUM(CASE WHEN (t0.financial_year IS NOT NULL AND t0.calendar_year IS NOT NULL AND t0.financial_year != t0.calendar_year) THEN 1 ELSE 0 END) AS records_with_diff_years,\n  SUM(CASE WHEN (t0.financial_short_month IS NOT NULL AND t0.calendar_month_short_name IS NOT NULL AND t0.financial_short_month != t0.calendar_month_short_name) THEN 1 ELSE 0 END) AS records_with_diff_months,\n  SUM(CASE WHEN (t0.portfolio_conformed_name_current IS NOT NULL AND t0.portfolio_conformed_name_sync IS NOT NULL AND t0.portfolio_conformed_name_current != t0.portfolio_conformed_name_sync) THEN 1 ELSE 0 END) AS records_with_diff_portfolios\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.publication_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
    ""sample_data_sql"": ""SELECT\n  t0.publication_date,\n  t0.advertiser_name,\n  t0.employee_name,\n  t0.agency_group,\n  t0.unified_publication_name,\n  t0.calendar_month_short_name,\n  t0.calendar_year,\n  t0.financial_short_month,\n  t0.financial_year,\n  t0.portfolio_conformed_name_current,\n  t0.portfolio_conformed_name_sync,\n  t0.dow\n  -- Add any other relevant raw columns for detailed analysis\nFROM\n  `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` AS t0\nWHERE\n  t0.publication_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY\n  t0.publication_date DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""'2025'"",
          ""context"": ""used as a filter for financial year"",
          ""suggested_fix"": ""replace with Looker Studio parameter or relative year (e.g., EXTRACT(YEAR FROM CURRENT_DATE()) + 1)"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""2024"",
          ""original_format"": ""'2024'"",
          ""context"": ""used as an exclusion filter for financial year"",
          ""suggested_fix"": ""replace with Looker Studio parameter or relative year (e.g., EXTRACT(YEAR FROM CURRENT_DATE()))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Feb'"", ""'Mar'"", ""'Apr'"", ""'May'"", ""'Jun'"", ""'Jul'"", ""'Aug'"", ""'Sep'""],
          ""context"": ""financial month filters"",
          ""suggested_governance"": ""use Looker Studio dropdown parameter for month selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'NSW IA C3'""],
          ""context"": ""portfolio name filter"",
          ""suggested_governance"": ""use Looker Studio dropdown parameter for portfolio selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Marley-Kale Kentia'""],
          ""context"": ""employee name filter"",
          ""suggested_governance"": ""use Looker Studio dropdown parameter for employee selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Australian Meat Processor Corporation'"", ""'Australian Pork'"", ""'CMC Markets'"", ""'Coco Republic'"", ""'Dry July Limited'"", ""'Fred Hollows Foundation'"", ""'LGT Crestone'""],
          ""context"": ""advertiser name filter"",
          ""suggested_governance"": ""use Looker Studio dropdown parameter for advertiser selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'Vogue Australia'""],
          ""context"": ""unified publication name filter"",
          ""suggested_governance"": ""use Looker Studio dropdown parameter for publication selection"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Fin'"", ""'Curr'""],
          ""context"": ""static conditions in CASE WHEN for dynamic dimension selection (e.g., 'Fin' vs 'Calendar' year/month, 'Current' vs 'Sync' portfolio)"",
          ""suggested_governance"": ""replace with Looker Studio parameters to allow user selection of financial/calendar or current/sync views"",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates (years) with date parameters or relative date functions (e.g., CURRENT_DATE(), EXTRACT(YEAR FROM CURRENT_DATE()))."",
      ""Replace hardcoded lookup values (months, portfolio names, employee names, advertiser names, publication names) with Looker Studio dropdown parameters or filters."",
      ""Implement Looker Studio parameters to control the 'Financial' vs 'Calendar' and 'Current' vs 'Sync' dimension selection logic, replacing the hardcoded 'Fin' and 'Curr' conditions.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""day_of_week_formatted"",
      ""metric_name"": ""Day of Week (Formatted)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Day of the week, formatted with leading spaces to ensure specific sorting order in Looker Studio visualizations."",
      ""sql_logic"": ""CASE WHEN (t0.dow = 'Monday') THEN 'Monday' WHEN (t0.dow = 'Tuesday') THEN ' Tuesday' WHEN (t0.dow = 'Wednesday') THEN '  Wednesday' WHEN (t0.dow = 'Thursday') THEN '   Thursday' WHEN (t0.dow = 'Friday') THEN '    Friday' WHEN (t0.dow = 'Saturday') THEN '     Saturday' WHEN (t0.dow = 'Sunday') THEN '      Sunday' ELSE NULL END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for time-based analysis and trend visualization, ensuring correct chronological sorting of days."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Monday'"", ""'Tuesday'"", ""'Wednesday'"", ""'Thursday'"", ""'Friday'"", ""'Saturday'"", ""'Sunday'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""advertiser_name"",
      ""metric_name"": ""Advertiser Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the advertiser associated with the ad placement."",
      ""sql_logic"": ""t0.advertiser_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('Australian Meat Processor Corporation', 'Australian Pork', 'CMC Markets', 'Coco Republic', 'Dry July Limited', 'Fred Hollows Foundation', 'LGT Crestone')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""A primary dimension for analyzing sales performance, client relationships, and revenue attribution."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Australian Meat Processor Corporation'"", ""'Australian Pork'"", ""'CMC Markets'"", ""'Coco Republic'"", ""'Dry July Limited'"", ""'Fred Hollows Foundation'"", ""'LGT Crestone'""],
      ""governance_issues"": [""lookup values should use reference table or parameter""],
      ""data_quality_concerns"": [""potential nulls""]
    },
    {
      ""metric_id"": ""employee_name"",
      ""metric_name"": ""Employee Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The name of the sales employee or account manager responsible for the ad placement."",
      ""sql_logic"": ""t0.employee_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('Marley-Kale Kentia')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for tracking individual sales performance and managing sales team targets."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Marley-Kale Kentia'""],
      ""governance_issues"": [""lookup values should use reference table or parameter""],
      ""data_quality_concerns"": [""potential nulls""]
    },
    {
      ""metric_id"": ""publication_date"",
      ""metric_name"": ""Publication Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The specific date on which the advertisement was published."",
      ""sql_logic"": ""t0.publication_date"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""filtered by financial year/month selections""],
      ""expected_data_type"": ""date"",
      ""business_context"": ""The primary date dimension for all time-series analysis and reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""financial_year_selected"",
      ""metric_name"": ""Financial Year (Selected)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""financial_year"", ""calendar_year""],
      ""business_description"": ""The financial year, dynamically selected based on a Looker Studio parameter (currently hardcoded to financial year)."",
      ""sql_logic"": ""CASE WHEN ('Fin' = 'Fin') THEN t0.financial_year ELSE t0.calendar_year END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('2025')"", ""NOT IN ('2024') OR IS NULL""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for financial reporting and analysis, allowing views by financial or calendar year."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [""2025"", ""2024""],
      ""hardcoded_values_in_metric"": [""'Fin'""],
      ""governance_issues"": [""date should be parameterised"", ""dynamic selection should use parameter""],
      ""data_quality_concerns"": [""potential nulls""]
    },
    {
      ""metric_id"": ""financial_month_selected"",
      ""metric_name"": ""Financial Month (Selected)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""monthly"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""financial_short_month"", ""calendar_month_short_name""],
      ""business_description"": ""The financial month, dynamically selected based on a Looker Studio parameter (currently hardcoded to financial month)."",
      ""sql_logic"": ""CASE WHEN ('Fin' = 'Fin') THEN t0.financial_short_month ELSE t0.calendar_month_short_name END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('Feb', 'Mar', 'Apr', 'May', 'Jun')"", ""IN ('Jul', 'Aug', 'Sep')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Crucial for financial reporting and analysis, allowing views by financial or calendar month."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Feb'"", ""'Mar'"", ""'Apr'"", ""'May'"", ""'Jun'"", ""'Jul'"", ""'Aug'"", ""'Sep'"", ""'Fin'""],
      ""governance_issues"": [""lookup values should use parameter"", ""dynamic selection should use parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""portfolio_name_selected"",
      ""metric_name"": ""Portfolio Name (Selected)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""portfolio_conformed_name_current"", ""portfolio_conformed_name_sync""],
      ""business_description"": ""The portfolio name, dynamically selected based on a Looker Studio parameter (currently hardcoded to current portfolio)."",
      ""sql_logic"": ""CASE WHEN ('Curr' = 'Curr') THEN t0.portfolio_conformed_name_current ELSE t0.portfolio_conformed_name_sync END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('NSW IA C3')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for segmenting and analyzing sales performance across different product or client portfolios."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'NSW IA C3'"", ""'Curr'""],
      ""governance_issues"": [""lookup values should use parameter"", ""dynamic selection should use parameter""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""agency_group"",
      ""metric_name"": ""Agency Group"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The group name of the advertising agency involved in the ad placement."",
      ""sql_logic"": ""t0.agency_group"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""filtered by financial year/month and publication""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Important for understanding sales channels and agency relationships."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls""]
    },
    {
      ""metric_id"": ""unified_publication_name"",
      ""metric_name"": ""Unified Publication Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The standardized name of the publication (e.g., magazine, newspaper) where the ad was placed."",
      ""sql_logic"": ""t0.unified_publication_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance_derived.details_dashboard""],
      ""filters_applied"": [""IN ('Vogue Australia')""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for analyzing sales performance by specific publication titles."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Vogue Australia'""],
      ""governance_issues"": [""lookup values should use reference table or parameter""],
      ""data_quality_concerns"": [""potential nulls""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_year_selected"",
      ""related_metrics"": [""financial_year"", ""calendar_year""],
      ""relationship_description"": ""The 'Financial Year (Selected)' metric is derived from either the raw 'financial_year' or 'calendar_year' column based on a conditional logic, which is currently hardcoded to always select 'financial_year'."",
      ""mathematical_formula"": ""CASE WHEN ('Fin' = 'Fin') THEN financial_year ELSE calendar_year END"",
      ""business_validation"": ""Ensures that the dashboard can display data aggregated by either financial or calendar year, although this choice is currently fixed."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Fin' = 'Fin') THEN financial_year ELSE calendar_year END) IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""financial_month_selected"",
      ""related_metrics"": [""financial_short_month"", ""calendar_month_short_name""],
      ""relationship_description"": ""The 'Financial Month (Selected)' metric is derived from either the raw 'financial_short_month' or 'calendar_month_short_name' column based on a conditional logic, which is currently hardcoded to always select 'financial_short_month'."",
      ""mathematical_formula"": ""CASE WHEN ('Fin' = 'Fin') THEN financial_short_month ELSE calendar_month_short_name END"",
      ""business_validation"": ""Ensures that the dashboard can display data aggregated by either financial or calendar month, although this choice is currently fixed."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Fin' = 'Fin') THEN financial_short_month ELSE calendar_month_short_name END) IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""portfolio_name_selected"",
      ""related_metrics"": [""portfolio_conformed_name_current"", ""portfolio_conformed_name_sync""],
      ""relationship_description"": ""The 'Portfolio Name (Selected)' metric is derived from either 'portfolio_conformed_name_current' or 'portfolio_conformed_name_sync' based on a conditional logic, which is currently hardcoded to always select 'portfolio_conformed_name_current'."",
      ""mathematical_formula"": ""CASE WHEN ('Curr' = 'Curr') THEN portfolio_conformed_name_current ELSE portfolio_conformed_name_sync END"",
      ""business_validation"": ""Allows for flexibility in viewing portfolio data, though currently fixed to the 'current' view."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE (CASE WHEN ('Curr' = 'Curr') THEN portfolio_conformed_name_current ELSE portfolio_conformed_name_sync END) IS NOT NULL;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""publication_date"",
      ""related_metrics"": [""financial_year_selected"", ""financial_month_selected""],
      ""relationship_description"": ""The 'Publication Date' dimension is implicitly filtered by the selections made on 'Financial Year (Selected)' and 'Financial Month (Selected)'. This means that the range of publication dates shown will be constrained by the chosen financial period."",
      ""mathematical_formula"": ""publication_date falls within the period defined by financial_year_selected and financial_month_selected"",
      ""business_validation"": ""Ensures that time-series data aligns with the selected financial reporting period."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE publication_date IS NOT NULL AND financial_year = '2025' AND financial_short_month IN ('Feb', 'Mar');"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""advertiser_name"",
      ""related_metrics"": [""financial_year_selected"", ""financial_month_selected"", ""portfolio_name_selected"", ""employee_name""],
      ""relationship_description"": ""The list of 'Advertiser Name' is filtered by selections on financial period, portfolio, and employee. This means only advertisers relevant to the current filter context are displayed."",
      ""mathematical_formula"": ""advertiser_name IN (list_of_advertisers_from_filter)"",
      ""business_validation"": ""Allows for focused analysis of advertiser performance within specific business contexts (e.g., a particular employee's clients in a given financial year)."",
      ""validation_sql"": ""SELECT COUNT(*) FROM `ncau-data-newsquery-prd.asl_finance_derived.details_dashboard` WHERE advertiser_name IN ('Australian Meat Processor Corporation') AND financial_year = '2025';"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,41
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""57d87efe-c112-4d42-be1b-045f0c8ca73e"",
    ""dashboard_name"": ""Commercial Finance Scorecards"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 8,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 83,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""aggregate"",
    ""key_dimensions"": [
      ""masthead"",
      ""fy_year"",
      ""fy_week_of_year""
    ],
    ""date_range_detected"": ""Specific weeks within FY2025 (e.g., Week 37, Weeks 26-31) relative to a base date of 03/07/2024."",
    ""hardcoded_dates_found"": [
      ""03/07/2024"",
      ""30/03/2025"",
      ""10/02/2025""
    ],
    ""hardcoded_values_found"": [
      ""'TA'"",
      ""'DT'"",
      ""'HS'"",
      ""'WT'"",
      ""'GA'"",
      ""'CM'"",
      ""'CP'"",
      ""'TB'"",
      ""'TC'"",
      ""'GC'"",
      ""'TM'"",
      ""'NT'"",
      ""'AA'"",
      ""'States and Community'"",
      ""'The Australian and Prestige'"",
      ""'Metro'"",
      ""'Regionals'"",
      ""2025"",
      ""2024"",
      ""0"",
      ""1"",
      ""2"",
      ""3"",
      ""4"",
      ""5"",
      ""48"",
      ""49"",
      ""50"",
      ""51"",
      ""52"",
      ""'All Mastheads'"",
      ""'TRUE'""
    ],
    ""governance_opportunities"": [
      ""Dates should be parameterized or use relative date functions (e.g., CURRENT_DATE(), DATE_SUB) instead of fixed literals."",
      ""Masthead codes and their display names/groupings should be managed in a lookup table for consistency and easier maintenance."",
      ""Fiscal year and week logic should be dynamic based on current date or parameters, not hardcoded years."",
      ""The `(0=X)` boolean conditions suggest dynamic filter values that are currently inactive; these should be handled more robustly, possibly by removing the condition if no filter is applied or using a parameter.""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- THIS IS THE MAIN SQL TO RUN - Single query showing all key metrics calculated together with appropriate sampling and date filters\nWITH base_data AS (\n  SELECT\n    t0.masthead,\n    CASE\n      WHEN (t0.masthead = 'TA') THEN 'The Australian'\n      WHEN (t0.masthead = 'DT') THEN 'Daily Telegraph'\n      WHEN (t0.masthead = 'HS') THEN 'Herald Sun'\n      WHEN (t0.masthead = 'WT') THEN 'Weekly Times'\n      WHEN (t0.masthead = 'GA') THEN 'Geelong Advertiser'\n      WHEN (t0.masthead = 'CM') THEN 'Courier Mail'\n      WHEN (t0.masthead = 'CP') THEN 'Cairns Post'\n      WHEN (t0.masthead = 'TB') THEN 'Townsville Bulletin'\n      WHEN (t0.masthead = 'TC') THEN 'Toowoomba Chronicles'\n      WHEN (t0.masthead = 'GC') THEN 'Gold Coast'\n      WHEN (t0.masthead = 'TM') THEN 'The Mercury'\n      WHEN (t0.masthead = 'NT') THEN 'NT News'\n      WHEN (t0.masthead = 'AA') THEN 'The Advertiser'\n      ELSE NULL\n    END AS masthead_display_name,\n    CASE\n      WHEN (t0.masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT')) THEN 'States and Community'\n      WHEN (t0.masthead = 'TA') THEN 'The Australian and Prestige'\n      ELSE NULL\n    END AS masthead_group_states_community,\n    CASE\n      WHEN (t0.masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro'\n      WHEN (t0.masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT')) THEN 'Regionals'\n      ELSE NULL\n    END AS masthead_group_metro_regionals,\n    t0.fy_year,\n    t0.fy_week_of_year,\n    -- Parameters for dynamic date calculations (replace hardcoded values)\n    -- DECLARE report_date DATE DEFAULT DATE('2025-03-30');\n    -- DECLARE fiscal_year_start_date DATETIME DEFAULT DATETIME '2024-07-03T00:00:00';\n    EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-30'))) - 1 AS current_report_day_of_week,\n    DATETIME_DIFF(SAFE_CAST(DATE('2025-03-30') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK) AS current_report_week_from_base,\n\n    t0.Always_on_Digital_Sales_V,\n    t0.Breach_Sales_V,\n    t0.Closing_Base_3rd_Party_V,\n    t0.Essentials_V,\n    t0.General_Offer_Sales_V,\n    t0.Net_Cancels_V,\n    t0.Net_Growth_3rd_Party_V,\n    t0.Net_Growth_Consumer_V,\n    t0.Net_Growth_incl_3rd_Party_V,\n    t0.Other_Sales_V,\n    t0.Revenue_3rd_Party_V,\n    t0.Revenue_Campus_V,\n    t0.Revenue_Consumer_V,\n    t0.Revenue_Corp_V,\n    t0.Revenue_Other_V,\n    t0.Switches_V,\n    t0.Total_Cancels_excluding_3rd_Party_V,\n    t0.Total_Cancels_including_3rd_Party_V,\n    t0.Total_Closing_Base_V,\n    t0.Total_Revenue_V,\n    t0.Total_Weekly_Sales_V,\n\n    t0.Always_on_Digital_Sales,\n    t0.Breach_Sales,\n    t0.Closing_Base_3rd_Party,\n    t0.Closing_Base_3rd_Party_APLS,\n    t0.Closing_Base_3rd_Party_GPLA,\n    t0.Closing_Base_Consumer,\n    t0.Essentials,\n    t0.Failed_Payment_Volume,\n    t0.General_Offer_Sales,\n    t0.Net_Cancels,\n    t0.Net_Growth_3rd_Party,\n    t0.Net_Growth_3rd_Party_APLS,\n    t0.Net_Growth_3rd_Party_GPLA,\n    t0.Net_Growth_Consumer,\n    t0.Net_Growth_incl_3rd_Party,\n    t0.Other_Sales,\n    t0.Revenue_3rd_Party,\n    t0.Revenue_3rd_Party_APLS,\n    t0.Revenue_3rd_Party_GPLA,\n    t0.Revenue_Campus,\n    t0.Revenue_Consumer,\n    t0.Revenue_Corp,\n    t0.Revenue_Other,\n    t0.Switches,\n    t0.Total_Cancels_excluding_3rd_Party,\n    t0.Total_Cancels_including_3rd_Party,\n    t0.Total_Closing_Base,\n    t0.Total_Revenue,\n    t0.Total_Weekly_Sales,\n\n    t0.Always_on_Digital_Sales_6W,\n    t0.Breach_Sales_6W,\n    t0.Closing_Base_3rd_Party_6W,\n    t0.Closing_Base_3rd_Party_APLS_6W,\n    t0.Closing_Base_3rd_Party_GPLA_6W,\n    t0.Essentials_6W,\n    t0.Failed_Payment_Volume_6W,\n    t0.General_Offer_Sales_6W,\n    t0.Net_Cancels_6W,\n    t0.Net_Growth_3rd_Party_6W,\n    t0.Net_Growth_Consumer_6W,\n    t0.Net_Growth_incl_3rd_party_6W,\n    t0.Other_Sales_6W,\n    t0.Revenue_3rd_Party_6W,\n    t0.Revenue_3rd_Party_APLS_6W,\n    t0.Revenue_3rd_Party_GPLA_6W,\n    t0.Revenue_Campus_6W,\n    t0.Revenue_Consumer_6W,\n    t0.Revenue_Corp_6W,\n    t0.Revenue_Other_6W,\n    t0.Switches_6W,\n    t0.Total_Cancels_excluding_3rd_Party_6W,\n    t0.Total_Cancels_including_3rd_Party_6W,\n    t0.Total_Closing_Base_6W,\n    t0.Total_Revenue_6W,\n    t0.Total_Weekly_Sales_6W\n  FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` AS t0\n  WHERE t0.fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1 -- Example: filter for last 2 fiscal years\n)\nSELECT\n  masthead,\n  masthead_display_name,\n  masthead_group_states_community,\n  masthead_group_metro_regionals,\n  fy_year,\n  fy_week_of_year,\n  -- Current Week Metrics (from Q1/Q2)\n  SUM(Always_on_Digital_Sales) AS current_always_on_digital_sales,\n  SUM(Breach_Sales) AS current_breach_sales,\n  SUM(Closing_Base_3rd_Party) AS current_closing_base_3rd_party,\n  SUM(Closing_Base_3rd_Party_APLS) AS current_closing_base_3rd_party_apls,\n  SUM(Closing_Base_3rd_Party_GPLA) AS current_closing_base_3rd_party_gpla,\n  SUM(Closing_Base_Consumer) AS current_closing_base_consumer,\n  SUM(Essentials) AS current_essentials,\n  SUM(Failed_Payment_Volume) AS current_failed_payment_volume,\n  SUM(General_Offer_Sales) AS current_general_offer_sales,\n  SUM(Net_Cancels) AS current_net_cancels,\n  SUM(Net_Growth_3rd_Party) AS current_net_growth_3rd_party,\n  SUM(Net_Growth_3rd_Party_APLS) AS current_net_growth_3rd_party_apls,\n  SUM(Net_Growth_3rd_Party_GPLA) AS current_net_growth_3rd_party_gpla,\n  SUM(Net_Growth_Consumer) AS current_net_growth_consumer,\n  SUM(Net_Growth_incl_3rd_Party) AS current_net_growth_incl_3rd_party,\n  SUM(Other_Sales) AS current_other_sales,\n  SUM(Revenue_3rd_Party) AS current_revenue_3rd_party,\n  SUM(Revenue_3rd_Party_APLS) AS current_revenue_3rd_party_apls,\n  SUM(Revenue_3rd_Party_GPLA) AS current_revenue_3rd_party_gpla,\n  SUM(Revenue_Campus) AS current_revenue_campus,\n  SUM(Revenue_Consumer) AS current_revenue_consumer,\n  SUM(Revenue_Corp) AS current_revenue_corp,\n  SUM(Revenue_Other) AS current_revenue_other,\n  SUM(Switches) AS current_switches,\n  SUM(Total_Cancels_excluding_3rd_Party) AS current_total_cancels_excluding_3rd_party,\n  SUM(Total_Cancels_including_3rd_Party) AS current_total_cancels_including_3rd_party,\n  SUM(Total_Closing_Base) AS current_total_closing_base,\n  SUM(Total_Revenue) AS current_total_revenue,\n  SUM(Total_Weekly_Sales) AS current_total_weekly_sales,\n\n  -- Versioned Metrics (from Q1)\n  SUM(Always_on_Digital_Sales_V) AS versioned_always_on_digital_sales,\n  SUM(Breach_Sales_V) AS versioned_breach_sales,\n  SUM(Closing_Base_3rd_Party_V) AS versioned_closing_base_3rd_party,\n  SUM(Essentials_V) AS versioned_essentials,\n  SUM(General_Offer_Sales_V) AS versioned_general_offer_sales,\n  SUM(Net_Cancels_V) AS versioned_net_cancels,\n  SUM(Net_Growth_3rd_Party_V) AS versioned_net_growth_3rd_party,\n  SUM(Net_Growth_Consumer_V) AS versioned_net_growth_consumer,\n  SUM(Net_Growth_incl_3rd_Party_V) AS versioned_net_growth_incl_3rd_party,\n  SUM(Other_Sales_V) AS versioned_other_sales,\n  SUM(Revenue_3rd_Party_V) AS versioned_revenue_3rd_party,\n  SUM(Revenue_Campus_V) AS versioned_revenue_campus,\n  SUM(Revenue_Consumer_V) AS versioned_revenue_consumer,\n  SUM(Revenue_Corp_V) AS versioned_revenue_corp,\n  SUM(Revenue_Other_V) AS versioned_revenue_other,\n  SUM(Switches_V) AS versioned_switches,\n  SUM(Total_Cancels_excluding_3rd_Party_V) AS versioned_total_cancels_excluding_3rd_party,\n  SUM(Total_Cancels_including_3rd_Party_V) AS versioned_total_cancels_including_3rd_party,\n  SUM(Total_Closing_Base_V) AS versioned_total_closing_base,\n  SUM(Total_Revenue_V) AS versioned_total_revenue,\n  SUM(Total_Weekly_Sales_V) AS versioned_total_weekly_sales,\n\n  -- 6-Week Metrics (from Q3)\n  SUM(Always_on_Digital_Sales_6W) AS six_week_always_on_digital_sales,\n  SUM(Breach_Sales_6W) AS six_week_breach_sales,\n  SUM(Closing_Base_3rd_Party_6W) AS six_week_closing_base_3rd_party,\n  SUM(Closing_Base_3rd_Party_APLS_6W) AS six_week_closing_base_3rd_party_apls,\n  SUM(Closing_Base_3rd_Party_GPLA_6W) AS six_week_closing_base_3rd_party_gpla,\n  SUM(Essentials_6W) AS six_week_essentials,\n  SUM(Failed_Payment_Volume_6W) AS six_week_failed_payment_volume,\n  SUM(General_Offer_Sales_6W) AS six_week_general_offer_sales,\n  SUM(Net_Cancels_6W) AS six_week_net_cancels,\n  SUM(Net_Growth_3rd_Party_6W) AS six_week_net_growth_3rd_party,\n  SUM(Net_Growth_Consumer_6W) AS six_week_net_growth_consumer,\n  SUM(Net_Growth_incl_3rd_party_6W) AS six_week_net_growth_incl_3rd_party,\n  SUM(Other_Sales_6W) AS six_week_other_sales,\n  SUM(Revenue_3rd_Party_6W) AS six_week_revenue_3rd_party,\n  SUM(Revenue_3rd_Party_APLS_6W) AS six_week_revenue_3rd_party_apls,\n  SUM(Revenue_3rd_Party_GPLA_6W) AS six_week_revenue_3rd_party_gpla,\n  SUM(Revenue_Campus_6W) AS six_week_revenue_campus,\n  SUM(Revenue_Consumer_6W) AS six_week_revenue_consumer,\n  SUM(Revenue_Corp_6W) AS six_week_revenue_corp,\n  SUM(Revenue_Other_6W) AS six_week_revenue_other,\n  SUM(Switches_6W) AS six_week_switches,\n  SUM(Total_Cancels_excluding_3rd_Party_6W) AS six_week_total_cancels_excluding_3rd_party,\n  SUM(Total_Cancels_including_3rd_Party_6W) AS six_week_total_cancels_including_3rd_party,\n  SUM(Total_Closing_Base_6W) AS six_week_total_closing_base,\n  SUM(Total_Revenue_6W) AS six_week_total_revenue,\n  SUM(Total_Weekly_Sales_6W) AS six_week_total_weekly_sales\nFROM base_data\nWHERE\n  fy_year = 2025 -- This should be a parameter or relative to CURRENT_DATE()\n  AND (\n    (fy_week_of_year = 37) -- For current week metrics (Q1/Q2 logic, based on 2025-03-30 report date)\n    OR\n    (fy_week_of_year BETWEEN 26 AND 31) -- For 6-week metrics (Q3 logic, based on 2025-02-10 report date)\n  )\n  -- The 'All Mastheads' filter is implicitly handled by not filtering on masthead_display_name\n  -- If a specific masthead filter was applied, it would be added here.\nGROUP BY\n  masthead,\n  masthead_display_name,\n  masthead_group_states_community,\n  masthead_group_metro_regionals,\n  fy_year,\n  fy_week_of_year\nORDER BY\n  fy_year DESC, fy_week_of_year DESC, masthead\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT \n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fy_year) as unique_fiscal_years,\n  COUNT(DISTINCT fy_week_of_year) as unique_fiscal_weeks,\n  COUNT(DISTINCT masthead) as unique_mastheads,\n  MIN(fy_year) as earliest_fiscal_year,\n  MAX(fy_year) as latest_fiscal_year,\n  MIN(fy_week_of_year) as earliest_fiscal_week,\n  MAX(fy_week_of_year) as latest_fiscal_week\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 2 -- Sample recent data"",
    ""validation_sql"": ""SELECT \n  'Validation Check' as test_type,\n  CASE WHEN SUM(Total_Revenue) > 0 THEN 'PASS' ELSE 'FAIL' END as total_revenue_test,\n  CASE WHEN COUNT(DISTINCT masthead) > 0 THEN 'PASS' ELSE 'FAIL' END as masthead_count_test,\n  CASE WHEN MAX(fy_year) >= EXTRACT(YEAR FROM CURRENT_DATE()) THEN 'PASS' ELSE 'FAIL' END as freshness_test\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year = 2025 AND fy_week_of_year = 37\nLIMIT 1"",
    ""business_rules_sql"": ""SELECT \n  'Business Rule Validation' as validation_type,\n  'Masthead Grouping - Metro' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN masthead IN ('CM', 'DT', 'HS', 'AA') THEN 1 ELSE 0 END) as records_matching_metro_group,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead IN ('CM', 'DT', 'HS', 'AA') THEN 1 ELSE 0 END), COUNT(*)) * 100 as metro_group_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year = 2025 AND fy_week_of_year = 37\nUNION ALL\nSELECT \n  'Business Rule Validation' as validation_type,\n  'Fiscal Year 2025 Filter' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN fy_year = 2025 THEN 1 ELSE 0 END) as records_matching_fy2025,\n  SAFE_DIVIDE(SUM(CASE WHEN fy_year = 2025 THEN 1 ELSE 0 END), COUNT(*)) * 100 as fy2025_percentage\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year >= EXTRACT(YEAR FROM CURRENT_DATE()) - 1"",
    ""sample_data_sql"": ""SELECT \n  masthead,\n  fy_year,\n  fy_week_of_year,\n  Total_Revenue,\n  Total_Weekly_Sales,\n  Net_Growth_Consumer,\n  Revenue_Consumer,\n  Closing_Base_Consumer,\n  Failed_Payment_Volume\nFROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard`\nWHERE fy_year = 2025 AND fy_week_of_year BETWEEN 26 AND 37\nORDER BY fy_year DESC, fy_week_of_year DESC, masthead\nLIMIT 500"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""03/07/2024"",
          ""original_format"": ""2024-07-03T00:00:00"",
          ""context"": ""Used as baseline date in DATETIME_DIFF calculation for week number. This is likely the start of the fiscal year."",
          ""suggested_fix"": ""Replace with a parameter (e.g., @fiscal_year_start_date) or a dynamic calculation based on CURRENT_DATE() and fiscal year rules."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""30/03/2025"",
          ""original_format"": ""2025-03-30 22:32:24.807251+00"",
          ""context"": ""Used as the 'current' report date for week number calculations in Query 1 and 2. This is a future date."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a parameter (e.g., @report_date) to reflect the actual reporting period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""10/02/2025"",
          ""original_format"": ""2025-02-10 00:11:05.853262+00"",
          ""context"": ""Used as the 'current' report date for week number calculations in Query 3. This is a future date."",
          ""suggested_fix"": ""Replace with CURRENT_DATE() or a parameter (e.g., @report_date) to reflect the actual reporting period."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'TA'"",
            ""'DT'"",
            ""'HS'"",
            ""'WT'"",
            ""'GA'"",
            ""'CM'"",
            ""'CP'"",
            ""'TB'"",
            ""'TC'"",
            ""'GC'"",
            ""'TM'"",
            ""'NT'"",
            ""'AA'""
          ],
          ""context"": ""Masthead codes hardcoded in CASE statements for display names and groupings."",
          ""suggested_governance"": ""Join to a `masthead_lookup` or `dim_masthead` table that contains codes, display names, and group classifications."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""2025"",
            ""2024""
          ],
          ""context"": ""Fiscal year filters (e.g., `fy_year = 2025`, `fy_year = 2024`) are hardcoded."",
          ""suggested_governance"": ""Use dynamic fiscal year calculations (e.g., `EXTRACT(YEAR FROM CURRENT_DATE())` or a fiscal calendar dimension) or parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""0"",
            ""1"",
            ""2"",
            ""3"",
            ""4"",
            ""5"",
            ""48"",
            ""49"",
            ""50"",
            ""51"",
            ""52""
          ],
          ""context"": ""Specific week numbers (e.g., `fy_week_of_year = 37`, `fy_week_of_year BETWEEN 26 AND 31`, `fy_week_of_year >= 48`) and day of week thresholds (`<= 2`, `<= 5`) are hardcoded."",
          ""suggested_governance"": ""Use parameters for week ranges or dynamic calculations based on the report date and fiscal calendar rules."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [
            ""'States and Community'"",
            ""'The Australian and Prestige'"",
            ""'Metro'"",
            ""'Regionals'""
          ],
          ""context"": ""Masthead group names are hardcoded in CASE statements."",
          ""suggested_governance"": ""Manage these categories in a lookup table associated with mastheads."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""(0 = 1)"",
            ""(0 = 2)"",
            ""(0 = 3)"",
            ""(0 = 4)"",
            ""(0 = 5)""
          ],
          ""context"": ""Boolean conditions that are always false, likely placeholders for dynamic week filters that are currently inactive or set to 'All'."",
          ""suggested_governance"": ""Implement dynamic filter logic using parameters or conditional SQL that omits the filter when 'All' is selected, rather than using always-false conditions."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters (e.g., `@report_date`, `@fiscal_year_start_date`) or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB`)."",
      ""Replace hardcoded lookup values (masthead codes, group names) with joins to governed reference tables (e.g., `dim_masthead`)."",
      ""Use configuration tables or dynamic logic for business rules (e.g., fiscal year/week calculations, specific week filters) instead of hardcoded values in queries.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""masthead_display_name"",
      ""metric_name"": ""Masthead Display Name"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""masthead"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The human-readable name for each masthead, derived from its code."",
      ""sql_logic"": ""CASE WHEN (t0.masthead = 'TA') THEN 'The Australian' ... ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for reporting and filtering by masthead."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'TA'"",
        ""'The Australian'"",
        ""'DT'"",
        ""'Daily Telegraph'"",
        ""'HS'"",
        ""'Herald Sun'"",
        ""'WT'"",
        ""'Weekly Times'"",
        ""'GA'"",
        ""'Geelong Advertiser'"",
        ""'CM'"",
        ""'Courier Mail'"",
        ""'CP'"",
        ""'Cairns Post'"",
        ""'TB'"",
        ""'Townsville Bulletin'"",
        ""'TC'"",
        ""'Toowoomba Chronicles'"",
        ""'GC'"",
        ""'Gold Coast'"",
        ""'TM'"",
        ""'The Mercury'"",
        ""'NT'"",
        ""'NT News'"",
        ""'AA'"",
        ""'The Advertiser'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_group_states_community"",
      ""metric_name"": ""Masthead Group (States & Community)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""masthead"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of mastheads into 'States and Community' or 'The Australian and Prestige'."",
      ""sql_logic"": ""CASE WHEN (t0.masthead IN ('CM', 'DT', 'HS', 'AA', 'CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT')) THEN 'States and Community' WHEN (t0.masthead = 'TA') THEN 'The Australian and Prestige' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for high-level regional or strategic grouping of mastheads."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'States and Community'"",
        ""'TA'"",
        ""'The Australian and Prestige'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""masthead_group_metro_regionals"",
      ""metric_name"": ""Masthead Group (Metro & Regionals)"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""masthead"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Categorization of mastheads into 'Metro' or 'Regionals'."",
      ""sql_logic"": ""CASE WHEN (t0.masthead IN ('CM', 'DT', 'HS', 'AA')) THEN 'Metro' WHEN (t0.masthead IN ('CP', 'GA', 'GC', 'NT', 'TM', 'TB', 'TC', 'WT')) THEN 'Regionals' ELSE NULL END"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used for geographical grouping of mastheads."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [
        ""'CM'"",
        ""'DT'"",
        ""'HS'"",
        ""'AA'"",
        ""'Metro'"",
        ""'CP'"",
        ""'GA'"",
        ""'GC'"",
        ""'NT'"",
        ""'TM'"",
        ""'TB'"",
        ""'TC'"",
        ""'WT'"",
        ""'Regionals'""
      ],
      ""governance_issues"": [
        ""Lookup values should use reference table.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_year"",
      ""metric_name"": ""Fiscal Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""yearly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal year for the reported data."",
      ""sql_logic"": ""t0.fy_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for annual reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""fy_week_of_year"",
      ""metric_name"": ""Fiscal Week of Year"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fiscal week number within the fiscal year."",
      ""sql_logic"": ""t0.fy_week_of_year"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary time dimension for weekly reporting."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_report_day_of_week"",
      ""metric_name"": ""Current Report Day of Week"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Calculates the day of the week (0-indexed, Sunday=0) for the hardcoded report date."",
      ""sql_logic"": ""EXTRACT(DAYOFWEEK FROM TIMESTAMP(DATE('2025-03-30'))) - 1"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in complex conditional logic to determine the effective fiscal week for filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""30/03/2025""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Date should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_report_week_from_base"",
      ""metric_name"": ""Current Report Week from Base Date"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Calculates the number of full weeks between a fixed base date (03/07/2024) and the hardcoded report date."",
      ""sql_logic"": ""DATETIME_DIFF(SAFE_CAST(DATE('2025-03-30') AS DATETIME), SAFE_CAST(DATETIME '2024-07-03T00:00:00' AS DATETIME), WEEK)"",
      ""data_sources"": [],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used in complex conditional logic to determine the effective fiscal week for filtering."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""on_demand"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [
        ""30/03/2025"",
        ""03/07/2024""
      ],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [
        ""Dates should be parameterised.""
      ],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_always_on_digital_sales"",
      ""metric_name"": ""Current Always-on Digital Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total digital sales from always-on campaigns for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Always_on_Digital_Sales)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key sales performance indicator for digital subscriptions/products."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_breach_sales"",
      ""metric_name"": ""Current Breach Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales resulting from breach (e.g., retention) activities for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Breach_Sales)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures effectiveness of retention or recovery efforts."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_closing_base_3rd_party"",
      ""metric_name"": ""Current Closing Base (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party subscribers/customers at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates the size of the 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_closing_base_3rd_party_apls"",
      ""metric_name"": ""Current Closing Base (3rd Party APLS)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party APLS subscribers/customers at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_APLS)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates the size of a specific segment of 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_closing_base_3rd_party_gpla"",
      ""metric_name"": ""Current Closing Base (3rd Party GPLA)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party GPLA subscribers/customers at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_GPLA)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates the size of a specific segment of 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_closing_base_consumer"",
      ""metric_name"": ""Current Closing Base (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of direct consumer subscribers/customers at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_Consumer)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates the size of the direct consumer customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_essentials"",
      ""metric_name"": ""Current Essentials"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Essentials' related metric for the current reporting period. (Specific meaning needs business context)."",
      ""sql_logic"": ""SUM(t0.Essentials)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely a key performance indicator for a specific product or service category."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_failed_payment_volume"",
      ""metric_name"": ""Current Failed Payment Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total volume of failed payments for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Failed_Payment_Volume)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates payment processing issues and potential revenue loss."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_general_offer_sales"",
      ""metric_name"": ""Current General Offer Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general offers/promotions for the current reporting period."",
      ""sql_logic"": ""SUM(t0.General_Offer_Sales)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the effectiveness of broad marketing campaigns."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_cancels"",
      ""metric_name"": ""Current Net Cancels"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net cancellations (cancellations minus win-backs/retentions) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Cancels)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key indicator of customer churn and retention success."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_growth_3rd_party"",
      ""metric_name"": ""Current Net Growth (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in 3rd party subscribers/customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the expansion or contraction of the 3rd party customer base."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_growth_3rd_party_apls"",
      ""metric_name"": ""Current Net Growth (3rd Party APLS)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in 3rd party APLS subscribers/customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_3rd_Party_APLS)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the expansion or contraction of a specific 3rd party customer segment."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_growth_3rd_party_gpla"",
      ""metric_name"": ""Current Net Growth (3rd Party GPLA)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in 3rd party GPLA subscribers/customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_3rd_Party_GPLA)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the expansion or contraction of a specific 3rd party customer segment."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_growth_consumer"",
      ""metric_name"": ""Current Net Growth (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in direct consumer subscribers/customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_Consumer)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures the expansion or contraction of the direct consumer customer base."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_net_growth_incl_3rd_party"",
      ""metric_name"": ""Current Net Growth (incl. 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Overall net growth in subscribers/customers, including 3rd party, for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_incl_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Comprehensive measure of customer base expansion."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_other_sales"",
      ""metric_name"": ""Current Other Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from miscellaneous or uncategorized sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Other_Sales)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Captures sales not covered by main categories."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_3rd_party"",
      ""metric_name"": ""Current Revenue (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key revenue stream from partnerships."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_3rd_party_apls"",
      ""metric_name"": ""Current Revenue (3rd Party APLS)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party APLS sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_APLS)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Revenue from a specific 3rd party segment."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_3rd_party_gpla"",
      ""metric_name"": ""Current Revenue (3rd Party GPLA)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party GPLA sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_GPLA)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Revenue from a specific 3rd party segment."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_campus"",
      ""metric_name"": ""Current Revenue (Campus)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related activities/subscriptions for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Campus)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Revenue from educational or campus-specific programs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_consumer"",
      ""metric_name"": ""Current Revenue (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Consumer)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Primary revenue stream from direct customer subscriptions/purchases."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_corp"",
      ""metric_name"": ""Current Revenue (Corporate)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate clients/subscriptions for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Corp)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Revenue from B2B partnerships or bulk subscriptions."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_revenue_other"",
      ""metric_name"": ""Current Revenue (Other)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or uncategorized sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Other)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Captures revenue not covered by main categories."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_switches"",
      ""metric_name"": ""Current Switches"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total number of customer switches between products/plans for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Switches)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Indicates customer migration patterns."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_total_cancels_excluding_3rd_party"",
      ""metric_name"": ""Current Total Cancels (excluding 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations excluding 3rd party customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_excluding_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures direct customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_total_cancels_including_3rd_party"",
      ""metric_name"": ""Current Total Cancels (including 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations including 3rd party customers for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_including_3rd_Party)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Measures overall customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_total_closing_base"",
      ""metric_name"": ""Current Total Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer base (including all segments) at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Closing_Base)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Overall size of the customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_total_revenue"",
      ""metric_name"": ""Current Total Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from all sources for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Revenue)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Overall financial performance indicator."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""current_total_weekly_sales"",
      ""metric_name"": ""Current Total Weekly Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales volume for the current reporting week."",
      ""sql_logic"": ""SUM(t0.Total_Weekly_Sales)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key sales volume indicator."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_always_on_digital_sales"",
      ""metric_name"": ""Versioned Always-on Digital Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total digital sales from always-on campaigns (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Always_on_Digital_Sales_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of digital sales, possibly for comparison or specific reporting needs."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_breach_sales"",
      ""metric_name"": ""Versioned Breach Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales resulting from breach (e.g., retention) activities (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Breach_Sales_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of breach sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_closing_base_3rd_party"",
      ""metric_name"": ""Versioned Closing Base (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party subscribers/customers at the end of the current reporting period (versioned data)."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of 3rd party customer base."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_essentials"",
      ""metric_name"": ""Versioned Essentials"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Essentials' related metric (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Essentials_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of Essentials metric."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_general_offer_sales"",
      ""metric_name"": ""Versioned General Offer Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general offers/promotions (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.General_Offer_Sales_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of general offer sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_net_cancels"",
      ""metric_name"": ""Versioned Net Cancels"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net cancellations (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Cancels_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of net cancels."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_net_growth_3rd_party"",
      ""metric_name"": ""Versioned Net Growth (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in 3rd party subscribers/customers (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of 3rd party net growth."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_net_growth_consumer"",
      ""metric_name"": ""Versioned Net Growth (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in direct consumer subscribers/customers (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_Consumer_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of consumer net growth."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_net_growth_incl_3rd_party"",
      ""metric_name"": ""Versioned Net Growth (incl. 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Overall net growth in subscribers/customers, including 3rd party (versioned data), for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_incl_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of overall net growth."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_other_sales"",
      ""metric_name"": ""Versioned Other Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from miscellaneous or uncategorized sources (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Other_Sales_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of other sales."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_revenue_3rd_party"",
      ""metric_name"": ""Versioned Revenue (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party sources (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of 3rd party revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_revenue_campus"",
      ""metric_name"": ""Versioned Revenue (Campus)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related activities/subscriptions (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Campus_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of campus revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_revenue_consumer"",
      ""metric_name"": ""Versioned Revenue (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Consumer_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of consumer revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_revenue_corp"",
      ""metric_name"": ""Versioned Revenue (Corporate)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate clients/subscriptions (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Corp_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of corporate revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_revenue_other"",
      ""metric_name"": ""Versioned Revenue (Other)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or uncategorized sources (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Revenue_Other_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of other revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_switches"",
      ""metric_name"": ""Versioned Switches"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total number of customer switches between products/plans (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Switches_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of switches metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_total_cancels_excluding_3rd_party"",
      ""metric_name"": ""Versioned Total Cancels (excluding 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations excluding 3rd party customers (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_excluding_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of direct customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_total_cancels_including_3rd_party"",
      ""metric_name"": ""Versioned Total Cancels (including 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations including 3rd party customers (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_including_3rd_Party_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of overall customer churn."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_total_closing_base"",
      ""metric_name"": ""Versioned Total Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer base (including all segments, versioned data) at the end of the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Closing_Base_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of overall customer base size."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_total_revenue"",
      ""metric_name"": ""Versioned Total Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from all sources (versioned data) for the current reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Revenue_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of overall financial performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""versioned_total_weekly_sales"",
      ""metric_name"": ""Versioned Total Weekly Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales volume (versioned data) for the current reporting week."",
      ""sql_logic"": ""SUM(t0.Total_Weekly_Sales_V)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year = 37"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Alternative version of weekly sales volume."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_always_on_digital_sales"",
      ""metric_name"": ""6-Week Always-on Digital Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total digital sales from always-on campaigns over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Always_on_Digital_Sales_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated sales performance over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_breach_sales"",
      ""metric_name"": ""6-Week Breach Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales resulting from breach (e.g., retention) activities over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Breach_Sales_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated retention sales over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_closing_base_3rd_party"",
      ""metric_name"": ""6-Week Closing Base (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party subscribers/customers at the end of the 6-week reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party customer base over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_closing_base_3rd_party_apls"",
      ""metric_name"": ""6-Week Closing Base (3rd Party APLS)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party APLS subscribers/customers at the end of the 6-week reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_APLS_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party APLS customer base over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_closing_base_3rd_party_gpla"",
      ""metric_name"": ""6-Week Closing Base (3rd Party GPLA)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The total number of 3rd party GPLA subscribers/customers at the end of the 6-week reporting period."",
      ""sql_logic"": ""SUM(t0.Closing_Base_3rd_Party_GPLA_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party GPLA customer base over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_essentials"",
      ""metric_name"": ""6-Week Essentials"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total 'Essentials' related metric over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Essentials_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated Essentials metric over a recent 6-week window."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_failed_payment_volume"",
      ""metric_name"": ""6-Week Failed Payment Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total volume of failed payments over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Failed_Payment_Volume_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated failed payment volume over a recent 6-week window."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_general_offer_sales"",
      ""metric_name"": ""6-Week General Offer Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from general offers/promotions over a 6-week period."",
      ""sql_logic"": ""SUM(t0.General_Offer_Sales_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated general offer sales over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_net_cancels"",
      ""metric_name"": ""6-Week Net Cancels"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net cancellations (cancellations minus win-backs/retentions) over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Net_Cancels_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated net cancellations over a recent 6-week window."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_net_growth_3rd_party"",
      ""metric_name"": ""6-Week Net Growth (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in 3rd party subscribers/customers over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_3rd_Party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party net growth over a recent 6-week window."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_net_growth_consumer"",
      ""metric_name"": ""6-Week Net Growth (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Net growth in direct consumer subscribers/customers over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_Consumer_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated consumer net growth over a recent 6-week window."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_net_growth_incl_3rd_party"",
      ""metric_name"": ""6-Week Net Growth (incl. 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Overall net growth in subscribers/customers, including 3rd party, over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Net_Growth_incl_3rd_party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated overall net growth over a recent 6-week window."",
      ""metric_category"": ""growth"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_other_sales"",
      ""metric_name"": ""6-Week Other Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales from miscellaneous or uncategorized sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Other_Sales_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated other sales over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_3rd_party"",
      ""metric_name"": ""6-Week Revenue (3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_3rd_party_apls"",
      ""metric_name"": ""6-Week Revenue (3rd Party APLS)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party APLS sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_APLS_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party APLS revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_3rd_party_gpla"",
      ""metric_name"": ""6-Week Revenue (3rd Party GPLA)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from 3rd party GPLA sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_3rd_Party_GPLA_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated 3rd party GPLA revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_campus"",
      ""metric_name"": ""6-Week Revenue (Campus)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from campus-related activities/subscriptions over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_Campus_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated campus revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_consumer"",
      ""metric_name"": ""6-Week Revenue (Consumer)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated directly from consumers over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_Consumer_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated consumer revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_corp"",
      ""metric_name"": ""6-Week Revenue (Corporate)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue generated from corporate clients/subscriptions over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_Corp_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated corporate revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_revenue_other"",
      ""metric_name"": ""6-Week Revenue (Other)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from miscellaneous or uncategorized sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Revenue_Other_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated other revenue over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_switches"",
      ""metric_name"": ""6-Week Switches"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total number of customer switches between products/plans over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Switches_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated customer migration patterns over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_total_cancels_excluding_3rd_party"",
      ""metric_name"": ""6-Week Total Cancels (excluding 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations excluding 3rd party customers over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_excluding_3rd_Party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated direct customer churn over a recent 6-week window."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_total_cancels_including_3rd_party"",
      ""metric_name"": ""6-Week Total Cancels (including 3rd Party)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total cancellations including 3rd party customers over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Total_Cancels_including_3rd_Party_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated overall customer churn over a recent 6-week window."",
      ""metric_category"": ""retention"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_total_closing_base"",
      ""metric_name"": ""6-Week Total Closing Base"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total customer base (including all segments) at the end of the 6-week reporting period."",
      ""sql_logic"": ""SUM(t0.Total_Closing_Base_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated overall customer base size over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_total_revenue"",
      ""metric_name"": ""6-Week Total Revenue"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total revenue from all sources over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Total_Revenue_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated overall financial performance over a recent 6-week window."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""six_week_total_weekly_sales"",
      ""metric_name"": ""6-Week Total Weekly Sales"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Total sales volume over a 6-week period."",
      ""sql_logic"": ""SUM(t0.Total_Weekly_Sales_6W)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard""
      ],
      ""filters_applied"": [
        ""fy_year = 2025"",
        ""fy_week_of_year BETWEEN 26 AND 31"",
        ""All Mastheads selected""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Aggregated sales volume over a recent 6-week window."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""weekly"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_total_closing_base"",
      ""related_metrics"": [
        ""current_closing_base_consumer"",
        ""current_closing_base_3rd_party""
      ],
      ""relationship_description"": ""Total Closing Base is likely the sum of Consumer Closing Base and 3rd Party Closing Base."",
      ""mathematical_formula"": ""Total_Closing_Base = Closing_Base_Consumer + Closing_Base_3rd_Party"",
      ""business_validation"": ""Ensures comprehensive count of active subscribers across all segments."",
      ""validation_sql"": ""SELECT SUM(Total_Closing_Base) - (SUM(Closing_Base_Consumer) + SUM(Closing_Base_3rd_Party)) AS variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""current_net_growth_incl_3rd_party"",
      ""related_metrics"": [
        ""current_net_growth_consumer"",
        ""current_net_growth_3rd_party""
      ],
      ""relationship_description"": ""Net Growth including 3rd Party is likely the sum of Net Growth Consumer and Net Growth 3rd Party."",
      ""mathematical_formula"": ""Net_Growth_incl_3rd_Party = Net_Growth_Consumer + Net_Growth_3rd_Party"",
      ""business_validation"": ""Verifies the overall growth calculation by summing individual segment growths."",
      ""validation_sql"": ""SELECT SUM(Net_Growth_incl_3rd_Party) - (SUM(Net_Growth_Consumer) + SUM(Net_Growth_3rd_Party)) AS variance FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""fy_week_of_year"",
      ""related_metrics"": [
        ""current_always_on_digital_sales"",
        ""six_week_always_on_digital_sales""
      ],
      ""relationship_description"": ""The `fy_week_of_year` dimension, combined with hardcoded report dates, dictates which specific week or range of weeks the metrics are aggregated for. This leads to different versions of the same metric (e.g., 'current' vs '6-week')."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Ensures that different dashboard components display data for their intended timeframes (e.g., current week vs. trailing 6 weeks)."",
      ""validation_sql"": ""SELECT fy_year, fy_week_of_year, SUM(Total_Revenue) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year = 37 GROUP BY 1,2 UNION ALL SELECT fy_year, fy_week_of_year, SUM(Total_Revenue_6W) FROM `ncau-data-newsquery-prd.asl_finance_derived.consumer_masthead_scorecard` WHERE fy_year = 2025 AND fy_week_of_year BETWEEN 26 AND 31 GROUP BY 1,2"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,42
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""f7a9efeb-df3c-45c9-899d-0bcada701572"",
    ""dashboard_name"": ""Salaries & Wages Dashboard UAT Version"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check;ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement;ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 7,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 5,
    ""date_grain"": ""weekly"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [""fy_year_week_number"", ""revenue_type""],
    ""date_range_detected"": ""Dynamic (latest snapshot time, historical weekly data)"",
    ""hardcoded_dates_found"": [],
    ""hardcoded_values_found"": [""'03'"", ""'Circulation'"", ""'Estimate'"", ""'RCTI'"", ""'THINK'"", ""'DTI'"", ""'Australia/Sydney'""],
    ""governance_opportunities"": [""'03' revenue type prefix should be mapped to a reference table"", ""source system and scenario filters should be configurable or use reference tables"", ""timezone should be a parameter or system variable""]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This query calculates the core business metrics (amount and volume, total and for specific revenue types) by fiscal year week number.\n-- It also includes the latest data load time as a separate, non-aggregated metric.\n\nWITH CirculationMetrics AS (\n  SELECT\n    t0.fy_year_week_number AS fy_year_week_number,\n    SUM(t0.amount) AS total_amount,\n    SUM(t0.volume) AS total_volume,\n    SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.amount ELSE 0 END) AS amount_revenue_type_03,\n    SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.volume ELSE 0 END) AS volume_revenue_type_03\n  FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` AS t0\n  GROUP BY 1\n),\nLatestLoadTime AS (\n  SELECT\n    MIN(snap_load_time) AS latest_snapshot_load_time\n  FROM (\n    SELECT\n      datetime(max(dw_prstn_load_timestamp), 'Australia/Sydney') AS snap_load_time\n    FROM\n      `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`\n    WHERE\n      source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI')\n    UNION ALL\n    SELECT\n      datetime(max(dw_bdm_load_timestamp), 'Australia/Sydney') AS snap_load_time\n    FROM\n      `ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct`\n  ) AS load_time\n)\nSELECT\n  cm.fy_year_week_number,\n  cm.total_amount,\n  cm.total_volume,\n  cm.amount_revenue_type_03,\n  cm.volume_revenue_type_03,\n  (SELECT latest_snapshot_load_time FROM LatestLoadTime) AS latest_data_load_time\nFROM CirculationMetrics cm\nORDER BY cm.fy_year_week_number DESC\nLIMIT 1000;"",
    ""structure_sql"": ""-- Query to understand data structure, grain, and key dimensions with sampling for asl_finance.v_asl_circulation_dq_check\nSELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT fy_year_week_number) as unique_fy_week_numbers,\n  COUNT(DISTINCT revenue_type) as unique_revenue_types,\n  MIN(fy_year_week_number) as earliest_fy_week_number,\n  MAX(fy_year_week_number) as latest_fy_week_number,\n  APPROX_COUNT_DISTINCT(CONCAT(fy_year_week_number, '-', revenue_type, '-', amount, '-', volume)) as approx_unique_rows_at_grain\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE fy_year_week_number IS NOT NULL\nLIMIT 1000;\n\n-- Query to understand data structure for snapshot tables\nSELECT\n  'Snapshot Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records_finance_operating_statement,\n  COUNT(DISTINCT dw_prstn_load_timestamp) as unique_load_timestamps_finance_operating_statement,\n  MIN(dw_prstn_load_timestamp) as earliest_load_timestamp_finance_operating_statement,\n  MAX(dw_prstn_load_timestamp) as latest_load_timestamp_finance_operating_statement\nFROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`\nWHERE source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI')\nLIMIT 1000;\n\nSELECT\n  'Snapshot Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records_circulation_snapshot_fct,\n  COUNT(DISTINCT dw_bdm_load_timestamp) as unique_load_timestamps_circulation_snapshot_fct,\n  MIN(dw_bdm_load_timestamp) as earliest_load_timestamp_circulation_snapshot_fct,\n  MAX(dw_bdm_load_timestamp) as latest_load_timestamp_circulation_snapshot_fct\nFROM `ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct`\nLIMIT 1000;"",
    ""validation_sql"": ""-- Quick syntax and logic validation for core metrics\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN SUM(amount) > 0 THEN 'PASS' ELSE 'FAIL' END as total_amount_test,\n  CASE WHEN SUM(volume) > 0 THEN 'PASS' ELSE 'FAIL' END as total_volume_test,\n  CASE WHEN SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END) >= 0 THEN 'PASS' ELSE 'FAIL' END as amount_revenue_type_03_test\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE fy_year_week_number IS NOT NULL\nLIMIT 1;\n\n-- Quick syntax and logic validation for latest snapshot load time\nSELECT\n  'Validation Check' as test_type,\n  CASE WHEN MIN(snap_load_time) IS NOT NULL THEN 'PASS' ELSE 'FAIL' END as latest_load_time_test\nFROM (\n    SELECT\n      datetime(max(dw_prstn_load_timestamp), 'Australia/Sydney') AS snap_load_time\n    FROM\n      `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`\n    WHERE\n      source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI')\n    UNION ALL\n    SELECT\n      datetime(max(dw_bdm_load_timestamp), 'Australia/Sydney') AS snap_load_time\n    FROM\n      `ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct`\n  ) AS load_time\nLIMIT 1;"",
    ""business_rules_sql"": ""-- Validate business logic for revenue type '03' filtering\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Revenue Type 03 Filtering' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN 1 ELSE 0 END) as records_matching_03_prefix,\n  SAFE_DIVIDE(SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_with_03_prefix\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE fy_year_week_number IS NOT NULL\nLIMIT 1000;\n\n-- Validate business logic for snapshot filters\nSELECT\n  'Business Rule Validation' as validation_type,\n  'Snapshot Filters' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI') THEN 1 ELSE 0 END) as records_matching_filters,\n  SAFE_DIVIDE(SUM(CASE WHEN source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI') THEN 1 ELSE 0 END), COUNT(*)) * 100 as percentage_matching_filters\nFROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`\nLIMIT 1000;"",
    ""sample_data_sql"": ""-- Get representative sample data for asl_finance.v_asl_circulation_dq_check\nSELECT\n  fy_year_week_number,\n  revenue_type,\n  amount,\n  volume\nFROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`\nWHERE fy_year_week_number IS NOT NULL\nORDER BY fy_year_week_number DESC, amount DESC\nLIMIT 500;\n\n-- Get representative sample data for snapshot tables\nSELECT\n  dw_prstn_load_timestamp,\n  source_system_name,\n  scenario,\n  sub_source_system_name\nFROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`\nWHERE source_system_name = 'Circulation' AND scenario = 'Estimate' AND sub_source_system_name IN ('RCTI', 'THINK', 'DTI')\nORDER BY dw_prstn_load_timestamp DESC\nLIMIT 100;\n\nSELECT\n  dw_bdm_load_timestamp\nFROM `ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct`\nORDER BY dw_bdm_load_timestamp DESC\nLIMIT 100;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'03'""],
          ""context"": ""Used to filter and conditionally aggregate 'amount' and 'volume' based on the first two characters of 'revenue_type'."",
          ""suggested_governance"": ""Replace with a join to a 'revenue_type_master' table that defines revenue type categories."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [""'Circulation'"", ""'Estimate'"", ""'RCTI'"", ""'THINK'"", ""'DTI'""],
          ""context"": ""Used as filters for 'source_system_name', 'scenario', and 'sub_source_system_name' in the 'finance_operating_statement' table to determine the latest snapshot time."",
          ""suggested_governance"": ""Define these filter values in a configuration table or a governed lookup table for system parameters."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""other"",
          ""hardcoded_values"": [""'Australia/Sydney'""],
          ""context"": ""Timezone specification for DATETIME conversion of load timestamps."",
          ""suggested_governance"": ""Parameterize the timezone or use a system-wide default configuration."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded lookup values (e.g., '03' for revenue type, system names) with joins to governed reference tables or configuration tables."",
      ""Parameterize the timezone ('Australia/Sydney') for date/time conversions to allow for regional flexibility.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""total_amount_all_revenue_types"",
      ""metric_name"": ""Total Amount (All Revenue Types)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all 'amount' values, representing total financial value across all revenue types."",
      ""sql_logic"": ""SUM(t0.amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Core financial metric for overall revenue or cost tracking."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls in 'amount' column""]
    },
    {
      ""metric_id"": ""total_volume_all_revenue_types"",
      ""metric_name"": ""Total Volume (All Revenue Types)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The sum of all 'volume' values, representing total units or quantity across all revenue types."",
      ""sql_logic"": ""SUM(t0.volume)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Core operational metric for tracking quantity or usage."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls in 'volume' column""]
    },
    {
      ""metric_id"": ""amount_revenue_type_03"",
      ""metric_name"": ""Amount for Revenue Type '03'"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""total_amount_all_revenue_types"", ""revenue_type_prefix""],
      ""business_description"": ""The sum of 'amount' values specifically for transactions where the 'revenue_type' starts with '03'. This likely represents a specific category of revenue or cost."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.amount ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""],
      ""filters_applied"": [""revenue_type prefix '03'""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Key financial metric for a specific segment of revenue/cost, requiring specific attention or analysis."",
      ""metric_category"": ""finance"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'03'""],
      ""governance_issues"": [""lookup values should use reference table""],
      ""data_quality_concerns"": [""potential nulls in 'amount' column"", ""inconsistent 'revenue_type' formatting""]
    },
    {
      ""metric_id"": ""volume_revenue_type_03"",
      ""metric_name"": ""Volume for Revenue Type '03'"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""conditional"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""total_volume_all_revenue_types"", ""revenue_type_prefix""],
      ""business_description"": ""The sum of 'volume' values specifically for transactions where the 'revenue_type' starts with '03'. This likely represents the quantity for a specific category."",
      ""sql_logic"": ""SUM(CASE WHEN SAFE.LEFT(t0.revenue_type, 2) = '03' THEN t0.volume ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""],
      ""filters_applied"": [""revenue_type prefix '03'""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key operational metric for a specific segment of volume, requiring specific attention or analysis."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'03'""],
      ""governance_issues"": [""lookup values should use reference table""],
      ""data_quality_concerns"": [""potential nulls in 'volume' column"", ""inconsistent 'revenue_type' formatting""]
    },
    {
      ""metric_id"": ""latest_snapshot_load_time"",
      ""metric_name"": ""Latest Snapshot Load Time"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""min"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The most recent load timestamp across specified finance operating statement and circulation snapshot tables, indicating data freshness."",
      ""sql_logic"": ""MIN(DATETIME_TRUNC(DATETIME(MAX(dw_prstn_load_timestamp), 'Australia/Sydney'), SECOND) UNION ALL DATETIME_TRUNC(DATETIME(MAX(dw_bdm_load_timestamp), 'Australia/Sydney'), SECOND))"",
      ""data_sources"": [""ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement"", ""ncau-data-newsquery-prd.prstn_finance.v_circulation_snapshot_fct""],
      ""filters_applied"": [""source_system_name = 'Circulation'"", ""scenario = 'Estimate'"", ""sub_source_system_name IN ('RCTI', 'THINK', 'DTI')""],
      ""expected_data_type"": ""datetime"",
      ""business_context"": ""Used for data quality monitoring and ensuring users are aware of the data's recency."",
      ""metric_category"": ""quality"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Circulation'"", ""'Estimate'"", ""'RCTI'"", ""'THINK'"", ""'DTI'"", ""'Australia/Sydney'""],
      ""governance_issues"": [""filter values should use reference tables"", ""timezone should be parameterized""],
      ""data_quality_concerns"": [""dependency on source system load processes""]
    },
    {
      ""metric_id"": ""fy_year_week_number"",
      ""metric_name"": ""FY Year Week Number"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""Fiscal year and week number, used as the primary time dimension for aggregation."",
      ""sql_logic"": ""t0.fy_year_week_number"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Primary time-based grouping for financial and volume metrics."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""potential nulls"", ""inconsistent formatting""]
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""amount_revenue_type_03"",
      ""related_metrics"": [""total_amount_all_revenue_types"", ""revenue_type_prefix""],
      ""relationship_description"": ""Amount for Revenue Type '03' is a subset of Total Amount (All Revenue Types), filtered by the '03' prefix on 'revenue_type'."",
      ""mathematical_formula"": ""amount_revenue_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END)"",
      ""business_validation"": ""Ensures that the specific revenue type amount correctly contributes to the overall total and that the filtering logic is accurate."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN amount ELSE 0 END) AS amount_03, SUM(amount) AS total_amount FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""mathematical_relationship"",
      ""primary_metric"": ""volume_revenue_type_03"",
      ""related_metrics"": [""total_volume_all_revenue_types"", ""revenue_type_prefix""],
      ""relationship_description"": ""Volume for Revenue Type '03' is a subset of Total Volume (All Revenue Types), filtered by the '03' prefix on 'revenue_type'."",
      ""mathematical_formula"": ""volume_revenue_type_03 = SUM(CASE WHEN LEFT(revenue_type, 2) = '03' THEN volume ELSE 0 END)"",
      ""business_validation"": ""Ensures that the specific revenue type volume correctly contributes to the overall total and that the filtering logic is accurate."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN SAFE.LEFT(revenue_type, 2) = '03' THEN volume ELSE 0 END) AS volume_03, SUM(volume) AS total_volume FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check` WHERE fy_year_week_number = (SELECT MAX(fy_year_week_number) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circulation_dq_check`)"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""latest_snapshot_load_time"",
      ""related_metrics"": [],
      ""relationship_description"": ""The calculation of 'latest_snapshot_load_time' is heavily dependent on specific hardcoded filters for source system, scenario, and sub-source system names. Changes to these filters directly impact the data source and the resulting load time."",
      ""mathematical_formula"": ""N/A"",
      ""business_validation"": ""Verify that the specified filters ('Circulation', 'Estimate', 'RCTI', 'THINK', 'DTI') accurately reflect the desired data sources for freshness checks."",
      ""validation_sql"": ""SELECT DISTINCT source_system_name, scenario, sub_source_system_name FROM `ncau-data-newsquery-prd.prstn_finance_persisted.finance_operating_statement`"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,43
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""c441950c-1e3f-432c-9838-847d1d315b9e"",
    ""dashboard_name"": ""Circulation Insights for Analysis"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights;ncau-data-newsquery-prd.prstn_finance.v_calendar_dim"",
    ""business_domain"": ""finance"",
    ""complexity_score"": 6,
    ""consolidation_score"": 5,
    ""total_metrics_identified"": 10,
    ""date_grain"": ""mixed"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""fiscal_week_id"",
      ""day_of_week"",
      ""charge_type"",
      ""gl_publication_code"",
      ""sales_channel_l4"",
      ""derived_publication_type""
    ],
    ""date_range_detected"": ""Fiscal Year 2025, specific weeks within 2025"",
    ""hardcoded_dates_found"": [
      ""2025"",
      ""202541"",
      ""202542"",
      ""202543"",
      ""202544"",
      ""202545"",
      ""202533"",
      ""202534"",
      ""202535"",
      ""202536"",
      ""202537"",
      ""202538"",
      ""202539"",
      ""202540""
    ],
    ""hardcoded_values_found"": [
      ""'Sun'"",
      ""'Subscriptions'"",
      ""'DT'"",
      ""'DRAW'"",
      ""'RETURNS'"",
      ""'ADJUSTMENT'"",
      ""'ADV'"",
      ""'AUS'"",
      ""'CM'"",
      ""'Delicious'"",
      ""'Delicious Specials'"",
      ""'GAD'"",
      ""'GCB'"",
      ""'Group Shared Services'"",
      ""'Hobart Print Services'"",
      ""'HS'"",
      ""'MDM'"",
      ""'MERCURY'"",
      ""'NTN'"",
      ""'Perth Print Services'"",
      ""'Post Courier'"",
      ""'SC'"",
      ""'Taste'"",
      ""'TCHRN'"",
      ""'TCP'"",
      ""'TVB'"",
      ""'Vogue'"",
      ""'Vogue Living'"",
      ""'WT'"",
      ""'Other'"",
      ""'500'"",
      ""'560'"",
      ""'100'"",
      ""'400'"",
      ""'402'"",
      ""'9504'"",
      ""'9505'"",
      ""'110'"",
      ""'116'"",
      ""'350'"",
      ""'670'"",
      ""'180'"",
      ""'156'"",
      ""'301'"",
      ""'303'"",
      ""'5003'"",
      ""'850'"",
      ""'852'"",
      ""'961'"",
      ""'963'"",
      ""'158'"",
      ""'5024'"",
      ""'9514'"",
      ""'9515'"",
      ""'5053'"",
      ""'450'"",
      ""'475'"",
      ""'9560'"",
      ""'9556'"",
      ""'305'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised"",
      ""fiscal weeks should be derived from date parameters"",
      ""publication codes should join to a `gl_publication_lookup` table"",
      ""sales channel values should be governed via a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for consolidated analysis of Circulation Insights\nWITH base_data AS (\n  SELECT\n    ci.charge_date,\n    ci.fiscal_week_id,\n    cal.day_short_name AS day_of_week,\n    ci.charge_type,\n    ci.route_volume,\n    ci.charge_amount,\n    ci.gl_publication_code,\n    ci.sales_channel_l4\n  FROM\n    `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n    LEFT JOIN\n    `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n    ON ci.charge_date = cal.calendar_date\n  WHERE\n    -- Parameterize the fiscal year instead of hardcoding '2025'\n    CAST(LEFT(CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = 2025 -- To match original dashboard scope\n    -- OR CAST(LEFT(CAST(ci.fiscal_week_id AS STRING), 4) AS INT64) = EXTRACT(YEAR FROM CURRENT_DATE()) -- Example: Current year\n),\ncalculated_metrics AS (\n  SELECT\n    charge_date,\n    fiscal_week_id,\n    day_of_week,\n    charge_type,\n    route_volume,\n    charge_amount,\n    gl_publication_code,\n    sales_channel_l4,\n    -- Derived Metrics from Query 1\n    CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END AS draw_volume,\n    CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END AS returns_volume,\n    CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END AS adjustment_volume,\n    -- Derived Dimension from Query 2 (should ideally come from a lookup table)\n    CASE\n      WHEN gl_publication_code IN ('500', '560') THEN 'ADV'\n      WHEN gl_publication_code = '100' THEN 'AUS'\n      WHEN gl_publication_code IN ('400', '402') THEN 'CM'\n      WHEN gl_publication_code = '9504' THEN 'Delicious'\n      WHEN gl_publication_code = '9505' THEN 'Delicious Specials'\n      WHEN gl_publication_code IN ('110', '116') THEN 'DT'\n      WHEN gl_publication_code = '350' THEN 'GAD'\n      WHEN gl_publication_code = '670' THEN 'GCB'\n      WHEN gl_publication_code = '180' THEN 'Group Shared Services'\n      WHEN gl_publication_code = '156' THEN 'Hobart Print Services'\n      WHEN gl_publication_code IN ('301', '303') THEN 'HS'\n      WHEN gl_publication_code = '5003' THEN 'MDM'\n      WHEN gl_publication_code IN ('850', '852') THEN 'MERCURY'\n      WHEN gl_publication_code IN ('961', '963') THEN 'NTN'\n      WHEN gl_publication_code = '158' THEN 'Perth Print Services'\n      WHEN gl_publication_code = 'Post Courier' THEN 'Post Courier'\n      WHEN gl_publication_code = '5024' THEN 'SC'\n      WHEN gl_publication_code IN ('9514', '9515') THEN 'Taste'\n      WHEN gl_publication_code = '5053' THEN 'TCHRN'\n      WHEN gl_publication_code = '450' THEN 'TCP'\n      WHEN gl_publication_code = '475' THEN 'TVB'\n      WHEN gl_publication_code = '9560' THEN 'Vogue'\n      WHEN gl_publication_code = '9556' THEN 'Vogue Living'\n      WHEN gl_publication_code = '305' THEN 'WT'\n      ELSE 'Other'\n    END AS derived_publication_type\n  FROM\n    base_data\n)\nSELECT\n  fiscal_week_id,\n  day_of_week,\n  sales_channel_l4,\n  derived_publication_type,\n  SUM(draw_volume) AS total_draw_volume,\n  SUM(returns_volume) AS total_returns_volume,\n  SUM(adjustment_volume) AS total_adjustment_volume,\n  SUM(draw_volume + adjustment_volume + returns_volume) AS total_circulation_volume,\n  SUM(charge_amount) AS total_charge_amount\nFROM\n  calculated_metrics\nWHERE\n  -- Example filters to replicate original dashboard views, can be parameterized or removed for broader analysis\n  (day_of_week = 'Sun' AND fiscal_week_id IN (202541, 202542, 202543, 202544, 202545))\n  OR\n  (fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540) AND sales_channel_l4 = 'Subscriptions' AND derived_publication_type = 'DT')\nGROUP BY\n  fiscal_week_id,\n  day_of_week,\n  sales_channel_l4,\n  derived_publication_type\nORDER BY\n  fiscal_week_id DESC, day_of_week\nLIMIT 1000;\n"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' AS analysis_type,\n  COUNT(*) AS total_records,\n  COUNT(DISTINCT ci.charge_date) AS unique_charge_dates,\n  COUNT(DISTINCT ci.fiscal_week_id) AS unique_fiscal_weeks,\n  COUNT(DISTINCT cal.day_short_name) AS unique_days_of_week,\n  COUNT(DISTINCT ci.charge_type) AS unique_charge_types,\n  COUNT(DISTINCT ci.gl_publication_code) AS unique_publication_codes,\n  COUNT(DISTINCT ci.sales_channel_l4) AS unique_sales_channels,\n  MIN(ci.charge_date) AS earliest_charge_date,\n  MAX(ci.charge_date) AS latest_charge_date\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  LEFT JOIN\n  `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n  ON ci.charge_date = cal.calendar_date\nWHERE\n  ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY) -- Sample recent data\nLIMIT 1;\n"",
    ""validation_sql"": ""SELECT\n  'Validation Check' AS test_type,\n  CASE WHEN SUM(ci.route_volume) > 0 THEN 'PASS' ELSE 'FAIL' END AS route_volume_test,\n  CASE WHEN SUM(ci.charge_amount) > 0 THEN 'PASS' ELSE 'FAIL' END AS charge_amount_test,\n  CASE WHEN MAX(ci.charge_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END AS freshness_test,\n  CASE WHEN COUNT(DISTINCT ci.fiscal_week_id) > 0 THEN 'PASS' ELSE 'FAIL' END AS fiscal_week_id_test\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\nWHERE\n  ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;\n"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' AS validation_type,\n  'GL Publication Code Mapping Coverage' AS rule_name,\n  COUNT(DISTINCT gl_publication_code) AS total_distinct_codes,\n  COUNT(DISTINCT CASE\n    WHEN gl_publication_code IN ('500', '560') THEN 'ADV'\n    WHEN gl_publication_code = '100' THEN 'AUS'\n    WHEN gl_publication_code IN ('400', '402') THEN 'CM'\n    WHEN gl_publication_code = '9504' THEN 'Delicious'\n    WHEN gl_publication_code = '9505' THEN 'Delicious Specials'\n    WHEN gl_publication_code IN ('110', '116') THEN 'DT'\n    WHEN gl_publication_code = '350' THEN 'GAD'\n    WHEN gl_publication_code = '670' THEN 'GCB'\n    WHEN gl_publication_code = '180' THEN 'Group Shared Services'\n    WHEN gl_publication_code = '156' THEN 'Hobart Print Services'\n    WHEN gl_publication_code IN ('301', '303') THEN 'HS'\n    WHEN gl_publication_code = '5003' THEN 'MDM'\n    WHEN gl_publication_code IN ('850', '852') THEN 'MERCURY'\n    WHEN gl_publication_code IN ('961', '963') THEN 'NTN'\n    WHEN gl_publication_code = '158' THEN 'Perth Print Services'\n    WHEN gl_publication_code = 'Post Courier' THEN 'Post Courier'\n    WHEN gl_publication_code = '5024' THEN 'SC'\n    WHEN gl_publication_code IN ('9514', '9515') THEN 'Taste'\n    WHEN gl_publication_code = '5053' THEN 'TCHRN'\n    WHEN gl_publication_code = '450' THEN 'TCP'\n    WHEN gl_publication_code = '475' THEN 'TVB'\n    WHEN gl_publication_code = '9560' THEN 'Vogue'\n    WHEN gl_publication_code = '9556' THEN 'Vogue Living'\n    WHEN gl_publication_code = '305' THEN 'WT'\n    ELSE 'Other'\n  END) AS distinct_mapped_categories,\n  SUM(CASE WHEN\n    gl_publication_code IN ('500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156', '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514', '9515', '5053', '450', '475', '9560', '9556', '305')\n    THEN 1 ELSE 0 END) AS records_with_mapped_codes,\n  SUM(CASE WHEN\n    gl_publication_code NOT IN ('500', '560', '100', '400', '402', '9504', '9505', '110', '116', '350', '670', '180', '156', '301', '303', '5003', '850', '852', '961', '963', '158', 'Post Courier', '5024', '9514', '9515', '5053', '450', '475', '9560', '9556', '305')\n    THEN 1 ELSE 0 END) AS records_mapped_to_other\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights`\nWHERE\n  charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);\n"",
    ""sample_data_sql"": ""SELECT\n  ci.charge_date,\n  ci.fiscal_week_id,\n  cal.day_short_name AS day_of_week,\n  ci.charge_type,\n  ci.route_volume,\n  ci.charge_amount,\n  ci.gl_publication_code,\n  ci.sales_channel_l4\nFROM\n  `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci\n  LEFT JOIN\n  `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal\n  ON ci.charge_date = cal.calendar_date\nWHERE\n  ci.charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\nORDER BY\n  ci.charge_date DESC\nLIMIT 500;\n"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""2025"",
          ""original_format"": ""string '2025'"",
          ""context"": ""Used to filter fiscal year in all queries: `LEFT(CAST(fiscal_week_id AS string), 4) IN ('2025')`"",
          ""suggested_fix"": ""Replace with `EXTRACT(YEAR FROM CURRENT_DATE())` or a date parameter for fiscal year selection."",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""202541, 202542, 202543, 202544, 202545"",
          ""original_format"": ""integer list"",
          ""context"": ""Specific fiscal week IDs used in Query 1's WHERE clause."",
          ""suggested_fix"": ""Replace with a date range parameter (e.g., start_date, end_date) and derive fiscal weeks dynamically, or use a multi-select parameter in Looker Studio."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        },
        {
          ""date_value"": ""202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540"",
          ""original_format"": ""integer list"",
          ""context"": ""Specific fiscal week IDs used in Query 2's WHERE clause."",
          ""suggested_fix"": ""Replace with a date range parameter (e.g., start_date, end_date) and derive fiscal weeks dynamically, or use a multi-select parameter in Looker Studio."",
          ""impact"": ""medium"",
          ""urgency"": ""medium""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Sun'""],
          ""context"": ""Specific day of week filter in Query 1's WHERE clause."",
          ""suggested_governance"": ""Use a parameter for day of week selection."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'DRAW'"", ""'RETURNS'"", ""'ADJUSTMENT'""],
          ""context"": ""Charge types used in CASE statements for volume calculations in Query 1."",
          ""suggested_governance"": ""These seem like valid business categories, but if they change frequently, they could be managed in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [""'500'"", ""'560'"", ""'100'"", ""'400'"", ""'402'"", ""'9504'"", ""'9505'"", ""'110'"", ""'116'"", ""'350'"", ""'670'"", ""'180'"", ""'156'"", ""'301'"", ""'303'"", ""'5003'"", ""'850'"", ""'852'"", ""'961'"", ""'963'"", ""'158'"", ""'Post Courier'"", ""'5024'"", ""'9514'"", ""'9515'"", ""'5053'"", ""'450'"", ""'475'"", ""'9560'"", ""'9556'"", ""'305'""],
          ""context"": ""GL Publication Codes mapped to `derived_publication_type` in Query 2's CASE statement."",
          ""suggested_governance"": ""Create and join to a `gl_publication_lookup` table containing `gl_publication_code` and `derived_publication_type`."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'ADV'"", ""'AUS'"", ""'CM'"", ""'Delicious'"", ""'Delicious Specials'"", ""'DT'"", ""'GAD'"", ""'GCB'"", ""'Group Shared Services'"", ""'Hobart Print Services'"", ""'HS'"", ""'MDM'"", ""'MERCURY'"", ""'NTN'"", ""'Perth Print Services'"", ""'Post Courier'"", ""'SC'"", ""'Taste'"", ""'TCHRN'"", ""'TCP'"", ""'TVB'"", ""'Vogue'"", ""'Vogue Living'"", ""'WT'"", ""'Other'""],
          ""context"": ""Derived publication type categories in Query 2's CASE statement."",
          ""suggested_governance"": ""These are the target values of the `gl_publication_code` lookup; they should be defined in the `gl_publication_lookup` table."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'Subscriptions'""],
          ""context"": ""Sales channel filter in Query 2's WHERE clause."",
          ""suggested_governance"": ""Use a parameter for sales channel selection or manage valid sales channels in a reference table."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        },
        {
          ""variable_type"": ""categories"",
          ""hardcoded_values"": [""'DT'""],
          ""context"": ""Derived publication type filter in Query 2's WHERE clause."",
          ""suggested_governance"": ""Use a parameter for derived publication type selection."",
          ""impact"": ""low"",
          ""maintenance_risk"": ""low""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded fiscal years and weeks with date range parameters (e.g., `start_date`, `end_date`) or relative date functions (e.g., `CURRENT_DATE()`, `EXTRACT(YEAR FROM CURRENT_DATE())`)."",
      ""Replace hardcoded GL publication code mappings with a join to a governed `gl_publication_lookup` table."",
      ""Replace hardcoded filter values for `day_of_week`, `sales_channel_l4`, and `derived_publication_type` with Looker Studio parameters for user selection.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""fiscal_week_id"",
      ""metric_name"": ""Fiscal Week ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The unique identifier for a fiscal week, typically in YYYYWW format."",
      ""sql_logic"": ""t0.fiscal_week_id"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Year filter: `LEFT(CAST(fiscal_week_id AS string), 4) IN ('2025')`""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Key time dimension for analyzing circulation trends."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Year filter is hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""day_of_week"",
      ""metric_name"": ""Day of Week"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The short name of the day of the week (e.g., 'Sun', 'Mon'). Derived from charge_date."",
      ""sql_logic"": ""cal.day_short_name"",
      ""data_sources"": [""ncau-data-newsquery-prd.prstn_finance.v_calendar_dim""],
      ""filters_applied"": [""Specific day filter: `clmn1_ IN ('Sun')` in Q1""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to analyze daily patterns in circulation."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Sun'""],
      ""governance_issues"": [""Specific day filter is hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""charge_type"",
      ""metric_name"": ""Charge Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The type of circulation transaction, e.g., 'DRAW', 'RETURNS', 'ADJUSTMENT'."",
      ""sql_logic"": ""t0.charge_type"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Categorizes different types of volume movements."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'DRAW'"", ""'RETURNS'"", ""'ADJUSTMENT'""],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""route_volume"",
      ""metric_name"": ""Route Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The raw volume associated with a circulation transaction."",
      ""sql_logic"": ""t0.route_volume"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Base measure for calculating various circulation volumes."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential for negative values or outliers depending on business rules.""]
    },
    {
      ""metric_id"": ""charge_amount"",
      ""metric_name"": ""Charge Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""none"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The monetary amount associated with a charge transaction."",
      ""sql_logic"": ""t0.charge_amount"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""Base measure for calculating total charges, often related to revenue."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [""Potential for nulls or incorrect values if not properly recorded.""]
    },
    {
      ""metric_id"": ""gl_publication_code"",
      ""metric_name"": ""GL Publication Code"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""General Ledger publication code, used to identify specific publications."",
      ""sql_logic"": ""t0.gl_publication_code"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Key identifier for publications, often mapped to more user-friendly names."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [""Mapped to derived_publication_type using hardcoded logic.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""sales_channel_l4"",
      ""metric_name"": ""Sales Channel L4"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""none"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The fourth level of sales channel categorization, e.g., 'Subscriptions'."",
      ""sql_logic"": ""t0.sales_channel_l4"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Specific sales channel filter: `clmn4_ IN ('Subscriptions')` in Q2""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment circulation data by sales method."",
      ""metric_category"": ""sales"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'Subscriptions'""],
      ""governance_issues"": [""Specific sales channel filter is hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_draw_volume"",
      ""metric_name"": ""Total Draw Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""route_volume"", ""charge_type""],
      ""business_description"": ""The sum of all 'DRAW' type route volumes, representing the total number of publications drawn for distribution."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Year filter: '2025'"", ""Day filter: 'Sun'"", ""Fiscal week filter: 202541-202545""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key metric for understanding the supply side of circulation."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [""'Sun'"", ""202541"", ""202542"", ""202543"", ""202544"", ""202545""],
      ""governance_issues"": [""Filters are hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_returns_volume"",
      ""metric_name"": ""Total Returns Volume"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""route_volume"", ""charge_type""],
      ""business_description"": ""The sum of all 'RETURNS' type route volumes, representing the total number of publications returned."",
      ""sql_logic"": ""SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Year filter: '2025'"", ""Day filter: 'Sun'"", ""Fiscal week filter: 202541-202545""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key metric for understanding unsold inventory and efficiency of distribution."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [""'Sun'"", ""202541"", ""202542"", ""202543"", ""202544"", ""202545""],
      ""governance_issues"": [""Filters are hardcoded""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""total_circulation_volume"",
      ""metric_name"": ""Total Circulation Volume (Gross)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""route_volume"", ""charge_type""],
      ""business_description"": ""The sum of Draw, Returns, and Adjustment volumes. Note: This is a gross sum of all transaction types, not a net circulation figure (Draw - Returns + Adjustments)."",
      ""sql_logic"": ""SUM( (CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) )"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Year filter: '2025'"", ""Day filter: 'Sun'"", ""Fiscal week filter: 202541-202545""],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Represents the total movement of publications across all transaction types. Important to clarify if this is intended as a gross or net metric."",
      ""metric_category"": ""volume"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [""'Sun'"", ""202541"", ""202542"", ""202543"", ""202544"", ""202545""],
      ""governance_issues"": [""Filters are hardcoded"", ""Metric name might be misleading if 'Net Circulation' is implied.""],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""derived_publication_type"",
      ""metric_name"": ""Derived Publication Type"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""case_when"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""gl_publication_code""],
      ""business_description"": ""A categorized grouping of GL Publication Codes into broader publication types (e.g., 'ADV', 'DT', 'MERCURY')."",
      ""sql_logic"": ""CASE WHEN gl_publication_code IN ('500', '560') THEN 'ADV' ... ELSE 'Other' END"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Specific derived type filter: `clmn5_ IN ('DT')` in Q2""],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Enables analysis of circulation and charges by broader publication categories."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [""'ADV'"", ""'AUS'"", ""'CM'"", ""'Delicious'"", ""'Delicious Specials'"", ""'DT'"", ""'GAD'"", ""'GCB'"", ""'Group Shared Services'"", ""'Hobart Print Services'"", ""'HS'"", ""'MDM'"", ""'MERCURY'"", ""'NTN'"", ""'Perth Print Services'"", ""'Post Courier'"", ""'SC'"", ""'Taste'"", ""'TCHRN'"", ""'TCP'"", ""'TVB'"", ""'Vogue'"", ""'Vogue Living'"", ""'WT'"", ""'Other'"", ""'500'"", ""'560'"", ""'100'"", ""'400'"", ""'402'"", ""'9504'"", ""'9505'"", ""'110'"", ""'116'"", ""'350'"", ""'670'"", ""'180'"", ""'156'"", ""'301'"", ""'303'"", ""'5003'"", ""'850'"", ""'852'"", ""'961'"", ""'963'"", ""'158'"", ""'Post Courier'"", ""'5024'"", ""'9514'"", ""'9515'"", ""'5053'"", ""'450'"", ""'475'"", ""'9560'"", ""'9556'"", ""'305'""],
      ""governance_issues"": [""Mapping logic is hardcoded; should be in a lookup table."", ""Specific derived type filter is hardcoded.""],
      ""data_quality_concerns"": [""'Other' category might indicate unmapped codes requiring attention.""]
    },
    {
      ""metric_id"": ""total_charge_amount"",
      ""metric_name"": ""Total Charge Amount"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""sum"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""weekly"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [""charge_amount""],
      ""business_description"": ""The sum of all charge amounts, representing total revenue or cost associated with circulation."",
      ""sql_logic"": ""SUM(charge_amount)"",
      ""data_sources"": [""ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights""],
      ""filters_applied"": [""Year filter: '2025'"", ""Fiscal week filter: 202533-202540"", ""Sales channel filter: 'Subscriptions'"", ""Derived publication type filter: 'DT'""],
      ""expected_data_type"": ""decimal"",
      ""business_context"": ""A primary financial metric for circulation performance."",
      ""metric_category"": ""revenue"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [""2025""],
      ""hardcoded_values_in_metric"": [""202533"", ""202534"", ""202535"", ""202536"", ""202537"", ""202538"", ""202539"", ""202540"", ""'Subscriptions'"", ""'DT'""],
      ""governance_issues"": [""Filters are hardcoded""],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_draw_volume"",
      ""related_metrics"": [""route_volume"", ""charge_type""],
      ""relationship_description"": ""Total Draw Volume is calculated by summing `route_volume` only for records where `charge_type` is 'DRAW'."",
      ""mathematical_formula"": ""SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END)"",
      ""business_validation"": ""Ensures accurate measurement of publications initially distributed."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_returns_volume"",
      ""related_metrics"": [""route_volume"", ""charge_type""],
      ""relationship_description"": ""Total Returns Volume is calculated by summing `route_volume` only for records where `charge_type` is 'RETURNS'."",
      ""mathematical_formula"": ""SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END)"",
      ""business_validation"": ""Ensures accurate measurement of publications returned, indicating unsold copies."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""total_circulation_volume"",
      ""related_metrics"": [""route_volume"", ""charge_type""],
      ""relationship_description"": ""Total Circulation Volume is the sum of Draw, Returns, and Adjustment volumes. This is a gross sum of all transaction types."",
      ""mathematical_formula"": ""SUM( (CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END) + (CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) )"",
      ""business_validation"": ""Represents the total physical movement of publications. It's crucial to distinguish this from 'Net Circulation' (Draw - Returns + Adjustments)."",
      ""validation_sql"": ""SELECT SUM(CASE WHEN charge_type = 'DRAW' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'ADJUSTMENT' THEN route_volume ELSE 0 END + CASE WHEN charge_type = 'RETURNS' THEN route_volume ELSE 0 END) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY);"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""derived_publication_type"",
      ""related_metrics"": [""gl_publication_code""],
      ""relationship_description"": ""Derived Publication Type is a categorical mapping of `gl_publication_code` values based on a complex CASE statement."",
      ""mathematical_formula"": ""CASE WHEN gl_publication_code IN (...) THEN 'Category' ELSE 'Other' END"",
      ""business_validation"": ""Groups granular publication codes into broader, more manageable categories for analysis. Accuracy depends on the completeness and correctness of the mapping logic."",
      ""validation_sql"": ""SELECT gl_publication_code, CASE WHEN gl_publication_code IN ('500', '560') THEN 'ADV' WHEN gl_publication_code = '100' THEN 'AUS' WHEN gl_publication_code IN ('400', '402') THEN 'CM' WHEN gl_publication_code = '9504' THEN 'Delicious' WHEN gl_publication_code = '9505' THEN 'Delicious Specials' WHEN gl_publication_code IN ('110', '116') THEN 'DT' WHEN gl_publication_code = '350' THEN 'GAD' WHEN gl_publication_code = '670' THEN 'GCB' WHEN gl_publication_code = '180' THEN 'Group Shared Services' WHEN gl_publication_code = '156' THEN 'Hobart Print Services' WHEN gl_publication_code IN ('301', '303') THEN 'HS' WHEN gl_publication_code = '5003' THEN 'MDM' WHEN gl_publication_code IN ('850', '852') THEN 'MERCURY' WHEN gl_publication_code IN ('961', '963') THEN 'NTN' WHEN gl_publication_code = '158' THEN 'Perth Print Services' WHEN gl_publication_code = 'Post Courier' THEN 'Post Courier' WHEN gl_publication_code = '5024' THEN 'SC' WHEN gl_publication_code IN ('9514', '9515') THEN 'Taste' WHEN gl_publication_code = '5053' THEN 'TCHRN' WHEN gl_publication_code = '450' THEN 'TCP' WHEN gl_publication_code = '475' THEN 'TVB' WHEN gl_publication_code = '9560' THEN 'Vogue' WHEN gl_publication_code = '9556' THEN 'Vogue Living' WHEN gl_publication_code = '305' THEN 'WT' ELSE 'Other' END AS derived_type FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` WHERE charge_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) LIMIT 100;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""total_charge_amount"",
      ""related_metrics"": [""fiscal_week_id"", ""sales_channel_l4"", ""derived_publication_type""],
      ""relationship_description"": ""Total Charge Amount is filtered by specific fiscal weeks, sales channel ('Subscriptions'), and derived publication type ('DT')."",
      ""mathematical_formula"": ""SUM(charge_amount) WHERE fiscal_week_id IN (...) AND sales_channel_l4 = 'Subscriptions' AND derived_publication_type = 'DT'"",
      ""business_validation"": ""These filters narrow the scope of the charge amount to specific business segments and time periods, which is critical for targeted analysis. Hardcoding these limits flexibility."",
      ""validation_sql"": ""SELECT SUM(charge_amount) FROM `ncau-data-newsquery-prd.asl_finance.v_asl_circualtion_insights` AS ci LEFT JOIN `ncau-data-newsquery-prd.prstn_finance.v_calendar_dim` AS cal ON ci.charge_date = cal.calendar_date WHERE `left`(CAST(fiscal_week_id AS string), 4) IN ('2025') AND fiscal_week_id IN (202533, 202534, 202535, 202536, 202537, 202538, 202539, 202540) AND sales_channel_l4 IN ('Subscriptions') AND (CASE WHEN gl_publication_code IN ('110', '116') THEN 'DT' ELSE 'Other' END) IN ('DT') LIMIT 1;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    }
  ]
}
```",success,44
"```json
{
  ""dashboard_summary"": {
    ""dashboard_id"": ""6e8b534b-485a-48dd-842d-13dc6bebb01a"",
    ""dashboard_name"": ""SuperCoach Subscriptions"",
    ""primary_data_sources"": ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement"",
    ""business_domain"": ""consumer"",
    ""complexity_score"": 7,
    ""consolidation_score"": 6,
    ""total_metrics_identified"": 6,
    ""date_grain"": ""daily"",
    ""data_grain"": ""transactional"",
    ""key_dimensions"": [
      ""movement_date"",
      ""masthead"",
      ""subscription_movement_count_type"",
      ""source_masthead"",
      ""sold_in_rate_plan_code"",
      ""subscriber_id_src""
    ],
    ""date_range_detected"": ""01/07/2024 to 18/08/2024"",
    ""hardcoded_dates_found"": [
      ""01/07/2024"",
      ""19/08/2024""
    ],
    ""hardcoded_values_found"": [
      ""'SC'"",
      ""'acquisition'"",
      ""'SC_SDO_AP24AM12'"",
      ""'SC_SDO_AP20AM12'"",
      ""2452260"",
      ""'CS'""
    ],
    ""governance_opportunities"": [
      ""dates should be parameterised or use relative date functions"",
      ""masthead codes should use a reference table"",
      ""subscription movement types should use a reference table"",
      ""rate plan codes should use a reference table"",
      ""subscriber IDs should be dynamic or parameterised for specific analysis"",
      ""source masthead codes should use a reference table""
    ]
  },
  ""dataset_analysis"": {
    ""primary_analysis_sql"": ""-- This is the main SQL to run for SuperCoach Subscriptions dashboard metrics\nWITH base_data AS (\n  SELECT\n    SAFE_CAST(DATETIME_TRUNC(movement_datetime, SECOND) AS DATE) AS movement_date,\n    masthead,\n    subscription_movement_count_type,\n    sold_in_rate_plan_code,\n    SUBSTR(sold_in_source_code, 1, 2) AS source_masthead,\n    subscriber_id_src,\n    subscription_id_src\n  FROM\n    `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\n  WHERE\n    movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\n    AND masthead = 'SC'\n    AND subscription_movement_count_type = 'acquisition'\n)\nSELECT\n  movement_date,\n  source_masthead,\n  COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,\n  COUNT(DISTINCT CASE WHEN source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_unique_acquisitions_cs_source,\n  COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions\nFROM\n  base_data\nGROUP BY\n  movement_date,\n  source_masthead\nORDER BY\n  movement_date DESC, source_masthead\nLIMIT 1000;"",
    ""structure_sql"": ""SELECT\n  'Data Structure Analysis' as analysis_type,\n  COUNT(*) as total_records,\n  COUNT(DISTINCT SAFE_CAST(DATETIME_TRUNC(movement_datetime, SECOND) AS DATE)) as unique_dates,\n  COUNT(DISTINCT subscriber_id_src) as unique_subscribers,\n  COUNT(DISTINCT subscription_id_src) as unique_subscriptions,\n  COUNT(DISTINCT masthead) as unique_mastheads,\n  COUNT(DISTINCT subscription_movement_count_type) as unique_movement_types,\n  MIN(movement_datetime) as earliest_movement_datetime,\n  MAX(movement_datetime) as latest_movement_datetime,\n  APPROX_COUNT_DISTINCT(CONCAT(CAST(subscriber_id_src AS STRING), '-', CAST(subscription_id_src AS STRING), '-', CAST(movement_datetime AS STRING))) as approx_unique_movements\nFROM\n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  movement_datetime >= DATE_SUB(CURRENT_DATE(), INTERVAL 90 DAY);"",
    ""validation_sql"": ""SELECT\n  'Validation Check' as test_type,\n  CASE WHEN COUNT(DISTINCT subscription_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_subscriptions_test,\n  CASE WHEN COUNT(DISTINCT subscriber_id_src) > 0 THEN 'PASS' ELSE 'FAIL' END as unique_subscribers_test,\n  CASE WHEN MAX(movement_datetime) >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) THEN 'PASS' ELSE 'FAIL' END as freshness_test,\n  CASE WHEN SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END) > 0 THEN 'PASS' ELSE 'FAIL' END as supercoach_acquisition_data_test\nFROM\n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  movement_datetime >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)\nLIMIT 1;"",
    ""business_rules_sql"": ""SELECT\n  'Business Rule Validation' as validation_type,\n  'SuperCoach Acquisition Masthead Rule' as rule_name,\n  COUNT(*) as records_tested,\n  SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END) as supercoach_acquisition_records,\n  SAFE_DIVIDE(SUM(CASE WHEN masthead = 'SC' AND subscription_movement_count_type = 'acquisition' THEN 1 ELSE 0 END), COUNT(*)) * 100 as supercoach_acquisition_rate_percentage\nFROM\n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  movement_datetime >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);"",
    ""sample_data_sql"": ""SELECT\n  movement_datetime,\n  masthead,\n  subscription_movement_count_type,\n  sold_in_rate_plan_code,\n  sold_in_source_code,\n  subscriber_id_src,\n  subscription_id_src,\n  is_paying_flag\nFROM\n  `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\nWHERE\n  movement_datetime >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)\n  AND masthead = 'SC'\n  AND subscription_movement_count_type = 'acquisition'\nORDER BY\n  movement_datetime DESC\nLIMIT 500;"",
    ""hardcoded_issues"": {
      ""hardcoded_dates"": [
        {
          ""date_value"": ""01/07/2024"",
          ""original_format"": ""DATE '2024-07-01'"",
          ""context"": ""start date for subscription movement analysis"",
          ""suggested_fix"": ""replace with a dashboard date parameter or relative date function (e.g., DATE_SUB(CURRENT_DATE(), INTERVAL 60 DAY))"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        },
        {
          ""date_value"": ""19/08/2024"",
          ""original_format"": ""DATE '2024-08-19'"",
          ""context"": ""end date (exclusive) for subscription movement analysis"",
          ""suggested_fix"": ""replace with a dashboard date parameter or relative date function (e.g., CURRENT_DATE())"",
          ""impact"": ""high"",
          ""urgency"": ""high""
        }
      ],
      ""hardcoded_variables"": [
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SC'""
          ],
          ""context"": ""masthead filter for SuperCoach"",
          ""suggested_governance"": ""if 'SC' is a dynamic value, it should be a parameter; otherwise, ensure it's documented as a fixed business rule."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'acquisition'""
          ],
          ""context"": ""subscription movement type filter"",
          ""suggested_governance"": ""if other movement types are relevant, this should be a parameter; otherwise, document as a fixed business rule."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'SC_SDO_AP24AM12'"",
            ""'SC_SDO_AP20AM12'""
          ],
          ""context"": ""specific rate plan codes for filtering"",
          ""suggested_governance"": ""these should ideally be managed in a reference table (e.g., `rate_plan_master`) or be configurable parameters if they change frequently."",
          ""impact"": ""high"",
          ""maintenance_risk"": ""high""
        },
        {
          ""variable_type"": ""business_rules"",
          ""hardcoded_values"": [
            ""2452260""
          ],
          ""context"": ""specific subscriber ID filter"",
          ""suggested_governance"": ""this is highly specific; if it represents a test user or a specific case, it should be clearly documented. For general analysis, this should be a parameter or removed."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        },
        {
          ""variable_type"": ""lookup_codes"",
          ""hardcoded_values"": [
            ""'CS'""
          ],
          ""context"": ""source masthead filter (SUBSTR(sold_in_source_code, 1, 2))"",
          ""suggested_governance"": ""if 'CS' is a specific source, it should be managed in a reference table or be a configurable parameter."",
          ""impact"": ""medium"",
          ""maintenance_risk"": ""medium""
        }
      ]
    },
    ""parameterisation_recommendations"": [
      ""Replace hardcoded dates with date parameters or relative date functions (e.g., `CURRENT_DATE()`, `DATE_SUB(CURRENT_DATE(), INTERVAL X DAY)`)."",
      ""Replace hardcoded lookup values (masthead, movement type, rate plans, source masthead) with joins to governed reference tables or dashboard parameters."",
      ""Parameterize specific IDs like `subscriber_id_src` if the analysis needs to be dynamic for different subscribers.""
    ]
  },
  ""metrics"": [
    {
      ""metric_id"": ""movement_date"",
      ""metric_name"": ""Movement Date"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""date_function"",
      ""data_type"": ""date"",
      ""aggregation_level"": ""daily"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The date on which a subscription movement (e.g., acquisition, churn) occurred, truncated to the day."",
      ""sql_logic"": ""SAFE_CAST(DATETIME_TRUNC(movement_datetime, SECOND) AS DATE)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""date"",
      ""business_context"": ""Primary time dimension for analyzing subscription trends."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""high"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""source_masthead"",
      ""metric_name"": ""Source Masthead"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""string_function"",
      ""data_type"": ""string"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [],
      ""business_description"": ""The first two characters of the 'sold_in_source_code', typically representing the masthead or channel from which the subscription was sold."",
      ""sql_logic"": ""SUBSTR(sold_in_source_code, 1, 2)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""string"",
      ""business_context"": ""Used to segment acquisitions by the originating source/channel."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": [
        ""Potential for inconsistent or unexpected values if 'sold_in_source_code' is not well-governed.""
      ]
    },
    {
      ""metric_id"": ""supercoach_unique_acquisitions_total"",
      ""metric_name"": ""SuperCoach Unique Acquisitions (Total)"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""movement_date"",
        ""masthead"",
        ""subscription_movement_count_type""
      ],
      ""business_description"": ""The total count of unique subscription IDs for SuperCoach acquisitions within the specified date range."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src) WHERE masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND movement_datetime BETWEEN '2024-07-01' AND '2024-08-18'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'"",
        ""movement_datetime >= DATE '2024-07-01'"",
        ""movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""A key performance indicator for the growth of SuperCoach subscriptions."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""01/07/2024"",
        ""19/08/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'""
      ],
      ""governance_issues"": [
        ""date range is hardcoded"",
        ""masthead and movement type are hardcoded""
      ],
      ""data_quality_concerns"": [
        ""Accuracy depends on correct classification of 'acquisition' movements and 'SC' masthead.""
      ]
    },
    {
      ""metric_id"": ""supercoach_unique_acquisitions_by_source"",
      ""metric_name"": ""SuperCoach Unique Acquisitions by Source"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""source_masthead"",
      ""is_final_output"": true,
      ""is_kpi"": true,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [
        ""supercoach_unique_acquisitions_total"",
        ""source_masthead""
      ],
      ""business_description"": ""The count of unique subscription IDs for SuperCoach acquisitions, broken down by the 'Source Masthead'."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src) GROUP BY SUBSTR(sold_in_source_code, 1, 2) WHERE masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND movement_datetime BETWEEN '2024-07-01' AND '2024-08-18'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'"",
        ""movement_datetime >= DATE '2024-07-01'"",
        ""movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Provides insight into which channels or mastheads are driving SuperCoach acquisitions."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""medium"",
      ""hardcoded_dates_in_metric"": [
        ""01/07/2024"",
        ""19/08/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'""
      ],
      ""governance_issues"": [
        ""date range is hardcoded"",
        ""masthead and movement type are hardcoded""
      ],
      ""data_quality_concerns"": [
        ""Relies on consistent and accurate 'sold_in_source_code' values.""
      ]
    },
    {
      ""metric_id"": ""supercoach_specific_rate_plan_subscriber_acquisitions"",
      ""metric_name"": ""SuperCoach Specific Rate Plan & Subscriber Acquisitions"",
      ""metric_type"": ""measure"",
      ""calculation_type"": ""count_distinct"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""custom"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""medium"",
      ""depends_on_metrics"": [
        ""supercoach_unique_acquisitions_total"",
        ""source_masthead"",
        ""subscriber_id"",
        ""sold_in_rate_plan_code""
      ],
      ""business_description"": ""The count of unique subscription IDs for SuperCoach acquisitions that match specific rate plans ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12'), a particular subscriber ID (2452260), and a 'CS' source masthead."",
      ""sql_logic"": ""COUNT(DISTINCT subscription_id_src) WHERE masthead = 'SC' AND subscription_movement_count_type = 'acquisition' AND sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND SUBSTR(sold_in_source_code, 1, 2) = 'CS' AND movement_datetime BETWEEN '2024-07-01' AND '2024-08-18'"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [
        ""masthead = 'SC'"",
        ""subscription_movement_count_type = 'acquisition'"",
        ""movement_datetime >= DATE '2024-07-01'"",
        ""movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)"",
        ""sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12')"",
        ""subscriber_id_src = 2452260"",
        ""SUBSTR(sold_in_source_code, 1, 2) = 'CS'""
      ],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Likely used for very specific analysis, debugging, or tracking a particular campaign/user segment."",
      ""metric_category"": ""acquisition"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""low"",
      ""hardcoded_dates_in_metric"": [
        ""01/07/2024"",
        ""19/08/2024""
      ],
      ""hardcoded_values_in_metric"": [
        ""'SC'"",
        ""'acquisition'"",
        ""'SC_SDO_AP24AM12'"",
        ""'SC_SDO_AP20AM12'"",
        ""2452260"",
        ""'CS'""
      ],
      ""governance_issues"": [
        ""date range is hardcoded"",
        ""all filter values are hardcoded, making it inflexible for general use.""
      ],
      ""data_quality_concerns"": [
        ""Highly dependent on the accuracy of multiple specific filter values.""
      ]
    },
    {
      ""metric_id"": ""subscriber_id"",
      ""metric_name"": ""Subscriber ID"",
      ""metric_type"": ""dimension"",
      ""calculation_type"": ""other"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": true,
      ""is_kpi"": false,
      ""business_criticality"": ""high"",
      ""depends_on_metrics"": [],
      ""business_description"": ""A unique identifier for a subscriber."",
      ""sql_logic"": ""subscriber_id_src"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Used for identifying individual subscribers, potentially for filtering or drill-down."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    },
    {
      ""metric_id"": ""is_previous_samesubscriber"",
      ""metric_name"": ""Is Previous Same Subscriber"",
      ""metric_type"": ""calculated_field"",
      ""calculation_type"": ""aggregation"",
      ""data_type"": ""numeric"",
      ""aggregation_level"": ""transaction"",
      ""is_final_output"": false,
      ""is_kpi"": false,
      ""business_criticality"": ""low"",
      ""depends_on_metrics"": [
        ""subscriber_id"",
        ""subscription_movement_count_type"",
        ""masthead"",
        ""is_paying_flag"",
        ""movement_date""
      ],
      ""business_description"": ""A flag indicating if there was a previous movement for the same subscriber, movement type, masthead, and paying status, ordered by movement datetime. Used internally in the view."",
      ""sql_logic"": ""COUNT(*) OVER (PARTITION BY subscriber_id_src, subscription_movement_count_type, masthead, is_paying_flag ORDER BY movement_datetime ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING)"",
      ""data_sources"": [
        ""ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement""
      ],
      ""filters_applied"": [],
      ""expected_data_type"": ""integer"",
      ""business_context"": ""Internal calculation within the `v_subscription_movement` view, likely used for identifying first-time acquisitions or re-activations, though not directly exposed as a dashboard metric in these queries."",
      ""metric_category"": ""other"",
      ""update_frequency"": ""daily"",
      ""seasonality_impact"": ""none"",
      ""hardcoded_dates_in_metric"": [],
      ""hardcoded_values_in_metric"": [],
      ""governance_issues"": [],
      ""data_quality_concerns"": []
    }
  ],
  ""metric_interactions"": [
    {
      ""interaction_type"": ""dependency"",
      ""primary_metric"": ""supercoach_unique_acquisitions_by_source"",
      ""related_metrics"": [
        ""supercoach_unique_acquisitions_total"",
        ""source_masthead""
      ],
      ""relationship_description"": ""The 'SuperCoach Unique Acquisitions by Source' metric is a breakdown of the 'SuperCoach Unique Acquisitions (Total)' metric, using 'Source Masthead' as the grouping dimension."",
      ""mathematical_formula"": ""SUM(supercoach_unique_acquisitions_by_source for all source_masthead) = supercoach_unique_acquisitions_total"",
      ""business_validation"": ""Ensures that the sum of acquisitions across all sources equals the total acquisitions for SuperCoach."",
      ""validation_sql"": ""SELECT\n  SUM(supercoach_unique_acquisitions_by_source) AS sum_by_source,\n  (SELECT supercoach_unique_acquisitions_total FROM (\n    SELECT\n      movement_date,\n      source_masthead,\n      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,\n      COUNT(DISTINCT CASE WHEN source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_unique_acquisitions_cs_source,\n      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions\n    FROM\n      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\n    WHERE\n      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\n      AND masthead = 'SC'\n      AND subscription_movement_count_type = 'acquisition'\n    GROUP BY\n      movement_date,\n      source_masthead\n  ) AS primary_analysis_results\n  WHERE movement_date = '2024-07-01' -- Example date\n  LIMIT 1) AS total_acquisitions_for_date\nFROM\n  (\n    SELECT\n      movement_date,\n      source_masthead,\n      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,\n      COUNT(DISTINCT CASE WHEN source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_unique_acquisitions_cs_source,\n      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions\n    FROM\n      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\n    WHERE\n      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\n      AND masthead = 'SC'\n      AND subscription_movement_count_type = 'acquisition'\n    GROUP BY\n      movement_date,\n      source_masthead\n  ) AS primary_analysis_results\nWHERE\n  movement_date = '2024-07-01' -- Example date\nGROUP BY\n  movement_date;"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""high""
    },
    {
      ""interaction_type"": ""filter_impact"",
      ""primary_metric"": ""supercoach_specific_rate_plan_subscriber_acquisitions"",
      ""related_metrics"": [
        ""supercoach_unique_acquisitions_total"",
        ""sold_in_rate_plan_code"",
        ""subscriber_id"",
        ""source_masthead""
      ],
      ""relationship_description"": ""The 'SuperCoach Specific Rate Plan & Subscriber Acquisitions' metric is a highly filtered subset of the 'SuperCoach Unique Acquisitions (Total)' metric, applying additional specific criteria on rate plan, subscriber ID, and source masthead."",
      ""mathematical_formula"": ""supercoach_specific_rate_plan_subscriber_acquisitions <= supercoach_unique_acquisitions_total"",
      ""business_validation"": ""This metric should always be less than or equal to the total acquisitions, as it applies more restrictive filters."",
      ""validation_sql"": ""SELECT\n  SUM(supercoach_specific_rate_plan_subscriber_acquisitions) AS specific_acquisitions,\n  SUM(supercoach_unique_acquisitions_total) AS total_acquisitions\nFROM\n  (\n    SELECT\n      movement_date,\n      source_masthead,\n      COUNT(DISTINCT subscription_id_src) AS supercoach_unique_acquisitions_total,\n      COUNT(DISTINCT CASE WHEN sold_in_rate_plan_code IN ('SC_SDO_AP24AM12', 'SC_SDO_AP20AM12') AND subscriber_id_src = 2452260 AND source_masthead = 'CS' THEN subscription_id_src END) AS supercoach_specific_rate_plan_subscriber_acquisitions\n    FROM\n      `ncau-data-newsquery-prd.prstn_consumer_views.v_subscription_movement`\n    WHERE\n      movement_datetime >= DATE '2024-07-01' AND movement_datetime < DATETIME_ADD(DATE '2024-08-19', INTERVAL 1 DAY)\n      AND masthead = 'SC'\n      AND subscription_movement_count_type = 'acquisition'\n    GROUP BY\n      movement_date, source_masthead\n  ) AS subquery\nWHERE\n  movement_date = '2024-07-01'; -- Example date"",
      ""relationship_strength"": ""strong"",
      ""business_impact"": ""medium""
    }
  ]
}
```",success,45
